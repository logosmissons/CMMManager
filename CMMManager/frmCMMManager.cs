using System;
using System.Collections.Generic;
using System.Data;
using System.Data.SqlClient;
using System.Diagnostics;
using System.Drawing;
using System.Globalization;
using System.IO;
using System.Text;
using System.Windows.Forms;
using System.Linq;
using Microsoft.Win32;
using OfficeOpenXml;
using OfficeOpenXml.Style;
using MigraDocDOM = MigraDoc.DocumentObjectModel;
using PdfSharp;
using PdfSharp.Pdf;
using PdfSharp.Drawing;
using PdfSharp.Charting;
//using MigraDoc.DocumentObjectModel;
using MigraDoc.Rendering;
using MigraDoc.RtfRendering;


//using Windows.Devices.Enumeration;
//using Windows.Devices.Scanners;


namespace CMMManager
{
    public partial class frmCMMManager : Form
    {

        public int nLoggedUserId;
        public String LoggedInUserName;
        public UserRole LoggedInUserRole;
        public Department LoggedInUserDepartment;

        private SqlConnectionOpen RN_ConnectionOpen;

        private SqlConnection connRN;
        private SqlConnection connRN2;
        private SqlConnection connRN3;
        private SqlConnection connRN4;
        private SqlConnection connRN5;
        private SqlConnection connRN6;
        private SqlConnection connRN7;


        private SqlConnection connRNLimitedSharing;

        private String rn_cnn_str;
        private String rn_cnn_str2;
        private String rn_cnn_str3;
        private String rn_cnn_str4;
        private String rn_cnn_str5;
        private String rn_cnn_str6;
        private String rn_cnn_str7;
        private String rn_cnn_strLimitedSharing;

        private SqlCommand rn_cmd;

        //private SqlDependencyEx dependency;

        //String strSalesforceConnString;
        //SqlConnection connSalesforce;
        //SqlCommand cmdSalesforce;

        private SqlConnection connSalesforce;
        private SqlConnection connSalesforce2;
        private SqlConnection connSalesforce3;
        private SqlConnection connSalesforce4;
        private String connStringSalesforce;
        private String connStringSalesforce2;
        private String connStringSalesforce3;
        private String connStringSalesforce4;

        private SqlCommand cmd_Salesforce;

        private Boolean bIsModified = false;

        public IndividualInfo IndividualSearched;
        public IndividualInfo IndividualForMedBill;

        public BankInfo IndividualBankInfo;

        // Delegates for Cross thread method call
        delegate void SetTabPages(int nIndex);

        private delegate void RemoveSettlementForApprovalInDashboard(int nRow);
        private delegate void RemoveAllSettlementForApprovalInDashboard();
        private delegate void AddRowToSettlementForApprovalInDashboard(DataGridViewRow row);

        private delegate void RemoveTaskInCase(int nRow);
        private delegate void RemoveAllRowsTaskInCase();
        private delegate void AddRowToTaskInCase(DataGridViewRow row);

        private delegate void RemoveRowInIllnessList(int nRow);
        private delegate void RemoveAllRowsInIllnessList();
        private delegate void AddRowToIllnessList(DataGridViewRow row);

        private delegate void RemoveRowInIncidentList(int nRow);
        private delegate void RemoveAllRowsInIncidentList();
        private delegate void AddRowToIncidentList(DataGridViewRow row);

        private delegate void RemoveRowInGVSettlement(int nRow);
        private delegate void RemoveAllRowsInSettlement();
        private delegate void AddRowToGVSettlement(DataGridViewRow row);

        private delegate void RemoveMedBillInCase(int nRow);
        private delegate void RemoveAllMedBillInCase();
        private delegate void AddRowToMedBillInCase(DataGridViewRow row);

        private delegate void RemoveMedBillInList(int nRow);
        private delegate void RemoveAllMedBillInList();
        private delegate void AddRowToMedBillInList(DataGridViewRow row);

        private delegate void RemoveCaseInProcess(int nRow);
        private delegate void RemoveAllCaseInProcess();
        private delegate void AddRowToCaseInProcess(DataGridViewRow row);

        private delegate void RemoveCaseInCaseView(int nRow);
        private delegate void RemoveAllCaseInCaseView();
        private delegate void AddRowToCaseInCaseView(DataGridViewRow row);

        private delegate void RemoveAllMedBillsInCaseEdit();
        private delegate void AddRowToMedBillsInCaseEdit(DataGridViewRow row);

        private delegate void RemoveTaskInMedBill(int nRow);
        private delegate void RemoveAllTaskInMedBill();
        private delegate void AddRowToTaskInMedBill(DataGridViewRow row);

        private delegate void RemoveActiveTaskRNManager(int nRow);
        private delegate void RemoveAllActiveTaskRNManager();
        private delegate void AddRowToActiveTaskRNManager(DataGridViewRow row);

        private delegate void RemoveCompleteTaskRNManager(int nRow);
        private delegate void RemoveAllCompleteTaskRNManager();
        private delegate void AddRowToCompleteTaskRNManager(DataGridViewRow row);

        private delegate void RemoveActiveTaskRNStaff(int nRow);
        private delegate void RemoveAllActiveTaskRNStaff();
        private delegate void AddRowToActiveTaskRNStaff(DataGridViewRow row);

        private delegate void RemoveCompleteTaskRNStaff(int nRow);
        private delegate void RemoveAllCompleteTaskRNStaff();
        private delegate void AddRowToCompleteTaskRNStaff(DataGridViewRow row);

        private delegate void RemoveActiveTaskNPManager(int nRow);
        private delegate void RemoveAllActiveTaskNPManager();
        private delegate void AddRowToActiveTaskNPManager(DataGridViewRow row);

        private delegate void RemoveCreditCardPayment(int nRow);
        private delegate void RemoveAllCreditCardPayment();
        private delegate void AddRowToCreditCardPayment(DataGridViewRow row);

        private delegate void RemoveCheckPayment(int nRow);
        private delegate void RemoveAllCheckPayment();
        private delegate void AddRowToCheckPayment(DataGridViewRow row);

        private delegate void RemoveCheckPaymentToProvider(int nRow);
        private delegate void RemoveAllCheckPaymentToProvider();
        private delegate void AddRowToCheckPaymentToProvider(DataGridViewRow row);

        private delegate void RemoveACHPayment(int nRow);
        private delegate void RemoveAllACHPayment();
        private delegate void AddRowToACHPayment(DataGridViewRow row);

        private delegate void RemoveInactivePayment(int nRow);
        private delegate void RemoveAllInactivePayment();
        private delegate void AddRowToInactivePayment(DataGridViewRow row);

        private delegate void RemoveBlueSheet(int nRow);
        private delegate void RemoveAllBlueSheet();
        private delegate void AddRowToBlueSheet(DataGridViewRow row);

        private delegate void RemovePaidCheckReconcile(int nRow);
        private delegate void RemoveAllPaidCheckReconcile();
        private delegate void AddRowToPaidCheckReconcile(DataGridViewRow row);

        private delegate void SetBalaceMedBill(Decimal Balance);
        private delegate void SetTotalSharedAmount(Decimal TotalSharedAmount);

        private delegate void EnableEditMedBillButton();
        private delegate void DisableEditMedBillButton();

        private delegate void EnableDeleteMedBillButton();
        private delegate void DisableDeleteMedBillButton();

        private enum TabPage { None, DashBoard, Individual, CaseView, Case, MedBill };
        private enum MedBillStatus { Pending, CMMPendingPayment, Closed, Ineligible, PartiallyIneligible };

        private TabPage BeforePrevTabPage = TabPage.None;
        private TabPage PrevTabPage = TabPage.None;
        private TabPage CurrentTabPage = TabPage.None;

        private TabPage MedBillStart = TabPage.None;

        // Enumerations
        private enum CaseMode { AddNew, Edit };
        private enum MedBillMode { AddNew, Edit };

        private CaseMode caseMode = CaseMode.AddNew;
        private MedBillMode medbillMode = MedBillMode.AddNew;

        private enum MedBillType { MedicalBill = 1, Prescription, PhysicalTherapy };
        //private enum MedBillStatus { PendingStatus, JobAssigned, InProgress, EligibilityReview, UnderBillProcessing, CompletedAndClose };
        private enum PatientType { OutPatient, InPatient };
        private enum Program { GoldPlus, Gold, Silver, Bronze, GoldMedi_I, GoldMedi_2 };
        //private enum SettlementType { SelfPayDiscount = 1, ThirdPartyDiscount, MemberPayment, CMMProviderPayment, CMMDiscount, MemberReimbursement, Ineligible, MedicalProviderRefund, PersonalResponsibility };
        private enum PaymentMethodType { None, Check, CreditCard, ACH_Bankng };

        private enum SettlementMode { AddNew, Edit };

        private SettlementMode settlementMode = SettlementMode.Edit;

        //public SettlementType settlementType;

        private List<ICD10CodeInfo> lstICD10CodeInfo;

        //private String strConnStringForIllness;
        //private SqlConnection connIllness;


        //private String strNewMedBillNo;
        private String MedBillNoForTask = String.Empty;    // user for tasks datagridview
        private String MedicalBillNo = String.Empty;
        private String strIndividualId = String.Empty;
        private String IndividualIdIndividualPage = String.Empty;
        //private String strSqlCreateCase = String.Empty;
        public String strCaseId = String.Empty;
        //public String CaseIdSelected = String.Empty;
        public String strCaseNameSelected = String.Empty;

        // Individual Id and Case ID for Med Bills in Case for editing
        String IndividualIdSelected = String.Empty;
        String CaseIdSelected = String.Empty;
        String CaseNameSelected = String.Empty;
        String CaseIdForCasePageMedBill = String.Empty;

        //private ViewPrevToMedBill PrevViewToMedicalBill;


        public String strCaseIdSelected = String.Empty;
        public String strContactIdSelected = String.Empty;

        public String strCaseIdForIllness = String.Empty;
        //public String strIndividualID = String.Empty;

        public Decimal PersonalResponsibilityAmountInMedBill;

        public int LimitedSharingYear;
        public Dictionary<int, Decimal> dicLimitedSharing1;
        public Dictionary<int, Decimal> dicLimitedSharing2;

        public Dictionary<int, String> dicMedBillTypes;
        public Dictionary<int, String> dicMedBillStatus;
        public Dictionary<int, String> dicPendingReason;
        public Dictionary<int, String> dicIneligibleReason;

        public List<int> lstLimitedSharingId;
        public List<CaseInfo> lstCaseInfo;
        public List<StaffInfo> lstCreateStaff;
        public List<StaffInfo> lstModifiStaff;

        public List<IneligibleReasonInfo> lstIneligibleReasonInfo;
        //public List<IneligibleReasonInfo> lstSortedIneligibleReasonInfo;
        public List<SettlementInfoForApproval> lstSettlementInfoForApproval;
        public List<PaymentMethod> lstPaymentMethod;
        public List<CreditCardInfo> lstCreditCardInfo;
        public List<MedicalProviderInfo> lstMedicalProvider;
        public List<ChurchInfo> lstChurchInfo;
        public List<MedBillStatusInfo> lstMedBillStatusInfo;
        public List<SettlementTypeInfo> lstSettlementType;
        public List<PersonalResponsiblityTypeInfo> lstPersonalResponsibilityType;
        public List<MedBillNoteTypeInfo> lstMedBillNoteTypeInfo;
        public List<IncidentProgramInfo> lstIncidentProgramInfo;
        public SelectedIllness Illness;
        public SelectedIncident Incident;


        private String strNPFFormFileName = String.Empty;
        private String strIBFileName = String.Empty;
        private String strPoPFileName = String.Empty;
        private String strMedicalRecordFileName = String.Empty;
        private String strUnknownDocFileName = String.Empty;

        // field variables for file name and path variables for Case Documents
        private String strNPFormFilePathSource = String.Empty;
        private String strNPFormFilePathDestination = String.Empty;

        private String strIBFilePathSource = String.Empty;
        private String strIBFilePathDestination = String.Empty;

        private String strPoPFilePathSource = String.Empty;
        private String strPopFilePathDestination = String.Empty;

        private String strMedRecordFilePathSource = String.Empty;
        private String strMedRecordFilePathDestination = String.Empty;

        private String strUnknownDocFilePathSource = String.Empty;
        private String strUnknownDocFilePathDestination = String.Empty;

        // field variables for file name and path variables for Medical Bill Documents
        private String strNPFormFileNameMedBill = String.Empty;
        private String strNPFSourceFilePathMedBill = String.Empty;
        private String strNPFDestinationFilePathMedBill = String.Empty;
        //private Boolean bNPFMedBill = false;

        private String strIBFileNameMedBill = String.Empty;
        private String strIBSourceFilePathMedBill = String.Empty;
        private String strIBDestinationFilePathMedBill = String.Empty;

        private String strPoPFileNameMedBill = String.Empty;
        private String strPoPSourceFilePathMedBill = String.Empty;
        private String strPoPDestinationFilePathMedBill = String.Empty;

        private String strMedRecFileNameMedBill = String.Empty;
        private String strMedRecSourceFilePathMedBill = String.Empty;
        private String strMedRecDestinationFilePathMedBill = String.Empty;

        private String strOtherDocFileNameMedBill = String.Empty;
        private String strOtherDocSourceFilePathMedBill = String.Empty;
        private String strOtherDocDestinationFilePathMedBill = String.Empty;

        private String strDestinationPath = @"\\cmm-2014u\Sharefolder\";
        private String strCaseDocDestinationPath = @"\\cmm-2014u\Sharefolder\FormsInCase\";         // folder for Documents in Case
        private String strMedBillDocDestinationPath = @"\\cmm-2014u\Sharefolder\FormsInMedBill\";   // folder for Documents in Medical Bill

        // BlueSheet Path
        private String CheckBlueSheetPath = @"\\CMM-2014u\Sharefolder\BlueSheets\Check\";
        private String ACHBlueSheetPath = @"\\CMM-2014u\Sharefolder\BlueSheets\ACH\";
        private String CreditCardBlueSheetPath = @"\\CMM-2014u\Sharefolder\BlueSheets\CreditCard\";



        // Temporary storage for Medical Bill Information
        // Prescription fields
        private String tmpPrescriptionName = String.Empty;
        private String tmpPrescriptionDescription = String.Empty;
        private String tmpPrescriptionNote = String.Empty;
        private String tmpNumberOfMedication = String.Empty;

        // Physical Therapy fields
        private String tmpNumPhysicalTherapy = String.Empty;
        private String tmpPhysicalTherapyRxNote = String.Empty;

        // Medical Bill fields
        private Boolean tmpInPatient = false;
        private Boolean tmpOutPatient = false;
        private String tmpMedBillNote = String.Empty;
        private int tmpPendingReason;
        private int tmpIneligibleReason;

        /// <summary>
        /// Global variables for BlueSheet
        /// </summary>
        /// 
        EnumPaidTo PaidToBlueSheet = EnumPaidTo.Member;

        public SortedFieldBlueSheet paidSortedFieldBlueSheet = null;
        public SortedFieldBlueSheet cmmPendingPaymentSortedFieldBlueSheet = null;
        public SortedFieldBlueSheet pendingSortedFieldBlueSheet = null;
        public SortedFieldBlueSheet ineligibleSortedFieldBlueSheet = null;

        public SortedFieldBlueSheet paidInPaidTabSortedFieldBlueSheet = null;
        public SortedFieldBlueSheet cmmCMMPendingPaymentInTabSortedFieldBlueSheet = null;
        public SortedFieldBlueSheet pendingInTabSortedFieldBlueSheet = null;
        public SortedFieldBlueSheet ineligibleInTabSortedFieldBlueSheet = null;

        public SortedFieldBlueSheet prSortedFieldBlueSheet = null;


        public String strIndividualIDBlueSheet = null;
        public String strCheckNoBlueSheet = null;
        public List<IncidentBlueSheet> lstIncidentsBlueSheet = null;

        public CheckInfoBlueSheet ChkInfoEnteredBlueSheet = null;
        public ACHInfoBlueSheet ACHInfoEnteredBlueSheet = null;
        public CreditCardPaymentInfoBlueSheet CreditCardPaymentEnteredBlueSheet = null;
        public PersonalResponsibilityTotalInfoBlueSheet PersonalResponsibilityTotalEnteredBlueSheet = null;

        public Boolean bPaidHasRowBlueSheet = false;
        public Boolean bCMMPendingPaymentHasRowBlueSheet = false;
        public Boolean bPendingHasRowBlueSheet = false;
        public Boolean bIneligibleHasRowBlueSheet = false;

        public String strPrimaryNameBlueSheet = String.Empty;
        public String strMembershipIdBlueSheet = String.Empty;
        public String strIndividualNameBlueSheet = String.Empty;
        public String strIndividualLastNameBlueSheet = String.Empty;
        public String strIndividualMiddleNameBlueSheet = String.Empty;
        public String strIndiviaualFirstNameBlueSheet = String.Empty;
        public String strStreetAddressBlueSheet = String.Empty;
        public String strCityBlueSheet = String.Empty;
        public String strStateBlueSheet = String.Empty;
        public String strZipBlueSheet = String.Empty;

        public List<PersonalResponsibilityInfoBlueSheet> lstPersonalResponsibilityInfoBlueSheet;
        public List<SettlementIneligibleInfoBlueSheet> lstSettlementIneligibleInfoBlueSheet;

        public List<PaidMedicalExpenseTableRowBlueSheet> lstPaidMedicalExpenseTableRowBlueSheet = new List<PaidMedicalExpenseTableRowBlueSheet>();
        public List<CMMPendingPaymentTableRowBlueSheet> lstCMMPendingPaymentTableRowBlueSheet = new List<CMMPendingPaymentTableRowBlueSheet>();
        public List<PendingTableRowBlueSheet> lstPendingTableRowBlueSheet = new List<PendingTableRowBlueSheet>();
        public List<BillIneligibleTableRowBlueSheet> lstBillIneligibleTableRowBlueSheet = new List<BillIneligibleTableRowBlueSheet>();

        // BlueSheet Korean greeting messages
        // Check, ACH, Credit Card
        private String strGreetingMessagePara1 = "귀 회원이 신청한 의료비가 정산되어 알려 드립니다. 아래의 ‘의료비 정산 내역서’를 확인하여 주시고, " +
                                                 "만일 정산된 금액이나 내용에 오류가 있다면 의료비지원부(NPD)로 알려 주십시오.";

        private String strGreetingMessagePara2 = "현재 ‘보류 중인 의료비’에 '잔액/보류'가 있다면 미비서류로 인해 의료비 진행이 지연되지 않도록 요청된 미비서류를 신속히 보내 주시기 바랍니다. " +
                                                 "기타 문의사항은 월-금(오전 9시- 오후 5:30 중부시간)까지 NPD 사무실로 연락하여 주십시오.";

        private String strGreetingMessagePara3 = "CMM 사역에 참여하여 주심에 진심으로 감사를 드리며, 오늘도 주 예수 그리스도의 평강이 함께 하시기를 기도합니다. ";
        private String strGreetingMessagePara4 = "감사합니다.";

        // Personal Responsibility Only
        private String strPRGreetingMessagePara1 = "신청하신 의료비가 정산되어 알려드립니다.";
        private String strPRGreetingMessagePara2 = "성경 말씀에 따라 의료비 나눔 사역을 실천하고 있는 기독의료상조회에는 서로의 짐을 나누어 지는(갈 6:2) " +
                                                   "‘의료비 나눔’과 각각 자기의 짐을 지는(갈 6:5) ‘본인 부담금’이 있습니다. ";
        private String strPRGreetingMessagePara3 = "현재 신청하신 의료비는 회원님이 가입하신 프로그램의  본인 부담금 또는 지원 불가 의료비에 해당하는 금액으로 본회의 가이드라인에 따라" +
                                                   " 지원이 되지 않음을 알려드립니다. ";
        private String strPRGreetingMessagePara4 = "\n아래  의료비 정산 내역을 확인하시고 정산된 금액이나 내용에 문의사항이 있으면 의료비 지원부 (773-777-8889 Ext. 5003)로 연락주시기 바랍니다.";
        private String strPRGreetingMessagePara5 = "CMM 사역에 참여하여 주셔서 진심으로 감사드리며,  주 예수 그리스도의 평강이 늘 함께 하시길 기도합니다.";
        private String strPRGreetingMessagePara6 = "감사합니다.";

        // BlueSheet English greeting messages
        private String strDearMember = "Dear ";
        private String strEnglishGreetingMessage1 = "We thank you for participating in our health care sharing ministry and pray that the grace of our Lord Jesus Christ " +
                                                      "overflows in your family business as we continue to pray for your recovery.";
        private String strEnglishGreetingMessage2 = "Your medical bills that were submitted have been processed. Please carefully review your summary below. " +
                                                    "If there are any discrepancies, please notify Needs Processing Department(NPD) immediately. " +
                                                    "If you have been notified by our NPD about incomplete documentation or outstanding balances, please submit " +
                                                    "requested documents as soon as possible to avoid further delay of your needs processing.";
        private String strEnglishGreetingMessage3 = "If you have any question or concerns, please contact NPD Monday through Friday 9 A.M. to 5:30 P.M. (CST)";

        private String strEnglishGreetingMessage4 = "\nBest regards,";

        private String strEnglishPRGreetingMessage1 = "Christian Mutual Med-Aid(CMM) follows the Word of God.Together we share our brothers’ and sisters’ burdens " +
                                                      "as the Bible says in Galatian 6:2. Also, the Bible states that each person must carry their own load in Galatian 6:5. " +
                                                      "We define that load as Personal Responsibility(CMM Guidelines, Section VII. Needs Processing and Sharing, B.Personal Responsibility). " +
                                                      "Please see the table below for your convenience.";
        private String strEnglishPRGreetingMessage2 = "\nAccording to CMM Guidelines, your medical needs share request amount does not exceed the program’s Personal Responsibility. " +
                                                      "Therefore, we are not able to share your medical needs.";
        private String strEnglishPRGreetingMessage3 = "Should you have any questions regarding this, please contact the Needs Processing Department at 773-777-8889 Ext) 5003, " +
                                                      "Monday through Friday, from 9:00 AM to 5:30 PM, CST.";

        private String strEnglishPRGreetingMessage4 = "We thank you for participating in our health care sharing ministry and pray that the overflowing grace of our Lord Jesus " +
                                                      "be with you and your family.";

        private String strEnglishPRGreetingMessage5 = "\n\nBest regards,";

        private String strCMM_NeedProcessing = "NEEDS PROCESSING DEPARTMENT";
        private String strNP_Phone_Fax_Email = "T.773-777-8889\nnpd@cmmlogos.org";


        ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

        public frmCMMManager()
        {
            InitializeComponent();

            //Control.CheckForIllegalCrossThreadCalls = false;
            Control.CheckForIllegalCrossThreadCalls = true;

            IndividualSearched = new IndividualInfo();
            IndividualForMedBill = new IndividualInfo();

            lstICD10CodeInfo = new List<ICD10CodeInfo>();

            //rn_cnn_str = @"Data Source=CMM-2014U\CMM; Initial Catalog=RN_DB;Integrated Security=True";
            rn_cnn_str = @"Data Source=CMM-2014U\CMM; Initial Catalog=RN_DB;Integrated Security=True; Max Pool Size=200";
            rn_cnn_str2 = @"Data Source=CMM-2014U\CMM; Initial Catalog=RN_DB;Integrated Security=True; Max Pool Size=200";
            rn_cnn_str3 = @"Data Source=CMM-2014U\CMM; Initial Catalog=RN_DB;Integrated Security=True; Max Pool Size=200";
            rn_cnn_str4 = @"Data Source=CMM-2014U\CMM; Initial Catalog=RN_DB;Integrated Security=True; Max Pool Size=200";
            rn_cnn_str5 = @"Data Source=CMM-2014U\CMM; Initial Catalog=RN_DB;Integrated Security=True; Max Pool Size=200";
            rn_cnn_str6 = @"Data Source=CMM-2014U\CMM; Initial Catalog=RN_DB;Integrated Security=True; Max Pool Size=200";
            rn_cnn_str7 = @"Data Source=CMM-2014U\CMM; Initial Catalog=RN_DB;Integrated Security=True; Max Pool Size=200";
            rn_cnn_strLimitedSharing = @"Data Source=CMM-2014U\CMM; Initial Catalog=RN_DB;Integrated Security=True;";


            connRN = new SqlConnection(rn_cnn_str);
            connRN2 = new SqlConnection(rn_cnn_str2);
            connRN3 = new SqlConnection(rn_cnn_str3);
            connRN4 = new SqlConnection(rn_cnn_str4);
            connRN5 = new SqlConnection(rn_cnn_str5);
            connRN6 = new SqlConnection(rn_cnn_str6);
            connRN7 = new SqlConnection(rn_cnn_str7);
            connRNLimitedSharing = new SqlConnection(rn_cnn_strLimitedSharing);


            connStringSalesforce = @"Data Source=CMM-2014U\CMM; Initial Catalog=SalesForce; Integrated Security=True";
            connStringSalesforce2 = @"Data Source=CMM-2014U\CMM; Initial Catalog=SalesForce; Integrated Security=True";
            connStringSalesforce3 = @"Data Source=CMM-2014U\CMM; Initial Catalog=SalesForce; Integrated Security=True";
            connStringSalesforce4 = @"Data Source=CMM-2014U\CMM; Initial Catalog=SalesForce; Integrated Security=True";


            connSalesforce = new SqlConnection(connStringSalesforce);
            connSalesforce2 = new SqlConnection(connStringSalesforce2);
            connSalesforce3 = new SqlConnection(connStringSalesforce3);
            connSalesforce4 = new SqlConnection(connStringSalesforce4);

            SqlDependency.Start(rn_cnn_str);
            SqlDependency.Start(rn_cnn_str2);
            SqlDependency.Start(rn_cnn_str3);
            SqlDependency.Start(rn_cnn_str4);
            SqlDependency.Start(rn_cnn_str5);
            SqlDependency.Start(rn_cnn_str6);
            SqlDependency.Start(rn_cnn_str7);

            //SqlDependency.Start(connStringSalesforce);
            //SqlDependency.Start(connStringSalesforce2);
            //SqlDependency.Start(connStringSalesforce3);
            //SqlDependency.Start(connStringSalesforce4);


            IndividualBankInfo = new BankInfo();

            dicMedBillTypes = new Dictionary<int, String>();
            dicMedBillStatus = new Dictionary<int, String>();
            dicPendingReason = new Dictionary<int, String>();
            dicIneligibleReason = new Dictionary<int, String>();

            lstSettlementInfoForApproval = new List<SettlementInfoForApproval>();
            lstLimitedSharingId = new List<int>();
            lstCreateStaff = new List<StaffInfo>();
            lstModifiStaff = new List<StaffInfo>();
            lstCaseInfo = new List<CaseInfo>();
            lstPaymentMethod = new List<PaymentMethod>();
            lstCreditCardInfo = new List<CreditCardInfo>();
            lstMedBillStatusInfo = new List<MedBillStatusInfo>();
            lstSettlementType = new List<SettlementTypeInfo>();
            lstPersonalResponsibilityType = new List<PersonalResponsiblityTypeInfo>();
            lstMedBillNoteTypeInfo = new List<MedBillNoteTypeInfo>();
            lstIneligibleReasonInfo = new List<IneligibleReasonInfo>();

            Illness = new SelectedIllness();
            Incident = new SelectedIncident();
            // Medical Provider list
            lstMedicalProvider = new List<MedicalProviderInfo>();
            lstChurchInfo = new List<ChurchInfo>();
            lstIncidentProgramInfo = new List<IncidentProgramInfo>();

            //strDestinationPath = @"\\cmm-2014u\Sharefolder\" + DateTime.Today.ToString();

            String strSqlQueryForChurchInfo = "select [dbo].[Church].[ID], [dbo].[Church].[Name] from [dbo].[Church]";

            SqlCommand cmdQueryForChurchInfo = new SqlCommand(strSqlQueryForChurchInfo, connSalesforce);

            if (connSalesforce.State != ConnectionState.Closed)
            {
                connSalesforce.Close();
                connSalesforce.Open();
            }
            else if (connSalesforce.State == ConnectionState.Closed) connSalesforce.Open();

            SqlDataReader rdrChurchInfo = cmdQueryForChurchInfo.ExecuteReader();
            if (rdrChurchInfo.HasRows)
            {
                while (rdrChurchInfo.Read())
                {
                    if (!rdrChurchInfo.IsDBNull(0))
                    {
                        lstChurchInfo.Add(new ChurchInfo { ID = rdrChurchInfo.GetString(0), Name = rdrChurchInfo.GetString(1) });
                    }
                }
            }
            rdrChurchInfo.Close();
            if (connSalesforce.State == ConnectionState.Open) connSalesforce.Close();
            ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
            ///

            String strSqlQueryForMedBillTypes = "select [dbo].[tbl_medbill_type].[MedBillTypeId], [dbo].[tbl_medbill_type].[MedBillTypeName] from [dbo].[tbl_medbill_type]";

            SqlCommand cmdQueryForMedBillTypes = new SqlCommand(strSqlQueryForMedBillTypes, connRN);
            cmdQueryForMedBillTypes.CommandType = CommandType.Text;

            //if (connRN.State == ConnectionState.Closed) connRN.Open();
            if (connRN.State != ConnectionState.Closed)
            {
                connRN.Close();
                connRN.Open();
            }
            else if (connRN.State == ConnectionState.Closed) connRN.Open();

            SqlDataReader rdrMedBillTypes = cmdQueryForMedBillTypes.ExecuteReader();
            dicMedBillTypes.Clear();

            if (rdrMedBillTypes.HasRows)
            {
                while (rdrMedBillTypes.Read())
                {
                    if (!rdrMedBillTypes.IsDBNull(0) && !rdrMedBillTypes.IsDBNull(1))
                    {
                        dicMedBillTypes.Add(rdrMedBillTypes.GetInt16(0), rdrMedBillTypes.GetString(1));
                    }
                }
            }
            rdrMedBillTypes.Close();
            if (connRN.State != ConnectionState.Closed) connRN.Close();

            

            

            ////////////////////////////////////////////////////////////////////////////////////////////////////////////
            //String strSqlQueryForMedicalProvider = "select dbo.tbl_MedicalProvider.ID, dbo.tbl_MedicalProvider.Name, dbo.tbl_MedicalProvider.Type from dbo.tbl_MedicalProvider";
            String strSqlQueryForMedicalProvider = "select [dbo].[account].[Id], [dbo].[account].[Name], [dbo].[account].[Type] from [dbo].[account] " +
                                                   "where [dbo].[account].[RecordTypeId] = '01237000000EVmlAAG'";

            SqlCommand cmdQueryForMedicalProvider = new SqlCommand(strSqlQueryForMedicalProvider, connSalesforce);
            cmdQueryForMedicalProvider.CommandType = CommandType.Text;

            //if (connRN.State == ConnectionState.Closed) connRN.Open();
            if (connSalesforce.State != ConnectionState.Closed)
            {
                connSalesforce.Close();
                connSalesforce.Open();
            }
            else if (connSalesforce.State == ConnectionState.Closed) connSalesforce.Open();

            SqlDataReader rdrMedicalProvider = cmdQueryForMedicalProvider.ExecuteReader();

            lstMedicalProvider.Clear();
            if (rdrMedicalProvider.HasRows)
            {
                while (rdrMedicalProvider.Read())
                {
                    MedicalProviderInfo info = new MedicalProviderInfo();

                    if (!rdrMedicalProvider.IsDBNull(0)) info.ID = rdrMedicalProvider.GetString(0);
                    if (!rdrMedicalProvider.IsDBNull(1)) info.Name = rdrMedicalProvider.GetString(1);
                    if (!rdrMedicalProvider.IsDBNull(2)) info.Type = rdrMedicalProvider.GetString(2);

                    lstMedicalProvider.Add(info);
                }
            }
            rdrMedicalProvider.Close();
            if (connSalesforce.State != ConnectionState.Closed) connSalesforce.Close();



            ////////////////////////////////////////////////////////////////////////////////////////////////////////////
            dicMedBillStatus.Clear();

            String strSqlQueryForMedBillStatus = "select [dbo].[tbl_medbill_status_code].[BillStatusCode], [dbo].[tbl_medbill_status_code].[BillStatusValue] " +
                                                 "from [dbo].[tbl_medbill_status_code]";

            SqlCommand cmdQueryForMedBillStatus = new SqlCommand(strSqlQueryForMedBillStatus, connRN);
            cmdQueryForMedBillStatus.CommandType = CommandType.Text;

            if (connRN.State != ConnectionState.Closed)
            {
                connRN.Close();
                connRN.Open();
            }
            else if (connRN.State == ConnectionState.Closed) connRN.Open();

            SqlDataReader rdrMedBillStatus = cmdQueryForMedBillStatus.ExecuteReader();
            if (rdrMedBillStatus.HasRows)
            {
                while (rdrMedBillStatus.Read())
                {
                    dicMedBillStatus.Add(rdrMedBillStatus.GetInt16(0), rdrMedBillStatus.GetString(1));
                }
            }
            rdrMedBillStatus.Close();
            if (connRN.State != ConnectionState.Closed) connRN.Close();

            //String strSqlQueryForMedBillStatusInfo = "select [dbo].[tbl_medbill_status_code].[IsDeleted], [dbo].[tbl_medbill_status_code].[BillStatusCode], " +
            //                                         "[dbo].[tbl_medbill_status_code].[BillStatusValue] " +
            //                                         "from [dbo].[tbl_medbill_status_code]";

            //SqlCommand cmdQueryForMedBillStatusInfo = new SqlCommand(strSqlQueryForMedBillStatusInfo, connRN);
            //cmdQueryForMedBillStatusInfo.CommandType = CommandType.Text;

            //if (connRN.State != ConnectionState.Closed)
            //{
            //    connRN.Close();
            //    connRN.Open();
            //}
            //else if (connRN.State == ConnectionState.Closed) connRN.Open();
            //SqlDataReader rdrMedBillStatusInfo = cmdQueryForMedBillStatusInfo.ExecuteReader();
            //if (rdrMedBillStatusInfo.HasRows)
            //{
            //    while (rdrMedBillStatusInfo.Read())
            //    {
            //        lstMedBillStatusInfo.Add(new MedBillStatusInfo { IsDeleted = rdrMedBillStatusInfo.GetBoolean(0),
            //                                                         BillStatusCode = rdrMedBillStatusInfo.GetInt16(1),
            //                                                         BillStatusValue = rdrMedBillStatus.GetString(2) });
            //    }
            //}
            //rdrMedBillStatusInfo.Close();
            //if (connRN.State != ConnectionState.Closed) connRN.Close();
            //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
            ///
            //String strSqlQueryForMedBillStatusInfo = "select [dbo].[tbl_medbill_status_code].[IsDeleted], [dbo].[tbl_medbill_status_code].[BillStatusCode]"



            //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
            /// Populate Pending Reason
            /// 
            String strSqlQueryForPendingReason = "select [dbo].[tbl_pending_reason].[id], [dbo].[tbl_pending_reason].[name] from [dbo].[tbl_pending_reason] " +
                                                 "order by [dbo].[tbl_pending_reason].[id]";

            SqlCommand cmdQueryForPendingReason = new SqlCommand(strSqlQueryForPendingReason, connRN);
            cmdQueryForPendingReason.CommandType = CommandType.Text;

            if (connRN.State != ConnectionState.Closed)
            {
                connRN.Close();
                connRN.Open();
            }
            else if (connRN.State == ConnectionState.Closed) connRN.Open();

            SqlDataReader rdrPendingReason = cmdQueryForPendingReason.ExecuteReader();
            dicPendingReason.Clear();
            if (rdrPendingReason.HasRows)
            {
                while (rdrPendingReason.Read())
                {
                    if (!rdrPendingReason.IsDBNull(1)) dicPendingReason.Add(rdrPendingReason.GetInt32(0), rdrPendingReason.GetString(1));
                    else dicPendingReason.Add(rdrPendingReason.GetInt32(0), String.Empty);
                }
            }
            rdrPendingReason.Close();
            if (connRN.State != ConnectionState.Closed) connRN.Close();

            /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
            /// Populate Ineligible Reason
            /// 
            String strSqlQueryForIneligibleReason = "select [dbo].[tbl_ineligible_reason].[id], [dbo].[tbl_ineligible_reason].[name] from [dbo].[tbl_ineligible_reason] " +
                                                    "order by [dbo].[tbl_ineligible_reason].[name]";

            SqlCommand cmdQueryForIneligibleReason = new SqlCommand(strSqlQueryForIneligibleReason, connRN);
            cmdQueryForIneligibleReason.CommandType = CommandType.Text;

            //if (connRN.State == ConnectionState.Closed) connRN.Open();
            if (connRN.State != ConnectionState.Closed)
            {
                connRN.Close();
                connRN.Open();
            }
            else if (connRN.State == ConnectionState.Closed) connRN.Open();

            SqlDataReader rdrIneligibleReason = cmdQueryForIneligibleReason.ExecuteReader();
            dicIneligibleReason.Clear();
            if (rdrIneligibleReason.HasRows)
            {
                while (rdrIneligibleReason.Read())
                {
                    if (!rdrIneligibleReason.IsDBNull(1)) dicIneligibleReason.Add(rdrIneligibleReason.GetInt32(0), rdrIneligibleReason.GetString(1));
                    else dicIneligibleReason.Add(rdrIneligibleReason.GetInt32(0), String.Empty);
                }
            }
            rdrIneligibleReason.Close();
            if (connRN.State != ConnectionState.Closed) connRN.Close();

            String strSqlQueryForIneligibleReasonInfo = "select [dbo].[tbl_ineligible_reason].[id], [dbo].[tbl_ineligible_reason].[name] from [dbo].[tbl_ineligible_reason] " +
                                                        "order by [dbo].[tbl_ineligible_reason].[name]";

            SqlCommand cmdQueryForIneligibleReasonInfo = new SqlCommand(strSqlQueryForIneligibleReasonInfo, connRN);
            cmdQueryForIneligibleReasonInfo.CommandType = CommandType.Text;

            if (connRN.State != ConnectionState.Closed)
            {
                connRN.Close();
                connRN.Open();
            }
            else if (connRN.State == ConnectionState.Closed) connRN.Open();
            SqlDataReader rdrIneligibleReasonInfo = cmdQueryForIneligibleReasonInfo.ExecuteReader();
            if (rdrIneligibleReasonInfo.HasRows)
            {
                while (rdrIneligibleReasonInfo.Read())
                {
                    if (!rdrIneligibleReasonInfo.IsDBNull(0) &&
                        !rdrIneligibleReasonInfo.IsDBNull(1))
                        lstIneligibleReasonInfo.Add(new IneligibleReasonInfo
                        {
                            Id = rdrIneligibleReasonInfo.GetInt32(0),
                            IneligibleReason = rdrIneligibleReasonInfo.GetString(1)
                        });
                }
            }
            if (connRN.State != ConnectionState.Closed) connRN.Close();

            lstIneligibleReasonInfo.Sort(delegate (IneligibleReasonInfo info1, IneligibleReasonInfo info2)
            {
                if (info1.IneligibleReason == null && info2.IneligibleReason == null) return 0;
                else if (info1.IneligibleReason == null) return -1;
                else if (info2.IneligibleReason == null) return 1;
                else return info1.IneligibleReason.CompareTo(info2.IneligibleReason);
            });
            
            PersonalResponsibilityAmountInMedBill = 0;

            // Retrieve payment method
            lstPaymentMethod.Clear();
            String strSqlQueryForPaymentMethod = "select [dbo].[tbl_payment_method].[PaymentMethod_Id], [dbo].[tbl_payment_method].[PaymentMethod_Value] from [dbo].[tbl_payment_method] " +
                                                 "order by [dbo].[tbl_payment_method].[PaymentMethod_Value]";

            SqlCommand cmdQueryForPaymentMethod = new SqlCommand(strSqlQueryForPaymentMethod, connRN);
            cmdQueryForPaymentMethod.CommandType = CommandType.Text;

            if (connRN.State != ConnectionState.Closed)
            {
                connRN.Close();
                connRN.Open();
            }
            else if (connRN.State == ConnectionState.Closed) connRN.Open();

            SqlDataReader rdrPaymentMethod = cmdQueryForPaymentMethod.ExecuteReader();
            if (rdrPaymentMethod.HasRows)
            {
                while (rdrPaymentMethod.Read())
                {
                    if (!rdrPaymentMethod.IsDBNull(1)) lstPaymentMethod.Add(new PaymentMethod { PaymentMethodId = rdrPaymentMethod.GetInt16(0), PaymentMethodValue = rdrPaymentMethod.GetString(1) });
                    else lstPaymentMethod.Add(new PaymentMethod { PaymentMethodId = rdrPaymentMethod.GetInt16(0), PaymentMethodValue = String.Empty });
                }
            }

            rdrPaymentMethod.Close();
            if (connRN.State != ConnectionState.Closed) connRN.Close();

            // Retrieve credit card info
            lstCreditCardInfo.Clear();
            String strSqlQueryForCreditCardInfo = "select [dbo].[tbl_Credit_Card__c].[CreditCard_Id], [dbo].[tbl_Credit_Card__c].[Name] from [dbo].[tbl_Credit_Card__c]";

            SqlCommand cmdQueryForCreditCardInfo = new SqlCommand(strSqlQueryForCreditCardInfo, connRN);
            cmdQueryForCreditCardInfo.CommandType = CommandType.Text;

            if (connRN.State != ConnectionState.Closed)
            {
                connRN.Close();
                connRN.Open();
            }
            else if (connRN.State == ConnectionState.Closed) connRN.Open();

            SqlDataReader rdrCreditCardInfo = cmdQueryForCreditCardInfo.ExecuteReader();
            if (rdrCreditCardInfo.HasRows)
            {
                while (rdrCreditCardInfo.Read())
                {
                    if (!rdrCreditCardInfo.IsDBNull(1)) lstCreditCardInfo.Add(new CreditCardInfo { CreditCardId = rdrCreditCardInfo.GetInt16(0), CreditCardNo = rdrCreditCardInfo.GetString(1) });
                    else lstCreditCardInfo.Add(new CreditCardInfo { CreditCardId = rdrCreditCardInfo.GetInt16(0), CreditCardNo = null });
                }
            }
            rdrCreditCardInfo.Close();
            if (connRN.State != ConnectionState.Closed) connRN.Close();


            // retrieve settlement types from data base
            String strSqlQuerySettlementTypes = "select [dbo].[tbl_settlement_type_code].[SettlementTypeCode], [dbo].[tbl_settlement_type_code].[SettlementTypeValue] from [dbo].[tbl_settlement_type_code]";

            SqlCommand cmdQueryForSettlementType = new SqlCommand(strSqlQuerySettlementTypes, connRN);
            cmdQueryForSettlementType.CommandType = CommandType.Text;

            if (connRN.State != ConnectionState.Closed)
            {
                connRN.Close();
                connRN.Open();
            }
            else if (connRN.State == ConnectionState.Closed) connRN.Open();
            SqlDataReader rdrSettlementType = cmdQueryForSettlementType.ExecuteReader();
            lstSettlementType.Clear();
            if (rdrSettlementType.HasRows)
            {
                while (rdrSettlementType.Read())
                {
                    if (!rdrSettlementType.IsDBNull(0) &&
                        !rdrSettlementType.IsDBNull(1))
                        lstSettlementType.Add(new SettlementTypeInfo { SettlementTypeCode = rdrSettlementType.GetInt16(0), SettlementTypeValue = rdrSettlementType.GetString(1) });
                }
            }
            rdrSettlementType.Close();
            if (connRN.State != ConnectionState.Closed) connRN.Close();

            // retrieve personal responsibility types
            // lstPersonalResponsibilityType
            String strSqlQueryForPersonalResponsibilityTypes = "select [dbo].[tbl_personal_responsibility_code].[PersonalResponsibilityTypeCode], " +
                                                               "[dbo].[tbl_personal_responsibility_code].[PersonalResponsibilityTypeValue] " +
                                                               "from [dbo].[tbl_personal_responsibility_code]";

            SqlCommand cmdQueryForPersonalResponsibilityTypes = new SqlCommand(strSqlQueryForPersonalResponsibilityTypes, connRN);
            cmdQueryForPersonalResponsibilityTypes.CommandType = CommandType.Text;

            //if (connRN.State == ConnectionState.Closed) connRN.Open();
            if (connRN.State != ConnectionState.Closed)
            {
                connRN.Close();
                connRN.Open();
            }
            else if (connRN.State == ConnectionState.Closed) connRN.Open();
            SqlDataReader rdrPersonalResponsibilityTypes = cmdQueryForPersonalResponsibilityTypes.ExecuteReader();
            lstPersonalResponsibilityType.Clear();
            if (rdrPersonalResponsibilityTypes.HasRows)
            {
                while (rdrPersonalResponsibilityTypes.Read())
                {
                    if (!rdrPersonalResponsibilityTypes.IsDBNull(0) &&
                        !rdrPersonalResponsibilityTypes.IsDBNull(1))
                        lstPersonalResponsibilityType.Add(new PersonalResponsiblityTypeInfo
                        {
                            PersonalResponsibilityTypeCode = rdrPersonalResponsibilityTypes.GetInt16(0),
                            PersonalResponsibilityTypeValue = rdrPersonalResponsibilityTypes.GetString(1)
                        });
                }
            }
            rdrPersonalResponsibilityTypes.Close();
            if (connRN.State != ConnectionState.Closed) connRN.Close();

            dicLimitedSharing1 = new Dictionary<int, decimal>();
            dicLimitedSharing2 = new Dictionary<int, decimal>();

            String strSqlQueryForLimitedSharing1 = "select [dbo].[tbl_limited_sharing_1].[YearNo], [dbo].[tbl_limited_sharing_1].[YearlyLimit] from [dbo].[tbl_limited_sharing_1]";

            SqlCommand cmdQueryForLimitedSharing1 = new SqlCommand(strSqlQueryForLimitedSharing1, connRNLimitedSharing);
            cmdQueryForLimitedSharing1.CommandType = CommandType.Text;

            if (connRNLimitedSharing.State == ConnectionState.Open)
            {
                connRNLimitedSharing.Close();
                connRNLimitedSharing.Open();
            }
            else if (connRNLimitedSharing.State == ConnectionState.Closed) connRNLimitedSharing.Open();
            SqlDataReader rdrLimitedSharing1 = cmdQueryForLimitedSharing1.ExecuteReader();

            if (rdrLimitedSharing1.HasRows)
            {
                while (rdrLimitedSharing1.Read())
                {
                    dicLimitedSharing1.Add(rdrLimitedSharing1.GetInt16(0), rdrLimitedSharing1.GetDecimal(1));
                }
            }
            rdrLimitedSharing1.Close();
            if (connRNLimitedSharing.State == ConnectionState.Open) connRNLimitedSharing.Close();

            String strSqlQueryForLimitedSharing2 = "select [dbo].[tbl_limited_sharing_2].[YearNo], [dbo].[tbl_limited_sharing_2].[YearlyLimit] from [dbo].[tbl_limited_sharing_2]";

            SqlCommand cmdQueryForLimitedSharing2 = new SqlCommand(strSqlQueryForLimitedSharing2, connRNLimitedSharing);
            cmdQueryForLimitedSharing2.CommandType = CommandType.Text;

            if (connRNLimitedSharing.State == ConnectionState.Open)
            {
                connRNLimitedSharing.Close();
                connRNLimitedSharing.Open();
            }
            else if (connRNLimitedSharing.State == ConnectionState.Closed) connRNLimitedSharing.Open();
            SqlDataReader rdrLimitedSharing2 = cmdQueryForLimitedSharing2.ExecuteReader();

            if (rdrLimitedSharing2.HasRows)
            {
                while (rdrLimitedSharing2.Read())
                {
                    dicLimitedSharing2.Add(rdrLimitedSharing2.GetInt16(0), rdrLimitedSharing2.GetDecimal(1));
                }
            }
            rdrLimitedSharing2.Close();
            if (connRNLimitedSharing.State != ConnectionState.Closed) connRNLimitedSharing.Close();

            // Initialization for BlueSheet
            System.Net.ServicePointManager.SecurityProtocol = System.Net.SecurityProtocolType.Tls12 | System.Net.SecurityProtocolType.Tls11 | System.Net.SecurityProtocolType.Tls;

            ChkInfoEnteredBlueSheet = new CheckInfoBlueSheet();
            ACHInfoEnteredBlueSheet = new ACHInfoBlueSheet();
            CreditCardPaymentEnteredBlueSheet = new CreditCardPaymentInfoBlueSheet();
            PersonalResponsibilityTotalEnteredBlueSheet = new PersonalResponsibilityTotalInfoBlueSheet();

            paidSortedFieldBlueSheet = new SortedFieldBlueSheet();
            cmmPendingPaymentSortedFieldBlueSheet = new SortedFieldBlueSheet();
            pendingSortedFieldBlueSheet = new SortedFieldBlueSheet();
            ineligibleSortedFieldBlueSheet = new SortedFieldBlueSheet();

            paidInPaidTabSortedFieldBlueSheet = new SortedFieldBlueSheet();
            cmmCMMPendingPaymentInTabSortedFieldBlueSheet = new SortedFieldBlueSheet();
            pendingInTabSortedFieldBlueSheet = new SortedFieldBlueSheet();
            ineligibleInTabSortedFieldBlueSheet = new SortedFieldBlueSheet();

            prSortedFieldBlueSheet = new SortedFieldBlueSheet();

            this.StartPosition = FormStartPosition.CenterScreen;
            rbCheckBlueSheet.Checked = true;
            txtCheckNoBlueSheet.Enabled = true;
            dtpCheckIssueDateBlueSheet.Enabled = true;

            rbACHBlueSheet.Checked = false;
            txtACHNoBlueSheet.Enabled = false;
            dtpACHTransactionDateBlueSheet.Enabled = false;

            rbCreditCardBlueSheet.Checked = false;
            txtCreditCardNoBlueSheet.Enabled = false;
            dtpCreditCardPaymentDateBlueSheet.Enabled = false;

            lstPersonalResponsibilityInfoBlueSheet = new List<PersonalResponsibilityInfoBlueSheet>();
            lstSettlementIneligibleInfoBlueSheet = new List<SettlementIneligibleInfoBlueSheet>();

        }

        ~frmCMMManager()
        {
            SqlDependency.Stop(rn_cnn_str);
            SqlDependency.Stop(rn_cnn_str2);
            SqlDependency.Stop(rn_cnn_str3);
            SqlDependency.Stop(rn_cnn_str4);
            SqlDependency.Stop(rn_cnn_str5);
            SqlDependency.Stop(rn_cnn_str6);
            SqlDependency.Stop(rn_cnn_str7);

            //SqlDependency.Stop(connStringSalesforce);
            //SqlDependency.Stop(connStringSalesforce2);
            //SqlDependency.Stop(connStringSalesforce3);
            //SqlDependency.Stop(connStringSalesforce4);

            //dependency.Stop();

        }

        private void InitializedIndividualBankInfo()
        {
            IndividualBankInfo.BankName = String.Empty;
            IndividualBankInfo.BankRoutingNumber = String.Empty;
            IndividualBankInfo.AccountNumber = String.Empty;
            IndividualBankInfo.AccountHolder = String.Empty;
        }

        private void InitializeIndividualInfo()
        {
            txtAccountNo.Text = String.Empty;
            txtAccountHolder.Text = String.Empty;
            txtBankRoutingNo.Text = String.Empty;
            txtBankName.Text = String.Empty;
            txtTotalMedBillAmount.Text = String.Empty;
            rbEnglish.Checked = false;
            rbKorean.Checked = false;
            txtRelationship.Text = String.Empty;
            chkCommunicationEtc.Checked = false;
            chkCommunicationReq.Checked = false;
            chkCommunicationFax.Checked = false;
            chkCommunicationLetter.Checked = false;
            chkCommunicationEmail.Checked = false;
            chkCommunicationCall.Checked = false;
            chkCommunicationAll.Checked = false;
            gvRecentCommunication.Rows.Clear();
            gvFamilyInformation.Rows.Clear();
            gvProcessingCaseNo.Rows.Clear();
            txtWellBeingAmt.Text = String.Empty;
            txtProgramChangeReqDate.Text = String.Empty;
            txtOver10KAmount.Text = String.Empty;
            txtMembershipStartDate.Text = String.Empty;
            txtTotalSharedAmount.Text = String.Empty;
            txtTotalMedBillAmount.Text = String.Empty;
            txtOver10KAmount.Text = String.Empty;
            txtWellBeingAmt.Text = String.Empty;
            txtIndMemberShipStatus.Text = String.Empty;
            txtDeceasedDate.Text = String.Empty;
            txtMembershipCancelledDate.Text = String.Empty;
            txtCancelationRequestDate.Text = String.Empty;
            txtProgramHistory.Text = String.Empty;
            txtProgram.Text = String.Empty;
            txtPowerOfAttorney.Text = String.Empty;
            cbGender.SelectedIndex = -1;
            cbReimbursementMethod.SelectedIndex = -1;
            txtIndChurchName.Text = String.Empty;
            txtBusinessPhone.Text = String.Empty;
            cbPreferredCommunication.SelectedIndex = -1;
            txtCellPhone1.Text = String.Empty;
            txtEmail.Text = String.Empty;
            txtState1.Text = String.Empty;
            txtState2.Text = String.Empty;
            txtCity1.Text = String.Empty;
            txtCity2.Text = String.Empty;
            txtZip1.Text = String.Empty;
            txtZip2.Text = String.Empty;
            txtStreetAddress1.Text = String.Empty;
            txtStreetAddress2.Text = String.Empty;
            txtIndividualSSN.Text = String.Empty;
            txtLastName.Text = String.Empty;
            txtMiddleName.Text = String.Empty;
            txtFirstName.Text = String.Empty;
            txtCRM_ID.Text = String.Empty;
            txtIndividualID.Text = String.Empty;
            txtMembershipID.Text = String.Empty;
        }

        private void InitializeCaseForm()
        {
            cbCaseStatus.Items.Clear();
            txtNoteOnCase.Text = String.Empty;
            txtCaseName.Text = String.Empty;
            //txtPoPUploadDate.Text = String.Empty;
            //txtMRUploadDate.Text = String.Empty;
            //txtOtherDocUploadDate.Text = String.Empty;
            //txtIBUploadDate.Text = String.Empty;
            //txtNPFUploadDate.Text = String.Empty;

            gvCasePageMedBills.Rows.Clear();
            gvNewSupportLog.Rows.Clear();
            gvTaskInCase.Rows.Clear();

            txtOtherDocumentFilePath.Text = String.Empty;
            txtMedicalRecordFilePath.Text = String.Empty;
            txtPopFilePath.Text = String.Empty;
            txtIBFilePath.Text = String.Empty;
            txtNPFFormFilePath.Text = String.Empty;

            chkOtherDocCaseCreationPage.Checked = false;
            chkMedicalRecordCaseCreationPage.Checked = false;
            chkPoP_CaseCreationPage.Checked = false;
            chkIB_CaseCreationPage.Checked = false;
            chkNPF_CaseCreationPage.Checked = false;

            txtCreateCaseIndividualName.Text = String.Empty;
            txtCaseIndividualID.Text = String.Empty;

        }

        private void InitializeMedBillForm()
        {
            txtTotalSharedAmtMedBill.Text = String.Empty;
            txtPersonalResponsibility.Text = String.Empty;

            //dtpMedicalRecordDate.Format = DateTimePickerFormat.Custom;
            //dtpMedicalRecordDate.CustomFormat = " ";

            //dtpHippaSentDate.Format = DateTimePickerFormat.Custom;
            //dtpHippaSentDate.CustomFormat = " ";

            //dtpProposalLetterSentDate.Format = DateTimePickerFormat.Custom;
            //dtpProposalLetterSentDate.CustomFormat = " ";

            txtProviderContactPerson.Text = String.Empty;
            txtMedProviderPhoneNo.Text = String.Empty;
            txtMedBillAccountNoAtProvider.Text = String.Empty;

            gvSettlementsInMedBill.Rows.Clear();

            txtIncdProgram.Text = String.Empty;

            txtMedBill_Incident.Text = String.Empty;
            txtMedBill_Illness.Text = String.Empty;
            txtMedBill_CaseNo.Text = String.Empty;

            rbModified.Checked = false;
            rbDeclined.Checked = false;
            rbAccepted.Checked = false;

            gvUserModifiedDateHistory.Rows.Clear();

            gvMostRecentTasks.Rows.Clear();

            // grpMedicalBillInformation
            //cbMedBillClosed.Items.Clear();
            comboIneligibleReason.Items.Clear();
            comboPendingReason.Items.Clear();
            comboMedBillStatus.Items.Clear();

            txtNumPhysicalTherapy.Text = String.Empty;
            txtNumberOfMedication.Text = String.Empty;
            txtPrescriptionName.Text = String.Empty;
            txtPrescriptionDescription.Text = String.Empty;

            comboMedBillType.Items.Clear();
            txtBalance.Text = String.Empty;
            //dtpDueDate.Format = DateTimePickerFormat.Custom;
            //dtpDueDate.CustomFormat = " ";
            //dtpBillDate.Format = DateTimePickerFormat.Custom;
            //dtpBillDate.CustomFormat = " ";
            txtMedBillAmount.Text = String.Empty;
            txtMedBillNo.Text = String.Empty;
            rbInpatient.Checked = false;
            rbOutpatient.Checked = false;
            txtMedicalProvider.Text = String.Empty;
            txtPhysicalTherapyRxNote.Text = String.Empty;
            txtPrescriptionNote.Text = String.Empty;
            txtMedBillNote.Text = String.Empty;

            chkOtherDocReceived.Checked = false;
            chkMedRecordReceived.Checked = false;
            chkMedBillPOPReceived.Checked = false;
            chkMedBill_IBReceived.Checked = false;
            chkMedBillNPFReceived.Checked = false;

            txtNPFMedBillFileName.Text = String.Empty;
            txtIBMedBillFileName.Text = String.Empty;
            txtPoPMedBillFileName.Text = String.Empty;
            txtMedRecMedBillFileName.Text = String.Empty;
            txtOtherDocMedBillFileName.Text = String.Empty;

            chkNPFMedBill.Checked = false;
            chkIBMedBill.Checked = false;
            chkPoPMedBill.Checked = false;
            chkMedRecMedBill.Checked = false;
            chkOtherDocMedBill.Checked = false;
            //dtpMedBillOtherDoc.Format = DateTimePickerFormat.Custom;
            //dtpMedBillOtherDoc.CustomFormat = " ";
            //dtpMedBillMedRecord.Format = DateTimePickerFormat.Custom;
            //dtpMedBillMedRecord.CustomFormat = " ";
            //dtpMedBillPOP.Format = DateTimePickerFormat.Custom;
            //dtpMedBillPOP.CustomFormat = " ";
            //dtpMedBill_IB.Format = DateTimePickerFormat.Custom;
            //dtpMedBill_IB.CustomFormat = " ";
            //dtpMedBillNPF.Format = DateTimePickerFormat.Custom;
            //dtpMedBillNPF.CustomFormat = " ";

            txtMedBillDiseaseName.Text = String.Empty;
            txtMedBill_ICD10Code.Text = String.Empty;

            // grpPatientInfo
            txtMemberProgram.Text = String.Empty;
            txtMedBillGuarantor.Text = String.Empty;
            txtMedBillAddress.Text = String.Empty;
            txtMedBillSSN.Text = String.Empty;
            txtMedBillDOB.Text = String.Empty;
            txtPatientNameMedBill.Text = String.Empty;
            txtIndividualIDMedBill.Text = String.Empty;

        }

        private void btnClose_Click(object sender, EventArgs e)
        {
            //DialogResult dlgClosing = MessageBox.Show("Do you want to exit?", "Comfirmation", MessageBoxButtons.YesNo);

            //if (dlgClosing == DialogResult.Yes)
            //{
                //String strSqlDeleteCaseInUse = "delete from [dbo].[tbl_CaseInUse] where [dbo].[tbl_CaseInUse].[EditingStaff] = @EditingStaff";

                //SqlCommand cmdDeleteCaseInUse = new SqlCommand(strSqlDeleteCaseInUse, connRN7);
                //cmdDeleteCaseInUse.CommandType = CommandType.Text;

                //cmdDeleteCaseInUse.Parameters.AddWithValue("@EditingStaff", nLoggedUserId);

                //if (connRN7.State != ConnectionState.Closed)
                //{
                //    connRN7.Close();
                //    connRN7.Open();
                //}
                //else if (connRN7.State == ConnectionState.Closed) connRN7.Open();
                //int nCaseInUseDeleted = cmdDeleteCaseInUse.ExecuteNonQuery();
                //if (connRN7.State != ConnectionState.Closed) connRN7.Close();

                //String strSqlDeleteMedBillInUse = "delete from [dbo].[tbl_MedBillInUse] where [dbo].[tbl_MedBillInUse].[EditingStaff] = @EditingStaff";

                //SqlCommand cmdDeleteMedBillInUse = new SqlCommand(strSqlDeleteMedBillInUse, connRN7);
                //cmdDeleteMedBillInUse.CommandType = CommandType.Text;

                //cmdDeleteMedBillInUse.Parameters.AddWithValue("@EditingStaff", nLoggedUserId);

                //if (connRN7.State != ConnectionState.Closed)
                //{
                //    connRN7.Close();
                //    connRN7.Open();
                //}
                //else if (connRN7.State == ConnectionState.Closed) connRN7.Open();
                //int nMedBillInUseDelete = cmdDeleteMedBillInUse.ExecuteNonQuery();
                //if (connRN7.State != ConnectionState.Closed) connRN7.Close();

                Close();
            //}
            //else if (dlgClosing == DialogResult.No)
            //{
            //    return;
            //}
        }



        private void AddRowToMedBillInListSafely(DataGridViewRow row)
        {
            gvMedBillList.BeginInvoke(new AddRowToMedBillInList(AddRowMedBillInList), row);
        }

        private void RemoveRowMedBillInListSafely(int nRow)
        {
            gvMedBillList.BeginInvoke(new RemoveMedBillInList(RemoveRowMedBillInList), nRow);
        }

        private void RemoveAllRowMedBillInListSafely()
        {
            gvMedBillList.BeginInvoke(new RemoveAllMedBillInList(RemoveAllRowMedBillInList));
        }

        private void AddRowMedBillInList(DataGridViewRow row)
        {
            gvMedBillList.Rows.Add(row);
        }

        private void RemoveRowMedBillInList(int i)
        {
            gvMedBillList.Rows.RemoveAt(i);
        }

        private void RemoveAllRowMedBillInList()
        {
            gvMedBillList.Rows.Clear();
        }

        private void OnMedicalBillListChange(object sender, SqlNotificationEventArgs e)
        {
            if (e.Type == SqlNotificationType.Change)
            {
                SqlDependency dependency = sender as SqlDependency;
                dependency.OnChange -= OnMedicalBillListChange;

                UpdateGridViewMedicalBillList();
            }
        }

        private void UpdateGridViewMedicalBillList()
        {
            String IndividualId = IndividualSearched.strIndividualID;

            List<MedicalBillInfoForList> lstMedicalBillInfoForList = new List<MedicalBillInfoForList>();

            String strSqlQueryForMedBillsForIndividual = "select [dbo].[tbl_medbill].[BillNo], [dbo].[tbl_medbill_type].[MedBillTypeName], " +
                                                         "[dbo].[tbl_medbill_status_code].[BillStatusValue], [dbo].[tbl_medbill].[BillClosed], " +
                                                         "[dbo].[tbl_medbill].[CreatedDate], [dbo].[tbl_CreateStaff].[Staff_Name], " +
                                                         "[dbo].[tbl_medbill].[LastModifiedDate], [dbo].[tbl_ModifiStaff].[Staff_Name], " +
                                                         "[dbo].[tbl_medbill].[Case_Id], [dbo].[tbl_illness].[IllnessNo], [dbo].[tbl_illness].[ICD_10_Id], [dbo].[tbl_incident].[IncidentNo], " +
                                                         "[dbo].[tbl_medbill].[BillAmount], [dbo].[tbl_medbill].[Balance], " +
                                                         "[dbo].[tbl_medbill].[SettlementTotal], [dbo].[tbl_medbill].[TotalSharedAmount], " +
                                                         "[dbo].[tbl_medbill].[BillDate], [dbo].[tbl_medbill].[DueDate], " +
                                                         "[dbo].[tbl_medbill].[Guarantor], [dbo].[tbl_medbill].[MedicalProvider_Id], " +
                                                         "[dbo].[tbl_patient_type].[PatientTypeName], [dbo].[tbl_pending_reason].[name], [dbo].[tbl_ineligible_reason].[name], " +
                                                         "[dbo].[tbl_medbill].[PrescriptionDrugName], [dbo].[tbl_medbill].[PrescriptionNo], [dbo].[tbl_medbill].[PrescriptionDescription], " +
                                                         "[dbo].[tbl_medbill].[TotalNumberOfPhysicalTherapy], [dbo].[tbl_medbill].[Note], " +
                                                         "[dbo].[tbl_medbill].[PersonalResponsibilityCredit], " +
                                                         "[dbo].[tbl_medbill].[WellBeingCare], [dbo].[tbl_medbill].[WellBeingCareTotal], " +
                                                         "[dbo].[tbl_medbill].[ProviderPhoneNumber], [dbo].[tbl_medbill].[Account_At_Provider], [dbo].[tbl_medbill].[ProviderContactPerson], " +
                                                         "[dbo].[tbl_medbill].[ProposalLetterSentDate], [dbo].[tbl_medbill].[HIPPASentDate], [dbo].[tbl_medbill].[MedicalRecordDate] " +
                                                         "from [dbo].[tbl_medbill] " +
                                                         "inner join [dbo].[tbl_medbill_type] on [dbo].[tbl_medbill].[MedBillType_Id] = [dbo].[tbl_medbill_type].[MedBillTypeId] " +
                                                         "inner join [dbo].[tbl_medbill_status_code] on [dbo].[tbl_medbill].[BillStatus] = [dbo].[tbl_medbill_status_code].[BillStatusCode] " +
                                                         "inner join [dbo].[tbl_CreateStaff] on [dbo].[tbl_medbill].[CreatedById] = [dbo].[tbl_CreateStaff].[CreateStaff_Id] " +
                                                         "inner join [dbo].[tbl_ModifiStaff] on [dbo].[tbl_medbill].[LastModifiedById] = [dbo].[tbl_ModifiStaff].[ModifiStaff_Id] " +
                                                         "inner join [dbo].[tbl_illness] on [dbo].[tbl_medbill].[Illness_Id] = [dbo].[tbl_illness].[Illness_Id] " +
                                                         "inner join [dbo].[tbl_incident] on [dbo].[tbl_medbill].[Incident_Id] = [dbo].[tbl_incident].[Incident_id] " +
                                                         "inner join [dbo].[tbl_patient_type] on [dbo].[tbl_medbill].[PatientTypeId] = [dbo].[tbl_patient_type].[PatientTypeNo] " +
                                                         "inner join [dbo].[tbl_pending_reason] on [dbo].[tbl_medbill].[PendingReason] = [dbo].[tbl_pending_reason].[ID] " +
                                                         "inner join [dbo].[tbl_ineligible_reason] on [dbo].[tbl_medbill].[IneligibleReason] = [dbo].[tbl_ineligible_reason].[id] " +
                                                         "where [dbo].[tbl_medbill].[Individual_Id] = @IndividualId and " +
                                                         "[dbo].[tbl_medbill].[IsDeleted] = 0";

            SqlCommand cmdQueryForMedBillsForIndividual = new SqlCommand(strSqlQueryForMedBillsForIndividual, connRN);
            cmdQueryForMedBillsForIndividual.CommandType = CommandType.Text;

            cmdQueryForMedBillsForIndividual.Parameters.AddWithValue("@IndividualId", IndividualId);

            SqlDependency dependencyMedicalBill = new SqlDependency(cmdQueryForMedBillsForIndividual);
            dependencyMedicalBill.OnChange += new OnChangeEventHandler(OnMedicalBillListChange);

            if (connRN.State != ConnectionState.Closed)
            {
                connRN.Close();
                connRN.Open();
            }
            else if (connRN.State == ConnectionState.Closed) connRN.Open();

            SqlDataReader rdrMedBillsForIndividual = cmdQueryForMedBillsForIndividual.ExecuteReader();
            if (rdrMedBillsForIndividual.HasRows)
            {
                while (rdrMedBillsForIndividual.Read())
                {
                    MedicalBillInfoForList medbill_info = new MedicalBillInfoForList();

                    if (!rdrMedBillsForIndividual.IsDBNull(0)) medbill_info.MedBillNo = rdrMedBillsForIndividual.GetString(0);
                    if (!rdrMedBillsForIndividual.IsDBNull(1)) medbill_info.MedBillTypeName = rdrMedBillsForIndividual.GetString(1);
                    if (!rdrMedBillsForIndividual.IsDBNull(2)) medbill_info.MedBillStatus = rdrMedBillsForIndividual.GetString(2);
                    if (!rdrMedBillsForIndividual.IsDBNull(3)) medbill_info.bBillClosed = rdrMedBillsForIndividual.GetBoolean(3);
                    if (!rdrMedBillsForIndividual.IsDBNull(4)) medbill_info.CreateDate = rdrMedBillsForIndividual.GetDateTime(4);
                    if (!rdrMedBillsForIndividual.IsDBNull(5)) medbill_info.CreateStaffName = rdrMedBillsForIndividual.GetString(5);
                    if (!rdrMedBillsForIndividual.IsDBNull(6)) medbill_info.LastModifiDate = rdrMedBillsForIndividual.GetDateTime(6);
                    if (!rdrMedBillsForIndividual.IsDBNull(7)) medbill_info.ModifiStaffName = rdrMedBillsForIndividual.GetString(7);
                    if (!rdrMedBillsForIndividual.IsDBNull(8)) medbill_info.CaseId = rdrMedBillsForIndividual.GetString(8);
                    if (!rdrMedBillsForIndividual.IsDBNull(9)) medbill_info.IllnessNo = rdrMedBillsForIndividual.GetString(9);
                    if (!rdrMedBillsForIndividual.IsDBNull(10)) medbill_info.ICD_10_Id = rdrMedBillsForIndividual.GetString(10);
                    if (!rdrMedBillsForIndividual.IsDBNull(11)) medbill_info.IncidentNo = rdrMedBillsForIndividual.GetString(11);
                    if (!rdrMedBillsForIndividual.IsDBNull(12)) medbill_info.BillAmount = rdrMedBillsForIndividual.GetDecimal(12);
                    if (!rdrMedBillsForIndividual.IsDBNull(13)) medbill_info.Balance = rdrMedBillsForIndividual.GetDecimal(13);
                    if (!rdrMedBillsForIndividual.IsDBNull(14)) medbill_info.SettlementTotal = rdrMedBillsForIndividual.GetDecimal(14);
                    if (!rdrMedBillsForIndividual.IsDBNull(15)) medbill_info.TotalSharedAmount = rdrMedBillsForIndividual.GetDecimal(15);
                    if (!rdrMedBillsForIndividual.IsDBNull(16)) medbill_info.BillDate = rdrMedBillsForIndividual.GetDateTime(16);
                    if (!rdrMedBillsForIndividual.IsDBNull(17)) medbill_info.ReceivedDate = rdrMedBillsForIndividual.GetDateTime(17);
                    if (!rdrMedBillsForIndividual.IsDBNull(18)) medbill_info.Guarantor = rdrMedBillsForIndividual.GetString(18);
                    if (!rdrMedBillsForIndividual.IsDBNull(19)) medbill_info.MedicalProviderId = rdrMedBillsForIndividual.GetString(19);
                    if (!rdrMedBillsForIndividual.IsDBNull(20)) medbill_info.PatientTypeName = rdrMedBillsForIndividual.GetString(20);
                    if (!rdrMedBillsForIndividual.IsDBNull(21)) medbill_info.PendingReason = rdrMedBillsForIndividual.GetString(21);
                    if (!rdrMedBillsForIndividual.IsDBNull(22)) medbill_info.IneligibleReason = rdrMedBillsForIndividual.GetString(22);
                    if (!rdrMedBillsForIndividual.IsDBNull(23)) medbill_info.PrescriptionDrugName = rdrMedBillsForIndividual.GetString(23);
                    if (!rdrMedBillsForIndividual.IsDBNull(24)) medbill_info.PrescriptionNo = rdrMedBillsForIndividual.GetString(24);
                    if (!rdrMedBillsForIndividual.IsDBNull(25)) medbill_info.PrescriptionDescription = rdrMedBillsForIndividual.GetString(25);
                    if (!rdrMedBillsForIndividual.IsDBNull(26)) medbill_info.TotalNumberOfPhysicalTherapy = rdrMedBillsForIndividual.GetInt16(26);
                    if (!rdrMedBillsForIndividual.IsDBNull(27)) medbill_info.Note = rdrMedBillsForIndividual.GetString(27);
                    if (!rdrMedBillsForIndividual.IsDBNull(28)) medbill_info.PersonalResponsibilityCredit = rdrMedBillsForIndividual.GetDecimal(28);
                    if (!rdrMedBillsForIndividual.IsDBNull(29)) medbill_info.WellBeingCare = rdrMedBillsForIndividual.GetBoolean(29);
                    if (!rdrMedBillsForIndividual.IsDBNull(30)) medbill_info.WellBeingCareTotal = rdrMedBillsForIndividual.GetDecimal(30);
                    if (!rdrMedBillsForIndividual.IsDBNull(31)) medbill_info.ProviderPhoneNumber = rdrMedBillsForIndividual.GetString(31);
                    if (!rdrMedBillsForIndividual.IsDBNull(32)) medbill_info.AccountNoAtProvider = rdrMedBillsForIndividual.GetString(32);
                    if (!rdrMedBillsForIndividual.IsDBNull(33)) medbill_info.ProviderContactPerson = rdrMedBillsForIndividual.GetString(33);
                    if (!rdrMedBillsForIndividual.IsDBNull(34)) medbill_info.ProposalLetterSentDate = rdrMedBillsForIndividual.GetDateTime(34);
                    if (!rdrMedBillsForIndividual.IsDBNull(35)) medbill_info.HIPPASentDate = rdrMedBillsForIndividual.GetDateTime(35);
                    if (!rdrMedBillsForIndividual.IsDBNull(36)) medbill_info.MedicalRecordDate = rdrMedBillsForIndividual.GetDateTime(36);

                    lstMedicalBillInfoForList.Add(medbill_info);
                }
            }

            rdrMedBillsForIndividual.Close();
            if (connRN.State != ConnectionState.Closed) connRN.Close();

            foreach (MedicalBillInfoForList MedBillInfo in lstMedicalBillInfoForList)
            {
                String strSqlQueryForMedicalProviderName = "select [dbo].[account].[Name] from [dbo].[account] where [dbo].[account].[Id] = @MedicalProviderId";

                SqlCommand cmdQueryForMedicalProviderName = new SqlCommand(strSqlQueryForMedicalProviderName, connSalesforce3);
                cmdQueryForMedicalProviderName.CommandType = CommandType.Text;

                cmdQueryForMedicalProviderName.Parameters.AddWithValue("@MedicalProviderId", MedBillInfo.MedicalProviderId);

                if (connSalesforce3.State != ConnectionState.Closed)
                {
                    connSalesforce3.Close();
                    connSalesforce3.Open();
                }
                else if (connSalesforce3.State == ConnectionState.Closed) connSalesforce3.Open();
                Object objMedicalProviderName = cmdQueryForMedicalProviderName.ExecuteScalar();
                if (connSalesforce3.State != ConnectionState.Closed) connSalesforce3.Close();

                if (objMedicalProviderName != null) MedBillInfo.MedicalProviderName = objMedicalProviderName.ToString();
            }

            if (IsHandleCreated) RemoveAllRowMedBillInListSafely();
            else gvMedBillList.Rows.Clear();

            foreach (MedicalBillInfoForList medbill_info in lstMedicalBillInfoForList)
            {
                DataGridViewRow row = new DataGridViewRow();
                row.Cells.Add(new DataGridViewTextBoxCell { Value = medbill_info.MedBillNo });
                row.Cells.Add(new DataGridViewTextBoxCell { Value = medbill_info.MedBillTypeName });
                row.Cells.Add(new DataGridViewTextBoxCell { Value = medbill_info.MedBillStatus });
                row.Cells.Add(new DataGridViewCheckBoxCell { Value = medbill_info.bBillClosed });
                row.Cells.Add(new DataGridViewTextBoxCell { Value = medbill_info.CreateDate.Value.ToString("MM/dd/yyyy") });
                row.Cells.Add(new DataGridViewTextBoxCell { Value = medbill_info.CreateStaffName });
                row.Cells.Add(new DataGridViewTextBoxCell { Value = medbill_info.LastModifiDate.Value.ToString("MM/dd/yyyy") });
                row.Cells.Add(new DataGridViewTextBoxCell { Value = medbill_info.ModifiStaffName });
                row.Cells.Add(new DataGridViewTextBoxCell { Value = medbill_info.CaseId });
                row.Cells.Add(new DataGridViewTextBoxCell { Value = medbill_info.IllnessNo });
                row.Cells.Add(new DataGridViewTextBoxCell { Value = medbill_info.ICD_10_Id });
                row.Cells.Add(new DataGridViewTextBoxCell { Value = medbill_info.IncidentNo });
                row.Cells.Add(new DataGridViewTextBoxCell { Value = medbill_info.BillAmount.ToString("C") });
                row.Cells.Add(new DataGridViewTextBoxCell { Value = medbill_info.Balance.ToString("C") });
                row.Cells.Add(new DataGridViewTextBoxCell { Value = medbill_info.SettlementTotal.ToString("C") });
                row.Cells.Add(new DataGridViewTextBoxCell { Value = medbill_info.TotalSharedAmount.ToString("C") });
                row.Cells.Add(new DataGridViewTextBoxCell { Value = medbill_info.BillDate.Value.ToString("MM/dd/yyyy") });
                row.Cells.Add(new DataGridViewTextBoxCell { Value = medbill_info.ReceivedDate.Value.ToString("MM/dd/yyyy") });
                row.Cells.Add(new DataGridViewTextBoxCell { Value = medbill_info.Guarantor });
                row.Cells.Add(new DataGridViewTextBoxCell { Value = medbill_info.MedicalProviderName });
                row.Cells.Add(new DataGridViewTextBoxCell { Value = medbill_info.PatientTypeName });
                row.Cells.Add(new DataGridViewTextBoxCell { Value = medbill_info.PendingReason });
                row.Cells.Add(new DataGridViewTextBoxCell { Value = medbill_info.IneligibleReason });
                row.Cells.Add(new DataGridViewTextBoxCell { Value = medbill_info.PrescriptionDrugName });
                row.Cells.Add(new DataGridViewTextBoxCell { Value = medbill_info.PrescriptionNo });
                row.Cells.Add(new DataGridViewTextBoxCell { Value = medbill_info.PrescriptionDescription });
                row.Cells.Add(new DataGridViewTextBoxCell { Value = medbill_info.TotalNumberOfPhysicalTherapy });
                row.Cells.Add(new DataGridViewTextBoxCell { Value = medbill_info.Note });
                row.Cells.Add(new DataGridViewTextBoxCell { Value = medbill_info.PersonalResponsibilityCredit.ToString("C") });
                row.Cells.Add(new DataGridViewCheckBoxCell { Value = medbill_info.WellBeingCare });
                row.Cells.Add(new DataGridViewTextBoxCell { Value = medbill_info.WellBeingCareTotal.ToString("C") });
                row.Cells.Add(new DataGridViewTextBoxCell { Value = medbill_info.ProviderPhoneNumber });
                row.Cells.Add(new DataGridViewTextBoxCell { Value = medbill_info.AccountNoAtProvider });
                row.Cells.Add(new DataGridViewTextBoxCell { Value = medbill_info.ProviderContactPerson });
                row.Cells.Add(new DataGridViewTextBoxCell { Value = medbill_info.ProposalLetterSentDate.Value.ToString("MM/dd/yyyy") });
                row.Cells.Add(new DataGridViewTextBoxCell { Value = medbill_info.HIPPASentDate.Value.ToString("MM/dd/yyyy") });
                row.Cells.Add(new DataGridViewTextBoxCell { Value = medbill_info.MedicalRecordDate.Value.ToString("MM/dd/yyyy") });

                if (IsHandleCreated) AddRowToMedBillInListSafely(row);
                else gvMedBillList.Rows.Add(row);

            }

        }

        private void AddRowToCheckPaymentToProviderSafely(DataGridViewRow row)
        {
            gvPaymentCheckProvider.BeginInvoke(new AddRowToCheckPaymentToProvider(AddRowCheckPaymentToPrivder), row);
        }

        private void RemoveRowCheckPaymentToProviderSafely(int nRow)
        {
            gvPaymentCheckProvider.BeginInvoke(new RemoveCheckPaymentToProvider(RemoveRowCheckPaymentToProvider), nRow);
        }

        private void RemoveAllRowCheckPaymentToProviderSafely()
        {
            gvPaymentCheckProvider.BeginInvoke(new RemoveAllCheckPaymentToProvider(RemoveAllRowCheckPaymentToProvider));
        }


        private void AddRowCheckPaymentToPrivder(DataGridViewRow row)
        {
            gvPaymentCheckProvider.Rows.Add(row);
        }

        private void RemoveRowCheckPaymentToProvider(int i)
        {
            gvPaymentCheckProvider.Rows.RemoveAt(i);
        }

        private void RemoveAllRowCheckPaymentToProvider()
        {
            gvPaymentCheckProvider.Rows.Clear();
        }

        private void OnCheckPaymentToProviderChange(object sender, SqlNotificationEventArgs e)
        {
            if (e.Type == SqlNotificationType.Change)
            {
                SqlDependency dependency = sender as SqlDependency;
                dependency.OnChange -= OnCheckPaymentToProviderChange;

                UpdateGridViewCheckPaymentToProvider();
            }
        }

        private void UpdateGridViewCheckPaymentToProvider()
        {
            //String strSqlQueryForCheckPaymentToProvider = "select [dbo].[tbl_settlement].[IsPaid], [dbo].[tbl_medbill].[Individual_Id], [dbo].[tbl_incident].[IncidentNo], " +
            //                                "[dbo].[tbl_program].[ProgramName], [dbo].[tbl_medbill].[BillDate], " +
            //                                "[dbo].[tbl_settlement].[Name], [dbo].[tbl_settlement].[Amount], [dbo].[tbl_medbill].[MedicalProvider_Id], " +
            //                                "[dbo].[tbl_settlement_type_code].[SettlementTypeValue], " +
            //                                "[dbo].[tbl_CreateStaff].[Staff_Name], [dbo].[tbl_ModifiStaff].[Staff_Name], " +
            //                                "[dbo].[tbl_medbill].[Account_At_Provider], [dbo].[tbl_settlement].[IsCheckExported], [dbo].[tbl_settlement].[CheckExportedByID] " +
            //                                "from [dbo].[tbl_settlement] " +
            //                                "inner join [dbo].[tbl_medbill] on [dbo].[tbl_settlement].[MedicalBillID] = [dbo].[tbl_medbill].[BillNo] " +
            //                                "inner join [dbo].[tbl_incident] on [dbo].[tbl_medbill].[Incident_Id] = [dbo].[tbl_incident].[Incident_id] " +
            //                                "inner join [dbo].[tbl_program] on [dbo].[tbl_incident].[Program_id] = [dbo].[tbl_program].[Program_Id] " +
            //                                "inner join [dbo].[tbl_settlement_type_code] on [dbo].[tbl_settlement].[SettlementType] = [dbo].[tbl_settlement_type_code].[SettlementTypeCode] " +
            //                                "inner join [dbo].[tbl_CreateStaff] on [dbo].[tbl_settlement].[CreateByID] = [dbo].[tbl_CreateStaff].[CreateStaff_Id] " +
            //                                "inner join [dbo].[tbl_ModifiStaff] on [dbo].[tbl_settlement].[LastModifiedByID] = [dbo].[tbl_ModifiStaff].[ModifiStaff_Id] " +
            //                                "where ([dbo].[tbl_settlement].[IsPaid] = 0 or [RN_DB].[dbo].[tbl_settlement].[IsPaid] IS NULL) and " +
            //                                "[dbo].[tbl_settlement].[PaidByID] IS NULL and " +
            //                                "[dbo].[tbl_settlement].[IsDeleted] = 0 and " +
            //                                "[dbo].[tbl_settlement].[SettlementType] = 4 and " +
            //                                "[dbo].[tbl_settlement].[CMMPaymentMethod] = 1 and " +
            //                                "[dbo].[tbl_settlement].[Approved] = 1 and " +
            //                                "[dbo].[tbl_settlement].[ApprovedDate] IS NOT NULL and " +
            //                                "[dbo].[tbl_settlement].[CheckNo] IS NULL and " +
            //                                "[dbo].[tbl_settlement].[CheckDate] IS NULL and " +
            //                                "[dbo].[tbl_settlement].[CheckReconciled] = 0 " +
            //                                "order by [dbo].[tbl_medbill].[Individual_Id]";

            String strSqlQueryForCheckPaymentToProvider = "select [dbo].[tbl_settlement].[IsPaid], [dbo].[tbl_medbill].[Individual_Id], [dbo].[tbl_incident].[IncidentNo], " +
                                "[dbo].[tbl_program].[ProgramName], [dbo].[tbl_medbill].[BillDate], " +
                                "[dbo].[tbl_settlement].[Name], [dbo].[tbl_settlement].[Amount], [dbo].[tbl_medbill].[MedicalProvider_Id], " +
                                "[dbo].[tbl_settlement_type_code].[SettlementTypeValue], " +
                                "[dbo].[tbl_CreateStaff].[Staff_Name], [dbo].[tbl_ModifiStaff].[Staff_Name], " +
                                "[dbo].[tbl_medbill].[Account_At_Provider], [dbo].[tbl_settlement].[IsCheckExported], [dbo].[tbl_settlement].[CheckExportedByID] " +
                                "from [dbo].[tbl_settlement] " +
                                "inner join [dbo].[tbl_medbill] on [dbo].[tbl_settlement].[MedicalBillID] = [dbo].[tbl_medbill].[BillNo] " +
                                "inner join [dbo].[tbl_incident] on [dbo].[tbl_medbill].[Incident_Id] = [dbo].[tbl_incident].[Incident_id] " +
                                "inner join [dbo].[tbl_program] on [dbo].[tbl_incident].[Program_id] = [dbo].[tbl_program].[Program_Id] " +
                                "inner join [dbo].[tbl_settlement_type_code] on [dbo].[tbl_settlement].[SettlementType] = [dbo].[tbl_settlement_type_code].[SettlementTypeCode] " +
                                "inner join [dbo].[tbl_CreateStaff] on [dbo].[tbl_settlement].[CreateByID] = [dbo].[tbl_CreateStaff].[CreateStaff_Id] " +
                                "inner join [dbo].[tbl_ModifiStaff] on [dbo].[tbl_settlement].[LastModifiedByID] = [dbo].[tbl_ModifiStaff].[ModifiStaff_Id] " +
                                "where ([dbo].[tbl_settlement].[IsPaid] = 0 or [RN_DB].[dbo].[tbl_settlement].[IsPaid] IS NULL) and " +
                                "[dbo].[tbl_settlement].[PaidByID] IS NULL and " +
                                "[dbo].[tbl_settlement].[IsDeleted] = 0 and " +
                                "[dbo].[tbl_settlement].[SettlementType] = 4 and " +
                                "[dbo].[tbl_settlement].[CMMPaymentMethod] = 1 and " +
                                "[dbo].[tbl_settlement].[Approved] = 1 and " +
                                "([dbo].[tbl_settlement].[ApprovedDate] IS NOT NULL or [dbo].[tbl_settlement].[ApprovedDate] <> '') and " +
                                "([dbo].[tbl_settlement].[CheckNo] IS NULL or [dbo].[tbl_settlement].[CheckNo] = '') and " +
                                "([dbo].[tbl_settlement].[CheckDate] IS NULL or [dbo].[tbl_settlement].[CheckDate] = '') and " +
                                "[dbo].[tbl_settlement].[CheckReconciled] = 0";

            SqlCommand cmdQueryForCheckPaymentToProvider = new SqlCommand(strSqlQueryForCheckPaymentToProvider, connRN);
            cmdQueryForCheckPaymentToProvider.CommandType = CommandType.Text;

            SqlDependency dependencyCheckPaymentToProvider = new SqlDependency(cmdQueryForCheckPaymentToProvider);
            dependencyCheckPaymentToProvider.OnChange += new OnChangeEventHandler(OnCheckPaymentToProviderChange);

            if (connRN.State != ConnectionState.Closed)
            {
                connRN.Close();
                connRN.Open();
            }
            else if (connRN.State == ConnectionState.Closed) connRN.Open();
            //gvPaymentCheckProvider.Rows.Clear();
            List<CheckPaymentInfo> lstCheckPaymentToProviderInfo = new List<CheckPaymentInfo>();
            SqlDataReader rdrCheckPaymentToProvider = cmdQueryForCheckPaymentToProvider.ExecuteReader();
            if (rdrCheckPaymentToProvider.HasRows)
            {
                while (rdrCheckPaymentToProvider.Read())
                {
                    CheckPaymentInfo infoCheckPaymentToProvider = new CheckPaymentInfo();
                    if (!rdrCheckPaymentToProvider.IsDBNull(0)) infoCheckPaymentToProvider.bIsPaid = rdrCheckPaymentToProvider.GetBoolean(0);
                    if (!rdrCheckPaymentToProvider.IsDBNull(1)) infoCheckPaymentToProvider.IndividualId = rdrCheckPaymentToProvider.GetString(1);
                    if (!rdrCheckPaymentToProvider.IsDBNull(2)) infoCheckPaymentToProvider.IncidentNo = rdrCheckPaymentToProvider.GetString(2);
                    if (!rdrCheckPaymentToProvider.IsDBNull(3)) infoCheckPaymentToProvider.IncidentProgram = rdrCheckPaymentToProvider.GetString(3);
                    if (!rdrCheckPaymentToProvider.IsDBNull(4)) infoCheckPaymentToProvider.ServiceDate = rdrCheckPaymentToProvider.GetDateTime(4);
                    if (!rdrCheckPaymentToProvider.IsDBNull(5)) infoCheckPaymentToProvider.SettlementNo = rdrCheckPaymentToProvider.GetString(5);
                    if (!rdrCheckPaymentToProvider.IsDBNull(6)) infoCheckPaymentToProvider.SettlementAmount = rdrCheckPaymentToProvider.GetDecimal(6);
                    if (!rdrCheckPaymentToProvider.IsDBNull(7)) infoCheckPaymentToProvider.MedicalProviderId = rdrCheckPaymentToProvider.GetString(7);
                    if (!rdrCheckPaymentToProvider.IsDBNull(8)) infoCheckPaymentToProvider.SettlementType = rdrCheckPaymentToProvider.GetString(8);
                    if (!rdrCheckPaymentToProvider.IsDBNull(9)) infoCheckPaymentToProvider.CreatedBy = rdrCheckPaymentToProvider.GetString(9);
                    if (!rdrCheckPaymentToProvider.IsDBNull(10)) infoCheckPaymentToProvider.LastModifiedBy = rdrCheckPaymentToProvider.GetString(10);
                    if (!rdrCheckPaymentToProvider.IsDBNull(11)) infoCheckPaymentToProvider.AccountNoAtMedProvider = rdrCheckPaymentToProvider.GetString(11);
                    if (!rdrCheckPaymentToProvider.IsDBNull(12)) infoCheckPaymentToProvider.bIsExported = rdrCheckPaymentToProvider.GetBoolean(12);
                    if (!rdrCheckPaymentToProvider.IsDBNull(13)) infoCheckPaymentToProvider.nExportedByID = rdrCheckPaymentToProvider.GetInt16(13);

                    lstCheckPaymentToProviderInfo.Add(infoCheckPaymentToProvider);
                }
            }
            rdrCheckPaymentToProvider.Close();
            if (connRN.State != ConnectionState.Closed) connRN.Close();

            foreach (CheckPaymentInfo info in lstCheckPaymentToProviderInfo)
            {
                String strSqlQueryForMedicalProviderName = "select [dbo].[account].[Name] from [dbo].[account] where [dbo].[account].[Id] = @MedicalProviderId";

                SqlCommand cmdQueryForMedicalProviderName = new SqlCommand(strSqlQueryForMedicalProviderName, connSalesforce);
                cmdQueryForMedicalProviderName.CommandType = CommandType.Text;

                cmdQueryForMedicalProviderName.Parameters.AddWithValue("@MedicalProviderId", info.MedicalProviderId);

                if (connSalesforce.State != ConnectionState.Closed)
                {
                    connSalesforce.Close();
                    connSalesforce.Open();
                }
                else if (connSalesforce.State == ConnectionState.Closed) connSalesforce.Open();
                Object objMedicalProviderName = cmdQueryForMedicalProviderName.ExecuteScalar();
                if (connSalesforce.State == ConnectionState.Open) connSalesforce.Close();

                String MedicalProviderName = String.Empty;
                if (objMedicalProviderName != null) MedicalProviderName = objMedicalProviderName.ToString();

                info.MedicalProviderName = MedicalProviderName;
            }

            foreach (CheckPaymentInfo info in lstCheckPaymentToProviderInfo)
            {
                String strSqlQueryForIndividualInfoForProviderCheckPayment = "select [dbo].[contact].[Name], [dbo].[contact].[Household_Role__c], " +
                                                                     "[dbo].[contact].[Primary_Name__c], " +
                                                                     "[dbo].[account].[SHIPPINGSTREET], [dbo].[account].[SHIPPINGCITY], " +
                                                                     "[dbo].[account].[SHIPPINGSTATE], [dbo].[account].[SHIPPINGPOSTALCODE], " +
                                                                     "[dbo].[contact].[c4g_Membership_Status__c], [dbo].[contact].[Membership_Number__c] " +
                                                                     "from [dbo].[contact] " +
                                                                     "inner join [dbo].[program] on [dbo].[contact].[c4g_Plan__c] = [dbo].[program].[ID] " +
                                                                     "inner join [dbo].[account] on [dbo].[contact].[AccountId] = [dbo].[account].[ID] " +
                                                                     "where [dbo].[contact].[Individual_ID__c] = @IndividualId";

                SqlCommand cmdQueryForIndividualInfoForCheckPaymentToProvider = new SqlCommand(strSqlQueryForIndividualInfoForProviderCheckPayment, connSalesforce);
                cmdQueryForIndividualInfoForCheckPaymentToProvider.CommandType = CommandType.Text;

                cmdQueryForIndividualInfoForCheckPaymentToProvider.Parameters.AddWithValue("@IndividualId", info.IndividualId);

                if (connSalesforce.State != ConnectionState.Closed)
                {
                    connSalesforce.Close();
                    connSalesforce.Open();
                }
                else if (connSalesforce.State == ConnectionState.Closed) connSalesforce.Open();
                SqlDataReader rdrIndividualInfoForCheckPaymentToProvider = cmdQueryForIndividualInfoForCheckPaymentToProvider.ExecuteReader();
                if (rdrIndividualInfoForCheckPaymentToProvider.HasRows)
                {
                    rdrIndividualInfoForCheckPaymentToProvider.Read();

                    if (!rdrIndividualInfoForCheckPaymentToProvider.IsDBNull(0)) info.IndividualName = rdrIndividualInfoForCheckPaymentToProvider.GetString(0);
                    if (!rdrIndividualInfoForCheckPaymentToProvider.IsDBNull(1)) info.HouseholdRole = rdrIndividualInfoForCheckPaymentToProvider.GetString(1);
                    if (!rdrIndividualInfoForCheckPaymentToProvider.IsDBNull(2)) info.PrimaryName = rdrIndividualInfoForCheckPaymentToProvider.GetString(2);
                    if (!rdrIndividualInfoForCheckPaymentToProvider.IsDBNull(3)) info.ShippingStreet = rdrIndividualInfoForCheckPaymentToProvider.GetString(3);
                    if (!rdrIndividualInfoForCheckPaymentToProvider.IsDBNull(4)) info.ShippingCity = rdrIndividualInfoForCheckPaymentToProvider.GetString(4);
                    if (!rdrIndividualInfoForCheckPaymentToProvider.IsDBNull(5)) info.ShippingState = rdrIndividualInfoForCheckPaymentToProvider.GetString(5);
                    if (!rdrIndividualInfoForCheckPaymentToProvider.IsDBNull(6)) info.ShippingZip = rdrIndividualInfoForCheckPaymentToProvider.GetString(6);
                    if (!rdrIndividualInfoForCheckPaymentToProvider.IsDBNull(7)) info.MembershipStatus = rdrIndividualInfoForCheckPaymentToProvider.GetString(7);
                    if (!rdrIndividualInfoForCheckPaymentToProvider.IsDBNull(8)) info.MemebershipNo = rdrIndividualInfoForCheckPaymentToProvider.GetString(8);

                }
                rdrIndividualInfoForCheckPaymentToProvider.Close();
                if (connSalesforce.State == ConnectionState.Open) connSalesforce.Close();
            }

            if (IsHandleCreated) RemoveAllRowCheckPaymentToProviderSafely();
            else gvPaymentCheckProvider.Rows.Clear();

            foreach (CheckPaymentInfo info in lstCheckPaymentToProviderInfo)
            {
                DataGridViewRow row = new DataGridViewRow();
                row.Cells.Add(new DataGridViewCheckBoxCell { Value = false });
                row.Cells.Add(new DataGridViewCheckBoxCell { Value = info.bIsExported });
                row.Cells.Add(new DataGridViewTextBoxCell { Value = info.IndividualName });
                row.Cells[1].ReadOnly = true;
                row.Cells.Add(new DataGridViewTextBoxCell { Value = info.IndividualId });
                row.Cells[2].ReadOnly = true;
                row.Cells.Add(new DataGridViewTextBoxCell { Value = info.HouseholdRole });
                row.Cells[3].ReadOnly = true;
                row.Cells.Add(new DataGridViewTextBoxCell { Value = info.PrimaryName });
                row.Cells[4].ReadOnly = true;
                row.Cells.Add(new DataGridViewTextBoxCell { Value = info.IncidentNo });
                row.Cells[5].ReadOnly = true;
                row.Cells.Add(new DataGridViewTextBoxCell { Value = info.IncidentProgram });
                row.Cells[6].ReadOnly = true;
                row.Cells.Add(new DataGridViewTextBoxCell { Value = info.SettlementNo });
                row.Cells[7].ReadOnly = true;
                row.Cells.Add(new DataGridViewTextBoxCell { Value = info.SettlementAmount.ToString("C") });
                row.Cells[8].ReadOnly = true;
                row.Cells[8].Style.Alignment = DataGridViewContentAlignment.MiddleRight;
                row.Cells.Add(new DataGridViewTextBoxCell { Value = info.ServiceDate.Value.ToString("MM/dd/yyyy") });
                row.Cells[9].ReadOnly = true;
                row.Cells.Add(new DataGridViewTextBoxCell { Value = info.MedicalProviderName });
                row.Cells[10].ReadOnly = true;
                row.Cells.Add(new DataGridViewTextBoxCell { Value = info.AccountNoAtMedProvider });
                row.Cells[11].ReadOnly = true;
                row.Cells.Add(new DataGridViewTextBoxCell { Value = info.ShippingStreet });
                row.Cells[12].ReadOnly = true;
                row.Cells.Add(new DataGridViewTextBoxCell { Value = info.ShippingCity });
                row.Cells[13].ReadOnly = true;
                row.Cells.Add(new DataGridViewTextBoxCell { Value = info.ShippingState });
                row.Cells[14].ReadOnly = true;
                row.Cells.Add(new DataGridViewTextBoxCell { Value = info.ShippingZip });
                row.Cells[15].ReadOnly = true;
                row.Cells.Add(new DataGridViewTextBoxCell { Value = info.SettlementType });
                row.Cells[16].ReadOnly = true;
                row.Cells.Add(new DataGridViewTextBoxCell { Value = info.CreatedBy });
                row.Cells[17].ReadOnly = true;
                row.Cells.Add(new DataGridViewTextBoxCell { Value = info.LastModifiedBy });
                row.Cells[18].ReadOnly = true;
                row.Cells.Add(new DataGridViewTextBoxCell { Value = info.MembershipStatus });
                row.Cells[19].ReadOnly = true;
                row.Cells.Add(new DataGridViewTextBoxCell { Value = info.MemebershipNo });
                row.Cells[20].ReadOnly = true;

                if (IsHandleCreated) AddRowToCheckPaymentToProviderSafely(row);
                else gvPaymentCheckProvider.Rows.Add(row);
            }
        }

        private void AddRowToCheckPaymentSafely(DataGridViewRow row)
        {
            gvPaymentCheckMemberReimbursement.BeginInvoke(new AddRowToCheckPayment(AddRowPaymentCheck), row);
        }

        private void RemoveRowCheckPaymentSafely(int nRow)
        {
            gvPaymentCheckMemberReimbursement.BeginInvoke(new RemoveACHPayment(RemoveRowPaymentCheck), nRow);
        }

        private void RemoveAllRowCheckPaymentSafely()
        {
            gvPaymentCheckMemberReimbursement.BeginInvoke(new RemoveAllCheckPayment(RemoveAllRowPaymentCheck));
        }

        private void AddRowPaymentCheck(DataGridViewRow row)
        {
            gvPaymentCheckMemberReimbursement.Rows.Add(row);
        }

        private void RemoveRowPaymentCheck(int i)
        {
            gvPaymentCheckMemberReimbursement.Rows.RemoveAt(i);
        }

        private void RemoveAllRowPaymentCheck()
        {
            gvPaymentCheckMemberReimbursement.Rows.Clear();
        }

        private void OnCheckPaymentChange(object sender, SqlNotificationEventArgs e)
        {
            if (e.Type == SqlNotificationType.Change)
            {
                SqlDependency dependency = sender as SqlDependency;
                dependency.OnChange -= OnCheckPaymentChange;

                UpdateGridViewCheckPayment();
            }
        }

        private void UpdateGridViewCheckPayment()
        {

            //String strSqlQueryForCheckPayment = "select [dbo].[tbl_settlement].[IsPaid], [dbo].[tbl_medbill].[Individual_Id], [dbo].[tbl_incident].[IncidentNo], " +
            //                                    "[dbo].[tbl_program].[ProgramName], [dbo].[tbl_medbill].[BillDate], " +
            //                                    "[dbo].[tbl_settlement].[Name], [dbo].[tbl_settlement].[Amount], [dbo].[tbl_medbill].[MedicalProvider_Id], " +
            //                                    "[dbo].[tbl_settlement_type_code].[SettlementTypeValue], " +
            //                                    "[dbo].[tbl_CreateStaff].[Staff_Name], [dbo].[tbl_ModifiStaff].[Staff_Name], " +
            //                                    "[dbo].[tbl_medbill].[Account_At_Provider], [dbo].[tbl_settlement].[IsCheckExported], [dbo].[tbl_settlement].[CheckExportedByID] " +
            //                                    "from [dbo].[tbl_settlement] " +
            //                                    "inner join [dbo].[tbl_medbill] on [dbo].[tbl_settlement].[MedicalBillID] = [dbo].[tbl_medbill].[BillNo] " +
            //                                    "inner join [dbo].[tbl_incident] on [dbo].[tbl_medbill].[Incident_Id] = [dbo].[tbl_incident].[Incident_id] " +
            //                                    "inner join [dbo].[tbl_program] on [dbo].[tbl_incident].[Program_id] = [dbo].[tbl_program].[Program_Id] " +
            //                                    "inner join [dbo].[tbl_settlement_type_code] on [dbo].[tbl_settlement].[SettlementType] = [dbo].[tbl_settlement_type_code].[SettlementTypeCode] " +
            //                                    "inner join [dbo].[tbl_CreateStaff] on [dbo].[tbl_settlement].[CreateByID] = [dbo].[tbl_CreateStaff].[CreateStaff_Id] " +
            //                                    "inner join [dbo].[tbl_ModifiStaff] on [dbo].[tbl_settlement].[LastModifiedByID] = [dbo].[tbl_ModifiStaff].[ModifiStaff_Id] " +
            //                                    "where ([dbo].[tbl_settlement].[IsPaid] = 0 or [RN_DB].[dbo].[tbl_settlement].[IsPaid] IS NULL) and " +
            //                                    "[dbo].[tbl_settlement].[PaidByID] IS NULL and " +
            //                                    "[dbo].[tbl_settlement].[IsDeleted] = 0 and " +
            //                                    "([dbo].[tbl_settlement].[SettlementType] = 6 or " +
            //                                    "[dbo].[tbl_settlement].[SettlementType] = 9) and " +
            //                                    "[dbo].[tbl_settlement].[CMMPaymentMethod] = 1 and " +
            //                                    "[dbo].[tbl_settlement].[Approved] = 1 and " +
            //                                    "[dbo].[tbl_settlement].[ApprovedDate] IS NOT NULL and " +
            //                                    "[dbo].[tbl_settlement].[CheckNo] IS NULL and " +
            //                                    "[dbo].[tbl_settlement].[CheckDate] IS NULL and " +
            //                                    "[dbo].[tbl_settlement].[CheckReconciled] = 0 " +
            //                                    "order by [dbo].[tbl_medbill].[Individual_Id]";


            String strSqlQueryForCheckPayment = "select [dbo].[tbl_settlement].[IsPaid], [dbo].[tbl_medbill].[Individual_Id], [dbo].[tbl_incident].[IncidentNo], " +
                                                    "[dbo].[tbl_program].[ProgramName], [dbo].[tbl_medbill].[BillDate], " +
                                                    "[dbo].[tbl_settlement].[Name], [dbo].[tbl_settlement].[Amount], [dbo].[tbl_medbill].[MedicalProvider_Id], " +
                                                    "[dbo].[tbl_settlement_type_code].[SettlementTypeValue], " +
                                                    "[dbo].[tbl_CreateStaff].[Staff_Name], [dbo].[tbl_ModifiStaff].[Staff_Name], " +
                                                    "[dbo].[tbl_medbill].[Account_At_Provider], [dbo].[tbl_settlement].[IsCheckExported], [dbo].[tbl_settlement].[CheckExportedByID] " +
                                                    "from [dbo].[tbl_settlement] " +
                                                    "inner join [dbo].[tbl_medbill] on [dbo].[tbl_settlement].[MedicalBillID] = [dbo].[tbl_medbill].[BillNo] " +
                                                    "inner join [dbo].[tbl_incident] on [dbo].[tbl_medbill].[Incident_Id] = [dbo].[tbl_incident].[Incident_id] " +
                                                    "inner join [dbo].[tbl_program] on [dbo].[tbl_incident].[Program_id] = [dbo].[tbl_program].[Program_Id] " +
                                                    "inner join [dbo].[tbl_settlement_type_code] on [dbo].[tbl_settlement].[SettlementType] = [dbo].[tbl_settlement_type_code].[SettlementTypeCode] " +
                                                    "inner join [dbo].[tbl_CreateStaff] on [dbo].[tbl_settlement].[CreateByID] = [dbo].[tbl_CreateStaff].[CreateStaff_Id] " +
                                                    "inner join [dbo].[tbl_ModifiStaff] on [dbo].[tbl_settlement].[LastModifiedByID] = [dbo].[tbl_ModifiStaff].[ModifiStaff_Id] " +
                                                    "where ([dbo].[tbl_settlement].[IsPaid] = 0 or [RN_DB].[dbo].[tbl_settlement].[IsPaid] IS NULL) and " +
                                                    "[dbo].[tbl_settlement].[PaidByID] IS NULL and " +
                                                    "([dbo].[tbl_settlement].[IsDeleted] = 0 or [dbo].[tbl_settlement].[IsDeleted] IS NULL) and " +
                                                    "([dbo].[tbl_settlement].[SettlementType] = 6 or " +
                                                    "[dbo].[tbl_settlement].[SettlementType] = 9) and " +
                                                    "[dbo].[tbl_settlement].[CMMPaymentMethod] = 1 and " +
                                                    "[dbo].[tbl_settlement].[Approved] = 1 and " +
                                                    "([dbo].[tbl_settlement].[ApprovedDate] IS NOT NULL or [dbo].[tbl_settlement].[ApprovedDate] <> '') and " +
                                                    "([dbo].[tbl_settlement].[CheckNo] IS NULL or [dbo].[tbl_settlement].[CheckNo] = '') and " +
                                                    "([dbo].[tbl_settlement].[CheckDate] IS NULL or [dbo].[tbl_settlement].[CheckDate] = '') and " +
                                                    "[dbo].[tbl_settlement].[CheckReconciled] = 0 " +
                                                    "order by [dbo].[tbl_medbill].[Individual_Id]";

            SqlCommand cmdQeuryForPaymentCheck = new SqlCommand(strSqlQueryForCheckPayment, connRN);
            cmdQeuryForPaymentCheck.CommandType = CommandType.Text;

            SqlDependency dependencyCheckPayment = new SqlDependency(cmdQeuryForPaymentCheck);
            dependencyCheckPayment.OnChange += new OnChangeEventHandler(OnCheckPaymentChange);

            if (connRN.State != ConnectionState.Closed)
            {
                connRN.Close();
                connRN.Open();
            }
            else if (connRN.State == ConnectionState.Closed) connRN.Open();
            List<CheckPaymentInfo> lstCheckPaymentInfo = new List<CheckPaymentInfo>();
            SqlDataReader rdrCheckPayment = cmdQeuryForPaymentCheck.ExecuteReader();
            if (rdrCheckPayment.HasRows)
            {
                while (rdrCheckPayment.Read())
                {
                    CheckPaymentInfo infoCheckPayment = new CheckPaymentInfo();
                    if (!rdrCheckPayment.IsDBNull(0)) infoCheckPayment.bIsPaid = rdrCheckPayment.GetBoolean(0);
                    if (!rdrCheckPayment.IsDBNull(1)) infoCheckPayment.IndividualId = rdrCheckPayment.GetString(1);
                    if (!rdrCheckPayment.IsDBNull(2)) infoCheckPayment.IncidentNo = rdrCheckPayment.GetString(2);
                    if (!rdrCheckPayment.IsDBNull(3)) infoCheckPayment.IncidentProgram = rdrCheckPayment.GetString(3);
                    if (!rdrCheckPayment.IsDBNull(4)) infoCheckPayment.ServiceDate = rdrCheckPayment.GetDateTime(4);
                    if (!rdrCheckPayment.IsDBNull(5)) infoCheckPayment.SettlementNo = rdrCheckPayment.GetString(5);
                    if (!rdrCheckPayment.IsDBNull(6)) infoCheckPayment.SettlementAmount = rdrCheckPayment.GetDecimal(6);
                    if (!rdrCheckPayment.IsDBNull(7)) infoCheckPayment.MedicalProviderId = rdrCheckPayment.GetString(7);
                    if (!rdrCheckPayment.IsDBNull(8)) infoCheckPayment.SettlementType = rdrCheckPayment.GetString(8);
                    if (!rdrCheckPayment.IsDBNull(9)) infoCheckPayment.CreatedBy = rdrCheckPayment.GetString(9);
                    if (!rdrCheckPayment.IsDBNull(10)) infoCheckPayment.LastModifiedBy = rdrCheckPayment.GetString(10);
                    if (!rdrCheckPayment.IsDBNull(11)) infoCheckPayment.AccountNoAtMedProvider = rdrCheckPayment.GetString(11);
                    if (!rdrCheckPayment.IsDBNull(12)) infoCheckPayment.bIsExported = rdrCheckPayment.GetBoolean(12);
                    if (!rdrCheckPayment.IsDBNull(13)) infoCheckPayment.nExportedByID = rdrCheckPayment.GetInt16(13);

                    lstCheckPaymentInfo.Add(infoCheckPayment);
                }
            }
            rdrCheckPayment.Close();
            if (connRN.State == ConnectionState.Open) connRN.Close();

            foreach (CheckPaymentInfo info in lstCheckPaymentInfo)
            {
                String strSqlQueryForMedicalProviderName = "select [dbo].[account].[Name] from [dbo].[account] where [dbo].[account].[Id] = @MedicalProviderId";

                SqlCommand cmdQueryForMedicalProviderName = new SqlCommand(strSqlQueryForMedicalProviderName, connSalesforce);
                cmdQueryForMedicalProviderName.CommandType = CommandType.Text;

                cmdQueryForMedicalProviderName.Parameters.AddWithValue("@MedicalProviderId", info.MedicalProviderId);

                if (connSalesforce.State != ConnectionState.Closed)
                {
                    connSalesforce.Close();
                    connSalesforce.Open();
                }
                else if (connSalesforce.State == ConnectionState.Closed) connSalesforce.Open();
                Object objMedicalProviderName = cmdQueryForMedicalProviderName.ExecuteScalar();
                if (connSalesforce.State == ConnectionState.Open) connSalesforce.Close();

                String MedicalProviderName = String.Empty;
                if (objMedicalProviderName != null) MedicalProviderName = objMedicalProviderName.ToString();

                info.MedicalProviderName = MedicalProviderName;
            }

            foreach (CheckPaymentInfo info in lstCheckPaymentInfo)
            {
                String strSqlQueryForIndividualInfoForCheckPayment = "select [dbo].[contact].[Name], [dbo].[contact].[Household_Role__c], " +
                                                                     "[dbo].[contact].[Primary_Name__c], " +
                                                                     "[dbo].[account].[SHIPPINGSTREET], [dbo].[account].[SHIPPINGCITY], " +
                                                                     "[dbo].[account].[SHIPPINGSTATE], [dbo].[account].[SHIPPINGPOSTALCODE], " +
                                                                     "[dbo].[contact].[c4g_Membership_Status__c], [dbo].[contact].[Membership_Number__c] " +
                                                                     "from [dbo].[contact] " +
                                                                     "inner join [dbo].[program] on [dbo].[contact].[c4g_Plan__c] = [dbo].[program].[ID] " +
                                                                     "inner join [dbo].[account] on [dbo].[contact].[AccountId] = [dbo].[account].[ID] " +
                                                                     "where [dbo].[contact].[Individual_ID__c] = @IndividualId";

                SqlCommand cmdQueryForIndividualInfoForCheckPayment = new SqlCommand(strSqlQueryForIndividualInfoForCheckPayment, connSalesforce);
                cmdQueryForIndividualInfoForCheckPayment.CommandType = CommandType.Text;

                cmdQueryForIndividualInfoForCheckPayment.Parameters.AddWithValue("@IndividualId", info.IndividualId);

                if (connSalesforce.State != ConnectionState.Closed)
                {
                    connSalesforce.Close();
                    connSalesforce.Open();
                }
                else if (connSalesforce.State == ConnectionState.Closed) connSalesforce.Open();
                SqlDataReader rdrIndividualInfoForCheckPayment = cmdQueryForIndividualInfoForCheckPayment.ExecuteReader();
                if (rdrIndividualInfoForCheckPayment.HasRows)
                {
                    rdrIndividualInfoForCheckPayment.Read();

                    if (!rdrIndividualInfoForCheckPayment.IsDBNull(0)) info.IndividualName = rdrIndividualInfoForCheckPayment.GetString(0);
                    if (!rdrIndividualInfoForCheckPayment.IsDBNull(1)) info.HouseholdRole = rdrIndividualInfoForCheckPayment.GetString(1);
                    if (!rdrIndividualInfoForCheckPayment.IsDBNull(2)) info.PrimaryName = rdrIndividualInfoForCheckPayment.GetString(2);
                    if (!rdrIndividualInfoForCheckPayment.IsDBNull(3)) info.ShippingStreet = rdrIndividualInfoForCheckPayment.GetString(3);
                    if (!rdrIndividualInfoForCheckPayment.IsDBNull(4)) info.ShippingCity = rdrIndividualInfoForCheckPayment.GetString(4);
                    if (!rdrIndividualInfoForCheckPayment.IsDBNull(5)) info.ShippingState = rdrIndividualInfoForCheckPayment.GetString(5);
                    if (!rdrIndividualInfoForCheckPayment.IsDBNull(6)) info.ShippingZip = rdrIndividualInfoForCheckPayment.GetString(6);
                    if (!rdrIndividualInfoForCheckPayment.IsDBNull(7)) info.MembershipStatus = rdrIndividualInfoForCheckPayment.GetString(7);
                    if (!rdrIndividualInfoForCheckPayment.IsDBNull(8)) info.MemebershipNo = rdrIndividualInfoForCheckPayment.GetString(8);

                }
                rdrIndividualInfoForCheckPayment.Close();
                if (connSalesforce.State == ConnectionState.Open) connSalesforce.Close();
            }

            if (IsHandleCreated) RemoveAllRowCheckPaymentSafely();
            else gvPaymentCheckMemberReimbursement.Rows.Clear();

            foreach (CheckPaymentInfo info in lstCheckPaymentInfo)
            {
                DataGridViewRow row = new DataGridViewRow();
                row.Cells.Add(new DataGridViewCheckBoxCell { Value = false });
                row.Cells.Add(new DataGridViewCheckBoxCell { Value = info.bIsExported });
                row.Cells.Add(new DataGridViewTextBoxCell { Value = info.IndividualName });
                row.Cells[1].ReadOnly = true;
                row.Cells.Add(new DataGridViewTextBoxCell { Value = info.IndividualId });
                row.Cells[2].ReadOnly = true;
                row.Cells.Add(new DataGridViewTextBoxCell { Value = info.HouseholdRole });
                row.Cells[3].ReadOnly = true;
                row.Cells.Add(new DataGridViewTextBoxCell { Value = info.PrimaryName });
                row.Cells[4].ReadOnly = true;
                row.Cells.Add(new DataGridViewTextBoxCell { Value = info.IncidentNo });
                row.Cells[5].ReadOnly = true;
                row.Cells.Add(new DataGridViewTextBoxCell { Value = info.IncidentProgram });
                row.Cells[6].ReadOnly = true;
                row.Cells.Add(new DataGridViewTextBoxCell { Value = info.SettlementNo });
                row.Cells[7].ReadOnly = true;
                row.Cells.Add(new DataGridViewTextBoxCell { Value = info.SettlementAmount.ToString("C") });
                row.Cells[8].ReadOnly = true;
                row.Cells[8].Style.Alignment = DataGridViewContentAlignment.MiddleRight;
                row.Cells.Add(new DataGridViewTextBoxCell { Value = info.ServiceDate.Value.ToString("MM/dd/yyyy") });
                row.Cells[9].ReadOnly = true;
                row.Cells.Add(new DataGridViewTextBoxCell { Value = info.MedicalProviderName });
                row.Cells[10].ReadOnly = true;
                row.Cells.Add(new DataGridViewTextBoxCell { Value = info.AccountNoAtMedProvider });
                row.Cells[11].ReadOnly = true;
                row.Cells.Add(new DataGridViewTextBoxCell { Value = info.ShippingStreet });
                row.Cells[12].ReadOnly = true;
                row.Cells.Add(new DataGridViewTextBoxCell { Value = info.ShippingCity });
                row.Cells[13].ReadOnly = true;
                row.Cells.Add(new DataGridViewTextBoxCell { Value = info.ShippingState });
                row.Cells[14].ReadOnly = true;
                row.Cells.Add(new DataGridViewTextBoxCell { Value = info.ShippingZip });
                row.Cells[15].ReadOnly = true;
                row.Cells.Add(new DataGridViewTextBoxCell { Value = info.SettlementType });
                row.Cells[16].ReadOnly = true;
                row.Cells.Add(new DataGridViewTextBoxCell { Value = info.CreatedBy });
                row.Cells[17].ReadOnly = true;
                row.Cells.Add(new DataGridViewTextBoxCell { Value = info.LastModifiedBy });
                row.Cells[18].ReadOnly = true;
                row.Cells.Add(new DataGridViewTextBoxCell { Value = info.MembershipStatus });
                row.Cells[19].ReadOnly = true;
                row.Cells.Add(new DataGridViewTextBoxCell { Value = info.MemebershipNo });
                row.Cells[20].ReadOnly = true;

                if (IsHandleCreated) AddRowToCheckPaymentSafely(row);
                else gvPaymentCheckMemberReimbursement.Rows.Add(row);
            }
            //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        }

        private void AddRowToCreditCardPaymentSafely(DataGridViewRow row)
        {
            gvPaymentCreditCard.BeginInvoke(new AddRowToCreditCardPayment(AddRowPaymentCreditCard), row);
        }

        private void RemoveRowCreditCardPaymentSafely(int nRow)
        {
            gvPaymentCreditCard.BeginInvoke(new RemoveCreditCardPayment(RemoveRowPaymentCreditCard), nRow);
        }

        private void RemoveAllRowCreditCardPaymentSafely()
        {
            gvPaymentCreditCard.BeginInvoke(new RemoveAllCreditCardPayment(RemoveAllPaymentCreditCard));
        }

        private void AddRowPaymentCreditCard(DataGridViewRow row)
        {
            gvPaymentCreditCard.Rows.Add(row);
        }

        private void RemoveRowPaymentCreditCard(int i)
        {
            gvPaymentCreditCard.Rows.RemoveAt(i);
        }

        private void RemoveAllPaymentCreditCard()
        {
            gvPaymentCreditCard.Rows.Clear();
        }

        private void OnCreditCardPaymentChange(object sender, SqlNotificationEventArgs e)
        {
            if (e.Type == SqlNotificationType.Change)
            {
                SqlDependency dependency = sender as SqlDependency;
                dependency.OnChange -= OnCreditCardPaymentChange;

                UpdateGridViewCreditCardPayment();
            }
        }

        private void UpdateGridViewCreditCardPayment()
        {
            //String strSqlQueryForCreditCardPayment = "select [dbo].[tbl_settlement].[IsPaid], " +
            //                             "[dbo].[tbl_medbill].[MedicalProvider_Id], " +
            //                             "[dbo].[tbl_medbill].[Account_At_Provider], " +
            //                             "[dbo].[tbl_medbill].[BillDate], " +
            //                             "[dbo].[tbl_medbill].[BillNo], [dbo].[tbl_medbill].[BillAmount], " +
            //                             "[dbo].[tbl_settlement].[Name], [dbo].[tbl_settlement].[Amount], " +
            //                             "[dbo].[tbl_settlement].[Notes], " +
            //                             "[dbo].[tbl_CreateStaff].[Staff_Name], [dbo].[tbl_ModifiStaff].[Staff_Name], " +
            //                             "[dbo].[tbl_medbill].[Individual_Id] " +
            //                             "from [dbo].[tbl_settlement] " +
            //                             "inner join [dbo].[tbl_medbill] on [dbo].[tbl_settlement].[MedicalBillID] = [dbo].[tbl_medbill].[BillNo] " +
            //                             "inner join [dbo].[tbl_CreateStaff] on [dbo].[tbl_medbill].[CreatedById] = [dbo].[tbl_CreateStaff].[CreateStaff_Id] " +
            //                             "inner join [dbo].[tbl_ModifiStaff] on [dbo].[tbl_medbill].[LastModifiedById] = [dbo].[tbl_ModifiStaff].[ModifiStaff_Id] " +
            //                             "where ([dbo].[tbl_settlement].[IsPaid] = 0 or [RN_DB].[dbo].[tbl_settlement].[IsPaid] IS NULL) and " +
            //                             "[dbo].[tbl_settlement].[PaidByID] IS NULL and " +
            //                             "[dbo].[tbl_settlement].[IsDeleted] = 0 and " +
            //                             "[dbo].[tbl_settlement].[SettlementType] = 4 and " +
            //                             "[dbo].[tbl_settlement].[CMMPaymentMethod] = 2 and " +
            //                             "[dbo].[tbl_settlement].[Approved] = 1 and " +
            //                             "[dbo].[tbl_settlement].[ApprovedDate] IS NOT NULL and " +
            //                             "([dbo].[tbl_settlement].[CMMCreditCard] = 0 or [dbo].[tbl_settlement].[CMMCreditCard] IS NULL) and " +
            //                             "[dbo].[tbl_settlement].[CMMCreditCardPaidDate] IS NULL " +
            //                             "order by [dbo].[tbl_medbill].[Individual_Id]";

            String strSqlQueryForCreditCardPayment = "select [dbo].[tbl_settlement].[IsPaid], " +
                                         "[dbo].[tbl_medbill].[MedicalProvider_Id], " +
                                         "[dbo].[tbl_medbill].[Account_At_Provider], " +
                                         "[dbo].[tbl_medbill].[BillDate], " +
                                         "[dbo].[tbl_medbill].[BillNo], [dbo].[tbl_medbill].[BillAmount], " +
                                         "[dbo].[tbl_settlement].[Name], [dbo].[tbl_settlement].[Amount], " +
                                         "[dbo].[tbl_settlement].[Notes], " +
                                         "[dbo].[tbl_CreateStaff].[Staff_Name], [dbo].[tbl_ModifiStaff].[Staff_Name], " +
                                         "[dbo].[tbl_medbill].[Individual_Id] " +
                                         "from [dbo].[tbl_settlement] " +
                                         "inner join [dbo].[tbl_medbill] on [dbo].[tbl_settlement].[MedicalBillID] = [dbo].[tbl_medbill].[BillNo] " +
                                         "inner join [dbo].[tbl_CreateStaff] on [dbo].[tbl_medbill].[CreatedById] = [dbo].[tbl_CreateStaff].[CreateStaff_Id] " +
                                         "inner join [dbo].[tbl_ModifiStaff] on [dbo].[tbl_medbill].[LastModifiedById] = [dbo].[tbl_ModifiStaff].[ModifiStaff_Id] " +
                                         "where ([dbo].[tbl_settlement].[IsPaid] = 0 or [RN_DB].[dbo].[tbl_settlement].[IsPaid] IS NULL) and " +
                                         "[dbo].[tbl_settlement].[PaidByID] IS NULL and " +
                                         "[dbo].[tbl_settlement].[IsDeleted] = 0 and " +
                                         "[dbo].[tbl_settlement].[SettlementType] = 4 and " +
                                         "[dbo].[tbl_settlement].[CMMPaymentMethod] = 2 and " +
                                         "[dbo].[tbl_settlement].[Approved] = 1 and " +
                                         "([dbo].[tbl_settlement].[ApprovedDate] IS NOT NULL or [dbo].[tbl_settlement].[ApprovedDate] <> '') and " +
                                         "([dbo].[tbl_settlement].[CMMCreditCard] = 0 or [dbo].[tbl_settlement].[CMMCreditCard] IS NULL) and " +
                                         "([dbo].[tbl_settlement].[CMMCreditCardPaidDate] IS NULL or [dbo].[tbl_settlement].[CMMCreditCardPaidDate] = '') " +
                                         "order by [dbo].[tbl_medbill].[Individual_Id]";

            SqlCommand cmdQueryForCreditCardPayment = new SqlCommand(strSqlQueryForCreditCardPayment, connRN);
            cmdQueryForCreditCardPayment.CommandType = CommandType.Text;

            SqlDependency dependencyCreditCardPayment = new SqlDependency(cmdQueryForCreditCardPayment);
            dependencyCreditCardPayment.OnChange += new OnChangeEventHandler(OnCreditCardPaymentChange);

            if (connRN.State != ConnectionState.Closed)
            {
                connRN.Close();
                connRN.Open();
            }
            else if (connRN.State == ConnectionState.Closed) connRN.Open();
            List<CreditCardPaymentInfo> lstCreditCardPaymentInfo = new List<CreditCardPaymentInfo>();
            SqlDataReader rdrCreditCardPayment = cmdQueryForCreditCardPayment.ExecuteReader();
            if (rdrCreditCardPayment.HasRows)
            {
                while (rdrCreditCardPayment.Read())
                {
                    CreditCardPaymentInfo ccPaymentInfo = new CreditCardPaymentInfo();

                    if (!rdrCreditCardPayment.IsDBNull(0)) ccPaymentInfo.bIsPaid = rdrCreditCardPayment.GetBoolean(0);
                    else ccPaymentInfo.bIsPaid = false;
                    if (!rdrCreditCardPayment.IsDBNull(1)) ccPaymentInfo.MedicalProviderId = rdrCreditCardPayment.GetString(1);
                    else ccPaymentInfo.MedicalProviderId = String.Empty;
                    if (!rdrCreditCardPayment.IsDBNull(2)) ccPaymentInfo.AccountNoAtProvider = rdrCreditCardPayment.GetString(2);
                    else ccPaymentInfo.AccountNoAtProvider = String.Empty;
                    if (!rdrCreditCardPayment.IsDBNull(3)) ccPaymentInfo.ServiceDate = rdrCreditCardPayment.GetDateTime(3);
                    else ccPaymentInfo.ServiceDate = null;
                    if (!rdrCreditCardPayment.IsDBNull(4)) ccPaymentInfo.MedicalBillNo = rdrCreditCardPayment.GetString(4);
                    else ccPaymentInfo.MedicalBillNo = String.Empty;
                    if (!rdrCreditCardPayment.IsDBNull(5)) ccPaymentInfo.MedBillAmount = rdrCreditCardPayment.GetDecimal(5);
                    else ccPaymentInfo.MedBillAmount = 0;
                    if (!rdrCreditCardPayment.IsDBNull(6)) ccPaymentInfo.SettlementName = rdrCreditCardPayment.GetString(6);
                    else ccPaymentInfo.SettlementName = String.Empty;
                    if (!rdrCreditCardPayment.IsDBNull(7)) ccPaymentInfo.SettlementAmount = rdrCreditCardPayment.GetDecimal(7);
                    else ccPaymentInfo.SettlementAmount = 0;
                    if (!rdrCreditCardPayment.IsDBNull(8)) ccPaymentInfo.SettlementNote = rdrCreditCardPayment.GetString(8);
                    else ccPaymentInfo.SettlementNote = String.Empty;
                    if (!rdrCreditCardPayment.IsDBNull(9)) ccPaymentInfo.CreateStaffName = rdrCreditCardPayment.GetString(9);
                    else ccPaymentInfo.CreateStaffName = String.Empty;
                    if (!rdrCreditCardPayment.IsDBNull(10)) ccPaymentInfo.ModifyStaffName = rdrCreditCardPayment.GetString(10);
                    else ccPaymentInfo.ModifyStaffName = String.Empty;
                    if (!rdrCreditCardPayment.IsDBNull(11)) ccPaymentInfo.IndividualID = rdrCreditCardPayment.GetString(11);
                    else ccPaymentInfo.IndividualID = String.Empty;

                    lstCreditCardPaymentInfo.Add(ccPaymentInfo);
                }
            }
            rdrCreditCardPayment.Close();
            if (connRN.State != ConnectionState.Open) connRN.Close();

            foreach (CreditCardPaymentInfo info in lstCreditCardPaymentInfo)
            {
                String strSqlQueryForMedicalProviderInfo = "select [dbo].[account].[Name], [dbo].[account].[Phone] from [dbo].[account] where [dbo].[account].[Id] = @MedicalProviderId";

                SqlCommand cmdQueryForMedicalProviderInfo = new SqlCommand(strSqlQueryForMedicalProviderInfo, connSalesforce);
                cmdQueryForMedicalProviderInfo.CommandType = CommandType.Text;

                cmdQueryForMedicalProviderInfo.Parameters.AddWithValue("@MedicalProviderId", info.MedicalProviderId);

                if (connSalesforce.State != ConnectionState.Closed)
                {
                    connSalesforce.Close();
                    connSalesforce.Open();
                }
                else if (connSalesforce.State == ConnectionState.Closed) connSalesforce.Open();
                SqlDataReader rdrMedicalProviderInfo = cmdQueryForMedicalProviderInfo.ExecuteReader();
                if (rdrMedicalProviderInfo.HasRows)
                {
                    rdrMedicalProviderInfo.Read();
                    if (!rdrMedicalProviderInfo.IsDBNull(0)) info.MedicalProviderName = rdrMedicalProviderInfo.GetString(0);
                    else info.MedicalProviderName = String.Empty;
                    if (!rdrMedicalProviderInfo.IsDBNull(1)) info.MedicalProviderPhone = rdrMedicalProviderInfo.GetString(1);
                    else info.MedicalProviderPhone = String.Empty;
                }

                if (connSalesforce.State == ConnectionState.Open) connSalesforce.Close();
            }

            foreach (CreditCardPaymentInfo info in lstCreditCardPaymentInfo)
            {

                String strSqlQueryForIndividualInfo = "select [dbo].[contact].[Name], [dbo].[contact].[Birthdate], [dbo].[contact].[Social_Security_Number__c], " +
                                                      "[dbo].[contact].[CMM_Gender__c], [dbo].[contact].[Primary_Name__c], " +
                                                      "[dbo].[account].[ShippingStreet], [dbo].[account].[ShippingCity], " +
                                                      "[dbo].[account].[ShippingState], [dbo].[account].[ShippingPostalCode], " +
                                                      "[dbo].[contact].[c4g_Membership_Status__c], [dbo].[contact].[Membership_Number__c] " +
                                                      "from [dbo].[contact] " +
                                                      "inner join [dbo].[account] on [dbo].[contact].[AccountId] = [dbo].[account].[Id] " +
                                                      "where [dbo].[contact].[Individual_ID__c] = @IndividualId";

                SqlCommand cmdQueryForIndividualInfo = new SqlCommand(strSqlQueryForIndividualInfo, connSalesforce);
                cmdQueryForIndividualInfo.CommandType = CommandType.Text;

                cmdQueryForIndividualInfo.Parameters.AddWithValue("@IndividualId", info.IndividualID);

                if (connSalesforce.State != ConnectionState.Closed)
                {
                    connSalesforce.Close();
                    connSalesforce.Open();
                }
                else if (connSalesforce.State == ConnectionState.Closed) connSalesforce.Open();
                SqlDataReader rdrIndividualInfo = cmdQueryForIndividualInfo.ExecuteReader();
                if (rdrIndividualInfo.HasRows)
                {
                    rdrIndividualInfo.Read();
                    if (!rdrIndividualInfo.IsDBNull(0)) info.IndividualName = rdrIndividualInfo.GetString(0);
                    else info.IndividualName = String.Empty;
                    if (!rdrIndividualInfo.IsDBNull(1)) info.IndividualBirthDate = rdrIndividualInfo.GetDateTime(1);
                    else info.IndividualBirthDate = null;
                    if (!rdrIndividualInfo.IsDBNull(2)) info.SocialSecurityNumber = rdrIndividualInfo.GetString(2);
                    else info.SocialSecurityNumber = String.Empty;
                    if (!rdrIndividualInfo.IsDBNull(3)) info.Sex = rdrIndividualInfo.GetString(3);
                    else info.Sex = "Unknown";
                    if (!rdrIndividualInfo.IsDBNull(4)) info.PrimaryName = rdrIndividualInfo.GetString(4);
                    else info.PrimaryName = String.Empty;
                    if (!rdrIndividualInfo.IsDBNull(5)) info.MailingStreet = rdrIndividualInfo.GetString(5);
                    else info.MailingStreet = String.Empty;
                    if (!rdrIndividualInfo.IsDBNull(6)) info.MailingCity = rdrIndividualInfo.GetString(6);
                    else info.MailingCity = String.Empty;
                    if (!rdrIndividualInfo.IsDBNull(7)) info.MailingState = rdrIndividualInfo.GetString(7);
                    else info.MailingState = String.Empty;
                    if (!rdrIndividualInfo.IsDBNull(8)) info.MailingZip = rdrIndividualInfo.GetString(8);
                    else info.MailingZip = String.Empty;
                    if (!rdrIndividualInfo.IsDBNull(9)) info.MembershipStatus = rdrIndividualInfo.GetString(9);
                    else info.MembershipStatus = String.Empty;
                    if (!rdrIndividualInfo.IsDBNull(10)) info.MembershipNumber = rdrIndividualInfo.GetString(10);
                }
                rdrIndividualInfo.Close();
                if (connSalesforce.State == ConnectionState.Open) connSalesforce.Close();
            }

            if (IsHandleCreated) RemoveAllRowCreditCardPaymentSafely();
            else gvPaymentCreditCard.Rows.Clear();

            foreach (CreditCardPaymentInfo ccPaymentInfo in lstCreditCardPaymentInfo)
            {
                DataGridViewRow row = new DataGridViewRow();
                row.Cells.Add(new DataGridViewButtonCell { Value = "Confirm Payment" });
                row.Cells.Add(new DataGridViewTextBoxCell { Value = ccPaymentInfo.IndividualName });
                row.Cells[1].ReadOnly = true;
                row.Cells.Add(new DataGridViewTextBoxCell { Value = ccPaymentInfo.MedicalProviderName });
                row.Cells[2].ReadOnly = true;
                row.Cells.Add(new DataGridViewTextBoxCell { Value = ccPaymentInfo.MedicalProviderPhone });
                row.Cells[3].ReadOnly = true;
                row.Cells.Add(new DataGridViewTextBoxCell { Value = ccPaymentInfo.AccountNoAtProvider });
                row.Cells[4].ReadOnly = true;
                row.Cells.Add(new DataGridViewTextBoxCell { Value = ccPaymentInfo.IndividualBirthDate.Value.ToString("MM/dd/yyyy") });
                row.Cells[5].ReadOnly = true;
                row.Cells.Add(new DataGridViewTextBoxCell { Value = ccPaymentInfo.SocialSecurityNumber });
                row.Cells[6].ReadOnly = true;
                DataGridViewTextBoxCell sexCell = new DataGridViewTextBoxCell();
                if (ccPaymentInfo.Sex == "Male") sexCell.Value = "M";
                else if (ccPaymentInfo.Sex == "Female") sexCell.Value = "F";
                else if (ccPaymentInfo.Sex == "0") sexCell.Value = "Unknown";
                row.Cells.Add(sexCell);
                row.Cells[7].ReadOnly = true;
                row.Cells.Add(new DataGridViewTextBoxCell { Value = ccPaymentInfo.PrimaryName });
                row.Cells[8].ReadOnly = true;
                row.Cells.Add(new DataGridViewTextBoxCell { Value = ccPaymentInfo.MailingStreet });
                row.Cells[9].ReadOnly = true;
                row.Cells.Add(new DataGridViewTextBoxCell { Value = ccPaymentInfo.MailingCity });
                row.Cells[10].ReadOnly = true;
                row.Cells.Add(new DataGridViewTextBoxCell { Value = ccPaymentInfo.MailingState });
                row.Cells[11].ReadOnly = true;
                row.Cells.Add(new DataGridViewTextBoxCell { Value = ccPaymentInfo.MailingZip });
                row.Cells[12].ReadOnly = true;
                row.Cells.Add(new DataGridViewTextBoxCell { Value = ccPaymentInfo.ServiceDate });
                row.Cells[13].ReadOnly = true;
                row.Cells.Add(new DataGridViewTextBoxCell { Value = ccPaymentInfo.MedicalBillNo });
                row.Cells[14].ReadOnly = true;
                row.Cells.Add(new DataGridViewTextBoxCell { Value = ccPaymentInfo.MedBillAmount.ToString("C") });
                row.Cells[15].Style.Alignment = DataGridViewContentAlignment.MiddleRight;
                row.Cells[15].ReadOnly = true;
                row.Cells.Add(new DataGridViewTextBoxCell { Value = ccPaymentInfo.SettlementName });
                row.Cells[16].ReadOnly = true;
                row.Cells.Add(new DataGridViewTextBoxCell { Value = ccPaymentInfo.SettlementAmount.ToString("C") });
                row.Cells[17].Style.Alignment = DataGridViewContentAlignment.MiddleRight;
                DataGridViewComboBoxCell comboCreditCardCell = new DataGridViewComboBoxCell();
                for (int i = 0; i < lstCreditCardInfo.Count; i++)
                {
                    comboCreditCardCell.Items.Add(lstCreditCardInfo[i].CreditCardNo);
                }
                row.Cells.Add(comboCreditCardCell);
                row.Cells.Add(new DataGridViewTextBoxCell { Value = ccPaymentInfo.MembershipStatus });
                row.Cells[19].ReadOnly = true;
                row.Cells.Add(new DataGridViewTextBoxCell { Value = ccPaymentInfo.SettlementNote });
                row.Cells[20].ReadOnly = true;
                row.Cells.Add(new DataGridViewTextBoxCell { Value = ccPaymentInfo.CreateStaffName });
                row.Cells[21].ReadOnly = true;
                row.Cells.Add(new DataGridViewTextBoxCell { Value = ccPaymentInfo.ModifyStaffName });
                row.Cells[22].ReadOnly = true;
                row.Cells.Add(new DataGridViewTextBoxCell { Value = ccPaymentInfo.IndividualID });
                row.Cells[23].ReadOnly = true;
                row.Cells.Add(new DataGridViewTextBoxCell { Value = ccPaymentInfo.MembershipNumber });
                row.Cells[24].ReadOnly = true;

                if (IsHandleCreated) AddRowToCreditCardPaymentSafely(row);
                else gvPaymentCreditCard.Rows.Add(row);
            }
            rdrCreditCardPayment.Close();
            if (connRN.State == ConnectionState.Open) connRN.Close();

        }


        private void AddRowToACHPaymentSafely(DataGridViewRow row)
        {
            gvPaymentACH.BeginInvoke(new AddRowToACHPayment(AddRowPaymentACH), row);
        }

        private void RemoveRowACHPaymentSafely(int nRow)
        {
            gvPaymentACH.BeginInvoke(new RemoveACHPayment(RemoveRowPaymentACH), nRow);
        }

        private void RemoveAllRowACHPaymentSafely()
        {
            gvPaymentACH.BeginInvoke(new RemoveAllACHPayment(RemoveAllPaymentACH));
        }

        private void AddRowPaymentACH(DataGridViewRow row)
        {
            gvPaymentACH.Rows.Add(row);
        }

        private void RemoveRowPaymentACH(int i)
        {
            gvPaymentACH.Rows.RemoveAt(i);
        }

        private void RemoveAllPaymentACH()
        {
            gvPaymentACH.Rows.Clear();
        }

        private void OnACHPaymentChange(object sender, SqlNotificationEventArgs e)
        {
            if (e.Type == SqlNotificationType.Change)
            {
                SqlDependency dependency = sender as SqlDependency;
                dependency.OnChange -= OnACHPaymentChange;

                UpdateGridViewACHPayment();
            }
        }

        private void UpdateGridViewACHPayment()
        {

            //String strSqlQueryForACHPayment = "select [dbo].[tbl_settlement].[IsPaid], [dbo].[tbl_medbill].[Individual_Id], " +
            //                      "[dbo].[tbl_settlement].[Name], [dbo].[tbl_settlement].[Amount], " +
            //                      "[dbo].[tbl_CreateStaff].[Staff_Name], [dbo].[tbl_ModifiStaff].[Staff_Name]," +
            //                      "[dbo].[tbl_settlement].[IsACHExported], [dbo].[tbl_settlement].[ACHExportedByID], " +
            //                      "[dbo].[tbl_settlement].[SettlementType] " +
            //                      "from [dbo].[tbl_settlement] " +
            //                      "inner join [dbo].[tbl_medbill] on [dbo].[tbl_settlement].[MedicalBillID] = [dbo].[tbl_medbill].[BillNo] " +
            //                      "inner join [dbo].[tbl_CreateStaff] on [dbo].[tbl_medbill].[CreatedById] = [dbo].[tbl_CreateStaff].[CreateStaff_Id] " +
            //                      "inner join [dbo].[tbl_ModifiStaff] on [dbo].[tbl_medbill].[LastModifiedById] = [dbo].[tbl_ModifiStaff].[ModifiStaff_Id] " +
            //                      "where ([dbo].[tbl_settlement].[IsPaid] = 0 or [RN_DB].[dbo].[tbl_settlement].[IsPaid] IS NULL) and " +
            //                      "[dbo].[tbl_settlement].[PaidByID] IS NULL and " +
            //                      "[dbo].[tbl_settlement].[IsDeleted] = 0 and " +
            //                      "([dbo].[tbl_settlement].[SettlementType] = 4 or " +
            //                      "[dbo].[tbl_settlement].[SettlementType] = 6 or " +
            //                      "[dbo].[tbl_settlement].[SettlementType] = 9) and " +
            //                      "[dbo].[tbl_settlement].[CMMPaymentMethod] = 3 and " +
            //                      "[dbo].[tbl_settlement].[Approved] = 1 and " +
            //                      "[dbo].[tbl_settlement].[ApprovedDate] IS NOT NULL and " +
            //                      "[dbo].[tbl_settlement].[ACH_Number] IS NULL and " +
            //                      "[dbo].[tbl_settlement].[ACH_Date] IS NULL " +
            //                      "order by [dbo].[tbl_medbill].[Individual_Id]";


            String strSqlQueryForACHPayment = "select [dbo].[tbl_settlement].[IsPaid], [dbo].[tbl_medbill].[Individual_Id], " +
                                  "[dbo].[tbl_settlement].[Name], [dbo].[tbl_settlement].[Amount], " +
                                  "[dbo].[tbl_CreateStaff].[Staff_Name], [dbo].[tbl_ModifiStaff].[Staff_Name], " +
                                  "[dbo].[tbl_settlement].[IsACHExported], [dbo].[tbl_settlement].[ACHExportedByID], " +
                                  "[dbo].[tbl_settlement].[SettlementType] " +
                                  "from [dbo].[tbl_settlement] " +
                                  "inner join [dbo].[tbl_medbill] on [dbo].[tbl_settlement].[MedicalBillID] = [dbo].[tbl_medbill].[BillNo] " +
                                  "inner join [dbo].[tbl_CreateStaff] on [dbo].[tbl_medbill].[CreatedById] = [dbo].[tbl_CreateStaff].[CreateStaff_Id] " +
                                  "inner join [dbo].[tbl_ModifiStaff] on [dbo].[tbl_medbill].[LastModifiedById] = [dbo].[tbl_ModifiStaff].[ModifiStaff_Id] " +
                                  "where ([dbo].[tbl_settlement].[IsPaid] = 0 or [RN_DB].[dbo].[tbl_settlement].[IsPaid] IS NULL) and " +
                                  "[dbo].[tbl_settlement].[PaidByID] IS NULL and " +
                                  "[dbo].[tbl_settlement].[IsDeleted] = 0 and " +
                                  "([dbo].[tbl_settlement].[SettlementType] = 4 or " +
                                  "[dbo].[tbl_settlement].[SettlementType] = 6 or " +
                                  "[dbo].[tbl_settlement].[SettlementType] = 9) and " +
                                  "[dbo].[tbl_settlement].[CMMPaymentMethod] = 3 and " +
                                  "[dbo].[tbl_settlement].[Approved] = 1 and " +
                                  "([dbo].[tbl_settlement].[ApprovedDate] IS NOT NULL or [dbo].[tbl_settlement].[ApprovedDate] <> '') and " +
                                  "([dbo].[tbl_settlement].[ACH_Number] IS NULL or [dbo].[tbl_settlement].[ACH_Number] = '') and " +
                                  "([dbo].[tbl_settlement].[ACH_Date] IS NULL or [dbo].[tbl_settlement].[ACH_Date] = '') " +
                                  "order by [dbo].[tbl_medbill].[Individual_Id]";

            SqlCommand cmdPaymentACH = new SqlCommand(strSqlQueryForACHPayment, connRN);
            cmdPaymentACH.CommandType = CommandType.Text;

            SqlDependency dependencyPaymentACH = new SqlDependency(cmdPaymentACH);
            dependencyPaymentACH.OnChange += new OnChangeEventHandler(OnACHPaymentChange);

            if (connRN.State != ConnectionState.Closed)
            {
                connRN.Close();
                connRN.Open();
            }
            else if (connRN.State == ConnectionState.Closed) connRN.Open();
            SqlDataReader rdrPaymentACH = cmdPaymentACH.ExecuteReader();
            List<ACHPaymentInfo> lstACHPaymentInfo = new List<ACHPaymentInfo>();
            if (rdrPaymentACH.HasRows)
            {
                while (rdrPaymentACH.Read())
                {
                    ACHPaymentInfo achInfo = new ACHPaymentInfo();

                    if (!rdrPaymentACH.IsDBNull(0)) achInfo.bIsPaid = rdrPaymentACH.GetBoolean(0);
                    if (!rdrPaymentACH.IsDBNull(1)) achInfo.IndividualId = rdrPaymentACH.GetString(1);
                    if (!rdrPaymentACH.IsDBNull(2)) achInfo.SettlementNo = rdrPaymentACH.GetString(2);
                    if (!rdrPaymentACH.IsDBNull(3)) achInfo.SettlementAmount = rdrPaymentACH.GetDecimal(3);
                    if (!rdrPaymentACH.IsDBNull(4)) achInfo.CreateStaffName = rdrPaymentACH.GetString(4);
                    if (!rdrPaymentACH.IsDBNull(5)) achInfo.ModifiStaffName = rdrPaymentACH.GetString(5);
                    if (!rdrPaymentACH.IsDBNull(6)) achInfo.bIsExported = rdrPaymentACH.GetBoolean(6);
                    if (!rdrPaymentACH.IsDBNull(7)) achInfo.nExportedBy = rdrPaymentACH.GetInt16(7);
                    if (!rdrPaymentACH.IsDBNull(8)) achInfo.nSettlementType = rdrPaymentACH.GetInt16(8);

                    lstACHPaymentInfo.Add(achInfo);
                }
            }
            if (connRN.State == ConnectionState.Closed) connRN.Open();

            foreach (ACHPaymentInfo info in lstACHPaymentInfo)
            {
                String strSqlQueryForIndividualInfo = "select [dbo].[contact].[Name], " +
                                                      "[dbo].[contact].[BankName__c], [dbo].[contact].[RoutingNumber__c], " +
                                                      "[dbo].[contact].[AccountNumber__c], [dbo].[contact].[AccountHolder__c], " +
                                                      "[dbo].[membership].[Pay_BankName__c], [dbo].[membership].[Pay_RoutingNumber__c], " +
                                                      "[dbo].[membership].[Pay_AccountNumber__c], [dbo].[membership].[Pay_AccountHolder__c], " +
                                                      "[dbo].[contact].[c4g_Membership_Status__c], " +
                                                      "[dbo].[contact].[LastName], [dbo].[contact].[FirstName], [dbo].[contact].[MiddleName] " +
                                                      "from [dbo].[contact] " +
                                                      "inner join [dbo].[membership] on [dbo].[contact].[c4g_Membership__c] = [dbo].[membership].[Id] " +
                                                      "where [dbo].[contact].[Individual_ID__c] = @IndividualId";

                SqlCommand cmdQueryForIndividualInfo = new SqlCommand(strSqlQueryForIndividualInfo, connSalesforce);
                cmdQueryForIndividualInfo.CommandType = CommandType.Text;

                cmdQueryForIndividualInfo.Parameters.AddWithValue("@IndividualId", info.IndividualId);

                if (connSalesforce.State != ConnectionState.Closed)
                {
                    connSalesforce.Close();
                    connSalesforce.Open();
                }
                else if (connSalesforce.State == ConnectionState.Closed) connSalesforce.Open();

                SqlDataReader rdrACHPaymentIndividualInfo = cmdQueryForIndividualInfo.ExecuteReader();
                if (rdrACHPaymentIndividualInfo.HasRows)
                {
                    rdrACHPaymentIndividualInfo.Read();
                    if (!rdrACHPaymentIndividualInfo.IsDBNull(0)) info.IndividualName = rdrACHPaymentIndividualInfo.GetString(0);
                    if (!rdrACHPaymentIndividualInfo.IsDBNull(1)) info.BankName = rdrACHPaymentIndividualInfo.GetString(1);
                    else if (!rdrACHPaymentIndividualInfo.IsDBNull(5)) info.BankName = rdrACHPaymentIndividualInfo.GetString(5);
                    if (!rdrACHPaymentIndividualInfo.IsDBNull(2)) info.RoutingNumber = rdrACHPaymentIndividualInfo.GetString(2);
                    else if (!rdrACHPaymentIndividualInfo.IsDBNull(6)) info.RoutingNumber = rdrACHPaymentIndividualInfo.GetString(6);
                    if (!rdrACHPaymentIndividualInfo.IsDBNull(3)) info.AccountNumber = rdrACHPaymentIndividualInfo.GetString(3);
                    else if (!rdrACHPaymentIndividualInfo.IsDBNull(7)) info.AccountNumber = rdrACHPaymentIndividualInfo.GetString(7);
                    if (!rdrACHPaymentIndividualInfo.IsDBNull(4)) info.AccountHolder = rdrACHPaymentIndividualInfo.GetString(4);
                    else if (!rdrACHPaymentIndividualInfo.IsDBNull(8)) info.AccountHolder = rdrACHPaymentIndividualInfo.GetString(8);
                    if (!rdrACHPaymentIndividualInfo.IsDBNull(5)) info.MembershipStatus = rdrACHPaymentIndividualInfo.GetString(9);
                    if (!rdrACHPaymentIndividualInfo.IsDBNull(10)) info.LastName = rdrACHPaymentIndividualInfo.GetString(10);
                    else info.LastName = String.Empty;
                    if (!rdrACHPaymentIndividualInfo.IsDBNull(11)) info.FirstName = rdrACHPaymentIndividualInfo.GetString(11);
                    else info.FirstName = String.Empty;
                    if (!rdrACHPaymentIndividualInfo.IsDBNull(12)) info.MiddleName = rdrACHPaymentIndividualInfo.GetString(12);
                    else info.MiddleName = String.Empty;
                }
                rdrACHPaymentIndividualInfo.Close();
            }
            if (IsHandleCreated) RemoveAllRowACHPaymentSafely();
            else gvPaymentACH.Rows.Clear();

            foreach (ACHPaymentInfo info in lstACHPaymentInfo)
            {
                DataGridViewRow row = new DataGridViewRow();
                row.Cells.Add(new DataGridViewCheckBoxCell { Value = false });
                row.Cells.Add(new DataGridViewCheckBoxCell { Value = info.bIsExported });
                row.Cells[1].ReadOnly = true;
                row.Cells.Add(new DataGridViewTextBoxCell { Value = info.IndividualName });
                row.Cells[2].ReadOnly = true;
                row.Cells.Add(new DataGridViewTextBoxCell { Value = info.IndividualId });
                row.Cells[3].ReadOnly = true;
                row.Cells.Add(new DataGridViewTextBoxCell { Value = info.SettlementNo });
                row.Cells[4].ReadOnly = true;
                row.Cells.Add(new DataGridViewTextBoxCell { Value = info.SettlementAmount.ToString("C") });
                row.Cells[5].Style.Alignment = DataGridViewContentAlignment.MiddleRight;
                row.Cells[5].ReadOnly = true;
                row.Cells.Add(new DataGridViewTextBoxCell { Value = info.BankName });
                row.Cells[6].ReadOnly = true;
                row.Cells.Add(new DataGridViewTextBoxCell { Value = info.RoutingNumber });
                row.Cells[7].ReadOnly = true;
                row.Cells.Add(new DataGridViewTextBoxCell { Value = info.AccountNumber });
                row.Cells[8].ReadOnly = true;
                row.Cells.Add(new DataGridViewTextBoxCell { Value = info.AccountHolder });
                row.Cells[9].ReadOnly = true;
                row.Cells.Add(new DataGridViewTextBoxCell { Value = info.CreateStaffName });
                row.Cells[10].ReadOnly = true;
                row.Cells.Add(new DataGridViewTextBoxCell { Value = info.ModifiStaffName });
                row.Cells[11].ReadOnly = true;
                row.Cells.Add(new DataGridViewTextBoxCell { Value = info.MembershipStatus });
                row.Cells[12].ReadOnly = true;
                if (info.nSettlementType == 6 || info.nSettlementType == 9) row.Cells.Add(new DataGridViewCheckBoxCell { Value = true });
                else row.Cells.Add(new DataGridViewCheckBoxCell { Value = false });
                row.Cells[13].ReadOnly = true;
                if (info.MiddleName != String.Empty) row.Cells.Add(new DataGridViewTextBoxCell { Value = info.LastName + "," + info.FirstName + " " + info.MiddleName });
                else row.Cells.Add(new DataGridViewTextBoxCell { Value = info.LastName + "," + info.FirstName });
                row.Cells[14].ReadOnly = true;

                if (IsHandleCreated) AddRowToACHPaymentSafely(row);
                else gvPaymentACH.Rows.Add(row);
            }
        }



        private void AddRowToPaymentInactiveSafely(DataGridViewRow row)
        {
            gvPaymentInactive.BeginInvoke(new AddRowToInactivePayment(AddRowPaymentInactive), row);
        }

        private void RemoveRowPaymentInactiveSafely(int i)
        {
            gvPaymentInactive.BeginInvoke(new RemoveInactivePayment(RemoveRowPaymentInactive), i);
        }

        private void RemoveAllRowPaymentInactiveSafely()
        {
            gvPaymentInactive.BeginInvoke(new RemoveAllInactivePayment(RemoveAllRowPaymentInactive));
        }

        private void AddRowPaymentInactive(DataGridViewRow row)
        {
            gvPaymentInactive.Rows.Add(row);
        }

        private void RemoveRowPaymentInactive(int i)
        {
            gvPaymentInactive.Rows.RemoveAt(i);
        }

        private void RemoveAllRowPaymentInactive()
        {
            gvPaymentInactive.Rows.Clear();
        }

        private void OnPaymentInactiveChange(object sender, SqlNotificationEventArgs e)
        {
            if (e.Type == SqlNotificationType.Change)
            {
                SqlDependency dependency = sender as SqlDependency;
                dependency.OnChange -= OnPaymentInactiveChange;

                UpdateGridViewInactivePayment();
            }
        }

        private void UpdateGridViewInactivePayment()
        {
            List<String> lstIndividualIDs = new List<String>();
            String strSqlQueryForPaymentInactive = "select distinct([dbo].[tbl_medbill].[Individual_Id]) " +
                                                    "from [dbo].[tbl_medbill] " +
                                                    "inner join [dbo].[tbl_settlement] on [dbo].[tbl_medbill].[BillNo] = [dbo].[tbl_settlement].[MedicalBillID] " +
                                                    "where ([dbo].[tbl_settlement].[IsPaid] = 0 or [RN_DB].[dbo].[tbl_settlement].[IsPaid] IS NULL) and " +
                                                    "[dbo].[tbl_settlement].[PaidByID] IS NULL and " +
                                                    "[dbo].[tbl_settlement].[IsDeleted] = 0 and " +
                                                    "([dbo].[tbl_settlement].[SettlementType] = 4 or " +
                                                    "[dbo].[tbl_settlement].[SettlementType] = 6 or " +
                                                    "[dbo].[tbl_settlement].[SettlementType] = 9) and " +
                                                    "[dbo].[tbl_settlement].[Approved] = 1 and " +
                                                    "[dbo].[tbl_settlement].[ApprovedDate] IS NOT NULL " +
                                                    "order by [dbo].[tbl_medbill].[Individual_Id]";

            SqlCommand cmdQueryForPaymentInactive = new SqlCommand(strSqlQueryForPaymentInactive, connRN);
            cmdQueryForPaymentInactive.CommandType = CommandType.Text;

            SqlDependency dependencyPaymentInactive = new SqlDependency(cmdQueryForPaymentInactive);
            dependencyPaymentInactive.OnChange += new OnChangeEventHandler(OnPaymentInactiveChange);

            if (connRN.State != ConnectionState.Closed)
            {
                connRN.Close();
                connRN.Open();
            }
            else if (connRN.State == ConnectionState.Closed) connRN.Open();
            SqlDataReader rdrPaymentInactive = cmdQueryForPaymentInactive.ExecuteReader();
            gvPaymentInactive.Rows.Clear();
            if (rdrPaymentInactive.HasRows)
            {
                while (rdrPaymentInactive.Read())
                {
                    String IndividualID = String.Empty;
                    if (!rdrPaymentInactive.IsDBNull(0)) IndividualID = rdrPaymentInactive.GetString(0);
                    lstIndividualIDs.Add(IndividualID);
                }
            }
            rdrPaymentInactive.Close();
            if (connRN.State == ConnectionState.Open) connRN.Close();

            List<InactivePaymentInfo> lstInactivePaymentInfo = new List<InactivePaymentInfo>();
            foreach (String IndividualId in lstIndividualIDs)
            {
                String strSqlQueryForIndividualInfo = "select [dbo].[contact].[Name], [dbo].[contact].[Membership_Number__c], [dbo].[contact].[c4g_Membership_Status__c], " +
                                                       "[dbo].[account].[ShippingState], " +
                                                       "[dbo].[contact].[Email], [dbo].[account].[cmm_Email__c], " +
                                                       "[dbo].[contact].[Phone], [dbo].[account].[Phone] " +
                                                       "from [dbo].[contact] " +
                                                       "inner join [dbo].[account] on [dbo].[contact].[AccountId] = [dbo].[account].[Id] " +
                                                       "where ([dbo].[contact].[c4g_Membership_Status__c] like '%Cancelled%' or " +
                                                       "cast([dbo].[contact].[c4g_Membership_Status__c] as nvarchar(max)) = 'Past Due' or " +
                                                       "cast([dbo].[contact].[c4g_Membership_Status__c] as nvarchar(max)) = 'Hold' or " +
                                                       "cast([dbo].[contact].[c4g_Membership_Status__c] as nvarchar(max)) IS NULL) and " +
                                                       "[dbo].[contact].[Individual_ID__c] = @IndividualId";

                SqlCommand cmdQueryForIndividualInfo = new SqlCommand(strSqlQueryForIndividualInfo, connSalesforce);
                cmdQueryForIndividualInfo.CommandType = CommandType.Text;

                cmdQueryForIndividualInfo.Parameters.AddWithValue("@IndividualId", IndividualId);

                if (connSalesforce.State != ConnectionState.Closed)
                {
                    connSalesforce.Close();
                    connSalesforce.Open();
                }
                else if (connSalesforce.State == ConnectionState.Closed) connSalesforce.Open();
                SqlDataReader rdrPaymentInactiveIndividual = cmdQueryForIndividualInfo.ExecuteReader();
                if (rdrPaymentInactiveIndividual.HasRows)
                {
                    rdrPaymentInactiveIndividual.Read();
                    InactivePaymentInfo info = new InactivePaymentInfo();
                    if (!rdrPaymentInactiveIndividual.IsDBNull(0)) info.IndividualName = rdrPaymentInactiveIndividual.GetString(0);
                    if (!rdrPaymentInactiveIndividual.IsDBNull(1)) info.MembershipNo = rdrPaymentInactiveIndividual.GetString(1);
                    if (!rdrPaymentInactiveIndividual.IsDBNull(2)) info.MembershipStatus = rdrPaymentInactiveIndividual.GetString(2);
                    if (!rdrPaymentInactiveIndividual.IsDBNull(3)) info.State = rdrPaymentInactiveIndividual.GetString(3);
                    if (!rdrPaymentInactiveIndividual.IsDBNull(4)) info.Email = rdrPaymentInactiveIndividual.GetString(4);
                    else if (!rdrPaymentInactiveIndividual.IsDBNull(5)) info.Email = rdrPaymentInactiveIndividual.GetString(5);
                    if (!rdrPaymentInactiveIndividual.IsDBNull(6)) info.Phone = rdrPaymentInactiveIndividual.GetString(6);
                    else if (!rdrPaymentInactiveIndividual.IsDBNull(7)) info.Phone = rdrPaymentInactiveIndividual.GetString(7);
                    lstInactivePaymentInfo.Add(info);
                }
                rdrPaymentInactiveIndividual.Close();
                if (connSalesforce.State == ConnectionState.Open) connSalesforce.Close();
            }

            if (IsHandleCreated) RemoveAllRowPaymentInactiveSafely();
            else gvPaymentInactive.Rows.Clear();

            foreach (InactivePaymentInfo info in lstInactivePaymentInfo)
            {
                DataGridViewRow row = new DataGridViewRow();
                row.Cells.Add(new DataGridViewTextBoxCell { Value = info.IndividualId });
                row.Cells[0].ReadOnly = true;
                row.Cells.Add(new DataGridViewTextBoxCell { Value = info.IndividualName });
                row.Cells[1].ReadOnly = true;
                row.Cells.Add(new DataGridViewTextBoxCell { Value = info.MembershipNo });
                row.Cells[2].ReadOnly = true;
                row.Cells.Add(new DataGridViewTextBoxCell { Value = info.MembershipStatus });
                row.Cells[3].ReadOnly = true;
                row.Cells.Add(new DataGridViewTextBoxCell { Value = info.State });
                row.Cells[4].ReadOnly = true;
                row.Cells.Add(new DataGridViewTextBoxCell { Value = info.Email });
                row.Cells[5].ReadOnly = true;
                row.Cells.Add(new DataGridViewTextBoxCell { Value = info.Phone });
                row.Cells[6].ReadOnly = true;
                //gvPaymentInactive.Rows.Add(row);
                if (IsHandleCreated) AddRowToPaymentInactiveSafely(row);
                else gvPaymentInactive.Rows.Add(row);
            }
        }


        /// <summary>
        /// 
        /// </summary>
        /// <param name="row"></param>
        private void AddRowToActiveTaskNPManagerSafely(DataGridViewRow row)
        {
            gvNPManagerActiveTask.BeginInvoke(new AddRowToActiveTaskNPManager(AddRowActiveTaskNPManager), row);
        }

        private void RemoveRowActiveTaskNPManagerSafely(int nRow)
        {
            gvNPManagerActiveTask.BeginInvoke(new RemoveActiveTaskNPManager(RemoveRowActiveTaskNPManager), nRow);
        }

        private void ClearAllRowActiveTaskNPManager()
        {
            gvNPManagerActiveTask.BeginInvoke(new RemoveAllActiveTaskNPManager(RemoveAllRowActiveTaskNPManager));
        }

        private void AddRowActiveTaskNPManager(DataGridViewRow row)
        {
            gvNPManagerActiveTask.Rows.Add(row);
        }

        private void RemoveRowActiveTaskNPManager(int nRow)
        {
            gvNPManagerActiveTask.Rows.RemoveAt(nRow);
        }

        private void RemoveAllRowActiveTaskNPManager()
        {
            gvNPManagerActiveTask.Rows.Clear();
        }

        private void OnActiveTaskNPManagerChange(object sender, SqlNotificationEventArgs e)
        {
            if (e.Type == SqlNotificationType.Change)
            {
                SqlDependency dependency = sender as SqlDependency;
                dependency.OnChange -= OnActiveTaskNPManagerChange;

                UpdateGridViewActiveTaskNPManager();
            }
        }

        private void UpdateGridViewActiveTaskNPManager()
        {
            String strSqlQueryForActiveTasks = "select [dbo].[tbl_task].[whoid], [dbo].[tbl_task].[IndividualName], " +
               "[dbo].[tbl_task_assigned_to].[User_Name], [dbo].[tbl_task_created_by].[User_Name], " +
               "[dbo].[tbl_task].[whatid], " +
               "[dbo].[tbl_task].[Subject], [dbo].[tbl_task].[DueDate], [dbo].[tbl_task].[CreateDate], " +
               "[dbo].[tbl_task].[ActivityDate], [dbo].[tbl_task].[Comment], [dbo].[tbl_task].[Solution], " +
               "[dbo].[tbl_task_status_code].[TaskStatusValue], [dbo].[tbl_task_priority_code].[TaskPriorityValue] " +
               "from [dbo].[tbl_task] " +
               "inner join [dbo].[tbl_task_assigned_to] on [dbo].[tbl_task].[AssignedTo] = [dbo].[tbl_task_assigned_to].[User_Id] " +
               "inner join [dbo].[tbl_task_created_by] on [dbo].[tbl_task].[CreatedById] = [dbo].[tbl_task_created_by].[User_Id] " +
               "inner join [dbo].[tbl_task_status_code] on [dbo].[tbl_task].[Status] = [dbo].[tbl_task_status_code].[TaskStatusCode] " +
               "inner join [dbo].[tbl_task_priority_code] on [dbo].[tbl_task].[Priority] = [dbo].[tbl_task_priority_code].[TaskPriorityCode] " +
               "inner join [dbo].[tbl_assigned_to_role] on [dbo].[tbl_task_assigned_to].[User_Role_Id] = [dbo].[tbl_assigned_to_role].[User_Role_Id] " +
               "inner join [dbo].[tbl_created_by_role] on [dbo].[tbl_task_created_by].[User_Role_Id] = [dbo].[tbl_created_by_role].[User_Role_Id]" +
               "where ([dbo].[tbl_task].[AssignedTo] = @AssignedToId or " +
               "[dbo].[tbl_task].[CreatedById] = @CreatedById) and " +
               "([dbo].[tbl_assigned_to_role].[User_Role_Id] = 6 or " +
               "[dbo].[tbl_created_by_role].[User_Role_Id] = 6 or " +
               "[dbo].[tbl_assigned_to_role].[User_Role_Id] = 3 or" +
               "[dbo].[tbl_created_by_role].[User_Role_Id] = 3) and " +
               "[dbo].[tbl_task].[Status] <> 2 and [dbo].[tbl_task].[Status] <> 5";

            SqlCommand cmdQueryForActiveTask = new SqlCommand(strSqlQueryForActiveTasks, connRN);
            cmdQueryForActiveTask.CommandType = CommandType.Text;

            cmdQueryForActiveTask.Parameters.AddWithValue("@AssignedToId", nLoggedUserId);
            cmdQueryForActiveTask.Parameters.AddWithValue("@CreatedById", nLoggedUserId);

            SqlDependency dependency = new SqlDependency(cmdQueryForActiveTask);
            dependency.OnChange += new OnChangeEventHandler(OnActiveTaskNPManagerChange);


            if (connRN.State != ConnectionState.Closed)
            {
                connRN.Close();
                connRN.Open();
            }
            else if (connRN.State == ConnectionState.Closed) connRN.Open();
            if (IsHandleCreated) ClearAllRowActiveTaskNPManager();
            else gvNPManagerActiveTask.Rows.Clear();
            SqlDataReader rdrActiveTask = cmdQueryForActiveTask.ExecuteReader();
            if (rdrActiveTask.HasRows)
            {
                while (rdrActiveTask.Read())
                {
                    DataGridViewRow row = new DataGridViewRow();
                    if (!rdrActiveTask.IsDBNull(0)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrActiveTask.GetString(0) });
                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                    if (!rdrActiveTask.IsDBNull(1)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrActiveTask.GetString(1) });
                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                    if (!rdrActiveTask.IsDBNull(2)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrActiveTask.GetString(2) });
                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                    if (!rdrActiveTask.IsDBNull(3)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrActiveTask.GetString(3) });
                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                    if (!rdrActiveTask.IsDBNull(4)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrActiveTask.GetString(4) });
                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                    if (!rdrActiveTask.IsDBNull(5)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrActiveTask.GetString(5) });
                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                    if (!rdrActiveTask.IsDBNull(6)) row.Cells.Add(new CalendarCell { Value = rdrActiveTask.GetDateTime(6).ToString("MM/dd/yyyy") });
                    else row.Cells.Add(new CalendarCell { Value = String.Empty });
                    if (!rdrActiveTask.IsDBNull(7)) row.Cells.Add(new CalendarCell { Value = rdrActiveTask.GetDateTime(7).ToString("MM/dd/yyyy") });
                    else row.Cells.Add(new CalendarCell { Value = String.Empty });
                    if (!rdrActiveTask.IsDBNull(8)) row.Cells.Add(new CalendarCell { Value = rdrActiveTask.GetDateTime(8).ToString("MM/dd/yyyy") });
                    else row.Cells.Add(new CalendarCell { Value = String.Empty });
                    if (!rdrActiveTask.IsDBNull(9)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrActiveTask.GetString(9) });
                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                    if (!rdrActiveTask.IsDBNull(10)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrActiveTask.GetString(10) });
                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                    if (!rdrActiveTask.IsDBNull(11)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrActiveTask.GetString(11) });
                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                    if (!rdrActiveTask.IsDBNull(12)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrActiveTask.GetString(12) });
                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });

                    if (IsHandleCreated) AddRowToActiveTaskNPManagerSafely(row);
                    else gvNPManagerActiveTask.Rows.Add(row);

                }
            }
            rdrActiveTask.Close();
            if (connRN.State == ConnectionState.Open) connRN.Close();
        }

        private void AddRowToActiveTaskRNManagerSafely(DataGridViewRow row)
        {
            gvRNManagerActiveTask.BeginInvoke(new AddRowToActiveTaskRNManager(AddRowActiveTaskRNManager), row);
        }

        private void RemoveRowActiveTaskRNManagerSafely(int nRow)
        {
            gvRNManagerActiveTask.BeginInvoke(new RemoveActiveTaskRNManager(RemoveRowActiveTaskRNManager), nRow);
        }

        private void RemoveAllActiveTaskRNManagerSafely()
        {
            gvRNManagerActiveTask.BeginInvoke(new RemoveAllActiveTaskRNManager(RemoveAllRowActiveTaskRNManager));
        }

        private void AddRowActiveTaskRNManager(DataGridViewRow row)
        {
            gvRNManagerActiveTask.Rows.Add(row);
        }

        private void RemoveRowActiveTaskRNManager(int i)
        {
            gvRNManagerActiveTask.Rows.RemoveAt(i);
        }

        private void RemoveAllRowActiveTaskRNManager()
        {
            gvRNManagerActiveTask.Rows.Clear();
        }

        private void AddRowToActiveTaskRNStaffSafely(DataGridViewRow row)
        {
            gvRNStaffActiveTask.BeginInvoke(new AddRowToActiveTaskRNStaff(AddRowActiveTaskRNStaff), row);
        }

        private void RemoveRowActiveTaskRNStaffSafely(int nRow)
        {
            gvRNStaffActiveTask.BeginInvoke(new RemoveActiveTaskRNStaff(RemoveRowActiveTaskRNStaff), nRow);
        }

        private void RemoveAllRowActiveTaskRNStaffSafely()
        {
            gvRNStaffActiveTask.BeginInvoke(new RemoveAllActiveTaskRNStaff(RemoveAllRowActiveTaskRNStaff));
        }

        private void AddRowActiveTaskRNStaff(DataGridViewRow row)
        {
            gvRNStaffActiveTask.Rows.Add(row);
        }

        private void RemoveRowActiveTaskRNStaff(int i)
        {
            gvRNStaffActiveTask.Rows.RemoveAt(i);
        }

        private void RemoveAllRowActiveTaskRNStaff()
        {
            gvRNStaffActiveTask.Rows.Clear();
        }

        private void OnActiveTaskRNManagerChange(object sender, SqlNotificationEventArgs e)
        {
            if (e.Type == SqlNotificationType.Change)
            {
                SqlDependency dependency = sender as SqlDependency;
                dependency.OnChange -= OnActiveTaskRNManagerChange;

                UpdateGridViewActiveTaskRNManager();
            }
        }

        private void UpdateGridViewActiveTaskRNManager()
        {

            String strSqlQueryForActiveTasks = "select [dbo].[tbl_task].[whoid], [dbo].[tbl_task].[IndividualName], " +
                                               "[dbo].[tbl_task_assigned_to].[User_Name], [dbo].[tbl_task_created_by].[User_Name], " +
                                               "[dbo].[tbl_task].[whatid], " +
                                               "[dbo].[tbl_task].[Subject], [dbo].[tbl_task].[DueDate], [dbo].[tbl_task].[CreateDate], " +
                                               "[dbo].[tbl_task].[ActivityDate], [dbo].[tbl_task].[Comment], [dbo].[tbl_task].[Solution], " +
                                               "[dbo].[tbl_task_status_code].[TaskStatusValue], [dbo].[tbl_task_priority_code].[TaskPriorityValue] " +
                                               "from [dbo].[tbl_task] " +
                                               "inner join [dbo].[tbl_task_assigned_to] on [dbo].[tbl_task].[AssignedTo] = [dbo].[tbl_task_assigned_to].[User_Id] " +
                                               "inner join [dbo].[tbl_task_created_by] on [dbo].[tbl_task].[CreatedById] = [dbo].[tbl_task_created_by].[User_Id] " +
                                               "inner join [dbo].[tbl_task_status_code] on [dbo].[tbl_task].[Status] = [dbo].[tbl_task_status_code].[TaskStatusCode] " +
                                               "inner join [dbo].[tbl_task_priority_code] on [dbo].[tbl_task].[Priority] = [dbo].[tbl_task_priority_code].[TaskPriorityCode] " +
                                               "inner join [dbo].[tbl_assigned_to_role] on [dbo].[tbl_task_assigned_to].[User_Role_Id] = [dbo].[tbl_assigned_to_role].[User_Role_Id] " +
                                               "inner join [dbo].[tbl_created_by_role] on [dbo].[tbl_task_created_by].[User_Role_Id] = [dbo].[tbl_created_by_role].[User_Role_Id]" +
                                               "where ([dbo].[tbl_task].[IsDeleted] IS NULL or [dbo].[tbl_task].[IsDeleted] = 0) and " +
                                               "([dbo].[tbl_task].[AssignedTo] = @AssignedToId or " +
                                               "[dbo].[tbl_task].[CreatedById] = @CreatedById) and " +
                                               "([dbo].[tbl_assigned_to_role].[User_Role_Id] = 5 or " +
                                               "[dbo].[tbl_created_by_role].[User_Role_Id] = 5 or" +
                                               "[dbo].[tbl_assigned_to_role].[User_Role_Id] = 2 or" +
                                               "[dbo].[tbl_created_by_role].[User_Role_Id] = 2) and " +
                                               "[dbo].[tbl_task].[Status] <> 2 and [dbo].[tbl_task].[Status] <> 5";

            SqlCommand cmdQueryForActiveTasks = new SqlCommand(strSqlQueryForActiveTasks, connRN);
            cmdQueryForActiveTasks.CommandType = CommandType.Text;

            cmdQueryForActiveTasks.Parameters.AddWithValue("@AssignedToId", nLoggedUserId);
            cmdQueryForActiveTasks.Parameters.AddWithValue("@CreatedById", nLoggedUserId);

            SqlDependency dependency = new SqlDependency(cmdQueryForActiveTasks);
            dependency.OnChange += new OnChangeEventHandler(OnActiveTaskRNManagerChange);

            if (connRN.State != ConnectionState.Closed)
            {
                connRN.Close();
                connRN.Open();
            }
            else if (connRN.State == ConnectionState.Closed) connRN.Open();

            if (IsHandleCreated) RemoveAllActiveTaskRNManagerSafely();
            else gvRNManagerActiveTask.Rows.Clear();

            SqlDataReader rdrActiveTasks = cmdQueryForActiveTasks.ExecuteReader();
            if (rdrActiveTasks.HasRows)
            {
                while (rdrActiveTasks.Read())
                {
                    DataGridViewRow row = new DataGridViewRow();
                    if (!rdrActiveTasks.IsDBNull(0)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrActiveTasks.GetString(0) });
                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                    if (!rdrActiveTasks.IsDBNull(1)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrActiveTasks.GetString(1) });
                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                    if (!rdrActiveTasks.IsDBNull(2)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrActiveTasks.GetString(2) });
                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                    if (!rdrActiveTasks.IsDBNull(3)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrActiveTasks.GetString(3) });
                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                    if (!rdrActiveTasks.IsDBNull(4)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrActiveTasks.GetString(4) });
                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                    if (!rdrActiveTasks.IsDBNull(5)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrActiveTasks.GetString(5) });
                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                    if (!rdrActiveTasks.IsDBNull(6)) row.Cells.Add(new CalendarCell { Value = rdrActiveTasks.GetDateTime(6).ToString("MM/dd/yyyy") });
                    else row.Cells.Add(new CalendarCell { Value = String.Empty });
                    if (!rdrActiveTasks.IsDBNull(7)) row.Cells.Add(new CalendarCell { Value = rdrActiveTasks.GetDateTime(7).ToString("MM/dd/yyyy") });
                    else row.Cells.Add(new CalendarCell { Value = String.Empty });
                    if (!rdrActiveTasks.IsDBNull(8)) row.Cells.Add(new CalendarCell { Value = rdrActiveTasks.GetDateTime(8).ToString("MM/dd/yyyy") });
                    else row.Cells.Add(new CalendarCell { Value = String.Empty });
                    if (!rdrActiveTasks.IsDBNull(9)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrActiveTasks.GetString(9) });
                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                    if (!rdrActiveTasks.IsDBNull(10)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrActiveTasks.GetString(10) });
                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                    if (!rdrActiveTasks.IsDBNull(11)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrActiveTasks.GetString(11) });
                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                    if (!rdrActiveTasks.IsDBNull(12)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrActiveTasks.GetString(12) });
                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });

                    if (IsHandleCreated) AddRowToActiveTaskRNManagerSafely(row);
                    else gvRNManagerActiveTask.Rows.Add(row);
                }
            }
            rdrActiveTasks.Close();
            if (connRN.State == ConnectionState.Open) connRN.Close();
        }

        private void AddRowToCompleteTaskRNManagerSafely(DataGridViewRow row)
        {
            gvRNManagerCompleteTask.BeginInvoke(new AddRowToCompleteTaskRNManager(AddRowCompleteTaskRNManager), row);
        }

        private void RemoveRowCompleteTaskRNManagerSafely(int nRow)
        {
            gvRNManagerCompleteTask.BeginInvoke(new RemoveCompleteTaskRNManager(RemoveRowCompleteTaskRNManager), nRow);
        }

        private void ClearCompleteTaskRNManagerSafely()
        {
            gvRNManagerCompleteTask.BeginInvoke(new RemoveAllCompleteTaskRNManager(RemoveAllRowCompleteTaskRNManager));
        }

        private void AddRowCompleteTaskRNManager(DataGridViewRow row)
        {
            gvRNManagerCompleteTask.Rows.Add(row);
        }

        private void RemoveRowCompleteTaskRNManager(int nRow)
        {
            gvRNManagerCompleteTask.Rows.RemoveAt(nRow);
        }

        private void RemoveAllRowCompleteTaskRNManager()
        {
            gvRNManagerCompleteTask.Rows.Clear();
        }




        private void OnCompleteTaskRNManagerChange(object sender, SqlNotificationEventArgs e)
        {
            if (e.Type == SqlNotificationType.Change)
            {
                SqlDependency dependency = sender as SqlDependency;
                dependency.OnChange -= OnCompleteTaskRNManagerChange;

                UpdateGridViewCompleteTaskRNManager();
            }
        }

        private void UpdateGridViewCompleteTaskRNManager()
        {
            String strSqlQueryForCompleteTask = "select [dbo].[tbl_task].[whoid], [dbo].[tbl_task].[IndividualName], [dbo].[tbl_task].[Subject], " +
                                                "[dbo].[tbl_task].[CreateDate], [dbo].[tbl_task].[ActivityDate], [dbo].[tbl_task].[Comment], [dbo].[tbl_task].[Solution] " +
                                                "from [dbo].[tbl_task] " +
                                                "inner join [dbo].[tbl_task_assigned_to] on [dbo].[tbl_task].[AssignedTo] = [dbo].[tbl_task_assigned_to].[User_Id] " +
                                                "inner join [dbo].[tbl_task_created_by] on [dbo].[tbl_task].[CreatedById] = [dbo].[tbl_task_created_by].[User_Id] " +
                                                "inner join [dbo].[tbl_assigned_to_role] on [dbo].[tbl_task_assigned_to].[User_Role_Id] = [dbo].[tbl_assigned_to_role].[User_Role_Id] " +
                                                "inner join [dbo].[tbl_created_by_role] on [dbo].[tbl_task_created_by].[User_Role_Id] = [dbo].[tbl_created_by_role].[User_Role_Id]" +
                                                "where ([dbo].[tbl_task].[IsDeleted] IS NULL or [dbo].[tbl_task].[IsDeleted] = 0) and " +
                                                "([dbo].[tbl_task].[AssignedTo] = @AssignedToId or " +
                                                "[dbo].[tbl_task].[CreatedById] = @CreatedById) and " +
                                                "([dbo].[tbl_assigned_to_role].[User_Role_Id] = 5 or " +
                                                "[dbo].[tbl_created_by_role].[User_Role_Id] = 5 or" +
                                                "[dbo].[tbl_assigned_to_role].[User_Role_Id] = 2 or " +
                                                "[dbo].[tbl_created_by_role].[User_Role_Id] = 2) and " +
                                                "([dbo].[tbl_task].[Status] = 2 or [dbo].[tbl_task].[Status] = 5)";

            SqlCommand cmdQueryForCompleteTask = new SqlCommand(strSqlQueryForCompleteTask, connRN);
            cmdQueryForCompleteTask.CommandType = CommandType.Text;

            cmdQueryForCompleteTask.Parameters.AddWithValue("@AssignedToId", nLoggedUserId);
            cmdQueryForCompleteTask.Parameters.AddWithValue("@CreatedById", nLoggedUserId);

            SqlDependency dependencyComplete = new SqlDependency(cmdQueryForCompleteTask);
            dependencyComplete.OnChange += new OnChangeEventHandler(OnCompleteTaskRNManagerChange);

            if (connRN.State != ConnectionState.Closed)
            {
                connRN.Close();
                connRN.Open();
            }
            else if (connRN.State == ConnectionState.Closed) connRN.Open();

            SqlDataReader rdrCompleteTask = cmdQueryForCompleteTask.ExecuteReader();

            if (IsHandleCreated) ClearCompleteTaskRNManagerSafely();
            else gvRNManagerCompleteTask.Rows.Clear();
            if (rdrCompleteTask.HasRows)
            {
                while (rdrCompleteTask.Read())
                {
                    DataGridViewRow row = new DataGridViewRow();
                    if (!rdrCompleteTask.IsDBNull(0)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrCompleteTask.GetString(0) });
                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                    if (!rdrCompleteTask.IsDBNull(1)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrCompleteTask.GetString(1) });
                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                    if (!rdrCompleteTask.IsDBNull(2)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrCompleteTask.GetString(2) });
                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                    if (!rdrCompleteTask.IsDBNull(3)) row.Cells.Add(new CalendarCell { Value = rdrCompleteTask.GetDateTime(3).ToString("MM/dd/yyyy") });
                    else row.Cells.Add(new CalendarCell { Value = String.Empty });
                    if (!rdrCompleteTask.IsDBNull(4)) row.Cells.Add(new CalendarCell { Value = rdrCompleteTask.GetDateTime(4).ToString("MM/dd/yyyy") });
                    else row.Cells.Add(new CalendarCell { Value = String.Empty });
                    if (!rdrCompleteTask.IsDBNull(5)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrCompleteTask.GetString(5) });
                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                    if (!rdrCompleteTask.IsDBNull(6)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrCompleteTask.GetString(6) });
                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });

                    if (IsHandleCreated) AddRowToCompleteTaskRNManagerSafely(row);
                    else gvRNManagerCompleteTask.Rows.Add(row);
                }
            }
            rdrCompleteTask.Close();
            if (connRN.State == ConnectionState.Open) connRN.Close();
        }

        private void AddRowToCompleteTaskRNStaffSafely(DataGridViewRow row)
        {
            gvRNStaffCompleteTask.BeginInvoke(new AddRowToCompleteTaskRNStaff(AddRowCompleteTaskRNStaff), row);
        }

        private void RemoveRowCompleteTaskRNStaffSafely(int nRow)
        {
            gvRNStaffCompleteTask.BeginInvoke(new RemoveCompleteTaskRNStaff(RemoveRowCompleteTaskRNStaff), nRow);
        }

        private void ClearCompleteTaskRNStaffSafely()
        {
            gvRNStaffCompleteTask.BeginInvoke(new RemoveAllCompleteTaskRNStaff(RemoveAllRowCompleteTaskRNStaff));
        }

        private void AddRowCompleteTaskRNStaff(DataGridViewRow row)
        {
            gvRNStaffCompleteTask.Rows.Add(row);
        }

        private void RemoveRowCompleteTaskRNStaff(int nRow)
        {
            gvRNStaffCompleteTask.Rows.RemoveAt(nRow);
        }

        private void RemoveAllRowCompleteTaskRNStaff()
        {
            gvRNStaffCompleteTask.Rows.Clear();
        }

        private void OnCompleteTaskRNStaffChange(object sender, SqlNotificationEventArgs e)
        {
            if (e.Type == SqlNotificationType.Change)
            {
                SqlDependency dependency = sender as SqlDependency;
                dependency.OnChange -= OnCompleteTaskRNStaffChange;

                UpdateGridViewCompleteTaskRNStaff();
            }
        }

        private void UpdateGridViewCompleteTaskRNStaff()
        {
            String strSqlQueryForCompleteTask = "select [dbo].[tbl_task].[whoid], [dbo].[tbl_task].[IndividualName], [dbo].[tbl_task].[Subject], " +
                            "[dbo].[tbl_task].[CreateDate], [dbo].[tbl_task].[ActivityDate], [dbo].[tbl_task].[Comment], [dbo].[tbl_task].[Solution] " +
                            "from [dbo].[tbl_task] " +
                            "inner join [dbo].[tbl_task_assigned_to] on [dbo].[tbl_task].[AssignedTo] = [dbo].[tbl_task_assigned_to].[User_Id] " +
                            "inner join [dbo].[tbl_task_created_by] on [dbo].[tbl_task].[CreatedById] = [dbo].[tbl_task_created_by].[User_Id] " +
                            "inner join [dbo].[tbl_assigned_to_role] on [dbo].[tbl_task_assigned_to].[User_Role_Id] = [dbo].[tbl_assigned_to_role].[User_Role_Id] " +
                            "inner join [dbo].[tbl_created_by_role] on [dbo].[tbl_task_created_by].[User_Role_Id] = [dbo].[tbl_created_by_role].[User_Role_Id]" +
                            "where ([dbo].[tbl_task].[AssignedTo] = @AssignedToId or " +
                            "[dbo].[tbl_task].[CreatedById] = @CreatedById) and " +
                            "([dbo].[tbl_task].[Status] = 2 or [dbo].[tbl_task].[Status] = 5)";

            SqlCommand cmdQueryForCompleteTask = new SqlCommand(strSqlQueryForCompleteTask, connRN);
            cmdQueryForCompleteTask.CommandType = CommandType.Text;

            cmdQueryForCompleteTask.Parameters.AddWithValue("@AssignedToId", nLoggedUserId);
            cmdQueryForCompleteTask.Parameters.AddWithValue("@CreatedById", nLoggedUserId);

            SqlDependency dependencyCompleteTasks = new SqlDependency(cmdQueryForCompleteTask);
            dependencyCompleteTasks.OnChange += new OnChangeEventHandler(OnCompleteTaskRNStaffChange);

            if (connRN.State != ConnectionState.Closed)
            {
                connRN.Close();
                connRN.Open();
            }
            else if (connRN.State == ConnectionState.Closed) connRN.Open();
            if (IsHandleCreated) ClearCompleteTaskRNStaffSafely();
            else gvRNStaffCompleteTask.Rows.Clear();
            SqlDataReader rdrCompleteTasks = cmdQueryForCompleteTask.ExecuteReader();
            if (rdrCompleteTasks.HasRows)
            {
                while (rdrCompleteTasks.Read())
                {
                    DataGridViewRow row = new DataGridViewRow();
                    if (!rdrCompleteTasks.IsDBNull(0)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrCompleteTasks.GetString(0) });
                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                    if (!rdrCompleteTasks.IsDBNull(1)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrCompleteTasks.GetString(1) });
                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                    if (!rdrCompleteTasks.IsDBNull(2)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrCompleteTasks.GetString(2) });
                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                    if (!rdrCompleteTasks.IsDBNull(3)) row.Cells.Add(new CalendarCell { Value = rdrCompleteTasks.GetDateTime(3).ToString("MM/dd/yyyy") });
                    else row.Cells.Add(new CalendarCell { Value = String.Empty });
                    if (!rdrCompleteTasks.IsDBNull(4)) row.Cells.Add(new CalendarCell { Value = rdrCompleteTasks.GetDateTime(4).ToString("MM/dd/yyyy") });
                    else row.Cells.Add(new CalendarCell { Value = String.Empty });
                    if (!rdrCompleteTasks.IsDBNull(5)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrCompleteTasks.GetString(5) });
                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                    if (!rdrCompleteTasks.IsDBNull(6)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrCompleteTasks.GetString(6) });
                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });

                    if (IsHandleCreated) AddRowToCompleteTaskRNStaffSafely(row);
                    else gvRNStaffCompleteTask.Rows.Add(row);
                }
            }
            rdrCompleteTasks.Close();
            if (connRN.State == ConnectionState.Open) connRN.Close();
        }

        private void OnActiveTaskRNStaffChange(object sender, SqlNotificationEventArgs e)
        {
            if (e.Type == SqlNotificationType.Change)
            {
                SqlDependency dependency = sender as SqlDependency;
                dependency.OnChange -= OnActiveTaskRNStaffChange;

                UpdateGridViewActiveTaskRNStaff();
            }
        }

        private void UpdateGridViewActiveTaskRNStaff()
        {
            String strSqlQueryForActiveTasks = "select [dbo].[tbl_task].[whoid], [dbo].[tbl_task].[IndividualName], " +
                                   "[dbo].[tbl_task_assigned_to].[User_Name], [dbo].[tbl_task_created_by].[User_Name], " +
                                   "[dbo].[tbl_task].[whatid], " +
                                   "[dbo].[tbl_task].[Subject], [dbo].[tbl_task].[DueDate], [dbo].[tbl_task].[CreateDate], " +
                                   "[dbo].[tbl_task].[ActivityDate], [dbo].[tbl_task].[Comment], [dbo].[tbl_task].[Solution], " +
                                   "[dbo].[tbl_task_status_code].[TaskStatusValue], [dbo].[tbl_task_priority_code].[TaskPriorityValue] " +
                                   "from [dbo].[tbl_task] " +
                                   "inner join [dbo].[tbl_task_created_by] on [dbo].[tbl_task].[CreatedById] = [dbo].[tbl_task_created_by].[User_Id] " +
                                   "inner join [dbo].[tbl_task_assigned_to] on [dbo].[tbl_task].[AssignedTo] = [dbo].[tbl_task_assigned_to].[User_Id] " +
                                   "inner join [dbo].[tbl_task_status_code] on [dbo].[tbl_task].[Status] = [dbo].[tbl_task_status_code].[TaskStatusCode] " +
                                   "inner join [dbo].[tbl_task_priority_code] on [dbo].[tbl_task].[Priority] = [dbo].[tbl_task_priority_code].[TaskPriorityCode] " +
                                   "where ([dbo].[tbl_task].[AssignedTo] = @AssignedToId or [dbo].[tbl_task].[CreatedById] = @CreatedById) and " +
                                   "[dbo].[tbl_task].[Status] <> 2 and [dbo].[tbl_task].[Status] <> 5";

            SqlCommand cmdQueryForActiveTasks = new SqlCommand(strSqlQueryForActiveTasks, connRN);
            cmdQueryForActiveTasks.CommandType = CommandType.Text;

            cmdQueryForActiveTasks.Parameters.AddWithValue("@AssignedToId", nLoggedUserId);
            cmdQueryForActiveTasks.Parameters.AddWithValue("@CreatedById", nLoggedUserId);

            SqlDependency dependency = new SqlDependency(cmdQueryForActiveTasks);
            dependency.OnChange += new OnChangeEventHandler(OnActiveTaskRNStaffChange);

            if (connRN.State != ConnectionState.Closed)
            {
                connRN.Close();
                connRN.Open();
            }
            else if (connRN.State == ConnectionState.Closed) connRN.Open();

            if (IsHandleCreated) RemoveAllRowActiveTaskRNStaffSafely();
            else gvRNStaffActiveTask.Rows.Clear();

            SqlDataReader rdrActiveTasks = cmdQueryForActiveTasks.ExecuteReader();
            if (rdrActiveTasks.HasRows)
            {
                while (rdrActiveTasks.Read())
                {
                    DataGridViewRow row = new DataGridViewRow();
                    if (!rdrActiveTasks.IsDBNull(0)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrActiveTasks.GetString(0) });
                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                    if (!rdrActiveTasks.IsDBNull(1)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrActiveTasks.GetString(1) });
                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                    if (!rdrActiveTasks.IsDBNull(2)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrActiveTasks.GetString(2) });
                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                    if (!rdrActiveTasks.IsDBNull(3)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrActiveTasks.GetString(3) });
                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                    if (!rdrActiveTasks.IsDBNull(4)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrActiveTasks.GetString(4) });
                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                    if (!rdrActiveTasks.IsDBNull(5)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrActiveTasks.GetString(5) });
                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                    if (!rdrActiveTasks.IsDBNull(6)) row.Cells.Add(new CalendarCell { Value = rdrActiveTasks.GetDateTime(6).ToString("MM/dd/yyyy") });
                    else row.Cells.Add(new CalendarCell { Value = String.Empty });
                    if (!rdrActiveTasks.IsDBNull(7)) row.Cells.Add(new CalendarCell { Value = rdrActiveTasks.GetDateTime(7).ToString("MM/dd/yyyy") });
                    else row.Cells.Add(new CalendarCell { Value = String.Empty });
                    if (!rdrActiveTasks.IsDBNull(8)) row.Cells.Add(new CalendarCell { Value = rdrActiveTasks.GetDateTime(8).ToString("MM/dd/yyyy") });
                    else row.Cells.Add(new CalendarCell { Value = String.Empty });
                    if (!rdrActiveTasks.IsDBNull(9)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrActiveTasks.GetString(9) });
                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                    if (!rdrActiveTasks.IsDBNull(10)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrActiveTasks.GetString(10) });
                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                    if (!rdrActiveTasks.IsDBNull(11)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrActiveTasks.GetString(11) });
                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                    if (!rdrActiveTasks.IsDBNull(12)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrActiveTasks.GetString(12) });
                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });

                    if (IsHandleCreated) AddRowToActiveTaskRNStaffSafely(row);
                    else gvRNStaffActiveTask.Rows.Add(row);
                }
            }
            rdrActiveTasks.Close();
            if (connRN.State == ConnectionState.Open) connRN.Close();
        }


        private void AddRowSettlementForApprovalSafely(DataGridViewRow row)
        {
            gvSettlementsForApproval.BeginInvoke(new AddRowToSettlementForApprovalInDashboard(AddRowSettlementForApproval), row);
        }

        private void RemoveRowSettlementForApprovalSafely(int i)
        {
            gvSettlementsForApproval.BeginInvoke(new RemoveSettlementForApprovalInDashboard(RemoveRowSettlementForApproval), i);
        }

        private void ClearSettlementForApprovalSafely()
        {
            gvSettlementsForApproval.BeginInvoke(new RemoveAllSettlementForApprovalInDashboard(RemoveAllSettlementForApproval));
        }

        private void AddRowSettlementForApproval(DataGridViewRow row)
        {
            gvSettlementsForApproval.Rows.Add(row);
        }

        private void RemoveRowSettlementForApproval(int i)
        {
            gvSettlementsForApproval.Rows.RemoveAt(i);
        }

        private void RemoveAllSettlementForApproval()
        {
            gvSettlementsForApproval.Rows.Clear();
        }

        private void OnSettlementForApprovalChange(object sender, SqlNotificationEventArgs e)
        {
            if (e.Type == SqlNotificationType.Change)
            {
                SqlDependency dependency = sender as SqlDependency;
                dependency.OnChange -= OnSettlementForApprovalChange;

                UpdateGridViewSettlementForApproval();
            }
        }

        private void UpdateGridViewSettlementForApproval()
        {
            String strSqlQueryForSettlementsForApproval = "select [dbo].[tbl_medbill].[BillNo], [dbo].[tbl_medbill].[Individual_Id], " +
                                                "[dbo].[tbl_settlement].[Name], [dbo].[tbl_settlement_type_code].[SettlementTypeValue], [dbo].[tbl_settlement].[Amount], " +
                                                "[dbo].[tbl_incident].[IsWellBeing] " +
                                                "from [dbo].[tbl_settlement] " +
                                                "inner join [dbo].[tbl_medbill] on [dbo].[tbl_settlement].[MedicalBillID] = [dbo].[tbl_medbill].[BillNo] " +
                                                "inner join [dbo].[tbl_settlement_type_code] on [dbo].[tbl_settlement].[SettlementType] = [dbo].[tbl_settlement_type_code].[SettlementTypeCode] " +
                                                "inner join [dbo].[tbl_incident] on [dbo].[tbl_medbill].[Incident_Id] = [dbo].[tbl_incident].[Incident_id] " +
                                                "where ([dbo].[tbl_settlement_type_code].[SettlementTypeValue] = 'CMM Member Reimbursement' or " +
                                                "[dbo].[tbl_settlement_type_code].[SettlementTypeValue] = 'CMM Provider Payment' or " +
                                                "[dbo].[tbl_settlement_type_code].[SettlementTypeValue] = 'PR Reimbursement') and " +
                                                "([dbo].[tbl_settlement].[IsDeleted] IS NULL or[dbo].[tbl_settlement].[IsDeleted] = 0) and " +
                                                "([dbo].[tbl_settlement].[Approved] IS NULL or [dbo].[tbl_settlement].[Approved] = 0) " +
                                                "order by [dbo].[tbl_settlement].[CreateDate]";

            SqlCommand cmdQueryForSettlementsForApproval = new SqlCommand(strSqlQueryForSettlementsForApproval, connRN);
            cmdQueryForSettlementsForApproval.CommandType = CommandType.Text;

            SqlDependency dependencySettlementForApproval = new SqlDependency(cmdQueryForSettlementsForApproval);
            dependencySettlementForApproval.OnChange += new OnChangeEventHandler(OnSettlementForApprovalChange);

            if (connRN.State != ConnectionState.Closed)
            {
                connRN.Close();
                connRN.Open();
            }
            else if (connRN.State == ConnectionState.Closed) connRN.Open();
            SqlDataReader rdrSettlementForApproval = cmdQueryForSettlementsForApproval.ExecuteReader();
            if (rdrSettlementForApproval.HasRows)
            {
                while (rdrSettlementForApproval.Read())
                {
                    SettlementInfoForApproval info = new SettlementInfoForApproval();
                    if (!rdrSettlementForApproval.IsDBNull(0)) info.MedBillNo = rdrSettlementForApproval.GetString(0);
                    if (!rdrSettlementForApproval.IsDBNull(1)) info.IndividualId = rdrSettlementForApproval.GetString(1);
                    if (!rdrSettlementForApproval.IsDBNull(2)) info.SettlementNo = rdrSettlementForApproval.GetString(2);
                    if (!rdrSettlementForApproval.IsDBNull(3)) info.SettlementType = rdrSettlementForApproval.GetString(3);
                    if (!rdrSettlementForApproval.IsDBNull(4)) info.SettlementAmount = rdrSettlementForApproval.GetDecimal(4);
                    if (!rdrSettlementForApproval.IsDBNull(5)) info.IsWellBeing = rdrSettlementForApproval.GetBoolean(5);
                    lstSettlementInfoForApproval.Add(info);
                }
            }
            rdrSettlementForApproval.Close();
            if (connRN.State != ConnectionState.Closed) connRN.Close();

            foreach (SettlementInfoForApproval info in lstSettlementInfoForApproval)
            {
                String strSqlQueryForIndividualName = "select [dbo].[contact].[Name] from [dbo].[contact] where [dbo].[contact].[Individual_ID__c] = @IndividualId";

                SqlCommand cmdQueryForIndividualName = new SqlCommand(strSqlQueryForIndividualName, connSalesforce);
                cmdQueryForIndividualName.Parameters.AddWithValue("@IndividualId", info.IndividualId);

                if (connSalesforce.State != ConnectionState.Closed)
                {
                    connSalesforce.Close();
                    connSalesforce.Open();
                }
                else if (connSalesforce.State == ConnectionState.Closed) connSalesforce.Open();
                Object objIndividualName = cmdQueryForIndividualName.ExecuteScalar();
                if (connSalesforce.State != ConnectionState.Closed) connSalesforce.Close();

                if (objIndividualName != null) info.IndividualName = objIndividualName.ToString();
            }

            if (IsHandleCreated) ClearSettlementForApprovalSafely();
            else gvSettlementsForApproval.Rows.Clear();
            foreach (SettlementInfoForApproval info in lstSettlementInfoForApproval)
            {
                DataGridViewRow row = new DataGridViewRow();
                if (info.MedBillNo != String.Empty) row.Cells.Add(new DataGridViewTextBoxCell { Value = info.MedBillNo });
                else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                if (info.IndividualId != String.Empty) row.Cells.Add(new DataGridViewTextBoxCell { Value = info.IndividualId });
                else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                if (info.IndividualName != String.Empty) row.Cells.Add(new DataGridViewTextBoxCell { Value = info.IndividualName });
                else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                if (info.SettlementNo != String.Empty) row.Cells.Add(new DataGridViewTextBoxCell { Value = info.SettlementNo });
                else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                if (info.SettlementType != String.Empty) row.Cells.Add(new DataGridViewTextBoxCell { Value = info.SettlementType });
                else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                if (info.SettlementAmount >= 0) row.Cells.Add(new DataGridViewTextBoxCell { Value = info.SettlementAmount.ToString("C") });
                row.Cells.Add(new DataGridViewCheckBoxCell { Value = info.IsWellBeing });
                if (info.IsWellBeing == true) row.DefaultCellStyle.BackColor = Color.LightPink;
                if (IsHandleCreated) AddRowSettlementForApprovalSafely(row);
                else gvSettlementsForApproval.Rows.Add(row);
            }
        }

        private void frmCMMManager_Load(object sender, EventArgs e)
        {
            //tbCMMManager.TabPages.Remove(tbpgDashboardFDManager);
            //tbCMMManager.TabPages.Remove(tbpgDashboardFDStaff);
            //tbCMMManager.TabPages.Remove(tbpgDashboardNPManager);
            //tbCMMManager.TabPages.Remove(tbpgDashboardNPStaff);
            //tbCMMManager.TabPages.Remove(tbpgDashboardRNManager);
            //tbCMMManager.TabPages.Remove(tbpgIndividual);
            //tbCMMManager.TabPages.Remove(tbpgCaseView);
            //tbCMMManager.TabPages.Remove(tbpgCreateCase);
            //tbCMMManager.TabPages.Remove(tbpgMedicalBill);
            //tbCMMManager.TabPages.Remove(tbpgIllnessView);

            frmLogin frmLogin = new frmLogin();
            frmLogin.StartPosition = FormStartPosition.CenterParent;

            Boolean bLoginSuccess = false;

            for (int i = 0; i < 3; i++)
            {
                DialogResult loginResult = frmLogin.ShowDialog();

                if (loginResult == DialogResult.OK)
                {
                    bLoginSuccess = true;
                    nLoggedUserId = frmLogin.nLoggedUserId;
                    LoggedInUserName = frmLogin.LoggedInUserName;
                    LoggedInUserRole = frmLogin.nLoggedUserRole;
                    LoggedInUserDepartment = frmLogin.nLoggedInUserDepartmentId;

                    break;
                }
                else if (loginResult == DialogResult.Cancel)
                {
                    MessageBox.Show("Login Canceled", "Alert");
                    break;
                }
                else if (loginResult == DialogResult.Retry)
                {
                    continue;
                }
            }

            if (bLoginSuccess == false) Close();

            // Browse buttons for Case Creation tab
            if (bLoginSuccess == true)
            {
                //tbCMMManager.TabPages.Remove(tbpgDashboardFDManager);
                //tbCMMManager.TabPages.Remove(tbpgDashboardFDStaff);
                //tbCMMManager.TabPages.Remove(tbpgDashboardNPManager);
                //tbCMMManager.TabPages.Remove(tbpgDashboardNPStaff);
                //tbCMMManager.TabPages.Remove(tbpgDashboardRNManager);
                //tbCMMManager.TabPages.Remove(tbpgIndividual);
                //tbCMMManager.TabPages.Remove(tbpgCaseView);
                //tbCMMManager.TabPages.Remove(tbpgCreateCase);
                //tbCMMManager.TabPages.Remove(tbpgMedicalBill);

                DisableIndividualView();
                DisableCaseView();
                DisableIllnessView();
                DisableIncidentView();
                DisableMedBillView();
                DisableCaseForm();
                DisableMedicalBillForm();

                btnIndViewUpdateUpperRight.Enabled = false;
                //btnIndViewUpdateLowerRight.Enabled = false;
                btnCaseCreationSaveUpper.Enabled = false;
                //btnCaseCreationLowerSave.Enabled = false;
                btnMedBillCreatePgUpperSave.Enabled = false;
                //btnMedBillCreationPgLowerSave.Enabled = false;

                lblPrescriptionName.Visible = false;
                lblPrescriptionDescription.Visible = false;
                lblPrescriptionNote.Visible = false;
                lblNumberOfMedication.Visible = false;

                txtPrescriptionName.Visible = false;
                txtPrescriptionDescription.Visible = false;
                txtPrescriptionNote.Visible = false;
                txtNumberOfMedication.Visible = false;

                lblNumberOfPhysicalTheraph.Visible = false;
                txtNumPhysicalTherapy.Visible = false;
                lblPhysicalTherapyRxNote.Visible = false;
                txtPhysicalTherapyRxNote.Visible = false;

                rbInpatient.Visible = true;
                rbOutpatient.Visible = true;

                lblMedBillNote.Visible = true;
                txtMedBillNote.Visible = true;

                lblPendingReason.Visible = true;
                comboPendingReason.Visible = true;

                lblIneligibleReason.Visible = true;
                comboIneligibleReason.Visible = true;

                if (LoggedInUserRole == UserRole.SuperAdmin)
                {
                    tbCMMManager.TabPages.Remove(tbpgDashboardNPManager);
                    tbCMMManager.TabPages.Remove(tbpgDashboardRNManager);
                    tbCMMManager.TabPages.Remove(tbpgDashboardFDStaff);
                    tbCMMManager.TabPages.Remove(tbpgDashboardNPStaff);
                    tbCMMManager.TabPages.Remove(tbpgDashboardRNStaff);
                }

                if (LoggedInUserRole == UserRole.NPManager)
                {
                    tbCMMManager.TabPages.Remove(tbpgDashboardFDManager);
                    tbCMMManager.TabPages.Remove(tbpgDashboardRNManager);
                    tbCMMManager.TabPages.Remove(tbpgDashboardFDStaff);
                    tbCMMManager.TabPages.Remove(tbpgDashboardRNStaff);
                    tbCMMManager.TabPages.Remove(tbpgDashboardNPStaff);

                    String strSqlQueryForActiveTasks = "select [dbo].[tbl_task].[whoid], [dbo].[tbl_task].[IndividualName], " +
                                   "[dbo].[tbl_task_assigned_to].[User_Name], [dbo].[tbl_task_created_by].[User_Name], " +
                                   "[dbo].[tbl_task].[whatid], " +
                                   "[dbo].[tbl_task].[Subject], [dbo].[tbl_task].[DueDate], [dbo].[tbl_task].[CreateDate], " +
                                   "[dbo].[tbl_task].[ActivityDate], [dbo].[tbl_task].[Comment], [dbo].[tbl_task].[Solution], " +
                                   "[dbo].[tbl_task_status_code].[TaskStatusValue], [dbo].[tbl_task_priority_code].[TaskPriorityValue] " +
                                   "from [dbo].[tbl_task] " +
                                   "inner join [dbo].[tbl_task_assigned_to] on [dbo].[tbl_task].[AssignedTo] = [dbo].[tbl_task_assigned_to].[User_Id] " +
                                   "inner join [dbo].[tbl_task_created_by] on [dbo].[tbl_task].[CreatedById] = [dbo].[tbl_task_created_by].[User_Id] " +
                                   "inner join [dbo].[tbl_task_status_code] on [dbo].[tbl_task].[Status] = [dbo].[tbl_task_status_code].[TaskStatusCode] " +
                                   "inner join [dbo].[tbl_task_priority_code] on [dbo].[tbl_task].[Priority] = [dbo].[tbl_task_priority_code].[TaskPriorityCode] " +
                                   "inner join [dbo].[tbl_assigned_to_role] on [dbo].[tbl_task_assigned_to].[User_Role_Id] = [dbo].[tbl_assigned_to_role].[User_Role_Id] " +
                                   "inner join [dbo].[tbl_created_by_role] on [dbo].[tbl_task_created_by].[User_Role_Id] = [dbo].[tbl_created_by_role].[User_Role_Id]" +
                                   "where ([dbo].[tbl_task].[AssignedTo] = @AssignedToId or " +
                                   "[dbo].[tbl_task].[CreatedById] = @CreatedById) and " +
                                   "([dbo].[tbl_assigned_to_role].[User_Role_Id] = 6 or " +
                                   "[dbo].[tbl_created_by_role].[User_Role_Id] = 6 or " +
                                   "[dbo].[tbl_assigned_to_role].[User_Role_Id] = 3 or" +
                                   "[dbo].[tbl_created_by_role].[User_Role_Id] = 3) and " +
                                   "[dbo].[tbl_task].[Status] <> 2 and [dbo].[tbl_task].[Status] <> 5";

                    SqlCommand cmdQueryForActiveTask = new SqlCommand(strSqlQueryForActiveTasks, connRN);
                    cmdQueryForActiveTask.CommandType = CommandType.Text;

                    cmdQueryForActiveTask.Parameters.AddWithValue("@AssignedToId", nLoggedUserId);
                    cmdQueryForActiveTask.Parameters.AddWithValue("@CreatedById", nLoggedUserId);

                    SqlDependency dependency = new SqlDependency(cmdQueryForActiveTask);
                    dependency.OnChange += new OnChangeEventHandler(OnActiveTaskNPManagerChange);

                    if (connRN.State != ConnectionState.Closed)
                    {
                        connRN.Close();
                        connRN.Open();
                    }
                    else if (connRN.State == ConnectionState.Closed) connRN.Open();
                    gvNPManagerActiveTask.Rows.Clear();
                    SqlDataReader rdrActiveTask = cmdQueryForActiveTask.ExecuteReader();
                    if (rdrActiveTask.HasRows)
                    {
                        while (rdrActiveTask.Read())
                        {
                            DataGridViewRow row = new DataGridViewRow();
                            if (!rdrActiveTask.IsDBNull(0)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrActiveTask.GetString(0) });
                            else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                            if (!rdrActiveTask.IsDBNull(1)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrActiveTask.GetString(1) });
                            else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                            if (!rdrActiveTask.IsDBNull(2)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrActiveTask.GetString(2) });
                            else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                            if (!rdrActiveTask.IsDBNull(3)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrActiveTask.GetString(3) });
                            else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                            if (!rdrActiveTask.IsDBNull(4)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrActiveTask.GetString(4) });
                            else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                            if (!rdrActiveTask.IsDBNull(5)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrActiveTask.GetString(5) });
                            else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                            if (!rdrActiveTask.IsDBNull(6)) row.Cells.Add(new CalendarCell { Value = rdrActiveTask.GetDateTime(6).ToString("MM/dd/yyyy") });
                            else row.Cells.Add(new CalendarCell { Value = String.Empty });
                            if (!rdrActiveTask.IsDBNull(7)) row.Cells.Add(new CalendarCell { Value = rdrActiveTask.GetDateTime(7).ToString("MM/dd/yyyy") });
                            else row.Cells.Add(new CalendarCell { Value = String.Empty });
                            if (!rdrActiveTask.IsDBNull(8)) row.Cells.Add(new CalendarCell { Value = rdrActiveTask.GetDateTime(8).ToString("MM/dd/yyyy") });
                            else row.Cells.Add(new CalendarCell { Value = String.Empty });
                            if (!rdrActiveTask.IsDBNull(9)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrActiveTask.GetString(9) });
                            else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                            if (!rdrActiveTask.IsDBNull(10)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrActiveTask.GetString(10) });
                            else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                            if (!rdrActiveTask.IsDBNull(11)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrActiveTask.GetString(11) });
                            else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                            if (!rdrActiveTask.IsDBNull(12)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrActiveTask.GetString(12) });
                            else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });

                            gvNPManagerActiveTask.Rows.Add(row);

                        }
                    }
                    rdrActiveTask.Close();
                    if (connRN.State == ConnectionState.Open) connRN.Close();

                }

                if (LoggedInUserRole == UserRole.RNManager)
                {
                    tbCMMManager.TabPages.Remove(tbpgDashboardFDManager);
                    tbCMMManager.TabPages.Remove(tbpgDashboardFDStaff);
                    tbCMMManager.TabPages.Remove(tbpgDashboardNPManager);
                    tbCMMManager.TabPages.Remove(tbpgDashboardNPStaff);
                    tbCMMManager.TabPages.Remove(tbpgDashboardRNStaff);

                    lstSettlementInfoForApproval.Clear();                    

                    String strSqlQueryForSettlementsForApproval = "select [dbo].[tbl_medbill].[BillNo], [dbo].[tbl_medbill].[Individual_Id], " +
                                                        "[dbo].[tbl_settlement].[Name], [dbo].[tbl_settlement_type_code].[SettlementTypeValue], [dbo].[tbl_settlement].[Amount], " +
                                                        "[dbo].[tbl_incident].[IsWellBeing] " +
                                                        "from [dbo].[tbl_settlement] " +
                                                        "inner join [dbo].[tbl_medbill] on [dbo].[tbl_settlement].[MedicalBillID] = [dbo].[tbl_medbill].[BillNo] " +
                                                        "inner join [dbo].[tbl_settlement_type_code] on [dbo].[tbl_settlement].[SettlementType] = [dbo].[tbl_settlement_type_code].[SettlementTypeCode] " +
                                                        "inner join [dbo].[tbl_incident] on [dbo].[tbl_medbill].[Incident_Id] = [dbo].[tbl_incident].[Incident_id] " +
                                                        "where ([dbo].[tbl_settlement_type_code].[SettlementTypeValue] = 'CMM Member Reimbursement' or " +
                                                        "[dbo].[tbl_settlement_type_code].[SettlementTypeValue] = 'CMM Provider Payment' or " +
                                                        "[dbo].[tbl_settlement_type_code].[SettlementTypeValue] = 'PR Reimbursement') and " +
                                                        "([dbo].[tbl_settlement].[IsDeleted] IS NULL or [dbo].[tbl_settlement].[IsDeleted] = 0) and " +
                                                        "([dbo].[tbl_settlement].[Approved] IS NULL or [dbo].[tbl_settlement].[Approved] = 0) " +
                                                        "order by [dbo].[tbl_settlement].[CreateDate]";

                    SqlCommand cmdQueryForSettlementsForApproval = new SqlCommand(strSqlQueryForSettlementsForApproval, connRN);
                    cmdQueryForSettlementsForApproval.CommandType = CommandType.Text;

                    SqlDependency dependencySettlementForApproval = new SqlDependency(cmdQueryForSettlementsForApproval);
                    dependencySettlementForApproval.OnChange += new OnChangeEventHandler(OnSettlementForApprovalChange);

                    if (connRN.State != ConnectionState.Closed)
                    {
                        connRN.Close();
                        connRN.Open();
                    }
                    else if (connRN.State == ConnectionState.Closed) connRN.Open();
                    SqlDataReader rdrSettlementForApproval = cmdQueryForSettlementsForApproval.ExecuteReader();
                    if (rdrSettlementForApproval.HasRows)
                    {
                        while (rdrSettlementForApproval.Read())
                        {
                            SettlementInfoForApproval info = new SettlementInfoForApproval();
                            if (!rdrSettlementForApproval.IsDBNull(0)) info.MedBillNo = rdrSettlementForApproval.GetString(0);
                            if (!rdrSettlementForApproval.IsDBNull(1)) info.IndividualId = rdrSettlementForApproval.GetString(1);
                            if (!rdrSettlementForApproval.IsDBNull(2)) info.SettlementNo = rdrSettlementForApproval.GetString(2);
                            if (!rdrSettlementForApproval.IsDBNull(3)) info.SettlementType = rdrSettlementForApproval.GetString(3);
                            if (!rdrSettlementForApproval.IsDBNull(4)) info.SettlementAmount = rdrSettlementForApproval.GetDecimal(4);
                            if (!rdrSettlementForApproval.IsDBNull(5)) info.IsWellBeing = rdrSettlementForApproval.GetBoolean(5);
                            lstSettlementInfoForApproval.Add(info);
                        }
                    }
                    rdrSettlementForApproval.Close();
                    if (connRN.State != ConnectionState.Closed) connRN.Close();

                    foreach (SettlementInfoForApproval info in lstSettlementInfoForApproval)
                    {
                        String strSqlQueryForIndividualName = "select [dbo].[contact].[Name] from [dbo].[contact] where [dbo].[contact].[Individual_ID__c] = @IndividualId";

                        SqlCommand cmdQueryForIndividualName = new SqlCommand(strSqlQueryForIndividualName, connSalesforce);
                        cmdQueryForIndividualName.Parameters.AddWithValue("@IndividualId", info.IndividualId);

                        if (connSalesforce.State != ConnectionState.Closed)
                        {
                            connSalesforce.Close();
                            connSalesforce.Open();
                        }
                        else if (connSalesforce.State == ConnectionState.Closed) connSalesforce.Open();
                        Object objIndividualName = cmdQueryForIndividualName.ExecuteScalar();
                        if (connSalesforce.State != ConnectionState.Closed) connSalesforce.Close();

                        if (objIndividualName != null) info.IndividualName = objIndividualName.ToString();
                    }

                    gvSettlementsForApproval.Rows.Clear();
                    foreach (SettlementInfoForApproval info in lstSettlementInfoForApproval)
                    {
                        DataGridViewRow row = new DataGridViewRow();
                        if (info.MedBillNo != String.Empty) row.Cells.Add(new DataGridViewTextBoxCell { Value = info.MedBillNo });
                        else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                        if (info.IndividualId != String.Empty) row.Cells.Add(new DataGridViewTextBoxCell { Value = info.IndividualId });
                        else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                        if (info.IndividualName != String.Empty) row.Cells.Add(new DataGridViewTextBoxCell { Value = info.IndividualName });
                        else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                        if (info.SettlementNo != String.Empty) row.Cells.Add(new DataGridViewTextBoxCell { Value = info.SettlementNo });
                        else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                        if (info.SettlementType != String.Empty) row.Cells.Add(new DataGridViewTextBoxCell { Value = info.SettlementType });
                        else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                        if (info.SettlementAmount >= 0) row.Cells.Add(new DataGridViewTextBoxCell { Value = info.SettlementAmount.ToString("C") });
                        row.Cells.Add(new DataGridViewCheckBoxCell { Value = info.IsWellBeing });
                        if (info.IsWellBeing == true) row.DefaultCellStyle.BackColor = Color.LightPink;
                        gvSettlementsForApproval.Rows.Add(row);
                    }

                    String strSqlQueryForIncompleteCases = "select [dbo].[tbl_case].[Case_Name], [dbo].[tbl_case].[Contact_ID], " +
                                                           "[dbo].[tbl_CreateStaff].[Staff_Name], [dbo].[tbl_ModifiStaff].[Staff_Name], " +
                                                           "[dbo].[tbl_case].[NPF_Form], [dbo].[tbl_case].[IB_Form], [dbo].[tbl_case].[POP_Form], " +
                                                           "[dbo].[tbl_case].[MedRec_Form], [dbo].[tbl_case].[Unknown_Form], [dbo].[tbl_case].[AddBill_Form] " +
                                                           "from [dbo].[tbl_case] " +
                                                           "inner join [dbo].[tbl_CreateStaff] on [dbo].[tbl_case].[CreateStaff] = [dbo].[tbl_CreateStaff].[CreateStaff_Id] " +
                                                           "inner join [dbo].[tbl_ModifiStaff] on [dbo].[tbl_case].[ModifiStaff] = [dbo].[tbl_ModifiStaff].[ModifiStaff_Id] " +
                                                           "where ([dbo].[tbl_case].[NPF_Form] = 0 or " +
                                                           "[dbo].[tbl_case].[IB_Form] = 0 or " +
                                                           "[dbo].[tbl_case].[POP_Form] = 0) and " +
                                                           "[dbo].[tbl_case].[IsDeleted] = 0";

                    SqlCommand cmdQueryForIncompleteCase = new SqlCommand(strSqlQueryForIncompleteCases, connRN);
                    cmdQueryForIncompleteCase.CommandType = CommandType.Text;

                    if (connRN.State != ConnectionState.Closed)
                    {
                        connRN.Close();
                        connRN.Open();
                    }
                    else if (connRN.State == ConnectionState.Closed) connRN.Open();
                    SqlDataReader rdrImcompleteCases = cmdQueryForIncompleteCase.ExecuteReader();
                    gvRNManagerIncompleteCase.Rows.Clear();
                    if (rdrImcompleteCases.HasRows)
                    {
                        while (rdrImcompleteCases.Read())
                        {
                            DataGridViewRow row = new DataGridViewRow();
                            if (!rdrImcompleteCases.IsDBNull(0)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrImcompleteCases.GetString(0) });
                            else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                            if (!rdrImcompleteCases.IsDBNull(1)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrImcompleteCases.GetString(1) });
                            else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                            if (!rdrImcompleteCases.IsDBNull(2)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrImcompleteCases.GetString(2) });
                            else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                            if (!rdrImcompleteCases.IsDBNull(3)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrImcompleteCases.GetString(3) });
                            else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                            if (!rdrImcompleteCases.IsDBNull(4))
                            {
                                Boolean bNPF_Form = rdrImcompleteCases.GetBoolean(4);
                                if (bNPF_Form)
                                {
                                    DataGridViewCheckBoxCell chkNPFCell = new DataGridViewCheckBoxCell();
                                    chkNPFCell.Value = bNPF_Form;
                                    row.Cells.Add(chkNPFCell);
                                }
                                else
                                {
                                    DataGridViewCheckBoxCell chkNPFCell = new DataGridViewCheckBoxCell();
                                    chkNPFCell.Value = bNPF_Form;
                                    chkNPFCell.Style.BackColor = Color.Pink;
                                    row.Cells.Add(chkNPFCell);
                                }
                            }
                            else row.Cells.Add(new DataGridViewCheckBoxCell { Value = false });
                            if (!rdrImcompleteCases.IsDBNull(5))
                            {
                                Boolean bIB_Form = rdrImcompleteCases.GetBoolean(5);
                                if (bIB_Form)
                                {
                                    DataGridViewCheckBoxCell chkIBCell = new DataGridViewCheckBoxCell();
                                    chkIBCell.Value = bIB_Form;
                                    row.Cells.Add(chkIBCell);
                                }
                                else
                                {
                                    DataGridViewCheckBoxCell chkIBCell = new DataGridViewCheckBoxCell();
                                    chkIBCell.Style.BackColor = Color.Pink;
                                    chkIBCell.Value = bIB_Form;
                                    row.Cells.Add(chkIBCell);
                                }
                            }
                            else row.Cells.Add(new DataGridViewCheckBoxCell { Value = false });
                            if (!rdrImcompleteCases.IsDBNull(6))
                            {
                                Boolean bPOP_Form = rdrImcompleteCases.GetBoolean(6);
                                if (bPOP_Form)
                                {
                                    DataGridViewCheckBoxCell chkPOPCell = new DataGridViewCheckBoxCell();
                                    chkPOPCell.Value = bPOP_Form;
                                    row.Cells.Add(chkPOPCell);
                                }
                                else
                                {
                                    DataGridViewCheckBoxCell chkPOPCell = new DataGridViewCheckBoxCell();
                                    chkPOPCell.Style.BackColor = Color.Pink;
                                    chkPOPCell.Value = bPOP_Form;
                                    row.Cells.Add(chkPOPCell);
                                }
                            }
                            else row.Cells.Add(new DataGridViewCheckBoxCell { Value = false });
                            if (!rdrImcompleteCases.IsDBNull(7))
                            {
                                Boolean bMedRec_Form = rdrImcompleteCases.GetBoolean(7);
                                if (bMedRec_Form)
                                {
                                    DataGridViewCheckBoxCell chkMedRecCell = new DataGridViewCheckBoxCell();
                                    chkMedRecCell.Value = bMedRec_Form;
                                    row.Cells.Add(chkMedRecCell);
                                }
                                else
                                {
                                    DataGridViewCheckBoxCell chkMedRecCell = new DataGridViewCheckBoxCell();
                                    chkMedRecCell.Style.BackColor = Color.Pink;
                                    chkMedRecCell.Value = bMedRec_Form;
                                    row.Cells.Add(chkMedRecCell);
                                }
                            }
                            else row.Cells.Add(new DataGridViewCheckBoxCell { Value = false });
                            if (!rdrImcompleteCases.IsDBNull(8))
                            {
                                Boolean bUnknown = rdrImcompleteCases.GetBoolean(8);
                                if (bUnknown)
                                {
                                    DataGridViewCheckBoxCell chkUnknownCell = new DataGridViewCheckBoxCell();
                                    chkUnknownCell.Value = bUnknown;
                                    row.Cells.Add(chkUnknownCell);
                                }
                                else
                                {
                                    DataGridViewCheckBoxCell chkUnknownCell = new DataGridViewCheckBoxCell();
                                    chkUnknownCell.Style.BackColor = Color.Pink;
                                    chkUnknownCell.Value = bUnknown;
                                    row.Cells.Add(chkUnknownCell);
                                }
                            }
                            else row.Cells.Add(new DataGridViewCheckBoxCell { Value = false });
                            if (!rdrImcompleteCases.IsDBNull(9))
                            {
                                Boolean bAddBill_Form = rdrImcompleteCases.GetBoolean(9);
                                if (bAddBill_Form)
                                {
                                    DataGridViewCheckBoxCell chkAddBillCell = new DataGridViewCheckBoxCell();
                                    chkAddBillCell.Value = bAddBill_Form;
                                    row.Cells.Add(chkAddBillCell);
                                }
                                else
                                {
                                    DataGridViewCheckBoxCell chkAddBillCell = new DataGridViewCheckBoxCell();
                                    chkAddBillCell.Style.BackColor = Color.Pink;
                                    chkAddBillCell.Value = bAddBill_Form;
                                    row.Cells.Add(chkAddBillCell);
                                }
                            }
                            else row.Cells.Add(new DataGridViewCheckBoxCell { Value = false });
                            gvRNManagerIncompleteCase.Rows.Add(row);
                        }
                    }
                    rdrImcompleteCases.Close();
                    if (connRN.State == ConnectionState.Open) connRN.Close();

                    //gvRNManagerMedBillPending



                    ///////////////////////////////////////////////////////////////////////////////////////////////////////////////
                    ///
                    //String strSqlQueryForMedBillPending = "select [dbo].[tbl_medbill].[BillNo], [dbo].[tbl_medbill].[Individual_Id], " +
                    //                                      "[dbo].[tbl_CreateStaff].[Staff_Name], [dbo].[tbl_ModifiStaff].[Staff_Name], " +
                    //                                      "[dbo].[tbl_medbill].[BillAmount], [dbo].[tbl_MedicalProvider].[NAME], [dbo].[tbl_pending_reason].[name] " +
                    //                                      "from [dbo].[tbl_medbill] " +
                    //                                      "inner join [dbo].[tbl_CreateStaff] on [dbo].[tbl_medbill].[CreatedById] = [dbo].[tbl_CreateStaff].[CreateStaff_Id] " +
                    //                                      "inner join [dbo].[tbl_ModifiStaff] on [dbo].[tbl_medbill].[LastModifiedById] = [dbo].[tbl_ModifiStaff].[ModifiStaff_Id] " +
                    //                                      "inner join [dbo].[tbl_MedicalProvider] on [dbo].[tbl_medbill].[MedicalProvider_Id] = [dbo].[tbl_MedicalProvider].[ID] " +
                    //                                      "inner join [dbo].[tbl_pending_reason] on [dbo].[tbl_medbill].[PendingReason] = [dbo].[tbl_pending_reason].[ID] " +
                    //                                      "where [dbo].[tbl_medbill].[BillStatus] = 0";

                    //SqlCommand cmdQueryForMedBillPending = new SqlCommand(strSqlQueryForMedBillPending, connRN);
                    //cmdQueryForMedBillPending.CommandType = CommandType.Text;

                    //if (connRN.State != ConnectionState.Closed)
                    //{
                    //    connRN.Close();
                    //    connRN.Open();
                    //}
                    //else if (connRN.State == ConnectionState.Closed) connRN.Open();
                    //gvRNManagerMedBillPending.Rows.Clear();
                    //SqlDataReader rdrMedBillsPending = cmdQueryForMedBillPending.ExecuteReader();
                    //if (rdrMedBillsPending.HasRows)
                    //{
                    //    while (rdrMedBillsPending.Read())
                    //    {
                    //        DataGridViewRow row = new DataGridViewRow();
                    //        if (!rdrMedBillsPending.IsDBNull(0)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillsPending.GetString(0) });
                    //        else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                    //        if (!rdrMedBillsPending.IsDBNull(1)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillsPending.GetString(1) });
                    //        else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                    //        if (!rdrMedBillsPending.IsDBNull(2)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillsPending.GetString(2) });
                    //        else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                    //        if (!rdrMedBillsPending.IsDBNull(3)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillsPending.GetString(3) });
                    //        else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                    //        if (!rdrMedBillsPending.IsDBNull(4)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillsPending.GetDecimal(4).ToString("C") });
                    //        else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                    //        if (!rdrMedBillsPending.IsDBNull(5)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillsPending.GetString(5) });
                    //        else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                    //        if (!rdrMedBillsPending.IsDBNull(6)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillsPending.GetString(6) });
                    //        else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                    //        gvRNManagerMedBillPending.Rows.Add(row);
                    //    }
                    //}
                    //rdrMedBillsPending.Close();
                    //if (connRN.State == ConnectionState.Open) connRN.Close();



                    ///////////////////////////////////////////////////////////////////////////////////////////////////////////////
                    String strSqlQueryForActiveTasks = "select [dbo].[tbl_task].[whoid], [dbo].[tbl_task].[IndividualName], " +
                                                       "[dbo].[tbl_task_assigned_to].[User_Name], [dbo].[tbl_task_created_by].[User_Name], " +
                                                       "[dbo].[tbl_task].[whatid], " +
                                                       "[dbo].[tbl_task].[Subject], [dbo].[tbl_task].[DueDate], [dbo].[tbl_task].[CreateDate], " +
                                                       "[dbo].[tbl_task].[ActivityDate], [dbo].[tbl_task].[Comment], [dbo].[tbl_task].[Solution], " +
                                                       "[dbo].[tbl_task_status_code].[TaskStatusValue], [dbo].[tbl_task_priority_code].[TaskPriorityValue] " +
                                                       "from [dbo].[tbl_task] " +
                                                       "inner join [dbo].[tbl_task_assigned_to] on [dbo].[tbl_task].[AssignedTo] = [dbo].[tbl_task_assigned_to].[User_Id] " +
                                                       "inner join [dbo].[tbl_task_created_by] on [dbo].[tbl_task].[CreatedById] = [dbo].[tbl_task_created_by].[User_Id] " +
                                                       "inner join [dbo].[tbl_task_status_code] on [dbo].[tbl_task].[Status] = [dbo].[tbl_task_status_code].[TaskStatusCode] " +
                                                       "inner join [dbo].[tbl_task_priority_code] on [dbo].[tbl_task].[Priority] = [dbo].[tbl_task_priority_code].[TaskPriorityCode] " +
                                                       "inner join [dbo].[tbl_assigned_to_role] on [dbo].[tbl_task_assigned_to].[User_Role_Id] = [dbo].[tbl_assigned_to_role].[User_Role_Id] " +
                                                       "inner join [dbo].[tbl_created_by_role] on [dbo].[tbl_task_created_by].[User_Role_Id] = [dbo].[tbl_created_by_role].[User_Role_Id]" +
                                                       "where ([dbo].[tbl_task].[IsDeleted] IS NULL or [dbo].[tbl_task].[IsDeleted] = 0) and " +
                                                       "([dbo].[tbl_task].[AssignedTo] = @AssignedToId or " +
                                                       "[dbo].[tbl_task].[CreatedById] = @CreatedById) and " +
                                                       "([dbo].[tbl_assigned_to_role].[User_Role_Id] = 5 or " +
                                                       "[dbo].[tbl_created_by_role].[User_Role_Id] = 5 or" +
                                                       "[dbo].[tbl_assigned_to_role].[User_Role_Id] = 2 or" +
                                                       "[dbo].[tbl_created_by_role].[User_Role_Id] = 2) and " +
                                                       "[dbo].[tbl_task].[Status] <> 2 and [dbo].[tbl_task].[Status] <> 5";

                    SqlCommand cmdQueryForActiveTasks = new SqlCommand(strSqlQueryForActiveTasks, connRN);
                    cmdQueryForActiveTasks.CommandType = CommandType.Text;

                    cmdQueryForActiveTasks.Parameters.AddWithValue("@AssignedToId", nLoggedUserId);
                    cmdQueryForActiveTasks.Parameters.AddWithValue("@CreatedById", nLoggedUserId);

                    SqlDependency dependency = new SqlDependency(cmdQueryForActiveTasks);
                    dependency.OnChange += new OnChangeEventHandler(OnActiveTaskRNManagerChange);

                    if (connRN.State != ConnectionState.Closed)
                    {
                        connRN.Close();
                        connRN.Open();
                    }
                    else if (connRN.State == ConnectionState.Closed) connRN.Open();
                    gvRNManagerActiveTask.Rows.Clear();
                    SqlDataReader rdrActiveTasks = cmdQueryForActiveTasks.ExecuteReader();
                    if (rdrActiveTasks.HasRows)
                    {
                        while (rdrActiveTasks.Read())
                        {
                            DataGridViewRow row = new DataGridViewRow();
                            if (!rdrActiveTasks.IsDBNull(0)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrActiveTasks.GetString(0) });
                            else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                            if (!rdrActiveTasks.IsDBNull(1)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrActiveTasks.GetString(1) });
                            else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                            if (!rdrActiveTasks.IsDBNull(2)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrActiveTasks.GetString(2) });
                            else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                            if (!rdrActiveTasks.IsDBNull(3)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrActiveTasks.GetString(3) });
                            else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                            if (!rdrActiveTasks.IsDBNull(4)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrActiveTasks.GetString(4) });
                            else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                            if (!rdrActiveTasks.IsDBNull(5)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrActiveTasks.GetString(5) });
                            else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                            if (!rdrActiveTasks.IsDBNull(6)) row.Cells.Add(new CalendarCell { Value = rdrActiveTasks.GetDateTime(6).ToString("MM/dd/yyyy") });
                            else row.Cells.Add(new CalendarCell { Value = String.Empty });
                            if (!rdrActiveTasks.IsDBNull(7)) row.Cells.Add(new CalendarCell { Value = rdrActiveTasks.GetDateTime(7).ToString("MM/dd/yyyy") });
                            else row.Cells.Add(new CalendarCell { Value = String.Empty });
                            if (!rdrActiveTasks.IsDBNull(8)) row.Cells.Add(new CalendarCell { Value = rdrActiveTasks.GetDateTime(8).ToString("MM/dd/yyyy") });
                            else row.Cells.Add(new CalendarCell { Value = String.Empty });
                            if (!rdrActiveTasks.IsDBNull(9)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrActiveTasks.GetString(9) });
                            else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                            if (!rdrActiveTasks.IsDBNull(10)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrActiveTasks.GetString(10) });
                            else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                            if (!rdrActiveTasks.IsDBNull(11)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrActiveTasks.GetString(11) });
                            else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                            if (!rdrActiveTasks.IsDBNull(12)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrActiveTasks.GetString(12) });
                            else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });

                            gvRNManagerActiveTask.Rows.Add(row);
                        }
                    }
                    rdrActiveTasks.Close();
                    if (connRN.State == ConnectionState.Open) connRN.Close();

                    String strSqlQueryForCompleteTask = "select [dbo].[tbl_task].[whoid], [dbo].[tbl_task].[IndividualName], [dbo].[tbl_task].[Subject], " +
                                                        "[dbo].[tbl_task].[CreateDate], [dbo].[tbl_task].[ActivityDate], [dbo].[tbl_task].[Comment], [dbo].[tbl_task].[Solution] " +
                                                        "from [dbo].[tbl_task] " +
                                                        "inner join [dbo].[tbl_task_assigned_to] on [dbo].[tbl_task].[AssignedTo] = [dbo].[tbl_task_assigned_to].[User_Id] " +
                                                        "inner join [dbo].[tbl_task_created_by] on [dbo].[tbl_task].[CreatedById] = [dbo].[tbl_task_created_by].[User_Id] " +
                                                        "inner join [dbo].[tbl_assigned_to_role] on [dbo].[tbl_task_assigned_to].[User_Role_Id] = [dbo].[tbl_assigned_to_role].[User_Role_Id] " +
                                                        "inner join [dbo].[tbl_created_by_role] on [dbo].[tbl_task_created_by].[User_Role_Id] = [dbo].[tbl_created_by_role].[User_Role_Id]" +
                                                        "where ([dbo].[tbl_task].[IsDeleted] IS NULL or [dbo].[tbl_task].[IsDeleted] = 0) and " +
                                                        "([dbo].[tbl_task].[AssignedTo] = @AssignedToId or " +
                                                        "[dbo].[tbl_task].[CreatedById] = @CreatedById) and " +
                                                        "([dbo].[tbl_assigned_to_role].[User_Role_Id] = 5 or " +
                                                        "[dbo].[tbl_created_by_role].[User_Role_Id] = 5 or" +
                                                        "[dbo].[tbl_assigned_to_role].[User_Role_Id] = 2 or" +
                                                        "[dbo].[tbl_created_by_role].[User_Role_Id] = 2) and " +
                                                        "([dbo].[tbl_task].[Status] = 2 or [dbo].[tbl_task].[Status] = 5)";

                    SqlCommand cmdQueryForCompleteTask = new SqlCommand(strSqlQueryForCompleteTask, connRN);
                    cmdQueryForCompleteTask.CommandType = CommandType.Text;

                    cmdQueryForCompleteTask.Parameters.AddWithValue("@AssignedToId", nLoggedUserId);
                    cmdQueryForCompleteTask.Parameters.AddWithValue("@CreatedById", nLoggedUserId);

                    SqlDependency dependencyComplete = new SqlDependency(cmdQueryForCompleteTask);
                    dependencyComplete.OnChange += new OnChangeEventHandler(OnCompleteTaskRNManagerChange);

                    if (connRN.State != ConnectionState.Closed)
                    {
                        connRN.Close();
                        connRN.Open();
                    }
                    else if (connRN.State == ConnectionState.Closed) connRN.Open();

                    SqlDataReader rdrCompleteTask = cmdQueryForCompleteTask.ExecuteReader();
                    gvRNManagerCompleteTask.Rows.Clear();
                    if (rdrCompleteTask.HasRows)
                    {
                        while (rdrCompleteTask.Read())
                        {
                            DataGridViewRow row = new DataGridViewRow();
                            if (!rdrCompleteTask.IsDBNull(0)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrCompleteTask.GetString(0) });
                            else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                            if (!rdrCompleteTask.IsDBNull(1)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrCompleteTask.GetString(1) });
                            else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                            if (!rdrCompleteTask.IsDBNull(2)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrCompleteTask.GetString(2) });
                            else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                            if (!rdrCompleteTask.IsDBNull(3)) row.Cells.Add(new CalendarCell { Value = rdrCompleteTask.GetDateTime(3).ToString("MM/dd/yyyy") });
                            else row.Cells.Add(new CalendarCell { Value = String.Empty });
                            if (!rdrCompleteTask.IsDBNull(4)) row.Cells.Add(new CalendarCell { Value = rdrCompleteTask.GetDateTime(4).ToString("MM/dd/yyyy") });
                            else row.Cells.Add(new CalendarCell { Value = String.Empty });
                            if (!rdrCompleteTask.IsDBNull(5)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrCompleteTask.GetString(5) });
                            else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                            if (!rdrCompleteTask.IsDBNull(6)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrCompleteTask.GetString(6) });
                            else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                            gvRNManagerCompleteTask.Rows.Add(row);
                        }
                    }
                    rdrCompleteTask.Close();
                    if (connRN.State == ConnectionState.Open) connRN.Close();
                }

                if (LoggedInUserRole == UserRole.RNStaff)
                {
                    tbCMMManager.TabPages.Remove(tbpgDashboardFDManager);
                    tbCMMManager.TabPages.Remove(tbpgDashboardFDStaff);
                    tbCMMManager.TabPages.Remove(tbpgDashboardNPManager);
                    tbCMMManager.TabPages.Remove(tbpgDashboardNPStaff);
                    tbCMMManager.TabPages.Remove(tbpgDashboardRNManager);

                    String strSqlQueryForActiveTasks = "select [dbo].[tbl_task].[whoid], [dbo].[tbl_task].[IndividualName], " +
                                                       "[dbo].[tbl_task_assigned_to].[User_Name], [dbo].[tbl_task_created_by].[User_Name], " +
                                                       "[dbo].[tbl_task].[whatid], " +
                                                       "[dbo].[tbl_task].[Subject], [dbo].[tbl_task].[DueDate], [dbo].[tbl_task].[CreateDate], " +
                                                       "[dbo].[tbl_task].[ActivityDate], [dbo].[tbl_task].[Comment], [dbo].[tbl_task].[Solution], " +
                                                       "[dbo].[tbl_task_status_code].[TaskStatusValue], [dbo].[tbl_task_priority_code].[TaskPriorityValue] " +
                                                       "from [dbo].[tbl_task] " +
                                                       "inner join [dbo].[tbl_task_created_by] on [dbo].[tbl_task].[CreatedById] = [dbo].[tbl_task_created_by].[User_Id] " +
                                                       "inner join [dbo].[tbl_task_assigned_to] on [dbo].[tbl_task].[AssignedTo] = [dbo].[tbl_task_assigned_to].[User_Id] " +
                                                       "inner join [dbo].[tbl_task_status_code] on [dbo].[tbl_task].[Status] = [dbo].[tbl_task_status_code].[TaskStatusCode] " +
                                                       "inner join [dbo].[tbl_task_priority_code] on [dbo].[tbl_task].[Priority] = [dbo].[tbl_task_priority_code].[TaskPriorityCode] " +
                                                       "where ([dbo].[tbl_task].[AssignedTo] = @AssignedToId or [dbo].[tbl_task].[CreatedById] = @CreatedById) and " +
                                                       "[dbo].[tbl_task].[Status] <> 2 and [dbo].[tbl_task].[Status] <> 5";

                    SqlCommand cmdQueryForActiveTasks = new SqlCommand(strSqlQueryForActiveTasks, connRN);
                    cmdQueryForActiveTasks.CommandType = CommandType.Text;

                    cmdQueryForActiveTasks.Parameters.AddWithValue("@AssignedToId", nLoggedUserId);
                    cmdQueryForActiveTasks.Parameters.AddWithValue("@CreatedById", nLoggedUserId);

                    SqlDependency dependency = new SqlDependency(cmdQueryForActiveTasks);
                    dependency.OnChange += new OnChangeEventHandler(OnActiveTaskRNStaffChange);

                    if (connRN.State != ConnectionState.Closed)
                    {
                        connRN.Close();
                        connRN.Open();
                    }
                    else if (connRN.State == ConnectionState.Closed) connRN.Open();
                    gvRNStaffActiveTask.Rows.Clear();
                    SqlDataReader rdrActiveTasks = cmdQueryForActiveTasks.ExecuteReader();
                    if (rdrActiveTasks.HasRows)
                    {
                        while (rdrActiveTasks.Read())
                        {
                            DataGridViewRow row = new DataGridViewRow();
                            if (!rdrActiveTasks.IsDBNull(0)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrActiveTasks.GetString(0) });
                            else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                            if (!rdrActiveTasks.IsDBNull(1)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrActiveTasks.GetString(1) });
                            else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                            if (!rdrActiveTasks.IsDBNull(2)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrActiveTasks.GetString(2) });
                            else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                            if (!rdrActiveTasks.IsDBNull(3)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrActiveTasks.GetString(3) });
                            else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                            if (!rdrActiveTasks.IsDBNull(4)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrActiveTasks.GetString(4) });
                            else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                            if (!rdrActiveTasks.IsDBNull(5)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrActiveTasks.GetString(5) });
                            else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                            if (!rdrActiveTasks.IsDBNull(6)) row.Cells.Add(new CalendarCell { Value = rdrActiveTasks.GetDateTime(6).ToString("MM/dd/yyyy") });
                            else row.Cells.Add(new CalendarCell { Value = String.Empty });
                            if (!rdrActiveTasks.IsDBNull(7)) row.Cells.Add(new CalendarCell { Value = rdrActiveTasks.GetDateTime(7).ToString("MM/dd/yyyy") });
                            else row.Cells.Add(new CalendarCell { Value = String.Empty });
                            if (!rdrActiveTasks.IsDBNull(8)) row.Cells.Add(new CalendarCell { Value = rdrActiveTasks.GetDateTime(8).ToString("MM/dd/yyyy") });
                            else row.Cells.Add(new CalendarCell { Value = String.Empty });
                            if (!rdrActiveTasks.IsDBNull(9)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrActiveTasks.GetString(9) });
                            else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                            if (!rdrActiveTasks.IsDBNull(10)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrActiveTasks.GetString(10) });
                            else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                            if (!rdrActiveTasks.IsDBNull(11)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrActiveTasks.GetString(11) });
                            else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                            if (!rdrActiveTasks.IsDBNull(12)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrActiveTasks.GetString(12) });
                            else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });

                            gvRNStaffActiveTask.Rows.Add(row);
                        }
                    }
                    rdrActiveTasks.Close();
                    if (connRN.State == ConnectionState.Open) connRN.Close();

                    String strSqlQueryForCompleteTask = "select [dbo].[tbl_task].[whoid], [dbo].[tbl_task].[IndividualName], [dbo].[tbl_task].[Subject], " +
                                    "[dbo].[tbl_task].[CreateDate], [dbo].[tbl_task].[ActivityDate], [dbo].[tbl_task].[Comment], [dbo].[tbl_task].[Solution] " +
                                    "from [dbo].[tbl_task] " +
                                    "inner join [dbo].[tbl_task_assigned_to] on [dbo].[tbl_task].[AssignedTo] = [dbo].[tbl_task_assigned_to].[User_Id] " +
                                    "inner join [dbo].[tbl_task_created_by] on [dbo].[tbl_task].[CreatedById] = [dbo].[tbl_task_created_by].[User_Id] " +
                                    "inner join [dbo].[tbl_assigned_to_role] on [dbo].[tbl_task_assigned_to].[User_Role_Id] = [dbo].[tbl_assigned_to_role].[User_Role_Id] " +
                                    "inner join [dbo].[tbl_created_by_role] on [dbo].[tbl_task_created_by].[User_Role_Id] = [dbo].[tbl_created_by_role].[User_Role_Id]" +
                                    "where ([dbo].[tbl_task].[AssignedTo] = @AssignedToId or " +
                                    "[dbo].[tbl_task].[CreatedById] = @CreatedById) and " +
                                    "([dbo].[tbl_task].[Status] = 2 or [dbo].[tbl_task].[Status] = 5)";

                    SqlCommand cmdQueryForCompleteTask = new SqlCommand(strSqlQueryForCompleteTask, connRN);
                    cmdQueryForCompleteTask.CommandType = CommandType.Text;

                    cmdQueryForCompleteTask.Parameters.AddWithValue("@AssignedToId", nLoggedUserId);
                    cmdQueryForCompleteTask.Parameters.AddWithValue("@CreatedById", nLoggedUserId);

                    SqlDependency dependencyCompleteTasks = new SqlDependency(cmdQueryForCompleteTask);
                    dependencyCompleteTasks.OnChange += new OnChangeEventHandler(OnCompleteTaskRNStaffChange);

                    if (connRN.State != ConnectionState.Closed)
                    {
                        connRN.Close();
                        connRN.Open();
                    }
                    else if (connRN.State == ConnectionState.Closed) connRN.Open();
                    gvRNStaffCompleteTask.Rows.Clear();
                    SqlDataReader rdrCompleteTasks = cmdQueryForCompleteTask.ExecuteReader();
                    if (rdrCompleteTasks.HasRows)
                    {
                        while (rdrCompleteTasks.Read())
                        {
                            DataGridViewRow row = new DataGridViewRow();
                            if (!rdrCompleteTasks.IsDBNull(0)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrCompleteTasks.GetString(0) });
                            else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                            if (!rdrCompleteTasks.IsDBNull(1)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrCompleteTasks.GetString(1) });
                            else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                            if (!rdrCompleteTasks.IsDBNull(2)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrCompleteTasks.GetString(2) });
                            else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                            if (!rdrCompleteTasks.IsDBNull(3)) row.Cells.Add(new CalendarCell { Value = rdrCompleteTasks.GetDateTime(3).ToString("MM/dd/yyyy") });
                            else row.Cells.Add(new CalendarCell { Value = String.Empty });
                            if (!rdrCompleteTasks.IsDBNull(4)) row.Cells.Add(new CalendarCell { Value = rdrCompleteTasks.GetDateTime(4).ToString("MM/dd/yyyy") });
                            else row.Cells.Add(new CalendarCell { Value = String.Empty });
                            if (!rdrCompleteTasks.IsDBNull(5)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrCompleteTasks.GetString(5) });
                            else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                            if (!rdrCompleteTasks.IsDBNull(6)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrCompleteTasks.GetString(6) });
                            else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });

                            gvRNStaffCompleteTask.Rows.Add(row);
                        }
                    }
                    rdrCompleteTasks.Close();
                    if (connRN.State == ConnectionState.Open) connRN.Close();
                }

                if (LoggedInUserRole == UserRole.FDManager)
                {
                    tbCMMManager.TabPages.Remove(tbpgDashboardFDStaff);
                    tbCMMManager.TabPages.Remove(tbpgDashboardNPManager);
                    tbCMMManager.TabPages.Remove(tbpgDashboardNPStaff);
                    tbCMMManager.TabPages.Remove(tbpgDashboardRNManager);
                    tbCMMManager.TabPages.Remove(tbpgDashboardRNStaff);
                }

                if (LoggedInUserRole == UserRole.FDStaff)
                {
                    tbCMMManager.TabPages.Remove(tbpgDashboardFDManager);
                    tbCMMManager.TabPages.Remove(tbpgDashboardNPManager);
                    tbCMMManager.TabPages.Remove(tbpgDashboardNPStaff);
                    tbCMMManager.TabPages.Remove(tbpgDashboardRNManager);
                    tbCMMManager.TabPages.Remove(tbpgDashboardRNStaff);
                }

                if (LoggedInUserRole == UserRole.NPManager)
                {
                    tbCMMManager.TabPages.Remove(tbpgDashboardNPStaff);
                    tbCMMManager.TabPages.Remove(tbpgDashboardFDManager);
                    tbCMMManager.TabPages.Remove(tbpgDashboardFDStaff);
                    tbCMMManager.TabPages.Remove(tbpgDashboardRNManager);
                    tbCMMManager.TabPages.Remove(tbpgDashboardRNStaff);
                }

                if (LoggedInUserRole == UserRole.NPStaff)
                {
                    tbCMMManager.TabPages.Remove(tbpgDashboardNPManager);
                    tbCMMManager.TabPages.Remove(tbpgDashboardFDManager);
                    tbCMMManager.TabPages.Remove(tbpgDashboardFDStaff);
                    tbCMMManager.TabPages.Remove(tbpgDashboardRNManager);
                    tbCMMManager.TabPages.Remove(tbpgDashboardRNStaff);
                }

                //////////////////////////////////////////////////////////////////////////////////////////////////////////////
                // Payment tab

                //String strSqlQueryForCreditCardPayment = "select [RN_DB].[dbo].[tbl_settlement].[IsPaid], [SalesForce].[dbo].[contact].[Name], " +
                //                                         "[RN_DB].[dbo].[tbl_MedicalProvider].[Name], [RN_DB].[dbo].[tbl_MedicalProvider].[PHONE], " +
                //                                         "[RN_DB].[dbo].[tbl_medbill].[Account_At_Provider], " +
                //                                         "[SalesForce].[dbo].[contact].[Birthdate], " +
                //                                         "[SalesForce].[dbo].[contact].[Social_Security_Number__c], [SalesForce].[dbo].[contact].[CMM_Gender__c], " +
                //                                         "[SalesForce].[dbo].[contact].[Primary_Name__c], " +
                //                                         "[SalesForce].[dbo].[contact].[MailingStreet], [SalesForce].[dbo].[contact].[MailingCity], " +
                //                                         "[SalesForce].[dbo].[contact].[MailingState], [SalesForce].[dbo].[contact].[MailingPostalCode], " +
                //                                         "[RN_DB].[dbo].[tbl_medbill].[BillDate], " +
                //                                         "[RN_DB].[dbo].[tbl_medbill].[BillNo], [RN_DB].[dbo].[tbl_medbill].[BillAmount], " +
                //                                         "[RN_DB].[dbo].[tbl_settlement].[Name], [RN_DB].[dbo].[tbl_settlement].[Amount], " +
                //                                         "[SalesForce].[dbo].[contact].[c4g_Membership_Status__c], " +
                //                                         "[RN_DB].[dbo].[tbl_settlement].[Notes], " +
                //                                         "[RN_DB].[dbo].[tbl_CreateStaff].[Staff_Name], [RN_DB].[dbo].[tbl_ModifiStaff].[Staff_Name], " +
                //                                         "[SalesForce].[dbo].[contact].[Individual_ID__c], [SalesForce].[dbo].[contact].[Membership_Number__c] " +
                //                                         "from [RN_DB].[dbo].[tbl_settlement] " +
                //                                         "inner join [RN_DB].[dbo].[tbl_settlement_type_code] on [RN_DB].[dbo].[tbl_settlement].[SettlementType] = [RN_DB].[dbo].[tbl_settlement_type_code].[SettlementTypeCode] " +
                //                                         "inner join [RN_DB].[dbo].[tbl_medbill] on [RN_DB].[dbo].[tbl_settlement].[MedicalBillID] = [RN_DB].[dbo].[tbl_medbill].[BillNo] " +
                //                                         "inner join [RN_DB].[dbo].[tbl_case] on [RN_DB].[dbo].[tbl_medbill].[Case_Id] = [RN_DB].[dbo].[tbl_case].[Case_Name] " +
                //                                         "inner join [RN_DB].[dbo].[tbl_incident] on [RN_DB].[dbo].[tbl_medbill].[Incident_Id] = [RN_DB].[dbo].[tbl_incident].[Incident_id] " +
                //                                         "inner join [RN_DB].[dbo].[tbl_MedicalProvider] on [RN_DB].[dbo].[tbl_medbill].[MedicalProvider_Id] = [RN_DB].[dbo].[tbl_MedicalProvider].[ID] " +
                //                                         "inner join [RN_DB].[dbo].[tbl_program] on [RN_DB].[dbo].[tbl_incident].[Program_id] = [RN_DB].[dbo].[tbl_program].[Program_Id] " +
                //                                         "inner join [RN_DB].[dbo].[tbl_CreateStaff] on [RN_DB].[dbo].[tbl_medbill].[CreatedById] = [RN_DB].[dbo].[tbl_CreateStaff].[CreateStaff_Id] " +
                //                                         "inner join [RN_DB].[dbo].[tbl_ModifiStaff] on [RN_DB].[dbo].[tbl_medbill].[LastModifiedById] = [RN_DB].[dbo].[tbl_ModifiStaff].[ModifiStaff_Id] " +
                //                                         "inner join [SalesForce].[dbo].[contact] on [RN_DB].[dbo].[tbl_medbill].[Individual_Id] = [SalesForce].[dbo].[contact].[Individual_ID__c] " +
                //                                         "inner join [SalesForce].[dbo].[program] on [SalesForce].[dbo].[contact].[c4g_Plan__c] = [SalesForce].[dbo].[program].[ID] " +
                //                                         "inner join [SalesForce].[dbo].[account] on [SalesForce].[dbo].[contact].[AccountId] = [SalesForce].[dbo].[account].[ID] " +
                //                                         "where ([RN_DB].[dbo].[tbl_settlement].[IsPaid] = 0 or [RN_DB].[dbo].[tbl_settlement].[IsPaid] IS NULL) and " +
                //                                         "[RN_DB].[dbo].[tbl_settlement].[PaidByID] IS NULL and " +
                //                                         "[RN_DB].[dbo].[tbl_settlement].[IsDeleted] = 0 and " +
                //                                         "[RN_DB].[dbo].[tbl_settlement].[SettlementType] = 4 and " +
                //                                         "[RN_DB].[dbo].[tbl_settlement].[CMMPaymentMethod] = 2 and " +
                //                                         "[RN_DB].[dbo].[tbl_settlement].[Approved] = 1 and " +
                //                                         "[RN_DB].[dbo].[tbl_settlement].[ApprovedDate] IS NOT NULL and " +
                //                                         "[RN_DB].[dbo].[tbl_settlement].[CMMCreditCard] = 0 and " +
                //                                         "[RN_DB].[dbo].[tbl_settlement].[CMMCreditCardPaidDate] IS NULL";

                String strSqlQueryForCreditCardPayment = "select [dbo].[tbl_settlement].[IsPaid], " +
                                                         "[dbo].[tbl_medbill].[MedicalProvider_Id], " +
                                                         "[dbo].[tbl_medbill].[Account_At_Provider], " +
                                                         "[dbo].[tbl_medbill].[BillDate], " +
                                                         "[dbo].[tbl_medbill].[BillNo], [dbo].[tbl_medbill].[BillAmount], " +
                                                         "[dbo].[tbl_settlement].[Name], [dbo].[tbl_settlement].[Amount], " +
                                                         "[dbo].[tbl_settlement].[Notes], " +
                                                         "[dbo].[tbl_CreateStaff].[Staff_Name], [dbo].[tbl_ModifiStaff].[Staff_Name], " +
                                                         "[dbo].[tbl_medbill].[Individual_Id] " +
                                                         "from [dbo].[tbl_settlement] " +
                                                         "inner join [dbo].[tbl_medbill] on [dbo].[tbl_settlement].[MedicalBillID] = [dbo].[tbl_medbill].[BillNo] " +
                                                         "inner join [dbo].[tbl_CreateStaff] on [dbo].[tbl_medbill].[CreatedById] = [dbo].[tbl_CreateStaff].[CreateStaff_Id] " +
                                                         "inner join [dbo].[tbl_ModifiStaff] on [dbo].[tbl_medbill].[LastModifiedById] = [dbo].[tbl_ModifiStaff].[ModifiStaff_Id] " +
                                                         "where ([dbo].[tbl_settlement].[IsPaid] = 0 or [RN_DB].[dbo].[tbl_settlement].[IsPaid] IS NULL) and " +
                                                         "[dbo].[tbl_settlement].[PaidByID] IS NULL and " +
                                                         "[dbo].[tbl_settlement].[IsDeleted] = 0 and " +
                                                         "[dbo].[tbl_settlement].[SettlementType] = 4 and " +
                                                         "[dbo].[tbl_settlement].[CMMPaymentMethod] = 2 and " +
                                                         "[dbo].[tbl_settlement].[Approved] = 1 and " +
                                                         "([dbo].[tbl_settlement].[ApprovedDate] IS NOT NULL or [dbo].[tbl_settlement].[ApprovedDate] <> '') and " +
                                                         "([dbo].[tbl_settlement].[CMMCreditCard] = 0 or [dbo].[tbl_settlement].[CMMCreditCard] IS NULL) and " +
                                                         "([dbo].[tbl_settlement].[CMMCreditCardPaidDate] IS NULL or [dbo].[tbl_settlement].[CMMCreditCardPaidDate] = '') " +
                                                         "order by [dbo].[tbl_medbill].[Individual_Id]";

                SqlCommand cmdQueryForCreditCardPayment = new SqlCommand(strSqlQueryForCreditCardPayment, connRN);
                cmdQueryForCreditCardPayment.CommandType = CommandType.Text;

                SqlDependency dependencyCreditCardPayment = new SqlDependency(cmdQueryForCreditCardPayment);
                dependencyCreditCardPayment.OnChange += new OnChangeEventHandler(OnCreditCardPaymentChange);

                if (connRN.State != ConnectionState.Closed)
                {
                    connRN.Close();
                    connRN.Open();
                }
                else if (connRN.State == ConnectionState.Closed) connRN.Open();
                List<CreditCardPaymentInfo> lstCreditCardPaymentInfo = new List<CreditCardPaymentInfo>();
                SqlDataReader rdrCreditCardPayment = cmdQueryForCreditCardPayment.ExecuteReader();
                if (rdrCreditCardPayment.HasRows)
                {
                    while (rdrCreditCardPayment.Read())
                    {
                        CreditCardPaymentInfo ccPaymentInfo = new CreditCardPaymentInfo();

                        if (!rdrCreditCardPayment.IsDBNull(0)) ccPaymentInfo.bIsPaid = rdrCreditCardPayment.GetBoolean(0);
                        else ccPaymentInfo.bIsPaid = false;
                        if (!rdrCreditCardPayment.IsDBNull(1)) ccPaymentInfo.MedicalProviderId = rdrCreditCardPayment.GetString(1);
                        else ccPaymentInfo.MedicalProviderId = String.Empty;
                        if (!rdrCreditCardPayment.IsDBNull(2)) ccPaymentInfo.AccountNoAtProvider = rdrCreditCardPayment.GetString(2);
                        else ccPaymentInfo.AccountNoAtProvider = String.Empty;
                        if (!rdrCreditCardPayment.IsDBNull(3)) ccPaymentInfo.ServiceDate = rdrCreditCardPayment.GetDateTime(3);
                        else ccPaymentInfo.ServiceDate = null;
                        if (!rdrCreditCardPayment.IsDBNull(4)) ccPaymentInfo.MedicalBillNo = rdrCreditCardPayment.GetString(4);
                        else ccPaymentInfo.MedicalBillNo = String.Empty;
                        if (!rdrCreditCardPayment.IsDBNull(5)) ccPaymentInfo.MedBillAmount = rdrCreditCardPayment.GetDecimal(5);
                        else ccPaymentInfo.MedBillAmount = 0;
                        if (!rdrCreditCardPayment.IsDBNull(6)) ccPaymentInfo.SettlementName = rdrCreditCardPayment.GetString(6);
                        else ccPaymentInfo.SettlementName = String.Empty;
                        if (!rdrCreditCardPayment.IsDBNull(7)) ccPaymentInfo.SettlementAmount = rdrCreditCardPayment.GetDecimal(7);
                        else ccPaymentInfo.SettlementAmount = 0;
                        if (!rdrCreditCardPayment.IsDBNull(8)) ccPaymentInfo.SettlementNote = rdrCreditCardPayment.GetString(8);
                        else ccPaymentInfo.SettlementNote = String.Empty;
                        if (!rdrCreditCardPayment.IsDBNull(9)) ccPaymentInfo.CreateStaffName = rdrCreditCardPayment.GetString(9);
                        else ccPaymentInfo.CreateStaffName = String.Empty;
                        if (!rdrCreditCardPayment.IsDBNull(10)) ccPaymentInfo.ModifyStaffName = rdrCreditCardPayment.GetString(10);
                        else ccPaymentInfo.ModifyStaffName = String.Empty;
                        if (!rdrCreditCardPayment.IsDBNull(11)) ccPaymentInfo.IndividualID = rdrCreditCardPayment.GetString(11);
                        else ccPaymentInfo.IndividualID = String.Empty;

                        lstCreditCardPaymentInfo.Add(ccPaymentInfo);
                    }
                }
                rdrCreditCardPayment.Close();
                if (connRN.State != ConnectionState.Open) connRN.Close();

                foreach (CreditCardPaymentInfo info in lstCreditCardPaymentInfo)
                {
                    String strSqlQueryForMedicalProviderInfo = "select [dbo].[account].[Name], [dbo].[account].[Phone] from [dbo].[account] where [dbo].[account].[Id] = @MedicalProviderId";

                    SqlCommand cmdQueryForMedicalProviderInfo = new SqlCommand(strSqlQueryForMedicalProviderInfo, connSalesforce);
                    cmdQueryForMedicalProviderInfo.CommandType = CommandType.Text;

                    cmdQueryForMedicalProviderInfo.Parameters.AddWithValue("@MedicalProviderId", info.MedicalProviderId);

                    if (connSalesforce.State != ConnectionState.Closed)
                    {
                        connSalesforce.Close();
                        connSalesforce.Open();
                    }
                    else if (connSalesforce.State == ConnectionState.Closed) connSalesforce.Open();
                    SqlDataReader rdrMedicalProviderInfo = cmdQueryForMedicalProviderInfo.ExecuteReader();
                    if (rdrMedicalProviderInfo.HasRows)
                    {
                        rdrMedicalProviderInfo.Read();
                        if (!rdrMedicalProviderInfo.IsDBNull(0)) info.MedicalProviderName = rdrMedicalProviderInfo.GetString(0);
                        else info.MedicalProviderName = String.Empty;
                        if (!rdrMedicalProviderInfo.IsDBNull(1)) info.MedicalProviderPhone = rdrMedicalProviderInfo.GetString(1);
                        else info.MedicalProviderPhone = String.Empty;
                    }

                    if (connSalesforce.State == ConnectionState.Open) connSalesforce.Close();
                }

                foreach (CreditCardPaymentInfo info in lstCreditCardPaymentInfo)
                {

                    String strSqlQueryForIndividualInfo = "select [dbo].[contact].[Name], [dbo].[contact].[Birthdate], [dbo].[contact].[Social_Security_Number__c], " +
                                                          "[dbo].[contact].[CMM_Gender__c], [dbo].[contact].[Primary_Name__c], " +
                                                          "[dbo].[account].[ShippingStreet], [dbo].[account].[ShippingCity], " +
                                                          "[dbo].[account].[ShippingState], [dbo].[account].[ShippingPostalCode], " +
                                                          "[dbo].[contact].[c4g_Membership_Status__c], [dbo].[contact].[Membership_Number__c] " +
                                                          "from [dbo].[contact] " +
                                                          "inner join [dbo].[account] on [dbo].[contact].[AccountId] = [dbo].[account].[Id] " +
                                                          "where [dbo].[contact].[Individual_ID__c] = @IndividualId";

                    SqlCommand cmdQueryForIndividualInfo = new SqlCommand(strSqlQueryForIndividualInfo, connSalesforce);
                    cmdQueryForIndividualInfo.CommandType = CommandType.Text;

                    cmdQueryForIndividualInfo.Parameters.AddWithValue("@IndividualId", info.IndividualID);

                    if (connSalesforce.State != ConnectionState.Closed)
                    {
                        connSalesforce.Close();
                        connSalesforce.Open();
                    }
                    else if (connSalesforce.State == ConnectionState.Closed) connSalesforce.Open();
                    SqlDataReader rdrIndividualInfo = cmdQueryForIndividualInfo.ExecuteReader();
                    if (rdrIndividualInfo.HasRows)
                    {
                        rdrIndividualInfo.Read();
                        if (!rdrIndividualInfo.IsDBNull(0)) info.IndividualName = rdrIndividualInfo.GetString(0);
                        else info.IndividualName = String.Empty;
                        if (!rdrIndividualInfo.IsDBNull(1)) info.IndividualBirthDate = rdrIndividualInfo.GetDateTime(1);
                        else info.IndividualBirthDate = null;
                        if (!rdrIndividualInfo.IsDBNull(2)) info.SocialSecurityNumber = rdrIndividualInfo.GetString(2);
                        else info.SocialSecurityNumber = String.Empty;
                        if (!rdrIndividualInfo.IsDBNull(3)) info.Sex = rdrIndividualInfo.GetString(3);
                        else info.Sex = "Unknown";
                        if (!rdrIndividualInfo.IsDBNull(4)) info.PrimaryName = rdrIndividualInfo.GetString(4);
                        else info.PrimaryName = String.Empty;
                        if (!rdrIndividualInfo.IsDBNull(5)) info.MailingStreet = rdrIndividualInfo.GetString(5);
                        else info.MailingStreet = String.Empty;
                        if (!rdrIndividualInfo.IsDBNull(6)) info.MailingCity = rdrIndividualInfo.GetString(6);
                        else info.MailingCity = String.Empty;
                        if (!rdrIndividualInfo.IsDBNull(7)) info.MailingState = rdrIndividualInfo.GetString(7);
                        else info.MailingState = String.Empty;
                        if (!rdrIndividualInfo.IsDBNull(8)) info.MailingZip = rdrIndividualInfo.GetString(8);
                        else info.MailingZip = String.Empty;
                        if (!rdrIndividualInfo.IsDBNull(9)) info.MembershipStatus = rdrIndividualInfo.GetString(9);
                        else info.MembershipStatus = String.Empty;
                        if (!rdrIndividualInfo.IsDBNull(10)) info.MembershipNumber = rdrIndividualInfo.GetString(10);
                    }
                    rdrIndividualInfo.Close();
                    if (connSalesforce.State == ConnectionState.Open) connSalesforce.Close();
                }

                gvPaymentCreditCard.Rows.Clear();
                foreach (CreditCardPaymentInfo ccPaymentInfo in lstCreditCardPaymentInfo)
                {
                    DataGridViewRow row = new DataGridViewRow();
                    row.Cells.Add(new DataGridViewButtonCell { Value = "Confirm Payment" });
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = ccPaymentInfo.IndividualName });
                    row.Cells[1].ReadOnly = true;
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = ccPaymentInfo.MedicalProviderName });
                    row.Cells[2].ReadOnly = true;
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = ccPaymentInfo.MedicalProviderPhone });
                    row.Cells[3].ReadOnly = true;
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = ccPaymentInfo.AccountNoAtProvider });
                    row.Cells[4].ReadOnly = true;
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = ccPaymentInfo.IndividualBirthDate.Value.ToString("MM/dd/yyyy") });
                    row.Cells[5].ReadOnly = true;
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = ccPaymentInfo.SocialSecurityNumber });
                    row.Cells[6].ReadOnly = true;
                    DataGridViewTextBoxCell sexCell = new DataGridViewTextBoxCell();
                    if (ccPaymentInfo.Sex == "Male") sexCell.Value = "M";
                    else if (ccPaymentInfo.Sex == "Female") sexCell.Value = "F";
                    else if (ccPaymentInfo.Sex == "0") sexCell.Value = "Unknown";
                    row.Cells.Add(sexCell);
                    row.Cells[7].ReadOnly = true;
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = ccPaymentInfo.PrimaryName });
                    row.Cells[8].ReadOnly = true;
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = ccPaymentInfo.MailingStreet });
                    row.Cells[9].ReadOnly = true;
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = ccPaymentInfo.MailingCity });
                    row.Cells[10].ReadOnly = true;
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = ccPaymentInfo.MailingState });
                    row.Cells[11].ReadOnly = true;
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = ccPaymentInfo.MailingZip });
                    row.Cells[12].ReadOnly = true;
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = ccPaymentInfo.ServiceDate });
                    row.Cells[13].ReadOnly = true;
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = ccPaymentInfo.MedicalBillNo });
                    row.Cells[14].ReadOnly = true;
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = ccPaymentInfo.MedBillAmount.ToString("C") });
                    row.Cells[15].Style.Alignment = DataGridViewContentAlignment.MiddleRight;
                    row.Cells[15].ReadOnly = true;
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = ccPaymentInfo.SettlementName });
                    row.Cells[16].ReadOnly = true;
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = ccPaymentInfo.SettlementAmount.ToString("C") });
                    row.Cells[17].Style.Alignment = DataGridViewContentAlignment.MiddleRight;
                    DataGridViewComboBoxCell comboCreditCardCell = new DataGridViewComboBoxCell();
                    for (int i = 0; i < lstCreditCardInfo.Count; i++)
                    {
                        comboCreditCardCell.Items.Add(lstCreditCardInfo[i].CreditCardNo);
                    }
                    row.Cells.Add(comboCreditCardCell);
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = ccPaymentInfo.MembershipStatus });
                    row.Cells[19].ReadOnly = true;
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = ccPaymentInfo.SettlementNote });
                    row.Cells[20].ReadOnly = true;
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = ccPaymentInfo.CreateStaffName });
                    row.Cells[21].ReadOnly = true;
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = ccPaymentInfo.ModifyStaffName });
                    row.Cells[22].ReadOnly = true;
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = ccPaymentInfo.IndividualID });
                    row.Cells[23].ReadOnly = true;
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = ccPaymentInfo.MembershipNumber });
                    row.Cells[24].ReadOnly = true;

                    gvPaymentCreditCard.Rows.Add(row);
                }
                rdrCreditCardPayment.Close();
                if (connRN.State == ConnectionState.Open) connRN.Close();

                ////////////////////////////////////////////////////////////////////////////////////////////////////////////////

                //String strSqlQueryForCheckPayment = "select [SalesForce].[dbo].[contact].[Name], [SalesForce].[dbo].[contact].[Household_Role__c], " +
                //                         "[SalesForce].[dbo].[contact].[Individual_ID__c], [SalesForce].[dbo].[contact].[Primary_Name__c], " +
                //                         "[RN_DB].[dbo].[tbl_incident].[IncidentNo], [RN_DB].[dbo].[tbl_medbill].[BillNo], [RN_DB].[dbo].[tbl_settlement].[Name], " +
                //                         "[RN_DB].[dbo].[tbl_settlement].[Amount], [SalesForce].[dbo].[program].[Name], [RN_DB].[dbo].[tbl_program].[ProgramName], " +
                //                         "[SalesForce].[dbo].[contact].[Membership_IND_Start_date__c], [SalesForce].[dbo].[contact].[Membership_Number__c], " +
                //                         "[RN_DB].[dbo].[tbl_case].[IB_Receiv_Date], [RN_DB].[dbo].[tbl_medbill].[BillDate], [RN_DB].[dbo].[tbl_MedicalProvider].[Name], " +
                //                         "[SalesForce].[dbo].[contact].[MailingStreet], [SalesForce].[dbo].[contact].[MailingCity], " +
                //                         "[SalesForce].[dbo].[contact].[MailingState], [SalesForce].[dbo].[contact].[MailingPostalCode], " +
                //                         "[RN_DB].[dbo].[tbl_settlement_type_code].[SettlementTypeValue], [RN_DB].[dbo].[tbl_medbill].[WellBeingCareTotal], " +
                //                         "[SalesForce].[dbo].[account].[Name], [RN_DB].[dbo].[tbl_CreateStaff].[Staff_Name], [RN_DB].[dbo].[tbl_ModifiStaff].[Staff_Name], " +
                //                         "[SalesForce].[dbo].[contact].[c4g_Membership_Status__c], " +
                //                         "[RN_DB].[dbo].[tbl_settlement].[Approved], [RN_DB].[dbo].[tbl_settlement].[ApprovedDate] " +
                //                         "from [RN_DB].[dbo].[tbl_settlement] " +
                //                         "inner join [RN_DB].[dbo].[tbl_settlement_type_code] on [RN_DB].[dbo].[tbl_settlement].[SettlementType] = [RN_DB].[dbo].[tbl_settlement_type_code].[SettlementTypeCode] " +
                //                         "inner join [RN_DB].[dbo].[tbl_medbill] on [RN_DB].[dbo].[tbl_settlement].[MedicalBillID] = [RN_DB].[dbo].[tbl_medbill].[BillNo] " +
                //                         "inner join [RN_DB].[dbo].[tbl_case] on [RN_DB].[dbo].[tbl_medbill].[Case_Id] = [RN_DB].[dbo].[tbl_case].[Case_Name] " +
                //                         "inner join [RN_DB].[dbo].[tbl_incident] on [RN_DB].[dbo].[tbl_medbill].[Incident_Id] = [RN_DB].[dbo].[tbl_incident].[Incident_id] " +
                //                         "inner join [RN_DB].[dbo].[tbl_MedicalProvider] on [RN_DB].[dbo].[tbl_medbill].[MedicalProvider_Id] = [RN_DB].[dbo].[tbl_MedicalProvider].[ID] " +
                //                         "inner join [RN_DB].[dbo].[tbl_program] on [RN_DB].[dbo].[tbl_incident].[Program_id] = [RN_DB].[dbo].[tbl_program].[Program_Id] " +
                //                         "inner join [RN_DB].[dbo].[tbl_CreateStaff] on [RN_DB].[dbo].[tbl_medbill].[CreatedById] = [RN_DB].[dbo].[tbl_CreateStaff].[CreateStaff_Id] " +
                //                         "inner join [RN_DB].[dbo].[tbl_ModifiStaff] on [RN_DB].[dbo].[tbl_medbill].[LastModifiedById] = [RN_DB].[dbo].[tbl_ModifiStaff].[ModifiStaff_Id] " +
                //                         "inner join [SalesForce].[dbo].[contact] on [RN_DB].[dbo].[tbl_medbill].[Individual_Id] = [SalesForce].[dbo].[contact].[Individual_ID__c] " +
                //                         "inner join [SalesForce].[dbo].[program] on [SalesForce].[dbo].[contact].[c4g_Plan__c] = [SalesForce].[dbo].[program].[ID] " +
                //                         "inner join [SalesForce].[dbo].[account] on [SalesForce].[dbo].[contact].[AccountId] = [SalesForce].[dbo].[account].[ID] " +
                //                         "where [RN_DB].[dbo].[tbl_settlement].[IsDeleted] = 0 and " +
                //                         "[RN_DB].[dbo].[tbl_settlement].[CMMPaymentMethod] = 1 and " +
                //                         "[RN_DB].[dbo].[tbl_settlement].[Approved] = 1 and " +
                //                         "[RN_DB].[dbo].[tbl_settlement].[ApprovedDate] IS NOT NULL and " +
                //                         "[RN_DB].[dbo].[tbl_settlement].[CheckNo] IS NULL and " +
                //                         "[RN_DB].[dbo].[tbl_settlement].[CheckDate] IS NULL";

                String strSqlQueryForCheckPayment = "select [dbo].[tbl_settlement].[IsPaid], [dbo].[tbl_medbill].[Individual_Id], [dbo].[tbl_incident].[IncidentNo], " +
                                                    "[dbo].[tbl_program].[ProgramName], [dbo].[tbl_medbill].[BillDate], " +
                                                    "[dbo].[tbl_settlement].[Name], [dbo].[tbl_settlement].[Amount], [dbo].[tbl_medbill].[MedicalProvider_Id], " +
                                                    "[dbo].[tbl_settlement_type_code].[SettlementTypeValue], " +
                                                    "[dbo].[tbl_CreateStaff].[Staff_Name], [dbo].[tbl_ModifiStaff].[Staff_Name], " +
                                                    "[dbo].[tbl_medbill].[Account_At_Provider], [dbo].[tbl_settlement].[IsCheckExported], [dbo].[tbl_settlement].[CheckExportedByID] " +
                                                    "from [dbo].[tbl_settlement] " +
                                                    "inner join [dbo].[tbl_medbill] on [dbo].[tbl_settlement].[MedicalBillID] = [dbo].[tbl_medbill].[BillNo] " +
                                                    "inner join [dbo].[tbl_incident] on [dbo].[tbl_medbill].[Incident_Id] = [dbo].[tbl_incident].[Incident_id] " +
                                                    "inner join [dbo].[tbl_program] on [dbo].[tbl_incident].[Program_id] = [dbo].[tbl_program].[Program_Id] " +
                                                    "inner join [dbo].[tbl_settlement_type_code] on [dbo].[tbl_settlement].[SettlementType] = [dbo].[tbl_settlement_type_code].[SettlementTypeCode] " +
                                                    "inner join [dbo].[tbl_CreateStaff] on [dbo].[tbl_settlement].[CreateByID] = [dbo].[tbl_CreateStaff].[CreateStaff_Id] " +
                                                    "inner join [dbo].[tbl_ModifiStaff] on [dbo].[tbl_settlement].[LastModifiedByID] = [dbo].[tbl_ModifiStaff].[ModifiStaff_Id] " +
                                                    "where ([dbo].[tbl_settlement].[IsPaid] = 0 or [RN_DB].[dbo].[tbl_settlement].[IsPaid] IS NULL) and " +
                                                    "[dbo].[tbl_settlement].[PaidByID] IS NULL and " +
                                                    "([dbo].[tbl_settlement].[IsDeleted] = 0 or [dbo].[tbl_settlement].[IsDeleted] IS NULL) and " +
                                                    "([dbo].[tbl_settlement].[SettlementType] = 6 or " +
                                                    "[dbo].[tbl_settlement].[SettlementType] = 9) and " +
                                                    "[dbo].[tbl_settlement].[CMMPaymentMethod] = 1 and " +
                                                    "[dbo].[tbl_settlement].[Approved] = 1 and " +
                                                    "([dbo].[tbl_settlement].[ApprovedDate] IS NOT NULL or [dbo].[tbl_settlement].[ApprovedDate] <> '') and " +
                                                    "([dbo].[tbl_settlement].[CheckNo] IS NULL or [dbo].[tbl_settlement].[CheckNo] = '') and " +
                                                    "([dbo].[tbl_settlement].[CheckDate] IS NULL or [dbo].[tbl_settlement].[CheckDate] = '') and " +
                                                    "[dbo].[tbl_settlement].[CheckReconciled] = 0 " +
                                                    "order by [dbo].[tbl_medbill].[Individual_Id]";

                SqlCommand cmdQeuryForPaymentCheck = new SqlCommand(strSqlQueryForCheckPayment, connRN);
                cmdQeuryForPaymentCheck.CommandType = CommandType.Text;

                SqlDependency dependencyCheckPayment = new SqlDependency(cmdQeuryForPaymentCheck);
                dependencyCheckPayment.OnChange += new OnChangeEventHandler(OnCheckPaymentChange);

                if (connRN.State != ConnectionState.Closed)
                {
                    connRN.Close();
                    connRN.Open();
                }
                else if (connRN.State == ConnectionState.Closed) connRN.Open();
                //gvPaymentCheckMemberReimbursement.Rows.Clear();
                List<CheckPaymentInfo> lstCheckPaymentInfo = new List<CheckPaymentInfo>();
                SqlDataReader rdrCheckPayment = cmdQeuryForPaymentCheck.ExecuteReader();
                if (rdrCheckPayment.HasRows)
                {
                    while (rdrCheckPayment.Read())
                    {
                        CheckPaymentInfo infoCheckPayment = new CheckPaymentInfo();
                        if (!rdrCheckPayment.IsDBNull(0)) infoCheckPayment.bIsPaid = rdrCheckPayment.GetBoolean(0);
                        if (!rdrCheckPayment.IsDBNull(1)) infoCheckPayment.IndividualId = rdrCheckPayment.GetString(1);
                        if (!rdrCheckPayment.IsDBNull(2)) infoCheckPayment.IncidentNo = rdrCheckPayment.GetString(2);
                        if (!rdrCheckPayment.IsDBNull(3)) infoCheckPayment.IncidentProgram = rdrCheckPayment.GetString(3);
                        if (!rdrCheckPayment.IsDBNull(4)) infoCheckPayment.ServiceDate = rdrCheckPayment.GetDateTime(4);
                        if (!rdrCheckPayment.IsDBNull(5)) infoCheckPayment.SettlementNo = rdrCheckPayment.GetString(5);
                        if (!rdrCheckPayment.IsDBNull(6)) infoCheckPayment.SettlementAmount = rdrCheckPayment.GetDecimal(6);
                        if (!rdrCheckPayment.IsDBNull(7)) infoCheckPayment.MedicalProviderId = rdrCheckPayment.GetString(7);
                        if (!rdrCheckPayment.IsDBNull(8)) infoCheckPayment.SettlementType = rdrCheckPayment.GetString(8);
                        if (!rdrCheckPayment.IsDBNull(9)) infoCheckPayment.CreatedBy = rdrCheckPayment.GetString(9);
                        if (!rdrCheckPayment.IsDBNull(10)) infoCheckPayment.LastModifiedBy = rdrCheckPayment.GetString(10);
                        if (!rdrCheckPayment.IsDBNull(11)) infoCheckPayment.AccountNoAtMedProvider = rdrCheckPayment.GetString(11);
                        if (!rdrCheckPayment.IsDBNull(12)) infoCheckPayment.bIsExported = rdrCheckPayment.GetBoolean(12);
                        if (!rdrCheckPayment.IsDBNull(13)) infoCheckPayment.nExportedByID = rdrCheckPayment.GetInt16(13);

                        lstCheckPaymentInfo.Add(infoCheckPayment);
                    }
                }
                rdrCheckPayment.Close();
                if (connRN.State == ConnectionState.Open) connRN.Close();

                foreach (CheckPaymentInfo info in lstCheckPaymentInfo)
                {
                    String strSqlQueryForMedicalProviderName = "select [dbo].[account].[Name] from [dbo].[account] where [dbo].[account].[Id] = @MedicalProviderId";

                    SqlCommand cmdQueryForMedicalProviderName = new SqlCommand(strSqlQueryForMedicalProviderName, connSalesforce);
                    cmdQueryForMedicalProviderName.CommandType = CommandType.Text;

                    cmdQueryForMedicalProviderName.Parameters.AddWithValue("@MedicalProviderId", info.MedicalProviderId);

                    if (connSalesforce.State != ConnectionState.Closed)
                    {
                        connSalesforce.Close();
                        connSalesforce.Open();
                    }
                    else if (connSalesforce.State == ConnectionState.Closed) connSalesforce.Open();
                    Object objMedicalProviderName = cmdQueryForMedicalProviderName.ExecuteScalar();
                    if (connSalesforce.State == ConnectionState.Open) connSalesforce.Close();

                    String MedicalProviderName = String.Empty;
                    if (objMedicalProviderName != null) MedicalProviderName = objMedicalProviderName.ToString();

                    info.MedicalProviderName = MedicalProviderName;
                }

                foreach (CheckPaymentInfo info in lstCheckPaymentInfo)
                {
                    String strSqlQueryForIndividualInfoForCheckPayment = "select [dbo].[contact].[Name], [dbo].[contact].[Household_Role__c], " +
                                                                         "[dbo].[account].[Primary_Name__c], " +
                                                                         "[dbo].[account].[SHIPPINGSTREET], [dbo].[account].[SHIPPINGCITY], " +
                                                                         "[dbo].[account].[SHIPPINGSTATE], [dbo].[account].[SHIPPINGPOSTALCODE], " +
                                                                         "[dbo].[contact].[c4g_Membership_Status__c], [dbo].[contact].[Membership_Number__c] " +
                                                                         "from [dbo].[contact] " +
                                                                         "inner join [dbo].[program] on [dbo].[contact].[c4g_Plan__c] = [dbo].[program].[ID] " +
                                                                         "inner join [dbo].[account] on [dbo].[contact].[AccountId] = [dbo].[account].[ID] " +
                                                                         "where [dbo].[contact].[Individual_ID__c] = @IndividualId";

                    SqlCommand cmdQueryForIndividualInfoForCheckPayment = new SqlCommand(strSqlQueryForIndividualInfoForCheckPayment, connSalesforce);
                    cmdQueryForIndividualInfoForCheckPayment.CommandType = CommandType.Text;

                    cmdQueryForIndividualInfoForCheckPayment.Parameters.AddWithValue("@IndividualId", info.IndividualId);

                    if (connSalesforce.State != ConnectionState.Closed)
                    {
                        connSalesforce.Close();
                        connSalesforce.Open();
                    }
                    else if (connSalesforce.State == ConnectionState.Closed) connSalesforce.Open();
                    SqlDataReader rdrIndividualInfoForCheckPayment = cmdQueryForIndividualInfoForCheckPayment.ExecuteReader();
                    if (rdrIndividualInfoForCheckPayment.HasRows)
                    {
                        rdrIndividualInfoForCheckPayment.Read();

                        if (!rdrIndividualInfoForCheckPayment.IsDBNull(0)) info.IndividualName = rdrIndividualInfoForCheckPayment.GetString(0);
                        if (!rdrIndividualInfoForCheckPayment.IsDBNull(1)) info.HouseholdRole = rdrIndividualInfoForCheckPayment.GetString(1);
                        if (!rdrIndividualInfoForCheckPayment.IsDBNull(2)) info.PrimaryName = rdrIndividualInfoForCheckPayment.GetString(2);
                        if (!rdrIndividualInfoForCheckPayment.IsDBNull(3)) info.ShippingStreet = rdrIndividualInfoForCheckPayment.GetString(3);
                        if (!rdrIndividualInfoForCheckPayment.IsDBNull(4)) info.ShippingCity = rdrIndividualInfoForCheckPayment.GetString(4);
                        if (!rdrIndividualInfoForCheckPayment.IsDBNull(5)) info.ShippingState = rdrIndividualInfoForCheckPayment.GetString(5);
                        if (!rdrIndividualInfoForCheckPayment.IsDBNull(6)) info.ShippingZip = rdrIndividualInfoForCheckPayment.GetString(6);
                        if (!rdrIndividualInfoForCheckPayment.IsDBNull(7)) info.MembershipStatus = rdrIndividualInfoForCheckPayment.GetString(7);
                        if (!rdrIndividualInfoForCheckPayment.IsDBNull(8)) info.MemebershipNo = rdrIndividualInfoForCheckPayment.GetString(8);

                    }
                    rdrIndividualInfoForCheckPayment.Close();
                    if (connSalesforce.State == ConnectionState.Open) connSalesforce.Close();
                }

                gvPaymentCheckMemberReimbursement.Rows.Clear();
                foreach (CheckPaymentInfo info in lstCheckPaymentInfo)
                {
                    DataGridViewRow row = new DataGridViewRow();
                    row.Cells.Add(new DataGridViewCheckBoxCell { Value = false });
                    row.Cells.Add(new DataGridViewCheckBoxCell { Value = info.bIsExported });
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = info.IndividualName });
                    row.Cells[1].ReadOnly = true;
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = info.IndividualId });
                    row.Cells[2].ReadOnly = true;
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = info.HouseholdRole });
                    row.Cells[3].ReadOnly = true;
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = info.PrimaryName });
                    row.Cells[4].ReadOnly = true;
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = info.IncidentNo });
                    row.Cells[5].ReadOnly = true;
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = info.IncidentProgram });
                    row.Cells[6].ReadOnly = true;
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = info.SettlementNo });
                    row.Cells[7].ReadOnly = true;
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = info.SettlementAmount.ToString("C") });
                    row.Cells[8].ReadOnly = true;
                    row.Cells[8].Style.Alignment = DataGridViewContentAlignment.MiddleRight;
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = info.ServiceDate.Value.ToString("MM/dd/yyyy") });
                    row.Cells[9].ReadOnly = true;
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = info.MedicalProviderName });
                    row.Cells[10].ReadOnly = true;
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = info.AccountNoAtMedProvider });
                    row.Cells[11].ReadOnly = true;
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = info.ShippingStreet });
                    row.Cells[12].ReadOnly = true;
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = info.ShippingCity });
                    row.Cells[13].ReadOnly = true;
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = info.ShippingState });
                    row.Cells[14].ReadOnly = true;
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = info.ShippingZip });
                    row.Cells[15].ReadOnly = true;
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = info.SettlementType });
                    row.Cells[16].ReadOnly = true;
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = info.CreatedBy });
                    row.Cells[17].ReadOnly = true;
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = info.LastModifiedBy });
                    row.Cells[18].ReadOnly = true;
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = info.MembershipStatus });
                    row.Cells[19].ReadOnly = true;
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = info.MemebershipNo });
                    row.Cells[20].ReadOnly = true;

                    gvPaymentCheckMemberReimbursement.Rows.Add(row);
                }

                ////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                /// Check Payment to Medical Provider
                /// 
                String strSqlQueryForCheckPaymentToProvider = "select [dbo].[tbl_settlement].[IsPaid], [dbo].[tbl_medbill].[Individual_Id], [dbo].[tbl_incident].[IncidentNo], " +
                                                "[dbo].[tbl_program].[ProgramName], [dbo].[tbl_medbill].[BillDate], " +
                                                "[dbo].[tbl_settlement].[Name], [dbo].[tbl_settlement].[Amount], [dbo].[tbl_medbill].[MedicalProvider_Id], " +
                                                "[dbo].[tbl_settlement_type_code].[SettlementTypeValue], " +
                                                "[dbo].[tbl_CreateStaff].[Staff_Name], [dbo].[tbl_ModifiStaff].[Staff_Name], " +
                                                "[dbo].[tbl_medbill].[Account_At_Provider], [dbo].[tbl_settlement].[IsCheckExported], [dbo].[tbl_settlement].[CheckExportedByID] " +
                                                "from [dbo].[tbl_settlement] " +
                                                "inner join [dbo].[tbl_medbill] on [dbo].[tbl_settlement].[MedicalBillID] = [dbo].[tbl_medbill].[BillNo] " +
                                                "inner join [dbo].[tbl_incident] on [dbo].[tbl_medbill].[Incident_Id] = [dbo].[tbl_incident].[Incident_id] " +
                                                "inner join [dbo].[tbl_program] on [dbo].[tbl_incident].[Program_id] = [dbo].[tbl_program].[Program_Id] " +
                                                "inner join [dbo].[tbl_settlement_type_code] on [dbo].[tbl_settlement].[SettlementType] = [dbo].[tbl_settlement_type_code].[SettlementTypeCode] " +
                                                "inner join [dbo].[tbl_CreateStaff] on [dbo].[tbl_settlement].[CreateByID] = [dbo].[tbl_CreateStaff].[CreateStaff_Id] " +
                                                "inner join [dbo].[tbl_ModifiStaff] on [dbo].[tbl_settlement].[LastModifiedByID] = [dbo].[tbl_ModifiStaff].[ModifiStaff_Id] " +
                                                "where ([dbo].[tbl_settlement].[IsPaid] = 0 or [RN_DB].[dbo].[tbl_settlement].[IsPaid] IS NULL) and " +
                                                "[dbo].[tbl_settlement].[PaidByID] IS NULL and " +
                                                "[dbo].[tbl_settlement].[IsDeleted] = 0 and " +
                                                "[dbo].[tbl_settlement].[SettlementType] = 4 and " +
                                                "[dbo].[tbl_settlement].[CMMPaymentMethod] = 1 and " +
                                                "[dbo].[tbl_settlement].[Approved] = 1 and " +
                                                "([dbo].[tbl_settlement].[ApprovedDate] IS NOT NULL or [dbo].[tbl_settlement].[ApprovedDate] <> '') and " +
                                                "([dbo].[tbl_settlement].[CheckNo] IS NULL or [dbo].[tbl_settlement].[CheckNo] = '') and " +
                                                "([dbo].[tbl_settlement].[CheckDate] IS NULL or [dbo].[tbl_settlement].[CheckDate] = '') and " +
                                                "[dbo].[tbl_settlement].[CheckReconciled] = 0";
                                                //"order by [dbo].[tbl_medbill].[Individual_Id]";

                SqlCommand cmdQueryForCheckPaymentToProvider = new SqlCommand(strSqlQueryForCheckPaymentToProvider, connRN);
                cmdQueryForCheckPaymentToProvider.CommandType = CommandType.Text;

                SqlDependency dependencyCheckPaymentToProvider = new SqlDependency(cmdQueryForCheckPaymentToProvider);
                dependencyCheckPaymentToProvider.OnChange += new OnChangeEventHandler(OnCheckPaymentToProviderChange);

                if (connRN.State != ConnectionState.Closed)
                {
                    connRN.Close();
                    connRN.Open();
                }
                else if (connRN.State == ConnectionState.Closed) connRN.Open();
                //gvPaymentCheckProvider.Rows.Clear();
                List<CheckPaymentInfo> lstCheckPaymentToProviderInfo = new List<CheckPaymentInfo>();
                SqlDataReader rdrCheckPaymentToProvider = cmdQueryForCheckPaymentToProvider.ExecuteReader();
                if (rdrCheckPaymentToProvider.HasRows)
                {
                    while (rdrCheckPaymentToProvider.Read())
                    {
                        CheckPaymentInfo infoCheckPaymentToProvider = new CheckPaymentInfo();
                        if (!rdrCheckPaymentToProvider.IsDBNull(0)) infoCheckPaymentToProvider.bIsPaid = rdrCheckPaymentToProvider.GetBoolean(0);
                        if (!rdrCheckPaymentToProvider.IsDBNull(1)) infoCheckPaymentToProvider.IndividualId = rdrCheckPaymentToProvider.GetString(1);
                        if (!rdrCheckPaymentToProvider.IsDBNull(2)) infoCheckPaymentToProvider.IncidentNo = rdrCheckPaymentToProvider.GetString(2);
                        if (!rdrCheckPaymentToProvider.IsDBNull(3)) infoCheckPaymentToProvider.IncidentProgram = rdrCheckPaymentToProvider.GetString(3);
                        if (!rdrCheckPaymentToProvider.IsDBNull(4)) infoCheckPaymentToProvider.ServiceDate = rdrCheckPaymentToProvider.GetDateTime(4);
                        if (!rdrCheckPaymentToProvider.IsDBNull(5)) infoCheckPaymentToProvider.SettlementNo = rdrCheckPaymentToProvider.GetString(5);
                        if (!rdrCheckPaymentToProvider.IsDBNull(6)) infoCheckPaymentToProvider.SettlementAmount = rdrCheckPaymentToProvider.GetDecimal(6);
                        if (!rdrCheckPaymentToProvider.IsDBNull(7)) infoCheckPaymentToProvider.MedicalProviderId = rdrCheckPaymentToProvider.GetString(7);
                        if (!rdrCheckPaymentToProvider.IsDBNull(8)) infoCheckPaymentToProvider.SettlementType = rdrCheckPaymentToProvider.GetString(8);
                        if (!rdrCheckPaymentToProvider.IsDBNull(9)) infoCheckPaymentToProvider.CreatedBy = rdrCheckPaymentToProvider.GetString(9);
                        if (!rdrCheckPaymentToProvider.IsDBNull(10)) infoCheckPaymentToProvider.LastModifiedBy = rdrCheckPaymentToProvider.GetString(10);
                        if (!rdrCheckPaymentToProvider.IsDBNull(11)) infoCheckPaymentToProvider.AccountNoAtMedProvider = rdrCheckPaymentToProvider.GetString(11);
                        if (!rdrCheckPaymentToProvider.IsDBNull(12)) infoCheckPaymentToProvider.bIsExported = rdrCheckPaymentToProvider.GetBoolean(12);
                        if (!rdrCheckPaymentToProvider.IsDBNull(13)) infoCheckPaymentToProvider.nExportedByID = rdrCheckPaymentToProvider.GetInt16(13);

                        lstCheckPaymentToProviderInfo.Add(infoCheckPaymentToProvider);
                    }
                }
                rdrCheckPaymentToProvider.Close();
                if (connRN.State != ConnectionState.Closed) connRN.Close();

                foreach (CheckPaymentInfo info in lstCheckPaymentToProviderInfo)
                {
                    String strSqlQueryForMedicalProviderInfo = "select [dbo].[account].[Name], " +
                                                               "[dbo].[account].[ShippingStreet], [dbo].[account].[ShippingCity], " +
                                                               "[dbo].[account].[ShippinState], [dbo].[account].[ShippingPostalCode] " +
                                                               "from [dbo].[account] where [dbo].[account].[Id] = @MedicalProviderId";

                    SqlCommand cmdQueryForMedicalProviderInfo = new SqlCommand(strSqlQueryForMedicalProviderInfo, connSalesforce);
                    cmdQueryForMedicalProviderInfo.CommandType = CommandType.Text;

                    cmdQueryForMedicalProviderInfo.Parameters.AddWithValue("@MedicalProviderId", info.MedicalProviderId);

                    if (connSalesforce.State != ConnectionState.Closed)
                    {
                        connSalesforce.Close();
                        connSalesforce.Open();
                    }
                    else if (connSalesforce.State == ConnectionState.Closed) connSalesforce.Open();
                    SqlDataReader rdrMedicalProviderInfo = cmdQueryForMedicalProviderInfo.ExecuteReader();
                    if (rdrMedicalProviderInfo.HasRows)
                    {
                        if (!rdrMedicalProviderInfo.IsDBNull(0)) info.MedicalProviderName = rdrMedicalProviderInfo.GetString(0);
                        if (!rdrMedicalProviderInfo.IsDBNull(1)) info.ShippingStreet = rdrMedicalProviderInfo.GetString(1);
                        if (!rdrMedicalProviderInfo.IsDBNull(2)) info.ShippingCity = rdrMedicalProviderInfo.GetString(2);
                        if (!rdrMedicalProviderInfo.IsDBNull(3)) info.ShippingState = rdrMedicalProviderInfo.GetString(3);
                        if (!rdrMedicalProviderInfo.IsDBNull(4)) info.ShippingZip = rdrMedicalProviderInfo.GetString(4);
                    }
                    rdrMedicalProviderInfo.Close();
                    //Object objMedicalProviderInfo = cmdQueryForMedicalProviderInfo.ExecuteScalar();
                    if (connSalesforce.State == ConnectionState.Open) connSalesforce.Close();

                    //String MedicalProviderInfo = String.Empty;
                    //if (objMedicalProviderInfo != null) MedicalProviderInfo = objMedicalProviderInfo.ToString();

                    //info.MedicalProviderName = MedicalProviderInfo;
                }

                List<CheckPaymentInfo> lstSortedCheckPaymentToProviderInfo = new List<CheckPaymentInfo>();

                lstSortedCheckPaymentToProviderInfo = lstCheckPaymentToProviderInfo.OrderBy(info => info.MedicalProviderName).ThenBy(info => info.IncidentNo).ToList();

                foreach (CheckPaymentInfo info in lstSortedCheckPaymentToProviderInfo)
                {
                    String strSqlQueryForProviderInfoForProviderCheckPayment = "select [dbo].[contact].[Name], [dbo].[contact].[Household_Role__c], " +
                                                     "[dbo].[account].[Primary_Name__c], " +
                                                     //"[dbo].[account].[BillingStreet], [dbo].[account].[BillingCity], " +
                                                     //"[dbo].[account].[BillingState], [dbo].[account].[BillingPostalCode], " +
                                                     "[dbo].[contact].[c4g_Membership_Status__c], [dbo].[contact].[Membership_Number__c] " +
                                                     "from [dbo].[contact] " +
                                                     "inner join [dbo].[account] on [dbo].[contact].[AccountId] = [dbo].[account].[ID] " +
                                                     "where [dbo].[contact].[Individual_ID__c] = @IndividualId";

                    //String strSqlQueryForIndividualInfoForProviderCheckPayment = "select [dbo].[contact].[Name], [dbo].[contact].[Household_Role__c], " +
                    //                                                     "[dbo].[contact].[Primary_Name__c], " +
                    //                                                     "[dbo].[account].[SHIPPINGSTREET], [dbo].[account].[SHIPPINGCITY], " +
                    //                                                     "[dbo].[account].[SHIPPINGSTATE], [dbo].[account].[SHIPPINGPOSTALCODE], " +
                    //                                                     "[dbo].[contact].[c4g_Membership_Status__c], [dbo].[contact].[Membership_Number__c] " +
                    //                                                     "from [dbo].[contact] " +
                    //                                                     "inner join [dbo].[program] on [dbo].[contact].[c4g_Plan__c] = [dbo].[program].[ID] " +
                    //                                                     "inner join [dbo].[account] on [dbo].[contact].[AccountId] = [dbo].[account].[ID] " +
                    //                                                     "where [dbo].[contact].[Individual_ID__c] = @IndividualId";

                    SqlCommand cmdQueryForProviderInfoForCheckPaymentToProvider = new SqlCommand(strSqlQueryForProviderInfoForProviderCheckPayment, connSalesforce);
                    cmdQueryForProviderInfoForCheckPaymentToProvider.CommandType = CommandType.Text;

                    //cmdQueryForProviderInfoForCheckPaymentToProvider.Parameters.AddWithValue("@MedicalProviderId", info.MedicalProviderId);
                    cmdQueryForProviderInfoForCheckPaymentToProvider.Parameters.AddWithValue("@IndividualId", info.IndividualId);
                    
                    //cmdQueryForIndividualInfoForCheckPaymentToProvider.Parameters.AddWithValue("@IndividualId", info.IndividualId);

                    if (connSalesforce.State != ConnectionState.Closed)
                    {
                        connSalesforce.Close();
                        connSalesforce.Open();
                    }
                    else if (connSalesforce.State == ConnectionState.Closed) connSalesforce.Open();
                    SqlDataReader rdrProviderInfoForCheckPaymentToProvider = cmdQueryForProviderInfoForCheckPaymentToProvider.ExecuteReader();
                    if (rdrProviderInfoForCheckPaymentToProvider.HasRows)
                    {
                        rdrProviderInfoForCheckPaymentToProvider.Read();

                        if (!rdrProviderInfoForCheckPaymentToProvider.IsDBNull(0)) info.IndividualName = rdrProviderInfoForCheckPaymentToProvider.GetString(0);
                        if (!rdrProviderInfoForCheckPaymentToProvider.IsDBNull(1)) info.HouseholdRole = rdrProviderInfoForCheckPaymentToProvider.GetString(1);
                        if (!rdrProviderInfoForCheckPaymentToProvider.IsDBNull(2)) info.PrimaryName = rdrProviderInfoForCheckPaymentToProvider.GetString(2);
                        //if (!rdrProviderInfoForCheckPaymentToProvider.IsDBNull(3)) info.ShippingStreet = rdrProviderInfoForCheckPaymentToProvider.GetString(3);
                        //if (!rdrProviderInfoForCheckPaymentToProvider.IsDBNull(4)) info.ShippingCity = rdrProviderInfoForCheckPaymentToProvider.GetString(4);
                        //if (!rdrProviderInfoForCheckPaymentToProvider.IsDBNull(5)) info.ShippingState = rdrProviderInfoForCheckPaymentToProvider.GetString(5);
                        //if (!rdrProviderInfoForCheckPaymentToProvider.IsDBNull(6)) info.ShippingZip = rdrProviderInfoForCheckPaymentToProvider.GetString(6);
                        if (!rdrProviderInfoForCheckPaymentToProvider.IsDBNull(7)) info.MembershipStatus = rdrProviderInfoForCheckPaymentToProvider.GetString(3);
                        if (!rdrProviderInfoForCheckPaymentToProvider.IsDBNull(8)) info.MemebershipNo = rdrProviderInfoForCheckPaymentToProvider.GetString(4);

                    }
                    rdrProviderInfoForCheckPaymentToProvider.Close();
                    if (connSalesforce.State == ConnectionState.Open) connSalesforce.Close();
                }

                gvPaymentCheckProvider.Rows.Clear();
                foreach (CheckPaymentInfo info in lstSortedCheckPaymentToProviderInfo)
                {
                    DataGridViewRow row = new DataGridViewRow();
                    row.Cells.Add(new DataGridViewCheckBoxCell { Value = false });
                    row.Cells.Add(new DataGridViewCheckBoxCell { Value = info.bIsExported });
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = info.IndividualName });
                    row.Cells[1].ReadOnly = true;
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = info.IndividualId });
                    row.Cells[2].ReadOnly = true;
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = info.HouseholdRole });
                    row.Cells[3].ReadOnly = true;
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = info.PrimaryName });
                    row.Cells[4].ReadOnly = true;
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = info.IncidentNo });
                    row.Cells[5].ReadOnly = true;
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = info.IncidentProgram });
                    row.Cells[6].ReadOnly = true;
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = info.SettlementNo });
                    row.Cells[7].ReadOnly = true;
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = info.SettlementAmount.ToString("C") });
                    row.Cells[8].ReadOnly = true;
                    row.Cells[8].Style.Alignment = DataGridViewContentAlignment.MiddleRight;
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = info.ServiceDate.Value.ToString("MM/dd/yyyy") });
                    row.Cells[9].ReadOnly = true;
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = info.MedicalProviderName });
                    row.Cells[10].ReadOnly = true;
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = info.MedicalProviderId });
                    row.Cells[11].ReadOnly = true;
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = info.AccountNoAtMedProvider });
                    row.Cells[12].ReadOnly = true;
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = info.ShippingStreet });
                    row.Cells[13].ReadOnly = true;
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = info.ShippingCity });
                    row.Cells[14].ReadOnly = true;
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = info.ShippingState });
                    row.Cells[15].ReadOnly = true;
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = info.ShippingZip });
                    row.Cells[16].ReadOnly = true;
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = info.SettlementType });
                    row.Cells[17].ReadOnly = true;
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = info.CreatedBy });
                    row.Cells[18].ReadOnly = true;
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = info.LastModifiedBy });
                    row.Cells[19].ReadOnly = true;
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = info.MembershipStatus });
                    row.Cells[20].ReadOnly = true;
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = info.MemebershipNo });
                    row.Cells[21].ReadOnly = true;

                    gvPaymentCheckProvider.Rows.Add(row);
                }


                //////////////////////////////////////////////////////////////////////////////////////////////////////////////
                ///
                String strSqlQueryForACHPayment = "select [dbo].[tbl_settlement].[IsPaid], [dbo].[tbl_medbill].[Individual_Id], " +
                                                  "[dbo].[tbl_settlement].[Name], [dbo].[tbl_settlement].[Amount], " +
                                                  "[dbo].[tbl_CreateStaff].[Staff_Name], [dbo].[tbl_ModifiStaff].[Staff_Name], " +
                                                  "[dbo].[tbl_settlement].[IsACHExported], [dbo].[tbl_settlement].[ACHExportedByID], " +
                                                  "[dbo].[tbl_settlement].[SettlementType] " +
                                                  "from [dbo].[tbl_settlement] " +
                                                  "inner join [dbo].[tbl_medbill] on [dbo].[tbl_settlement].[MedicalBillID] = [dbo].[tbl_medbill].[BillNo] " +
                                                  "inner join [dbo].[tbl_CreateStaff] on [dbo].[tbl_medbill].[CreatedById] = [dbo].[tbl_CreateStaff].[CreateStaff_Id] " +
                                                  "inner join [dbo].[tbl_ModifiStaff] on [dbo].[tbl_medbill].[LastModifiedById] = [dbo].[tbl_ModifiStaff].[ModifiStaff_Id] " +
                                                  "where ([dbo].[tbl_settlement].[IsPaid] = 0 or [RN_DB].[dbo].[tbl_settlement].[IsPaid] IS NULL) and " +
                                                  "[dbo].[tbl_settlement].[PaidByID] IS NULL and " +
                                                  "[dbo].[tbl_settlement].[IsDeleted] = 0 and " +
                                                  "([dbo].[tbl_settlement].[SettlementType] = 4 or " +
                                                  "[dbo].[tbl_settlement].[SettlementType] = 6 or " +
                                                  "[dbo].[tbl_settlement].[SettlementType] = 9) and " +
                                                  "[dbo].[tbl_settlement].[CMMPaymentMethod] = 3 and " +
                                                  "[dbo].[tbl_settlement].[Approved] = 1 and " +
                                                  "([dbo].[tbl_settlement].[ApprovedDate] IS NOT NULL or [dbo].[tbl_settlement].[ApprovedDate] <> '') and " +
                                                  "([dbo].[tbl_settlement].[ACH_Number] IS NULL or [dbo].[tbl_settlement].[ACH_Number] = '') and " +
                                                  "([dbo].[tbl_settlement].[ACH_Date] IS NULL or [dbo].[tbl_settlement].[ACH_Date] = '') " +
                                                  "order by [dbo].[tbl_medbill].[Individual_Id]";


                SqlCommand cmdPaymentACH = new SqlCommand(strSqlQueryForACHPayment, connRN);
                cmdPaymentACH.CommandType = CommandType.Text;

                SqlDependency dependencyPaymentACH = new SqlDependency(cmdPaymentACH);
                dependencyPaymentACH.OnChange += new OnChangeEventHandler(OnACHPaymentChange);

                if (connRN.State != ConnectionState.Closed)
                {
                    connRN.Close();
                    connRN.Open();
                }
                else if (connRN.State == ConnectionState.Closed) connRN.Open();
                SqlDataReader rdrPaymentACH = cmdPaymentACH.ExecuteReader();
                List<ACHPaymentInfo> lstACHPaymentInfo = new List<ACHPaymentInfo>();
                if (rdrPaymentACH.HasRows)
                {
                    while (rdrPaymentACH.Read())
                    {
                        ACHPaymentInfo achInfo = new ACHPaymentInfo();

                        if (!rdrPaymentACH.IsDBNull(0)) achInfo.bIsPaid = rdrPaymentACH.GetBoolean(0);
                        if (!rdrPaymentACH.IsDBNull(1)) achInfo.IndividualId = rdrPaymentACH.GetString(1);
                        if (!rdrPaymentACH.IsDBNull(2)) achInfo.SettlementNo = rdrPaymentACH.GetString(2);
                        if (!rdrPaymentACH.IsDBNull(3)) achInfo.SettlementAmount = rdrPaymentACH.GetDecimal(3);
                        if (!rdrPaymentACH.IsDBNull(4)) achInfo.CreateStaffName = rdrPaymentACH.GetString(4);
                        if (!rdrPaymentACH.IsDBNull(5)) achInfo.ModifiStaffName = rdrPaymentACH.GetString(5);
                        if (!rdrPaymentACH.IsDBNull(6)) achInfo.bIsExported = rdrPaymentACH.GetBoolean(6);
                        if (!rdrPaymentACH.IsDBNull(7)) achInfo.nExportedBy = rdrPaymentACH.GetInt16(7);
                        if (!rdrPaymentACH.IsDBNull(8)) achInfo.nSettlementType = rdrPaymentACH.GetInt16(8);
                        
                        lstACHPaymentInfo.Add(achInfo);
                    }
                }
                if (connRN.State == ConnectionState.Closed) connRN.Open();

                foreach (ACHPaymentInfo info in lstACHPaymentInfo)
                {
                    String strSqlQueryForIndividualInfo = "select [dbo].[contact].[Name], " +
                                                          "[dbo].[contact].[BankName__c], [dbo].[contact].[RoutingNumber__c], " +
                                                          "[dbo].[contact].[AccountNumber__c], [dbo].[contact].[AccountHolder__c], " +
                                                          "[dbo].[membership].[Pay_BankName__c], [dbo].[membership].[Pay_RoutingNumber__c], " +
                                                          "[dbo].[membership].[Pay_AccountNumber__c], [dbo].[membership].[Pay_AccountHolder__c], " +
                                                          "[dbo].[contact].[c4g_Membership_Status__c], " +
                                                          "[dbo].[contact].[LastName], [dbo].[contact].[FirstName], [dbo].[contact].[MiddleName] " +
                                                          "from [dbo].[contact] " +
                                                          "inner join [dbo].[membership] on [dbo].[contact].[c4g_Membership__c] = [dbo].[membership].[Id] " +
                                                          "where [dbo].[contact].[Individual_ID__c] = @IndividualId";

                    SqlCommand cmdQueryForIndividualInfo = new SqlCommand(strSqlQueryForIndividualInfo, connSalesforce);
                    cmdQueryForIndividualInfo.CommandType = CommandType.Text;

                    cmdQueryForIndividualInfo.Parameters.AddWithValue("@IndividualId", info.IndividualId);

                    if (connSalesforce.State != ConnectionState.Closed)
                    {
                        connSalesforce.Close();
                        connSalesforce.Open();
                    }
                    else if (connSalesforce.State == ConnectionState.Closed) connSalesforce.Open();

                    SqlDataReader rdrACHPaymentIndividualInfo = cmdQueryForIndividualInfo.ExecuteReader();
                    if (rdrACHPaymentIndividualInfo.HasRows)
                    {
                        rdrACHPaymentIndividualInfo.Read();
                        if (!rdrACHPaymentIndividualInfo.IsDBNull(0)) info.IndividualName = rdrACHPaymentIndividualInfo.GetString(0);
                        if (!rdrACHPaymentIndividualInfo.IsDBNull(1)) info.BankName = rdrACHPaymentIndividualInfo.GetString(1);
                        else if (!rdrACHPaymentIndividualInfo.IsDBNull(5)) info.BankName = rdrACHPaymentIndividualInfo.GetString(5);
                        if (!rdrACHPaymentIndividualInfo.IsDBNull(2)) info.RoutingNumber = rdrACHPaymentIndividualInfo.GetString(2);
                        else if (!rdrACHPaymentIndividualInfo.IsDBNull(6)) info.RoutingNumber = rdrACHPaymentIndividualInfo.GetString(6);
                        if (!rdrACHPaymentIndividualInfo.IsDBNull(3)) info.AccountNumber = rdrACHPaymentIndividualInfo.GetString(3);
                        else if (!rdrACHPaymentIndividualInfo.IsDBNull(7)) info.AccountNumber = rdrACHPaymentIndividualInfo.GetString(7);
                        if (!rdrACHPaymentIndividualInfo.IsDBNull(4)) info.AccountHolder = rdrACHPaymentIndividualInfo.GetString(4);
                        else if (!rdrACHPaymentIndividualInfo.IsDBNull(8)) info.AccountHolder = rdrACHPaymentIndividualInfo.GetString(8);
                        if (!rdrACHPaymentIndividualInfo.IsDBNull(5)) info.MembershipStatus = rdrACHPaymentIndividualInfo.GetString(9);
                        if (!rdrACHPaymentIndividualInfo.IsDBNull(10)) info.LastName = rdrACHPaymentIndividualInfo.GetString(10);
                        else info.LastName = String.Empty;
                        if (!rdrACHPaymentIndividualInfo.IsDBNull(11)) info.FirstName = rdrACHPaymentIndividualInfo.GetString(11);
                        else info.FirstName = String.Empty;
                        if (!rdrACHPaymentIndividualInfo.IsDBNull(12)) info.MiddleName = rdrACHPaymentIndividualInfo.GetString(12);
                        else info.MiddleName = String.Empty;
                    }
                    rdrACHPaymentIndividualInfo.Close();
                    if (connSalesforce.State == ConnectionState.Open) connSalesforce.Close();
                }

                gvPaymentACH.Rows.Clear();
                foreach (ACHPaymentInfo info in lstACHPaymentInfo)
                {
                    DataGridViewRow row = new DataGridViewRow();
                    row.Cells.Add(new DataGridViewCheckBoxCell { Value = false });
                    row.Cells.Add(new DataGridViewCheckBoxCell { Value = info.bIsExported });
                    row.Cells[1].ReadOnly = true;
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = info.IndividualName });
                    row.Cells[2].ReadOnly = true;
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = info.IndividualId });
                    row.Cells[3].ReadOnly = true;
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = info.SettlementNo });
                    row.Cells[4].ReadOnly = true;
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = info.SettlementAmount.ToString("C") });
                    row.Cells[5].Style.Alignment = DataGridViewContentAlignment.MiddleRight;
                    row.Cells[5].ReadOnly = true;
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = info.BankName });
                    row.Cells[6].ReadOnly = true;
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = info.RoutingNumber });
                    row.Cells[7].ReadOnly = true;
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = info.AccountNumber });
                    row.Cells[8].ReadOnly = true;
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = info.AccountHolder });
                    row.Cells[9].ReadOnly = true;
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = info.CreateStaffName });
                    row.Cells[10].ReadOnly = true;
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = info.ModifiStaffName });
                    row.Cells[11].ReadOnly = true;
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = info.MembershipStatus });
                    row.Cells[12].ReadOnly = true;
                    if (info.nSettlementType == 6 || info.nSettlementType == 9) row.Cells.Add(new DataGridViewCheckBoxCell { Value = true });
                    else row.Cells.Add(new DataGridViewCheckBoxCell { Value = false });
                    row.Cells[13].ReadOnly = true;
                    if (info.MiddleName != String.Empty) row.Cells.Add(new DataGridViewTextBoxCell { Value = info.LastName + "," + info.FirstName + " " + info.MiddleName });
                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = info.LastName + "," + info.FirstName });
                    row.Cells[14].ReadOnly = true;

                    gvPaymentACH.Rows.Add(row);
                }

                List<String> lstIndividualIDs = new List<String>();
                String strSqlQueryForPaymentInactive = "select distinct([dbo].[tbl_medbill].[Individual_Id]) " +
                                                        "from [dbo].[tbl_medbill] " +
                                                        "inner join [dbo].[tbl_settlement] on [dbo].[tbl_medbill].[BillNo] = [dbo].[tbl_settlement].[MedicalBillID] " +
                                                        "where ([dbo].[tbl_settlement].[IsPaid] = 0 or [RN_DB].[dbo].[tbl_settlement].[IsPaid] IS NULL) and " +
                                                        "[dbo].[tbl_settlement].[PaidByID] IS NULL and " +
                                                        "[dbo].[tbl_settlement].[IsDeleted] = 0 and " +
                                                        "([dbo].[tbl_settlement].[SettlementType] = 4 or " +
                                                        "[dbo].[tbl_settlement].[SettlementType] = 6 or " +
                                                        "[dbo].[tbl_settlement].[SettlementType] = 9) and " +
                                                        "[dbo].[tbl_settlement].[Approved] = 1 and " +
                                                        "[dbo].[tbl_settlement].[ApprovedDate] IS NOT NULL " +
                                                        "order by [dbo].[tbl_medbill].[Individual_Id]";

                SqlCommand cmdQueryForPaymentInactive = new SqlCommand(strSqlQueryForPaymentInactive, connRN);
                cmdQueryForPaymentInactive.CommandType = CommandType.Text;

                SqlDependency dependencyPaymentInactive = new SqlDependency(cmdQueryForPaymentInactive);
                dependencyPaymentInactive.OnChange += new OnChangeEventHandler(OnPaymentInactiveChange);

                if (connRN.State != ConnectionState.Closed)
                {
                    connRN.Close();
                    connRN.Open();
                }
                else if (connRN.State == ConnectionState.Closed) connRN.Open();
                SqlDataReader rdrPaymentInactive = cmdQueryForPaymentInactive.ExecuteReader();
                gvPaymentInactive.Rows.Clear();
                if (rdrPaymentInactive.HasRows)
                {
                    while (rdrPaymentInactive.Read())
                    {
                        String IndividualID = String.Empty;
                        if (!rdrPaymentInactive.IsDBNull(0)) IndividualID = rdrPaymentInactive.GetString(0);
                        lstIndividualIDs.Add(IndividualID);
                    }
                }
                rdrPaymentInactive.Close();
                if (connRN.State == ConnectionState.Open) connRN.Close();

                List<InactivePaymentInfo> lstInactivePaymentInfo = new List<InactivePaymentInfo>();
                foreach (String IndividualId in lstIndividualIDs)
                {
                    String strSqlQueryForIndividualInfo = "select [dbo].[contact].[Name], [dbo].[contact].[Membership_Number__c], [dbo].[contact].[c4g_Membership_Status__c], " +
                                                           "[dbo].[account].[ShippingState], " +
                                                           "[dbo].[contact].[Email], [dbo].[account].[cmm_Email__c], " +
                                                           "[dbo].[contact].[Phone], [dbo].[account].[Phone] " +
                                                           "from [dbo].[contact] " +
                                                           "inner join [dbo].[account] on [dbo].[contact].[AccountId] = [dbo].[account].[Id] " +
                                                           "where ([dbo].[contact].[c4g_Membership_Status__c] like '%Cancelled%' or " +
                                                           "cast([dbo].[contact].[c4g_Membership_Status__c] as nvarchar(max)) = 'Past Due' or " +
                                                           "cast([dbo].[contact].[c4g_Membership_Status__c] as nvarchar(max)) = 'Hold' or " +
                                                           "cast([dbo].[contact].[c4g_Membership_Status__c] as nvarchar(max)) IS NULL) and " +
                                                           "[dbo].[contact].[Individual_ID__c] = @IndividualId";

                    SqlCommand cmdQueryForIndividualInfo = new SqlCommand(strSqlQueryForIndividualInfo, connSalesforce);
                    cmdQueryForIndividualInfo.CommandType = CommandType.Text;

                    cmdQueryForIndividualInfo.Parameters.AddWithValue("@IndividualId", IndividualId);

                    if (connSalesforce.State != ConnectionState.Closed)
                    {
                        connSalesforce.Close();
                        connSalesforce.Open();
                    }
                    else if (connSalesforce.State == ConnectionState.Closed) connSalesforce.Open();
                    SqlDataReader rdrPaymentInactiveIndividual = cmdQueryForIndividualInfo.ExecuteReader();
                    if (rdrPaymentInactiveIndividual.HasRows)
                    {
                        rdrPaymentInactiveIndividual.Read();
                        InactivePaymentInfo info = new InactivePaymentInfo();
                        info.IndividualId = IndividualId;
                        if (!rdrPaymentInactiveIndividual.IsDBNull(0)) info.IndividualName = rdrPaymentInactiveIndividual.GetString(0);
                        if (!rdrPaymentInactiveIndividual.IsDBNull(1)) info.MembershipNo = rdrPaymentInactiveIndividual.GetString(1);
                        if (!rdrPaymentInactiveIndividual.IsDBNull(2)) info.MembershipStatus = rdrPaymentInactiveIndividual.GetString(2);
                        if (!rdrPaymentInactiveIndividual.IsDBNull(3)) info.State = rdrPaymentInactiveIndividual.GetString(3);
                        if (!rdrPaymentInactiveIndividual.IsDBNull(4)) info.Email = rdrPaymentInactiveIndividual.GetString(4);
                        else if (!rdrPaymentInactiveIndividual.IsDBNull(5)) info.Email = rdrPaymentInactiveIndividual.GetString(5);
                        if (!rdrPaymentInactiveIndividual.IsDBNull(6)) info.Phone = rdrPaymentInactiveIndividual.GetString(6);
                        else if (!rdrPaymentInactiveIndividual.IsDBNull(7)) info.Phone = rdrPaymentInactiveIndividual.GetString(7);
                        lstInactivePaymentInfo.Add(info);
                    }
                    rdrPaymentInactiveIndividual.Close();
                    if (connSalesforce.State == ConnectionState.Open) connSalesforce.Close();
                }
                gvPaymentInactive.Rows.Clear();
                foreach (InactivePaymentInfo info in lstInactivePaymentInfo)
                {
                    DataGridViewRow row = new DataGridViewRow();
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = info.IndividualId });
                    row.Cells[0].ReadOnly = true;
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = info.IndividualName });
                    row.Cells[1].ReadOnly = true;
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = info.MembershipNo });
                    row.Cells[2].ReadOnly = true;
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = info.MembershipStatus });
                    row.Cells[3].ReadOnly = true;
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = info.State });
                    row.Cells[4].ReadOnly = true;
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = info.Email });
                    row.Cells[5].ReadOnly = true;
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = info.Phone });
                    row.Cells[6].ReadOnly = true;
                    gvPaymentInactive.Rows.Add(row);
                }


                // Check reconcilation code here
                String strSqlQueryForPaidCheckForReconcile = "select [dbo].[tbl_settlement].[Name], [dbo].[tbl_settlement_type_code].[SettlementTypeValue], " +
                                                             "[dbo].[tbl_settlement].[Amount], " +
                                                             "[dbo].[tbl_medbill].[Individual_Id], [dbo].[tbl_settlement].[CheckNo], [dbo].[tbl_settlement].[CheckDate], " +
                                                             "[dbo].[tbl_settlement].[Notes] " +
                                                             "from [dbo].[tbl_settlement] " +
                                                             "inner join [dbo].[tbl_settlement_type_code] on [dbo].[tbl_settlement].[settlementType] = [dbo].[tbl_settlement_type_code].[SettlementTypeCode] " +
                                                             "inner join [dbo].[tbl_medbill] on [dbo].[tbl_settlement].[MedicalBillID] = [dbo].[tbl_medbill].[BillNo] " +
                                                             "where [dbo].[tbl_settlement].[IsPaid] = 1 and " +
                                                             "([dbo].[tbl_settlement_type_code].[SettlementTypeValue] = 'CMM Provider Payment' or " +
                                                             "[dbo].[tbl_settlement_type_code].[SettlementTypeValue] = 'CMM Member Reimbursement' or " +
                                                             "[dbo].[tbl_settlement_type_code].[SettlementTypeValue] = 'PR Reimbursement') and " +
                                                             "([dbo].[tbl_settlement].[CheckNo] IS NOT NULL or [dbo].[tbl_settlement].[CheckNo] <> '') and " +
                                                             "([dbo].[tbl_settlement].[CheckDate] IS NOT NULL or [dbo].[tbl_settlement].[CheckDate] <> '') and " +
                                                             "([dbo].[tbl_settlement].[CheckReconciled] = 0 or [dbo].[tbl_settlement].[CheckReconciled] IS NULL) and " +
                                                             "([dbo].[tbl_settlement].[IsDeleted] = 0 or [dbo].[tbl_settlement].[IsDeleted] IS NULL) " +
                                                             "order by [dbo].[tbl_settlement].[CheckNo]";

                SqlCommand cmdQueryForPaidCheckForReconcile = new SqlCommand(strSqlQueryForPaidCheckForReconcile, connRN3);
                cmdQueryForPaidCheckForReconcile.CommandType = CommandType.Text;

                SqlDependency dependencyPaidCheckForReconcile = new SqlDependency(cmdQueryForPaidCheckForReconcile);
                dependencyPaidCheckForReconcile.OnChange += new OnChangeEventHandler(OnPaidCheckForReconcileChange);

                gvCheckReconcilation.Rows.Clear();
                if (connRN3.State != ConnectionState.Closed)
                {
                    connRN3.Close();
                    connRN3.Open();
                }
                else if (connRN3.State == ConnectionState.Closed) connRN3.Open();
                SqlDataReader rdrCheckPaidForReconcile = cmdQueryForPaidCheckForReconcile.ExecuteReader();
                if (rdrCheckPaidForReconcile.HasRows)
                {
                    while (rdrCheckPaidForReconcile.Read())
                    {
                        DataGridViewRow row = new DataGridViewRow();
                        row.Cells.Add(new DataGridViewCheckBoxCell { Value = false });
                        if (!rdrCheckPaidForReconcile.IsDBNull(0)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrCheckPaidForReconcile.GetString(0) });
                        if (!rdrCheckPaidForReconcile.IsDBNull(1)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrCheckPaidForReconcile.GetString(1) });
                        if (!rdrCheckPaidForReconcile.IsDBNull(2)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrCheckPaidForReconcile.GetDecimal(2).ToString("C") });
                        if (!rdrCheckPaidForReconcile.IsDBNull(3)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrCheckPaidForReconcile.GetString(3) });
                        if (!rdrCheckPaidForReconcile.IsDBNull(4)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrCheckPaidForReconcile.GetString(4) });
                        if (!rdrCheckPaidForReconcile.IsDBNull(5)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrCheckPaidForReconcile.GetDateTime(5).ToString("MM/dd/yyyy") });
                        if (!rdrCheckPaidForReconcile.IsDBNull(6)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrCheckPaidForReconcile.GetString(6) });
                        gvCheckReconcilation.Rows.Add(row);
                    }
                }
                if (connRN3.State != ConnectionState.Closed) connRN3.Close();

                pdfBlueSheetViewer.src = "C:\\Program Files (x86)\\RN\\RNManager\\blank.pdf";
                //////////////////////////////////////////////////////////////////////////////////////////////////////////////

                // Upload buttons for Case Creation tab
                ToolTip tipUploadNPF = new ToolTip();
                tipUploadNPF.SetToolTip(btnNPFFormUpload, "Upload the Needs Processing Form to the server");

                ToolTip tipUploadIB = new ToolTip();
                tipUploadIB.SetToolTip(btnIBUpload, "Upload the Itemized Bill to the server");

                ToolTip tipUploadPoP = new ToolTip();
                tipUploadPoP.SetToolTip(btnPoPUpload, "Upload the Proof of Payment to the server");

                ToolTip tipUploadMedRec = new ToolTip();
                tipUploadMedRec.SetToolTip(btnMedicalRecordUpload, "Upload the Medical Record to the server");

                ToolTip tipUploadUnknownDoc = new ToolTip();
                tipUploadUnknownDoc.SetToolTip(btnUnknownDocUpload, "Upload the Unknown Document to the server");

                // View buttons for Case Creation tab
                ToolTip tipViewNPFCreateCase = new ToolTip();
                tipViewNPFCreateCase.SetToolTip(btnNPFFormView, "View the NPF Form on the server");

                ToolTip tipViewIBCreateCase = new ToolTip();
                tipViewIBCreateCase.SetToolTip(btnIBView, "View the Itemized Bill on the server");

                ToolTip tipViewPoPCreateCase = new ToolTip();
                tipViewPoPCreateCase.SetToolTip(btnPoPView, "View the Proof of Payment on the server");

                ToolTip tipViewMedRecCreateCase = new ToolTip();
                tipViewMedRecCreateCase.SetToolTip(btnMedicalRecordView, "View the Medical Record Document on the server");

                ToolTip tipViewUnknownDocCreateCase = new ToolTip();
                tipViewUnknownDocCreateCase.SetToolTip(btnOtherDocView, "View the Unknown Document on the server");


                // Delete buttons for Case Creation tab
                ToolTip tipDeleteNPF = new ToolTip();
                tipDeleteNPF.SetToolTip(btnNPFFormDelete, "Delete the uploaded Needs Processing Form on the server");

                ToolTip tipDeleteIB = new ToolTip();
                tipDeleteIB.SetToolTip(btnDeleteIB, "Delete the uploaded Itemized Bill on the server");

                ToolTip tipDeletePoP = new ToolTip();
                tipDeletePoP.SetToolTip(btnDeletePoP, "Delete the uploaded Proof of Payment on the server");

                ToolTip tipDeleteMedRec = new ToolTip();
                tipDeleteMedRec.SetToolTip(btnDeleteMedicalRecord, "Delete the uploaded Medical Record on the server");

                ToolTip tipDeleteUnknownDoc = new ToolTip();
                tipDeleteUnknownDoc.SetToolTip(btnDeleteUnknownDoc, "Delete the uploaded Unknown Document on the server");

                // Tooltips for Medical Bill tab

                // View buttons for Medical Bill tab
                ToolTip tipViewNPF = new ToolTip();
                tipViewNPF.SetToolTip(btnViewNPF, "View the Needs Processing Form on the server");

                ToolTip tipViewIB = new ToolTip();
                tipViewIB.SetToolTip(btnViewIB, "View the Itemized Bill on the server");

                ToolTip tipViewPoP = new ToolTip();
                tipViewPoP.SetToolTip(btnViewPoP, "View the Proof of Payment on the server");

                ToolTip tipViewMedRec = new ToolTip();
                tipViewMedRec.SetToolTip(btnViewMedRecord, "View the Medical Record on the server");

                ToolTip tipViewUnknownDoc = new ToolTip();
                tipViewUnknownDoc.SetToolTip(btnViewOtherDoc, "View the Unknown Documents on the server");

                // ToolTips for Illness button and Incident button
                ToolTip tipIllness = new ToolTip();
                tipIllness.SetToolTip(btnMedBill_lllness, "Create illness or choose illness");

                ToolTip tipIncident = new ToolTip();
                tipIncident.SetToolTip(btnMedBill_Incident, "Create incident or choose incident");

                // Tooltips on Settlement
                ToolTip tipAddNewSettlement = new ToolTip();
                tipAddNewSettlement.SetToolTip(btnAddNewSettlement, "Add New Settlement");

                //ToolTip tipEditSettlement = new ToolTip();
                //tipEditSettlement.SetToolTip(btnEditSettlement, "Edit the Seleted Settlement");

                ToolTip tipDeleteSettlement = new ToolTip();
                tipDeleteSettlement.SetToolTip(btnDeleteSettlement, "Delete the Selected Settlement");



                tbCMMManager.SelectedIndex = 1;

                PrevTabPage = TabPage.None;
                CurrentTabPage = TabPage.DashBoard;
            }

            //if (bLoginSuccess == true)
            //{

            //frmSearchResult searchResult = new frmSearchResult();

            // 09/28/18 begin here


            //    if (searchResult.ShowDialog() == DialogResult.OK)
            //    {
            //txtMembershipID.Text = searchResult.IndividualSelected.strMembershipID;
            //txtIndividualID.Text = searchResult.IndividualSelected.strIndividualID;

            //txtFirstName.Text = searchResult.IndividualSelected.strFirstName;
            //txtMiddleName.Text = searchResult.IndividualSelected.strMiddleName;
            //txtLastName.Text = searchResult.IndividualSelected.strLastName;
            //txtDateOfBirth.Text = searchResult.IndividualSelected.dtBirthDate.Value.ToString("MM/dd/yyyy");
            //cbGender.Items.Add("Male");
            //cbGender.Items.Add("Female");
            //if (searchResult.IndividualSelected.IndividualGender == Gender.Male) cbGender.SelectedIndex = 0;
            //else if (searchResult.IndividualSelected.IndividualGender == Gender.Female) cbGender.SelectedIndex = 1;
            //txtIndividualSSN.Text = searchResult.IndividualSelected.strSSN;

            //txtStreetAddress1.Text = searchResult.IndividualSelected.strShippingStreetAddress;
            //txtZip1.Text = searchResult.IndividualSelected.strShippingZip;
            //txtCity1.Text = searchResult.IndividualSelected.strShippingCity;
            //txtState1.Text = searchResult.IndividualSelected.strShippingState;

            //txtStreetAddress2.Text = searchResult.IndividualSelected.strBillingStreetAddress;
            //txtZip2.Text = searchResult.IndividualSelected.strBillingZip;
            //txtCity2.Text = searchResult.IndividualSelected.strBillingCity;
            //txtState2.Text = searchResult.IndividualSelected.strBillingState;
            //txtEmail.Text = searchResult.IndividualSelected.strEmail;

            //txtProgram.Text = searchResult.IndividualSelected.IndividualPlan.ToString();

            //switch (searchResult.IndividualSelected.IndividualPlan)
            //{
            //    case Plan.GoldPlus:
            //        txtMemberProgram.Text = "Gold Plus";
            //        break;
            //    case Plan.Gold:
            //        txtMemberProgram.Text = "Gold";
            //        break;
            //    case Plan.Silver:
            //        txtMemberProgram.Text = "Silver";
            //        break;
            //    case Plan.Bronze:
            //        txtMemberProgram.Text = "Bronze";
            //        break;
            //    case Plan.GoldMedi_I:
            //        txtMemberProgram.Text = "Gold Medi-I";
            //        break;
            //    case Plan.GoldMedi_II:
            //        txtMemberProgram.Text = "Gold Medi-II";
            //        break;
            //}

            //txtIndChurchName.Text = searchResult.IndividualSelected.strChurch;

            //txtMembershipStartDate.Text = searchResult.IndividualSelected.dtMembershipIndStartDate.Value.ToString("MM/dd/yyyy");
            //if (searchResult.IndividualSelected.dtMembershipCancelledDate != null)
            //{
            //    txtMembershipCancelledDate.Text = searchResult.IndividualSelected.dtMembershipCancelledDate.Value.ToString("MM/dd/yyyy");
            //}
            //else txtMembershipCancelledDate.Text = String.Empty;
            //txtIndMemberShipStatus.Text = searchResult.IndividualSelected.membershipStatus.ToString();

            //IndividualIdIndividualPage = txtIndividualID.Text.Trim();

            //String strSqlQueryForCaseInfo = "select distinct([dbo].[tbl_medbill].[Case_Id]), [dbo].[tbl_medbill].[Contact_Id], [dbo].[tbl_medbill].[BillStatus] " +
            //                                "from [dbo].[tbl_medbill] " +
            //                                "where [dbo].[tbl_medbill].[Contact_Id] = @IndividualId and " +
            //                                "([dbo].[tbl_medbill].[BillStatus] = @BillStatusCode0 or " +
            //                                "[dbo].[tbl_medbill].[BillStatus] = @BillStatusCode1 or " +
            //                                "[dbo].[tbl_medbill].[BillStatus] = @BillStatusCode2 or " +
            //                                "[dbo].[tbl_medbill].[BillStatus] = @BillStatusCode3 or " +
            //                                "[dbo].[tbl_medbill].[BillStatus] = @BillStatusCode4)";

            //SqlCommand cmdQueryForCaseInfo = new SqlCommand(strSqlQueryForCaseInfo, connRN);
            //cmdQueryForCaseInfo.CommandType = CommandType.Text;

            //cmdQueryForCaseInfo.Parameters.AddWithValue("@IndividualId", IndividualIdIndividualPage);
            //cmdQueryForCaseInfo.Parameters.AddWithValue("@BillStatusCode0", 0);     // Pending
            //cmdQueryForCaseInfo.Parameters.AddWithValue("@BillStatusCode1", 1);     // Job Assigned to  
            //cmdQueryForCaseInfo.Parameters.AddWithValue("@BillStatusCode2", 2);     // In Progress
            //cmdQueryForCaseInfo.Parameters.AddWithValue("@BillStatusCode3", 3);     // Eligibility
            //cmdQueryForCaseInfo.Parameters.AddWithValue("@BillStatusCode4", 4);     // Under bill processing
            //                                                                        //cmdQueryForCaseInfo.Parameters.AddWithValue("@BillStatusCode5", 5);    

            //connRN.Open();
            //SqlDataReader rdrCaseInfo = cmdQueryForCaseInfo.ExecuteReader();

            //lstCaseInfo.Clear();
            //if (rdrCaseInfo.HasRows)
            //{
            //    while (rdrCaseInfo.Read())
            //    {
            //        lstCaseInfo.Add(new CaseInfo { CaseName = rdrCaseInfo.GetString(0), IndividualId = rdrCaseInfo.GetString(1) });
            //    }
            //}
            //connRN.Close();

            ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

            //if (lstCaseInfo.Count > 0)
            //{

            //    String strSqlQueryForCasesForIndividualID = "select [dbo].[tbl_case].[Case_Name], [dbo].[tbl_case].[CreateDate], [dbo].[tbl_case].[CreateStaff], " +
            //                                                "[dbo].[tbl_case].[NPF_Form], [dbo].[tbl_case].[NPF_Receiv_Date], [dbo].[tbl_case].[IB_Form], [dbo].[tbl_case].[IB_Receiv_Date], " +
            //                                                "[dbo].[tbl_case].[POP_Form], [dbo].[tbl_case].[POP_Receiv_Date], [dbo].[tbl_case].[MedRec_Form], [dbo].[tbl_case].[MedRec_Receiv_Date], " +
            //                                                "[dbo].[tbl_case].[Unknown_Form], [dbo].[tbl_case].[Unknown_Receiv_Date] " +
            //                                                "from [dbo].[tbl_case] where [dbo].[tbl_case].[Contact_ID] = @IndividualID";


            //    SqlCommand cmdQueryForCasesIndividualPage = new SqlCommand(strSqlQueryForCasesForIndividualID, connRN);
            //    cmdQueryForCasesIndividualPage.CommandType = CommandType.Text;
            //    cmdQueryForCasesIndividualPage.Parameters.AddWithValue("@IndividualID", lstCaseInfo[0].IndividualId);

            //    cmdQueryForCasesIndividualPage.Notification = null;

            //    SqlDependency dependencyCaseForIndividual = new SqlDependency(cmdQueryForCasesIndividualPage);
            //    dependencyCaseForIndividual.OnChange += new OnChangeEventHandler(OnCaseForIndividualChange);

            //    connRN.Open();
            //    SqlDataReader rdrCasesForIndividual = cmdQueryForCasesIndividualPage.ExecuteReader();

            //    if (rdrCasesForIndividual.HasRows)
            //    {
            //        gvProcessingCaseNo.Rows.Clear();
            //        while (rdrCasesForIndividual.Read())
            //        {
            //            for (int i = 0; i < lstCaseInfo.Count; i++)
            //            {
            //                if ((!rdrCasesForIndividual.IsDBNull(0)) &&
            //                    (rdrCasesForIndividual.GetString(0) == lstCaseInfo[i].CaseName))
            //                {

            //                    DataGridViewRow row = new DataGridViewRow();

            //                    row.Cells.Add(new DataGridViewCheckBoxCell { Value = false });

            //                    if (!rdrCasesForIndividual.IsDBNull(0)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrCasesForIndividual.GetString(0) });
            //                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });

            //                    if (!rdrCasesForIndividual.IsDBNull(1)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrCasesForIndividual.GetDateTime(1) });
            //                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });

            //                    if (!rdrCasesForIndividual.IsDBNull(2)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrCasesForIndividual.GetInt16(2) });
            //                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });

            //                    if (!rdrCasesForIndividual.IsDBNull(3)) row.Cells.Add(new DataGridViewCheckBoxCell { Value = rdrCasesForIndividual.GetBoolean(3) });
            //                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = false });

            //                    if (!rdrCasesForIndividual.IsDBNull(4)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrCasesForIndividual.GetDateTime(4) });
            //                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });

            //                    if (!rdrCasesForIndividual.IsDBNull(5)) row.Cells.Add(new DataGridViewCheckBoxCell { Value = rdrCasesForIndividual.GetBoolean(5) });
            //                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = false });

            //                    if (!rdrCasesForIndividual.IsDBNull(6)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrCasesForIndividual.GetDateTime(6) });
            //                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });

            //                    if (!rdrCasesForIndividual.IsDBNull(7)) row.Cells.Add(new DataGridViewCheckBoxCell { Value = rdrCasesForIndividual.GetBoolean(7) });
            //                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = false });

            //                    if (!rdrCasesForIndividual.IsDBNull(8)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrCasesForIndividual.GetDateTime(8) });
            //                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });

            //                    if (!rdrCasesForIndividual.IsDBNull(9)) row.Cells.Add(new DataGridViewCheckBoxCell { Value = rdrCasesForIndividual.GetBoolean(9) });
            //                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });

            //                    if (!rdrCasesForIndividual.IsDBNull(10)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrCasesForIndividual.GetDateTime(10) });
            //                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });

            //                    if (!rdrCasesForIndividual.IsDBNull(11)) row.Cells.Add(new DataGridViewCheckBoxCell { Value = rdrCasesForIndividual.GetBoolean(11) });
            //                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });

            //                    if (!rdrCasesForIndividual.IsDBNull(12)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrCasesForIndividual.GetDateTime(12) });
            //                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });

            //                    gvProcessingCaseNo.Rows.Add(row);
            //                }
            //            }
            //        }
            //    }
            //    connRN.Close();
            //}

            //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
            //// Case History Page

            //strIndividualId = searchResult.IndividualSelected.strIndividualID.Trim();

            //txtCaseHistoryIndividualID.Text = strIndividualId;

            //txtCaseHistoryIndividualName.Text = txtLastName.Text + ", " + txtFirstName.Text + " " + txtMiddleName.Text;

            //String strSqlQueryForCreateStaff = "select dbo.tbl_CreateStaff.CreateStaff_Id, dbo.tbl_CreateStaff.Staff_Name from dbo.tbl_CreateStaff";

            //SqlCommand cmdQueryForCreateStaff = new SqlCommand(strSqlQueryForCreateStaff, connRN);
            //cmdQueryForCreateStaff.CommandType = CommandType.Text;

            //connRN.Open();
            //SqlDataReader rdrCreateStaff = cmdQueryForCreateStaff.ExecuteReader();

            //lstCreateStaff.Clear();
            //if (rdrCreateStaff.HasRows)
            //{
            //    while (rdrCreateStaff.Read())
            //    {
            //        lstCreateStaff.Add(new StaffInfo { StaffId = rdrCreateStaff.GetInt16(0), StaffName = rdrCreateStaff.GetString(1) });
            //    }
            //}
            //connRN.Close();

            //String strSqlQueryForModifiStaff = "select dbo.tbl_ModifiStaff.ModifiStaff_Id, dbo.tbl_ModifiStaff.Staff_Name from dbo.tbl_ModifiStaff";

            //SqlCommand cmdQueryForModifiStaff = new SqlCommand(strSqlQueryForModifiStaff, connRN);
            //cmdQueryForModifiStaff.CommandType = CommandType.Text;

            //connRN.Open();
            //SqlDataReader rdrModifiStaff = cmdQueryForModifiStaff.ExecuteReader();

            //lstModifiStaff.Clear();
            //if (rdrModifiStaff.HasRows)
            //{
            //    while (rdrModifiStaff.Read())
            //    {
            //        lstModifiStaff.Add(new StaffInfo { StaffId = rdrModifiStaff.GetInt16(0), StaffName = rdrModifiStaff.GetString(1) });
            //    }
            //}
            //connRN.Close();

            ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
            //String strSqlQueryForCases = "select dbo.tbl_case.Case_Name, dbo.tbl_case.CreateDate, dbo.tbl_case.CreateStaff, " +
            //                                "dbo.tbl_case.ModifiDate, dbo.tbl_case.ModifiStaff " +
            //                                "from dbo.tbl_case where individual_id = @IndividualId";


            //SqlCommand cmdQueryForCases = new SqlCommand(strSqlQueryForCases, connRN);
            //cmdQueryForCases.CommandType = CommandType.Text;

            //cmdQueryForCases.Parameters.AddWithValue("@IndividualId", strIndividualId);

            //SqlDependency dependencyCase = new SqlDependency(cmdQueryForCases);
            //dependencyCase.OnChange += new OnChangeEventHandler(OnCaseChange);


            //connRN.Open();
            //SqlDataReader reader = cmdQueryForCases.ExecuteReader();

            //if (reader.HasRows)
            //{
            //    gvCaseViewCaseHistory.Rows.Clear();
            //    while (reader.Read())
            //    {
            //        DataGridViewRow row = new DataGridViewRow();

            //        row.Cells.Add(new DataGridViewCheckBoxCell { Value = false });
            //        row.Cells.Add(new DataGridViewTextBoxCell { Value = reader.GetString(0) });     // Case ID

            //        // Create Date
            //        if (!reader.IsDBNull(1)) row.Cells.Add(new DataGridViewTextBoxCell { Value = reader.GetDateTime(1).ToString("MM/dd/yyyy") });

            //        // Create Staff
            //        if (!reader.IsDBNull(2))
            //        {
            //            for (int i = 0; i < lstCreateStaff.Count; i++)
            //            {
            //                if (reader.GetInt16(2) == lstCreateStaff[i].StaffId)
            //                    row.Cells.Add(new DataGridViewTextBoxCell { Value = lstCreateStaff[i].StaffName });
            //            }
            //        }

            //        // Modifi Date
            //        if (!reader.IsDBNull(3)) row.Cells.Add(new DataGridViewTextBoxCell { Value = reader.GetDateTime(3).ToString("MM/dd/yyyy") });

            //        // Modifi Staff
            //        if (!reader.IsDBNull(4))
            //        {
            //            for (int i = 0; i < lstModifiStaff.Count; i++)
            //            {
            //                if (reader.GetInt16(4) == lstModifiStaff[i].StaffId)
            //                    row.Cells.Add(new DataGridViewTextBoxCell { Value = lstModifiStaff[i].StaffName });
            //            }
            //        }
            //        gvCaseViewCaseHistory.Rows.Add(row);
            //    }
            //}
            //connRN.Close();

            //        ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
            //        // Settlement DataGridView
            //        ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

            //        ///
            //        /// Tooltips
            //        /// 

            //        //// Browse buttons for Case Creation tab
            //        //ToolTip tipBrowseForNPF = new ToolTip();
            //        //tipBrowseForNPF.SetToolTip(btnBrowseNPF, "Browse for Needs Processing Form");

            //        //ToolTip tipBrowseForIB = new ToolTip();
            //        //tipBrowseForIB.SetToolTip(btnBrowseIB, "Browse for Itemized Bill");

            //        //ToolTip tipBrowseForPoP = new ToolTip();
            //        //tipBrowseForPoP.SetToolTip(btnBrowsePoP, "Browse for Proof of Payment");

            //        //ToolTip tipBrowseForMedRcord = new ToolTip();
            //        //tipBrowseForMedRcord.SetToolTip(btnBrowseMR, "Browse for Medical Record");

            //        //ToolTip tipBrowseForUnknownDoc = new ToolTip();
            //        //tipBrowseForUnknownDoc.SetToolTip(btnBrowseUnknownDoc, "Browse for Unknown Document");

            //        //// Upload buttons for Case Creation tab
            //        //ToolTip tipUploadNPF = new ToolTip();
            //        //tipUploadNPF.SetToolTip(btnNPFFormUpload, "Upload the Needs Processing Form to the server");

            //        //ToolTip tipUploadIB = new ToolTip();
            //        //tipUploadIB.SetToolTip(btnIBUpload, "Upload the Itemized Bill to the server");

            //        //ToolTip tipUploadPoP = new ToolTip();
            //        //tipUploadPoP.SetToolTip(btnPoPUpload, "Upload the Proof of Payment to the server");

            //        //ToolTip tipUploadMedRec = new ToolTip();
            //        //tipUploadMedRec.SetToolTip(btnMedicalRecordUpload, "Upload the Medical Record to the server");

            //        //ToolTip tipUploadUnknownDoc = new ToolTip();
            //        //tipUploadUnknownDoc.SetToolTip(btnUnknownDocUpload, "Upload the Unknown Document to the server");

            //        //// View buttons for Case Creation tab
            //        //ToolTip tipViewNPFCreateCase = new ToolTip();
            //        //tipViewNPFCreateCase.SetToolTip(btnNPFFormView, "View the NPF Form on the server");

            //        //ToolTip tipViewIBCreateCase = new ToolTip();
            //        //tipViewIBCreateCase.SetToolTip(btnIBView, "View the Itemized Bill on the server");

            //        //ToolTip tipViewPoPCreateCase = new ToolTip();
            //        //tipViewPoPCreateCase.SetToolTip(btnPoPView, "View the Proof of Payment on the server");

            //        //ToolTip tipViewMedRecCreateCase = new ToolTip();
            //        //tipViewMedRecCreateCase.SetToolTip(btnMedicalRecordView, "View the Medical Record Document on the server");

            //        //ToolTip tipViewUnknownDocCreateCase = new ToolTip();
            //        //tipViewUnknownDocCreateCase.SetToolTip(btnOtherDocView, "View the Unknown Document on the server");


            //        //// Delete buttons for Case Creation tab
            //        //ToolTip tipDeleteNPF = new ToolTip();
            //        //tipDeleteNPF.SetToolTip(btnNPFFormDelete, "Delete the uploaded Needs Processing Form on the server");

            //        //ToolTip tipDeleteIB = new ToolTip();
            //        //tipDeleteIB.SetToolTip(btnDeleteIB, "Delete the uploaded Itemized Bill on the server");

            //        //ToolTip tipDeletePoP = new ToolTip();
            //        //tipDeletePoP.SetToolTip(btnDeletePoP, "Delete the uploaded Proof of Payment on the server");

            //        //ToolTip tipDeleteMedRec = new ToolTip();
            //        //tipDeleteMedRec.SetToolTip(btnDeleteMedicalRecord, "Delete the uploaded Medical Record on the server");

            //        //ToolTip tipDeleteUnknownDoc = new ToolTip();
            //        //tipDeleteUnknownDoc.SetToolTip(btnDeleteUnknownDoc, "Delete the uploaded Unknown Document on the server");

            //        //// Tooltips for Medical Bill tab

            //        //// View buttons for Medical Bill tab
            //        //ToolTip tipViewNPF = new ToolTip();
            //        //tipViewNPF.SetToolTip(btnViewNPF, "View the Needs Processing Form on the server");

            //        //ToolTip tipViewIB = new ToolTip();
            //        //tipViewIB.SetToolTip(btnViewIB, "View the Itemized Bill on the server");

            //        //ToolTip tipViewPoP = new ToolTip();
            //        //tipViewPoP.SetToolTip(btnViewPoP, "View the Proof of Payment on the server");

            //        //ToolTip tipViewMedRec = new ToolTip();
            //        //tipViewMedRec.SetToolTip(btnViewMedRecord, "View the Medical Record on the server");

            //        //ToolTip tipViewUnknownDoc = new ToolTip();
            //        //tipViewUnknownDoc.SetToolTip(btnViewOtherDoc, "View the Unknown Documents on the server");

            //        //// ToolTips for Illness button and Incident button
            //        //ToolTip tipIllness = new ToolTip();
            //        //tipIllness.SetToolTip(btnMedBill_lllness, "Create illness or choose illness");

            //        //ToolTip tipIncident = new ToolTip();
            //        //tipIncident.SetToolTip(btnMedBill_Incident, "Create incident or choose incident");

            //        //// Tooltips on Settlement
            //        //ToolTip tipAddNewSettlement = new ToolTip();
            //        //tipAddNewSettlement.SetToolTip(btnAddNewSettlement, "Add New Settlement");

            //        //ToolTip tipEditSettlement = new ToolTip();
            //        //tipEditSettlement.SetToolTip(btnEditSettlement, "Edit the Seleted Settlement");

            //        //ToolTip tipDeleteSettlement = new ToolTip();
            //        //tipDeleteSettlement.SetToolTip(btnDeleteSettlement, "Delete the Selected Settlement");


            //        tbCMMManager.SelectedIndex = 0;

            //        PrevTabPage = TabPage.None;
            //        CurrentTabPage = TabPage.DashBoard;
            //        ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
            //    }
            //}
        }

        private void EnableIndividualView()
        {
            txtAnivDate.Enabled = true;
            txtAccountNo.Enabled = true;
            txtAccountHolder.Enabled = true;
            txtBankRoutingNo.Enabled = true;
            txtBankName.Enabled = true;
            txtTotalMedBillAmount.Enabled = true;
            rbEnglish.Enabled = true;
            rbKorean.Enabled = true;
            txtRelationship.Enabled = true;
            dtpBirthDate.Enabled = true;
            btnEditCaseUnderProcess.Enabled = true;
            btnIndViewCancelUpperRight.Enabled = true;
            btnIndViewCancelUpperRight.Enabled = true;
            btnAddHealthHistoryAfterReg.Enabled = true;
            btnAddHealthHistoryBeforeReg.Enabled = true;
            btnIndViewCancelLowerRight.Enabled = true;
            //btnIndViewUpdateLowerRight.Enabled = true;
            gvRecentCommunication.Enabled = true;
            chkCommunicationEtc.Enabled = true;
            chkCommunicationReq.Enabled = true;
            chkCommunicationFax.Enabled = true;
            chkCommunicationLetter.Enabled = true;
            chkCommunicationEmail.Enabled = true;
            chkCommunicationCall.Enabled = true;
            chkCommunicationAll.Enabled = true;
            gvFamilyInformation.Enabled = true;
            gvProcessingCaseNo.Enabled = true;
            txtWellBeingAmt.Enabled = true;
            txtProgramChangeReqDate.Enabled = true;
            txtOver10KAmount.Enabled = true;
            txtMembershipStartDate.Enabled = true;
            txtTotalSharedAmount.Enabled = true;
            txtIndMemberShipStatus.Enabled = true;
            txtDeceasedDate.Enabled = true;
            txtMembershipCancelledDate.Enabled = true;
            txtCancelationRequestDate.Enabled = true;
            txtProgramHistory.Enabled = true;
            txtProgram.Enabled = true;
            txtPowerOfAttorney.Enabled = true;
            cbGender.Enabled = true;
            cbReimbursementMethod.Enabled = true;
            txtIndChurchName.Enabled = true;
            txtBusinessPhone.Enabled = true;
            cbPreferredCommunication.Enabled = true;
            txtCellPhone1.Enabled = true;
            txtEmail.Enabled = true;
            txtState1.Enabled = true;
            txtState2.Enabled = true;
            txtCity1.Enabled = true;
            txtCity2.Enabled = true;
            txtZip1.Enabled = true;
            txtZip2.Enabled = true;
            txtStreetAddress1.Enabled = true;
            txtStreetAddress2.Enabled = true;
            txtIndividualSSN.Enabled = true;
            txtLastName.Enabled = true;
            txtFirstName.Enabled = true;
            txtMiddleName.Enabled = true;
            txtLastName.Enabled = true;
            txtCRM_ID.Enabled = true;
            txtIndividualID.Enabled = true;
            txtMembershipID.Enabled = true;
            btnBlueSheetList.Enabled = true;
        }

        private void DisableIndividualView()
        {
            txtAnivDate.Enabled = false;
            txtAccountNo.Enabled = false;
            txtAccountHolder.Enabled = false;
            txtBankRoutingNo.Enabled = false;
            txtBankName.Enabled = false;
            txtTotalMedBillAmount.Enabled = false;
            rbEnglish.Enabled = false;
            rbKorean.Enabled = false;
            txtRelationship.Enabled = false;
            dtpBirthDate.Enabled = false;
            btnEditCaseUnderProcess.Enabled = false;
            btnIndViewCancelUpperRight.Enabled = false;
            btnIndViewCancelUpperRight.Enabled = false;
            btnAddHealthHistoryAfterReg.Enabled = false;
            btnAddHealthHistoryBeforeReg.Enabled = false;
            btnIndViewCancelLowerRight.Enabled = false;
            //btnIndViewUpdateLowerRight.Enabled = false;
            gvRecentCommunication.Enabled = false;
            chkCommunicationEtc.Enabled = false;
            chkCommunicationReq.Enabled = false;
            chkCommunicationFax.Enabled = false;
            chkCommunicationLetter.Enabled = false;
            chkCommunicationEmail.Enabled = false;
            chkCommunicationCall.Enabled = false;
            chkCommunicationAll.Enabled = false;
            gvFamilyInformation.Enabled = false;
            gvProcessingCaseNo.Enabled = false;
            txtWellBeingAmt.Enabled = false;
            txtProgramChangeReqDate.Enabled = false;
            txtOver10KAmount.Enabled = false;
            txtMembershipStartDate.Enabled = false;
            txtTotalSharedAmount.Enabled = false;
            txtIndMemberShipStatus.Enabled = false;
            txtDeceasedDate.Enabled = false;
            txtMembershipCancelledDate.Enabled = false;
            txtCancelationRequestDate.Enabled = false;
            txtProgramHistory.Enabled = false;
            txtProgram.Enabled = false;
            txtPowerOfAttorney.Enabled = false;
            cbGender.Enabled = false;
            cbReimbursementMethod.Enabled = false;
            txtIndChurchName.Enabled = false;
            txtBusinessPhone.Enabled = false;
            cbPreferredCommunication.Enabled = false;
            txtCellPhone1.Enabled = false;
            txtEmail.Enabled = false;
            txtState1.Enabled = false;
            txtState2.Enabled = false;
            txtCity1.Enabled = false;
            txtCity2.Enabled = false;
            txtZip1.Enabled = false;
            txtZip2.Enabled = false;
            txtStreetAddress1.Enabled = false;
            txtStreetAddress2.Enabled = false;
            txtIndividualSSN.Enabled = false;
            txtLastName.Enabled = false;
            txtFirstName.Enabled = false;
            txtMiddleName.Enabled = false;
            txtLastName.Enabled = false;
            txtCRM_ID.Enabled = false;
            txtIndividualID.Enabled = false;
            txtMembershipID.Enabled = false;
            btnBlueSheetList.Enabled = false;
        }

        private void EnableCaseView()
        {
            btnCloseCaseView.Enabled = true;
            txtCaseHistoryIndividualID.Enabled = true;
            txtCaseHistoryIndividualName.Enabled = true;
            btnDeleteCase.Enabled = true;
            btnEditCase.Enabled = true;
            btnCreateNewCase.Enabled = true;
            gvCaseViewCaseHistory.Enabled = true;
        }

        private void DisableCaseView()
        {
            btnCloseCaseView.Enabled = false;
            txtCaseHistoryIndividualID.Enabled = false;
            txtCaseHistoryIndividualName.Enabled = false;
            btnDeleteCase.Enabled = false;
            btnEditCase.Enabled = false;
            btnCreateNewCase.Enabled = false;
            gvCaseViewCaseHistory.Enabled = false;
        }

        private void EnableIllnessView()
        {
            txtIllnessViewIndId.Enabled = true;
            txtIllnessViewMEMB.Enabled = true;
            gvIllnessList.Enabled = true;
        }

        private void DisableIllnessView()
        {
            txtIllnessViewIndId.Enabled = false;
            txtIllnessViewMEMB.Enabled = false;
            gvIllnessList.Enabled = false;
        }

        private void EnableIncidentView()
        {
            txtIncidentViewMEMB.Enabled = true;
            txtIncidentViewIndId.Enabled = true;
            gvIncidentList.Enabled = true;
        }

        private void DisableIncidentView()
        {
            txtIncidentViewMEMB.Enabled = false;
            txtIncidentViewIndId.Enabled = false;
            gvIncidentList.Enabled = false;
        }

        private void EnableMedBillView()
        {
            txtMedBillViewIndId.Enabled = true;
            txtMedBillViewMEMB.Enabled = true;
            gvMedBillList.Enabled = true;
        }

        private void DisableMedBillView()
        {
            txtMedBillViewIndId.Enabled = false;
            txtMedBillViewMEMB.Enabled = false;
            gvMedBillList.Enabled = false;
        }

        private void EnableCaseForm()
        {
            cbCaseStatus.Enabled = true;
            //btnDeleteMedBill.Enabled = true;
            //btnEditMedBill.Enabled = true;
            //btnNewMedBill_Case.Enabled = true;
            txtNoteOnCase.Enabled = true;
            txtCaseName.Enabled = true;
            //btnCaseCreationLowerSave.Enabled = true;
            //btnCaseCreationLowerCancel.Enabled = true;
            btnCaseCreationSaveUpper.Enabled = true;
            //btnCaseCreationCancelUpper.Enabled = true;
            //txtPoPUploadDate.Enabled = true;
            //txtMRUploadDate.Enabled = true;
            //txtOtherDocUploadDate.Enabled = true;
            //txtIBUploadDate.Enabled = true;
            //txtNPFUploadDate.Enabled = true;
            dtpNPFReceivedDate.Enabled = true;
            dtpIBReceivedDate.Enabled = true;
            dtpPoPReceivedDate.Enabled = true;
            dtpMRReceivedDate.Enabled = true;
            dtpOtherDocReceivedDate.Enabled = true;
            gvCasePageMedBills.Enabled = true;
            gvNewSupportLog.Enabled = true;
            btnCaseCreationNewSupportLog.Enabled = true;
            gvTaskInCase.Enabled = true;
            btnNewTaskCaseForm.Enabled = true;
            btnIncomplete.Enabled = true;
            btnApprovedSendToRN.Enabled = true;
            btnOtherDocView.Enabled = true;
            btnDeleteUnknownDoc.Enabled = true;
            btnUnknownDocUpload.Enabled = true;
            btnMedicalRecordView.Enabled = true;
            btnDeleteMedicalRecord.Enabled = true;
            btnMedicalRecordUpload.Enabled = true;
            btnPoPView.Enabled = true;
            btnDeletePoP.Enabled = true;
            btnPoPUpload.Enabled = true;
            btnIBView.Enabled = true;
            btnDeleteIB.Enabled = true;
            btnNPFFormView.Enabled = true;
            btnNPFFormDelete.Enabled = true;
            btnNPFFormUpload.Enabled = true;
            btnIBUpload.Enabled = true;
            txtOtherDocumentFilePath.Enabled = true;
            txtMedicalRecordFilePath.Enabled = true;
            txtPopFilePath.Enabled = true;
            txtIBFilePath.Enabled = true;
            txtNPFFormFilePath.Enabled = true;
            chkOtherDocCaseCreationPage.Enabled = true;
            chkMedicalRecordCaseCreationPage.Enabled = true;
            chkPoP_CaseCreationPage.Enabled = true;
            chkIB_CaseCreationPage.Enabled = true;
            chkNPF_CaseCreationPage.Enabled = true;
            txtCreateCaseIndividualName.Enabled = true;
            txtCaseIndividualID.Enabled = true;
        }

        private void DisableCaseForm()
        {
            cbCaseStatus.Enabled = false;
            btnDeleteMedBill.Enabled = false;
            btnEditMedBill.Enabled = false;
            btnNewMedBill_Case.Enabled = false;
            txtNoteOnCase.Enabled = false;
            txtCaseName.Enabled = false;
            //btnCaseCreationLowerSave.Enabled = false;
            //btnCaseCreationLowerCancel.Enabled = false;
            btnCaseCreationSaveUpper.Enabled = false;
            //btnCaseCreationCancelUpper.Enabled = false;
            //txtPoPUploadDate.Enabled = false;
            //txtMRUploadDate.Enabled = false;
            //txtOtherDocUploadDate.Enabled = false;
            //txtIBUploadDate.Enabled = false;
            //txtNPFUploadDate.Enabled = false;
            dtpNPFReceivedDate.Enabled = false;
            dtpIBReceivedDate.Enabled = false;
            dtpPoPReceivedDate.Enabled = false;
            dtpMRReceivedDate.Enabled = false;
            dtpOtherDocReceivedDate.Enabled = false;
            gvCasePageMedBills.Enabled = false;
            gvNewSupportLog.Enabled = false;
            btnCaseCreationNewSupportLog.Enabled = false;
            gvTaskInCase.Enabled = false;
            btnNewTaskCaseForm.Enabled = false;
            btnIncomplete.Enabled = false;
            btnApprovedSendToRN.Enabled = false;
            btnOtherDocView.Enabled = false;
            btnDeleteUnknownDoc.Enabled = false;
            btnUnknownDocUpload.Enabled = false;
            btnMedicalRecordView.Enabled = false;
            btnDeleteMedicalRecord.Enabled = false;
            btnMedicalRecordUpload.Enabled = false;
            btnPoPView.Enabled = false;
            btnDeletePoP.Enabled = false;
            btnPoPUpload.Enabled = false;
            btnIBUpload.Enabled = false;
            btnIBView.Enabled = false;
            btnDeleteIB.Enabled = false;
            btnNPFFormView.Enabled = false;
            btnNPFFormDelete.Enabled = false;
            btnNPFFormUpload.Enabled = false;
            txtOtherDocumentFilePath.Enabled = false;
            txtMedicalRecordFilePath.Enabled = false;
            txtPopFilePath.Enabled = false;
            txtIBFilePath.Enabled = false;
            txtNPFFormFilePath.Enabled = false;
            chkOtherDocCaseCreationPage.Enabled = false;
            chkMedicalRecordCaseCreationPage.Enabled = false;
            chkPoP_CaseCreationPage.Enabled = false;
            chkIB_CaseCreationPage.Enabled = false;
            chkNPF_CaseCreationPage.Enabled = false;
            txtCreateCaseIndividualName.Enabled = false;
            txtCaseIndividualID.Enabled = false;
            //btnCaseCreationLowerSave.Enabled = false;

        }

        private void EnableMedicalBillForm()
        {
            txtTotalSharedAmtMedBill.Enabled = true;
            txtPersonalResponsibility.Enabled = true;
            grpEtc.Enabled = true;
            gvSettlementsInMedBill.Enabled = true;
            grpMedBillInfo.Enabled = true;
            grpMedicalProviderResponse.Enabled = true;
            //btnMedBillCreationPgLowerCancel.Enabled = true;
            //btnMedBillCreationPgLowerSave.Enabled = true;
            gvUserModifiedDateHistory.Enabled = true;
            btnDeleteSettlement.Enabled = true;
            btnAddNewSettlement.Enabled = true;
            //btnMedBillCreationPgUpperCancel.Enabled = true;
            btnMedBillCreatePgUpperSave.Enabled = true;
            grpTasks.Enabled = true;
            grpMedicalBillInformation.Enabled = true;
            grpDocumentProcessing.Enabled = true;
            chkMedBillNPFReceived.Enabled = false;
            chkMedBillPOPReceived.Enabled = false;
            chkMedBill_IBReceived.Enabled = false;
            chkOtherDocReceived.Enabled = false;
            chkMedRecordReceived.Enabled = false;
            dtpMedBillNPF.Enabled = false;
            dtpMedBill_IB.Enabled = false;
            dtpMedBillPOP.Enabled = false;
            dtpMedBillOtherDoc.Enabled = false;
            dtpMedBillMedRecord.Enabled = false;
            btnViewNPF.Enabled = true;
            btnViewIB.Enabled = true;
            btnViewPoP.Enabled = true;
            btnViewOtherDoc.Enabled = true;
            btnViewMedRecord.Enabled = true;
            grpICD10Code.Enabled = true;
            grpPatientInfo.Enabled = true;
            grpMedBillDocuments.Enabled = true;
            //btnMedBillCreatePgUpperSave.Enabled = true;

            grpMedBillDocuments.Enabled = true;

            txtOtherDocMedBillFileName.Enabled = true;
            txtMedRecMedBillFileName.Enabled = true;
            txtPoPMedBillFileName.Enabled = true;
            txtIBMedBillFileName.Enabled = true;
            txtNPFMedBillFileName.Enabled = true;

            btnIBUploadMedBill.Enabled = true;
            btnOtherDocUploadMedBill.Enabled = true;
            btnMedRecUploadMedBill.Enabled = true;
            btnPoPUploadMedBill.Enabled = true;
            btnNPFUploadMedBill.Enabled = true;

            chkOtherDocMedBill.Enabled = true;
            chkMedRecMedBill.Enabled = true;
            chkPoPMedBill.Enabled = true;
            chkIBMedBill.Enabled = true;
            chkNPFMedBill.Enabled = true;

            btnOtherDocMedBillView.Enabled = true;
            btnMedRecMedBillView.Enabled = true;
            btnPoPMedBillView.Enabled = true;
            btnIBMedBillView.Enabled = true;
            btnNPFMedBillView.Enabled = true;
        }

        private void DisableMedicalBillForm()
        {
            txtTotalSharedAmtMedBill.Enabled = false;
            txtPersonalResponsibility.Enabled = false;
            grpEtc.Enabled = false;
            gvSettlementsInMedBill.Enabled = false;
            grpMedBillInfo.Enabled = false;
            grpMedicalProviderResponse.Enabled = false;
            //btnMedBillCreationPgLowerCancel.Enabled = false;
            //btnMedBillCreationPgLowerSave.Enabled = false;
            gvUserModifiedDateHistory.Enabled = false;
            btnDeleteSettlement.Enabled = false;
            btnAddNewSettlement.Enabled = false;
            //btnMedBillCreationPgUpperCancel.Enabled = false;
            btnMedBillCreatePgUpperSave.Enabled = false;
            grpTasks.Enabled = false;
            grpMedicalBillInformation.Enabled = false;
            grpDocumentProcessing.Enabled = false;
            grpICD10Code.Enabled = false;
            grpPatientInfo.Enabled = false;
            grpMedBillDocuments.Enabled = false;

        }

        private void UpdateGridViewMedBillOnCase(String IndividualId)
        {

            String strSqlQueryForCaseInfo = "select distinct([dbo].[tbl_medbill].[Case_Id]), [dbo].[tbl_medbill].[Contact_Id], [dbo].[tbl_medbill].[BillStatus] " +
                                "from [dbo].[tbl_medbill] " +
                                "where [dbo].[tbl_medbill].[BillStatus] = @BillStatusCode0 or " +
                                "[dbo].[tbl_medbill].[BillStatus] = @BillStatusCode1 or " +
                                "[dbo].[tbl_medbill].[BillStatus] = @BillStatusCode2 or " +
                                "[dbo].[tbl_medbill].[BillStatus] = @BillStatusCode3 or " +
                                "[dbo].[tbl_medbill].[BillStatus] = @BillStatusCode4";

            SqlCommand cmdQueryForCaseInfo = new SqlCommand(strSqlQueryForCaseInfo, connRN);
            cmdQueryForCaseInfo.CommandType = CommandType.Text;

            cmdQueryForCaseInfo.Parameters.AddWithValue("@BillStatusCode0", MedBillStatus.Pending);     // Pending
            cmdQueryForCaseInfo.Parameters.AddWithValue("@BillStatusCode1", MedBillStatus.CMMPendingPayment);     // Job Assigned to  
            cmdQueryForCaseInfo.Parameters.AddWithValue("@BillStatusCode2", MedBillStatus.Closed);     // In Progress
            cmdQueryForCaseInfo.Parameters.AddWithValue("@BillStatusCode3", MedBillStatus.Ineligible);     // Eligibility
            cmdQueryForCaseInfo.Parameters.AddWithValue("@BillStatusCode4", MedBillStatus.PartiallyIneligible);     // Under bill processing

            SqlDependency dependency = new SqlDependency(cmdQueryForCaseInfo);
            dependency.OnChange += new OnChangeEventHandler(OnMedBillOnCaseChange);

            if (connRN.State != ConnectionState.Closed)
            {
                connRN.Close();
                connRN.Open();
            }
            else if (connRN.State == ConnectionState.Closed) connRN.Open();
            SqlDataReader rdrCaseInfo = cmdQueryForCaseInfo.ExecuteReader();
            lstCaseInfo.Clear();

            if (rdrCaseInfo.HasRows)
            {
                while (rdrCaseInfo.Read())
                {
                    lstCaseInfo.Add(new CaseInfo { CaseName = rdrCaseInfo.GetString(0), IndividualId = rdrCaseInfo.GetString(1) });
                }
            }
            rdrCaseInfo.Close();
            if (connRN.State != ConnectionState.Closed) connRN.Close();


            ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
            String strSqlQueryForCasesForIndividualID = "select distinct([dbo].[tbl_case].[Case_Name]), [dbo].[tbl_case].[CreateDate], [dbo].[tbl_case].[CreateStaff], " +
                                                        "[dbo].[tbl_case].[NPF_Form], [dbo].[tbl_case].[NPF_Receiv_Date], [dbo].[tbl_case].[IB_Form], [dbo].[tbl_case].[IB_Receiv_Date], " +
                                                        "[dbo].[tbl_case].[POP_Form], [dbo].[tbl_case].[POP_Receiv_Date], [dbo].[tbl_case].[MedRec_Form], [dbo].[tbl_case].[MedRec_Receiv_Date], " +
                                                        "[dbo].[tbl_case].[Unknown_Form], [dbo].[tbl_case].[Unknown_Receiv_Date] " +
                                                        "from [dbo].[tbl_case] where [dbo].[tbl_case].[Contact_ID] = @IndividualID";

            SqlCommand cmdQueryForCasesIndividualPage = new SqlCommand(strSqlQueryForCasesForIndividualID, connRN);
            cmdQueryForCasesIndividualPage.CommandType = CommandType.Text;

            cmdQueryForCasesIndividualPage.Parameters.AddWithValue("@IndividualID", lstCaseInfo[0].IndividualId);

            if (connRN.State != ConnectionState.Closed)
            {
                connRN.Close();
                connRN.Open();
            }
            else if (connRN.State == ConnectionState.Closed) connRN.Open();
            SqlDataReader rdrCasesForIndividual = cmdQueryForCasesIndividualPage.ExecuteReader();
            gvProcessingCaseNo.Rows.Clear();

            if (rdrCasesForIndividual.HasRows)
            {
                while (rdrCasesForIndividual.Read())
                {
                    DataGridViewRow row = new DataGridViewRow();

                    for (int i = 0; i < lstCaseInfo.Count; i++)
                    {
                        if ((!rdrCasesForIndividual.IsDBNull(0)) &&
                            (rdrCasesForIndividual.GetString(0) == lstCaseInfo[i].CaseName))
                        {

                            row.Cells.Add(new DataGridViewCheckBoxCell { Value = false });

                            if (!rdrCasesForIndividual.IsDBNull(0)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrCasesForIndividual.GetString(0) });
                            else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });

                            if (!rdrCasesForIndividual.IsDBNull(1)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrCasesForIndividual.GetDateTime(1) });
                            else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });

                            if (!rdrCasesForIndividual.IsDBNull(2)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrCasesForIndividual.GetInt16(2) });
                            else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });

                            if (!rdrCasesForIndividual.IsDBNull(3)) row.Cells.Add(new DataGridViewCheckBoxCell { Value = rdrCasesForIndividual.GetBoolean(3) });
                            else row.Cells.Add(new DataGridViewTextBoxCell { Value = false });

                            if (!rdrCasesForIndividual.IsDBNull(4)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrCasesForIndividual.GetDateTime(4) });
                            else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });

                            if (!rdrCasesForIndividual.IsDBNull(5)) row.Cells.Add(new DataGridViewCheckBoxCell { Value = rdrCasesForIndividual.GetBoolean(5) });
                            else row.Cells.Add(new DataGridViewTextBoxCell { Value = false });

                            if (!rdrCasesForIndividual.IsDBNull(6)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrCasesForIndividual.GetDateTime(6) });
                            else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });

                            if (!rdrCasesForIndividual.IsDBNull(7)) row.Cells.Add(new DataGridViewCheckBoxCell { Value = rdrCasesForIndividual.GetBoolean(7) });
                            else row.Cells.Add(new DataGridViewTextBoxCell { Value = false });

                            if (!rdrCasesForIndividual.IsDBNull(8)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrCasesForIndividual.GetDateTime(8) });
                            else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });

                            if (!rdrCasesForIndividual.IsDBNull(9)) row.Cells.Add(new DataGridViewCheckBoxCell { Value = rdrCasesForIndividual.GetBoolean(9) });
                            else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });

                            if (!rdrCasesForIndividual.IsDBNull(10)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrCasesForIndividual.GetDateTime(10) });
                            else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });

                            gvProcessingCaseNo.Rows.Add(row);


                        }
                    }
                }
            }
            rdrCasesForIndividual.Close();
            if (connRN.State != ConnectionState.Closed) connRN.Close();

        }



        private void UpdateGridViewCaseHistory(String IndividualId)
        {

            String strSqlQueryForCases = "select [dbo].[tbl_case].[Case_Name], [dbo].[tbl_case].[CreateDate], [dbo].[tbl_case].[CreateStaff], " +
                                         "[dbo].[tbl_case].[ModifiDate], [dbo].[tbl_case].[ModifiStaff] from [dbo].[tbl_case] " +
                                         "where [dbo].[tbl_case].[individual_id] = @IndividualId and " +
                                         "[dbo].[tbl_case].[IsDeleted] = 0 " +
                                         "order by [dbo].[tbl_case].[ID]";


            SqlCommand cmdQueryForCases = new SqlCommand(strSqlQueryForCases, connRN);
            cmdQueryForCases.CommandType = CommandType.Text;

            cmdQueryForCases.Parameters.AddWithValue("@IndividualId", strIndividualId);

            SqlDependency dependencyCase = new SqlDependency(cmdQueryForCases);
            dependencyCase.OnChange += new OnChangeEventHandler(OnCaseChange);

            if (connRN.State != ConnectionState.Closed)
            {
                connRN.Close();
                connRN.Open();
            }
            else if (connRN.State == ConnectionState.Closed) connRN.Open();

            //if (IsHandleCreated) ClearCaseInProcessSafely();
            //else gvProcessingCaseNo.Rows.Clear();
            if (IsHandleCreated) ClearCaseInCaseViewSafely();
            else gvCaseViewCaseHistory.Rows.Clear();

            SqlDataReader reader = cmdQueryForCases.ExecuteReader();
            if (reader.HasRows)
            {
                while (reader.Read())
                {
                    DataGridViewRow row = new DataGridViewRow();

                    row.Cells.Add(new DataGridViewCheckBoxCell { Value = false });
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = reader.GetString(0) });     // Case ID

                    // Create Date
                    if (!reader.IsDBNull(1)) row.Cells.Add(new DataGridViewTextBoxCell { Value = reader.GetDateTime(1).ToString("MM/dd/yyyy") });

                    // Create Staff
                    if (!reader.IsDBNull(2))
                    {
                        for (int i = 0; i < lstCreateStaff.Count; i++)
                        {
                            if (reader.GetInt16(2) == lstCreateStaff[i].StaffId)
                                row.Cells.Add(new DataGridViewTextBoxCell { Value = lstCreateStaff[i].StaffName });
                        }
                    }

                    // Modifi Date
                    if (!reader.IsDBNull(3)) row.Cells.Add(new DataGridViewTextBoxCell { Value = reader.GetDateTime(3).ToString("MM/dd/yyyy") });

                    // Modifi Staff
                    if (!reader.IsDBNull(4))
                    {
                        for (int i = 0; i < lstModifiStaff.Count; i++)
                        {
                            if (reader.GetInt16(4) == lstModifiStaff[i].StaffId)
                                row.Cells.Add(new DataGridViewTextBoxCell { Value = lstModifiStaff[i].StaffName });
                        }
                    }

                    if (IsHandleCreated) AddRowToCaseInCaseViewSafely(row);
                    else gvCaseViewCaseHistory.Rows.Add(row);
                }
            }
            reader.Close();
            if (connRN.State != ConnectionState.Closed) connRN.Close();
        }

        private void UpdateGridViewCaseForIndividual()
        {

            String strSqlQueryForCaseInfo = "select distinct([dbo].[tbl_medbill].[Case_Id]), [dbo].[tbl_medbill].[Contact_Id], [dbo].[tbl_medbill].[BillStatus] " +
                                            "from [dbo].[tbl_medbill] " +
                                            "where [dbo].[tbl_medbill].[IsDeleted] = 0 and " +
                                            "([dbo].[tbl_medbill].[BillStatus] = @BillStatusCode0 or " +
                                            "[dbo].[tbl_medbill].[BillStatus] = @BillStatusCode1 or " +
                                            "[dbo].[tbl_medbill].[BillStatus] = @BillStatusCode2 or " +
                                            "[dbo].[tbl_medbill].[BillStatus] = @BillStatusCode3 or " +
                                            "[dbo].[tbl_medbill].[BillStatus] = @BillStatusCode4)";

            SqlCommand cmdQueryForCaseInfo = new SqlCommand(strSqlQueryForCaseInfo, connRN);
            cmdQueryForCaseInfo.CommandType = CommandType.Text;

            cmdQueryForCaseInfo.Parameters.AddWithValue("@BillStatusCode0", MedBillStatus.Pending);     // Pending
            cmdQueryForCaseInfo.Parameters.AddWithValue("@BillStatusCode1", MedBillStatus.CMMPendingPayment);     // Job Assigned to  
            cmdQueryForCaseInfo.Parameters.AddWithValue("@BillStatusCode2", MedBillStatus.Closed);     // In Progress
            cmdQueryForCaseInfo.Parameters.AddWithValue("@BillStatusCode3", MedBillStatus.Ineligible);     // Eligibility
            cmdQueryForCaseInfo.Parameters.AddWithValue("@BillStatusCode4", MedBillStatus.PartiallyIneligible);     // Under bill processing

            //if (connRN.State == ConnectionState.Closed) connRN.Open();
            if (connRN.State != ConnectionState.Closed)
            {
                connRN.Close();
                connRN.Open();
            }
            else if (connRN.State == ConnectionState.Closed) connRN.Open();
            SqlDataReader rdrCaseInfo = cmdQueryForCaseInfo.ExecuteReader();
            lstCaseInfo.Clear();
            if (rdrCaseInfo.HasRows)
            {
                while (rdrCaseInfo.Read())
                {
                    lstCaseInfo.Add(new CaseInfo { CaseName = rdrCaseInfo.GetString(0), IndividualId = rdrCaseInfo.GetString(1) });
                }
            }
            rdrCaseInfo.Close();
            if (connRN.State != ConnectionState.Closed) connRN.Close();

            String strSqlQueryForCasesForIndividualID = "select [dbo].[tbl_case].[Case_Name], [dbo].[tbl_case_status_code].[CaseStatusValue], [dbo].[tbl_case].[CreateDate], " +
                                            "[dbo].[tbl_CreateStaff].[Staff_Name], " +
                                            "[dbo].[tbl_case].[NPF_Form], [dbo].[tbl_case].[NPF_Receiv_Date], [dbo].[tbl_case].[IB_Form], [dbo].[tbl_case].[IB_Receiv_Date], " +
                                            "[dbo].[tbl_case].[POP_Form], [dbo].[tbl_case].[POP_Receiv_Date], [dbo].[tbl_case].[MedRec_Form], [dbo].[tbl_case].[MedRec_Receiv_Date], " +
                                            "[dbo].[tbl_case].[Unknown_Form], [dbo].[tbl_case].[Unknown_Receiv_Date] " +
                                            "from [dbo].[tbl_case] " +
                                            "inner join [dbo].[tbl_case_status_code] on [dbo].[tbl_case].[Case_status] = [dbo].[tbl_case_status_code].[CaseStatusCode] " +
                                            "inner join [dbo].[tbl_CreateStaff] on [dbo].[tbl_case].[CreateStaff] = [dbo].[tbl_CreateStaff].[CreateStaff_Id] " +
                                            "where [dbo].[tbl_case].[Contact_ID] = @IndividualID and " +
                                            "[dbo].[tbl_case].[IsDeleted] = 0 and " +
                                            "([dbo].[tbl_case].[Case_Status] = 0 or [dbo].[tbl_case].[Case_Status] = 1) " +
                                            "order by [dbo].[tbl_case].[ID]";


            SqlCommand cmdQueryForCasesIndividualPage = new SqlCommand(strSqlQueryForCasesForIndividualID, connRN);
            cmdQueryForCasesIndividualPage.CommandType = CommandType.Text;
            cmdQueryForCasesIndividualPage.Parameters.AddWithValue("@IndividualID", IndividualIdIndividualPage);

            cmdQueryForCasesIndividualPage.Notification = null;

            SqlDependency dependencyCaseForIndividual = new SqlDependency(cmdQueryForCasesIndividualPage);
            dependencyCaseForIndividual.OnChange += new OnChangeEventHandler(OnCaseForIndividualChange);

            if (connRN.State != ConnectionState.Closed)
            {
                connRN.Close();
                connRN.Open();
            }
            else if (connRN.State == ConnectionState.Closed) connRN.Open();
            SqlDataReader rdrCasesForIndividual = cmdQueryForCasesIndividualPage.ExecuteReader();

            if (IsHandleCreated) ClearCaseInProcessSafely();
            else gvProcessingCaseNo.Rows.Clear();

            if (rdrCasesForIndividual.HasRows)
            {
                while (rdrCasesForIndividual.Read())
                {
                    DataGridViewRow row = new DataGridViewRow();

                    row.Cells.Add(new DataGridViewCheckBoxCell { Value = false });

                    if (!rdrCasesForIndividual.IsDBNull(0)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrCasesForIndividual.GetString(0) });
                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });

                    if (!rdrCasesForIndividual.IsDBNull(1)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrCasesForIndividual.GetString(1) });
                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });

                    if (!rdrCasesForIndividual.IsDBNull(2)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrCasesForIndividual.GetDateTime(2).ToString("MM/dd/yyyy") });
                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });

                    if (!rdrCasesForIndividual.IsDBNull(3)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrCasesForIndividual.GetString(3) });
                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });

                    if (!rdrCasesForIndividual.IsDBNull(4)) row.Cells.Add(new DataGridViewCheckBoxCell { Value = rdrCasesForIndividual.GetBoolean(4) });
                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = false });

                    if (!rdrCasesForIndividual.IsDBNull(5)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrCasesForIndividual.GetDateTime(5).ToString("MM/dd/yyyy") });
                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });

                    if (!rdrCasesForIndividual.IsDBNull(6)) row.Cells.Add(new DataGridViewCheckBoxCell { Value = rdrCasesForIndividual.GetBoolean(6) });
                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = false });

                    if (!rdrCasesForIndividual.IsDBNull(7)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrCasesForIndividual.GetDateTime(7).ToString("MM/dd/yyyy") });
                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });

                    if (!rdrCasesForIndividual.IsDBNull(8)) row.Cells.Add(new DataGridViewCheckBoxCell { Value = rdrCasesForIndividual.GetBoolean(8) });
                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = false });

                    if (!rdrCasesForIndividual.IsDBNull(9)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrCasesForIndividual.GetDateTime(9).ToString("MM/dd/yyyy") });
                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });

                    if (!rdrCasesForIndividual.IsDBNull(10)) row.Cells.Add(new DataGridViewCheckBoxCell { Value = rdrCasesForIndividual.GetBoolean(10) });
                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });

                    if (!rdrCasesForIndividual.IsDBNull(11)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrCasesForIndividual.GetDateTime(11).ToString("MM/dd/yyyy") });
                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });

                    if (!rdrCasesForIndividual.IsDBNull(12)) row.Cells.Add(new DataGridViewCheckBoxCell { Value = rdrCasesForIndividual.GetBoolean(12) });
                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });

                    if (!rdrCasesForIndividual.IsDBNull(13)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrCasesForIndividual.GetDateTime(13).ToString("MM/dd/yyyy") });
                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });

                    if (IsHandleCreated) AddRowToCaseInProcessSafely(row);
                    else gvProcessingCaseNo.Rows.Add(row);
                }
            }
            rdrCasesForIndividual.Close();
            if (connRN.State != ConnectionState.Closed) connRN.Close();
        }

        private void OnMedBillOnCaseChange(object sender, SqlNotificationEventArgs e)
        {
            if (e.Type == SqlNotificationType.Change)
            {
                SqlDependency dependency = sender as SqlDependency;
                dependency.OnChange -= OnMedBillOnCaseChange;

                UpdateGridViewMedBillOnCase(strIndividualId);
            }
        }



        private void ClearCaseInProcessSafely()
        {
            //for (int i = 0; i < gvProcessingCaseNo.Rows.Count; i++)
            //{
            //    gvProcessingCaseNo.BeginInvoke(new RemoveCaseInProcess(RemoveRowCaseInProcess), 0);
            //}
            gvProcessingCaseNo.BeginInvoke(new RemoveAllCaseInProcess(RemoveAllCasesInProcess));
        }

        private void AddRowToCaseInProcessSafely(DataGridViewRow row)
        {
            gvProcessingCaseNo.BeginInvoke(new AddRowToCaseInProcess(AddRowCaseInProcess), row);
        }

        private void AddRowCaseInProcess(DataGridViewRow row)
        {
            gvProcessingCaseNo.Rows.Add(row);
        }

        private void RemoveAllCasesInProcess()
        {
            gvProcessingCaseNo.Rows.Clear();
        }

        private void RemoveRowCaseInProcess(int i)
        {
            gvProcessingCaseNo.Rows.RemoveAt(i);
        }

        private void OnCaseForIndividualChange(object sender, SqlNotificationEventArgs e)
        {

            if (e.Type == SqlNotificationType.Change)
            {
                SqlDependency dependency = sender as SqlDependency;
                dependency.OnChange -= OnCaseForIndividualChange;

                UpdateGridViewCaseForIndividual();
            }
        }

        private void ClearCaseInCaseViewSafely()
        {
            gvCaseViewCaseHistory.BeginInvoke(new RemoveAllCaseInCaseView(RemoveAllRowCaseInCaseView));
        }

        private void AddRowToCaseInCaseViewSafely(DataGridViewRow row)
        {
            gvCaseViewCaseHistory.BeginInvoke(new AddRowToCaseInCaseView(AddRowCaseInCaseView), row);
        }

        private void AddRowCaseInCaseView(DataGridViewRow row)
        {
            gvCaseViewCaseHistory.Rows.Add(row);
        }

        private void RemoveRowCaseInCaseView(int i)
        {
            gvCaseViewCaseHistory.Rows.RemoveAt(i);
        }

        private void RemoveAllRowCaseInCaseView()
        {
            gvCaseViewCaseHistory.Rows.Clear();
        }

        private void AddRowToTaskInMedBillSafely(DataGridViewRow row)
        {
            gvMostRecentTasks.BeginInvoke(new AddRowToTaskInMedBill(AddRowTaskInMedBill), row);
        }

        private void RemoveRowTaskInMedBillSafely(int i)
        {
            gvMostRecentTasks.BeginInvoke(new RemoveTaskInMedBill(RemoveRowTaskInMedBill), i);
        }

        private void ClearTaskInMedBillSafely()
        {
            gvMostRecentTasks.BeginInvoke(new RemoveAllTaskInMedBill(RemoveAllRowTaskInMedBill));
        }


        private void AddRowTaskInMedBill(DataGridViewRow row)
        {
            gvMostRecentTasks.Rows.Add(row);
        }

        private void RemoveRowTaskInMedBill(int i)
        {
            gvMostRecentTasks.Rows.RemoveAt(i);
        }

        private void RemoveAllRowTaskInMedBill()
        {
            gvMostRecentTasks.Rows.Clear();
        }

        private void OnCaseChange(object sender, SqlNotificationEventArgs e)
        {
            if (e.Type == SqlNotificationType.Change)
            {
                SqlDependency dependency = sender as SqlDependency;
                dependency.OnChange -= OnCaseChange;

                UpdateGridViewCaseHistory(strIndividualId);
            }
        }

        private void OnIllnessChange(object sender, SqlNotificationEventArgs e)
        {
            if (e.Type == SqlNotificationType.Change)
            {
                SqlDependency dependency = sender as SqlDependency;
                dependency.OnChange -= OnIllnessChange;

                UpdateGridViewIllnessList();
            }
        }

        private void OnIncidentChange(object sender, SqlNotificationEventArgs e)
        {
            if (e.Type == SqlNotificationType.Change)
            {
                SqlDependency dependency = sender as SqlDependency;
                dependency.OnChange -= OnIncidentChange;

                UpdateGridViewIncidentList();
            }
        }

        private void AddRowToIllnessListSafely(DataGridViewRow row)
        {
            gvIllnessList.BeginInvoke(new AddRowToIllnessList(AddRowIllnessToList), row);
        }

        private void RemoveRowFromIllnessListSafely(int i)
        {
            gvIllnessList.BeginInvoke(new RemoveRowInIllnessList(RemoveRowIllnessList), i);
        }

        private void RemoveAllRowIllnessListSafely()
        {
            gvIllnessList.BeginInvoke(new RemoveAllRowsInIllnessList(RemoveAllIllnessInList));
        }

        private void AddRowIllnessToList(DataGridViewRow row)
        {
            gvIllnessList.Rows.Add(row);
        }

        private void RemoveAllIllnessInList()
        {
            gvIllnessList.Rows.Clear();
        }

        private void RemoveRowIllnessList(int nRow)
        {
            gvIllnessList.Rows.RemoveAt(nRow);
        }

        private void UpdateGridViewIllnessList()
        {
            String IndividualId = IndividualSearched.strIndividualID;

            //String strSqlQueryForIllnessForIndividualId = "select [dbo].[tbl_illness].[IllnessNo] as [Illness No], [dbo].[tbl_illness].[Case_Id] as [Case No], " +
            //                      "[dbo].[tbl_illness].[ICD_10_Id] as [ICD 10 Code], " +
            //                      "[dbo].[tbl_illness].[CreateDate] as [Create Date], [dbo].[tbl_CreateStaff].[Staff_Name] as [Created By]," +
            //                      "[dbo].[tbl_illness].[ModifiDate] as [Last Modification Date], [dbo].[tbl_ModifiStaff].[Staff_Name] as [Last Modified By], " +
            //                      "[dbo].[tbl_illness].[Date_of_Diagnosis] as [Diagnosis Date], " +
            //                      "[dbo].[tbl_illness].[TotalSharedAmount] as [Total Shared Amount], " +
            //                      "[dbo].[tbl_illness].[LimitedSharingId] as [Limited Sharing Amount], " +
            //                      "[dbo].[tbl_illness].[Introduction], [dbo].[tbl_illness].[Body], [dbo].[tbl_illness].[Conclusion] " +
            //                      "from [dbo].[tbl_illness] " +
            //                      "inner join [dbo].[tbl_CreateStaff] on [dbo].[tbl_illness].[CreateStaff] = [dbo].[tbl_CreateStaff].[CreateStaff_Id] " +
            //                      "inner join [dbo].[tbl_ModifiStaff] on [dbo].[tbl_illness].[ModifiStaff] = [dbo].[tbl_ModifiStaff].[ModifiStaff_Id] " +
            //                      "where [dbo].[tbl_illness].[Individual_Id] = @IndividualId and [dbo].[tbl_illness].[IsDeleted] = 0 " +
            //                      "order by [dbo].[tbl_illness].[IllnessNo]";

            String strSqlQueryForIllnessForIndividualId = "select [dbo].[tbl_illness].[IllnessNo], [dbo].[tbl_illness].[Case_Id], " +
                      "[dbo].[tbl_illness].[ICD_10_Id], " +
                      "[dbo].[tbl_illness].[CreateDate], [dbo].[tbl_CreateStaff].[Staff_Name]," +
                      "[dbo].[tbl_illness].[ModifiDate], [dbo].[tbl_ModifiStaff].[Staff_Name], " +
                      "[dbo].[tbl_illness].[Date_of_Diagnosis], " +
                      "[dbo].[tbl_illness].[TotalSharedAmount], " +
                      "[dbo].[tbl_illness].[LimitedSharingId], " +
                      "[dbo].[tbl_illness].[Introduction], [dbo].[tbl_illness].[Body], [dbo].[tbl_illness].[Conclusion] " +
                      "from [dbo].[tbl_illness] " +
                      "inner join [dbo].[tbl_CreateStaff] on [dbo].[tbl_illness].[CreateStaff] = [dbo].[tbl_CreateStaff].[CreateStaff_Id] " +
                      "inner join [dbo].[tbl_ModifiStaff] on [dbo].[tbl_illness].[ModifiStaff] = [dbo].[tbl_ModifiStaff].[ModifiStaff_Id] " +
                      "where [dbo].[tbl_illness].[Individual_Id] = @IndividualId and [dbo].[tbl_illness].[IsDeleted] = 0 " +
                      "order by [dbo].[tbl_illness].[IllnessNo]";

            SqlCommand cmdQueryForIllnesForIndividualId = new SqlCommand(strSqlQueryForIllnessForIndividualId, connRN);
            cmdQueryForIllnesForIndividualId.CommandType = CommandType.Text;

            cmdQueryForIllnesForIndividualId.Parameters.AddWithValue("@IndividualId", IndividualId);

            SqlDependency dependencyIllness = new SqlDependency(cmdQueryForIllnesForIndividualId);
            dependencyIllness.OnChange += new OnChangeEventHandler(OnIllnessChange);

            if (connRN.State != ConnectionState.Closed)
            {
                connRN.Close();
                connRN.Open();
            }
            else if (connRN.State == ConnectionState.Closed) connRN.Open();
            SqlDataReader rdrIllnessForIndividual = cmdQueryForIllnesForIndividualId.ExecuteReader();

            /////////////////////////////////////////////////////////////////////////////////////////////////////////////////
            //gvIllnessList.Rows.Clear();
            if (IsHandleCreated) RemoveAllRowIllnessListSafely();
            else gvIllnessList.Rows.Clear();

            if (rdrIllnessForIndividual.HasRows)
            {
                while (rdrIllnessForIndividual.Read())
                {
                    DataGridViewRow row = new DataGridViewRow();

                    if (!rdrIllnessForIndividual.IsDBNull(0)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrIllnessForIndividual.GetString(0) });
                    if (!rdrIllnessForIndividual.IsDBNull(1)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrIllnessForIndividual.GetString(1) });
                    if (!rdrIllnessForIndividual.IsDBNull(2)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrIllnessForIndividual.GetString(2) });
                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                    if (!rdrIllnessForIndividual.IsDBNull(3)) row.Cells.Add(new CalendarCell { Value = rdrIllnessForIndividual.GetDateTime(3).ToString("MM/dd/yyyy") });
                    else row.Cells.Add(new CalendarCell { Value = String.Empty });
                    if (!rdrIllnessForIndividual.IsDBNull(4)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrIllnessForIndividual.GetString(4) });
                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                    if (!rdrIllnessForIndividual.IsDBNull(5)) row.Cells.Add(new CalendarCell { Value = rdrIllnessForIndividual.GetDateTime(5).ToString("MM/dd/yyyy") });
                    else row.Cells.Add(new CalendarCell { Value = String.Empty });
                    if (!rdrIllnessForIndividual.IsDBNull(6)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrIllnessForIndividual.GetString(6) });
                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                    if (!rdrIllnessForIndividual.IsDBNull(7)) row.Cells.Add(new CalendarCell { Value = rdrIllnessForIndividual.GetDateTime(7).ToString("MM/dd/yyyy") });
                    else row.Cells.Add(new CalendarCell { Value = String.Empty });
                    if (!rdrIllnessForIndividual.IsDBNull(8))
                    {
                        DataGridViewTextBoxCell cellTotalSharedAmount = new DataGridViewTextBoxCell();
                        cellTotalSharedAmount.Value = rdrIllnessForIndividual.GetDecimal(8).ToString("C");
                        cellTotalSharedAmount.Style.Alignment = DataGridViewContentAlignment.MiddleRight;
                        row.Cells.Add(cellTotalSharedAmount);
                    }
                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                    if (!rdrIllnessForIndividual.IsDBNull(9))
                    {
                        switch (rdrIllnessForIndividual.GetInt16(9))
                        {
                            case 0:
                                DataGridViewTextBoxCell cellLimitedSharing = new DataGridViewTextBoxCell();
                                cellLimitedSharing.Value = "N/A";
                                cellLimitedSharing.Style.Alignment = DataGridViewContentAlignment.MiddleRight;
                                row.Cells.Add(cellLimitedSharing);
                                break;
                            case 1:
                                DataGridViewTextBoxCell cellLimitedSharing1 = new DataGridViewTextBoxCell();
                                cellLimitedSharing1.Value = dicLimitedSharing1[LimitedSharingYear].ToString("C");
                                cellLimitedSharing1.Style.Alignment = DataGridViewContentAlignment.MiddleRight;
                                row.Cells.Add(cellLimitedSharing1);
                                break;
                            case 2:
                                DataGridViewTextBoxCell cellLimitedSharing2 = new DataGridViewTextBoxCell();
                                cellLimitedSharing2.Value = dicLimitedSharing2[LimitedSharingYear].ToString("C");
                                cellLimitedSharing2.Style.Alignment = DataGridViewContentAlignment.MiddleRight;
                                row.Cells.Add(cellLimitedSharing2);
                                break;
                        }
                    }
                    if (!rdrIllnessForIndividual.IsDBNull(10)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrIllnessForIndividual.GetString(10) });
                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                    if (!rdrIllnessForIndividual.IsDBNull(11)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrIllnessForIndividual.GetString(11) });
                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                    if (!rdrIllnessForIndividual.IsDBNull(12)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrIllnessForIndividual.GetString(12) });
                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });

                    //gvIllnessList.Rows.Add(row);
                    if (IsHandleCreated) AddRowToIllnessListSafely(row);
                    else gvIllnessList.Rows.Add(row);

                }
            }
            //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
            rdrIllnessForIndividual.Close();
            if (connRN.State != ConnectionState.Closed) connRN.Close();
            ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

        }

        private void AddRowIncidentList(DataGridViewRow row)
        {
            gvIncidentList.Rows.Add(row);
        }

        private void RemoveRowIncidentList(int nRow)
        {
            gvIncidentList.Rows.RemoveAt(nRow);
        }

        private void RemoveAllIncidentList()
        {
            gvIncidentList.Rows.Clear();
        }

        private void AddRowToIncidentListSafely(DataGridViewRow row)
        {
            gvIncidentList.BeginInvoke(new AddRowToIncidentList(AddRowIncidentList), row);
        }

        private void RemoveRowFromIncidentListSafely(int nRow)
        {
            gvIncidentList.BeginInvoke(new RemoveRowInIncidentList(RemoveRowIncidentList), nRow);
        }

        private void RemoveAllRowIncidentListSafely()
        {
            gvIncidentList.BeginInvoke(new RemoveAllRowsInIncidentList(RemoveAllIncidentList));
        }


        private void UpdateGridViewIncidentList()
        {
            String IndividualId = IndividualSearched.strIndividualID;

            String strSqlQueryForIncidentForIndividual = "select [dbo].[tbl_incident].[IncidentNo], [dbo].[tbl_incident].[Case_id], [dbo].[tbl_illness].[IllnessNo], " +
                                             "[dbo].[tbl_incident].[CreateDate], [dbo].[tbl_CreateStaff].[Staff_Name], " +
                                             "[dbo].[tbl_incident].[ModifiDate], [dbo].[tbl_ModifiStaff].[Staff_Name], " +
                                             "[dbo].[tbl_incident].[TotalSharedAmount], [dbo].[tbl_incident_status_code].[IncidentStatusValue], " +
                                             "[dbo].[tbl_incident].[Review_Request], [dbo].[tbl_program].[ProgramName], " +
                                             "[dbo].[tbl_incident].[IncidentNote], [dbo].[tbl_incident].[Eligibility] " +
                                             "from [dbo].[tbl_incident] " +
                                             "inner join [dbo].[tbl_illness] on [dbo].[tbl_incident].[Illness_id] = [dbo].[tbl_illness].[Illness_Id] " +
                                             "inner join [dbo].[tbl_CreateStaff] on [dbo].[tbl_incident].[CreateStaff] = [dbo].[tbl_CreateStaff].[CreateStaff_Id] " +
                                             "inner join [dbo].[tbl_ModifiStaff] on [dbo].[tbl_incident].[ModifiStaff] = [dbo].[tbl_ModifiStaff].[ModifiStaff_Id] " +
                                             "inner join [dbo].[tbl_incident_status_code] on [dbo].[tbl_incident].[Incident_Status] = [dbo].[tbl_incident_status_code].[IncidentStatusCode] " +
                                             "inner join [dbo].[tbl_program] on [dbo].[tbl_incident].[Program_id] = [dbo].[tbl_program].[Program_Id] " +
                                             "where [dbo].[tbl_incident].[Individual_id] = @IndividualId and " +
                                             "[dbo].[tbl_incident].[IsDeleted] = 0 " +
                                             "order by [dbo].[tbl_incident].[IncidentNo]";

            SqlCommand cmdQueryForIncidentForIndividual = new SqlCommand(strSqlQueryForIncidentForIndividual, connRN);
            cmdQueryForIncidentForIndividual.CommandType = CommandType.Text;

            cmdQueryForIncidentForIndividual.Parameters.AddWithValue("@IndividualId", IndividualId);

            SqlDependency dependencyIncident = new SqlDependency(cmdQueryForIncidentForIndividual);
            dependencyIncident.OnChange += new OnChangeEventHandler(OnIncidentChange);

            if (IsHandleCreated)
            {
                if (gvIncidentList.Rows.Count > 0) RemoveAllRowIncidentListSafely();
            }
            else gvIncidentList.Rows.Clear();

            if (connRN.State != ConnectionState.Closed)
            {
                connRN.Close();
                connRN.Open();
            }
            else if (connRN.State == ConnectionState.Closed) connRN.Open();

            SqlDataReader rdrIncidentForIndividual = cmdQueryForIncidentForIndividual.ExecuteReader();
            if (rdrIncidentForIndividual.HasRows)
            {
                while (rdrIncidentForIndividual.Read())
                {
                    DataGridViewRow row = new DataGridViewRow();

                    if (!rdrIncidentForIndividual.IsDBNull(0)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrIncidentForIndividual.GetString(0) });
                    if (!rdrIncidentForIndividual.IsDBNull(1)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrIncidentForIndividual.GetString(1) });
                    if (!rdrIncidentForIndividual.IsDBNull(2)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrIncidentForIndividual.GetString(2) });
                    if (!rdrIncidentForIndividual.IsDBNull(3)) row.Cells.Add(new CalendarCell { Value = rdrIncidentForIndividual.GetDateTime(3).ToString("MM/dd/yyyy") });
                    if (!rdrIncidentForIndividual.IsDBNull(4)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrIncidentForIndividual.GetString(4) });
                    if (!rdrIncidentForIndividual.IsDBNull(5)) row.Cells.Add(new CalendarCell { Value = rdrIncidentForIndividual.GetDateTime(5).ToString("MM/dd/yyyy") });
                    if (!rdrIncidentForIndividual.IsDBNull(6)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrIncidentForIndividual.GetString(6) });
                    if (!rdrIncidentForIndividual.IsDBNull(7)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrIncidentForIndividual.GetDecimal(7).ToString("C") });
                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                    if (!rdrIncidentForIndividual.IsDBNull(8)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrIncidentForIndividual.GetString(8) });
                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                    if (!rdrIncidentForIndividual.IsDBNull(9)) row.Cells.Add(new DataGridViewCheckBoxCell { Value = rdrIncidentForIndividual.GetBoolean(9) });
                    if (!rdrIncidentForIndividual.IsDBNull(10)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrIncidentForIndividual.GetString(10) });
                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                    if (!rdrIncidentForIndividual.IsDBNull(11)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrIncidentForIndividual.GetString(11) });
                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                    if (!rdrIncidentForIndividual.IsDBNull(12)) row.Cells.Add(new DataGridViewCheckBoxCell { Value = rdrIncidentForIndividual.GetBoolean(12) });

                    if (IsHandleCreated) AddRowToIncidentListSafely(row);
                    else gvIncidentList.Rows.Add(row);
                }
            }
            rdrIncidentForIndividual.Close();
            if (connRN.State != ConnectionState.Closed) connRN.Close();
        }

        private void ResetMedDocumentsReceivedDate()
        {
            dtpNPFReceivedDate.Value = DateTime.Today;
            dtpIBReceivedDate.Value = DateTime.Today;
            dtpPoPReceivedDate.Value = DateTime.Today;
            dtpMRReceivedDate.Value = DateTime.Today;
            dtpOtherDocReceivedDate.Value = DateTime.Today;
        }

        private void btnCreateNewCase_Click(object sender, EventArgs e)
        {

            caseMode = CaseMode.AddNew;

            String strSqlCaseCount = "select count(ID) from tbl_case";

            SqlCommand cmdCaseCount = connRN3.CreateCommand();
            cmdCaseCount.CommandType = CommandType.Text;
            cmdCaseCount.CommandText = strSqlCaseCount;

            if (connRN3.State != ConnectionState.Closed)
            {
                connRN3.Close();
                connRN3.Open();
            }
            else if (connRN3.State == ConnectionState.Closed) connRN3.Open();
            Object objCaseCount = cmdCaseCount.ExecuteScalar();
            if (connRN3.State != ConnectionState.Closed) connRN3.Close();

            String strNewCaseName = String.Empty;

            if ((Int32)objCaseCount == 0)
            {
                if (connRN3.State != ConnectionState.Closed)
                {
                    connRN3.Close();
                    connRN3.Open();
                }
                else if (connRN3.State == ConnectionState.Closed) connRN3.Open();

                strNewCaseName = "Case-1";
                SqlCommand cmdAddFirstCaseId = connRN3.CreateCommand();
                SqlTransaction tranNewCaseId = connRN3.BeginTransaction(IsolationLevel.Serializable);

                cmdAddFirstCaseId.Connection = connRN3;
                cmdAddFirstCaseId.Transaction = tranNewCaseId;

                try
                {
                    String strInsertFirstCaseId = "update [dbo].[tbl_LastID] set [dbo].[tbl_LastID].[CaseId] = @NewCaseId where [dbo].[tbl_LastID].[Id] = 1";

                    cmdAddFirstCaseId.CommandType = CommandType.Text;
                    cmdAddFirstCaseId.CommandText = strInsertFirstCaseId;

                    cmdAddFirstCaseId.Parameters.AddWithValue("@NewCaseId", strNewCaseName);
                    int nCaseIdUpdated = cmdAddFirstCaseId.ExecuteNonQuery();

                    tranNewCaseId.Commit();
                }
                catch (Exception ex)
                {
                    try
                    {
                        tranNewCaseId.Rollback();
                        MessageBox.Show(ex.Message, "Error");
                        return;
                    }
                    catch (SqlException se)
                    {
                        MessageBox.Show(se.Message, "Sql Error");
                        return;
                    }
                }

                if (connRN3.State != ConnectionState.Closed) connRN3.Close();

                String strCaseName = strNewCaseName;
                strCaseNameSelected = strNewCaseName;

                ResetMedDocumentsReceivedDate();

                String strSqlQueryForCaseStatus = "select [dbo].[tbl_case_status_code].[CaseStatusValue] from [dbo].[tbl_case_status_code]";
                SqlCommand cmdQueryForCaseStatus = new SqlCommand(strSqlQueryForCaseStatus, connRN3);
                cmdQueryForCaseStatus.CommandType = CommandType.Text;

                if (connRN3.State != ConnectionState.Closed)
                {
                    connRN3.Close();
                    connRN3.Open();
                }
                else if (connRN3.State == ConnectionState.Closed) connRN3.Open();

                SqlDataReader rdrCaseStatus = cmdQueryForCaseStatus.ExecuteReader();
                cbCaseStatus.Items.Clear();
                if (rdrCaseStatus.HasRows)
                {
                    while (rdrCaseStatus.Read())
                    {
                        cbCaseStatus.Items.Add(rdrCaseStatus.GetString(0));
                    }
                }
                rdrCaseStatus.Close();
                if (connRN3.State != ConnectionState.Closed) connRN3.Close();

                cbCaseStatus.SelectedIndex = 0;
                cbCaseStatus.Enabled = true;

                String strIndividualID = txtCaseHistoryIndividualID.Text.Trim();

                String strSqlQueryForMedBillsInCase = "select [dbo].[tbl_medbill].[BillNo], [dbo].[tbl_medbill_type].[MedBillTypeName], [dbo].[tbl_medbill].[CreatedDate], " +
                                                        "[dbo].[tbl_CreateStaff].[Staff_Name], [dbo].[tbl_medbill].[LastModifiedDate], [dbo].[tbl_ModifiStaff].[Staff_Name], " +
                                                        "[dbo].[tbl_medbill].[BillAmount], [dbo].[tbl_medbill].[SettlementTotal], [dbo].[tbl_medbill].[TotalSharedAmount], " +
                                                        "[dbo].[tbl_medbill].[Balance] " +
                                                        "from [dbo].[tbl_medbill] " +
                                                        "inner join [dbo].[tbl_medbill_type] on [dbo].[tbl_medbill].[MedBillType_Id] = [dbo].[tbl_medbill_type].[MedBillTypeId] " +
                                                        "inner join [dbo].[tbl_CreateStaff] on [dbo].[tbl_medbill].[CreatedById] = [dbo].[tbl_CreateStaff].[CreateStaff_Id] " +
                                                        "inner join [dbo].[tbl_ModifiStaff] on [dbo].[tbl_medbill].[LastModifiedById] = [dbo].[tbl_ModifiStaff].[ModifiStaff_Id] " +
                                                        "where [dbo].[tbl_medbill].[Case_Id] = @CaseName and " +
                                                        "[dbo].[tbl_medbill].[Contact_Id] = @IndividualId and " +
                                                        "[dbo].[tbl_medbill].[IsDeleted] = 0";

                SqlCommand cmdQueryForMedBillsInCase = new SqlCommand(strSqlQueryForMedBillsInCase, connRN3);
                cmdQueryForMedBillsInCase.CommandType = CommandType.Text;

                cmdQueryForMedBillsInCase.Parameters.AddWithValue("@CaseName", strCaseName);
                cmdQueryForMedBillsInCase.Parameters.AddWithValue("@IndividualId", strIndividualID);

                SqlDependency dependencyMedBillsInCase = new SqlDependency(cmdQueryForMedBillsInCase);
                dependencyMedBillsInCase.OnChange += new OnChangeEventHandler(OnMedBillsInCaseViewChange);

                if (connRN3.State != ConnectionState.Closed)
                {
                    connRN3.Close();
                    connRN3.Open();
                }
                else if (connRN3.State == ConnectionState.Closed) connRN3.Open();
                SqlDataReader rdrMedBillInCase = cmdQueryForMedBillsInCase.ExecuteReader();
                gvCasePageMedBills.Rows.Clear();
                if (rdrMedBillInCase.HasRows)
                {
                    while (rdrMedBillInCase.Read())
                    {
                        DataGridViewRow row = new DataGridViewRow();

                        //row.Cells.Add(new DataGridViewCheckBoxCell { Value = false });
                        //row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillInCase.GetString(0) });
                        //row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillInCase.GetString(1) });
                        //row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillInCase.GetDateTime(2).ToString("MM/dd/yyyy") });
                        //row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillInCase.GetString(3) });
                        //row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillInCase.GetDateTime(4).ToString("MM/dd/yyyy") });
                        //row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillInCase.GetString(5) });
                        //row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillInCase.GetDecimal(6).ToString("C") });
                        //row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillInCase.GetDecimal(7).ToString("C") });
                        //row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillInCase.GetDecimal(8).ToString("C") });
                        //row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillInCase.GetDecimal(9).ToString("C") });

                        row.Cells.Add(new DataGridViewCheckBoxCell { Value = false });
                        row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillInCase.GetString(0) });
                        row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillInCase.GetString(1) });
                        row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillInCase.GetDateTime(2).ToString("MM/dd/yyyy") });
                        row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillInCase.GetDecimal(6).ToString("C") });
                        row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillInCase.GetDecimal(7).ToString("C") });
                        row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillInCase.GetDecimal(8).ToString("C") });
                        row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillInCase.GetDecimal(9).ToString("C") });
                        row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillInCase.GetString(3) });
                        row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillInCase.GetDateTime(4).ToString("MM/dd/yyyy") });
                        row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillInCase.GetString(5) });


                        gvCasePageMedBills.Rows.Add(row);
                    }
                }
                rdrMedBillInCase.Close();
                if (connRN3.State != ConnectionState.Closed) connRN3.Close();
            }
            else
            {
                if (connRN3.State != ConnectionState.Closed)
                {
                    connRN3.Close();
                    connRN3.Open();
                }
                else if (connRN3.State == ConnectionState.Closed) connRN3.Open();

                SqlCommand cmdCaseId = connRN3.CreateCommand();
                SqlTransaction tranCaseId = connRN3.BeginTransaction(IsolationLevel.Serializable);
                cmdCaseId.Connection = connRN3;
                cmdCaseId.Transaction = tranCaseId;

                try
                {
                    String strSqlQueryForLastCaseId = "select [dbo].[tbl_LastID].[CaseId] from [dbo].[tbl_LastID] where [dbo].[tbl_LastID].[Id] = 1";

                    cmdCaseId.CommandText = strSqlQueryForLastCaseId;
                    cmdCaseId.CommandType = CommandType.Text;

                    Object objLastCaseId = cmdCaseId.ExecuteScalar();

                    String strMaxCaseName = String.Empty;
                    if (objLastCaseId != null) strMaxCaseName = objLastCaseId.ToString();

                    Int32 nNewCaseNo = Int32.Parse(strMaxCaseName.Substring(5));
                    nNewCaseNo++;
                    strNewCaseName = "Case-" + nNewCaseNo.ToString();

                    String strSqlUpdateLastCaseId = "update [dbo].[tbl_LastID] set [dbo].[tbl_LastID].[CaseId] = @NewCaseId where [dbo].[tbl_LastID].[Id] = 1";

                    cmdCaseId.CommandText = strSqlUpdateLastCaseId;
                    cmdCaseId.CommandType = CommandType.Text;

                    cmdCaseId.Parameters.AddWithValue("@NewCaseId", strNewCaseName);

                    int nCaseIdUpdated = cmdCaseId.ExecuteNonQuery();

                    tranCaseId.Commit();
                }
                catch (Exception ex)
                {
                    try
                    {
                        tranCaseId.Rollback();
                    }
                    catch (SqlException se)
                    {
                        MessageBox.Show(se.Message, "Error");
                    }
                    MessageBox.Show(ex.Message, "Error");
                }
                if (connRN3.State != ConnectionState.Closed) connRN3.Close();

                String strCaseName = strNewCaseName;
                strCaseNameSelected = strNewCaseName;

                ResetMedDocumentsReceivedDate();

                String strSqlQueryForCaseStatus = "select [dbo].[tbl_case_status_code].[CaseStatusValue] from [dbo].[tbl_case_status_code]";
                SqlCommand cmdQueryForCaseStatus = new SqlCommand(strSqlQueryForCaseStatus, connRN3);
                cmdQueryForCaseStatus.CommandType = CommandType.Text;

                if (connRN3.State != ConnectionState.Closed)
                {
                    connRN3.Close();
                    connRN3.Open();
                }
                else if (connRN3.State == ConnectionState.Closed) connRN3.Open();

                SqlDataReader rdrCaseStatus = cmdQueryForCaseStatus.ExecuteReader();
                cbCaseStatus.Items.Clear();
                if (rdrCaseStatus.HasRows)
                {
                    while (rdrCaseStatus.Read())
                    {
                        cbCaseStatus.Items.Add(rdrCaseStatus.GetString(0));
                    }
                }
                rdrCaseStatus.Close();
                if (connRN3.State != ConnectionState.Closed) connRN3.Close();

                cbCaseStatus.SelectedIndex = 0;
                cbCaseStatus.Enabled = true;

                String strIndividualID = txtCaseHistoryIndividualID.Text.Trim();

                String strSqlQueryForMedBillsInCase = "select [dbo].[tbl_medbill].[BillNo], [dbo].[tbl_medbill_type].[MedBillTypeName], [dbo].[tbl_medbill].[CreatedDate], " +
                                                        "[dbo].[tbl_CreateStaff].[Staff_Name], [dbo].[tbl_medbill].[LastModifiedDate], [dbo].[tbl_ModifiStaff].[Staff_Name], " +
                                                        "[dbo].[tbl_medbill].[BillAmount], [dbo].[tbl_medbill].[SettlementTotal], [dbo].[tbl_medbill].[TotalSharedAmount], " +
                                                        "[dbo].[tbl_medbill].[Balance] " +
                                                        "from ((([dbo].[tbl_medbill] inner join [dbo].[tbl_medbill_type] on [dbo].[tbl_medbill].[MedBillType_Id] = [dbo].[tbl_medbill_type].[MedBillTypeId]) " +
                                                        "inner join [dbo].[tbl_CreateStaff] on [dbo].[tbl_medbill].[CreatedById] = [dbo].[tbl_CreateStaff].[CreateStaff_Id]) " +
                                                        "inner join [dbo].[tbl_ModifiStaff] on [dbo].[tbl_medbill].[LastModifiedById] = [dbo].[tbl_ModifiStaff].[ModifiStaff_Id]) " +
                                                        "where [dbo].[tbl_medbill].[Case_Id] = @CaseName and " +
                                                        "[dbo].[tbl_medbill].[Contact_Id] = @IndividualId and " +
                                                        "[dbo].[tbl_medbill].[IsDeleted] = 0";

                SqlCommand cmdQueryForMedBillsInCase = new SqlCommand(strSqlQueryForMedBillsInCase, connRN3);
                cmdQueryForMedBillsInCase.CommandType = CommandType.Text;

                cmdQueryForMedBillsInCase.Parameters.AddWithValue("@CaseName", strCaseName);
                cmdQueryForMedBillsInCase.Parameters.AddWithValue("@IndividualId", strIndividualID);

                SqlDependency dependencyMedBillsInCase = new SqlDependency(cmdQueryForMedBillsInCase);
                dependencyMedBillsInCase.OnChange += new OnChangeEventHandler(OnMedBillsInCaseViewChange);

                if (connRN3.State != ConnectionState.Closed)
                {
                    connRN3.Close();
                    connRN3.Open();
                }
                else if (connRN3.State == ConnectionState.Closed) connRN3.Open();
                SqlDataReader rdrMedBillInCase = cmdQueryForMedBillsInCase.ExecuteReader();
                gvCasePageMedBills.Rows.Clear();
                if (rdrMedBillInCase.HasRows)
                {
                    while (rdrMedBillInCase.Read())
                    {
                        DataGridViewRow row = new DataGridViewRow();

                        row.Cells.Add(new DataGridViewCheckBoxCell { Value = false });
                        row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillInCase.GetString(0) });
                        row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillInCase.GetString(1) });
                        row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillInCase.GetDateTime(2).ToString("MM/dd/yyyy") });
                        row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillInCase.GetString(3) });
                        row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillInCase.GetDateTime(4).ToString("MM/dd/yyyy") });
                        row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillInCase.GetString(5) });
                        row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillInCase.GetDecimal(6).ToString("C") });
                        row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillInCase.GetDecimal(7).ToString("C") });
                        row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillInCase.GetDecimal(8).ToString("C") });
                        row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillInCase.GetDecimal(9).ToString("C") });

                        gvCasePageMedBills.Rows.Add(row);
                    }
                }
                rdrMedBillInCase.Close();
                if (connRN3.State != ConnectionState.Closed) connRN3.Close();

            }

            //connRN.Close();

            txtCaseName.Text = strNewCaseName;

            txtCaseIndividualID.Text = txtIndividualID.Text;

            if (txtMiddleName.Text == String.Empty) txtCreateCaseIndividualName.Text = txtLastName.Text + ", " + txtFirstName.Text;
            else txtCreateCaseIndividualName.Text = txtLastName.Text + ", " + txtFirstName.Text + " " + txtMiddleName.Text;

            chkNPF_CaseCreationPage.Checked = false;
            chkIB_CaseCreationPage.Checked = false;
            chkPoP_CaseCreationPage.Checked = false;
            chkMedicalRecordCaseCreationPage.Checked = false;
            chkOtherDocCaseCreationPage.Checked = false;

            txtNPFFormFilePath.Text = String.Empty;
            txtIBFilePath.Text = String.Empty;
            txtPopFilePath.Text = String.Empty;
            txtMedicalRecordFilePath.Text = String.Empty;
            txtOtherDocumentFilePath.Text = String.Empty;

            //txtNPFUploadDate.Text = String.Empty;
            //txtIBUploadDate.Text = String.Empty;
            //txtPoPUploadDate.Text = String.Empty;
            //txtMRUploadDate.Text = String.Empty;
            //txtOtherDocUploadDate.Text = String.Empty;

            tbCMMManager.SelectedTab = tbpgCreateCase;

            btnNewMedBill_Case.Enabled = false;
            btnEditMedBill.Enabled = false;
            btnDeleteMedBill.Enabled = false;

            EnableCaseForm();

            btnCaseCreationSaveUpper.Enabled = true;
            //btnCaseCreationLowerSave.Enabled = true;
            //}
            //else
            //{
            //    MessageBox.Show("Case Page is already open. Please close Case Page first.", "Alert");
            //    return;
            //}

        }

        private void btnCaseCreationSaveUpper_Click(object sender, EventArgs e)
        {
            Cursor.Current = Cursors.WaitCursor;

            String CaseName = txtCaseName.Text.Trim();
            String IndividualId = txtCaseIndividualID.Text.Trim();

            String strSqlQueryForCaseName = "select [dbo].[tbl_case].[Case_Name] from [dbo].[tbl_case] " +
                                            "where [dbo].[tbl_case].[Case_Name] = @CaseName and [dbo].[tbl_case].[Contact_ID] = @IndividualId";

            SqlCommand cmdQueryForCaseName = new SqlCommand(strSqlQueryForCaseName, connRN4);
            cmdQueryForCaseName.CommandText = strSqlQueryForCaseName;
            cmdQueryForCaseName.CommandType = CommandType.Text;

            cmdQueryForCaseName.Parameters.AddWithValue("@CaseName", CaseName);
            cmdQueryForCaseName.Parameters.AddWithValue("@IndividualId", IndividualId);

            if (connRN4.State != ConnectionState.Closed)
            {
                connRN4.Close();
                connRN4.Open();
            }
            else if (connRN4.State == ConnectionState.Closed) connRN4.Open();
            Object objCaseName = cmdQueryForCaseName.ExecuteScalar();
            if (connRN4.State != ConnectionState.Closed) connRN4.Close();

            if (objCaseName == null)
            {
                frmSaveNewCase frmSaveNewCase = new frmSaveNewCase();
                frmSaveNewCase.StartPosition = FormStartPosition.CenterParent;

                DialogResult dlgResult = frmSaveNewCase.ShowDialog();

                if (dlgResult == DialogResult.Yes)
                {

                    String strCaseId = String.Empty;
                    String strIndividualID = String.Empty;
                    String strNPFormFilePath = String.Empty;
                    String strNPFUploadDate = String.Empty;
                    String strIBFilePath = String.Empty;
                    String strIBUploadDate = String.Empty;
                    String strPopFilePath = String.Empty;
                    String strPopUploadDate = String.Empty;
                    String strMedicalRecordFilePath = String.Empty;
                    String strMedicalRecordUploadDate = String.Empty;
                    String strUnknownDocumentFilePath = String.Empty;
                    String strUnknownDocUploadDate = String.Empty;
                    String strLogID = String.Empty;

                    CasedInfoDetailed caseDetail = new CasedInfoDetailed();

                    caseDetail.CaseId = String.Empty;
                    caseDetail.ContactId = String.Empty;
                    caseDetail.Individual_Id = String.Empty;
                    caseDetail.CreateDate = DateTime.Today;
                    caseDetail.ModificationDate = DateTime.Today;
                    caseDetail.CreateStaff = nLoggedUserId;
                    caseDetail.ModifyingStaff = nLoggedUserId;
                    switch (cbCaseStatus.SelectedIndex)
                    {
                        case (int)CaseStatus.OnGoing:
                            caseDetail.Status = CaseStatus.OnGoing;
                            break;
                        case (int)CaseStatus.Processing:
                            caseDetail.Status = CaseStatus.Processing;
                            break;
                        case (int)CaseStatus.Closed:
                            caseDetail.Status = CaseStatus.Closed;
                            break;
                    }
                    caseDetail.Individual_Id = String.Empty;
                    caseDetail.NPF_Form = 0;
                    caseDetail.NPF_Form_File_Name = String.Empty;
                    caseDetail.NPF_Form_Destination_File_Name = String.Empty;

                    caseDetail.IB_Form = 0;
                    caseDetail.IB_Form_File_Name = String.Empty;
                    caseDetail.IB_Form_Destination_File_Name = String.Empty;

                    caseDetail.POP_Form = 0;
                    caseDetail.POP_Form_File_Name = String.Empty;
                    caseDetail.POP_Form_Destionation_File_Name = String.Empty;

                    caseDetail.MedicalRecord_Form = 0;
                    caseDetail.MedRec_Form_File_Name = String.Empty;
                    caseDetail.MedRec_Form_Destination_File_Name = String.Empty;

                    caseDetail.Unknown_Form = 0;
                    caseDetail.Unknown_Form_File_Name = String.Empty;
                    caseDetail.Unknown_Form_Destination_File_Name = String.Empty;

                    caseDetail.Note = String.Empty;
                    caseDetail.Log_Id = String.Empty;
                    caseDetail.AddBill_Form = false;

                    caseDetail.Remove_Log = String.Empty;

                    if (txtCaseName.Text.Trim() != String.Empty) caseDetail.CaseId = txtCaseName.Text.Trim();
                    if (txtCaseIndividualID.Text.Trim() != String.Empty) caseDetail.ContactId = txtCaseIndividualID.Text.Trim();
                    if (txtCaseIndividualID.Text.Trim() != String.Empty) caseDetail.Individual_Id = txtCaseIndividualID.Text.Trim();
                    if (chkNPF_CaseCreationPage.Checked)
                    {
                        caseDetail.NPF_Form = 1;
                        if (txtNPFFormFilePath.Text.Trim() != String.Empty)
                        {
                            //caseDetail.NPF_Form_File_Name = txtNPFFormFilePath.Text.Trim();
                            caseDetail.NPF_Form_File_Name = strNPFormFilePathSource;
                        }
                        //if (txtNPFUploadDate.Text.Trim() != String.Empty)
                        //{
                        //    DateTime result;
                        //    if (DateTime.TryParse(txtNPFUploadDate.Text.Trim(), out result)) caseDetail.NPF_ReceivedDate = result;
                        //    else MessageBox.Show("Invalid DateTime value", "Error");
                        //}
                        caseDetail.NPF_ReceivedDate = dtpNPFReceivedDate.Value;
                        caseDetail.NPF_Form_Destination_File_Name = strNPFormFilePathDestination;
                    }
                    if (chkIB_CaseCreationPage.Checked)
                    {
                        caseDetail.IB_Form = 1;
                        if (txtIBFilePath.Text.Trim() != String.Empty)
                        {
                            //caseDetail.IB_Form_File_Name = txtIBFilePath.Text.Trim();
                            caseDetail.IB_Form_File_Name = strIBFilePathSource;
                        }
                        //if (txtIBUploadDate.Text.Trim() != String.Empty)
                        //{
                        //    DateTime result;
                        //    if (DateTime.TryParse(txtIBUploadDate.Text.Trim(), out result)) caseDetail.IB_ReceivedDate = result;
                        //    else MessageBox.Show("Invalid DateTime value", "Error");
                        //}
                        caseDetail.IB_ReceivedDate = dtpIBReceivedDate.Value;
                        caseDetail.IB_Form_Destination_File_Name = strIBFilePathDestination;
                    }
                    if (chkPoP_CaseCreationPage.Checked)
                    {
                        caseDetail.POP_Form = 1;
                        if (txtPopFilePath.Text.Trim() != String.Empty)
                        {
                            //caseDetail.POP_Form_File_Name = txtPopFilePath.Text.Trim();
                            caseDetail.POP_Form_File_Name = strPoPFilePathSource;
                        }
                        //if (txtPoPUploadDate.Text.Trim() != String.Empty)
                        //{
                        //    DateTime result;
                        //    if (DateTime.TryParse(txtPoPUploadDate.Text.Trim(), out result)) caseDetail.POP_ReceivedDate = result;
                        //    else MessageBox.Show("Invalid DateTime value", "Error");
                        //}
                        caseDetail.POP_ReceivedDate = dtpPoPReceivedDate.Value;
                        caseDetail.POP_Form_Destionation_File_Name = strPopFilePathDestination;
                    }
                    if (chkMedicalRecordCaseCreationPage.Checked)
                    {
                        caseDetail.MedicalRecord_Form = 1;
                        if (txtMedicalRecordFilePath.Text.Trim() != String.Empty)
                        {
                            //caseDetail.MedRec_Form_File_Name = txtMedicalRecordFilePath.Text.Trim();
                            caseDetail.MedRec_Form_File_Name = strMedRecordFilePathSource;
                        }
                        //if (txtMRUploadDate.Text.Trim() != String.Empty)
                        //{
                        //    DateTime result;
                        //    if (DateTime.TryParse(txtMRUploadDate.Text.Trim(), out result)) caseDetail.MedRec_ReceivedDate = result;
                        //    else MessageBox.Show("Invalid DateTime value", "Error");
                        //}
                        caseDetail.MedRec_ReceivedDate = dtpMRReceivedDate.Value;
                        caseDetail.MedRec_Form_Destination_File_Name = strMedRecordFilePathDestination;
                    }
                    if (chkOtherDocCaseCreationPage.Checked)
                    {
                        caseDetail.Unknown_Form = 1;
                        if (txtOtherDocumentFilePath.Text.Trim() != String.Empty)
                        {
                            //caseDetail.Unknown_Form_File_Name = txtOtherDocumentFilePath.Text.Trim();
                            caseDetail.Unknown_Form_File_Name = strUnknownDocFilePathSource;
                        }
                        //if (txtOtherDocUploadDate.Text.Trim() != String.Empty)      //caseDetail.Unknown_ReceivedDate = DateTime.Parse(txtOtherDocUploadDate.Text.Trim());
                        //{
                        //    DateTime result;
                        //    if (DateTime.TryParse(txtOtherDocUploadDate.Text.Trim(), out result)) caseDetail.Unknown_ReceivedDate = result;
                        //    else MessageBox.Show("Invalid DateTime value", "Error");
                        //}
                        caseDetail.Unknown_ReceivedDate = dtpOtherDocReceivedDate.Value;
                        caseDetail.Unknown_Form_Destination_File_Name = strUnknownDocFilePathDestination;
                    }

                    caseDetail.Log_Id = "Log: " + txtCaseName.Text;
                    caseDetail.AddBill_Form = false;
                    caseDetail.AddBill_Received_Date = null;
                    caseDetail.Remove_Log = String.Empty;

                    String strSqlCreateCase = "insert into tbl_case (IsDeleted, Case_Name, Contact_ID, CreateDate, ModifiDate, CreateStaff, ModifiStaff, Case_status, " +
                                               "NPF_Form, NPF_Form_File_Name, NPF_Form_Destination_File_Name, NPF_Receiv_Date, " +
                                               "IB_Form, IB_Form_File_Name, IB_Form_Destination_File_Name, IB_Receiv_Date, " +
                                               "POP_Form, POP_Form_File_Name, POP_Form_Destination_File_Name, POP_Receiv_Date, " +
                                               "MedRec_Form, MedRec_Form_File_Name, MedRec_Form_Destination_File_Name, MedRec_Receiv_Date, " +
                                               "Unknown_Form, Unknown_Form_File_Name, Unknown_Form_Destination_File_Name, Unknown_Receiv_Date, " +
                                               "Note, Log_ID, AddBill_Form, AddBill_receiv_Date, Remove_log, individual_id) " +
                                               "Values (@IsDeleted, @CaseId, @ContactId, @CreateDate, @ModifiDate, @CreateStaff, @ModifiStaff, @CaseStatus, " +
                                               "@NPF_Form, @NPF_Form_File_Name, @NPF_Form_Destination_File_Name, @NPF_Receive_Date, " +
                                               "@IB_Form, @IB_Form_File_Name, @IB_Form_Destination_File_Name, @IB_Receive_Date, " +
                                               "@POP_Form, @POP_Form_File_Name, @POP_Form_Destination_File_Name, @POP_Receive_Date, " +
                                               "@MedRecord_Form, @MedRecord_Form_File_Name, @MedRecord_Form_Destination_File_name, @MedRecord_Receive_Date, " +
                                               "@Unknown_Form, @Unknown_Form_File_Name, @Unknown_Form_Destination_File_Name, @Unknown_Receive_Date, " +
                                               "@Note, @Log_Id, @AddBill_Form, @AddBill_ReceiveDate, @Remove_Log, @Individual_Id)";

                    SqlCommand cmdInsertNewCase = new SqlCommand(strSqlCreateCase, connRN4);
                    cmdInsertNewCase.CommandType = CommandType.Text;

                    cmdInsertNewCase.Parameters.AddWithValue("@IsDeleted", 0);
                    cmdInsertNewCase.Parameters.AddWithValue("@CaseId", caseDetail.CaseId);
                    cmdInsertNewCase.Parameters.AddWithValue("@ContactId", caseDetail.ContactId);
                    cmdInsertNewCase.Parameters.AddWithValue("@CreateDate", caseDetail.CreateDate);
                    cmdInsertNewCase.Parameters.AddWithValue("@ModifiDate", caseDetail.ModificationDate);
                    cmdInsertNewCase.Parameters.AddWithValue("@CreateStaff", caseDetail.CreateStaff);
                    cmdInsertNewCase.Parameters.AddWithValue("@ModifiStaff", caseDetail.ModifyingStaff);
                    cmdInsertNewCase.Parameters.AddWithValue("@CaseStatus", caseDetail.Status);

                    cmdInsertNewCase.Parameters.AddWithValue("@NPF_Form", caseDetail.NPF_Form);
                    cmdInsertNewCase.Parameters.AddWithValue("@NPF_Form_File_Name", caseDetail.NPF_Form_File_Name);
                    cmdInsertNewCase.Parameters.AddWithValue("@NPF_Form_Destination_File_Name", caseDetail.NPF_Form_Destination_File_Name);
                    if (caseDetail.NPF_ReceivedDate != null) cmdInsertNewCase.Parameters.AddWithValue("@NPF_Receive_Date", caseDetail.NPF_ReceivedDate);
                    else cmdInsertNewCase.Parameters.AddWithValue("@NPF_Receive_Date", DBNull.Value);

                    cmdInsertNewCase.Parameters.AddWithValue("@IB_Form", caseDetail.IB_Form);
                    cmdInsertNewCase.Parameters.AddWithValue("@IB_Form_File_Name", caseDetail.IB_Form_File_Name);
                    cmdInsertNewCase.Parameters.AddWithValue("@IB_Form_Destination_File_Name", caseDetail.IB_Form_Destination_File_Name);
                    if (caseDetail.IB_ReceivedDate != null) cmdInsertNewCase.Parameters.AddWithValue("@IB_Receive_Date", caseDetail.IB_ReceivedDate);
                    else cmdInsertNewCase.Parameters.AddWithValue("@IB_Receive_Date", DBNull.Value);

                    cmdInsertNewCase.Parameters.AddWithValue("@POP_Form", caseDetail.POP_Form);
                    cmdInsertNewCase.Parameters.AddWithValue("@POP_Form_File_Name", caseDetail.POP_Form_File_Name);
                    cmdInsertNewCase.Parameters.AddWithValue("@POP_Form_Destination_File_Name", caseDetail.POP_Form_Destionation_File_Name);
                    if (caseDetail.POP_ReceivedDate != null) cmdInsertNewCase.Parameters.AddWithValue("@POP_Receive_Date", caseDetail.POP_ReceivedDate);
                    else cmdInsertNewCase.Parameters.AddWithValue("@POP_Receive_Date", DBNull.Value);

                    cmdInsertNewCase.Parameters.AddWithValue("@MedRecord_Form", caseDetail.MedicalRecord_Form);
                    cmdInsertNewCase.Parameters.AddWithValue("@MedRecord_Form_File_Name", caseDetail.MedRec_Form_File_Name);
                    cmdInsertNewCase.Parameters.AddWithValue("@MedRecord_Form_Destination_File_Name", caseDetail.MedRec_Form_Destination_File_Name);
                    if (caseDetail.MedRec_ReceivedDate != null) cmdInsertNewCase.Parameters.AddWithValue("@MedRecord_Receive_Date", caseDetail.MedRec_ReceivedDate);
                    else cmdInsertNewCase.Parameters.AddWithValue("@MedRecord_Receive_Date", DBNull.Value);

                    cmdInsertNewCase.Parameters.AddWithValue("@Unknown_Form", caseDetail.Unknown_Form);
                    cmdInsertNewCase.Parameters.AddWithValue("@Unknown_Form_File_Name", caseDetail.Unknown_Form_File_Name);
                    cmdInsertNewCase.Parameters.AddWithValue("@Unknown_Form_Destination_File_Name", caseDetail.Unknown_Form_Destination_File_Name);
                    if (caseDetail.Unknown_ReceivedDate != null) cmdInsertNewCase.Parameters.AddWithValue("@Unknown_Receive_Date", caseDetail.Unknown_ReceivedDate);
                    else cmdInsertNewCase.Parameters.AddWithValue("@Unknown_Receive_Date", DBNull.Value);

                    cmdInsertNewCase.Parameters.AddWithValue("@Note", caseDetail.Note);
                    cmdInsertNewCase.Parameters.AddWithValue("@Log_Id", caseDetail.Log_Id);
                    cmdInsertNewCase.Parameters.AddWithValue("@AddBill_Form", caseDetail.AddBill_Form);
                    if (caseDetail.AddBill_Received_Date != null) cmdInsertNewCase.Parameters.AddWithValue("@AddBill_ReceiveDate", caseDetail.AddBill_Received_Date);
                    else cmdInsertNewCase.Parameters.AddWithValue("@AddBill_ReceiveDate", DBNull.Value);
                    if (caseDetail.Remove_Log == String.Empty) cmdInsertNewCase.Parameters.AddWithValue("@Remove_Log", DBNull.Value);
                    cmdInsertNewCase.Parameters.AddWithValue("@Individual_Id", caseDetail.Individual_Id);

                    if (connRN4.State != ConnectionState.Closed)
                    {
                        connRN4.Close();
                        connRN4.Open();
                    }
                    else if (connRN4.State == ConnectionState.Closed) connRN4.Open();
                    int nResult = cmdInsertNewCase.ExecuteNonQuery();

                    if (connRN4.State != ConnectionState.Closed) connRN4.Close();

                    if (nResult == 2)
                    {
                        MessageBox.Show("The case has been saved.", "Information");

                        caseDetail.CaseId = txtCaseName.Text.Trim();
                        strCaseIdSelected = caseDetail.CaseId;
                        strContactIdSelected = caseDetail.ContactId;

                        btnNewMedBill_Case.Enabled = true;
                        btnEditMedBill.Enabled = true;
                        btnDeleteMedBill.Enabled = true;
                    }

                    return;
                }
                else if (dlgResult == DialogResult.Cancel)
                {
                    return;
                }
            }
            else if (objCaseName != null)    // Edit and update case
            {
                frmSaveChangeOnCase frmDlgSaveChange = new frmSaveChangeOnCase();

                frmDlgSaveChange.StartPosition = FormStartPosition.CenterParent;
                DialogResult dlgResult = frmDlgSaveChange.ShowDialog();

                if (dlgResult == DialogResult.Yes)
                {
                    CasedInfoDetailed caseDetail = new CasedInfoDetailed();

                    caseDetail.CaseId = txtCaseName.Text.Trim();
                    caseDetail.ContactId = String.Empty;
                    caseDetail.Individual_Id = String.Empty;
                    caseDetail.CreateDate = DateTime.Today;
                    caseDetail.ModifyingStaff = nLoggedUserId;
                    switch (cbCaseStatus.SelectedIndex)
                    {
                        case (int)CaseStatus.OnGoing:
                            caseDetail.Status = CaseStatus.OnGoing;
                            break;
                        case (int)CaseStatus.Processing:
                            caseDetail.Status = CaseStatus.Processing;
                            break;
                        case (int)CaseStatus.Closed:
                            caseDetail.Status = CaseStatus.Closed;
                            break;
                    }
                    caseDetail.Individual_Id = String.Empty;
                    caseDetail.NPF_Form = 0;
                    caseDetail.NPF_Form_File_Name = String.Empty;
                    caseDetail.NPF_Form_Destination_File_Name = String.Empty;
                    caseDetail.IB_Form = 0;
                    caseDetail.IB_Form_File_Name = String.Empty;
                    caseDetail.IB_Form_Destination_File_Name = String.Empty;
                    caseDetail.POP_Form = 0;
                    caseDetail.POP_Form_File_Name = String.Empty;
                    caseDetail.POP_Form_Destionation_File_Name = String.Empty;
                    caseDetail.MedicalRecord_Form = 0;
                    caseDetail.MedRec_Form_File_Name = String.Empty;
                    caseDetail.MedRec_Form_Destination_File_Name = String.Empty;
                    caseDetail.Unknown_Form = 0;
                    caseDetail.Unknown_Form_File_Name = String.Empty;
                    caseDetail.Unknown_Form_Destination_File_Name = String.Empty;
                    caseDetail.Note = String.Empty;
                    caseDetail.Log_Id = String.Empty;
                    caseDetail.AddBill_Form = false;
                    caseDetail.Remove_Log = String.Empty;

                    if (txtCaseName.Text.Trim() != String.Empty) caseDetail.CaseId = txtCaseName.Text.Trim();
                    if (txtCaseIndividualID.Text.Trim() != String.Empty) caseDetail.ContactId = txtCaseIndividualID.Text.Trim();
                    if (txtCaseIndividualID.Text.Trim() != String.Empty) caseDetail.Individual_Id = txtCaseIndividualID.Text.Trim();

                    if (chkNPF_CaseCreationPage.Checked)
                    {
                        caseDetail.NPF_Form = 1;
                        if (txtNPFFormFilePath.Text.Trim() != String.Empty)
                        {
                            //caseDetail.NPF_Form_File_Name = txtNPFFormFilePath.Text.Trim();
                            caseDetail.NPF_Form_File_Name = strNPFormFilePathSource;
                        }
                        //if (txtNPFUploadDate.Text.Trim() != String.Empty)
                        //{
                        //    DateTime result;
                        //    if (DateTime.TryParse(txtNPFUploadDate.Text.Trim(), out result)) caseDetail.NPF_ReceivedDate = result;
                        //    else MessageBox.Show("Invalid DateTime value", "Error");
                        //}
                        caseDetail.NPF_ReceivedDate = dtpNPFReceivedDate.Value;
                        caseDetail.NPF_Form_Destination_File_Name = strNPFormFilePathDestination;
                    }
                    if (chkIB_CaseCreationPage.Checked)
                    {
                        caseDetail.IB_Form = 1;
                        if (txtIBFilePath.Text.Trim() != String.Empty)
                        {
                            //caseDetail.IB_Form_File_Name = txtIBFilePath.Text.Trim();
                            caseDetail.IB_Form_File_Name = strIBFilePathSource;
                        }
                        //if (txtIBUploadDate.Text.Trim() != String.Empty)
                        //{
                        //    DateTime result;
                        //    if (DateTime.TryParse(txtIBUploadDate.Text.Trim(), out result)) caseDetail.IB_ReceivedDate = result;
                        //    else MessageBox.Show("Invalid DateTime value", "Error");
                        //}
                        caseDetail.IB_ReceivedDate = dtpIBReceivedDate.Value;
                        caseDetail.IB_Form_Destination_File_Name = strIBFilePathDestination;
                    }
                    if (chkPoP_CaseCreationPage.Checked)
                    {
                        caseDetail.POP_Form = 1;
                        if (txtPopFilePath.Text.Trim() != String.Empty)
                        {
                            //caseDetail.POP_Form_File_Name = txtPopFilePath.Text.Trim();
                            caseDetail.POP_Form_File_Name = strPoPFilePathSource;
                        }
                        //if (txtPoPUploadDate.Text.Trim() != String.Empty)
                        //{
                        //    DateTime result;
                        //    if (DateTime.TryParse(txtPoPUploadDate.Text.Trim(), out result)) caseDetail.POP_ReceivedDate = result;
                        //    else MessageBox.Show("Invalid DateTime value", "Error");
                        //}
                        caseDetail.POP_ReceivedDate = dtpPoPReceivedDate.Value;
                        caseDetail.POP_Form_Destionation_File_Name = strPopFilePathDestination;
                    }
                    if (chkMedicalRecordCaseCreationPage.Checked)
                    {
                        caseDetail.MedicalRecord_Form = 1;
                        if (txtMedicalRecordFilePath.Text.Trim() != String.Empty)
                        {
                            //caseDetail.MedRec_Form_File_Name = txtMedicalRecordFilePath.Text.Trim();
                            caseDetail.MedRec_Form_File_Name = strMedRecordFilePathSource;
                        }
                        //if (txtMRUploadDate.Text.Trim() != String.Empty)
                        //{
                        //    DateTime result;
                        //    if (DateTime.TryParse(txtMRUploadDate.Text.Trim(), out result)) caseDetail.MedRec_ReceivedDate = result;
                        //    else MessageBox.Show("Invalid DateTime value", "Error");
                        //}
                        caseDetail.MedRec_ReceivedDate = dtpMRReceivedDate.Value;
                        caseDetail.MedRec_Form_Destination_File_Name = strMedRecordFilePathDestination;
                    }
                    if (chkOtherDocCaseCreationPage.Checked)
                    {
                        caseDetail.Unknown_Form = 1;
                        if (txtOtherDocumentFilePath.Text.Trim() != String.Empty)
                        {
                            //caseDetail.Unknown_Form_File_Name = txtOtherDocumentFilePath.Text.Trim();
                            caseDetail.Unknown_Form_File_Name = strUnknownDocFilePathSource;
                        }
                        //if (txtOtherDocUploadDate.Text.Trim() != String.Empty)
                        //{
                        //    DateTime result;
                        //    if (DateTime.TryParse(txtOtherDocUploadDate.Text.Trim(), out result)) caseDetail.Unknown_ReceivedDate = result;
                        //    else MessageBox.Show("Invalid DateTime value", "Error");
                        //}
                        caseDetail.Unknown_ReceivedDate = dtpOtherDocReceivedDate.Value;
                        caseDetail.Unknown_Form_Destination_File_Name = strUnknownDocFilePathDestination;
                    }

                    caseDetail.Note = txtNoteOnCase.Text.Trim();
                    caseDetail.Log_Id = "Log: " + txtCaseName.Text;
                    caseDetail.AddBill_Form = true;
                    caseDetail.AddBill_Received_Date = DateTime.Today;
                    caseDetail.Remove_Log = String.Empty;

                    String strSqlUpdateCase = "Update [dbo].[tbl_case] set [dbo].[tbl_case].[ModifiDate] = @ModifiDate, [dbo].[tbl_case].[ModifiStaff] = @ModifiStaff, " +
                                              "[dbo].[tbl_case].[NPF_Form] = @NPF_Form, [dbo].[tbl_case].[NPF_Form_File_Name] = @NPF_Form_File_Name, " +
                                              "[dbo].[tbl_case].[NPF_Form_Destination_File_Name] = @NPF_Form_Destination_File_Name, [dbo].[tbl_case].[NPF_Receiv_Date] = @NPF_Receiv_Date, " +
                                              "[dbo].[tbl_case].[IB_Form] = @IB_Form, [dbo].[tbl_case].[IB_Form_File_Name] = @IB_Form_File_Name, " +
                                              "[dbo].[tbl_case].[IB_Form_Destination_File_Name] = @IB_Form_Destination_File_Name, [dbo].[tbl_case].[IB_Receiv_Date] = @IB_Receiv_Date, " +
                                              "[dbo].[tbl_case].[POP_Form] = @POP_Form, [dbo].[tbl_case].[POP_Form_File_Name] = @POP_Form_File_Name, " +
                                              "[dbo].[tbl_case].[POP_Form_Destination_File_Name] = @POP_Form_Destination_File_Name, [dbo].[tbl_case].[POP_Receiv_Date] = @POP_Receiv_Date, " +
                                              "[dbo].[tbl_case].[MedRec_Form] = @MedRec_Form, [dbo].[tbl_case].[MedRec_Form_File_Name] = @MedRec_Form_File_Name, " +
                                              "[dbo].[tbl_case].[MedRec_Form_Destination_File_Name] = @MedRec_Form_Destination_File_Name, [dbo].[tbl_case].[MedRec_Receiv_Date] = @MedRec_Receiv_Date, " +
                                              "[dbo].[tbl_case].[Unknown_Form] = @Unknown_Form, [dbo].[tbl_case].[Unknown_Form_File_Name] = @Unknown_Form_File_Name, " +
                                              "[dbo].[tbl_case].[Unknown_Form_Destination_File_Name] = @Unknown_Form_Destination_File_Name, [dbo].[tbl_case].[Unknown_Receiv_Date] = @Unknown_Receiv_Date, " +
                                              "[dbo].[tbl_case].[Note] = @CaseNote, [dbo].[tbl_case].[Log_ID] = @Log_Id, [dbo].[tbl_case].[AddBill_Form] = @AddBill_Form, " +
                                              "[dbo].[tbl_case].[AddBill_Receiv_Date] = @AddBill_Receiv_Date, [dbo].[tbl_case].[Remove_Log] = @Remove_Log, " +
                                              "[dbo].[tbl_case].[Case_status] = @CaseStatus " +
                                              "where [dbo].[tbl_case].[Case_Name] = @Case_Id";

                    SqlCommand cmdUpdateCase = new SqlCommand(strSqlUpdateCase, connRN4);
                    cmdUpdateCase.CommandType = CommandType.Text;

                    cmdUpdateCase.Parameters.AddWithValue("@ModifiDate", caseDetail.ModificationDate);
                    cmdUpdateCase.Parameters.AddWithValue("@ModifiStaff", caseDetail.ModifyingStaff);
                    cmdUpdateCase.Parameters.AddWithValue("@NPF_Form", caseDetail.NPF_Form);
                    cmdUpdateCase.Parameters.AddWithValue("@NPF_Form_File_Name", caseDetail.NPF_Form_File_Name);
                    cmdUpdateCase.Parameters.AddWithValue("@NPF_Form_Destination_File_Name", caseDetail.NPF_Form_Destination_File_Name);
                    if (caseDetail.NPF_ReceivedDate != null) cmdUpdateCase.Parameters.AddWithValue("@NPF_Receiv_Date", caseDetail.NPF_ReceivedDate);
                    else cmdUpdateCase.Parameters.AddWithValue("@NPF_Receiv_Date", DBNull.Value);

                    cmdUpdateCase.Parameters.AddWithValue("@IB_Form", caseDetail.IB_Form);
                    cmdUpdateCase.Parameters.AddWithValue("@IB_Form_File_Name", caseDetail.IB_Form_File_Name);
                    cmdUpdateCase.Parameters.AddWithValue("@IB_Form_Destination_File_Name", caseDetail.IB_Form_Destination_File_Name);
                    if (caseDetail.IB_ReceivedDate != null) cmdUpdateCase.Parameters.AddWithValue("@IB_Receiv_Date", caseDetail.IB_ReceivedDate);
                    else cmdUpdateCase.Parameters.AddWithValue("@IB_Receiv_Date", DBNull.Value);

                    cmdUpdateCase.Parameters.AddWithValue("@POP_Form", caseDetail.POP_Form);
                    cmdUpdateCase.Parameters.AddWithValue("@POP_Form_File_Name", caseDetail.POP_Form_File_Name);
                    cmdUpdateCase.Parameters.AddWithValue("@POP_Form_Destination_File_Name", caseDetail.POP_Form_Destionation_File_Name);
                    if (caseDetail.POP_ReceivedDate != null) cmdUpdateCase.Parameters.AddWithValue("@POP_Receiv_Date", caseDetail.POP_ReceivedDate);
                    else cmdUpdateCase.Parameters.AddWithValue("@POP_Receiv_Date", DBNull.Value);

                    cmdUpdateCase.Parameters.AddWithValue("@MedRec_Form", caseDetail.MedicalRecord_Form);
                    cmdUpdateCase.Parameters.AddWithValue("@MedRec_Form_File_Name", caseDetail.MedRec_Form_File_Name);
                    cmdUpdateCase.Parameters.AddWithValue("@MedRec_Form_Destination_File_Name", caseDetail.MedRec_Form_Destination_File_Name);
                    if (caseDetail.MedRec_ReceivedDate != null) cmdUpdateCase.Parameters.AddWithValue("@MedRec_Receiv_Date", caseDetail.MedRec_ReceivedDate);
                    else cmdUpdateCase.Parameters.AddWithValue("@MedRec_Receiv_Date", DBNull.Value);

                    cmdUpdateCase.Parameters.AddWithValue("@Unknown_Form", caseDetail.Unknown_Form);
                    cmdUpdateCase.Parameters.AddWithValue("@Unknown_Form_File_Name", caseDetail.Unknown_Form_File_Name);
                    cmdUpdateCase.Parameters.AddWithValue("@Unknown_Form_Destination_File_Name", caseDetail.Unknown_Form_Destination_File_Name);
                    if (caseDetail.Unknown_ReceivedDate != null) cmdUpdateCase.Parameters.AddWithValue("@Unknown_Receiv_Date", caseDetail.Unknown_ReceivedDate);
                    else cmdUpdateCase.Parameters.AddWithValue("@Unknown_Receiv_Date", DBNull.Value);

                    cmdUpdateCase.Parameters.AddWithValue("@CaseNote", caseDetail.Note);
                    cmdUpdateCase.Parameters.AddWithValue("@Log_Id", caseDetail.Log_Id);
                    cmdUpdateCase.Parameters.AddWithValue("@AddBill_Form", caseDetail.AddBill_Form);
                    if (caseDetail.AddBill_Received_Date != null) cmdUpdateCase.Parameters.AddWithValue("@AddBill_Receiv_Date", caseDetail.AddBill_Received_Date);
                    else cmdUpdateCase.Parameters.AddWithValue("@AddBill_Receiv_Date", DBNull.Value);

                    cmdUpdateCase.Parameters.AddWithValue("@Remove_Log", caseDetail.Remove_Log);
                    cmdUpdateCase.Parameters.AddWithValue("@CaseStatus", caseDetail.Status);

                    cmdUpdateCase.Parameters.AddWithValue("@Case_Id", caseDetail.CaseId);

                    if (connRN4.State != ConnectionState.Closed)
                    {
                        connRN4.Close();
                        connRN4.Open();
                    }
                    else if (connRN4.State == ConnectionState.Closed) connRN4.Open();
                    int nRowAffected = cmdUpdateCase.ExecuteNonQuery();
                    if (connRN4.State != ConnectionState.Closed) connRN4.Close();

                    if (nRowAffected == 3)
                    {
                        MessageBox.Show("The change has been saved.", "Information");

                        btnNewMedBill_Case.Enabled = true;
                        btnEditMedBill.Enabled = true;
                        btnDeleteMedBill.Enabled = true;

                        // delete case in use row inserted when the row was edited
                        String strSqlDeleteCaseInUse = "delete from [dbo].[tbl_CaseInUse] " +
                                                       "where [dbo].[tbl_CaseInUse].[Case_Name] = @CaseName and [dbo].[tbl_CaseInUse].[EditingStaff] = @ModifyingStaff";

                        SqlCommand cmdDeleteCaseInUse = new SqlCommand(strSqlDeleteCaseInUse, connRN4);
                        cmdDeleteCaseInUse.CommandType = CommandType.Text;

                        cmdDeleteCaseInUse.Parameters.AddWithValue("@CaseName", caseDetail.CaseId);
                        cmdDeleteCaseInUse.Parameters.AddWithValue("@ModifyingStaff", nLoggedUserId);

                        if (connRN4.State != ConnectionState.Closed)
                        {
                            connRN4.Close();
                            connRN4.Open();
                        }
                        else if (connRN4.State == ConnectionState.Closed) connRN4.Open();
                        int nCaseInUseDeleted = cmdDeleteCaseInUse.ExecuteNonQuery();
                        //if (nCaseInUseDeleted == 0)
                        //{
                        //    MessageBox.Show("Case in use: " + caseDetail.CaseId + " has not been deleted form tbl_CaseInUse table.", "Error");
                        //}

                        if (connRN4.State != ConnectionState.Closed) connRN4.Close();
                    }
                    else if (nRowAffected == 0) MessageBox.Show("Update failed", "Error");
                }
                else
                {
                    return;
                }
            }

            Cursor.Current = Cursors.Default;
        }

        private void btnNPFFormUpload_Click(object sender, EventArgs e)
        {
            OpenFileDialog OpenSourceFileDlg = new OpenFileDialog();

            OpenSourceFileDlg.Filter = "PDF Files | *.pdf; | JPG Files | *.jpg; *.jpeg";
            OpenSourceFileDlg.DefaultExt = "pdf";
            OpenSourceFileDlg.RestoreDirectory = true;

            if (OpenSourceFileDlg.ShowDialog() == DialogResult.OK)
            {
                strNPFormFilePathSource = OpenSourceFileDlg.FileName;
                strNPFormFilePathDestination = strDestinationPath + "_NPF_" + DateTime.Now.ToString("MM-dd-yyyy-HH-mm-ss") + "_" + OpenSourceFileDlg.SafeFileName;
                txtNPFFormFilePath.Text = strNPFormFilePathDestination;
                //btnNPFFormUpload.Enabled = true;
                //return;
            }
            else return;

            try
            {
                //File.Copy(txtNPFFormFilePath.Text.Trim(), strNPFormFilePathDestination);
                File.Copy(strNPFormFilePathSource, strNPFormFilePathDestination);
                chkNPF_CaseCreationPage.Checked = true;
            }
            catch (UnauthorizedAccessException ex)
            {
                MessageBox.Show(ex.Message, "Error");
                return;
            }
            catch (ArgumentNullException ex)
            {
                MessageBox.Show(ex.Message + "\n Please change the source file name.", "Error");
                return;
            }
            catch (Exception ex)
            {
                MessageBox.Show(ex.Message, "Error");
                return;
            }

            btnNPFFormView.Enabled = true;
            btnNPFFormDelete.Enabled = true;
        }

        //private void btnBrowseNPTForm_Click(object sender, EventArgs e)
        //{
        //    OpenFileDialog OpenSourceFileDlg = new OpenFileDialog();

        //    OpenSourceFileDlg.Filter = "JPG Files | *.jpg; *.jpeg | PDF Files | *.pdf";
        //    OpenSourceFileDlg.DefaultExt = "jpg";
        //    OpenSourceFileDlg.RestoreDirectory = true;

        //    if (OpenSourceFileDlg.ShowDialog() == DialogResult.OK)
        //    {
        //        strNPFormFilePathSource = OpenSourceFileDlg.FileName;
        //        strNPFormFilePathDestination = strDestinationPath + OpenSourceFileDlg.SafeFileName;
        //        txtNPFFormFilePath.Text = strNPFormFilePathSource;
        //        return;
        //    }
        //    else return;
        //}

        private void btnNPFFormView_Click(object sender, EventArgs e)
        {
            if (strNPFormFilePathDestination != String.Empty)
            {
                try
                {
                    ProcessStartInfo processInfo = new ProcessStartInfo();
                    processInfo.FileName = strNPFormFilePathDestination;
                    Process.Start(processInfo);
                }
                catch (Exception ex)
                {
                    MessageBox.Show(ex.Message, "Error");
                    return;
                }
            }
            else
            {
                MessageBox.Show("No NPF is uploaded");
                return;
            }
        }

        private void btnNPFFormDelete_Click(object sender, EventArgs e)
        {
            DialogResult dlgResult = MessageBox.Show("Are you sure to delete the NPF form?", "Warning", MessageBoxButtons.YesNo);

            if (dlgResult == DialogResult.Yes)
            {
                try
                {
                    File.Delete(strNPFormFilePathDestination);
                }
                catch (Exception ex)
                {
                    MessageBox.Show(ex.Message, "Error");
                    return;
                }
                chkNPF_CaseCreationPage.Checked = false;
                txtNPFFormFilePath.Text = String.Empty;
                //btnBrowseNPF.Enabled = false;
                btnNPFFormUpload.Enabled = false;
                //txtNPFUploadDate.Text = String.Empty;
                btnNPFFormView.Enabled = false;
                btnNPFFormDelete.Enabled = false;

                MessageBox.Show("The NPF form has been deleted.", "Information");
            }
        }

        private void btnBrowseIB_Click(object sender, EventArgs e)
        {
            OpenFileDialog OpenSourceFileDlg = new OpenFileDialog();

            OpenSourceFileDlg.Filter = "PDF Files | *.pdf; | JPG Files | *.jpg; *.jpeg";
            OpenSourceFileDlg.DefaultExt = "pdf";
            OpenSourceFileDlg.RestoreDirectory = true;

            if (OpenSourceFileDlg.ShowDialog() == DialogResult.OK)
            {
                strIBFilePathSource = OpenSourceFileDlg.FileName;
                strIBFilePathDestination = strDestinationPath + "_IB_" + DateTime.Now.ToString("MM-dd-yyyy-HH-mm-ss") + "_" + OpenSourceFileDlg.SafeFileName;
                txtIBFilePath.Text = strIBFilePathSource;
                btnIBUpload.Enabled = true;
                return;
            }
            else return;
        }

        private void btnIBDateUpload_Click(object sender, EventArgs e)
        {
            OpenFileDialog OpenSourceFileDlg = new OpenFileDialog();

            OpenSourceFileDlg.Filter = "PDF Files | *.pdf; | JPG Files | *.jpg; *.jpeg";
            OpenSourceFileDlg.DefaultExt = "pdf";
            OpenSourceFileDlg.RestoreDirectory = true;

            if (OpenSourceFileDlg.ShowDialog() == DialogResult.OK)
            {
                strIBFilePathSource = OpenSourceFileDlg.FileName;
                strIBFilePathDestination = strDestinationPath + "_IB_" + DateTime.Now.ToString("MM-dd-yyyy-HH-mm-ss") + "_" + OpenSourceFileDlg.SafeFileName;
                txtIBFilePath.Text = strIBFilePathDestination;
                //btnIBUpload.Enabled = true;
                //return;
            }
            else return;

            try
            {
                //File.Copy(txtIBFilePath.Text.Trim(), strIBFilePathDestination);
                File.Copy(strIBFilePathSource, strIBFilePathDestination);
                //txtIBUploadDate.Text = DateTime.Today.ToString("MM/dd/yyyy");
                chkIB_CaseCreationPage.Checked = true;
            }
            catch (UnauthorizedAccessException ex)
            {
                MessageBox.Show(ex.Message, "Error");
                return;
            }
            catch (ArgumentNullException ex)
            {
                MessageBox.Show(ex.Message + "\n Please change the source file name.", "Error");
                return;
            }
            catch (Exception ex)
            {
                MessageBox.Show(ex.Message, "Erro");
                return;
            }

            btnIBView.Enabled = true;
            btnDeleteIB.Enabled = true;
        }

        private void IBDateView_Click(object sender, EventArgs e)
        {
            if (strIBFilePathDestination != String.Empty)
            {
                try
                {
                    ProcessStartInfo processInfo = new ProcessStartInfo();
                    processInfo.FileName = strIBFilePathDestination;
                    Process.Start(processInfo);
                }
                catch (Exception ex)
                {
                    MessageBox.Show(ex.Message, "Error");
                    return;
                }
            }
            else
            {
                MessageBox.Show("No IB is uploaded");
                return;
            }
        }

        private void btnIBDateDelete_Click(object sender, EventArgs e)
        {
            DialogResult dlgResult = MessageBox.Show("Are you sure to delete the IB?", "Warning", MessageBoxButtons.YesNo);

            if (dlgResult == DialogResult.Yes)
            {
                try
                {
                    File.Delete(strIBFilePathDestination);
                }
                catch (Exception ex)
                {
                    MessageBox.Show(ex.Message, "Error");
                    return;
                }

                chkIB_CaseCreationPage.Checked = false;
                txtIBFilePath.Text = String.Empty;
                //btnBrowseIB.Enabled = false;
                btnIBUpload.Enabled = false;
                //txtIBUploadDate.Text = String.Empty;
                btnIBView.Enabled = false;
                btnDeleteIB.Enabled = false;

                MessageBox.Show("The IB has been deleted.", "Information");
            }
        }

        private void btnBrowsePoP_Click(object sender, EventArgs e)
        {
            OpenFileDialog OpenSourceFileDlg = new OpenFileDialog();

            OpenSourceFileDlg.Filter = "PDF Files | *.pdf; | JPG Files | *.jpg; *.jpeg";
            OpenSourceFileDlg.DefaultExt = "pdf";
            OpenSourceFileDlg.RestoreDirectory = true;

            if (OpenSourceFileDlg.ShowDialog() == DialogResult.OK)
            {
                strPoPFilePathSource = OpenSourceFileDlg.FileName;
                strPopFilePathDestination = strDestinationPath + "_PoP_" + DateTime.Now.ToString("MM-dd-yyyy-HH-mm-ss") + "_" + OpenSourceFileDlg.SafeFileName;
                txtPopFilePath.Text = strPoPFilePathSource;
                btnPoPUpload.Enabled = true;
                return;
            }
            else return;
        }

        private void btnPoPDateUpload_Click(object sender, EventArgs e)
        {
            OpenFileDialog OpenSourceFileDlg = new OpenFileDialog();

            OpenSourceFileDlg.Filter = "PDF Files | *.pdf; | JPG Files | *.jpg; *.jpeg";
            OpenSourceFileDlg.DefaultExt = "pdf";
            OpenSourceFileDlg.RestoreDirectory = true;

            if (OpenSourceFileDlg.ShowDialog() == DialogResult.OK)
            {
                strPoPFilePathSource = OpenSourceFileDlg.FileName;
                strPopFilePathDestination = strDestinationPath + "_PoP_" + DateTime.Now.ToString("MM-dd-yyyy-HH-mm-ss") + "_" + OpenSourceFileDlg.SafeFileName;
                txtPopFilePath.Text = strPopFilePathDestination;
                //btnPoPUpload.Enabled = true;
                //return;
            }
            else return;

            try
            {
                //File.Copy(txtPopFilePath.Text.Trim(), strPopFilePathDestination);
                File.Copy(strPoPFilePathSource, strPopFilePathDestination);
                //txtPoPUploadDate.Text = DateTime.Today.ToString("MM/dd/yyyy");
                chkPoP_CaseCreationPage.Checked = true;
            }
            catch (UnauthorizedAccessException ex)
            {
                MessageBox.Show(ex.Message, "Error");
                return;
            }
            catch (ArgumentNullException ex)
            {
                MessageBox.Show(ex.Message + "\n Please change the source file name.", "Error");
                return;
            }
            catch (Exception ex)
            {
                MessageBox.Show(ex.Message, "Error");
                return;
            }

            btnPoPView.Enabled = true;
            btnDeletePoP.Enabled = true;
        }

        private void btnPoPDateView_Click(object sender, EventArgs e)
        {
            if (strPopFilePathDestination != String.Empty)
            {
                try
                {
                    ProcessStartInfo processInfo = new ProcessStartInfo();
                    processInfo.FileName = strPopFilePathDestination;
                    Process.Start(processInfo);
                }
                catch (Exception ex)
                {
                    MessageBox.Show(ex.Message, "Error");
                    return;
                }
            }
            else
            {
                MessageBox.Show("No Pop is uploaded");
                return;
            }
        }

        private void btnPoPDateDelete_Click(object sender, EventArgs e)
        {

            DialogResult dlgResult = MessageBox.Show("Are you sure to delete the PoP?", "Warning", MessageBoxButtons.YesNo);

            if (dlgResult == DialogResult.Yes)
            {
                try
                {
                    File.Delete(strPopFilePathDestination);
                }
                catch (Exception ex)
                {
                    MessageBox.Show(ex.Message, "Error");
                    return;
                }

                chkPoP_CaseCreationPage.Checked = false;
                txtPopFilePath.Text = String.Empty;
                //btnBrowsePoP.Enabled = false;
                btnPoPUpload.Enabled = false;
                //txtPoPUploadDate.Text = String.Empty;
                btnPoPView.Enabled = false;
                btnDeletePoP.Enabled = false;

                MessageBox.Show("The PoP form has been deleted.", "Information");
            }
        }

        private void btnBrowseMR_Click(object sender, EventArgs e)
        {
            OpenFileDialog OpenSourceFileDlg = new OpenFileDialog();

            OpenSourceFileDlg.Filter = "PDF Files | *.pdf; | JPG Files | *.jpg; *.jpeg";
            OpenSourceFileDlg.DefaultExt = "pdf";
            OpenSourceFileDlg.RestoreDirectory = true;

            if (OpenSourceFileDlg.ShowDialog() == DialogResult.OK)
            {
                strMedRecordFilePathSource = OpenSourceFileDlg.FileName;
                strMedRecordFilePathDestination = strDestinationPath + "_MR_" + DateTime.Now.ToString("MM-dd-yyyy-HH-mm-ss") + "_" + OpenSourceFileDlg.SafeFileName;
                txtMedicalRecordFilePath.Text = strMedRecordFilePathSource;
                btnMedicalRecordUpload.Enabled = true;
                return;
            }
            else return;
        }

        private void btnMedicalRecordUpload_Click(object sender, EventArgs e)
        {
            OpenFileDialog OpenSourceFileDlg = new OpenFileDialog();

            OpenSourceFileDlg.Filter = "PDF Files | *.pdf; | JPG Files | *.jpg; *.jpeg";
            OpenSourceFileDlg.DefaultExt = "pdf";
            OpenSourceFileDlg.RestoreDirectory = true;

            if (OpenSourceFileDlg.ShowDialog() == DialogResult.OK)
            {
                strMedRecordFilePathSource = OpenSourceFileDlg.FileName;
                strMedRecordFilePathDestination = strDestinationPath + "_MR_" + DateTime.Now.ToString("MM-dd-yyyy-HH-mm-ss") + "_" + OpenSourceFileDlg.SafeFileName;
                txtMedicalRecordFilePath.Text = strMedRecordFilePathDestination;
                //btnMedicalRecordUpload.Enabled = true;
                //return;
            }
            else return;

            try
            {
                //File.Copy(txtMedicalRecordFilePath.Text.Trim(), strMedRecordFilePathDestination);
                File.Copy(strMedRecordFilePathSource, strMedRecordFilePathDestination);
                //txtMRUploadDate.Text = DateTime.Today.ToString("MM/dd/yyyy");
                chkMedicalRecordCaseCreationPage.Checked = true;
            }
            catch (UnauthorizedAccessException ex)
            {
                MessageBox.Show(ex.Message, "Error");
                return;
            }
            catch (ArgumentNullException ex)
            {
                MessageBox.Show(ex.Message + "\n Please change the source file name.", "Error");
                return;
            }
            catch (Exception ex)
            {
                MessageBox.Show(ex.Message, "Error");
                return;
            }

            btnMedicalRecordView.Enabled = true;
            btnDeleteMedicalRecord.Enabled = true;

        }

        private void btnMedicalRecordView_Click(object sender, EventArgs e)
        {
            if (strMedRecordFilePathDestination != String.Empty)
            {
                try
                {
                    ProcessStartInfo processInfo = new ProcessStartInfo();
                    processInfo.FileName = strMedRecordFilePathDestination;
                    Process.Start(processInfo);
                }
                catch (Exception ex)
                {
                    MessageBox.Show(ex.Message, "Error");
                    return;
                }
            }
            else
            {
                MessageBox.Show("No Medical Record is uploaded");
                return;
            }
        }

        private void btnMedicalRecordDelete_Click(object sender, EventArgs e)
        {

            DialogResult dlgResult = MessageBox.Show("Are you sure to delete Medical Record form?", "Warning", MessageBoxButtons.YesNo);

            if (dlgResult == DialogResult.Yes)
            {
                try
                {
                    File.Delete(strMedRecordFilePathDestination);
                }
                catch (Exception ex)
                {
                    MessageBox.Show(ex.Message, "Error");
                    return;
                }

                chkMedicalRecordCaseCreationPage.Checked = false;
                txtMedicalRecordFilePath.Text = String.Empty;
                //btnBrowseMR.Enabled = false;
                btnMedicalRecordUpload.Enabled = false;
                //txtMRUploadDate.Text = String.Empty;
                btnMedicalRecordView.Enabled = false;
                btnDeleteMedicalRecord.Enabled = false;

                MessageBox.Show("The Medical Record form has been deleted.", "Information");
            }
        }

        private void btnBrowseUnknownDoc_Click(object sender, EventArgs e)
        {
            OpenFileDialog OpenSourceFileDlg = new OpenFileDialog();

            OpenSourceFileDlg.Filter = "PDF Files | *.pdf; | JPG Files | *.jpg; *.jpeg";
            OpenSourceFileDlg.DefaultExt = "pdf";
            OpenSourceFileDlg.RestoreDirectory = true;

            if (OpenSourceFileDlg.ShowDialog() == DialogResult.OK)
            {
                strUnknownDocFilePathSource = OpenSourceFileDlg.FileName;
                strUnknownDocFilePathDestination = strDestinationPath + "_Unknown_" + DateTime.Now.ToString("MM-dd-yyyy-HH-mm-ss") + "_" + OpenSourceFileDlg.SafeFileName;
                txtOtherDocumentFilePath.Text = strUnknownDocFilePathSource;
                btnUnknownDocUpload.Enabled = true;
                return;
            }
            else return;
        }

        private void btnUnknownUpload_Click(object sender, EventArgs e)
        {
            OpenFileDialog OpenSourceFileDlg = new OpenFileDialog();

            OpenSourceFileDlg.Filter = "PDF Files | *.pdf; | JPG Files | *.jpg; *.jpeg";
            OpenSourceFileDlg.DefaultExt = "pdf";
            OpenSourceFileDlg.RestoreDirectory = true;

            if (OpenSourceFileDlg.ShowDialog() == DialogResult.OK)
            {
                strUnknownDocFilePathSource = OpenSourceFileDlg.FileName;
                strUnknownDocFilePathDestination = strDestinationPath + "_Unknown_" + DateTime.Now.ToString("MM-dd-yyyy-HH-mm-ss") + "_" + OpenSourceFileDlg.SafeFileName;
                txtOtherDocumentFilePath.Text = strUnknownDocFilePathDestination;
                //btnUnknownDocUpload.Enabled = true;
                //return;
            }
            else return;

            try
            {
                //File.Copy(txtOtherDocumentFilePath.Text.Trim(), strUnknownDocFilePathDestination);
                File.Copy(strUnknownDocFilePathSource, strUnknownDocFilePathDestination);
                //txtOtherDocUploadDate.Text = DateTime.Today.ToString("MM/dd/yyyy");
                chkOtherDocCaseCreationPage.Checked = true;
            }
            catch (UnauthorizedAccessException ex)
            {
                MessageBox.Show(ex.Message, "Error");
                return;
            }
            catch (ArgumentNullException ex)
            {
                MessageBox.Show(ex.Message + "\n Please change the source file name.", "Error");
                return;
            }
            catch (Exception ex)
            {
                MessageBox.Show(ex.Message, "Error");
                return;
            }

            btnOtherDocView.Enabled = true;
            btnDeleteUnknownDoc.Enabled = true;
        }

        private void btnUnknownView_Click(object sender, EventArgs e)
        {
            if (strUnknownDocFilePathDestination != String.Empty)
            {
                try
                {
                    ProcessStartInfo processInfo = new ProcessStartInfo();
                    processInfo.FileName = strUnknownDocFilePathDestination;
                    Process.Start(processInfo);
                }
                catch (Exception ex)
                {
                    MessageBox.Show(ex.Message, "Error");
                    return;
                }
            }
            else
            {
                MessageBox.Show("No Unknown doc is uploaded");
                return;
            }
        }

        private void btnUnknownDelete_Click(object sender, EventArgs e)
        {

            DialogResult dlgResult = MessageBox.Show("Are you sure to delete the Unknown form?", "Warning", MessageBoxButtons.YesNo);

            if (dlgResult == DialogResult.Yes)
            {
                try
                {
                    File.Delete(strUnknownDocFilePathDestination);
                }
                catch (Exception ex)
                {
                    MessageBox.Show(ex.Message, "Error");
                    return;
                }

                chkOtherDocCaseCreationPage.Checked = false;
                txtOtherDocumentFilePath.Text = String.Empty;
                //btnBrowseUnknownDoc.Enabled = false;
                btnUnknownDocUpload.Enabled = false;
                //txtOtherDocUploadDate.Text = String.Empty;
                btnOtherDocView.Enabled = false;
                btnDeleteUnknownDoc.Enabled = false;

                MessageBox.Show("The Unknown form has been deleted.", "Information");
            }
        }

        private void btnAddNewMedBill_Click(object sender, EventArgs e)
        {

            //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
            //
            // Medical Bill creation page
            //
            //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

            String strSqlQueryForIndivdiualInfo = "select individual_id__c, name, birthdate, SOCIAL_SECURITY_NUMBER__C, MAILINGSTREET, MAILINGCITY, MAILINGSTATE, MAILINGPOSTALCODE " +
                                                "from dbo.contact where INDIVIDUAL_ID__C = @IndividualId";

            SqlCommand cmdQueryForIndividualInfo = new SqlCommand(strSqlQueryForIndivdiualInfo, connSalesforce);
            cmdQueryForIndividualInfo.Parameters.AddWithValue("@IndividualId", strIndividualId);

            if (connSalesforce.State == ConnectionState.Open)
            {
                connSalesforce.Close();
                connSalesforce.Open();
            }
            else if (connSalesforce.State == ConnectionState.Closed) connSalesforce.Open();

            SqlDataReader rdrIndividualInSalesforce = cmdQueryForIndividualInfo.ExecuteReader();
            if (rdrIndividualInSalesforce.HasRows)
            {
                rdrIndividualInSalesforce.Read();
                txtIndividualIDMedBill.Text = rdrIndividualInSalesforce.GetString(0);
                txtPatientNameMedBill.Text = rdrIndividualInSalesforce.GetString(1);
                txtMedBillDOB.Text = rdrIndividualInSalesforce.GetDateTime(2).ToString("MM/dd/yyyy");
                txtMedBillSSN.Text = rdrIndividualInSalesforce.GetString(3);
                txtMedBillAddress.Text = rdrIndividualInSalesforce.GetString(4) + ", " + rdrIndividualInSalesforce.GetString(5) + ", " + rdrIndividualInSalesforce.GetString(6) + " " +
                                                 rdrIndividualInSalesforce.GetDouble(7).ToString();
            }
            rdrIndividualInSalesforce.Close();
            if (connSalesforce.State == ConnectionState.Open) connSalesforce.Close();

            String strSqlQueryForCaseId = "select distinct dbo.tbl_incident.Case_Id from dbo.tbl_incident where dbo.tbl_incident.Individual_id = @IndividualId";

            SqlCommand cmdQueryForCaseId = new SqlCommand(strSqlQueryForCaseId, connRN);
            cmdQueryForCaseId.Parameters.AddWithValue("@IndividualId", strIndividualId);

            cmdQueryForCaseId.CommandType = CommandType.Text;
            cmdQueryForCaseId.CommandText = strSqlQueryForCaseId;

            //if (connRN.State == ConnectionState.Closed) connRN.Open();
            if (connRN.State != ConnectionState.Closed)
            {
                connRN.Close();
                connRN.Open();
            }
            else if (connRN.State == ConnectionState.Closed) connRN.Open();
            SqlDataReader rdrIncidentForCaseId = cmdQueryForCaseId.ExecuteReader();

            if (rdrIncidentForCaseId.HasRows)
            {
                while (rdrIncidentForCaseId.Read())
                {
                    txtMedBill_CaseNo.Text = rdrIncidentForCaseId.GetString(0);
                }
            }
            rdrIncidentForCaseId.Close();
            if (connRN.State != ConnectionState.Closed) connRN.Close();

            String strSqlQueryForDiseaseName = "select [dbo].[ICD10 Code].Name from [dbo].[ICD10 Code] where ICD10_CODE__C = @ICD10Code";

            SqlCommand cmdQueryForDiseaseName = new SqlCommand(strSqlQueryForDiseaseName, connSalesforce);
            cmdQueryForDiseaseName.Parameters.AddWithValue("@ICD10Code", txtMedBill_ICD10Code.Text.Trim());

            cmdQueryForDiseaseName.CommandType = CommandType.Text;
            cmdQueryForDiseaseName.CommandText = strSqlQueryForDiseaseName;

            if (connSalesforce.State == ConnectionState.Open)
            {
                connSalesforce.Close();
                connSalesforce.Open();
            }
            else if (connSalesforce.State == ConnectionState.Closed) connSalesforce.Open();
            SqlDataReader rdrDiseaseName = cmdQueryForDiseaseName.ExecuteReader();
            if (rdrDiseaseName.HasRows)
            {
                rdrDiseaseName.Read();
                txtMedBillDiseaseName.Text = rdrDiseaseName.GetString(0);
            }
            rdrDiseaseName.Close();
            if (connSalesforce.State == ConnectionState.Open) connSalesforce.Close();

            tbCMMManager.TabPages.Insert(4, tbpgMedicalBill);
            tbCMMManager.SelectedIndex = 4;

        }

        private void btnAddNewIllness_Click(object sender, EventArgs e)
        {
            frmIllnessCreationPage frmIllness = new frmIllnessCreationPage();

            frmIllness.txtIndividualNo.Text = txtIndividualID.Text;
            frmIllness.mode = IllnessMode.AddNew;

            frmIllness.ShowDialog(this);
        }

        private void gvCaseViewCaseHistory_CellDoubleClick(object sender, DataGridViewCellEventArgs e)
        {

            if (e.RowIndex <= -1)
            {
                return;
            }

            DataGridView gvCaseHistory = (DataGridView)sender;

            int nRowSelected;

            strIndividualId = txtIndividualID.Text.Trim();

            //String strCaseNameSelected = String.Empty;
            String strPatientLastName = txtLastName.Text.Trim();
            String strPatientFirstName = txtFirstName.Text.Trim();
            String strPatientMiddleName = txtMiddleName.Text.Trim();
            String strDateOfBirth = dtpBirthDate.Value.ToString("MM/dd/yyyy");
            String strSSN = txtIndividualSSN.Text.Trim();
            String strStreetAddr = txtStreetAddress1.Text.Trim();
            String strCity = txtCity1.Text.Trim();
            String strState = txtState1.Text.Trim();
            String strZip = txtZip1.Text.Trim();

            String strSqlQueryForCaseStatus = "select [dbo].[tbl_case_status_code].[CaseStatusValue] from [dbo].[tbl_case_status_code]";
            SqlCommand cmdQueryForCaseStatus = new SqlCommand(strSqlQueryForCaseStatus, connRN3);
            cmdQueryForCaseStatus.CommandType = CommandType.Text;

            if (connRN3.State != ConnectionState.Closed)
            {
                connRN3.Close();
                connRN3.Open();
            }
            else if (connRN3.State == ConnectionState.Closed) connRN3.Open();

            SqlDataReader rdrCaseStatus = cmdQueryForCaseStatus.ExecuteReader();
            cbCaseStatus.Items.Clear();
            if (rdrCaseStatus.HasRows)
            {
                while (rdrCaseStatus.Read())
                {
                    cbCaseStatus.Items.Add(rdrCaseStatus.GetString(0));
                }
            }
            rdrCaseStatus.Close();
            if (connRN3.State != ConnectionState.Closed) connRN3.Close();

            Boolean bCaseInUse = false;

            if (gvCaseHistory.Rows.Count > 0)
            {
                nRowSelected = e.RowIndex;

                strCaseNameSelected = gvCaseHistory["CaseName", nRowSelected].Value.ToString();
                CaseIdForCasePageMedBill = strCaseNameSelected;

                String strSqlQueryForCaseInUse = "select [dbo].[tbl_CaseInUse].[Case_Name], [dbo].[tbl_CaseInUse].[EditingStaff] from [dbo].[tbl_CaseInUse] " +
                                 "where [dbo].[tbl_CaseInUse].[Case_Name] = @CaseInUse";

                SqlCommand cmdCaseInUse = new SqlCommand(strSqlQueryForCaseInUse, connRN2);
                cmdCaseInUse.CommandType = CommandType.Text;

                cmdCaseInUse.Parameters.AddWithValue("@CaseInUse", strCaseNameSelected);

                if (connRN2.State != ConnectionState.Closed)
                {
                    connRN2.Close();
                    connRN2.Open();
                }
                else if (connRN2.State == ConnectionState.Closed) connRN2.Open();
                SqlDataReader rdrCaseInUse = cmdCaseInUse.ExecuteReader();
                if (rdrCaseInUse.HasRows)
                {
                    rdrCaseInUse.Read();
                    if (strCaseNameSelected == rdrCaseInUse.GetString(0).Trim() &&
                        nLoggedUserId != rdrCaseInUse.GetInt16(1))
                    {
                        MessageBox.Show("The Case: " + strCaseNameSelected + " is in use.", "Alert");
                        rdrCaseInUse.Close();
                        if (connRN2.State != ConnectionState.Closed) connRN2.Close();
                        bCaseInUse = true;
                        //return;
                    }
                }
                else
                {
                    rdrCaseInUse.Close();
                    if (connRN2.State != ConnectionState.Closed) connRN2.Close();

                    String strSqlInsertCaseInUse = "insert into [dbo].[tbl_CaseInUse] (Case_Name, EditingStaff) values (@CaseNO, @EditingStaff)";

                    SqlCommand cmdInsertCaseInUse = new SqlCommand(strSqlInsertCaseInUse, connRN2);
                    cmdInsertCaseInUse.CommandType = CommandType.Text;

                    cmdInsertCaseInUse.Parameters.AddWithValue("@CaseNo", strCaseNameSelected);
                    cmdInsertCaseInUse.Parameters.AddWithValue("@EditingStaff", nLoggedUserId);

                    if (connRN2.State != ConnectionState.Closed)
                    {
                        connRN2.Close();
                        connRN2.Open();
                    }
                    else if (connRN2.State == ConnectionState.Closed) connRN2.Open();
                    int nCaseInUserInserted = cmdInsertCaseInUse.ExecuteNonQuery();
                    if (nCaseInUserInserted != 1)
                    {
                        MessageBox.Show("Case in use: " + strCaseNameSelected + " has not been inserted.", "Error");
                        if (connRN2.State != ConnectionState.Closed) connRN2.Close();
                        return;
                    }
                    if (connRN2.State != ConnectionState.Closed) connRN2.Close();
                }

                String strSqlQueryForCase = "select [dbo].[tbl_case].[NPF_Form], [dbo].[tbl_case].[NPF_Form_File_Name], [dbo].[tbl_case].[NPF_Form_Destination_File_Name], [dbo].[tbl_case].[NPF_Receiv_Date], " +
                                            "[dbo].[tbl_case].[IB_Form], [dbo].[tbl_case].[IB_Form_File_Name], [dbo].[tbl_case].[IB_Form_Destination_File_Name], [dbo].[tbl_case].[IB_Receiv_Date], " +
                                            "[dbo].[tbl_case].[POP_Form], [dbo].[tbl_case].[POP_Form_File_Name], [dbo].[tbl_case].[POP_Form_Destination_File_Name], [dbo].[tbl_case].[POP_Receiv_Date], " +
                                            "[dbo].[tbl_case].[MedRec_Form], [dbo].[tbl_case].[MedRec_Form_File_Name], " +
                                            "[dbo].[tbl_case].[MedRec_Form_Destination_File_Name], [dbo].[tbl_case].[MedRec_Receiv_Date], " +
                                            "[dbo].[tbl_case].[Unknown_Form], [dbo].[tbl_case].[Unknown_Form_File_Name], [dbo].[tbl_case].[Unknown_Form_Destination_File_Name], " +
                                            "[dbo].[tbl_case].[Unknown_Receiv_Date], [dbo].[tbl_case].[Case_status], [dbo].[tbl_case].[Note] " +
                                            "from [dbo].[tbl_case] " +
                                            "where [dbo].[tbl_case].[IsDeleted] = 0 and " +
                                            "[dbo].[tbl_case].[Case_Name] = @CaseName and " +
                                            "[dbo].[tbl_case].[Contact_ID] = @IndividualId";

                SqlCommand cmdQueryForCase = new SqlCommand(strSqlQueryForCase, connRN3);
                cmdQueryForCase.CommandType = CommandType.Text;

                cmdQueryForCase.Parameters.AddWithValue("@CaseName", strCaseNameSelected);
                cmdQueryForCase.Parameters.AddWithValue("@IndividualId", strIndividualId);

                //if (connRN.State == ConnectionState.Closed) connRN.Open();
                if (connRN3.State != ConnectionState.Closed)
                {
                    connRN3.Close();
                    connRN3.Open();
                }
                else if (connRN3.State == ConnectionState.Closed) connRN3.Open();
                SqlDataReader rdrCase = cmdQueryForCase.ExecuteReader();
                if (rdrCase.HasRows)
                {
                    txtCaseName.Text = strCaseNameSelected;
                    txtCaseIndividualID.Text = strIndividualId;
                    txtCreateCaseIndividualName.Text = strPatientLastName + ", " + strPatientFirstName + " " + strPatientMiddleName;

                    if (rdrCase.Read())
                    {
                        if (rdrCase.GetBoolean(0) == true) chkNPF_CaseCreationPage.Checked = true;
                        if (!rdrCase.IsDBNull(1)) strNPFormFilePathSource = rdrCase.GetString(1);
                        if (!rdrCase.IsDBNull(2))
                        {
                            strNPFormFilePathDestination = rdrCase.GetString(2);
                            txtNPFFormFilePath.Text = strNPFormFilePathDestination;
                            if (strNPFormFilePathDestination != String.Empty)
                            {
                                btnNPFFormView.Enabled = true;
                                btnNPFFormDelete.Enabled = true;
                            }
                        }
                        if (!rdrCase.IsDBNull(3))
                        {
                            dtpNPFReceivedDate.Checked = true;
                            dtpNPFReceivedDate.Value = rdrCase.GetDateTime(3);
                            dtpNPFReceivedDate.Text = rdrCase.GetDateTime(3).ToString("MM/dd/yyyy");
                        }
                        //txtNPFUploadDate.Text = rdrCase.GetDateTime(3).ToString("MM/dd/yyyy");
                        if (rdrCase.GetBoolean(4) == true) chkIB_CaseCreationPage.Checked = true;
                        if (!rdrCase.IsDBNull(5)) strIBFilePathSource = rdrCase.GetString(5);
                        if (!rdrCase.IsDBNull(6))
                        {
                            strIBFilePathDestination = rdrCase.GetString(6);
                            txtIBFilePath.Text = strIBFilePathDestination;
                            if (strIBFilePathDestination != String.Empty)
                            {
                                btnIBView.Enabled = true;
                                btnDeleteIB.Enabled = true;
                            }
                        }
                        if (!rdrCase.IsDBNull(7))
                        {
                            dtpIBReceivedDate.Checked = true;
                            dtpIBReceivedDate.Value = rdrCase.GetDateTime(7);
                            dtpIBReceivedDate.Text = rdrCase.GetDateTime(7).ToString("MM/dd/yyyy");
                        }
                        //txtIBUploadDate.Text = rdrCase.GetDateTime(7).ToString("MM/dd/yyyy");
                        if (rdrCase.GetBoolean(8) == true) chkPoP_CaseCreationPage.Checked = true;
                        if (!rdrCase.IsDBNull(9)) strPoPFilePathSource = rdrCase.GetString(9);
                        if (!rdrCase.IsDBNull(10))
                        {
                            strPopFilePathDestination = rdrCase.GetString(10);
                            txtPopFilePath.Text = strPopFilePathDestination;
                            if (strPopFilePathDestination != String.Empty)
                            {
                                btnPoPView.Enabled = true;
                                btnDeletePoP.Enabled = true;
                            }
                        }
                        if (!rdrCase.IsDBNull(11))
                        {
                            dtpPoPReceivedDate.Checked = true;
                            dtpPoPReceivedDate.Value = rdrCase.GetDateTime(11);
                            dtpPoPReceivedDate.Text = rdrCase.GetDateTime(11).ToString("MM/dd/yyyy");
                        }
                        //txtPoPUploadDate.Text = rdrCase.GetDateTime(11).ToString("MM/dd/yyyy");
                        if (rdrCase.GetBoolean(12) == true) chkMedicalRecordCaseCreationPage.Checked = true;
                        if (!rdrCase.IsDBNull(13)) strMedRecordFilePathSource = rdrCase.GetString(13);
                        if (!rdrCase.IsDBNull(14))
                        {
                            strMedRecordFilePathDestination = rdrCase.GetString(14);
                            txtMedicalRecordFilePath.Text = strMedRecordFilePathDestination;
                            if (strMedicalRecordFileName != String.Empty)
                            {
                                btnMedicalRecordView.Enabled = true;
                                btnDeleteMedicalRecord.Enabled = true;
                            }
                        }
                        if (!rdrCase.IsDBNull(15))
                        {
                            dtpMRReceivedDate.Checked = true;
                            dtpMRReceivedDate.Value = rdrCase.GetDateTime(15);
                            dtpMRReceivedDate.Text = rdrCase.GetDateTime(15).ToString("MM/dd/yyyy");
                        }
                        //txtMRUploadDate.Text = rdrCase.GetDateTime(15).ToString("MM/dd/yyyy");
                        if (rdrCase.GetBoolean(16) == true) chkOtherDocCaseCreationPage.Checked = true;
                        if (!rdrCase.IsDBNull(17)) txtOtherDocumentFilePath.Text = rdrCase.GetString(17);
                        if (!rdrCase.IsDBNull(18))
                        {
                            strUnknownDocFilePathDestination = rdrCase.GetString(18);
                            if (strUnknownDocFilePathDestination != String.Empty)
                            {
                                btnOtherDocView.Enabled = true;
                                btnDeleteUnknownDoc.Enabled = true;
                            }
                        }
                        if (!rdrCase.IsDBNull(19))
                        {
                            dtpOtherDocReceivedDate.Checked = true;
                            dtpOtherDocReceivedDate.Value = rdrCase.GetDateTime(19);
                            dtpOtherDocReceivedDate.Text = rdrCase.GetDateTime(19).ToString("MM/dd/yyyy");
                        }
                        //txtOtherDocUploadDate.Text = rdrCase.GetDateTime(19).ToString("MM/dd/yyyy");
                        //if (rdrCase.GetBoolean(20) == true) txtCaseStatus.Text = "Complete and Ready";
                        //else txtCaseStatus.Text = "Pending - Additional Documents required";
                        if (!rdrCase.IsDBNull(20))
                        {
                            switch (rdrCase.GetInt16(20))
                            {
                                case (int)CaseStatus.OnGoing:
                                    cbCaseStatus.SelectedIndex = (int)CaseStatus.OnGoing;
                                    cbCaseStatus.Enabled = true;
                                    break;
                                case (int)CaseStatus.Processing:
                                    cbCaseStatus.SelectedIndex = (int)CaseStatus.Processing;
                                    cbCaseStatus.Enabled = true;
                                    break;
                                case (int)CaseStatus.Closed:
                                    cbCaseStatus.SelectedIndex = (int)CaseStatus.Closed;
                                    cbCaseStatus.Enabled = true;
                                    break;
                            }
                        }
                        if (!rdrCase.IsDBNull(21)) txtNoteOnCase.Text = rdrCase.GetString(21);
                    }

                }
                rdrCase.Close();
                if (connRN3.State != ConnectionState.Closed) connRN3.Close();

                /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                // Med bills in Case Page

                String strSqlQueryForMedBillInCase = "select [dbo].[tbl_medbill].[BillNo], [dbo].[tbl_medbill_type].[MedBillTypeName], [dbo].[tbl_medbill].[CreatedDate], " +
                                                        "[dbo].[tbl_CreateStaff].[Staff_Name], " +
                                                        "[dbo].[tbl_medbill].[LastModifiedDate], [dbo].[tbl_ModifiStaff].[Staff_Name], " +
                                                        "[dbo].[tbl_medbill].[BillAmount], [dbo].[tbl_medbill].[SettlementTotal], [dbo].[tbl_medbill].[TotalSharedAmount], " +
                                                        "[dbo].[tbl_medbill].[Balance] " +
                                                        "from ((([dbo].[tbl_medbill] inner join [dbo].[tbl_medbill_type] on [dbo].[tbl_medbill].[MedBillType_Id] = [dbo].[tbl_medbill_type].[MedBillTypeId]) " +
                                                        "inner join [dbo].[tbl_CreateStaff] on [dbo].[tbl_medbill].[CreatedById] = [dbo].[tbl_CreateStaff].[CreateStaff_Id]) " +
                                                        "inner join [dbo].[tbl_ModifiStaff] on [dbo].[tbl_medbill].[LastModifiedById] = [dbo].[tbl_ModifiStaff].[ModifiStaff_Id]) " +
                                                        "where [dbo].[tbl_medbill].[Case_Id] = @CaseName and " +
                                                        "[dbo].[tbl_medbill].[Contact_Id] = @IndividualId and " +
                                                        "[dbo].[tbl_medbill].[IsDeleted] = 0";

                SqlCommand cmdQueryForMedBillInCase = new SqlCommand(strSqlQueryForMedBillInCase, connRN3);
                cmdQueryForMedBillInCase.CommandType = CommandType.Text;

                cmdQueryForMedBillInCase.Parameters.AddWithValue("@CaseName", strCaseNameSelected);
                cmdQueryForMedBillInCase.Parameters.AddWithValue("@IndividualId", strIndividualId);

                SqlDependency dependencyMedBillsInCase = new SqlDependency(cmdQueryForMedBillInCase);
                dependencyMedBillsInCase.OnChange += new OnChangeEventHandler(OnMedBillsInCaseViewChange);

                //if (connRN.State == ConnectionState.Closed) connRN.Open();
                if (connRN3.State != ConnectionState.Closed)
                {
                    connRN3.Close();
                    connRN3.Open();
                }
                else if (connRN3.State == ConnectionState.Closed) connRN3.Open();
                SqlDataReader rdrMedBillInCase = cmdQueryForMedBillInCase.ExecuteReader();
                gvCasePageMedBills.Rows.Clear();

                if (rdrMedBillInCase.HasRows)
                {
                    while (rdrMedBillInCase.Read())
                    {
                        DataGridViewRow row = new DataGridViewRow();

                        row.Cells.Add(new DataGridViewCheckBoxCell { Value = false });
                        row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillInCase.GetString(0) });
                        row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillInCase.GetString(1) });
                        row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillInCase.GetDateTime(2).ToString("MM/dd/yyyy") });
                        row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillInCase.GetDecimal(6).ToString("C") });
                        row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillInCase.GetDecimal(7).ToString("C") });
                        row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillInCase.GetDecimal(8).ToString("C") });
                        row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillInCase.GetDecimal(9).ToString("C") });
                        row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillInCase.GetString(3) });
                        row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillInCase.GetDateTime(4).ToString("MM/dd/yyyy") });
                        row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillInCase.GetString(5) });

                        gvCasePageMedBills.Rows.Add(row);
                        //AddNewRowToMedBillInCaseSafely(row);
                    }
                }
                rdrMedBillInCase.Close();
                if (connRN3.State != ConnectionState.Closed) connRN3.Close();

                /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                ///
                String strSqlQueryForTaskInCase = "select [dbo].[tbl_task].[whoid], [dbo].[tbl_task].[IndividualName], " +
                              "[dbo].[tbl_task_assigned_to].[User_Name], [dbo].[tbl_task].[whatid], " +
                              "[dbo].[tbl_task].[Subject], [dbo].[tbl_task].[DueDate], [dbo].[tbl_task_related_to_code].[TaskRelatedToValue], " +
                              "[dbo].[tbl_task].[CreateDate], [dbo].[tbl_task_created_by].[User_Name], [dbo].[tbl_task].[ActivityDate], " +
                              "[dbo].[tbl_task].[Comment], [dbo].[tbl_task].[Solution], " +
                              "[dbo].[tbl_task_status_code].[TaskStatusValue], [dbo].[tbl_task_priority_code].[TaskPriorityValue], " +
                              "[dbo].[tbl_task].[ReminderDateTime], [dbo].[tbl_task].[id] " +
                              "from [dbo].[tbl_task] " +
                              "inner join [dbo].[tbl_task_assigned_to] on [dbo].[tbl_task].[AssignedTo] = [dbo].[tbl_task_assigned_to].[User_Id] " +
                              "inner join [dbo].[tbl_task_related_to_code] on [dbo].[tbl_task].[RelatedToTableId] = [dbo].[tbl_task_related_to_code].[TaskRelatedToId] " +
                              "inner join [dbo].[tbl_task_created_by] on [dbo].[tbl_task].[CreatedById] = [dbo].[tbl_task_created_by].[User_Id] " +
                              "inner join [dbo].[tbl_task_status_code] on [dbo].[tbl_task].[Status] = [dbo].[tbl_task_status_code].[TaskStatusCode] " +
                              "inner join [dbo].[tbl_task_priority_code] on [dbo].[tbl_task].[Priority] = [dbo].[tbl_task_priority_code].[TaskPriorityCode] " +
                              "where [dbo].[tbl_task].[whatid] = @CaseNo";

                SqlCommand cmdQueryForTaskInCase = new SqlCommand(strSqlQueryForTaskInCase, connRN2);
                cmdQueryForTaskInCase.CommandType = CommandType.Text;

                cmdQueryForTaskInCase.Parameters.AddWithValue("@CaseNo", CaseIdForCasePageMedBill);

                SqlDependency dependencyTaskInCase = new SqlDependency(cmdQueryForTaskInCase);
                dependencyTaskInCase.OnChange += new OnChangeEventHandler(OnTaskInCaseChange);

                if (connRN2.State != ConnectionState.Closed)
                {
                    connRN2.Close();
                    connRN2.Open();
                }
                else if (connRN2.State == ConnectionState.Closed) connRN2.Open();
                gvTaskInCase.Rows.Clear();
                SqlDataReader rdrTaskInCase = cmdQueryForTaskInCase.ExecuteReader();
                if (rdrTaskInCase.HasRows)
                {
                    while (rdrTaskInCase.Read())
                    {
                        DataGridViewRow row = new DataGridViewRow();
                        if (!rdrTaskInCase.IsDBNull(0)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrTaskInCase.GetString(0) });
                        else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                        if (!rdrTaskInCase.IsDBNull(1)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrTaskInCase.GetString(1) });
                        else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                        if (!rdrTaskInCase.IsDBNull(2)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrTaskInCase.GetString(2) });
                        else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                        if (!rdrTaskInCase.IsDBNull(3)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrTaskInCase.GetString(3) });
                        else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                        if (!rdrTaskInCase.IsDBNull(4)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrTaskInCase.GetString(4) });
                        else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                        if (!rdrTaskInCase.IsDBNull(5)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrTaskInCase.GetDateTime(5).ToString("MM/dd/yyyy") });
                        else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                        if (!rdrTaskInCase.IsDBNull(6)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrTaskInCase.GetString(6) });
                        else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                        if (!rdrTaskInCase.IsDBNull(7)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrTaskInCase.GetDateTime(7).ToString("MM/dd/yyyy") });
                        else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                        if (!rdrTaskInCase.IsDBNull(8)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrTaskInCase.GetString(8) });
                        else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                        if (!rdrTaskInCase.IsDBNull(9)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrTaskInCase.GetDateTime(9).ToString("MM/dd/yyyy") });
                        else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                        if (!rdrTaskInCase.IsDBNull(10)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrTaskInCase.GetString(10) });
                        else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                        if (!rdrTaskInCase.IsDBNull(11)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrTaskInCase.GetString(11) });
                        else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                        if (!rdrTaskInCase.IsDBNull(12)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrTaskInCase.GetString(12) });
                        else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                        if (!rdrTaskInCase.IsDBNull(13)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrTaskInCase.GetString(13) });
                        else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                        if (!rdrTaskInCase.IsDBNull(14)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrTaskInCase.GetInt32(14) });
                        else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                        if (!rdrTaskInCase.IsDBNull(15)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrTaskInCase.GetInt32(15) });
                        else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });

                        gvTaskInCase.Rows.Add(row);
                    }
                }
                rdrTaskInCase.Close();
                if (connRN2.State != ConnectionState.Closed) connRN2.Close();
                ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                EnableCaseForm();

                btnNewMedBill_Case.Enabled = true;
                btnEditMedBill.Enabled = true;
                btnDeleteMedBill.Enabled = true;

                //tbCMMManager.TabPages.Insert(4, tbpgCreateCase);
                //tbCMMManager.SelectedIndex = 4;

                btnCaseCreationSaveUpper.Enabled = true;

                if (bCaseInUse)
                {
                    DisableCaseForm();

                    btnNPFFormView.Enabled = true;
                    btnIBView.Enabled = true;
                    btnPoPView.Enabled = true;
                    btnMedicalRecordView.Enabled = true;
                    btnOtherDocView.Enabled = true;

                    gvCasePageMedBills.Enabled = true;
                }

                //btnCaseCreationLowerSave.Enabled = true;

                tbCMMManager.SelectedTab = tbpgCreateCase;
            }
            //}
        }

        private void OnMedBillsInCaseViewChange(object sender, SqlNotificationEventArgs e)
        {
            if (e.Type == SqlNotificationType.Change)
            {
                SqlDependency dependency = sender as SqlDependency;
                dependency.OnChange -= OnMedBillsInCaseViewChange;

                UpdateGridViewMedBillsInCaseView();
            }
        }

        private void UpdateGridViewMedBillsInCaseView()
        {
            String strSqlQueryForMedBillInCase = "select [dbo].[tbl_medbill].[BillNo], [dbo].[tbl_medbill_type].[MedBillTypeName], [dbo].[tbl_medbill].[CreatedDate], [dbo].[tbl_CreateStaff].[Staff_Name], " +
                                                 "[dbo].[tbl_medbill].[LastModifiedDate], [dbo].[tbl_ModifiStaff].[Staff_Name], " +
                                                 "[dbo].[tbl_medbill].[BillAmount], [dbo].[tbl_medbill].[SettlementTotal], [dbo].[tbl_medbill].[TotalSharedAmount], [dbo].[tbl_medbill].[Balance] " +
                                                 "from ((([dbo].[tbl_medbill] inner join [dbo].[tbl_medbill_type] on [dbo].[tbl_medbill].[MedBillType_Id] = [dbo].[tbl_medbill_type].[MedBillTypeId]) " +
                                                 "inner join [dbo].[tbl_CreateStaff] on [dbo].[tbl_medbill].[CreatedById] = [dbo].[tbl_CreateStaff].[CreateStaff_Id]) " +
                                                 "inner join [dbo].[tbl_ModifiStaff] on [dbo].[tbl_medbill].[LastModifiedById] = [dbo].[tbl_ModifiStaff].[ModifiStaff_Id]) " +
                                                 "where [dbo].[tbl_medbill].[Case_Id] = @CaseName and " +
                                                 "[dbo].[tbl_medbill].[Contact_Id] = @IndividualId and" +
                                                 "[dbo].[tbl_medbill].[IsDeleted] = 0";

            //String strSqlQueryForMedBillInCase = "select [dbo].[tbl_medbill].[BillNo], [dbo].[tbl_medbill_type].[MedBillTypeName], [dbo].[tbl_medbill].[CreatedDate], " +
            //                         "[dbo].[tbl_CreateStaff].[Staff_Name], " +
            //                         "[dbo].[tbl_medbill].[LastModifiedDate], [dbo].[tbl_ModifiStaff].[Staff_Name], " +
            //                         "[dbo].[tbl_medbill].[BillAmount], [dbo].[tbl_medbill].[SettlementTotal], [dbo].[tbl_medbill].[TotalSharedAmount], " +
            //                         "[dbo].[tbl_medbill].[Balance] " +
            //                         "from ((([dbo].[tbl_medbill] inner join [dbo].[tbl_medbill_type] on [dbo].[tbl_medbill].[MedBillType_Id] = [dbo].[tbl_medbill_type].[MedBillTypeId]) " +
            //                         "inner join [dbo].[tbl_CreateStaff] on [dbo].[tbl_medbill].[CreatedById] = [dbo].[tbl_CreateStaff].[CreateStaff_Id]) " +
            //                         "inner join [dbo].[tbl_ModifiStaff] on [dbo].[tbl_medbill].[LastModifiedById] = [dbo].[tbl_ModifiStaff].[ModifiStaff_Id]) " +
            //                         "where [dbo].[tbl_medbill].[Case_Id] = @CaseName and " +
            //                         "[dbo].[tbl_medbill].[Contact_Id] = @IndividualId and " +
            //                         "[dbo].[tbl_medbill].[IsDeleted] = 0";


            SqlCommand cmdQueryForMedBillInCase = new SqlCommand(strSqlQueryForMedBillInCase, connRN3);
            cmdQueryForMedBillInCase.CommandType = CommandType.Text;

            cmdQueryForMedBillInCase.Parameters.AddWithValue("@CaseName", strCaseNameSelected);
            cmdQueryForMedBillInCase.Parameters.AddWithValue("@IndividualId", strIndividualId);

            SqlDependency dependencyMedBillsInCase = new SqlDependency(cmdQueryForMedBillInCase);
            dependencyMedBillsInCase.OnChange += new OnChangeEventHandler(OnMedBillsInCaseViewChange);

            //if (connRN.State == ConnectionState.Closed) connRN.Open();
            //if (connRN.State != ConnectionState.Closed)
            if (connRN3.State != ConnectionState.Closed)
            {
                connRN3.Close();
                connRN3.Open();
            }
            else if (connRN3.State == ConnectionState.Closed) connRN3.Open();
            SqlDataReader rdrMedBillInCase = cmdQueryForMedBillInCase.ExecuteReader();

            if (IsHandleCreated) ClearMedBillInCaseSafely();
            else gvCasePageMedBills.Rows.Clear();

            if (rdrMedBillInCase.HasRows)
            {
                while (rdrMedBillInCase.Read())
                {
                    DataGridViewRow row = new DataGridViewRow();

                    //row.Cells.Add(new DataGridViewCheckBoxCell { Value = false });
                    //row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillInCase.GetString(0) });
                    //row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillInCase.GetString(1) });
                    //row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillInCase.GetDateTime(2).ToString("MM/dd/yyyy") });
                    //row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillInCase.GetString(3) });
                    //row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillInCase.GetDateTime(4).ToString("MM/dd/yyyy") });
                    //row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillInCase.GetString(5) });
                    //row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillInCase.GetDecimal(6).ToString("C") });
                    //row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillInCase.GetDecimal(7).ToString("C") });
                    //row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillInCase.GetDecimal(8).ToString("C") });
                    //row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillInCase.GetDecimal(9).ToString("C") });


                    row.Cells.Add(new DataGridViewCheckBoxCell { Value = false });
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillInCase.GetString(0) });
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillInCase.GetString(1) });
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillInCase.GetDateTime(2).ToString("MM/dd/yyyy") });
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillInCase.GetDecimal(6).ToString("C") });
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillInCase.GetDecimal(7).ToString("C") });
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillInCase.GetDecimal(8).ToString("C") });
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillInCase.GetDecimal(9).ToString("C") });
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillInCase.GetString(3) });
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillInCase.GetDateTime(4).ToString("MM/dd/yyyy") });
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillInCase.GetString(5) });


                    //gvCasePageMedBills.Rows.Add(row);
                    if (IsHandleCreated) AddNewRowToMedBillInCaseSafely(row);
                    else gvCasePageMedBills.Rows.Add(row);
                }
            }
            rdrMedBillInCase.Close();
            if (connRN3.State != ConnectionState.Closed) connRN3.Close();
        }


        //private void UpdateGridViewMedBillsInCase()
        //{

        //}

        private void btnEditIllness_Click(object sender, EventArgs e)
        {
            //String strCaseName = cbCurrentCase.SelectedItem.ToString();

            //DataGridViewRow row = gvIllnessList.SelectedRows[0];

            //String strIndividualNo = row.Cells[0].Value.ToString();
            //String strICD10Code = row.Cells[1].Value.ToString();

            //String strConnStringIllnessEdit = @"Data Source=CMM-2014U\CMM; Initial Catalog=RN_DB;Integrated Security=True";

            //SqlConnection illnessEditConn = new SqlConnection(strConnStringIllnessEdit);
            //SqlCommand cmdIllnessEdit = illnessEditConn.CreateCommand();

            //String strQueryForIllness = "select Individual_Id, ICD_10_Id, Date_of_Diagnosis, CreateDate, Introduction, Body, Conclusion from tbl_illness " +
            //                            "where Individual_Id = '" + strIndividualNo + "' and Case_Id = '" + strCaseName + "' and ICD_10_Id = '" + strICD10Code + "'";

            //cmdIllnessEdit.CommandType = CommandType.Text;
            //cmdIllnessEdit.CommandText = strQueryForIllness;

            //illnessEditConn.Open();

            //SqlDataReader rdrIllness = cmdIllnessEdit.ExecuteReader();

            //if (rdrIllness.HasRows)
            //{
            //    frmIllnessCreationPage frm = new frmIllnessCreationPage();

            //    while(rdrIllness.Read())
            //    {
            //        frm.mode = IllnessMode.Edit;
            //        frm.strCaseId = cbCurrentCase.SelectedItem.ToString();
            //        frm.txtIndividualNo.Text = rdrIllness.GetString(0);
            //        frm.txtICD10Code.Text = rdrIllness.GetString(1);
            //        frm.dtpDateOfDiagnosis.Value = rdrIllness.GetDateTime(2);
            //        frm.dtpCreateDate.Value = rdrIllness.GetDateTime(3);
            //        frm.txtIntroduction.Text = rdrIllness.GetString(4);
            //        frm.txtIllnessNote.Text = rdrIllness.GetString(5);
            //        frm.txtConclusion.Text = rdrIllness.GetString(6);

            //        String strDiseaseNameConnString = @"Data Source=CMM-2014U\CMM; Initial Catalog=SalesForce;Integrated Security=True";

            //        SqlConnection connDiseaseName = new SqlConnection(strDiseaseNameConnString);
            //        SqlCommand cmdDiseaseName = connDiseaseName.CreateCommand();

            //        String strQueryForDiseaseName = "select Name from [ICD10 Code] where ICD10_CODE__C = '" + frm.txtICD10Code.Text.Trim() + "'";
            //        cmdDiseaseName.CommandType = CommandType.Text;
            //        cmdDiseaseName.CommandText = strQueryForDiseaseName;

            //        connDiseaseName.Open();
            //        frm.txtDiseaseName.Text = cmdDiseaseName.ExecuteScalar().ToString();
            //        connDiseaseName.Close();

            //    }

            //    frm.ShowDialog();
            //}


            //String strCreateDate = row.Cells[2].Value.ToString();
            //String strIllnessNote = row.Cells[3].Value.ToString();

            //frmIllnessCreationPage frmIllness = new frmIllnessCreationPage();

            //frmIllness.txtIndividualNo.Text = strIndividualNo;
            //frmIllness.txtICD10Code.Text = strICD10Code;
            //frmIllness.txtIllnessNote.Text = strIllnessNote;

            //frmIllness.ShowDialog();
        }

        private void btnDeleteIllness_Click(object sender, EventArgs e)
        {

            frmIllnessDeleteConfirm frm = new frmIllnessDeleteConfirm();

            //if (frm.ShowDialog() == DialogResult.Yes)
            //{
            //    String strCaseName = cbCurrentCase.SelectedItem.ToString();
            //    DataGridViewRow row = gvIllnessList.SelectedRows[0];
            //    String strIndividualNo = row.Cells[0].Value.ToString();

            //    String strSqlDeleteIllness = "delete from tbl_illness where Individual_Id = '" + strIndividualNo + "' and Case_Id = '" + strCaseName + "'";
            //    String strDeleteIllnessConnString = @"Data Source=CMM-2014U\CMM; Initial Catalog=RN_DB;Integrated Security=True";
            //    SqlConnection connDeleteIllness = new SqlConnection(strDeleteIllnessConnString);

            //    SqlCommand cmdDeleteIllness = connDeleteIllness.CreateCommand();
            //    cmdDeleteIllness.CommandType = CommandType.Text;
            //    cmdDeleteIllness.CommandText = strSqlDeleteIllness;

            //    connDeleteIllness.Open();
            //    if (cmdDeleteIllness.ExecuteNonQuery() == 1)
            //    {
            //        frmDeleteSuccess frmSuccess = new frmDeleteSuccess();
            //        frmSuccess.ShowDialog();
            //        return;
            //    }
            //    connDeleteIllness.Close();
            //}
            //else return;
        }

        private void frmCMMManager_FormClosing(object sender, FormClosingEventArgs e)
        {

            //SqlDependency.Stop(connRN_str);
            //SqlDependency.Stop(strConnStringForIllness);
            //frmCMMManager frm = sender as frmCMMManager;

            if (e.CloseReason == CloseReason.UserClosing)
            {
                DialogResult dlgClosing = MessageBox.Show("Do you want to exit?", "Comfirmation", MessageBoxButtons.YesNo);

                if (dlgClosing == DialogResult.Yes)
                {
                String strSqlDeleteCaseInUse = "delete from [dbo].[tbl_CaseInUse] where [dbo].[tbl_CaseInUse].[EditingStaff] = @EditingStaff";

                    SqlCommand cmdDeleteCaseInUse = new SqlCommand(strSqlDeleteCaseInUse, connRN7);
                    cmdDeleteCaseInUse.CommandType = CommandType.Text;

                    cmdDeleteCaseInUse.Parameters.AddWithValue("@EditingStaff", nLoggedUserId);

                    if (connRN7.State != ConnectionState.Closed)
                    {
                        connRN7.Close();
                        connRN7.Open();
                    }
                    else if (connRN7.State == ConnectionState.Closed) connRN7.Open();
                    int nCaseInUseDeleted = cmdDeleteCaseInUse.ExecuteNonQuery();
                    if (connRN7.State != ConnectionState.Closed) connRN7.Close();

                    String strSqlDeleteMedBillInUse = "delete from [dbo].[tbl_MedBillInUse] where [dbo].[tbl_MedBillInUse].[EditingStaff] = @EditingStaff";

                    SqlCommand cmdDeleteMedBillInUse = new SqlCommand(strSqlDeleteMedBillInUse, connRN7);
                    cmdDeleteMedBillInUse.CommandType = CommandType.Text;

                    cmdDeleteMedBillInUse.Parameters.AddWithValue("@EditingStaff", nLoggedUserId);

                    if (connRN7.State != ConnectionState.Closed)
                    {
                        connRN7.Close();
                        connRN7.Open();
                    }
                    else if (connRN7.State == ConnectionState.Closed) connRN7.Open();
                    int nMedBillInUseDelete = cmdDeleteMedBillInUse.ExecuteNonQuery();
                    if (connRN7.State != ConnectionState.Closed) connRN7.Close();

                    Environment.Exit(0);
                }
                else
                {
                    e.Cancel = true;
                }
            }
            else
            {
                e.Cancel = true;
            }
        }


        //void txtMedBillGuarantor_TextChanged(object sender, EventArgs e)
        //{
        //    bIsModified = true;
        //}

        //void txtMedBill_Illness_TextChanged(object sender, EventArgs e)
        //{
        //    bIsModified = true;
        //}

        //void txtMedBill_Incident_TextChanged(object sender, EventArgs e)
        //{
        //    bIsModified = true;
        //}

        //void txtMedBillAmount_TextChanged(object sender, EventArgs e)
        //{
        //    bIsModified = true;
        //}

        //void txtBalance_TextChanged(object sender, EventArgs e)
        //{
        //    bIsModified = true;
        //}

        //void txtPrescriptionName_TextChanged(object sender, EventArgs e)
        //{
        //    bIsModified = true;
        //}

        //void txtPrescriptionNo_TextChanged(object sender, EventArgs e)
        //{
        //    bIsModified = true;
        //}

        //void txtPrescriptionDescription_TextChanged(object sender, EventArgs e)
        //{
        //    bIsModified = true;
        //}

        //void txtNumPhysicalTherapy_TextChanged(object sender, EventArgs e)
        //{
        //    bIsModified = true;
        //}

        //void cbMedicalBillNote1_SelectedIndexChanged(object sender, EventArgs e)
        //{
        //    bIsModified = true;
        //}

        //void cbMedicalBillNote2_SelectedIndexChanged(object sender, EventArgs e)
        //{
        //    bIsModified = true;
        //}

        //void cbMedicalBillNote3_SelectedIndexChanged(object sender, EventArgs e)
        //{
        //    bIsModified = true;
        //}

        //void cbMedicalBillNote4_SelectedIndexChanged(object sender, EventArgs e)
        //{
        //    bIsModified = true;
        //}

        //void txtMedicalBillNote1_TextChanged(object sender, EventArgs e)
        //{
        //    bIsModified = true;
        //}

        //void txtMedicalBillNote2_TextChanged(object sender, EventArgs e)
        //{
        //    bIsModified = true;
        //}

        //void txtMedicalBillNote3_TextChanged(object sender, EventArgs e)
        //{
        //    bIsModified = true;
        //}

        //void txtMedicalBillNote4_TextChanged(object sender, EventArgs e)
        //{
        //    bIsModified = true;
        //}

        //void dtpBillDate_ValueChanged(object sender, EventArgs e)
        //{
        //    bIsModified = true;
        //}

        //void dtpDueDate_ValueChanged(object sender, EventArgs e)
        //{
        //    bIsModified = true;
        //}

        //private void OnCaseChanged(object sender, SqlDependencyEx.TableChangedEventArgs e)
        //{
        //    //Do stuff from e.Data
        //    MessageBox.Show("Case Table Changed!");
        //}

        private void btnAddNewIncident_Click(object sender, EventArgs e)
        {
            frmIncidentCreationPage frmIncident = new frmIncidentCreationPage();
            frmIncident.strIndividualId = txtIndividualID.Text.Trim();

            frmIncident.ShowDialog(this);
        }

        //private void cbBillCreationCaseNo_SelectedValueChanged(object sender, EventArgs e)
        //{
        //    ComboBox cbCaseNo = sender as ComboBox;

        //    String strCaseIdSelected = cbCaseNo.SelectedItem.ToString();

        //    String strSqlQueryForIncidentId = "select dbo.tbl_incident.incident_id from dbo.tbl_incident where dbo.tbl_incident.Case_id = @CaseId and dbo.tbl_incident.Individual_id = @IndividualId";

        //    SqlCommand cmdQueryForIncidentId = new SqlCommand(strSqlQueryForIncidentId, connRN);
        //    cmdQueryForIncidentId.Parameters.AddWithValue("@CaseId", strCaseIdSelected);
        //    cmdQueryForIncidentId.Parameters.AddWithValue("@IndividualId", strIndividualId);

        //    cmdQueryForIncidentId.CommandType = CommandType.Text;
        //    cmdQueryForIncidentId.CommandText = strSqlQueryForIncidentId;

        //    if (connRN.State != ConnectionState.Closed) connRN.Close();

        //    connRN.Open();

        //    SqlDataReader rdrIncidentForIncidentId = cmdQueryForIncidentId.ExecuteReader();
        //    if (rdrIncidentForIncidentId.HasRows)
        //    {
        //        cbBillCreationIncidentNo.Items.Clear();
        //        while (rdrIncidentForIncidentId.Read())
        //        {
        //            cbBillCreationIncidentNo.Items.Add(rdrIncidentForIncidentId.GetInt32(0).ToString());
        //        }
        //        cbBillCreationIncidentNo.SelectedIndex = 0;
        //    }
        //    connRN.Close();


        //    String strQueryForDocReceivedDate = "select NPF_Receiv_Date, IB_Receiv_Date, POP_Receiv_Date from dbo.tbl_case where Case_Name = @CaseId";

        //    //String strCaseNo = cbBillCreationCaseNo.SelectedItem.ToString();
        //    String strCaseNo = txtMedBillCreationCaseNo.Text.Trim();

        //    SqlCommand cmdQueryForDocReceivDates = new SqlCommand(strQueryForDocReceivedDate, connRN);
        //    cmdQueryForDocReceivDates.CommandType = CommandType.Text;
        //    cmdQueryForDocReceivDates.CommandText = strQueryForDocReceivedDate;

        //    cmdQueryForDocReceivDates.Parameters.AddWithValue("@CaseId", strCaseNo);

        //    connRN.Open();
        //    SqlDataReader rdrDocReceivDate = cmdQueryForDocReceivDates.ExecuteReader();

        //    if (rdrDocReceivDate.HasRows)
        //    {
        //        rdrDocReceivDate.Read();
        //        txtNPFReceivedDate.Text = rdrDocReceivDate.GetDateTime(0).ToString("MM/dd/yyyy");
        //        txtIBReceivedDate.Text = rdrDocReceivDate.GetDateTime(1).ToString("MM/dd/yyyy");
        //        txtPOPReceivedDate.Text = rdrDocReceivDate.GetDateTime(2).ToString("MM/dd/yyyy");
        //    }

        //    connRN.Close();

        //}

        //private void cbBillCreationIncidentNo_SelectedValueChanged(object sender, EventArgs e)
        //{
        //    ComboBox cbIncidentNo = sender as ComboBox;

        //    String strIncidentNoSelected = cbIncidentNo.SelectedItem.ToString();

        //    String strSqlQueryForIllnessId = "select dbo.tbl_incident.illness_id from dbo.tbl_incident where dbo.tbl_incident.incident_id = @IncidentNo";

        //    SqlCommand cmdQueryForIllnessId = new SqlCommand(strSqlQueryForIllnessId, connRN);
        //    cmdQueryForIllnessId.Parameters.AddWithValue("@IncidentNo", strIncidentNoSelected);

        //    cmdQueryForIllnessId.CommandType = CommandType.Text;
        //    cmdQueryForIllnessId.CommandText = strSqlQueryForIllnessId;

        //    if (connRN.State != ConnectionState.Closed) connRN.Close();

        //    //String strIllnessId = String.Empty;
        //    Int32 nIllnessId = 0;
        //    rn_cnn.Open();

        //    SqlDataReader rdrIllnessId = cmdQueryForIllnessId.ExecuteReader();
        //    if (rdrIllnessId.HasRows)
        //    {
        //        rdrIllnessId.Read();
        //        nIllnessId = rdrIllnessId.GetInt32(0);
        //    }
        //    rn_cnn.Close();

        //    String strSqlQueryForICD10Code = "select dbo.tbl_illness.ICD_10_Id from dbo.tbl_illness where dbo.tbl_illness.Illness_id = @IllnessId";

        //    SqlCommand cmdQueryForICD10Code = new SqlCommand(strSqlQueryForICD10Code, rn_cnn);
        //    cmdQueryForICD10Code.Parameters.AddWithValue("@IllnessId", nIllnessId);

        //    cmdQueryForICD10Code.CommandType = CommandType.Text;
        //    cmdQueryForICD10Code.CommandText = strSqlQueryForICD10Code;

        //    if (rn_cnn.State == ConnectionState.Open) rn_cnn.Close();

        //    String strICD10Code = String.Empty;
        //    rn_cnn.Open();

        //    SqlDataReader rdrICD10Code = cmdQueryForICD10Code.ExecuteReader();
        //    if (rdrICD10Code.HasRows)
        //    {
        //        rdrICD10Code.Read();
        //        strICD10Code = rdrICD10Code.GetString(0);
        //    }
        //    rn_cnn.Close();

        //    txtICD10Code.Text = strICD10Code.Trim();

        //    String strSqlQueryForDiseaseName = "select dbo.[ICD10 Code].Name from dbo.[ICD10 Code] where ICD10_CODE__C = @ICD10Code";

        //    SqlCommand cmdQueryForDiseaseName = new SqlCommand(strSqlQueryForDiseaseName, connSalesforce);
        //    cmdQueryForDiseaseName.Parameters.AddWithValue("@ICD10Code", txtICD10Code.Text.Trim());

        //    cmdQueryForDiseaseName.CommandType = CommandType.Text;
        //    cmdQueryForDiseaseName.CommandText = strSqlQueryForDiseaseName;

        //    connSalesforce.Open();

        //    SqlDataReader rdrDiseaseName = cmdQueryForDiseaseName.ExecuteReader();
        //    if (rdrDiseaseName.HasRows)
        //    {
        //        rdrDiseaseName.Read();
        //        txtDiseaseName.Text = rdrDiseaseName.GetString(0);
        //    }
        //    connSalesforce.Close();

        //}

        private void txtICD10Code_TextChanged(object sender, EventArgs e)
        {
            String strICD10Code = txtMedBill_ICD10Code.Text.Trim();

            for (int i = 0; i < lstICD10CodeInfo.Count; i++)
            {
                if (strICD10Code.ToUpper() == lstICD10CodeInfo[i].ICD10Code)
                    txtMedBillDiseaseName.Text = lstICD10CodeInfo[i].Name;
            }
        }

        private void btnNewIncident_Click(object sender, EventArgs e)
        {
            frmIncidentCreationPage frmIncident = new frmIncidentCreationPage();
            frmIncident.strIndividualId = txtIndividualID.Text.Trim();

            frmIncident.ShowDialog(this);
        }

        private void btnNewIllness_Click(object sender, EventArgs e)
        {
            frmIllnessCreationPage frmIllness = new frmIllnessCreationPage();

            frmIllness.txtIndividualNo.Text = txtIndividualID.Text;
            frmIllness.mode = IllnessMode.AddNew;

            frmIllness.ShowDialog(this);
        }

        private void btnCaseCreationCancelUpper_Click(object sender, EventArgs e)
        {
            //if (tbCMMManager.Contains(tbpgMedicalBill))
            //{
            //    MessageBox.Show("Medical Bill page is open. Close Medical Bill page first.", "Alert");
            //    return;
            //}

            DialogResult dlgClose = MessageBox.Show("Do you want to close Case page?", "Alert", MessageBoxButtons.YesNo);

            if (dlgClose == DialogResult.Yes)
            {
                DialogResult dlgResult = MessageBox.Show("Do you want save the change?", "Alert", MessageBoxButtons.YesNo);

                if (dlgResult == DialogResult.Yes)
                {
                    String CaseName = txtCaseName.Text.Trim();
                    String IndividualId = txtCaseIndividualID.Text.Trim();

                    String strSqlQueryForCaseName = "select [dbo].[tbl_case].[Case_Name] from [dbo].[tbl_case] " +
                                                    "where [dbo].[tbl_case].[Case_Name] = @CaseName and [dbo].[tbl_case].[Contact_ID] = @IndividualId";

                    SqlCommand cmdQueryForCaseName = new SqlCommand(strSqlQueryForCaseName, connRN4);
                    cmdQueryForCaseName.CommandText = strSqlQueryForCaseName;
                    cmdQueryForCaseName.CommandType = CommandType.Text;

                    cmdQueryForCaseName.Parameters.AddWithValue("@CaseName", CaseName);
                    cmdQueryForCaseName.Parameters.AddWithValue("@IndividualId", IndividualId);

                    //if (connRN.State == ConnectionState.Closed) connRN.Open();
                    if (connRN4.State != ConnectionState.Closed)
                    {
                        connRN4.Close();
                        connRN4.Open();
                    }
                    else if (connRN4.State == ConnectionState.Closed) connRN4.Open();
                    Object objCaseName = cmdQueryForCaseName.ExecuteScalar();
                    if (connRN4.State != ConnectionState.Closed) connRN4.Close();

                    if (objCaseName == null)
                    {
                        //frmSaveNewCase frmSaveNewCase = new frmSaveNewCase();

                        //DialogResult dlgResult = frmSaveNewCase.ShowDialog();

                        //if (dlgResult == DialogResult.Yes)
                        //{

                        String strCaseId = String.Empty;
                        String strIndividualID = String.Empty;
                        String strNPFormFilePath = String.Empty;
                        String strNPFUploadDate = String.Empty;
                        String strIBFilePath = String.Empty;
                        String strIBUploadDate = String.Empty;
                        String strPopFilePath = String.Empty;
                        String strPopUploadDate = String.Empty;
                        String strMedicalRecordFilePath = String.Empty;
                        String strMedicalRecordUploadDate = String.Empty;
                        String strUnknownDocumentFilePath = String.Empty;
                        String strUnknownDocUploadDate = String.Empty;
                        String strLogID = String.Empty;

                        CasedInfoDetailed caseDetail = new CasedInfoDetailed();

                        caseDetail.CaseId = String.Empty;
                        caseDetail.ContactId = String.Empty;
                        caseDetail.Individual_Id = String.Empty;
                        caseDetail.CreateDate = DateTime.Today;
                        caseDetail.ModificationDate = DateTime.Today;
                        caseDetail.CreateStaff = nLoggedUserId;
                        caseDetail.ModifyingStaff = nLoggedUserId;

                        caseDetail.Individual_Id = String.Empty;
                        caseDetail.NPF_Form = 0;
                        caseDetail.NPF_Form_File_Name = String.Empty;
                        caseDetail.NPF_Form_Destination_File_Name = String.Empty;

                        caseDetail.IB_Form = 0;
                        caseDetail.IB_Form_File_Name = String.Empty;
                        caseDetail.IB_Form_Destination_File_Name = String.Empty;

                        caseDetail.POP_Form = 0;
                        caseDetail.POP_Form_File_Name = String.Empty;
                        caseDetail.POP_Form_Destionation_File_Name = String.Empty;

                        caseDetail.MedicalRecord_Form = 0;
                        caseDetail.MedRec_Form_File_Name = String.Empty;
                        caseDetail.MedRec_Form_Destination_File_Name = String.Empty;

                        caseDetail.Unknown_Form = 0;
                        caseDetail.Unknown_Form_File_Name = String.Empty;
                        caseDetail.Unknown_Form_Destination_File_Name = String.Empty;

                        caseDetail.Note = String.Empty;
                        caseDetail.Log_Id = String.Empty;
                        caseDetail.AddBill_Form = false;

                        caseDetail.Remove_Log = String.Empty;

                        switch (cbCaseStatus.SelectedIndex)
                        {
                            case (int)CaseStatus.OnGoing:
                                caseDetail.Status = CaseStatus.OnGoing;
                                break;
                            case (int)CaseStatus.Processing:
                                caseDetail.Status = CaseStatus.Processing;
                                break;
                            case (int)CaseStatus.Closed:
                                caseDetail.Status = CaseStatus.Closed;
                                break;
                        }

                        if (txtCaseName.Text.Trim() != String.Empty) caseDetail.CaseId = txtCaseName.Text.Trim();
                        if (txtCaseIndividualID.Text.Trim() != String.Empty) caseDetail.ContactId = txtCaseIndividualID.Text.Trim();
                        if (txtCaseIndividualID.Text.Trim() != String.Empty) caseDetail.Individual_Id = txtCaseIndividualID.Text.Trim();
                        if (chkNPF_CaseCreationPage.Checked)
                        {
                            caseDetail.NPF_Form = 1;
                            if (txtNPFFormFilePath.Text.Trim() != String.Empty) caseDetail.NPF_Form_File_Name = txtNPFFormFilePath.Text.Trim();
                            //if (txtNPFUploadDate.Text.Trim() != String.Empty)
                            //{
                            //    DateTime result;
                            //    if (DateTime.TryParse(txtNPFUploadDate.Text.Trim(), out result)) caseDetail.NPF_ReceivedDate = result;
                            //    else MessageBox.Show("Invalid DateTime value", "Error");
                            //}
                            caseDetail.NPF_ReceivedDate = dtpNPFReceivedDate.Value;
                            caseDetail.NPF_Form_Destination_File_Name = strNPFormFilePathDestination;
                        }
                        if (chkIB_CaseCreationPage.Checked)
                        {
                            caseDetail.IB_Form = 1;
                            if (txtIBFilePath.Text.Trim() != String.Empty) caseDetail.IB_Form_File_Name = txtIBFilePath.Text.Trim();
                            //if (txtIBUploadDate.Text.Trim() != String.Empty)
                            //{
                            //    DateTime result;
                            //    if (DateTime.TryParse(txtIBUploadDate.Text.Trim(), out result)) caseDetail.IB_ReceivedDate = result;
                            //    else MessageBox.Show("Invalid DateTime value", "Error");
                            //}
                            caseDetail.IB_ReceivedDate = dtpIBReceivedDate.Value;
                            caseDetail.IB_Form_Destination_File_Name = strIBFilePathDestination;
                        }
                        if (chkPoP_CaseCreationPage.Checked)
                        {
                            caseDetail.POP_Form = 1;
                            if (txtPopFilePath.Text.Trim() != String.Empty) caseDetail.POP_Form_File_Name = txtPopFilePath.Text.Trim();
                            //if (txtPoPUploadDate.Text.Trim() != String.Empty)
                            //{
                            //    DateTime result;
                            //    if (DateTime.TryParse(txtPoPUploadDate.Text.Trim(), out result)) caseDetail.POP_ReceivedDate = result;
                            //    else MessageBox.Show("Invalid DateTime value", "Error");
                            //}
                            caseDetail.POP_ReceivedDate = dtpPoPReceivedDate.Value;
                            caseDetail.POP_Form_Destionation_File_Name = strPopFilePathDestination;
                        }
                        if (chkMedicalRecordCaseCreationPage.Checked)
                        {
                            caseDetail.MedicalRecord_Form = 1;
                            if (txtMedicalRecordFilePath.Text.Trim() != String.Empty) caseDetail.MedRec_Form_File_Name = txtMedicalRecordFilePath.Text.Trim();
                            //if (txtMRUploadDate.Text.Trim() != String.Empty)
                            //{
                            //    DateTime result;
                            //    if (DateTime.TryParse(txtMRUploadDate.Text.Trim(), out result)) caseDetail.MedRec_ReceivedDate = result;
                            //    else MessageBox.Show("Invalid DateTime value", "Error");
                            //}
                            caseDetail.MedRec_ReceivedDate = dtpMRReceivedDate.Value;
                            caseDetail.MedRec_Form_Destination_File_Name = strMedRecordFilePathDestination;
                        }
                        if (chkOtherDocCaseCreationPage.Checked)
                        {
                            caseDetail.Unknown_Form = 1;
                            if (txtOtherDocumentFilePath.Text.Trim() != String.Empty) caseDetail.Unknown_Form_File_Name = txtOtherDocumentFilePath.Text.Trim();
                            //if (txtOtherDocUploadDate.Text.Trim() != String.Empty)      //caseDetail.Unknown_ReceivedDate = DateTime.Parse(txtOtherDocUploadDate.Text.Trim());
                            //{
                            //    DateTime result;
                            //    if (DateTime.TryParse(txtOtherDocUploadDate.Text.Trim(), out result)) caseDetail.Unknown_ReceivedDate = result;
                            //    else MessageBox.Show("Invalid DateTime value", "Error");
                            //}
                            caseDetail.Unknown_ReceivedDate = dtpOtherDocReceivedDate.Value;
                            caseDetail.Unknown_Form_Destination_File_Name = strUnknownDocFilePathDestination;
                        }

                        caseDetail.Log_Id = "Log: " + txtCaseName.Text;
                        caseDetail.AddBill_Form = false;
                        caseDetail.AddBill_Received_Date = null;
                        caseDetail.Remove_Log = String.Empty;

                        String strSqlCreateCase = "insert into tbl_case (IsDeleted, Case_Name, Contact_ID, CreateDate, ModifiDate, CreateStaff, ModifiStaff, Case_status, " +
                                                    "NPF_Form, NPF_Form_File_Name, NPF_Form_Destination_File_Name, NPF_Receiv_Date, " +
                                                    "IB_Form, IB_Form_File_Name, IB_Form_Destination_File_Name, IB_Receiv_Date, " +
                                                    "POP_Form, POP_Form_File_Name, POP_Form_Destination_File_Name, POP_Receiv_Date, " +
                                                    "MedRec_Form, MedRec_Form_File_Name, MedRec_Form_Destination_File_Name, MedRec_Receiv_Date, " +
                                                    "Unknown_Form, Unknown_Form_File_Name, Unknown_Form_Destination_File_Name, Unknown_Receiv_Date, " +
                                                    "Note, Log_ID, AddBill_Form, AddBill_receiv_Date, Remove_log, individual_id) " +
                                                    "Values (@IsDeleted, @CaseId, @ContactId, @CreateDate, @ModifiDate, @CreateStaff, @ModifiStaff, @CaseStatus, " +
                                                    "@NPF_Form, @NPF_Form_File_Name, @NPF_Form_Destination_File_Name, @NPF_Receive_Date, " +
                                                    "@IB_Form, @IB_Form_File_Name, @IB_Form_Destination_File_Name, @IB_Receive_Date, " +
                                                    "@POP_Form, @POP_Form_File_Name, @POP_Form_Destination_File_Name, @POP_Receive_Date, " +
                                                    "@MedRecord_Form, @MedRecord_Form_File_Name, @MedRecord_Form_Destination_File_name, @MedRecord_Receive_Date, " +
                                                    "@Unknown_Form, @Unknown_Form_File_Name, @Unknown_Form_Destination_File_Name, @Unknown_Receive_Date, " +
                                                    "@Note, @Log_Id, @AddBill_Form, @AddBill_ReceiveDate, @Remove_Log, @Individual_Id)";

                        SqlCommand cmdInsertNewCase = new SqlCommand(strSqlCreateCase, connRN4);
                        cmdInsertNewCase.CommandType = CommandType.Text;

                        cmdInsertNewCase.Parameters.AddWithValue("@IsDeleted", 0);
                        cmdInsertNewCase.Parameters.AddWithValue("@CaseId", caseDetail.CaseId);
                        cmdInsertNewCase.Parameters.AddWithValue("@ContactId", caseDetail.ContactId);
                        cmdInsertNewCase.Parameters.AddWithValue("@CreateDate", caseDetail.CreateDate);
                        cmdInsertNewCase.Parameters.AddWithValue("@ModifiDate", caseDetail.ModificationDate);
                        cmdInsertNewCase.Parameters.AddWithValue("@CreateStaff", caseDetail.CreateStaff);
                        cmdInsertNewCase.Parameters.AddWithValue("@ModifiStaff", caseDetail.ModifyingStaff);
                        cmdInsertNewCase.Parameters.AddWithValue("@CaseStatus", caseDetail.Status);

                        cmdInsertNewCase.Parameters.AddWithValue("@NPF_Form", caseDetail.NPF_Form);
                        cmdInsertNewCase.Parameters.AddWithValue("@NPF_Form_File_Name", caseDetail.NPF_Form_File_Name);
                        cmdInsertNewCase.Parameters.AddWithValue("@NPF_Form_Destination_File_Name", caseDetail.NPF_Form_Destination_File_Name);
                        if (caseDetail.NPF_ReceivedDate != null) cmdInsertNewCase.Parameters.AddWithValue("@NPF_Receive_Date", caseDetail.NPF_ReceivedDate);
                        else cmdInsertNewCase.Parameters.AddWithValue("@NPF_Receive_Date", DBNull.Value);

                        cmdInsertNewCase.Parameters.AddWithValue("@IB_Form", caseDetail.IB_Form);
                        cmdInsertNewCase.Parameters.AddWithValue("@IB_Form_File_Name", caseDetail.IB_Form_File_Name);
                        cmdInsertNewCase.Parameters.AddWithValue("@IB_Form_Destination_File_Name", caseDetail.IB_Form_Destination_File_Name);
                        if (caseDetail.IB_ReceivedDate != null) cmdInsertNewCase.Parameters.AddWithValue("@IB_Receive_Date", caseDetail.IB_ReceivedDate);
                        else cmdInsertNewCase.Parameters.AddWithValue("@IB_Receive_Date", DBNull.Value);

                        cmdInsertNewCase.Parameters.AddWithValue("@POP_Form", caseDetail.POP_Form);
                        cmdInsertNewCase.Parameters.AddWithValue("@POP_Form_File_Name", caseDetail.POP_Form_File_Name);
                        cmdInsertNewCase.Parameters.AddWithValue("@POP_Form_Destination_File_Name", caseDetail.POP_Form_Destionation_File_Name);
                        if (caseDetail.POP_ReceivedDate != null) cmdInsertNewCase.Parameters.AddWithValue("@POP_Receive_Date", caseDetail.POP_ReceivedDate);
                        else cmdInsertNewCase.Parameters.AddWithValue("@POP_Receive_Date", DBNull.Value);

                        cmdInsertNewCase.Parameters.AddWithValue("@MedRecord_Form", caseDetail.MedicalRecord_Form);
                        cmdInsertNewCase.Parameters.AddWithValue("@MedRecord_Form_File_Name", caseDetail.MedRec_Form_File_Name);
                        cmdInsertNewCase.Parameters.AddWithValue("@MedRecord_Form_Destination_File_Name", caseDetail.MedRec_Form_Destination_File_Name);
                        if (caseDetail.MedRec_ReceivedDate != null) cmdInsertNewCase.Parameters.AddWithValue("@MedRecord_Receive_Date", caseDetail.MedRec_ReceivedDate);
                        else cmdInsertNewCase.Parameters.AddWithValue("@MedRecord_Receive_Date", DBNull.Value);

                        cmdInsertNewCase.Parameters.AddWithValue("@Unknown_Form", caseDetail.Unknown_Form);
                        cmdInsertNewCase.Parameters.AddWithValue("@Unknown_Form_File_Name", caseDetail.Unknown_Form_File_Name);
                        cmdInsertNewCase.Parameters.AddWithValue("@Unknown_Form_Destination_File_Name", caseDetail.Unknown_Form_Destination_File_Name);
                        if (caseDetail.Unknown_ReceivedDate != null) cmdInsertNewCase.Parameters.AddWithValue("@Unknown_Receive_Date", caseDetail.Unknown_ReceivedDate);
                        else cmdInsertNewCase.Parameters.AddWithValue("@Unknown_Receive_Date", DBNull.Value);

                        cmdInsertNewCase.Parameters.AddWithValue("@Note", caseDetail.Note);
                        cmdInsertNewCase.Parameters.AddWithValue("@Log_Id", caseDetail.Log_Id);
                        cmdInsertNewCase.Parameters.AddWithValue("@AddBill_Form", caseDetail.AddBill_Form);
                        if (caseDetail.AddBill_Received_Date != null) cmdInsertNewCase.Parameters.AddWithValue("@AddBill_ReceiveDate", caseDetail.AddBill_Received_Date);
                        else cmdInsertNewCase.Parameters.AddWithValue("@AddBill_ReceiveDate", DBNull.Value);
                        if (caseDetail.Remove_Log == String.Empty) cmdInsertNewCase.Parameters.AddWithValue("@Remove_Log", DBNull.Value);
                        cmdInsertNewCase.Parameters.AddWithValue("@Individual_Id", caseDetail.Individual_Id);

                        //if (connRN.State == ConnectionState.Closed) connRN.Open();
                        if (connRN4.State != ConnectionState.Closed)
                        {
                            connRN4.Close();
                            connRN4.Open();
                        }
                        else if (connRN4.State == ConnectionState.Closed) connRN4.Open();
                        int nResult = cmdInsertNewCase.ExecuteNonQuery();
                        if (nResult == 1)
                        {
                            MessageBox.Show("The case has been saved.", "Information");

                            caseDetail.CaseId = txtCaseName.Text.Trim();
                            strCaseIdSelected = caseDetail.CaseId;
                            strContactIdSelected = caseDetail.ContactId;

                            btnNewMedBill_Case.Enabled = true;
                            btnEditMedBill.Enabled = true;
                            btnDeleteMedBill.Enabled = true;
                        }
                        if (connRN4.State != ConnectionState.Closed) connRN4.Close();
                        //}
                        //else if (dlgResult == DialogResult.No)
                        //{
                        //    tbCMMManager.TabPages.Remove(tbpgCreateCase);
                        //    tbCMMManager.SelectedIndex = 2;

                        //    return;
                        //}
                        //else if (dlgResult == DialogResult.Cancel)
                        //{
                        //    return;
                        //}
                    }
                    else if (objCaseName != null)    // Edit and update case
                    {
                        //frmSaveChangeOnCase frmDlgSaveChange = new frmSaveChangeOnCase();

                        //DialogResult dlgResult = frmDlgSaveChange.ShowDialog();

                        ////if (frmDlgSaveChange.DialogResult == DialogResult.Yes)
                        //if (dlgResult == DialogResult.Yes)
                        //{
                        CasedInfoDetailed caseDetail = new CasedInfoDetailed();

                        caseDetail.CaseId = txtCaseName.Text.Trim();
                        caseDetail.ContactId = String.Empty;
                        caseDetail.Individual_Id = String.Empty;
                        caseDetail.CreateDate = DateTime.Today;
                        //caseDetail.ModificationDate = DateTime.Today;
                        //caseDetail.CreateStaff = 8;     // WonJik
                        //caseDetail.ModifyingStaff = 8;  // WonJik
                        //caseDetail.CreateStaff = nLoggedUserId;
                        caseDetail.ModifyingStaff = nLoggedUserId;
                        switch (cbCaseStatus.SelectedIndex)
                        {
                            case (int)CaseStatus.OnGoing:
                                caseDetail.Status = CaseStatus.OnGoing;
                                break;
                            case (int)CaseStatus.Processing:
                                caseDetail.Status = CaseStatus.Processing;
                                break;
                            case (int)CaseStatus.Closed:
                                caseDetail.Status = CaseStatus.Closed;
                                break;
                        }
                        caseDetail.Individual_Id = String.Empty;
                        caseDetail.NPF_Form = 0;
                        caseDetail.NPF_Form_File_Name = String.Empty;
                        caseDetail.NPF_Form_Destination_File_Name = String.Empty;
                        //caseDetail.NPF_ReceivedDate = DateTime.Today;
                        caseDetail.IB_Form = 0;
                        caseDetail.IB_Form_File_Name = String.Empty;
                        caseDetail.IB_Form_Destination_File_Name = String.Empty;
                        //caseDetail.IB_ReceivedDate = DateTime.Today;
                        caseDetail.POP_Form = 0;
                        caseDetail.POP_Form_File_Name = String.Empty;
                        caseDetail.POP_Form_Destionation_File_Name = String.Empty;
                        //caseDetail.POP_ReceivedDate = DateTime.Today;
                        caseDetail.MedicalRecord_Form = 0;
                        caseDetail.MedRec_Form_File_Name = String.Empty;
                        caseDetail.MedRec_Form_Destination_File_Name = String.Empty;
                        //caseDetail.MedRec_ReceivedDate = DateTime.Today;
                        caseDetail.Unknown_Form = 0;
                        caseDetail.Unknown_Form_File_Name = String.Empty;
                        caseDetail.Unknown_Form_Destination_File_Name = String.Empty;
                        //caseDetail.Unknown_ReceivedDate = DateTime.Today;
                        caseDetail.Note = String.Empty;
                        caseDetail.Log_Id = String.Empty;
                        caseDetail.AddBill_Form = false;
                        //caseDetail.AddBill_Received_Date = DateTime.Today;
                        caseDetail.Remove_Log = String.Empty;

                        if (txtCaseName.Text.Trim() != String.Empty) caseDetail.CaseId = txtCaseName.Text.Trim();
                        if (txtCaseIndividualID.Text.Trim() != String.Empty) caseDetail.ContactId = txtCaseIndividualID.Text.Trim();
                        if (txtCaseIndividualID.Text.Trim() != String.Empty) caseDetail.Individual_Id = txtCaseIndividualID.Text.Trim();

                        if (chkNPF_CaseCreationPage.Checked)
                        {
                            caseDetail.NPF_Form = 1;
                            if (txtNPFFormFilePath.Text.Trim() != String.Empty) caseDetail.NPF_Form_File_Name = txtNPFFormFilePath.Text.Trim();
                            //if (txtNPFUploadDate.Text.Trim() != String.Empty)
                            //{
                            //    DateTime result;
                            //    if (DateTime.TryParse(txtNPFUploadDate.Text.Trim(), out result)) caseDetail.NPF_ReceivedDate = result;
                            //    else MessageBox.Show("Invalid DateTime value", "Error");
                            //}
                            caseDetail.NPF_ReceivedDate = dtpNPFReceivedDate.Value;
                            caseDetail.NPF_Form_Destination_File_Name = strNPFormFilePathDestination;
                        }
                        if (chkIB_CaseCreationPage.Checked)
                        {
                            caseDetail.IB_Form = 1;
                            if (txtIBFilePath.Text.Trim() != String.Empty) caseDetail.IB_Form_File_Name = txtIBFilePath.Text.Trim();
                            //if (txtIBUploadDate.Text.Trim() != String.Empty)
                            //{
                            //    DateTime result;
                            //    if (DateTime.TryParse(txtIBUploadDate.Text.Trim(), out result)) caseDetail.IB_ReceivedDate = result;
                            //    else MessageBox.Show("Invalid DateTime value", "Error");
                            //}
                            caseDetail.IB_ReceivedDate = dtpIBReceivedDate.Value;
                            caseDetail.IB_Form_Destination_File_Name = strIBFilePathDestination;
                        }
                        if (chkPoP_CaseCreationPage.Checked)
                        {
                            caseDetail.POP_Form = 1;
                            if (txtPopFilePath.Text.Trim() != String.Empty) caseDetail.POP_Form_File_Name = txtPopFilePath.Text.Trim();
                            //if (txtPoPUploadDate.Text.Trim() != String.Empty)
                            //{
                            //    DateTime result;
                            //    if (DateTime.TryParse(txtPoPUploadDate.Text.Trim(), out result)) caseDetail.POP_ReceivedDate = result;
                            //    else MessageBox.Show("Invalid DateTime value", "Error");
                            //}
                            caseDetail.POP_ReceivedDate = dtpPoPReceivedDate.Value;
                            caseDetail.POP_Form_Destionation_File_Name = strPopFilePathDestination;
                        }
                        if (chkMedicalRecordCaseCreationPage.Checked)
                        {
                            caseDetail.MedicalRecord_Form = 1;
                            if (txtMedicalRecordFilePath.Text.Trim() != String.Empty) caseDetail.MedRec_Form_File_Name = txtMedicalRecordFilePath.Text.Trim();
                            //if (txtMRUploadDate.Text.Trim() != String.Empty)
                            //{
                            //    DateTime result;
                            //    if (DateTime.TryParse(txtMRUploadDate.Text.Trim(), out result)) caseDetail.MedRec_ReceivedDate = result;
                            //    else MessageBox.Show("Invalid DateTime value", "Error");
                            //}
                            caseDetail.MedRec_ReceivedDate = dtpMRReceivedDate.Value;
                            caseDetail.MedRec_Form_Destination_File_Name = strMedRecordFilePathDestination;
                        }
                        if (chkOtherDocCaseCreationPage.Checked)
                        {
                            caseDetail.Unknown_Form = 1;
                            if (txtOtherDocumentFilePath.Text.Trim() != String.Empty) caseDetail.Unknown_Form_File_Name = txtOtherDocumentFilePath.Text.Trim();
                            //if (txtOtherDocUploadDate.Text.Trim() != String.Empty)      //caseDetail.Unknown_ReceivedDate = DateTime.Parse(txtOtherDocUploadDate.Text.Trim());
                            //{
                            //    DateTime result;
                            //    if (DateTime.TryParse(txtOtherDocUploadDate.Text.Trim(), out result)) caseDetail.Unknown_ReceivedDate = result;
                            //    else MessageBox.Show("Invalid DateTime value", "Error");
                            //}
                            caseDetail.Unknown_ReceivedDate = dtpOtherDocReceivedDate.Value;
                            caseDetail.Unknown_Form_Destination_File_Name = strUnknownDocFilePathDestination;
                        }

                        caseDetail.Note = txtNoteOnCase.Text.Trim();
                        caseDetail.Log_Id = "Log: " + txtCaseName.Text;
                        caseDetail.AddBill_Form = true;
                        caseDetail.AddBill_Received_Date = DateTime.Today;
                        caseDetail.Remove_Log = String.Empty;

                        String strSqlUpdateCase = "Update [dbo].[tbl_case] set [dbo].[tbl_case].[ModifiDate] = @ModifiDate, [dbo].[tbl_case].[ModifiStaff] = @ModifiStaff, " +
                                                    "[dbo].[tbl_case].[NPF_Form] = @NPF_Form, [dbo].[tbl_case].[NPF_Form_File_Name] = @NPF_Form_File_Name, " +
                                                    "[dbo].[tbl_case].[NPF_Form_Destination_File_Name] = @NPF_Form_Destination_File_Name, [dbo].[tbl_case].[NPF_Receiv_Date] = @NPF_Receiv_Date, " +
                                                    "[dbo].[tbl_case].[IB_Form] = @IB_Form, [dbo].[tbl_case].[IB_Form_File_Name] = @IB_Form_File_Name, " +
                                                    "[dbo].[tbl_case].[IB_Form_Destination_File_Name] = @IB_Form_Destination_File_Name, [dbo].[tbl_case].[IB_Receiv_Date] = @IB_Receiv_Date, " +
                                                    "[dbo].[tbl_case].[POP_Form] = @POP_Form, [dbo].[tbl_case].[POP_Form_File_Name] = @POP_Form_File_Name, " +
                                                    "[dbo].[tbl_case].[POP_Form_Destination_File_Name] = @POP_Form_Destination_File_Name, [dbo].[tbl_case].[POP_Receiv_Date] = @POP_Receiv_Date, " +
                                                    "[dbo].[tbl_case].[MedRec_Form] = @MedRec_Form, [dbo].[tbl_case].[MedRec_Form_File_Name] = @MedRec_Form_File_Name, " +
                                                    "[dbo].[tbl_case].[MedRec_Form_Destination_File_Name] = @MedRec_Form_Destination_File_Name, [dbo].[tbl_case].[MedRec_Receiv_Date] = @MedRec_Receiv_Date, " +
                                                    "[dbo].[tbl_case].[Unknown_Form] = @Unknown_Form, [dbo].[tbl_case].[Unknown_Form_File_Name] = @Unknown_Form_File_Name, " +
                                                    "[dbo].[tbl_case].[Unknown_Form_Destination_File_Name] = @Unknown_Form_Destination_File_Name, [dbo].[tbl_case].[Unknown_Receiv_Date] = @Unknown_Receiv_Date, " +
                                                    "[dbo].[tbl_case].[Note] = @CaseNote, [dbo].[tbl_case].[Log_ID] = @Log_Id, [dbo].[tbl_case].[AddBill_Form] = @AddBill_Form, " +
                                                    "[dbo].[tbl_case].[AddBill_Receiv_Date] = @AddBill_Receiv_Date, [dbo].[tbl_case].[Remove_Log] = @Remove_Log, " +
                                                    "[dbo].[tbl_case].[Case_status] = @CaseStatus " +
                                                    "where [dbo].[tbl_case].[Case_Name] = @Case_Id";

                        SqlCommand cmdUpdateCase = new SqlCommand(strSqlUpdateCase, connRN4);
                        cmdUpdateCase.CommandType = CommandType.Text;

                        cmdUpdateCase.Parameters.AddWithValue("@ModifiDate", caseDetail.ModificationDate);
                        cmdUpdateCase.Parameters.AddWithValue("@ModifiStaff", caseDetail.ModifyingStaff);
                        cmdUpdateCase.Parameters.AddWithValue("@NPF_Form", caseDetail.NPF_Form);
                        cmdUpdateCase.Parameters.AddWithValue("@NPF_Form_File_Name", caseDetail.NPF_Form_File_Name);
                        cmdUpdateCase.Parameters.AddWithValue("@NPF_Form_Destination_File_Name", caseDetail.NPF_Form_Destination_File_Name);
                        if (caseDetail.NPF_ReceivedDate != null) cmdUpdateCase.Parameters.AddWithValue("@NPF_Receiv_Date", caseDetail.NPF_ReceivedDate);
                        else cmdUpdateCase.Parameters.AddWithValue("@NPF_Receiv_Date", DBNull.Value);

                        cmdUpdateCase.Parameters.AddWithValue("@IB_Form", caseDetail.IB_Form);
                        cmdUpdateCase.Parameters.AddWithValue("@IB_Form_File_Name", caseDetail.IB_Form_File_Name);
                        cmdUpdateCase.Parameters.AddWithValue("@IB_Form_Destination_File_Name", caseDetail.IB_Form_Destination_File_Name);
                        if (caseDetail.IB_ReceivedDate != null) cmdUpdateCase.Parameters.AddWithValue("@IB_Receiv_Date", caseDetail.IB_ReceivedDate);
                        else cmdUpdateCase.Parameters.AddWithValue("@IB_Receiv_Date", DBNull.Value);

                        cmdUpdateCase.Parameters.AddWithValue("@POP_Form", caseDetail.POP_Form);
                        cmdUpdateCase.Parameters.AddWithValue("@POP_Form_File_Name", caseDetail.POP_Form_File_Name);
                        cmdUpdateCase.Parameters.AddWithValue("@POP_Form_Destination_File_Name", caseDetail.POP_Form_Destionation_File_Name);
                        if (caseDetail.POP_ReceivedDate != null) cmdUpdateCase.Parameters.AddWithValue("@POP_Receiv_Date", caseDetail.POP_ReceivedDate);
                        else cmdUpdateCase.Parameters.AddWithValue("@POP_Receiv_Date", DBNull.Value);

                        cmdUpdateCase.Parameters.AddWithValue("@MedRec_Form", caseDetail.MedicalRecord_Form);
                        cmdUpdateCase.Parameters.AddWithValue("@MedRec_Form_File_Name", caseDetail.MedRec_Form_File_Name);
                        cmdUpdateCase.Parameters.AddWithValue("@MedRec_Form_Destination_File_Name", caseDetail.MedRec_Form_Destination_File_Name);
                        if (caseDetail.MedRec_ReceivedDate != null) cmdUpdateCase.Parameters.AddWithValue("@MedRec_Receiv_Date", caseDetail.MedRec_ReceivedDate);
                        else cmdUpdateCase.Parameters.AddWithValue("@MedRec_Receiv_Date", DBNull.Value);

                        cmdUpdateCase.Parameters.AddWithValue("@Unknown_Form", caseDetail.Unknown_Form);
                        cmdUpdateCase.Parameters.AddWithValue("@Unknown_Form_File_Name", caseDetail.Unknown_Form_File_Name);
                        cmdUpdateCase.Parameters.AddWithValue("@Unknown_Form_Destination_File_Name", caseDetail.Unknown_Form_Destination_File_Name);
                        if (caseDetail.Unknown_ReceivedDate != null) cmdUpdateCase.Parameters.AddWithValue("@Unknown_Receiv_Date", caseDetail.Unknown_ReceivedDate);
                        else cmdUpdateCase.Parameters.AddWithValue("@Unknown_Receiv_Date", DBNull.Value);

                        cmdUpdateCase.Parameters.AddWithValue("@CaseNote", caseDetail.Note);
                        cmdUpdateCase.Parameters.AddWithValue("@Log_Id", caseDetail.Log_Id);
                        cmdUpdateCase.Parameters.AddWithValue("@AddBill_Form", caseDetail.AddBill_Form);
                        if (caseDetail.AddBill_Received_Date != null) cmdUpdateCase.Parameters.AddWithValue("@AddBill_Receiv_Date", caseDetail.AddBill_Received_Date);
                        else cmdUpdateCase.Parameters.AddWithValue("@AddBill_Receiv_Date", DBNull.Value);

                        cmdUpdateCase.Parameters.AddWithValue("@Remove_Log", caseDetail.Remove_Log);

                        cmdUpdateCase.Parameters.AddWithValue("@CaseStatus", caseDetail.Status);

                        cmdUpdateCase.Parameters.AddWithValue("@Case_Id", caseDetail.CaseId);

                        //if (connRN.State == ConnectionState.Closed) connRN.Open();
                        if (connRN4.State != ConnectionState.Closed)
                        {
                            connRN4.Close();
                            connRN4.Open();
                        }
                        else if (connRN4.State == ConnectionState.Closed) connRN4.Open();
                        int nRowAffected = cmdUpdateCase.ExecuteNonQuery();
                        if (connRN4.State != ConnectionState.Closed) connRN4.Close();

                        if (nRowAffected == 1)
                        {
                            MessageBox.Show("The change has been saved.", "Information");

                            btnNewMedBill_Case.Enabled = true;
                            btnEditMedBill.Enabled = true;
                            btnDeleteMedBill.Enabled = true;
                        }
                        else if (nRowAffected == 0) MessageBox.Show("The change has not been saved.", "Error");
                    }

                    //tbCMMManager.TabPages.Remove(tbpgCreateCase);
                    //tbCMMManager.SelectedTab = tbCMMManager.TabPages["tbpgCaseView"];

                    if (tbCMMManager.Contains(tbpgMedicalBill)) tbCMMManager.TabPages.Remove(tbpgMedicalBill);
                    if (tbCMMManager.Contains(tbpgCreateCase)) tbCMMManager.TabPages.Remove(tbpgCreateCase);
                    //if (tbCMMManager.Contains(tbpgCaseView)) tbCMMManager.TabPages.Remove(tbpgCaseView);
                    //if (tbCMMManager.Contains(tbpgIndividual)) tbCMMManager.TabPages.Remove(tbpgIndividual);
                    tbCMMManager.SelectedIndex = 3;

                    return;
                }
                else if (dlgResult == DialogResult.No)
                {
                    if (tbCMMManager.Contains(tbpgMedicalBill)) tbCMMManager.TabPages.Remove(tbpgMedicalBill);
                    if (tbCMMManager.Contains(tbpgCreateCase)) tbCMMManager.TabPages.Remove(tbpgCreateCase);
                    tbCMMManager.SelectedIndex = 3;
                    return;
                }
                //else if (dlgResult == DialogResult.Cancel)
                //{
                //    return;
                //}
            }
            else return;

            //tbCMMManager.TabPages.Remove(tbpgCreateCase);
            //tbCMMManager.SelectedIndex = 3;
        }

        private void chkMedRecordReceived_CheckedChanged(object sender, EventArgs e)
        {
            CheckBox chkMedRecord = sender as CheckBox;

            if (chkMedRecord.Checked)
            {
                dtpMedBillMedRecord.Format = DateTimePickerFormat.Short;
            }
            else
            {
                dtpMedBillMedRecord.Format = DateTimePickerFormat.Custom;
                dtpMedBillMedRecord.CustomFormat = " ";
            }
        }

        private void chkMedBillNPFReceived_CheckedChanged(object sender, EventArgs e)
        {
            CheckBox chkNPF = sender as CheckBox;

            if (chkNPF.Checked)
            {
                dtpMedBillNPF.Format = DateTimePickerFormat.Short;
            }
            else
            {
                dtpMedBillNPF.Format = DateTimePickerFormat.Custom;
                dtpMedBillNPF.CustomFormat = " ";
            }

        }

        private void chkMedBill_IBReceived_CheckedChanged(object sender, EventArgs e)
        {
            CheckBox chkIB = sender as CheckBox;

            if (chkIB.Checked)
            {
                dtpMedBill_IB.Format = DateTimePickerFormat.Short;
            }
            else
            {
                dtpMedBill_IB.Format = DateTimePickerFormat.Custom;
                dtpMedBill_IB.CustomFormat = " ";
            }
        }

        private void chkMedBillPOPReceived_CheckedChanged(object sender, EventArgs e)
        {
            CheckBox chkPOP = sender as CheckBox;

            if (chkPOP.Checked) dtpMedBillPOP.Format = DateTimePickerFormat.Short;
            else
            {
                dtpMedBillPOP.Format = DateTimePickerFormat.Custom;
                dtpMedBillPOP.CustomFormat = " ";
            }
        }

        private void chkOtherDocReceived_CheckedChanged(object sender, EventArgs e)
        {
            CheckBox chkOtherDoc = sender as CheckBox;

            if (chkOtherDoc.Checked) dtpMedBillOtherDoc.Format = DateTimePickerFormat.Short;
            else
            {
                dtpMedBillOtherDoc.Format = DateTimePickerFormat.Custom;
                dtpMedBillOtherDoc.CustomFormat = " ";
            }
        }

        private void btnMedBill_Illness_Click(object sender, EventArgs e)
        {

            frmIllness frmIllnessList = new frmIllness();

            String IndividualId = txtIndividualIDMedBill.Text;
            DateTime? dtStartDate = null;

            if (txtMembershipStartDate.Text.Trim() != String.Empty) dtStartDate = DateTime.Parse(txtMembershipStartDate.Text.Trim());
            else
            {
                String strSqlQueryForMembershipStartDate = "select [dbo].[contact].[Membership_IND_Start_date__c] from [dbo].[contact] where [dbo].[contact].[Individual_ID__c] = @IndividualId";

                SqlCommand cmdQueryForMembershipStartDate = new SqlCommand(strSqlQueryForMembershipStartDate, connSalesforce2);
                cmdQueryForMembershipStartDate.CommandType = CommandType.Text;

                cmdQueryForMembershipStartDate.Parameters.AddWithValue("@IndividualId", IndividualId);

                if (connSalesforce2.State != ConnectionState.Closed)
                {
                    connSalesforce2.Close();
                    connSalesforce2.Open();
                }
                else if (connSalesforce2.State == ConnectionState.Closed) connSalesforce2.Open();
                Object objMembershipStartDate = cmdQueryForMembershipStartDate.ExecuteScalar();
                if (connSalesforce2.State != ConnectionState.Closed) connSalesforce2.Close();

                if (objMembershipStartDate != null) dtStartDate = (DateTime)objMembershipStartDate;
            }

            frmIllnessList.nLoggedInUserId = nLoggedUserId;
            frmIllnessList.LoggedInUserRole = LoggedInUserRole;

            frmIllnessList.strCaseIdIllness = strCaseIdForIllness;
            frmIllnessList.strIndividualId = IndividualId;

            frmIllnessList.IllnessSelected.IllnessId = Illness.IllnessId;
            frmIllnessList.IllnessSelected.IllnessNo = Illness.IllnessNo;
            frmIllnessList.IllnessNo = txtMedBill_Illness.Text.Trim();
            frmIllnessList.OldIllnessNo = txtMedBill_Illness.Text.Trim();
            frmIllnessList.IllnessSelected.ICD10Code = Illness.ICD10Code;
            frmIllnessList.strCaseIdIllness = txtMedBill_CaseNo.Text.Trim();
            frmIllnessList.MembershipStartDate = dtStartDate.Value;

            frmIllnessList.ShowDialog(this);

            if (frmIllnessList.SelectedOption == IllnessOption.Select)
            {

                Illness.IllnessId = frmIllnessList.IllnessSelected.IllnessId;
                Illness.IllnessNo = frmIllnessList.IllnessSelected.IllnessNo;
                Illness.ICD10Code = frmIllnessList.IllnessSelected.ICD10Code;

                txtMedBill_Illness.Text = Illness.IllnessNo;

                String strQueryForDiseaseName = "select [dbo].[ICD10 Code].[Name] from [dbo].[ICD10 Code] where [dbo].[ICD10 Code].[ICD10_CODE__C] = @ICD10Code";

                SqlCommand cmdQueryForDiseaseName = new SqlCommand(strQueryForDiseaseName, connSalesforce2);
                cmdQueryForDiseaseName.CommandType = CommandType.Text;
                cmdQueryForDiseaseName.CommandText = strQueryForDiseaseName;

                cmdQueryForDiseaseName.Parameters.AddWithValue("@ICD10Code", Illness.ICD10Code);

                if (connSalesforce2.State == ConnectionState.Open)
                {
                    connSalesforce2.Close();
                    connSalesforce2.Open();
                }
                else if (connSalesforce2.State == ConnectionState.Closed) connSalesforce2.Open();

                SqlDataReader rdrDiseaseName = cmdQueryForDiseaseName.ExecuteReader();

                txtMedBill_ICD10Code.Text = String.Empty;
                txtMedBillDiseaseName.Text = String.Empty;

                if (rdrDiseaseName.HasRows)
                {
                    rdrDiseaseName.Read();

                    txtMedBill_ICD10Code.Text = Illness.ICD10Code;
                    txtMedBillDiseaseName.Text = rdrDiseaseName.GetString(0);
                }
                rdrDiseaseName.Close();
                if (connSalesforce2.State == ConnectionState.Open) connSalesforce2.Close();

                if (frmIllnessList.OldIllnessNo != frmIllnessList.NewIllnessNo)
                {
                    txtIncdProgram.Text = String.Empty;
                    txtMedBill_Incident.Text = String.Empty;
                }

                gvSettlementsInMedBill.Rows.Clear();

                ////////////////////////////////////////////////////////////////////////////////////////////////////
                //String strSqlQueryForSettlement = "select [dbo].[tbl_settlement].[Name], [dbo].[tbl_settlement_type_code].[SettlementTypeValue], [dbo].[tbl_settlement].[Amount], " +
                //                  "[dbo].[tbl_settlement].[PersonalResponsibilityCredit], [dbo].[tbl_payment_method].[PaymentMethod_Value], " +
                //                  "[dbo].[tbl_settlement].[Approved], [dbo].[tbl_settlement].[ApprovedDate], " +
                //                  "[dbo].[tbl_settlement].[CheckNo], [dbo].[tbl_settlement].[CheckDate], [dbo].[tbl_settlement].[CheckReconciled], " +
                //                  "[dbo].[tbl_settlement].[ACH_Number], [dbo].[tbl_settlement].[ACH_Date], [dbo].[tbl_settlement].[ACH_Reconciled], " +
                //                  "[dbo].[tbl_Credit_Card__c].[Name], [dbo].[tbl_settlement].[CMMCreditCardPaidDate], [dbo].[tbl_settlement].[CC_Reconciled], " +
                //                  "[dbo].[tbl_settlement].[AllowedAmount], [dbo].[tbl_settlement].[IneligibleReason], " +
                //                  "[dbo].[tbl_settlement].[Notes] " +
                //                  "from [dbo].[tbl_settlement] " +
                //                  "inner join [dbo].[tbl_settlement_type_code] on [dbo].[tbl_settlement].[SettlementType] = [dbo].[tbl_settlement_type_code].[SettlementTypeCode] " +
                //                  "inner join [dbo].[tbl_payment_method] on [dbo].[tbl_settlement].[CMMPaymentMethod] = [dbo].[tbl_payment_method].[PaymentMethod_Id] " +
                //                  "inner join [dbo].[tbl_Credit_Card__c] on [dbo].[tbl_settlement].[CMMCreditCard] = [dbo].[tbl_Credit_Card__c].[CreditCard_Id] " +
                //                  "inner join [dbo].[tbl_medbill] on [dbo].[tbl_settlement].[MedicalBillID] = [dbo].[tbl_medbill].[BillNo] " +
                //                  "inner join [dbo].[tbl_illness] on [dbo].[tbl_medbill].[Illness_Id] = [dbo].[tbl_illness].[Illness_Id] " +
                //                  "where[dbo].[tbl_illness].[Illness_Id] = @IllnessId and [dbo].[tbl_settlement].[IsDeleted] = 0 " +
                //                  "order by [dbo].[tbl_settlement].[Name]";

                //SqlCommand cmdQueryForSettlement = new SqlCommand(strSqlQueryForSettlement, connRN);
                //cmdQueryForSettlement.CommandType = CommandType.Text;

                ////cmdQueryForSettlement.Parameters.AddWithValue("@MedBillNo", MedBillNo);
                //cmdQueryForSettlement.Parameters.AddWithValue("@IllnessId", Illness.IllnessId);

                ////SqlDependency dependencySettlementInMedBill = new SqlDependency(cmdQueryForSettlement);
                ////dependencySettlementInMedBill.OnChange += new OnChangeEventHandler(OnSettlementsInMedBillEditChange);

                ////if (connRN.State == ConnectionState.Closed) connRN.Open();
                //if (connRN.State != ConnectionState.Closed)
                //{
                //    connRN.Close();
                //    connRN.Open();
                //}
                //else if (connRN.State == ConnectionState.Closed) connRN.Open();
                //SqlDataReader rdrSettlement = cmdQueryForSettlement.ExecuteReader();
                //gvSettlementsInMedBill.Rows.Clear();
                //if (rdrSettlement.HasRows)
                //{
                //    while (rdrSettlement.Read())
                //    {
                //        DataGridViewRow row = new DataGridViewRow();
                //        row.Cells.Add(new DataGridViewCheckBoxCell { Value = false });
                //        if (!rdrSettlement.IsDBNull(0)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlement.GetString(0) });
                //        if (!rdrSettlement.IsDBNull(1))
                //        {
                //            DataGridViewComboBoxCell comboCellSettlementType = new DataGridViewComboBoxCell();

                //            for (int i = 0; i < lstSettlementType.Count; i++)
                //            {
                //                comboCellSettlementType.Items.Add(lstSettlementType[i].SettlementTypeValue);
                //            }
                //            for (int i = 0; i < comboCellSettlementType.Items.Count; i++)
                //            {
                //                if (rdrSettlement.GetString(1) == comboCellSettlementType.Items[i].ToString())
                //                    comboCellSettlementType.Value = comboCellSettlementType.Items[i];
                //            }

                //            row.Cells.Add(comboCellSettlementType);
                //        }
                //        else
                //        {
                //            DataGridViewComboBoxCell comboCellSettlementType = new DataGridViewComboBoxCell();
                //            for (int i = 0; i < lstSettlementType.Count; i++)
                //            {
                //                comboCellSettlementType.Items.Add(lstSettlementType[i].SettlementTypeValue);
                //            }

                //            for (int i = 0; i < comboCellSettlementType.Items.Count; i++)
                //            {
                //                if (rdrSettlement.GetString(1) == comboCellSettlementType.Items[i].ToString())
                //                    comboCellSettlementType.Value = comboCellSettlementType.Items[i];
                //            }

                //            row.Cells.Add(comboCellSettlementType);
                //        }

                //        if (!rdrSettlement.IsDBNull(2)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlement.GetDecimal(2).ToString("C") });
                //        else
                //        {
                //            Decimal Zero = 0;
                //            row.Cells.Add(new DataGridViewTextBoxCell { Value = Zero.ToString("C") });
                //        }


                //        if (!rdrSettlement.IsDBNull(3)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlement.GetDecimal(3).ToString("C") });
                //        else
                //        {
                //            Decimal Zero = 0;
                //            row.Cells.Add(new DataGridViewTextBoxCell { Value = Zero.ToString("C") });
                //        }

                //        /////////////////////////////////////////////////////////////////////
                //        if (!rdrSettlement.IsDBNull(4))
                //        {
                //            DataGridViewComboBoxCell comboCellPaymentMethod = new DataGridViewComboBoxCell();

                //            for (int i = 0; i < lstPaymentMethod.Count; i++)
                //            {
                //                if (lstPaymentMethod[i].PaymentMethodValue != null) comboCellPaymentMethod.Items.Add(lstPaymentMethod[i].PaymentMethodValue);
                //                else comboCellPaymentMethod.Items.Add(String.Empty);
                //            }

                //            for (int i = 0; i < comboCellPaymentMethod.Items.Count; i++)
                //            {
                //                if (rdrSettlement.GetString(4) == comboCellPaymentMethod.Items[i].ToString())
                //                    comboCellPaymentMethod.Value = comboCellPaymentMethod.Items[i];
                //            }

                //            row.Cells.Add(comboCellPaymentMethod);
                //        }
                //        else
                //        {
                //            DataGridViewComboBoxCell comboCellPaymentMethod = new DataGridViewComboBoxCell();

                //            for (int i = 0; i < lstPaymentMethod.Count; i++)
                //            {
                //                if (lstPaymentMethod[i].PaymentMethodValue != null) comboCellPaymentMethod.Items.Add(lstPaymentMethod[i].PaymentMethodValue);
                //                else comboCellPaymentMethod.Items.Add(String.Empty);
                //                //comboCellPaymentMethod.Items.Add(lstPaymentMethod[i].PaymentMethodValue);
                //            }

                //            for (int i = 0; i < comboCellPaymentMethod.Items.Count; i++)
                //            {
                //                if ((!rdrSettlement.IsDBNull(4)) && comboCellPaymentMethod.Items[i] != null)
                //                {
                //                    if (rdrSettlement.GetString(4) == comboCellPaymentMethod.Items[i].ToString())
                //                        comboCellPaymentMethod.Value = comboCellPaymentMethod.Items[i];
                //                }
                //                else comboCellPaymentMethod.Value = null;
                //            }

                //            row.Cells.Add(comboCellPaymentMethod);

                //        }

                //        /////////////////////////////////////////////////////////////////////
                //        if (!rdrSettlement.IsDBNull(5))
                //        {

                //            DataGridViewCheckBoxCell approvedCell = new DataGridViewCheckBoxCell();
                //            approvedCell.Value = rdrSettlement.GetBoolean(5);
                //            approvedCell.Style.Alignment = DataGridViewContentAlignment.MiddleCenter;
                //            row.Cells.Add(approvedCell);
                //        }
                //        else
                //        {
                //            DataGridViewCheckBoxCell approvedCell = new DataGridViewCheckBoxCell();
                //            approvedCell.Value = false;
                //            approvedCell.Style.Alignment = DataGridViewContentAlignment.MiddleCenter;
                //            row.Cells.Add(approvedCell);
                //        }

                //        if (!rdrSettlement.IsDBNull(6)) row.Cells.Add(new CalendarCell { Value = DateTime.Parse(rdrSettlement.GetDateTime(6).ToString("MM/dd/yyyy")) });
                //        else row.Cells.Add(new CalendarCell { Value = null });

                //        // Payment information
                //        if (!rdrSettlement.IsDBNull(4))
                //        {
                //            String strPaymentMethod = rdrSettlement.GetString(4);

                //            switch (strPaymentMethod)
                //            {
                //                case "Check":
                //                    if (!rdrSettlement.IsDBNull(7)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlement.GetString(7) });
                //                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = null });
                //                    row.Cells.Add(new DataGridViewTextBoxCell { Value = null });
                //                    DataGridViewComboBoxCell comboCellCreditCardNoneForCheck = new DataGridViewComboBoxCell();
                //                    for (int i = 0; i < lstCreditCardInfo.Count; i++)
                //                    {
                //                        if (lstCreditCardInfo[i].CreditCardNo != null) comboCellCreditCardNoneForCheck.Items.Add(lstCreditCardInfo[i].CreditCardNo);
                //                        else comboCellCreditCardNoneForCheck.Items.Add(String.Empty);
                //                    }
                //                    row.Cells.Add(comboCellCreditCardNoneForCheck);
                //                    if (!rdrSettlement.IsDBNull(8)) row.Cells.Add(new CalendarCell { Value = DateTime.Parse(rdrSettlement.GetDateTime(8).ToString("MM/dd/yyyy")) });
                //                    if (!rdrSettlement.IsDBNull(9)) row.Cells.Add(new DataGridViewCheckBoxCell { Value = rdrSettlement.GetBoolean(9) });
                //                    break;
                //                case "ACH/Banking":
                //                    row.Cells.Add(new DataGridViewTextBoxCell { Value = null });
                //                    if (!rdrSettlement.IsDBNull(10)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlement.GetString(10) });
                //                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = null });
                //                    DataGridViewComboBoxCell comboCellCreditCardNoneForACH = new DataGridViewComboBoxCell();
                //                    for (int i = 0; i < lstCreditCardInfo.Count; i++)
                //                    {
                //                        if (lstCreditCardInfo[i].CreditCardNo != null)
                //                            comboCellCreditCardNoneForACH.Items.Add(lstCreditCardInfo[i].CreditCardNo);
                //                        else comboCellCreditCardNoneForACH.Items.Add(String.Empty);
                //                    }
                //                    row.Cells.Add(comboCellCreditCardNoneForACH);
                //                    if (!rdrSettlement.IsDBNull(11)) row.Cells.Add(new CalendarCell { Value = DateTime.Parse(rdrSettlement.GetDateTime(11).ToString("MM/dd/yyyy")) });
                //                    if (!rdrSettlement.IsDBNull(12)) row.Cells.Add(new DataGridViewCheckBoxCell { Value = rdrSettlement.GetBoolean(12) });
                //                    break;
                //                case "Credit Card":
                //                    row.Cells.Add(new DataGridViewTextBoxCell { Value = null });
                //                    row.Cells.Add(new DataGridViewTextBoxCell { Value = null });
                //                    DataGridViewComboBoxCell comboCellCreditCard = new DataGridViewComboBoxCell();
                //                    if (!rdrSettlement.IsDBNull(13))
                //                    {
                //                        for (int i = 0; i < lstCreditCardInfo.Count; i++)
                //                        {
                //                            if (lstCreditCardInfo[i].CreditCardNo != null) comboCellCreditCard.Items.Add(lstCreditCardInfo[i].CreditCardNo);
                //                            else comboCellCreditCard.Items.Add(String.Empty);
                //                        }
                //                        for (int i = 0; i < comboCellCreditCard.Items.Count; i++)
                //                        {
                //                            if (rdrSettlement.GetString(13) == comboCellCreditCard.Items[i].ToString())
                //                                comboCellCreditCard.Value = comboCellCreditCard.Items[i];
                //                        }
                //                    }
                //                    else
                //                    {
                //                        //DataGridViewComboBoxCell comboCellCreditCard = new DataGridViewComboBoxCell();
                //                        for (int i = 0; i < lstCreditCardInfo.Count; i++)
                //                        {
                //                            if (lstCreditCardInfo[i].CreditCardNo != null) comboCellCreditCard.Items.Add(lstCreditCardInfo[i].CreditCardNo);
                //                            else comboCellCreditCard.Items.Add(String.Empty);
                //                        }
                //                        comboCellCreditCard.Value = String.Empty;
                //                        //row.Cells.Add(comboCellCreditCard);
                //                    }
                //                    row.Cells.Add(comboCellCreditCard);
                //                    if (!rdrSettlement.IsDBNull(14)) row.Cells.Add(new CalendarCell { Value = DateTime.Parse(rdrSettlement.GetDateTime(14).ToString("MM/dd/yyyy")) });
                //                    else row.Cells.Add(new CalendarCell { Value = String.Empty });
                //                    if (!rdrSettlement.IsDBNull(15)) row.Cells.Add(new DataGridViewCheckBoxCell { Value = rdrSettlement.GetBoolean(15) });
                //                    else row.Cells.Add(new DataGridViewCheckBoxCell { Value = false });
                //                    break;
                //                default:
                //                    row.Cells.Add(new DataGridViewTextBoxCell { Value = null });
                //                    row.Cells.Add(new DataGridViewTextBoxCell { Value = null });
                //                    DataGridViewComboBoxCell comboCellCreditCardNone = new DataGridViewComboBoxCell();
                //                    for (int i = 0; i < lstCreditCardInfo.Count; i++)
                //                    {
                //                        if (lstCreditCardInfo[i].CreditCardNo != null) comboCellCreditCardNone.Items.Add(lstCreditCardInfo[i].CreditCardNo);
                //                        else comboCellCreditCardNone.Items.Add(String.Empty);
                //                    }
                //                    row.Cells.Add(comboCellCreditCardNone);
                //                    row.Cells.Add(new CalendarCell { Value = null });
                //                    row.Cells.Add(new DataGridViewCheckBoxCell { Value = null });
                //                    break;
                //            }
                //        }
                //        else
                //        {

                //            DataGridViewTextBoxCell txtCheckNoCell = new DataGridViewTextBoxCell();
                //            txtCheckNoCell.Value = null;
                //            row.Cells.Add(txtCheckNoCell);
                //            DataGridViewTextBoxCell txtACHNoCell = new DataGridViewTextBoxCell();
                //            txtACHNoCell.Value = null;
                //            row.Cells.Add(txtACHNoCell);
                //            DataGridViewComboBoxCell comboCreditCardCell = new DataGridViewComboBoxCell();
                //            for (int i = 0; i < lstCreditCardInfo.Count; i++)
                //            {
                //                if (lstCreditCardInfo[i].CreditCardNo != null) comboCreditCardCell.Items.Add(lstCreditCardInfo[i].CreditCardNo);
                //                else comboCreditCardCell.Items.Add(String.Empty);
                //            }
                //            row.Cells.Add(comboCreditCardCell);
                //            comboCreditCardCell.ReadOnly = true;
                //            CalendarCell calPaymentDate = new CalendarCell();
                //            calPaymentDate.Value = null;
                //            row.Cells.Add(calPaymentDate);
                //            DataGridViewCheckBoxCell chkReconciledCell = new DataGridViewCheckBoxCell();
                //            chkReconciledCell.Value = false;
                //            row.Cells.Add(chkReconciledCell);

                //        }


                //        if (!rdrSettlement.IsDBNull(16)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlement.GetDecimal(16).ToString("C") });
                //        else row.Cells.Add(new DataGridViewTextBoxCell { Value = null });

                //        if (!rdrSettlement.IsDBNull(17))
                //        {
                //            if (dicIneligibleReason.Count > 0)
                //            {
                //                DataGridViewComboBoxCell comboCellIneligibleReason = new DataGridViewComboBoxCell();
                //                for (int i = 0; i < dicIneligibleReason.Count; i++)
                //                {
                //                    comboCellIneligibleReason.Items.Add(dicIneligibleReason[i]);
                //                }
                //                comboCellIneligibleReason.Value = comboCellIneligibleReason.Items[rdrSettlement.GetInt32(17)];
                //                row.Cells.Add(comboCellIneligibleReason);
                //            }
                //        }
                //        else
                //        {
                //            if (dicIneligibleReason.Count > 0)
                //            {
                //                DataGridViewComboBoxCell comboCellIneligibleReason = new DataGridViewComboBoxCell();
                //                for (int i = 0; i < dicIneligibleReason.Count; i++)
                //                {
                //                    comboCellIneligibleReason.Items.Add(dicIneligibleReason[i]);
                //                }
                //                comboCellIneligibleReason.Value = comboCellIneligibleReason.Items[0];
                //                row.Cells.Add(comboCellIneligibleReason);
                //            }
                //        }

                //        if (!rdrSettlement.IsDBNull(18)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlement.GetString(18) });
                //        else row.Cells.Add(new DataGridViewTextBoxCell { Value = null });

                //        gvSettlementsInMedBill.Rows.Add(row);
                //        //AddNewRowToGVSettlementSafely(row);
                //    }
                //}
                //if (connRN.State != ConnectionState.Closed) connRN.Close();

                ////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                ///
                //Decimal PersonalResponsibilityAmount = 0;

                //foreach (IncidentProgramInfo incdProgram in lstIncidentProgramInfo)
                //{
                //    if (incdProgram.bPersonalResponsibilityProgram == true) PersonalResponsibilityAmount = incdProgram.PersonalResponsibilityAmount;
                //}

                //for (int i = 0; i < gvSettlementsInMedBill.Rows.Count; i++)
                //{
                //    if (gvSettlementsInMedBill["PersonalResponsibility", i]?.Value != null)
                //    {
                //        Decimal result = 0;
                //        if (Decimal.TryParse(gvSettlementsInMedBill["PersonalResponsibility", i]?.Value?.ToString(), NumberStyles.Currency, new CultureInfo("en-US"), out result))
                //        {
                //            PersonalResponsibilityAmount -= result;
                //        }
                //    }
                //}

                //txtPersonalResponsibility.Text = PersonalResponsibilityAmount.ToString("C");

                //if (PersonalResponsibilityAmount < 0) txtPersonalResponsibility.BackColor = Color.Yellow;

                ////////////////////////////////////////////////////////////////////////////////////////////////////////////////

                //for (int i = 0; i < gvSettlementsInMedBill.Rows.Count; i++)
                //{
                //    if (gvSettlementsInMedBill["PaymentMethod", i]?.Value?.ToString() == "Check")
                //    {
                //        gvSettlementsInMedBill.Rows[i].Cells["CheckNo"].ReadOnly = false;
                //        gvSettlementsInMedBill.Rows[i].Cells["PaymentDate"].ReadOnly = false;
                //        gvSettlementsInMedBill.Rows[i].Cells["Reconciled"].ReadOnly = false;
                //        gvSettlementsInMedBill.Rows[i].Cells["ACHNo"].ReadOnly = true;
                //        gvSettlementsInMedBill.Rows[i].Cells["CreditCard"].ReadOnly = true;
                //    }

                //    if (gvSettlementsInMedBill["PaymentMethod", i]?.Value?.ToString() == "ACH/Banking")
                //    {
                //        gvSettlementsInMedBill.Rows[i].Cells["ACHNo"].ReadOnly = false;
                //        gvSettlementsInMedBill.Rows[i].Cells["PaymentDate"].ReadOnly = false;
                //        gvSettlementsInMedBill.Rows[i].Cells["Reconciled"].ReadOnly = false;
                //        gvSettlementsInMedBill.Rows[i].Cells["CheckNo"].ReadOnly = true;
                //        gvSettlementsInMedBill.Rows[i].Cells["CreditCard"].ReadOnly = true;
                //    }

                //    if (gvSettlementsInMedBill["PaymentMethod", i]?.Value?.ToString() == "Credit Card")
                //    {
                //        gvSettlementsInMedBill.Rows[i].Cells["CreditCard"].ReadOnly = false;
                //        gvSettlementsInMedBill.Rows[i].Cells["PaymentDate"].ReadOnly = false;
                //        gvSettlementsInMedBill.Rows[i].Cells["Reconciled"].ReadOnly = false;
                //        gvSettlementsInMedBill.Rows[i].Cells["CheckNo"].ReadOnly = true;
                //        gvSettlementsInMedBill.Rows[i].Cells["ACHNo"].ReadOnly = true;
                //    }
                //    if (gvSettlementsInMedBill["PaymentMethod", i]?.Value == null)
                //    {
                //        gvSettlementsInMedBill.Rows[i].Cells["CheckNo"].ReadOnly = true;
                //        gvSettlementsInMedBill.Rows[i].Cells["ACHNo"].ReadOnly = true;
                //        gvSettlementsInMedBill.Rows[i].Cells["CreditCard"].ReadOnly = true;
                //        gvSettlementsInMedBill.Rows[i].Cells["PaymentDate"].ReadOnly = true;
                //        gvSettlementsInMedBill.Rows[i].Cells["Reconciled"].ReadOnly = true;
                //    }
                //}

                //for (int i = 0; i < gvSettlementsInMedBill.Rows.Count; i++)
                //{
                //    if (gvSettlementsInMedBill[2, i]?.Value?.ToString() == "Ineligible") gvSettlementsInMedBill.Rows[i].DefaultCellStyle.BackColor = Color.Red;
                //    else
                //    {
                //        gvSettlementsInMedBill["IneligibleReason", i].Value = null;
                //        gvSettlementsInMedBill["IneligibleReason", i].ReadOnly = true;
                //    }
                //}

                //if (txtMedBillAmount.Text.Trim() != String.Empty)
                //{
                //    Decimal SettlementTotal = 0;
                //    Decimal Balance = 0;
                //    Decimal Result = 0;
                //    Decimal BillAmount = 0;
                //    if (Decimal.TryParse(txtMedBillAmount.Text.Trim(), NumberStyles.Currency, new CultureInfo("en-US"), out Result))
                //    {
                //        BillAmount = Result;

                //        for (int i = 0; i < gvSettlementsInMedBill.Rows.Count; i++)
                //        {
                //            Decimal Settlement = Decimal.Parse(gvSettlementsInMedBill["SettlementAmount", i].Value.ToString(), NumberStyles.Currency, new CultureInfo("en-US"));
                //            SettlementTotal += Settlement;
                //        }
                //        if (SettlementTotal > BillAmount) MessageBox.Show("Settlement Total exceeds the Medical Bill Amount.", "Alert");
                //        else
                //        {
                //            Balance = BillAmount - SettlementTotal;
                //            txtBalance.Text = Balance.ToString("C");
                //        }
                //    }
                //}

                //btnAddNewSettlement.Enabled = true;
                ////btnEditSettlement.Enabled = true;
                //btnSaveSettlement.Enabled = true;
                //btnDeleteSettlement.Enabled = true;


                ////////////////////////////////////////////////////////////////////////////////////////////////////
                return;
            }
            else if (frmIllnessList.SelectedOption == IllnessOption.Close)
            {
                txtMedBill_Illness.Text = String.Empty;

                Illness.IllnessId = String.Empty;
                Illness.IllnessNo = String.Empty;
                Illness.ICD10Code = String.Empty;
                return;
            }
            else if (frmIllnessList.SelectedOption == IllnessOption.Cancel)
            {
                return;
            }
        }

        private void btnMedBill_Incident_Click(object sender, EventArgs e)
        {
            frmIncident frmIncidentList = new frmIncident();

            //frmIncidentList.StartPosition = FormStartPosition.CenterParent;

            //DialogResult dlgResult = frmIncidentList.ShowDialog();

            //String IncidentId = txtMedBill_Incident.Text.Trim();
            String IncidentId = String.Empty; //frmIncidentList.IncidentSelected.IncidentId;

            //if (dlgResult == DialogResult.OK)
            //{
            //    IncidentId = frmIncidentList.IncidentSelected.IncidentId;
            //}

            String IndividualId = txtIndividualIDMedBill.Text.Trim();
            //frmIncidentList.IncidentSelected.IncidentNo = txtMedBill_Incident.Text.Trim();

            //String IncidentId = txtMedBill_Incident.Text.Trim();
            strCaseIdForIllness = txtMedBill_CaseNo.Text.Trim();

            // 02/13/19 begin here to get Individual Id, Case Id, Illness Id, Incident Id to get Incident No
            if (txtMedBill_Illness.Text != String.Empty)
            {
                frmIncidentList.IndividualId = IndividualId;
                frmIncidentList.CaseId = strCaseIdForIllness;
                frmIncidentList.IllnessId = Illness.IllnessId;
                frmIncidentList.IllnessNo = txtMedBill_Illness.Text.Trim();
                frmIncidentList.IncidentSelected.IncidentNo = txtMedBill_Incident.Text.Trim();
                frmIncidentList.IncidentSelected.IncidentId = Incident.IncidentId;
                //frmIncidentList.ICD10Code = Illness.ICD10Code;
                frmIncidentList.nLoggedInId = nLoggedUserId;
                frmIncidentList.LoggedInUserRole = LoggedInUserRole;
                //frmIncidentList.IncidentSelected.IncidentId = IncidentId;

                DialogResult dlgIncident = frmIncidentList.ShowDialog(this);

                //if (dlgIncident == DialogResult.OK)
                if (frmIncidentList.SelectedOption == IncidentOption.Select)
                {
                    //txtMedBill_Incident.Text = frmIncidentList.IncidentSelected.IncidentId;
                    txtMedBill_Incident.Text = frmIncidentList.IncidentSelected.IncidentNo;
                    Incident.IncidentId = frmIncidentList.IncidentSelected.IncidentId;
                    IncidentId = frmIncidentList.IncidentSelected.IncidentId;


                    //
                    // This section is needed to calculate personal responsibility

                    //String strSqlQueryForNewPRBalance = ""
                    //String IncidentNo = txtMedBill_Incident.Text.Trim();
                    //String IndividualId = txtCaseIndividualID.Text.Trim();

                    //String strSqlQueryForIncidentChange = "select [cdc].[dbo_tbl_incident_CT].[Program_id], [dbo].[tbl_program].[ProgramName] from [cdc].[dbo_tbl_incident_CT] " +
                    //                                      "inner join [dbo].[tbl_program] on [cdc].[dbo_tbl_incident_CT].[Program_id] = [dbo].[tbl_program].[Program_Id] " +
                    //                                      "where [cdc].[dbo_tbl_incident_CT].[Incident_id] = @IncidentId and [cdc].[dbo_tbl_incident_CT].[Individual_id] = @IndividualId and " +
                    //                                      "([cdc].[dbo_tbl_incident_CT].[__$operation] = 2 or [cdc].[dbo_tbl_incident_CT].[__$operation] = 3 or " +
                    //                                      "[cdc].[dbo_tbl_incident_CT].[__$operation] = 4) " +      // capture incident program for insert, update
                    //                                      "order by [cdc].[dbo_tbl_incident_CT].[Program_id]";

                    //SqlCommand cmdQueryForIncidentChange = new SqlCommand(strSqlQueryForIncidentChange, connRN);
                    //cmdQueryForIncidentChange.CommandType = CommandType.Text;

                    //cmdQueryForIncidentChange.Parameters.AddWithValue("@IncidentId", IncidentId);
                    //cmdQueryForIncidentChange.Parameters.AddWithValue("@IndividualId", IndividualId);

                    //connRN.Open();
                    //SqlDataReader rdrIncidentChange = cmdQueryForIncidentChange.ExecuteReader();
                    //if (rdrIncidentChange.HasRows)
                    //{
                    //    while (rdrIncidentChange.Read())
                    //    {
                    //        //lstIncidentProgramInfo.Add(new IncidentProgramInfo { IncidentProgramId = rdrIncidentChange.GetInt16(0), IncidentProgramName = rdrIncidentChange.GetString(1).Trim() });
                    //        IncidentProgramInfo incidentProgram = new IncidentProgramInfo(rdrIncidentChange.GetInt16(0), rdrIncidentChange.GetString(1).Trim());
                    //        lstIncidentProgramInfo.Add(incidentProgram);
                    //    }
                    //}
                    //connRN.Close();

                    //Boolean bBronze = false;
                    //Boolean bSilver = false;
                    //Boolean bGold = false;
                    //Boolean bGoldPlus = false;
                    //Boolean bGoldMed1 = false;
                    //Boolean bGoldMed2 = false;

                    //foreach (IncidentProgramInfo incidentInfo in lstIncidentProgramInfo)
                    //{
                    //    if (incidentInfo.IncidentProgramId == 3)
                    //    {
                    //        incidentInfo.bPersonalResponsibilityProgram = true;
                    //        bBronze = true;
                    //        break;
                    //    }
                    //}

                    //foreach (IncidentProgramInfo incidentInfo in lstIncidentProgramInfo)
                    //{
                    //    if ((incidentInfo.IncidentProgramId == 2) && (bBronze == false))
                    //    {
                    //        incidentInfo.bPersonalResponsibilityProgram = true;
                    //        bSilver = true;
                    //        break;
                    //    }
                    //}

                    //foreach (IncidentProgramInfo incidentInfo in lstIncidentProgramInfo)
                    //{
                    //    if ((incidentInfo.IncidentProgramId == 1) && (bBronze == false) && (bSilver == false))
                    //    {
                    //        incidentInfo.bPersonalResponsibilityProgram = true;
                    //        break;
                    //    }
                    //}

                    //foreach (IncidentProgramInfo incidentInfo in lstIncidentProgramInfo)
                    //{
                    //    if ((incidentInfo.IncidentProgramId == 0) && (bBronze == false) && (bSilver == false) && (bGold == false))
                    //    {
                    //        incidentInfo.bPersonalResponsibilityProgram = true;
                    //        break;
                    //    }
                    //}

                    //foreach (IncidentProgramInfo incidentInfo in lstIncidentProgramInfo)
                    //{
                    //    if ((incidentInfo.IncidentProgramId == 4) && (bBronze == false) && (bSilver == false) && (bGold == false) && (bGoldPlus == false))
                    //    {
                    //        incidentInfo.bPersonalResponsibilityProgram = true;
                    //        break;
                    //    }
                    //}

                    //foreach (IncidentProgramInfo incidentInfo in lstIncidentProgramInfo)
                    //{
                    //    if ((incidentInfo.IncidentProgramId == 5) && (bBronze == false) && (bSilver == false) && (bGold == false) && (bGoldPlus == false) && (bGoldMed1 == false))
                    //    {
                    //        incidentInfo.bPersonalResponsibilityProgram = true;
                    //        break;
                    //    }
                    //}

                    //foreach (IncidentProgramInfo incidentInfo in lstIncidentProgramInfo)
                    //{
                    //    if (incidentInfo.bPersonalResponsibilityProgram == true)
                    //        PersonalResponsibilityAmountInMedBill = incidentInfo.PersonalResponsibilityAmount;
                    //}


                    //Decimal PersonalResponsibilityAmount = 0;

                    //foreach (IncidentProgramInfo incdProgram in lstIncidentProgramInfo)
                    //{
                    //    if (incdProgram.bPersonalResponsibilityProgram == true) PersonalResponsibilityAmount = incdProgram.PersonalResponsibilityAmount;
                    //}

                    //for (int i = 0; i < gvSettlementsInMedBill.Rows.Count; i++)
                    //{
                    //    if (gvSettlementsInMedBill["PersonalResponsibility", i]?.Value != null)
                    //    {
                    //        Decimal result = 0;
                    //        if (Decimal.TryParse(gvSettlementsInMedBill["PersonalResponsibility", i]?.Value?.ToString(), NumberStyles.Currency, new CultureInfo("en-US"), out result))
                    //        {
                    //            PersonalResponsibilityAmount -= result;
                    //        }
                    //    }
                    //}

                    //txtPersonalResponsibility.Text = PersonalResponsibilityAmount.ToString("C");
                    //if (PersonalResponsibilityAmount < 0) txtPersonalResponsibility.BackColor = Color.Yellow;

                    String strSqlQueryForIncidentProgram = "select [dbo].[tbl_program].[ProgramName] from [dbo].[tbl_program] " +
                                                           "inner join [dbo].[tbl_incident] on [dbo].[tbl_program].[Program_Id] = [dbo].[tbl_incident].[Program_id] " +
                                                           "where [dbo].[tbl_incident].[Incident_id] = @IncidentId and [dbo].[tbl_incident].[Individual_id] = @IndividualId";

                    SqlCommand cmdQueryForIncidentProgram = new SqlCommand(strSqlQueryForIncidentProgram, connRN);
                    cmdQueryForIncidentProgram.CommandType = CommandType.Text;

                    cmdQueryForIncidentProgram.Parameters.AddWithValue("@IncidentId", IncidentId);
                    cmdQueryForIncidentProgram.Parameters.AddWithValue("@IndividualId", IndividualId);

                    //if (connRN.State == ConnectionState.Closed) connRN.Open();
                    if (connRN.State != ConnectionState.Closed)
                    {
                        connRN.Close();
                        connRN.Open();
                    }
                    else if (connRN.State == ConnectionState.Closed) connRN.Open();
                    Object objProgramName = cmdQueryForIncidentProgram.ExecuteScalar();
                    if (connRN.State != ConnectionState.Closed) connRN.Close();

                    String ProgramName = String.Empty;

                    if (objProgramName != null)
                    {
                        ProgramName = objProgramName.ToString();
                    }
                    else
                    {
                        MessageBox.Show("No Program name for the given incident: " + IncidentId, "Error", MessageBoxButtons.OK);
                        return;
                    }

                    if (ProgramName != String.Empty) txtIncdProgram.Text = ProgramName.Trim();

                    if (txtMemberProgram.Text.Trim() == txtIncdProgram.Text.Trim())
                    {
                        txtMemberProgram.BackColor = Color.White;
                        txtIncdProgram.BackColor = Color.White;
                    }
                    else
                    {
                        txtMemberProgram.BackColor = Color.Red;
                        txtIncdProgram.BackColor = Color.Red;
                    }

                    //String strSqlQueryForIncidentProgram = "select [dbo].[tbl_incident].[Program_id] from [dbo].[tbl_incident] " +
                    //                   "where [dbo].[tbl_incident].[Individual_id] = @IndividualId and" +
                    //                   "[dbo].[tbl_incidend].[Case_id] = @CaseId and " +
                    //                   "[dbo].[tbl_incident].[Illness_id] = @IllnessId and " +
                    //                   "[dbo].[tbl_incident].[IncidentNo] = @IncidentNo";



                    //String strSqlQueryForIncidentProgramId = "select [dbo].[tbl_incident].[IncidentNo] from [dbo].[tbl_incident] " +
                    //                                         "where [dbo].[tbl_incident]."

                    ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                    String strSqlQueryForSettlement = "select [dbo].[tbl_settlement].[Name], [dbo].[tbl_settlement_type_code].[SettlementTypeValue], [dbo].[tbl_settlement].[Amount], " +
                                              "[dbo].[tbl_settlement].[PersonalResponsibilityCredit], [dbo].[tbl_payment_method].[PaymentMethod_Value], " +
                                              "[dbo].[tbl_settlement].[Approved], [dbo].[tbl_settlement].[ApprovedDate], " +
                                              "[dbo].[tbl_settlement].[CheckNo], [dbo].[tbl_settlement].[CheckDate], [dbo].[tbl_settlement].[CheckReconciled], " +
                                              "[dbo].[tbl_settlement].[ACH_Number], [dbo].[tbl_settlement].[ACH_Date], [dbo].[tbl_settlement].[ACH_Reconciled], " +
                                              "[dbo].[tbl_Credit_Card__c].[Name], [dbo].[tbl_settlement].[CMMCreditCardPaidDate], [dbo].[tbl_settlement].[CC_Reconciled], " +
                                              "[dbo].[tbl_settlement].[AllowedAmount], [dbo].[tbl_settlement].[IneligibleReason], " +
                                              "[dbo].[tbl_settlement].[Notes] " +
                                              "from [dbo].[tbl_settlement] " +
                                              "inner join [dbo].[tbl_settlement_type_code] on [dbo].[tbl_settlement].[SettlementType] = [dbo].[tbl_settlement_type_code].[SettlementTypeCode] " +
                                              "inner join [dbo].[tbl_payment_method] on [dbo].[tbl_settlement].[CMMPaymentMethod] = [dbo].[tbl_payment_method].[PaymentMethod_Id] " +
                                              "inner join [dbo].[tbl_Credit_Card__c] on [dbo].[tbl_settlement].[CMMCreditCard] = [dbo].[tbl_Credit_Card__c].[CreditCard_Id] " +
                                              "inner join [dbo].[tbl_medbill] on [dbo].[tbl_settlement].[MedicalBillID] = [dbo].[tbl_medbill].[BillNo] " +
                                              "inner join [dbo].[tbl_illness] on [dbo].[tbl_medbill].[Illness_Id] = [dbo].[tbl_illness].[Illness_Id] " +
                                              "inner join [dbo].[tbl_incident] on [dbo].[tbl_medbill].[Incident_Id] = [dbo].[tbl_incident].[Incident_Id] " +
                                              "where [dbo].[tbl_medbill].[BillNo] = @MedBillNo and " +
                                              "[dbo].[tbl_illness].[Illness_Id] = @IllnessId and " +
                                              "[dbo].[tbl_incident].[Incident_Id] = @IncidentId and " +
                                              "[dbo].[tbl_settlement].[IsDeleted] = 0 " +
                                              "order by [dbo].[tbl_settlement].[Name]";

                    SqlCommand cmdQueryForSettlement = new SqlCommand(strSqlQueryForSettlement, connRN);
                    cmdQueryForSettlement.CommandType = CommandType.Text;

                    cmdQueryForSettlement.Parameters.AddWithValue("@MedBillNo", txtMedBillNo.Text.Trim());
                    cmdQueryForSettlement.Parameters.AddWithValue("@IllnessId", Int32.Parse(Illness.IllnessId));
                    cmdQueryForSettlement.Parameters.AddWithValue("@IncidentId", Int32.Parse(Incident.IncidentId));

                    //SqlDependency dependencySettlementInMedBill = new SqlDependency(cmdQueryForSettlement);
                    //dependencySettlementInMedBill.OnChange += new OnChangeEventHandler(OnSettlementsInMedBillEditChange);

                    //if (connRN.State == ConnectionState.Closed) connRN.Open();
                    if (connRN.State != ConnectionState.Closed)
                    {
                        connRN.Close();
                        connRN.Open();
                    }
                    else if (connRN.State == ConnectionState.Closed) connRN.Open();
                    SqlDataReader rdrSettlement = cmdQueryForSettlement.ExecuteReader();
                    gvSettlementsInMedBill.Rows.Clear();
                    if (rdrSettlement.HasRows)
                    {
                        while (rdrSettlement.Read())
                        {
                            DataGridViewRow row = new DataGridViewRow();
                            row.Cells.Add(new DataGridViewCheckBoxCell { Value = false });
                            if (!rdrSettlement.IsDBNull(0)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlement.GetString(0) });
                            if (!rdrSettlement.IsDBNull(1))
                            {
                                DataGridViewComboBoxCell comboCellSettlementType = new DataGridViewComboBoxCell();

                                for (int i = 0; i < lstSettlementType.Count; i++)
                                {
                                    comboCellSettlementType.Items.Add(lstSettlementType[i].SettlementTypeValue);
                                }
                                for (int i = 0; i < comboCellSettlementType.Items.Count; i++)
                                {
                                    if (rdrSettlement.GetString(1) == comboCellSettlementType.Items[i].ToString())
                                        comboCellSettlementType.Value = comboCellSettlementType.Items[i];
                                }

                                row.Cells.Add(comboCellSettlementType);
                            }
                            else
                            {
                                DataGridViewComboBoxCell comboCellSettlementType = new DataGridViewComboBoxCell();
                                for (int i = 0; i < lstSettlementType.Count; i++)
                                {
                                    comboCellSettlementType.Items.Add(lstSettlementType[i].SettlementTypeValue);
                                }

                                for (int i = 0; i < comboCellSettlementType.Items.Count; i++)
                                {
                                    if (rdrSettlement.GetString(1) == comboCellSettlementType.Items[i].ToString())
                                        comboCellSettlementType.Value = comboCellSettlementType.Items[i];
                                }

                                row.Cells.Add(comboCellSettlementType);
                            }

                            if (!rdrSettlement.IsDBNull(2)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlement.GetDecimal(2).ToString("C") });
                            else
                            {
                                Decimal Zero = 0;
                                row.Cells.Add(new DataGridViewTextBoxCell { Value = Zero.ToString("C") });
                            }


                            if (!rdrSettlement.IsDBNull(3)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlement.GetDecimal(3).ToString("C") });
                            else
                            {
                                Decimal Zero = 0;
                                row.Cells.Add(new DataGridViewTextBoxCell { Value = Zero.ToString("C") });
                            }

                            /////////////////////////////////////////////////////////////////////
                            if (!rdrSettlement.IsDBNull(4))
                            {
                                DataGridViewComboBoxCell comboCellPaymentMethod = new DataGridViewComboBoxCell();

                                for (int i = 0; i < lstPaymentMethod.Count; i++)
                                {
                                    if (lstPaymentMethod[i].PaymentMethodValue != null) comboCellPaymentMethod.Items.Add(lstPaymentMethod[i].PaymentMethodValue);
                                    else comboCellPaymentMethod.Items.Add(String.Empty);
                                }

                                for (int i = 0; i < comboCellPaymentMethod.Items.Count; i++)
                                {
                                    if (rdrSettlement.GetString(4) == comboCellPaymentMethod.Items[i].ToString())
                                        comboCellPaymentMethod.Value = comboCellPaymentMethod.Items[i];
                                }

                                row.Cells.Add(comboCellPaymentMethod);
                            }
                            else
                            {
                                DataGridViewComboBoxCell comboCellPaymentMethod = new DataGridViewComboBoxCell();

                                for (int i = 0; i < lstPaymentMethod.Count; i++)
                                {
                                    if (lstPaymentMethod[i].PaymentMethodValue != null) comboCellPaymentMethod.Items.Add(lstPaymentMethod[i].PaymentMethodValue);
                                    else comboCellPaymentMethod.Items.Add(String.Empty);
                                    //comboCellPaymentMethod.Items.Add(lstPaymentMethod[i].PaymentMethodValue);
                                }

                                for (int i = 0; i < comboCellPaymentMethod.Items.Count; i++)
                                {
                                    if ((!rdrSettlement.IsDBNull(4)) && comboCellPaymentMethod.Items[i] != null)
                                    {
                                        if (rdrSettlement.GetString(4) == comboCellPaymentMethod.Items[i].ToString())
                                            comboCellPaymentMethod.Value = comboCellPaymentMethod.Items[i];
                                    }
                                    else comboCellPaymentMethod.Value = null;
                                }

                                row.Cells.Add(comboCellPaymentMethod);

                            }

                            /////////////////////////////////////////////////////////////////////
                            if (!rdrSettlement.IsDBNull(5))
                            {

                                DataGridViewCheckBoxCell approvedCell = new DataGridViewCheckBoxCell();
                                approvedCell.Value = rdrSettlement.GetBoolean(5);
                                approvedCell.Style.Alignment = DataGridViewContentAlignment.MiddleCenter;
                                row.Cells.Add(approvedCell);
                            }
                            else
                            {
                                DataGridViewCheckBoxCell approvedCell = new DataGridViewCheckBoxCell();
                                approvedCell.Value = false;
                                approvedCell.Style.Alignment = DataGridViewContentAlignment.MiddleCenter;
                                row.Cells.Add(approvedCell);
                            }

                            if (!rdrSettlement.IsDBNull(6)) row.Cells.Add(new CalendarCell { Value = DateTime.Parse(rdrSettlement.GetDateTime(6).ToString("MM/dd/yyyy")) });
                            else row.Cells.Add(new CalendarCell { Value = null });

                            // Payment information
                            if (!rdrSettlement.IsDBNull(4))
                            {
                                String strPaymentMethod = rdrSettlement.GetString(4);

                                switch (strPaymentMethod)
                                {
                                    case "Check":
                                        if (!rdrSettlement.IsDBNull(7)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlement.GetString(7) });
                                        else row.Cells.Add(new DataGridViewTextBoxCell { Value = null });
                                        row.Cells.Add(new DataGridViewTextBoxCell { Value = null });
                                        DataGridViewComboBoxCell comboCellCreditCardNoneForCheck = new DataGridViewComboBoxCell();
                                        for (int i = 0; i < lstCreditCardInfo.Count; i++)
                                        {
                                            if (lstCreditCardInfo[i].CreditCardNo != null) comboCellCreditCardNoneForCheck.Items.Add(lstCreditCardInfo[i].CreditCardNo);
                                            else comboCellCreditCardNoneForCheck.Items.Add(String.Empty);
                                        }
                                        row.Cells.Add(comboCellCreditCardNoneForCheck);
                                        if (!rdrSettlement.IsDBNull(8)) row.Cells.Add(new CalendarCell { Value = DateTime.Parse(rdrSettlement.GetDateTime(8).ToString("MM/dd/yyyy")) });
                                        else row.Cells.Add(new CalendarCell { Value = String.Empty });
                                        if (!rdrSettlement.IsDBNull(9)) row.Cells.Add(new DataGridViewCheckBoxCell { Value = rdrSettlement.GetBoolean(9) });
                                        else row.Cells.Add(new DataGridViewCheckBoxCell { Value = false });
                                        break;
                                    case "ACH/Banking":
                                        row.Cells.Add(new DataGridViewTextBoxCell { Value = null });
                                        if (!rdrSettlement.IsDBNull(10)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlement.GetString(10) });
                                        else row.Cells.Add(new DataGridViewTextBoxCell { Value = null });
                                        DataGridViewComboBoxCell comboCellCreditCardNoneForACH = new DataGridViewComboBoxCell();
                                        for (int i = 0; i < lstCreditCardInfo.Count; i++)
                                        {
                                            if (lstCreditCardInfo[i].CreditCardNo != null)
                                                comboCellCreditCardNoneForACH.Items.Add(lstCreditCardInfo[i].CreditCardNo);
                                            else comboCellCreditCardNoneForACH.Items.Add(String.Empty);
                                        }
                                        row.Cells.Add(comboCellCreditCardNoneForACH);
                                        if (!rdrSettlement.IsDBNull(11)) row.Cells.Add(new CalendarCell { Value = DateTime.Parse(rdrSettlement.GetDateTime(11).ToString("MM/dd/yyyy")) });
                                        else row.Cells.Add(new CalendarCell { Value = String.Empty });
                                        if (!rdrSettlement.IsDBNull(12)) row.Cells.Add(new DataGridViewCheckBoxCell { Value = rdrSettlement.GetBoolean(12) });
                                        else row.Cells.Add(new DataGridViewCheckBoxCell { Value = false });
                                        break;
                                    case "Credit Card":
                                        row.Cells.Add(new DataGridViewTextBoxCell { Value = null });
                                        row.Cells.Add(new DataGridViewTextBoxCell { Value = null });
                                        DataGridViewComboBoxCell comboCellCreditCard = new DataGridViewComboBoxCell();
                                        if (!rdrSettlement.IsDBNull(13))
                                        {
                                            for (int i = 0; i < lstCreditCardInfo.Count; i++)
                                            {
                                                if (lstCreditCardInfo[i].CreditCardNo != null) comboCellCreditCard.Items.Add(lstCreditCardInfo[i].CreditCardNo);
                                                else comboCellCreditCard.Items.Add(String.Empty);
                                            }
                                            for (int i = 0; i < comboCellCreditCard.Items.Count; i++)
                                            {
                                                if (rdrSettlement.GetString(13) == comboCellCreditCard.Items[i].ToString())
                                                    comboCellCreditCard.Value = comboCellCreditCard.Items[i];
                                            }
                                        }
                                        else
                                        {
                                            //DataGridViewComboBoxCell comboCellCreditCard = new DataGridViewComboBoxCell();
                                            for (int i = 0; i < lstCreditCardInfo.Count; i++)
                                            {
                                                if (lstCreditCardInfo[i].CreditCardNo != null) comboCellCreditCard.Items.Add(lstCreditCardInfo[i].CreditCardNo);
                                                else comboCellCreditCard.Items.Add(String.Empty);
                                            }
                                            comboCellCreditCard.Value = String.Empty;
                                            //row.Cells.Add(comboCellCreditCard);
                                        }
                                        row.Cells.Add(comboCellCreditCard);
                                        if (!rdrSettlement.IsDBNull(14)) row.Cells.Add(new CalendarCell { Value = DateTime.Parse(rdrSettlement.GetDateTime(14).ToString("MM/dd/yyyy")) });
                                        else row.Cells.Add(new CalendarCell { Value = String.Empty });
                                        if (!rdrSettlement.IsDBNull(15)) row.Cells.Add(new DataGridViewCheckBoxCell { Value = rdrSettlement.GetBoolean(15) });
                                        else row.Cells.Add(new DataGridViewCheckBoxCell { Value = false });
                                        break;
                                    default:
                                        row.Cells.Add(new DataGridViewTextBoxCell { Value = null });
                                        row.Cells.Add(new DataGridViewTextBoxCell { Value = null });
                                        DataGridViewComboBoxCell comboCellCreditCardNone = new DataGridViewComboBoxCell();
                                        for (int i = 0; i < lstCreditCardInfo.Count; i++)
                                        {
                                            if (lstCreditCardInfo[i].CreditCardNo != null) comboCellCreditCardNone.Items.Add(lstCreditCardInfo[i].CreditCardNo);
                                            else comboCellCreditCardNone.Items.Add(String.Empty);
                                        }
                                        row.Cells.Add(comboCellCreditCardNone);
                                        row.Cells.Add(new CalendarCell { Value = null });
                                        row.Cells.Add(new DataGridViewCheckBoxCell { Value = null });
                                        break;
                                }
                            }
                            else
                            {

                                DataGridViewTextBoxCell txtCheckNoCell = new DataGridViewTextBoxCell();
                                txtCheckNoCell.Value = null;
                                row.Cells.Add(txtCheckNoCell);
                                DataGridViewTextBoxCell txtACHNoCell = new DataGridViewTextBoxCell();
                                txtACHNoCell.Value = null;
                                row.Cells.Add(txtACHNoCell);
                                DataGridViewComboBoxCell comboCreditCardCell = new DataGridViewComboBoxCell();
                                for (int i = 0; i < lstCreditCardInfo.Count; i++)
                                {
                                    if (lstCreditCardInfo[i].CreditCardNo != null) comboCreditCardCell.Items.Add(lstCreditCardInfo[i].CreditCardNo);
                                    else comboCreditCardCell.Items.Add(String.Empty);
                                }
                                row.Cells.Add(comboCreditCardCell);
                                comboCreditCardCell.ReadOnly = true;
                                CalendarCell calPaymentDate = new CalendarCell();
                                calPaymentDate.Value = null;
                                row.Cells.Add(calPaymentDate);
                                DataGridViewCheckBoxCell chkReconciledCell = new DataGridViewCheckBoxCell();
                                chkReconciledCell.Value = false;
                                row.Cells.Add(chkReconciledCell);

                            }


                            if (!rdrSettlement.IsDBNull(16)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlement.GetDecimal(16).ToString("C") });
                            else row.Cells.Add(new DataGridViewTextBoxCell { Value = null });

                            if (!rdrSettlement.IsDBNull(17))
                            {
                                if (dicIneligibleReason.Count > 0)
                                {
                                    DataGridViewComboBoxCell comboCellIneligibleReason = new DataGridViewComboBoxCell();
                                    for (int i = 0; i < dicIneligibleReason.Count; i++)
                                    {
                                        comboCellIneligibleReason.Items.Add(dicIneligibleReason[i]);
                                    }
                                    //comboCellIneligibleReason.Sorted = true;
                                    comboCellIneligibleReason.Value = comboCellIneligibleReason.Items[rdrSettlement.GetInt32(17)];
                                    row.Cells.Add(comboCellIneligibleReason);
                                }
                            }
                            else
                            {
                                if (dicIneligibleReason.Count > 0)
                                {
                                    DataGridViewComboBoxCell comboCellIneligibleReason = new DataGridViewComboBoxCell();
                                    for (int i = 0; i < dicIneligibleReason.Count; i++)
                                    {
                                        comboCellIneligibleReason.Items.Add(dicIneligibleReason[i]);
                                    }
                                    //comboCellIneligibleReason.Sorted = true;
                                    comboCellIneligibleReason.Value = comboCellIneligibleReason.Items[0];
                                    row.Cells.Add(comboCellIneligibleReason);
                                }
                            }

                            if (!rdrSettlement.IsDBNull(18)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlement.GetString(18) });
                            else row.Cells.Add(new DataGridViewTextBoxCell { Value = null });

                            gvSettlementsInMedBill.Rows.Add(row);
                            //AddNewRowToGVSettlementSafely(row);
                        }
                    }
                    rdrSettlement.Close();
                    if (connRN.State != ConnectionState.Closed) connRN.Close();

                    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                    ///
                    //Decimal PersonalResponsibilityAmount = 0;

                    //foreach (IncidentProgramInfo incdProgram in lstIncidentProgramInfo)
                    //{
                    //    if (incdProgram.bPersonalResponsibilityProgram == true) PersonalResponsibilityAmount = incdProgram.PersonalResponsibilityAmount;
                    //}

                    //for (int i = 0; i < gvSettlementsInMedBill.Rows.Count; i++)
                    //{
                    //    if (gvSettlementsInMedBill["PersonalResponsibility", i]?.Value != null)
                    //    {
                    //        Decimal result = 0;
                    //        if (Decimal.TryParse(gvSettlementsInMedBill["PersonalResponsibility", i]?.Value?.ToString(), NumberStyles.Currency, new CultureInfo("en-US"), out result))
                    //        {
                    //            PersonalResponsibilityAmount -= result;
                    //        }
                    //    }
                    //}

                    //txtPersonalResponsibility.Text = PersonalResponsibilityAmount.ToString("C");

                    //if (PersonalResponsibilityAmount < 0) txtPersonalResponsibility.BackColor = Color.Yellow;

                    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////

                    for (int i = 0; i < gvSettlementsInMedBill.Rows.Count; i++)
                    {
                        if (gvSettlementsInMedBill["PaymentMethod", i]?.Value?.ToString() == "Check")
                        {
                            gvSettlementsInMedBill.Rows[i].Cells["CheckNo"].ReadOnly = false;
                            gvSettlementsInMedBill.Rows[i].Cells["PaymentDate"].ReadOnly = false;
                            gvSettlementsInMedBill.Rows[i].Cells["Reconciled"].ReadOnly = false;
                            gvSettlementsInMedBill.Rows[i].Cells["ACHNo"].ReadOnly = true;
                            gvSettlementsInMedBill.Rows[i].Cells["CreditCard"].ReadOnly = true;
                        }

                        if (gvSettlementsInMedBill["PaymentMethod", i]?.Value?.ToString() == "ACH/Banking")
                        {
                            gvSettlementsInMedBill.Rows[i].Cells["ACHNo"].ReadOnly = false;
                            gvSettlementsInMedBill.Rows[i].Cells["PaymentDate"].ReadOnly = false;
                            gvSettlementsInMedBill.Rows[i].Cells["Reconciled"].ReadOnly = false;
                            gvSettlementsInMedBill.Rows[i].Cells["CheckNo"].ReadOnly = true;
                            gvSettlementsInMedBill.Rows[i].Cells["CreditCard"].ReadOnly = true;
                        }

                        if (gvSettlementsInMedBill["PaymentMethod", i]?.Value?.ToString() == "Credit Card")
                        {
                            gvSettlementsInMedBill.Rows[i].Cells["CreditCard"].ReadOnly = false;
                            gvSettlementsInMedBill.Rows[i].Cells["PaymentDate"].ReadOnly = false;
                            gvSettlementsInMedBill.Rows[i].Cells["Reconciled"].ReadOnly = false;
                            gvSettlementsInMedBill.Rows[i].Cells["CheckNo"].ReadOnly = true;
                            gvSettlementsInMedBill.Rows[i].Cells["ACHNo"].ReadOnly = true;
                        }
                        if (gvSettlementsInMedBill["PaymentMethod", i]?.Value == null)
                        {
                            gvSettlementsInMedBill.Rows[i].Cells["CheckNo"].ReadOnly = true;
                            gvSettlementsInMedBill.Rows[i].Cells["ACHNo"].ReadOnly = true;
                            gvSettlementsInMedBill.Rows[i].Cells["CreditCard"].ReadOnly = true;
                            gvSettlementsInMedBill.Rows[i].Cells["PaymentDate"].ReadOnly = true;
                            gvSettlementsInMedBill.Rows[i].Cells["Reconciled"].ReadOnly = true;
                        }
                    }

                    for (int i = 0; i < gvSettlementsInMedBill.Rows.Count; i++)
                    {
                        if (gvSettlementsInMedBill[2, i]?.Value?.ToString() == "Ineligible") gvSettlementsInMedBill.Rows[i].DefaultCellStyle.BackColor = Color.Salmon;
                        else
                        {
                            gvSettlementsInMedBill["IneligibleReason", i].Value = null;
                            gvSettlementsInMedBill["IneligibleReason", i].ReadOnly = true;
                        }
                    }

                    if (txtMedBillAmount.Text.Trim() != String.Empty)
                    {
                        Decimal SettlementTotal = 0;
                        Decimal Balance = 0;
                        Decimal Result = 0;
                        Decimal BillAmount = 0;
                        if (Decimal.TryParse(txtMedBillAmount.Text.Trim(), NumberStyles.Currency, new CultureInfo("en-US"), out Result))
                        {
                            BillAmount = Result;

                            for (int i = 0; i < gvSettlementsInMedBill.Rows.Count; i++)
                            {
                                //if (gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == ")
                                Decimal Settlement = 0;
                                if (gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "3rd Party Discount" ||
                                    gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "Member Payment" ||
                                    gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "CMM Provider Payment" ||
                                    gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "CMM Discount" ||
                                    gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "CMM Member Reimbursement" ||
                                    gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "Ineligible" ||
                                    gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "Medical Provider Refund" ||
                                    gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "PR Reimbursement" ||
                                    gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "Member Discount")
                                {
                                    Settlement = Decimal.Parse(gvSettlementsInMedBill["SettlementAmount", i]?.Value?.ToString(), NumberStyles.Currency, new CultureInfo("en-US"));
                                    SettlementTotal += Settlement;
                                }
                            }
                            if (SettlementTotal > BillAmount) MessageBox.Show("Settlement Total exceeds the Medical Bill Amount.", "Alert");
                            else
                            {
                                Balance = BillAmount - SettlementTotal;
                                txtBalance.Text = Balance.ToString("C");
                            }
                        }
                    }

                    //btnAddNewSettlement.Enabled = true;
                    ////btnEditSettlement.Enabled = true;
                    //btnSaveSettlement.Enabled = true;
                    //btnDeleteSettlement.Enabled = true;

                    ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                }
                else if (frmIncidentList.SelectedOption == IncidentOption.Close)
                {
                    txtIncdProgram.Text = String.Empty;
                    txtMedBill_Incident.Text = String.Empty;
                    return;
                }
                else if (frmIncidentList.SelectedOption == IncidentOption.Cancel)
                {
                    return;
                }
                //else if ((dlgIncident == DialogResult.Cancel)&&(frmIncidentList.bIncidentCanceled == true))
                //{

                //}
            }
            else
            {
                MessageBox.Show("No illess", "Information");
            }
        }

        private void btnMedBillCreatePgUpperSave_Click(object sender, EventArgs e)
        {


            if (txtMedBill_Illness.Text.Trim() == String.Empty)
            {
                MessageBox.Show("Please select an Illness.", "Alert", MessageBoxButtons.OK);
                return;
            }
            if (txtMedBill_Incident.Text.Trim() == String.Empty)
            {
                MessageBox.Show("Please select an Incident.", "Alert", MessageBoxButtons.OK);
                return;
            }
            if (txtMedBillAmount.Text.Trim() == String.Empty)
            {
                MessageBox.Show("Please enter Medical Bill Amount.", "Alert", MessageBoxButtons.OK);
                return;
            }
            if (txtMedicalProvider.Text.Trim() == String.Empty)
            {
                MessageBox.Show("Please select a Medical Provider.", "Alert", MessageBoxButtons.OK);
                return;
            }

            if (comboMedBillStatus.SelectedIndex == 0 && comboPendingReason.SelectedIndex == 0)
            {
                MessageBox.Show("Medical bill is in pending status but you didn't select pending reason.", "Alert");
                return;
            }

            if ((comboMedBillStatus.SelectedIndex == 3 || comboMedBillStatus.SelectedIndex == 4) &&
                 comboIneligibleReason.SelectedIndex == 0)
            {
                MessageBox.Show("Medical bill is ineligible or partially ineligible but you didn't select ineligible reason.", "Alert");
                return;
            }

            frmSaveNewMedBill frmSaveMedBill = new frmSaveNewMedBill();

            frmSaveMedBill.StartPosition = FormStartPosition.CenterParent;
            DialogResult dlgResult = frmSaveMedBill.ShowDialog();

            if (dlgResult == DialogResult.Yes)
            {
                Cursor.Current = Cursors.WaitCursor;

                String IncidentNoForIsWellBeing = txtMedBill_Incident.Text.Trim();

                String strSqlQueryForIsWellBeing = "select [dbo].[tbl_incident].[IsWellBeing] from [dbo].[tbl_incident] where [dbo].[tbl_incident].[IncidentNo] = @IncidentNo";

                SqlCommand cmdQueryForIsWellBeing = new SqlCommand(strSqlQueryForIsWellBeing, connRN5);
                cmdQueryForIsWellBeing.CommandType = CommandType.Text;

                cmdQueryForIsWellBeing.Parameters.AddWithValue("@IncidentNo", IncidentNoForIsWellBeing);

                if (connRN5.State != ConnectionState.Closed)
                {
                    connRN5.Close();
                    connRN5.Open();
                }
                else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                Object objIsWellBeing = cmdQueryForIsWellBeing.ExecuteScalar();
                if (connRN5.State != ConnectionState.Closed) connRN5.Close();

                Boolean bWellBeing = false;
                if (objIsWellBeing != null) bWellBeing = (Boolean)objIsWellBeing;


                //if (bWellBeing)
                //{
                //    String IndividualIdForStartDate = txtIndividualIDMedBill.Text.Trim();

                //    String strSqlQueryForMembershipStartDate = "select [dbo].[contact].[Membership_IND_Start_date__c] from [dbo].[contact] " +
                //                                               "where [dbo].[contact].[Individual_ID__c] = @IndividualId";

                //    SqlCommand cmdQueryForMembershipStartDate = new SqlCommand(strSqlQueryForMembershipStartDate, connSalesforce3);
                //    cmdQueryForMembershipStartDate.CommandType = CommandType.Text;

                //    cmdQueryForMembershipStartDate.Parameters.AddWithValue("@IndividualId", IndividualIdForStartDate);

                //    if (connSalesforce3.State != ConnectionState.Closed)
                //    {
                //        connSalesforce3.Close();
                //        connSalesforce3.Open();
                //    }
                //    else if (connSalesforce3.State == ConnectionState.Closed) connSalesforce3.Open();
                //    Object objMembershipIndStartDate = cmdQueryForMembershipStartDate.ExecuteScalar();
                //    if (connSalesforce3.State != ConnectionState.Closed) connSalesforce3.Close();

                //    DateTime? MembershipIndStartDate = null;
                //    if (objMembershipIndStartDate != null) MembershipIndStartDate = DateTime.Parse(objMembershipIndStartDate.ToString());

                //    if (MembershipIndStartDate != null)
                //    {
                //        DateTime? WellBeingEligibleDate = MembershipIndStartDate.Value.AddMonths(6);

                //        if (DateTime.Today > WellBeingEligibleDate.Value)
                //        {
                //            DateTime? AnivDateThisYear = new DateTime(DateTime.Today.Year, MembershipIndStartDate.Value.Month, 1);
                //            DateTime? FromAnivDate = null;
                //            DateTime? ToAnivDate = null;

                //            if (dtpBillDate.Value >= AnivDateThisYear.Value)
                //            {
                //                FromAnivDate = AnivDateThisYear;
                //                ToAnivDate = AnivDateThisYear.Value.AddYears(1);
                //            }
                //            if (dtpBillDate.Value < AnivDateThisYear.Value)
                //            {
                //                FromAnivDate = AnivDateThisYear.Value.AddYears(-1);
                //                ToAnivDate = AnivDateThisYear;
                //            }

                //            String strSqlQueryForWellBeingIncidents = "select distinct([dbo].[tbl_incident].[IncidentNo]) from [dbo].[tbl_incident] " +
                //                                                      "inner join [dbo].[tbl_medbill] on [dbo].[tbl_incident].[Incident_id] = [dbo].[tbl_medbill].[Incident_Id] " +
                //                                                      "where [dbo].[tbl_incident].[IsWellBeing] = 1 and " +
                //                                                      "[dbo].[tbl_incident].[IsDeleted] = 0 and " +
                //                                                      "[dbo].[tbl_incident].[Individual_id] = @IndividualId and " +
                //                                                      "[dbo].[tbl_medbill].[BillDate] >= @FromAnivDate and " +
                //                                                      "[dbo].[tbl_medbill].[BillDate] < @ToAnivDate";

                //            SqlCommand cmdQueryForWellBeingIncidents = new SqlCommand(strSqlQueryForWellBeingIncidents, connRN5);
                //            cmdQueryForWellBeingIncidents.CommandType = CommandType.Text;

                //            cmdQueryForWellBeingIncidents.Parameters.AddWithValue("@IndividualId", IndividualIdForStartDate);
                //            cmdQueryForWellBeingIncidents.Parameters.AddWithValue("@FromAnivDate", FromAnivDate.Value);
                //            cmdQueryForWellBeingIncidents.Parameters.AddWithValue("@ToAnivDate", ToAnivDate.Value);

                //            List<string> lstWellBeingIncidents = new List<string>();

                //            if (connRN5.State != ConnectionState.Closed)
                //            {
                //                connRN5.Close();
                //                connRN5.Open();
                //            }
                //            else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                //            SqlDataReader rdrWellBeingIncidents = cmdQueryForWellBeingIncidents.ExecuteReader();
                //            if (rdrWellBeingIncidents.HasRows)
                //            {
                //                while (rdrWellBeingIncidents.Read())
                //                {
                //                    lstWellBeingIncidents.Add(rdrWellBeingIncidents.GetString(0));
                //                }
                //            }
                //            if (connRN5.State != ConnectionState.Closed) connRN5.Close();

                //            //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                //            ///

                //            Decimal WellBeingIncidentTotalSharedAmount = 0;

                //            foreach (String IncidentNo in lstWellBeingIncidents)
                //            {
                //                String strSqlQueryForWellBeingSharedAmount = "select [dbo].[tbl_incident].[TotalSharedAmount] from [dbo].[tbl_incident] " +
                //                                                             "where [dbo].[tbl_incident].[IncidentNo] = @IncidentNo";

                //                SqlCommand cmdQueryForWellBeingSharedAmount = new SqlCommand(strSqlQueryForWellBeingSharedAmount, connRN5);
                //                cmdQueryForWellBeingSharedAmount.CommandType = CommandType.Text;

                //                cmdQueryForWellBeingSharedAmount.Parameters.AddWithValue("@IncidentNo", IncidentNo);

                //                if (connRN5.State != ConnectionState.Closed)
                //                {
                //                    connRN5.Close();
                //                    connRN5.Open();
                //                }
                //                else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                //                Object objWellBeingSharedAmount = cmdQueryForWellBeingSharedAmount.ExecuteScalar();
                //                if (connRN5.State != ConnectionState.Closed) connRN5.Close();

                //                if (objWellBeingSharedAmount != null) WellBeingIncidentTotalSharedAmount += Decimal.Parse(objWellBeingSharedAmount.ToString());
                //            }

                //            Decimal NewWellBeingIncidentTotalSharedAmount = 0;

                //            Decimal TotalSharedAmountMedBill = 0;
                //            Decimal ResultTotalSharedAmount = 0;
                //            if (Decimal.TryParse(txtTotalSharedAmtMedBill.Text.Trim(), NumberStyles.Currency, new CultureInfo("en-US"), out ResultTotalSharedAmount))
                //                TotalSharedAmountMedBill = ResultTotalSharedAmount;

                //            NewWellBeingIncidentTotalSharedAmount = WellBeingIncidentTotalSharedAmount + TotalSharedAmountMedBill;

                //            if (NewWellBeingIncidentTotalSharedAmount > 500)
                //            {
                //                MessageBox.Show("The Shared Total Amount exceeds $500 and this medical bill is not eligible for Well Being Care.", "Alert");
                //                return;
                //            }

                //            //SqlCommand cmdQueryForWellBeingSharedAmount = new SqlCommand(strSqlQueryForWellBeingSharedAmount, connRN5);
                //            //cmdQueryForWellBeingSharedAmount.CommandType = CommandType.Text;

                //            //cmdQueryForWellBeingSharedAmount.Parameters.AddWithValue("@FromAnivDate", AnivDateOtherYear);
                //            //cmdQueryForWellBeingSharedAmount.Parameters.AddWithValue("@ToAnivDate", AnivDateThisYear);
                //            //cmdQueryForWellBeingSharedAmount.Parameters.AddWithValue("@IndividualId", IndividualIdForStartDate);

                //            //if (connRN5.State != ConnectionState.Closed)
                //            //{
                //            //    connRN5.Close();
                //            //    connRN5.Open();
                //            //}
                //            //else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                //            //Object objWellBeingTotalSharedAmount = cmdQueryForWellBeingSharedAmount.ExecuteScalar();
                //            //if (connRN5.State != ConnectionState.Closed) connRN5.Close();

                //            //Decimal WellBeingTotalSharedAmount = 0;
                //            //if (objWellBeingTotalSharedAmount.ToString() != String.Empty)
                //            //{
                //            //    WellBeingTotalSharedAmount = Decimal.Parse(objWellBeingTotalSharedAmount.ToString());
                //            //}

                //            //Decimal TotalSharedAmountMedBill = 0;
                //            //if (txtTotalSharedAmtMedBill.Text.Trim() != String.Empty)
                //            //{
                //            //    //TotalSharedAmountMedBill = Decimal.Parse(txtTotalSharedAmount.Text.Trim());
                //            //    Decimal ResultTotalSharedAmount = 0;
                //            //    if (Decimal.TryParse(txtTotalSharedAmtMedBill.Text.Trim(), NumberStyles.Currency, new CultureInfo("en-US"), out ResultTotalSharedAmount))
                //            //        TotalSharedAmountMedBill = ResultTotalSharedAmount;

                //            //    WellBeingTotalSharedAmount += TotalSharedAmountMedBill;

                //            //    if (WellBeingTotalSharedAmount > 500)
                //            //    {
                //            //        MessageBox.Show("The Shared Total Amount exceeds $500 and this medical bill is not eligible for Well Being Care.", "Alert");
                //            //        return;
                //            //    }
                //            //}
                //        }
                //        else
                //        {
                //            MessageBox.Show("This Medical Bill is not eligible for Well Being Care.", "Alert");
                //            return;
                //        }
                //    }
                //    else
                //    {
                //        MessageBox.Show("This member doesn't have start date.", "Alert");
                //        //return;
                //    }
                //}


                //string IndividualIdForStartDate = txtIndividualIDMedBill.Text.Trim();

                //String strSqlQueryForMembershipStartDate = "select [dbo].[contact].[Membership_IND_Start_date__c] from [dbo].[contact] " +
                //                                           "[dbo].[contact].[Individual_ID__c] = @IndividualId";

                //SqlCommand cmdQueryForMembershipStartDate = new SqlCommand(strSqlQueryForMembershipStartDate, connSalesforce3);
                //cmdQueryForMembershipStartDate.CommandType = CommandType.Text;

                //cmdQueryForMembershipStartDate.Parameters.AddWithValue("@IndividualId", IndividualIdForStartDate);

                //if (connSalesforce3.State != ConnectionState.Closed)
                //{
                //    connSalesforce3.Close();
                //    connSalesforce3.Open();
                //}
                //else if (connSalesforce3.State == ConnectionState.Closed) connSalesforce3.Open();
                //Object objMembershipStartDate = cmdQueryForMembershipStartDate.ExecuteScalar();
                //if (connSalesforce3.State != ConnectionState.Closed) connSalesforce3.Close();

                //DateTime? MembershipStartDate = null;
                //if (objMembershipStartDate != null) MembershipStartDate = DateTime.Parse(objMembershipStartDate.ToString());

                //DateTime? WellBeingEligibleDate = MembershipStartDate.Value.AddMonths(6);

                //if (DateTime.Today < WellBeingEligibleDate.Value)
                //{

                //}

                ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                String strMedBillNo = txtMedBillNo.Text.Trim();

                String strSqlQueryForMedBill = "select [dbo].[tbl_medbill].[BillNo] from [dbo].[tbl_medbill] where [dbo].[tbl_medbill].[BillNo] = @MedBillNo";

                SqlCommand cmdQueryForMedBill = new SqlCommand(strSqlQueryForMedBill, connRN5);
                cmdQueryForMedBill.Parameters.AddWithValue("@MedBillNo", strMedBillNo);

                if (connRN5.State != ConnectionState.Closed)
                {
                    connRN5.Close();
                    connRN5.Open();
                }
                else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                Object ResultMedBillNo = cmdQueryForMedBill.ExecuteScalar();
                if (connRN5.State != ConnectionState.Closed) connRN5.Close();

                if (ResultMedBillNo == null)
                {
                    String strIndividualId = String.Empty;
                    String strCaseId = String.Empty;
                    String strBillStatus = String.Empty;
                    String strIllnessId = String.Empty;
                    String strIncidentId = String.Empty;

                    String strNewMedBillNo = String.Empty;
                    String strMedProvider = String.Empty;
                    String strPrescriptionName = String.Empty;
                    String strPrescriptionNo = String.Empty;
                    String strPrescriptionDescription = String.Empty;

                    if (txtIndividualIDMedBill.Text.Trim() != String.Empty) strIndividualId = txtIndividualIDMedBill.Text.Trim();
                    if (txtMedBill_CaseNo.Text.Trim() != String.Empty) strCaseId = txtMedBill_CaseNo.Text.Trim();

                    if (txtMedBill_Illness.Text.Trim() != String.Empty)
                    {
                        String IllnessNo = txtMedBill_Illness.Text.Trim();

                        String strSqlQueryForIllnessId = "select [dbo].[tbl_illness].[Illness_Id] from [dbo].[tbl_illness] where [dbo].[tbl_illness].[IllnessNo] = @IllnessNo";

                        SqlCommand cmdQueryForIllnessId = new SqlCommand(strSqlQueryForIllnessId, connRN5);
                        cmdQueryForIllnessId.CommandType = CommandType.Text;

                        cmdQueryForIllnessId.Parameters.AddWithValue("@IllnessNo", IllnessNo);

                        if (connRN5.State != ConnectionState.Closed)
                        {
                            connRN5.Close();
                            connRN5.Open();
                        }
                        else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                        Object objIllnessId = cmdQueryForIllnessId.ExecuteScalar();
                        if (connRN5.State != ConnectionState.Closed) connRN5.Close();

                        if (objIllnessId != null) strIllnessId = objIllnessId.ToString();
                        else
                        {
                            MessageBox.Show("No Illness Id for given Illness No", "Error");
                            return;
                        }
                    }

                    if (txtMedBill_Incident.Text.Trim() != String.Empty)
                    {
                        String IncidentNo = txtMedBill_Incident.Text.Trim();

                        String strSqlQueryForIncidentId = "select [dbo].[tbl_incident].[Incident_id] from [dbo].[tbl_incident] where [dbo].[tbl_incident].[IncidentNo] = @IncidentNo";

                        SqlCommand cmdQueryForIncidentId = new SqlCommand(strSqlQueryForIncidentId, connRN5);
                        cmdQueryForIncidentId.CommandType = CommandType.Text;

                        cmdQueryForIncidentId.Parameters.AddWithValue("@IncidentNo", IncidentNo);

                        if (connRN5.State != ConnectionState.Closed)
                        {
                            connRN5.Close();
                            connRN5.Open();
                        }
                        else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                        Object objIncidentId = cmdQueryForIncidentId.ExecuteScalar();
                        if (connRN5.State != ConnectionState.Closed) connRN5.Close();

                        if (objIncidentId != null) strIncidentId = objIncidentId.ToString();
                        else
                        {
                            MessageBox.Show("No Incident Id for given Incident No", "Error");
                            return;
                        }
                    }


                    if (txtMedBillNo.Text.Trim() != String.Empty) strNewMedBillNo = txtMedBillNo.Text.Trim();

                    String MedicalProvider = String.Empty;

                    if (txtMedicalProvider.Text.Trim() != String.Empty)
                    {
                        MedicalProvider = txtMedicalProvider.Text.Trim();
                    }
                    else
                    {
                        MessageBox.Show("Please enter the name of medical provider.", "Error");
                        return;
                    }

                    String PrescriptionName = String.Empty;

                    if (txtPrescriptionName.Text.Trim() != String.Empty)
                    {
                        PrescriptionName = txtPrescriptionName.Text.Trim();
                    }

                    String PrescriptionNo = String.Empty;

                    if (txtNumberOfMedication.Text.Trim() != String.Empty)
                    {
                        PrescriptionNo = txtNumberOfMedication.Text.Trim();
                    }

                    String PrescriptionDescription = String.Empty;

                    if (txtPrescriptionDescription.Text.Trim() != String.Empty)
                    {
                        PrescriptionDescription = txtPrescriptionDescription.Text.Trim();
                    }

                    if (chkNPFMedBill.Checked && strNPFDestinationFilePathMedBill == String.Empty)
                    {
                        MessageBox.Show("No NPF Destination File Path specified.");
                        return;
                    }

                    if (chkIBMedBill.Checked && strIBDestinationFilePathMedBill == String.Empty)
                    {
                        MessageBox.Show("No IB Destination File Path specified.");
                        return;
                    }

                    if (chkPoPMedBill.Checked && strPoPDestinationFilePathMedBill == String.Empty)
                    {
                        MessageBox.Show("No PoP Destination File Path specified.");
                        return;
                    }

                    if (chkMedRecMedBill.Checked && strMedRecDestinationFilePathMedBill == String.Empty)
                    {
                        MessageBox.Show("No Med Rec Destination File Path specified.");
                        return;
                    }

                    if (chkOtherDocMedBill.Checked && strOtherDocDestinationFilePathMedBill == String.Empty)
                    {
                        MessageBox.Show("No Other Doc Destination File Path specified.");
                        return;
                    }

                    int nPatientType = 0;   // default outpatient

                    if (rbOutpatient.Checked) nPatientType = 0;
                    else if (rbInpatient.Checked) nPatientType = 1;
                    else if (!rbOutpatient.Checked && !rbInpatient.Checked)
                    {
                        String IncidentNo = txtMedBill_Incident.Text.Trim();

                        String strSqlQueryForWellBeingCare = "select [dbo].[tbl_incident].[IsWellBeing] from [dbo].[tbl_incident] where [dbo].[tbl_incident].[IncidentNo] = @IncidentNo";

                        SqlCommand cmdQueryForWellBeingCare = new SqlCommand(strSqlQueryForWellBeingCare, connRN5);
                        cmdQueryForWellBeingCare.CommandType = CommandType.Text;

                        cmdQueryForWellBeingCare.Parameters.AddWithValue("@IncidentNo", IncidentNo);

                        if (connRN5.State != ConnectionState.Closed)
                        {
                            connRN5.Close();
                            connRN5.Open();
                        }
                        else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                        Object objWellBeing = cmdQueryForWellBeingCare.ExecuteScalar();
                        if (connRN5.State != ConnectionState.Closed) connRN5.Close();

                        Boolean IsWellBeing = false;
                        if (objWellBeing != null) IsWellBeing = (Boolean)objWellBeing;

                        if (IsWellBeing) nPatientType = 0;
                        else nPatientType = 1;
                    }



                    String strNote = String.Empty;

                    if (comboMedBillType.SelectedItem.ToString() == "Medical Bill")
                    {
                        strNote = txtMedBillNote.Text.Trim();
                    }
                    else if (comboMedBillType.SelectedItem.ToString() == "Prescription")
                    {
                        strNote = txtPrescriptionNote.Text.Trim();
                    }
                    else if (comboMedBillType.SelectedItem.ToString() == "Physical Therapy")
                    {
                        strNote = txtPhysicalTherapyRxNote.Text.Trim();
                    }

                    String strSqlInsertNewMedBill = "insert into dbo.tbl_medbill (IsDeleted, BillNo, MedBillType_Id, BillStatus, BillClosed, CreatedDate, CreatedById, " +
                                                    "LastModifiedDate, LastModifiedById, " +
                                                    "LastActivityDate, LastViewedDate, LastReferencedDate, Case_Id, Incident_Id, Illness_Id, " +
                                                    "NPF_Form, NPF_SourceFileName, NPF_DestinationFileName, " +
                                                    "IB_Form, IB_SourceFileName, IB_DestinationFileName, " +
                                                    "POP_Form, POP_SourceFileName, POP_DestinationFileName, " +
                                                    "MedRec_Form, MedRec_SourceFileName, MedRec_DestinationFileName, " +
                                                    "Unknown_Form, Unknown_SourceFileName, Unknown_DestinationFileName, " +
                                                    "BillAmount, SettlementTotal, " +
                                                    "Balance, BillDate, TotalSharedAmount, Individual_Id, Contact_Id, MedicalProvider_Id, PendingReason, " +
                                                    "Account_At_Provider, ProviderPhoneNumber, ProviderContactPerson, " +
                                                    "ProposalLetterSentDate, HIPPASentDate, MedicalRecordDate, " +
                                                    "IneligibleReason, PersonalResponsibilityCredit, " +
                                                    "WellBeingCareTotal, WellBeingCare, DueDate, TotalNumberOfPhysicalTherapy, " +
                                                    "PrescriptionDrugName, PrescriptionNo, PrescriptionDescription, " +
                                                    "PatientTypeId, Note) " +
                                                    "values (@IsDeleted, @BillNo, @MedBillType_Id, @MedBillStatus, @MedBillClosed, @CreatedDate, @CreateById, " +
                                                    "@LastModifiedDate, @LastModifiedById, " +
                                                    "@LastActivityDate, @LastViewedDate, @LastReferencedDate, @Case_Id, @Incident_Id, @Illness_Id, " +
                                                    "@NPF_Form, @NPF_SourceFileName, @NPF_DestinationFileName, " +
                                                    "@IB_Form, @IB_SourceFileName, @IB_DestinationFileName, " +
                                                    "@POP_Form, @POP_SourceFileName, @POP_DestinationFileName, " +
                                                    "@MedRec_Form, @MedRec_SourceFileName, @MedRec_DestinationFileName, " +
                                                    "@Unknown_Form, @Unknown_SourceFileName, @Unknown_DestinationFileName, " +
                                                    "@BillAmount, @SettlementTotal, " +
                                                    "@Balance, @BillDate, @TotalSharedAmount, @Individual_Id, @Contact_Id, @MedicalProvider_Id, @PendingReason, " +
                                                    "@Account_At_Provider, @ProviderPhoneNo, @ProviderContactPerson, " +
                                                    "@ProposalLetterSentDate, @HIPPASentDate, @MedicalRecordDate, " +
                                                    "@IneligibleReason, @PersonalResponsibilityCredit, " +
                                                    "@WellBeingCareTotal, @WellBeingCare, @DueDate, @TotalNumberOfPhysicalTherapy, " +
                                                    "@PrescriptionDrugName, @PrescriptionNo, @PrescriptionDescription, " +
                                                    "@PatientTypeId, @Note)";

                    SqlCommand cmdInsertNewMedBill = new SqlCommand(strSqlInsertNewMedBill, connRN5);
                    cmdInsertNewMedBill.CommandType = CommandType.Text;

                    cmdInsertNewMedBill.Parameters.AddWithValue("@IsDeleted", 0);
                    cmdInsertNewMedBill.Parameters.AddWithValue("@BillNo", strNewMedBillNo);
                    cmdInsertNewMedBill.Parameters.AddWithValue("@MedBillType_Id", comboMedBillType.SelectedIndex + 1);
                    cmdInsertNewMedBill.Parameters.AddWithValue("@MedBillStatus", comboMedBillStatus.SelectedIndex);
                    if (cbMedBillClosed.SelectedIndex == 0) cmdInsertNewMedBill.Parameters.AddWithValue("@MedBillClosed", 0);
                    else if (cbMedBillClosed.SelectedIndex == 1) cmdInsertNewMedBill.Parameters.AddWithValue("@MedBillClosed", 1);
                    cmdInsertNewMedBill.Parameters.AddWithValue("@CreatedDate", DateTime.Today);
                    cmdInsertNewMedBill.Parameters.AddWithValue("@CreateById", nLoggedUserId);
                    cmdInsertNewMedBill.Parameters.AddWithValue("@LastModifiedDate", DateTime.Today);
                    cmdInsertNewMedBill.Parameters.AddWithValue("@LastModifiedById", nLoggedUserId);
                    cmdInsertNewMedBill.Parameters.AddWithValue("@LastActivityDate", DateTime.Today);
                    cmdInsertNewMedBill.Parameters.AddWithValue("@LastViewedDate", DateTime.Today);
                    cmdInsertNewMedBill.Parameters.AddWithValue("@LastReferencedDate", DateTime.Today);
                    cmdInsertNewMedBill.Parameters.AddWithValue("@Case_Id", strCaseId);
                    cmdInsertNewMedBill.Parameters.AddWithValue("@Incident_Id", strIncidentId);
                    cmdInsertNewMedBill.Parameters.AddWithValue("@Illness_Id", strIllnessId);
                    // Med Bill document form
                    cmdInsertNewMedBill.Parameters.AddWithValue("@NPF_Form", chkNPFMedBill.Checked);
                    if (strNPFSourceFilePathMedBill != String.Empty) cmdInsertNewMedBill.Parameters.AddWithValue("@NPF_SourceFileName", strNPFSourceFilePathMedBill);
                    else cmdInsertNewMedBill.Parameters.AddWithValue("@NPF_SourceFileName", DBNull.Value);
                    if (strNPFDestinationFilePathMedBill != String.Empty) cmdInsertNewMedBill.Parameters.AddWithValue("@NPF_DestinationFileName", strNPFDestinationFilePathMedBill);
                    else cmdInsertNewMedBill.Parameters.AddWithValue("@NPF_DestinationFileName", DBNull.Value);
                    cmdInsertNewMedBill.Parameters.AddWithValue("@IB_Form", chkIBMedBill.Checked);
                    if (strIBSourceFilePathMedBill != String.Empty) cmdInsertNewMedBill.Parameters.AddWithValue("@IB_SourceFileName", strIBSourceFilePathMedBill);
                    else cmdInsertNewMedBill.Parameters.AddWithValue("@IB_SourceFileName", DBNull.Value);
                    if (strIBDestinationFilePathMedBill != String.Empty) cmdInsertNewMedBill.Parameters.AddWithValue("@IB_DestinationFileName", strIBDestinationFilePathMedBill);
                    else cmdInsertNewMedBill.Parameters.AddWithValue("@IB_DestinationFileName", DBNull.Value);
                    cmdInsertNewMedBill.Parameters.AddWithValue("@POP_Form", chkPoPMedBill.Checked);
                    if (strPoPSourceFilePathMedBill != String.Empty) cmdInsertNewMedBill.Parameters.AddWithValue("@POP_SourceFileName", strPoPSourceFilePathMedBill);
                    else cmdInsertNewMedBill.Parameters.AddWithValue("@POP_SourceFileName", DBNull.Value);
                    if (strPoPDestinationFilePathMedBill != String.Empty) cmdInsertNewMedBill.Parameters.AddWithValue("@POP_DestinationFileName", strPoPDestinationFilePathMedBill);
                    else cmdInsertNewMedBill.Parameters.AddWithValue("@POP_DestinationFileName", DBNull.Value);
                    cmdInsertNewMedBill.Parameters.AddWithValue("@MedRec_Form", chkMedRecMedBill.Checked);
                    if (strMedRecSourceFilePathMedBill != String.Empty) cmdInsertNewMedBill.Parameters.AddWithValue("@MedRec_SourceFileName", strMedRecSourceFilePathMedBill);
                    else cmdInsertNewMedBill.Parameters.AddWithValue("@MedRec_SourceFileName", DBNull.Value);
                    if (strMedRecDestinationFilePathMedBill != String.Empty) cmdInsertNewMedBill.Parameters.AddWithValue("@MedRec_DestinationFileName", strMedRecDestinationFilePathMedBill);
                    else cmdInsertNewMedBill.Parameters.AddWithValue("@MedRec_DestinationFileName", DBNull.Value);
                    cmdInsertNewMedBill.Parameters.AddWithValue("@Unknown_Form", chkOtherDocMedBill.Checked);
                    if (strOtherDocSourceFilePathMedBill != String.Empty) cmdInsertNewMedBill.Parameters.AddWithValue("@Unknown_SourceFileName", strOtherDocSourceFilePathMedBill);
                    else cmdInsertNewMedBill.Parameters.AddWithValue("@Unknown_SourceFileName", DBNull.Value);
                    if (strOtherDocDestinationFilePathMedBill != String.Empty) cmdInsertNewMedBill.Parameters.AddWithValue("@Unknown_DestinationFileName", strOtherDocDestinationFilePathMedBill);
                    else cmdInsertNewMedBill.Parameters.AddWithValue("@Unknown_DestinationFileName", DBNull.Value);

                    Decimal BillAmountResult = 0;
                    Decimal BillAmount = 0;

                    if (Decimal.TryParse(txtMedBillAmount.Text.Trim(), NumberStyles.Currency, new CultureInfo("en-US"), out BillAmountResult))
                    {
                        BillAmount = BillAmountResult;
                        cmdInsertNewMedBill.Parameters.AddWithValue("@BillAmount", BillAmount);
                    }
                    else
                    {
                        MessageBox.Show("Bill Amount is invalid.", "Error");
                        return;
                    }

                    cmdInsertNewMedBill.Parameters.AddWithValue("@SettlementTotal", 0);

                    Decimal BalanceResult = 0;
                    Decimal Balance = 0;

                    if (Decimal.TryParse(txtBalance.Text.Trim(), NumberStyles.Currency, new CultureInfo("en-US"), out BalanceResult))
                    {
                        Balance = BalanceResult;
                        cmdInsertNewMedBill.Parameters.AddWithValue("@Balance", Balance);
                    }
                    else
                    {
                        MessageBox.Show("Balance is invalid.", "Error");
                        return;
                    }

                    cmdInsertNewMedBill.Parameters.AddWithValue("@BillDate", dtpBillDate.Value);

                    Decimal TotalSharedAmount = 0;
                    for (int i = 0; i < gvSettlementsInMedBill.Rows.Count; i++)
                    {
                        if ((gvSettlementsInMedBill["SettlementTypeValue", i].Value.ToString() == "CMM Provider Payment") ||
                            (gvSettlementsInMedBill["SettlementTypeValue", i].Value.ToString() == "CMM Member Reimbursement") ||
                            (gvSettlementsInMedBill["SettlementTypeValue", i].Value.ToString() == "PR Reimbursement"))
                        {
                            Decimal SettlementAmount = 0;
                            if (Decimal.TryParse(gvSettlementsInMedBill["SettlementAmount", i]?.Value?.ToString(), NumberStyles.Currency, new CultureInfo("en-US"), out SettlementAmount))
                                TotalSharedAmount += SettlementAmount;
                            else
                            {
                                MessageBox.Show("You have to enter decimal value in Settlement Amount field in Settlement " + gvSettlementsInMedBill[1, i]?.Value?.ToString(), "Alert");
                                return;
                            }
                        }
                        if (gvSettlementsInMedBill["SettlementTypeValue", i].Value.ToString() == "Medical Provider Refund")
                        {
                            Decimal MedicalProviderRefund = 0;
                            if (Decimal.TryParse(gvSettlementsInMedBill["SettlementAmount", i]?.Value?.ToString(), NumberStyles.Currency, new CultureInfo("en-US"), out MedicalProviderRefund))
                                TotalSharedAmount -= MedicalProviderRefund;
                            else
                            {
                                MessageBox.Show("You have to enter decimal value in Settlement Amount field in Settlement " + gvSettlementsInMedBill[1, i]?.Value?.ToString(), "Alert");
                                return;
                            }
                        }
                    }

                    cmdInsertNewMedBill.Parameters.AddWithValue("@TotalSharedAmount", TotalSharedAmount);
                    cmdInsertNewMedBill.Parameters.AddWithValue("@Individual_Id", strIndividualId);
                    cmdInsertNewMedBill.Parameters.AddWithValue("@Contact_Id", strIndividualId);

                    Boolean bMedicalProvider = false;
                    foreach (MedicalProviderInfo info in lstMedicalProvider)
                    {
                        if (info.Name.Trim() == txtMedicalProvider.Text.Trim())
                        {
                            cmdInsertNewMedBill.Parameters.AddWithValue("@MedicalProvider_Id", info.ID);
                            bMedicalProvider = true;
                            break;
                        }
                    }
                    if (!bMedicalProvider)
                    {
                        MessageBox.Show("Medical Provider name is invalid.", "Error");
                        return;
                    }

                    cmdInsertNewMedBill.Parameters.AddWithValue("@Account_At_Provider", txtMedBillAccountNoAtProvider.Text.Trim());
                    cmdInsertNewMedBill.Parameters.AddWithValue("@ProviderPhoneNo", txtMedProviderPhoneNo.Text.Trim());
                    cmdInsertNewMedBill.Parameters.AddWithValue("@ProviderContactPerson", txtProviderContactPerson.Text.Trim());
                    cmdInsertNewMedBill.Parameters.AddWithValue("@ProposalLetterSentDate", dtpProposalLetterSentDate.Value);
                    cmdInsertNewMedBill.Parameters.AddWithValue("@HIPPASentDate", dtpHippaSentDate.Value);
                    cmdInsertNewMedBill.Parameters.AddWithValue("@MedicalRecordDate", dtpMedicalRecordDate.Value);
                    cmdInsertNewMedBill.Parameters.AddWithValue("@PersonalResponsibilityCredit", 500);
                    cmdInsertNewMedBill.Parameters.AddWithValue("@WellBeingCareTotal", 0);
                    cmdInsertNewMedBill.Parameters.AddWithValue("@WellBeingCare", 0);
                    cmdInsertNewMedBill.Parameters.AddWithValue("@DueDate", dtpDueDate.Value);

                    if (comboMedBillType.SelectedIndex == 0 || comboMedBillType.SelectedIndex == 3)        // Medical Bill Type : Medical Bill
                    {
                        cmdInsertNewMedBill.Parameters.AddWithValue("@PrescriptionDrugName", String.Empty);
                        cmdInsertNewMedBill.Parameters.AddWithValue("@PrescriptionNo", String.Empty);
                        cmdInsertNewMedBill.Parameters.AddWithValue("@PrescriptionDescription", String.Empty);

                        cmdInsertNewMedBill.Parameters.AddWithValue("@TotalNumberOfPhysicalTherapy", 0);

                        cmdInsertNewMedBill.Parameters.AddWithValue("@PatientTypeId", nPatientType);

                        if (comboPendingReason.SelectedIndex != -1) cmdInsertNewMedBill.Parameters.AddWithValue("@PendingReason", comboPendingReason.SelectedIndex);
                        else cmdInsertNewMedBill.Parameters.AddWithValue("@PendingReason", 0);
                        if (comboIneligibleReason.SelectedIndex != -1) cmdInsertNewMedBill.Parameters.AddWithValue("@IneligibleReason", comboIneligibleReason.SelectedIndex);
                        else cmdInsertNewMedBill.Parameters.AddWithValue("@IneligibleReason", 0);

                        cmdInsertNewMedBill.Parameters.AddWithValue("@Note", strNote);
                    }
                    else if (comboMedBillType.SelectedIndex == 1)   // Medical Bill Type : Prescription
                    {
                        cmdInsertNewMedBill.Parameters.AddWithValue("@PatientTypeId", DBNull.Value);
                        //cmdInsertNewMedBill.Parameters.AddWithValue("@PendingReason", 0);
                        //cmdInsertNewMedBill.Parameters.AddWithValue("@IneligibleReason", 0);

                        if (comboPendingReason.SelectedIndex != -1) cmdInsertNewMedBill.Parameters.AddWithValue("@PendingReason", comboPendingReason.SelectedIndex);
                        else cmdInsertNewMedBill.Parameters.AddWithValue("@PendingReason", 0);
                        if (comboIneligibleReason.SelectedIndex != -1) cmdInsertNewMedBill.Parameters.AddWithValue("@IneligibleReason", comboIneligibleReason.SelectedIndex);
                        else cmdInsertNewMedBill.Parameters.AddWithValue("@IneligibleReason", 0);

                        cmdInsertNewMedBill.Parameters.AddWithValue("@TotalNumberOfPhysicalTherapy", 0);

                        cmdInsertNewMedBill.Parameters.AddWithValue("@PrescriptionDrugName", txtPrescriptionName.Text.Trim());
                        cmdInsertNewMedBill.Parameters.AddWithValue("@PrescriptionNo", txtNumberOfMedication.Text.Trim());
                        cmdInsertNewMedBill.Parameters.AddWithValue("@PrescriptionDescription", txtPrescriptionDescription.Text.Trim());
                        cmdInsertNewMedBill.Parameters.AddWithValue("@Note", strNote);
                    }
                    else if (comboMedBillType.SelectedIndex == 2)   // Medical Bill Type : Physical Therapy
                    {
                        cmdInsertNewMedBill.Parameters.AddWithValue("@PrescriptionDrugName", String.Empty);
                        cmdInsertNewMedBill.Parameters.AddWithValue("@PrescriptionNo", String.Empty);
                        cmdInsertNewMedBill.Parameters.AddWithValue("@PrescriptionDescription", String.Empty);

                        cmdInsertNewMedBill.Parameters.AddWithValue("@PatientTypeId", DBNull.Value);
                        //cmdInsertNewMedBill.Parameters.AddWithValue("@PendingReason", 0);
                        //cmdInsertNewMedBill.Parameters.AddWithValue("@IneligibleReason", 0);

                        if (comboPendingReason.SelectedIndex != -1) cmdInsertNewMedBill.Parameters.AddWithValue("@PendingReason", comboPendingReason.SelectedIndex);
                        else cmdInsertNewMedBill.Parameters.AddWithValue("@PendingReason", 0);
                        if (comboIneligibleReason.SelectedIndex != -1) cmdInsertNewMedBill.Parameters.AddWithValue("@IneligibleReason", comboIneligibleReason.SelectedIndex);
                        else cmdInsertNewMedBill.Parameters.AddWithValue("@IneligibleReason", 0);

                        int nNumberOfPhysicalTherapy = 0;
                        short result = 0;
                        if (Int16.TryParse(txtNumPhysicalTherapy.Text.Trim(), out result))
                        {
                            nNumberOfPhysicalTherapy = result;
                            cmdInsertNewMedBill.Parameters.AddWithValue("@TotalNumberOfPhysicalTherapy", nNumberOfPhysicalTherapy);
                        }
                        else
                        {
                            MessageBox.Show("Please enter a positive integer in the Number of Physical Therapy Text Box.", "Alert");
                            return;
                        }

                        cmdInsertNewMedBill.Parameters.AddWithValue("@Note", strNote);
                    }
                    else if (comboMedBillType.SelectedIndex == 3)
                    {

                    }


                    if (connRN5.State != ConnectionState.Closed)
                    {
                        connRN5.Close();
                        connRN5.Open();
                    }
                    else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                    int nRowInserted = cmdInsertNewMedBill.ExecuteNonQuery();
                    if (connRN5.State != ConnectionState.Closed) connRN5.Close();

                    if (nRowInserted == 1)
                    {
                        MessageBox.Show("The medical bill has been saved.", "Information");

                        // handle Well Being Care case

                        //String strSqlQueryForWellBeingCare = "select [dbo].[tbl_medbill].[BillNo], [dbo].[tbl_incident].[IsWellBeing] " +
                        //                                     "from [dbo].[tbl_medbill] " +
                        //                                     "inner join [dbo].[tbl_incident] on [dbo].[tbl_medbill].[Incident_Id] = [dbo].[tbl_incident].[Incident_id] " +
                        //                                     "where [dbo].[tbl_medbill].[BillNo] = @MedBillNo and " +
                        //                                     "[dbo].[tbl_medbill].[Individual_Id] = @IndividualId";

                        //SqlCommand cmdQueryForWellBeingCare = new SqlCommand(strSqlQueryForWellBeingCare, connRN5);
                        //cmdQueryForWellBeingCare.CommandType = CommandType.Text;

                        //cmdQueryForWellBeingCare.Parameters.AddWithValue("@MedBillNo", strNewMedBillNo);
                        //cmdQueryForWellBeingCare.Parameters.AddWithValue("@IndividualId", strIndividualId);

                        ////String ICD10Code = String.Empty;
                        //Boolean bWellBeingCare = false;
                        //Boolean bWellBeingCareEligible = false;

                        //if (connRN5.State != ConnectionState.Closed)
                        //{
                        //    connRN5.Close();
                        //    connRN5.Open();
                        //}
                        //else if (connRN5.State == ConnectionState.Closed) connRN5.Open();

                        //SqlDataReader rdrWellBeingCare = cmdQueryForWellBeingCare.ExecuteReader();
                        //if (rdrWellBeingCare.HasRows)
                        //{
                        //    rdrWellBeingCare.Read();
                        //    if (!rdrWellBeingCare.IsDBNull(1)) bWellBeingCare = rdrWellBeingCare.GetBoolean(1);
                        //}
                        //rdrWellBeingCare.Close();
                        //if (connRN5.State == ConnectionState.Open) connRN5.Close();

                        //if (bWellBeingCare == true)
                        //{

                        //    String strSqlQueryForProgramForIndividual = "select [dbo].[contact].[Individual_ID__c], [dbo].[program].[Name] from [dbo].[contact] " +
                        //                                                "inner join [dbo].[program] on [dbo].[contact].[c4g_Plan__c] = [dbo].[program].[ID] " +
                        //                                                "where [dbo].[contact].[Individual_ID__c] = @IndividualId";

                        //    SqlCommand cmdQueryForProgramForIndividual = new SqlCommand(strSqlQueryForProgramForIndividual, connSalesforce2);
                        //    cmdQueryForProgramForIndividual.CommandType = CommandType.Text;

                        //    cmdQueryForProgramForIndividual.Parameters.AddWithValue("@IndividualId", strIndividualId);

                        //    if (connSalesforce2.State != ConnectionState.Closed)
                        //    {
                        //        connSalesforce2.Close();
                        //        connSalesforce2.Open();
                        //    }
                        //    else if (connSalesforce2.State == ConnectionState.Closed) connSalesforce2.Open();

                        //    String ProgramName = String.Empty;

                        //    SqlDataReader rdrProgramForIndividual = cmdQueryForProgramForIndividual.ExecuteReader();
                        //    if (rdrProgramForIndividual.HasRows)
                        //    {
                        //        rdrProgramForIndividual.Read();
                        //        if (!rdrProgramForIndividual.IsDBNull(1)) ProgramName = rdrProgramForIndividual.GetString(1);
                        //    }
                        //    rdrProgramForIndividual.Close();
                        //    if (connSalesforce2.State == ConnectionState.Open) connSalesforce2.Close();

                        //    if (ProgramName == "Gold Plus" || ProgramName == "Gold Medi-I" || ProgramName == "Gold Medi-II")
                        //    {
                        //        String strSqlQueryForIndividualStartDate = "select [dbo].[contact].[Membership_IND_Start_date__c] from [dbo].[contact] " +
                        //                                                   "where [dbo].[contact].[Individual_ID__c] = @IndividualId";

                        //        SqlCommand cmdQueryForIndividualStartDate = new SqlCommand(strSqlQueryForIndividualStartDate, connSalesforce2);
                        //        cmdQueryForIndividualStartDate.CommandType = CommandType.Text;

                        //        cmdQueryForIndividualStartDate.Parameters.AddWithValue("@IndividualId", strIndividualId);

                        //        if (connSalesforce2.State != ConnectionState.Closed)
                        //        {
                        //            connSalesforce2.Close();
                        //            connSalesforce2.Open();
                        //        }
                        //        else if (connSalesforce2.State == ConnectionState.Closed) connSalesforce2.Open();

                        //        Object objMembershipIndStartDate = cmdQueryForIndividualStartDate.ExecuteScalar();

                        //        if (connSalesforce2.State == ConnectionState.Open) connSalesforce2.Close();

                        //        DateTime MembershipIndStartDate = new DateTime();
                        //        if (objMembershipIndStartDate != null)
                        //        {
                        //            MembershipIndStartDate = DateTime.Parse(objMembershipIndStartDate.ToString());
                        //        }

                        //        if (dtpBillDate.Value > MembershipIndStartDate.AddMonths(6))
                        //        {
                        //            DateTime IndividualAnivDate = DateTime.Parse(txtAnivDate.Text);

                        //            DateTime? AnivDateThisYear = new DateTime(DateTime.Today.Year, MembershipIndStartDate.Month, 1);
                        //            DateTime? FromAnivDate = null;
                        //            DateTime? ToAnivDate = null;

                        //            if (dtpBillDate.Value >= AnivDateThisYear.Value)
                        //            {
                        //                FromAnivDate = AnivDateThisYear;
                        //                ToAnivDate = AnivDateThisYear.Value.AddYears(1);
                        //            }
                        //            if (dtpBillDate.Value < AnivDateThisYear.Value)
                        //            {
                        //                FromAnivDate = AnivDateThisYear.Value.AddYears(-1);
                        //                ToAnivDate = AnivDateThisYear;
                        //            }
                                

                        //            //int nAnivYear = dtpBillDate.Value.Year;

                        //            //DateTime IndividualThisAnivDate = new DateTime(nAnivYear, IndividualAnivDate.Month, 1);
                        //            //DateTime IndividualLastAnivDate = new DateTime(nAnivYear - 1, IndividualAnivDate.Month, 1);
                                    
                                    



                        //            String strSqlQueryForWellBeingIncidentsPerAnivYear = "select count([dbo].[tbl_incident].[IncidentNo]) from [dbo].[tbl_incident] " +
                        //                                                                 "inner join [dbo].[tbl_medbill] on [dbo].[tbl_incident].[Incident_id] = [dbo].[tbl_medbill].[Incident_Id] " +
                        //                                                                 "where [dbo].[tbl_medbill].[Individual_Id] = @IndividualId and " +
                        //                                                                 "[dbo].[tbl_incident].[IsWellBeing] = 1 and " +
                        //                                                                 "[dbo].[tbl_medbill].[BillDate] >= @LastAnivDate and " +
                        //                                                                 "[dbo].[tbl_medbill].[BillDate] < @ThisAnivDate";

                        //            SqlCommand cmdQueryForWellBeingIncidentsPerAnivYear = new SqlCommand(strSqlQueryForWellBeingIncidentsPerAnivYear, connRN5);
                        //            cmdQueryForWellBeingIncidentsPerAnivYear.CommandType = CommandType.Text;

                        //            cmdQueryForWellBeingIncidentsPerAnivYear.Parameters.AddWithValue("@IndividualId", strIndividualId);
                        //            cmdQueryForWellBeingIncidentsPerAnivYear.Parameters.AddWithValue("@LastAnivDate", FromAnivDate);
                        //            cmdQueryForWellBeingIncidentsPerAnivYear.Parameters.AddWithValue("@ThisAnivDate", ToAnivDate);

                        //            if (connRN5.State != ConnectionState.Closed)
                        //            {
                        //                connRN5.Close();
                        //                connRN5.Open();
                        //            }
                        //            else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                        //            Object objIncidentCount = cmdQueryForWellBeingIncidentsPerAnivYear.ExecuteScalar();
                        //            if (connRN5.State == ConnectionState.Open) connRN5.Close();

                        //            int nIncidentCount = Int32.Parse(objIncidentCount.ToString());

                        //            if (nIncidentCount == 1)
                        //            {
                        //                String strSqlQueryForWellBeingIncidentId = "select [dbo].[tbl_incident].[Incident_id] from [dbo].[tbl_incident] " +
                        //                                                           "inner join [dbo].[tbl_medbill] on [dbo].[tbl_incident].[Incident_id] = [dbo].[tbl_medbill].[Incident_Id] " +
                        //                                                           "where [dbo].[tbl_medbill].[Individual_Id] = @IndividualId and " +
                        //                                                           "[dbo].[tbl_incident].[IsWellBeing] = 1 and " +
                        //                                                           "[dbo].[tbl_medbill].[BillDate] >= @LastAnivDate and " +
                        //                                                           "[dbo].[tbl_medbill].[BillDate] < @ThisAnivDate";

                        //                SqlCommand cmdQueryForWellBeingIncidentId = new SqlCommand(strSqlQueryForWellBeingIncidentId, connRN5);
                        //                cmdQueryForWellBeingIncidentId.CommandType = CommandType.Text;

                        //                cmdQueryForWellBeingIncidentId.Parameters.AddWithValue("@IndividualId", strIndividualId);
                        //                cmdQueryForWellBeingIncidentId.Parameters.AddWithValue("@LastAnivDate", FromAnivDate);
                        //                cmdQueryForWellBeingIncidentId.Parameters.AddWithValue("@ThisAnivDate", ToAnivDate);

                        //                if (connRN5.State != ConnectionState.Closed)
                        //                {
                        //                    connRN5.Close();
                        //                    connRN5.Open();
                        //                }
                        //                else if (connRN5.State == ConnectionState.Closed) connRN5.Open();

                        //                Object objWellBeingIncidentId = cmdQueryForWellBeingIncidentId.ExecuteScalar();
                        //                if (connRN5.State == ConnectionState.Open) connRN5.Close();

                        //                if (objWellBeingIncidentId != null)
                        //                {
                        //                    int nWellBeingIncidentId = Int32.Parse(objWellBeingIncidentId.ToString());

                        //                    String strSqlQueryForWellBeingTotalForIncident = "select sum([dbo].[tbl_medbill].[TotalSharedAmount]) from [dbo].[tbl_medbill] " +
                        //                                                                     "where [dbo].[tbl_medbill].[Incident_Id] = @IncidentId";

                        //                    SqlCommand cmdQueryForWellBeingTotalForIncident = new SqlCommand(strSqlQueryForWellBeingTotalForIncident, connRN5);
                        //                    cmdQueryForWellBeingTotalForIncident.CommandType = CommandType.Text;

                        //                    cmdQueryForWellBeingTotalForIncident.Parameters.AddWithValue("@IncidentId", nWellBeingIncidentId);

                        //                    if (connRN5.State != ConnectionState.Closed)
                        //                    {
                        //                        connRN5.Close();
                        //                        connRN5.Open();
                        //                    }
                        //                    else if (connRN5.State == ConnectionState.Closed) connRN5.Open();

                        //                    Object objWellBeingTotalForIncident = cmdQueryForWellBeingTotalForIncident.ExecuteScalar();
                        //                    if (connRN5.State == ConnectionState.Open) connRN5.Close();

                        //                    Decimal WellBeingTotalForIncident = Decimal.Parse(objWellBeingTotalForIncident.ToString());

                        //                    if (WellBeingTotalForIncident > 500)
                        //                    {
                        //                        // Set the well being care med bill ineligible strNewMedBillNo
                        //                        String strSqlUpdateMedBillWellBeingCareIneligible = "update [dbo].[tbl_medbill] set [dbo].[medbill].[BillStatus] = 3, " +
                        //                                                                            "[dbo].[tbl_medbill].[WellBeingCare] = 0 " +
                        //                                                                            "where [dbo].[tbl_medbill].[BillNo] = @WellBeingCareMedBill";

                        //                        SqlCommand cmdUpdateMedBillWellBeingCareIneligible = new SqlCommand(strSqlUpdateMedBillWellBeingCareIneligible, connRN5);
                        //                        cmdUpdateMedBillWellBeingCareIneligible.CommandType = CommandType.Text;

                        //                        cmdUpdateMedBillWellBeingCareIneligible.Parameters.AddWithValue("@WellBeingCareMedBill", strNewMedBillNo);

                        //                        if (connRN5.State != ConnectionState.Closed)
                        //                        {
                        //                            connRN5.Close();
                        //                            connRN5.Open();
                        //                        }
                        //                        else if (connRN5.State == ConnectionState.Closed) connRN5.Open();

                        //                        int nWellBeingMedBillUpdated = cmdUpdateMedBillWellBeingCareIneligible.ExecuteNonQuery();

                        //                        if (connRN5.State == ConnectionState.Open) connRN5.Close();

                        //                        if (nWellBeingMedBillUpdated == 0)
                        //                        {
                        //                            MessageBox.Show("The well being med bill is not updated.", "Error");
                        //                            return;
                        //                        }
                        //                    }
                        //                    else
                        //                    {
                        //                        // set the well being care med bill eligible
                        //                        String strSqlUpdateMedBillWellBeingCareEligible = "update [dbo].[tbl_medbill] set [dbo].[tbl_medbill].[BillStatus] = 2, " +
                        //                                                                          "[dbo].[tbl_medbill].[WellBeingCare] = 1 " +
                        //                                                                          "where [dbo].[tbl_medbill].[BillNo] = @WellBeingCareMedBill";

                        //                        SqlCommand cmdUpdateMedBillWellBeingCareEligible = new SqlCommand(strSqlUpdateMedBillWellBeingCareEligible, connRN5);
                        //                        cmdUpdateMedBillWellBeingCareEligible.CommandType = CommandType.Text;

                        //                        cmdUpdateMedBillWellBeingCareEligible.Parameters.AddWithValue("@WellBeingCareMedBill", strNewMedBillNo);

                        //                        if (connRN5.State != ConnectionState.Closed)
                        //                        {
                        //                            connRN5.Close();
                        //                            connRN5.Open();
                        //                        }
                        //                        else if (connRN5.State == ConnectionState.Closed) connRN5.Open();

                        //                        int nWellBeingMedBillUpdated = cmdUpdateMedBillWellBeingCareEligible.ExecuteNonQuery();

                        //                        if (connRN5.State == ConnectionState.Open) connRN5.Close();

                        //                        if (nWellBeingMedBillUpdated == 0)
                        //                        {
                        //                            MessageBox.Show("The well being med bill is not updated.", "Error");
                        //                            return;
                        //                        }
                        //                    }
                        //                }
                        //            }
                        //            else if (nIncidentCount > 1)
                        //            {
                        //                // Ineligible for Well Being Care
                        //                String strSqlUpdateMedBillWellBeingCareIneligible = "update [dbo].[tbl_medbill] set [dbo].[tbl_medbill].[BillStatus] = 3, " +
                        //                                                                    "[dbo].[tbl_medbill].[WellBeingCare] = 0 " +
                        //                                                                    "where [dbo].[tbl_medbill].[BillNo] = @WellBeingCareMedBill";

                        //                SqlCommand cmdUpdateMedBillWellBeingCareIneligible = new SqlCommand(strSqlUpdateMedBillWellBeingCareIneligible, connRN5);
                        //                cmdUpdateMedBillWellBeingCareIneligible.CommandType = CommandType.Text;

                        //                cmdUpdateMedBillWellBeingCareIneligible.Parameters.AddWithValue("@WellBeingCareMedBill", strNewMedBillNo);

                        //                if (connRN5.State != ConnectionState.Closed)
                        //                {
                        //                    connRN5.Close();
                        //                    connRN5.Open();
                        //                }
                        //                else if (connRN5.State == ConnectionState.Closed) connRN5.Open();

                        //                int nWellBeingMedBillUpdated = cmdUpdateMedBillWellBeingCareIneligible.ExecuteNonQuery();
                        //                if (connRN5.State == ConnectionState.Open) connRN5.Close();

                        //                if (nWellBeingMedBillUpdated == 0)
                        //                {
                        //                    MessageBox.Show("The well being med bill is not updated.", "Error");
                        //                    return;
                        //                }
                        //            }
                        //        }
                        //    }
                        //}
                        ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

                        // This section saves the settlements to settlement table and connect to medical bill
                        if (gvSettlementsInMedBill.Rows.Count > 0)
                        {
                            for (int i = 0; i < gvSettlementsInMedBill.Rows.Count; i++)
                            {

                                if (gvSettlementsInMedBill["SettlementTypeValue", i]?.Value == null)
                                {
                                    MessageBox.Show("You have to select a Settlement Type.", "Alert");
                                    return;
                                }

                                Decimal result, SettlementAmount;
                                if (Decimal.TryParse(gvSettlementsInMedBill["SettlementAmount", i]?.Value?.ToString(), NumberStyles.Currency, new CultureInfo("en-US"), out result)) SettlementAmount = result;
                                else
                                {
                                    MessageBox.Show("You have to enter decimal value in Settlement Amount field in Settlement " + gvSettlementsInMedBill[1, i]?.Value?.ToString(), "Alert");
                                    return;
                                }

                                result = 0;
                                Decimal PersonalResponsibilityAmount = 0;

                                if ((gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "Self Pay Discount") ||
                                    (gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "3rd Party Discount") ||
                                    (gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "Member Discount") ||
                                    (gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "Member Payment"))
                                {
                                    //if (gvSettlementsInMedBill["PersonalResponsibility", i]?.Value?.ToString() != String.Empty)
                                    if (gvSettlementsInMedBill["PersonalResponsibility", i]?.Value != null)
                                    {
                                        if (Decimal.TryParse(gvSettlementsInMedBill["PersonalResponsibility", i]?.Value?.ToString(), NumberStyles.Currency, new CultureInfo("en-US"), out result)) PersonalResponsibilityAmount = result;
                                        else
                                        {
                                            MessageBox.Show("Invalid Personal Responsibility.", "Error");
                                            return;
                                        }
                                    }
                                }

                                result = 0;
                                Decimal AllowedAmount = 0;
                                if (gvSettlementsInMedBill["AllowedAmount", i]?.Value?.ToString() != null)
                                {
                                    if (Decimal.TryParse(gvSettlementsInMedBill["AllowedAmount", i]?.Value?.ToString(), NumberStyles.Currency, new CultureInfo("en-US"), out result)) AllowedAmount = result;
                                    else
                                    {
                                        MessageBox.Show("You have to enter decimal value in Allowed Amount field in Settlement " + gvSettlementsInMedBill[1, i]?.Value?.ToString(), "Alert");
                                        return;
                                    }
                                }
                            }

                            ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

                            Decimal MedBillAmount = Decimal.Parse(txtMedBillAmount.Text.Trim(), NumberStyles.Currency, new CultureInfo("en-US"));
                            Decimal SettlementAmountTotal = 0;

                            for (int i = 0; i < gvSettlementsInMedBill.Rows.Count; i++)
                            {
                                Decimal result = 0;
                                Decimal SettlementAmount = 0;
                                if (gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "Self Pay Discount" ||
                                    gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "3rd Party Discount" ||
                                    gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "Member Discount" ||
                                    gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "Member Payment" ||
                                    gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "CMM Provider Payment" ||
                                    gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "CMM Discount" ||
                                    gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "CMM Member Reimbursement" ||
                                    gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "Ineligible")
                                {
                                    if (Decimal.TryParse(gvSettlementsInMedBill["SettlementAmount", i]?.Value?.ToString(), NumberStyles.Currency, new CultureInfo("en-US"), out result))
                                    {
                                        SettlementAmount = result;
                                        SettlementAmountTotal += SettlementAmount;
                                        if (SettlementAmountTotal > MedBillAmount)
                                        {
                                            MessageBox.Show("The total of settlement amount exceeds medical bill amount.");
                                            return;
                                        }
                                    }
                                }
                            }

                            /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                            Boolean bError = false;

                            for (int i = 0; i < gvSettlementsInMedBill.Rows.Count; i++)
                            {
                                String SettlementName = gvSettlementsInMedBill["SettlementName", i].Value.ToString();

                                // Check whether or not the settlement is already in data base
                                String strSqlQueryForSettlementName = "select [dbo].[tbl_settlement].[Name] from [dbo].[tbl_settlement] where [dbo].[tbl_settlement].[Name] = @Settlement";

                                SqlCommand cmdQueryForSettlementName = new SqlCommand(strSqlQueryForSettlementName, connRN5);
                                cmdQueryForSettlementName.CommandType = CommandType.Text;

                                cmdQueryForSettlementName.Parameters.AddWithValue("@Settlement", SettlementName);

                                if (connRN5.State != ConnectionState.Closed)
                                {
                                    connRN5.Close();
                                    connRN5.Open();
                                }
                                else if (connRN5.State != ConnectionState.Open) connRN5.Open();
                                /////////////////////////////////////////////////////////////////////

                                Object objResultSettlementName = cmdQueryForSettlementName.ExecuteScalar();
                                if (connRN5.State != ConnectionState.Closed) connRN5.Close();

                                if (objResultSettlementName == null)   // new settlement: save the settlement by using insert sql statement
                                {

                                    String strSqlCreateNewSettlement = "insert into [dbo].[tbl_settlement] (IsDeleted, Name, CreateDate, CreateByID, LastModifiedDate, LastModifiedByID, SystemModifiedStamp, " +
                                                                        "LastActivityDate, LastViewedDate, MedicalBillID, " +
                                                                        "SettlementType, Amount, PersonalResponsibilityCredit, CMMPaymentMethod, " +
                                                                        "CheckNo, CheckDate, CheckReconciled, ACH_Number, ACH_Date, ACH_Reconciled, CMMCreditCard, CMMCreditCardPaidDate, CC_Reconciled, " +
                                                                        "AllowedAmount, Notes, Approved, ApprovedDate, IneligibleReason) " +
                                                                        "values (0, @SettlementName, @CreateDate, @CreateByID, @LastModifiedDate, @LastModifiedByID, @SystemModifiedStamp, " +
                                                                        "@LastActivityDate, @LastViewedDate, @MedBillID, " +
                                                                        "@SettlementType, @SettlementAmount, @PersonalResponsibilityCredit, @CMMPaymentMethod, " +
                                                                        "@CheckNo, @CheckDate, @IsCheckReconciled, @ACH_Number, @ACH_Date, @IsACH_Reconciled, @CMMCreditCard, @CMMCreditCardPaidDate, @IsCC_Reconciled, " +
                                                                        "@AllowedAmount, @Notes, @IsApproved, @ApprovedDate, @IneligibleReason)";

                                    SqlCommand cmdInsertNewSettlement = new SqlCommand(strSqlCreateNewSettlement, connRN5);
                                    cmdInsertNewSettlement.CommandType = CommandType.Text;

                                    String NewSettlementName = gvSettlementsInMedBill["SettlementName", i].Value.ToString();
                                    String NewSettlementType = String.Empty;
                                    if (gvSettlementsInMedBill["SettlementTypeValue", i].Value != null) NewSettlementType = gvSettlementsInMedBill["SettlementTypeValue", i].Value.ToString();
                                    int nNewSettlementType = 0;
                                    for (int j = 0; j < lstSettlementType.Count; j++)
                                    {
                                        if (NewSettlementType == lstSettlementType[j].SettlementTypeValue) nNewSettlementType = lstSettlementType[j].SettlementTypeCode;
                                    }
                                    Decimal result = 0;
                                    Decimal SettlementAmount = 0;
                                    if (Decimal.TryParse(gvSettlementsInMedBill["SettlementAmount", i]?.Value?.ToString(), NumberStyles.Currency, new CultureInfo("en-US"), out result))
                                    {
                                        SettlementAmount = result;
                                        cmdInsertNewSettlement.Parameters.AddWithValue("@SettlementAmount", SettlementAmount);
                                    }

                                    result = 0;
                                    Decimal PersonalResponsibilityAmount = 0;
                                    if (Decimal.TryParse(gvSettlementsInMedBill["PersonalResponsibility", i]?.Value?.ToString(), NumberStyles.Currency, new CultureInfo("en-US"), out result)) PersonalResponsibilityAmount = result;
                                    cmdInsertNewSettlement.Parameters.AddWithValue("@PersonalResponsibilityCredit", PersonalResponsibilityAmount);

                                    int NewIsApproved = 0;
                                    if (gvSettlementsInMedBill["Approved", i]?.Value != null)
                                    {
                                        if ((Boolean)gvSettlementsInMedBill["Approved", i]?.Value == true) NewIsApproved = 1;
                                    }
                                    DateTime? NewApprovedDate = null;
                                    if (gvSettlementsInMedBill["ApprovedDate", i]?.Value != null)
                                    {
                                        DateTime resultDateTime;
                                        if (DateTime.TryParse(gvSettlementsInMedBill["ApprovedDate", i]?.Value?.ToString(), out resultDateTime))
                                            NewApprovedDate = resultDateTime;
                                        //NewApprovedDate = DateTime.Parse(gvSettlementsInMedBill["ApprovedDate", i].Value.ToString());
                                    }

                                    String NewCMMPaymentMethod = String.Empty;
                                    if (gvSettlementsInMedBill["PaymentMethod", i]?.Value != null) NewCMMPaymentMethod = gvSettlementsInMedBill["PaymentMethod", i].Value.ToString();
                                    int nNewCMMPaymentMethod = 0;
                                    for (int j = 0; j < lstPaymentMethod.Count; j++)
                                    {
                                        if (NewCMMPaymentMethod == lstPaymentMethod[j].PaymentMethodValue) nNewCMMPaymentMethod = lstPaymentMethod[j].PaymentMethodId;
                                    }

                                    String NewCheckNo = String.Empty;
                                    DateTime? NewCheckDate = null;
                                    int NewCheckReconciled = 0;
                                    if (gvSettlementsInMedBill["PaymentMethod", i]?.Value?.ToString() == "Check")
                                    {
                                        if (gvSettlementsInMedBill["CheckNo", i].Value != null) NewCheckNo = gvSettlementsInMedBill["CheckNo", i].Value.ToString();
                                        if (gvSettlementsInMedBill["PaymentDate", i].Value != null) NewCheckDate = DateTime.Parse(gvSettlementsInMedBill["PaymentDate", i].Value.ToString());
                                        if (gvSettlementsInMedBill["Reconciled", i].Value != null) NewCheckReconciled = 1;
                                    }

                                    String NewACH_Number = String.Empty;
                                    DateTime? NewACH_Date = null;
                                    int NewACH_Reconciled = 0;
                                    if (gvSettlementsInMedBill["PaymentMethod", i]?.Value?.ToString() == "ACH/Banking")
                                    {
                                        if (gvSettlementsInMedBill["ACHNo", i].Value != null) NewACH_Number = gvSettlementsInMedBill["ACHNo", i].Value.ToString();
                                        if (gvSettlementsInMedBill["PaymentDate", i].Value != null) NewACH_Date = DateTime.Parse(gvSettlementsInMedBill["PaymentDate", i].Value.ToString());
                                        if (gvSettlementsInMedBill["Reconciled", i].Value != null) NewACH_Reconciled = 1;
                                    }

                                    int nCMMCreditCard = 0;
                                    DateTime? NewCreditCardPaidDate = null;
                                    int NewIsCCReconciled = 0;

                                    if (gvSettlementsInMedBill["PaymentMethod", i]?.Value?.ToString() == "Credit Card")
                                    {
                                        String CreditCard = gvSettlementsInMedBill[13, i]?.Value?.ToString();
                                        for (int j = 0; j < lstCreditCardInfo.Count; j++)
                                        {
                                            if (CreditCard == lstCreditCardInfo[j].CreditCardNo)
                                            {
                                                nCMMCreditCard = lstCreditCardInfo[j].CreditCardId;
                                            }
                                        }
                                        if (gvSettlementsInMedBill["PaymentDate", i].Value != null)
                                            NewCreditCardPaidDate = DateTime.Parse(gvSettlementsInMedBill["PaymentDate", i].Value.ToString());
                                        if (gvSettlementsInMedBill["Reconciled", i].Value != null) NewIsCCReconciled = 1;
                                    }

                                    Decimal NewAllowedAmount = 0;
                                    if (gvSettlementsInMedBill["AllowedAmount", i].Value != null) NewAllowedAmount = Decimal.Parse(gvSettlementsInMedBill["AllowedAmount", i].Value.ToString());
                                    String NewNote = String.Empty;
                                    if (gvSettlementsInMedBill["Note", i].Value != null) NewNote = gvSettlementsInMedBill["Note", i].Value.ToString();

                                    cmdInsertNewSettlement.Parameters.AddWithValue("@SettlementName", NewSettlementName);
                                    cmdInsertNewSettlement.Parameters.AddWithValue("@CreateDate", DateTime.Today);
                                    cmdInsertNewSettlement.Parameters.AddWithValue("@CreateByID", nLoggedUserId);
                                    cmdInsertNewSettlement.Parameters.AddWithValue("@LastModifiedDate", DateTime.Today);
                                    cmdInsertNewSettlement.Parameters.AddWithValue("@LastModifiedByID", nLoggedUserId);
                                    cmdInsertNewSettlement.Parameters.AddWithValue("@SystemModifiedStamp", DateTime.Today);
                                    cmdInsertNewSettlement.Parameters.AddWithValue("@LastActivityDate", DateTime.Today);
                                    cmdInsertNewSettlement.Parameters.AddWithValue("@LastViewedDate", DateTime.Today);
                                    cmdInsertNewSettlement.Parameters.AddWithValue("@MedBillID", txtMedBillNo.Text.Trim());
                                    cmdInsertNewSettlement.Parameters.AddWithValue("@SettlementType", nNewSettlementType);

                                    cmdInsertNewSettlement.Parameters.AddWithValue("@IsApproved", NewIsApproved);

                                    if (NewApprovedDate != null) cmdInsertNewSettlement.Parameters.AddWithValue("@ApprovedDate", NewApprovedDate);
                                    else cmdInsertNewSettlement.Parameters.AddWithValue("@ApprovedDate", DBNull.Value);

                                    cmdInsertNewSettlement.Parameters.AddWithValue("@CMMPaymentMethod", nNewCMMPaymentMethod);

                                    if (NewCheckNo != String.Empty) cmdInsertNewSettlement.Parameters.AddWithValue("@CheckNo", NewCheckNo);
                                    else cmdInsertNewSettlement.Parameters.AddWithValue("@CheckNo", DBNull.Value);

                                    if (NewCheckDate != null) cmdInsertNewSettlement.Parameters.AddWithValue("@CheckDate", NewCheckDate);
                                    else cmdInsertNewSettlement.Parameters.AddWithValue("@CheckDate", DBNull.Value);

                                    cmdInsertNewSettlement.Parameters.AddWithValue("@IsCheckReconciled", NewCheckReconciled);

                                    if (NewACH_Number != null) cmdInsertNewSettlement.Parameters.AddWithValue("@ACH_Number", NewACH_Number);
                                    else cmdInsertNewSettlement.Parameters.AddWithValue("@ACH_Number", DBNull.Value);

                                    if (NewACH_Date != null) cmdInsertNewSettlement.Parameters.AddWithValue("@ACH_Date", NewACH_Date);
                                    else cmdInsertNewSettlement.Parameters.AddWithValue("@ACH_Date", DBNull.Value);

                                    cmdInsertNewSettlement.Parameters.AddWithValue("@IsACH_Reconciled", NewACH_Reconciled);
                                    cmdInsertNewSettlement.Parameters.AddWithValue("@CMMCreditCard", nCMMCreditCard);

                                    if (NewCreditCardPaidDate != null) cmdInsertNewSettlement.Parameters.AddWithValue("@CMMCreditCardPaidDate", NewCreditCardPaidDate);
                                    else cmdInsertNewSettlement.Parameters.AddWithValue("@CMMCreditCardPaidDate", DBNull.Value);

                                    cmdInsertNewSettlement.Parameters.AddWithValue("@IsCC_Reconciled", NewIsCCReconciled);
                                    cmdInsertNewSettlement.Parameters.AddWithValue("@AllowedAmount", NewAllowedAmount);

                                    if (NewNote != null) cmdInsertNewSettlement.Parameters.AddWithValue("@Notes", NewNote);
                                    else cmdInsertNewSettlement.Parameters.AddWithValue("@Notes", DBNull.Value);

                                    int nIneligibleReason = 0;
                                    for (int j = 0; j < dicIneligibleReason.Count; j++)
                                    {
                                        if (gvSettlementsInMedBill["IneligibleReason", i]?.Value?.ToString() == dicIneligibleReason[j]) nIneligibleReason = j;
                                    }
                                    cmdInsertNewSettlement.Parameters.AddWithValue("@IneligibleReason", nIneligibleReason);

                                    if (connRN5.State != ConnectionState.Closed)
                                    {
                                        connRN5.Close();
                                        connRN5.Open();
                                    }
                                    else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                                    int nSettlementInserted = cmdInsertNewSettlement.ExecuteNonQuery();
                                    if (connRN5.State != ConnectionState.Closed) connRN5.Close();

                                    if (nSettlementInserted == 0) bError = true;

                                    // Well Being eligibility check

                                }
                                else  // the settlement with the name exist, update the settlement
                                {
                                    String UpdateSettlementName = objResultSettlementName.ToString();
                                    String UpdateMedBill = txtMedBillNo.Text.Trim();

                                    String strSqlUpdateSettlement = "update [dbo].[tbl_settlement] set [dbo].[tbl_settlement].[LastModifiedDate] = @LastModifiedDate, " +
                                                                    "[dbo].[tbl_settlement].[LastModifiedByID] = @LastModifiedByID, " +
                                                                    "[dbo].[tbl_settlement].[LastActivityDate] = @LastActivityDate, " +
                                                                    "[dbo].[tbl_settlement].[SettlementType] = @SettlementType, " +
                                                                    "[dbo].[tbl_settlement].[Amount] = @SettlementAmount, " +
                                                                    "[dbo].[tbl_settlement].[PersonalResponsibilityCredit] = @PersonalResponsibilityCredit, " +
                                                                    "[dbo].[tbl_settlement].[Approved] = @IsApproved, " +
                                                                    "[dbo].[tbl_settlement].[ApprovedDate] = @ApprovedDate, " +
                                                                    "[dbo].[tbl_settlement].[CMMPaymentMethod] = @CMMPaymentMethod, " +
                                                                    "[dbo].[tbl_settlement].[CheckNo] = @CheckNo, " +
                                                                    "[dbo].[tbl_settlement].[CheckDate] = @CheckDate, " +
                                                                    "[dbo].[tbl_settlement].[CheckReconciled] = @CheckReconciled, " +
                                                                    "[dbo].[tbl_settlement].[ACH_Number] = @ACH_Number, " +
                                                                    "[dbo].[tbl_settlement].[ACH_Date] = @ACH_Date, " +
                                                                    "[dbo].[tbl_settlement].[ACH_Reconciled] = @ACH_Reconciled, " +
                                                                    "[dbo].[tbl_settlement].[CMMCreditCard] = @CMMCreditCard, " +
                                                                    "[dbo].[tbl_settlement].[CMMCreditCardPaidDate] = @CMMCreditCardPaidDate, " +
                                                                    "[dbo].[tbl_settlement].[CC_Reconciled] = @CC_Reconciled, " +
                                                                    "[dbo].[tbl_settlement].[AllowedAmount] = @AllowedAmount, " +
                                                                    "[dbo].[tbl_settlement].[Notes] = @Note, " +
                                                                    "[dbo].[tbl_settlement].[IneligibleReason] = @IneligibleReason " +
                                                                    "where [dbo].[tbl_settlement].[Name] = @SettlementName and [dbo].[tbl_settlement].[MedicalBillID] = @MedBillName";

                                    int nSettlementType = 0;
                                    String strSettlementType = String.Empty;
                                    if (gvSettlementsInMedBill["SettlementTypeValue", i].Value != null) strSettlementType = gvSettlementsInMedBill["SettlementTypeValue", i].Value.ToString();
                                    for (int j = 0; j < lstSettlementType.Count; j++)
                                    {
                                        if (strSettlementType == lstSettlementType[j].SettlementTypeValue) nSettlementType = lstSettlementType[j].SettlementTypeCode;
                                    }

                                    Decimal SettlementAmount = 0;
                                    if (gvSettlementsInMedBill["SettlementAmount", i].Value != null)
                                    {
                                        SettlementAmount = Decimal.Parse(gvSettlementsInMedBill["SettlementAmount", i].Value.ToString(), NumberStyles.Currency);
                                    }

                                    Decimal PersonalResponsibilityAmt = 0;
                                    if (gvSettlementsInMedBill["PersonalResponsibility", i].Value != null)
                                    {
                                        PersonalResponsibilityAmt = Decimal.Parse(gvSettlementsInMedBill["PersonalResponsibility", i].Value.ToString(), NumberStyles.Currency);
                                    }

                                    // Payment method
                                    int nPaymentMethod = 0;
                                    String PaymentMethod = String.Empty;
                                    if (gvSettlementsInMedBill["PaymentMethod", i].Value != null)
                                        PaymentMethod = gvSettlementsInMedBill["PaymentMethod", i].Value.ToString();
                                    for (int j = 0; j < lstPaymentMethod.Count; j++)
                                    {
                                        if (PaymentMethod == lstPaymentMethod[j].PaymentMethodValue) nPaymentMethod = lstPaymentMethod[j].PaymentMethodId;
                                    }

                                    // Approved or not
                                    int nApproved = 0;
                                    if (gvSettlementsInMedBill["Approved", i].Value != null)
                                    {
                                        if ((Boolean)gvSettlementsInMedBill["Approved", i].Value) nApproved = 1;
                                    }

                                    DateTime? ApprovedDate = null;
                                    //if (gvSettlementsInMedBill["ApprovedDate", i].Value != null) ApprovedDate = DateTime.Parse(gvSettlementsInMedBill["ApprovedDate", i].Value.ToString());
                                    if (gvSettlementsInMedBill["ApprovedDate", i]?.Value != null)
                                    {
                                        DateTime resultDateTime;
                                        if (DateTime.TryParse(gvSettlementsInMedBill["ApprovedDate", i]?.Value?.ToString(), out resultDateTime))
                                            ApprovedDate = resultDateTime;
                                    }


                                    String CheckNo = String.Empty;
                                    DateTime? CheckIssueDate = null;
                                    int nCheckReconciled = 0;

                                    String ACH_No = String.Empty;
                                    DateTime? ACH_Date = null;
                                    int nACHReconciled = 0;

                                    String CreditCard = String.Empty;
                                    int nCreditCard = 0;
                                    DateTime? CreditCardPaidDate = null;
                                    int nCCReconciled = 0;

                                    switch (PaymentMethod)
                                    {
                                        case "Check":
                                            if (gvSettlementsInMedBill["CheckNo", i].Value != null) CheckNo = gvSettlementsInMedBill["CheckNo", i].Value.ToString();
                                            if (gvSettlementsInMedBill["PaymentDate", i].Value != null)
                                            {
                                                if (gvSettlementsInMedBill["PaymentDate", i].Value.ToString() != String.Empty) CheckIssueDate = DateTime.Parse(gvSettlementsInMedBill["PaymentDate", i].Value.ToString());
                                            }
                                            Boolean bCheckReconciledResult = false;
                                            if (gvSettlementsInMedBill["Reconciled", i].Value != null)
                                            {
                                                if (Boolean.TryParse(gvSettlementsInMedBill["Reconciled", i].Value.ToString(), out bCheckReconciledResult))
                                                {
                                                    if (bCheckReconciledResult) nCheckReconciled = 1;
                                                }
                                            }
                                            break;
                                        case "ACH/Banking":
                                            if (gvSettlementsInMedBill["ACHNo", i].Value != null) ACH_No = gvSettlementsInMedBill["ACHNo", i].Value.ToString();
                                            if (gvSettlementsInMedBill["PaymentDate", i].Value != null)
                                            {
                                                if (gvSettlementsInMedBill["PaymentDate", i].Value.ToString() != String.Empty) ACH_Date = DateTime.Parse(gvSettlementsInMedBill["PaymentDate", i].Value.ToString());
                                            }
                                            Boolean bACHReconciledResult = false;
                                            if (gvSettlementsInMedBill["Reconciled", i].Value != null)
                                            {
                                                if (Boolean.TryParse(gvSettlementsInMedBill["Reconciled", i].Value.ToString(), out bACHReconciledResult))
                                                {
                                                    if (bACHReconciledResult) nACHReconciled = 1;
                                                }
                                            }
                                            break;
                                        case "Credit Card":
                                            if (gvSettlementsInMedBill["CreditCard", i].Value != null) CreditCard = gvSettlementsInMedBill["CreditCard", i].Value.ToString();
                                            for (int j = 0; j < lstCreditCardInfo.Count; j++)
                                            {
                                                if (CreditCard == lstCreditCardInfo[j].CreditCardNo) nCreditCard = lstCreditCardInfo[j].CreditCardId;
                                            }
                                            if (gvSettlementsInMedBill["PaymentDate", i].Value != null)
                                            {
                                                if (gvSettlementsInMedBill["PaymentDate", i].Value.ToString() != String.Empty)
                                                    CreditCardPaidDate = DateTime.Parse(gvSettlementsInMedBill["PaymentDate", i].Value.ToString());
                                            }
                                            Boolean bCCReconciledResult = false;
                                            if (gvSettlementsInMedBill[15, i].Value != null)
                                            {
                                                if (Boolean.TryParse(gvSettlementsInMedBill["Reconciled", i].Value.ToString(), out bCCReconciledResult))
                                                {
                                                    if (bCCReconciledResult) nCCReconciled = 1;
                                                }
                                            }
                                            break;
                                    }

                                    // Allowed Amount
                                    Decimal AllowedAmount = 0;
                                    if (gvSettlementsInMedBill["AllowedAmount", i].Value != null)
                                    {
                                        AllowedAmount = Decimal.Parse(gvSettlementsInMedBill["AllowedAmount", i].Value.ToString(), NumberStyles.Currency);
                                    }

                                    // Note
                                    String Note = String.Empty;
                                    if (gvSettlementsInMedBill["Note", i].Value != null) Note = gvSettlementsInMedBill["Note", i].Value.ToString();



                                    SqlCommand cmdUpdateSettlement = new SqlCommand(strSqlUpdateSettlement, connRN5);
                                    cmdUpdateSettlement.CommandType = CommandType.Text;

                                    cmdUpdateSettlement.Parameters.AddWithValue("@LastModifiedDate", DateTime.Today);
                                    cmdUpdateSettlement.Parameters.AddWithValue("@LastModifiedByID", nLoggedUserId);
                                    cmdUpdateSettlement.Parameters.AddWithValue("@LastActivityDate", DateTime.Today);
                                    cmdUpdateSettlement.Parameters.AddWithValue("@SettlementType", nSettlementType);


                                    cmdUpdateSettlement.Parameters.AddWithValue("@SettlementAmount", SettlementAmount);
                                    cmdUpdateSettlement.Parameters.AddWithValue("@PersonalResponsibilityCredit", PersonalResponsibilityAmt);

                                    cmdUpdateSettlement.Parameters.AddWithValue("@IsApproved", nApproved);
                                    if (ApprovedDate != null) cmdUpdateSettlement.Parameters.AddWithValue("@ApprovedDate", ApprovedDate);
                                    else cmdUpdateSettlement.Parameters.AddWithValue("@ApprovedDate", DBNull.Value);

                                    cmdUpdateSettlement.Parameters.AddWithValue("@CMMPaymentMethod", nPaymentMethod);

                                    if (CheckNo != String.Empty) cmdUpdateSettlement.Parameters.AddWithValue("@CheckNo", CheckNo);
                                    else cmdUpdateSettlement.Parameters.AddWithValue("@CheckNo", DBNull.Value);

                                    if (CheckIssueDate != null) cmdUpdateSettlement.Parameters.AddWithValue("@CheckDate", CheckIssueDate);
                                    else cmdUpdateSettlement.Parameters.AddWithValue("@CheckDate", DBNull.Value);

                                    cmdUpdateSettlement.Parameters.AddWithValue("@CheckReconciled", nCheckReconciled);

                                    if (ACH_No != String.Empty) cmdUpdateSettlement.Parameters.AddWithValue("@ACH_Number", ACH_No);
                                    else cmdUpdateSettlement.Parameters.AddWithValue("@ACH_Number", DBNull.Value);

                                    if (ACH_Date != null) cmdUpdateSettlement.Parameters.AddWithValue("@ACH_Date", ACH_Date);
                                    else cmdUpdateSettlement.Parameters.AddWithValue("@ACH_Date", DBNull.Value);

                                    cmdUpdateSettlement.Parameters.AddWithValue("@ACH_Reconciled", nACHReconciled);
                                    cmdUpdateSettlement.Parameters.AddWithValue("@CMMCreditCard", nCreditCard);

                                    if (CreditCardPaidDate != null) cmdUpdateSettlement.Parameters.AddWithValue("@CMMCreditCardPaidDate", CreditCardPaidDate);
                                    else cmdUpdateSettlement.Parameters.AddWithValue("@CMMCreditCardPaidDate", DBNull.Value);
                                    cmdUpdateSettlement.Parameters.AddWithValue("@CC_Reconciled", nCCReconciled);
                                    cmdUpdateSettlement.Parameters.AddWithValue("@AllowedAmount", AllowedAmount);
                                    if (Note != String.Empty) cmdUpdateSettlement.Parameters.AddWithValue("@Note", Note);
                                    else cmdUpdateSettlement.Parameters.AddWithValue("@Note", DBNull.Value);

                                    cmdUpdateSettlement.Parameters.AddWithValue("@SettlementName", UpdateSettlementName);
                                    cmdUpdateSettlement.Parameters.AddWithValue("@MedBillName", UpdateMedBill);

                                    int nIneligibleReason = 0;
                                    for (int j = 0; j < dicIneligibleReason.Count; j++)
                                    {
                                        if (gvSettlementsInMedBill["IneligibleReason", i]?.Value?.ToString() == dicIneligibleReason[j]) nIneligibleReason = j;
                                    }
                                    cmdUpdateSettlement.Parameters.AddWithValue("@IneligibleReason", nIneligibleReason);

                                    if (connRN5.State != ConnectionState.Closed)
                                    {
                                        connRN5.Close();
                                        connRN5.Open();
                                    }
                                    else if (connRN5.State == ConnectionState.Closed) connRN5.Open();

                                    int nSettlmentsUpdated = cmdUpdateSettlement.ExecuteNonQuery();
                                    if (connRN5.State != ConnectionState.Closed) connRN5.Close();

                                    if (nSettlmentsUpdated == 0) bError = true;
                                }
                            }

                            ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

                            for (int i = 0; i < gvSettlementsInMedBill.Rows.Count; i++)
                            {
                                if (gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() != "Ineligible")
                                {
                                    gvSettlementsInMedBill["IneligibleReason", i].Value = null;
                                    gvSettlementsInMedBill["IneligibleReason", i].ReadOnly = true;
                                }
                            }

                            if (bError == false)
                            {
                                MessageBox.Show("Settlements have been saved.", "Info");
                            }
                            else if (bError == true)
                            {
                                MessageBox.Show("Some of settlments have not been saved.", "Error");
                                //return;
                            }

                            // update settlement total for medical bill
                            String MedBillNoForSettlementTotal = txtMedBillNo.Text.Trim();
                            String strSqlQueryForSettlementTotal = "Select sum([dbo].[tbl_settlement].[Amount]) from [dbo].[tbl_settlement] " +
                                                                   "where ([dbo].[tbl_settlement].[IsDeleted] IS NULL or [dbo].[tbl_settlement].[IsDeleted] = 0) and " +
                                                                   "[dbo].[tbl_settlement].[MedicalBillID] = @MedBillNo";

                            SqlCommand cmdQueryForSettlementTotal = new SqlCommand(strSqlQueryForSettlementTotal, connRN5);
                            cmdQueryForSettlementTotal.CommandType = CommandType.Text;

                            cmdQueryForSettlementTotal.Parameters.AddWithValue("@MedBillNo", MedBillNoForSettlementTotal);

                            if (connRN5.State != ConnectionState.Closed)
                            {
                                connRN5.Close();
                                connRN5.Open();
                            }
                            else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                            Decimal SettlementTotal = (Decimal)cmdQueryForSettlementTotal.ExecuteScalar();
                            if (connRN5.State != ConnectionState.Closed) connRN.Close();

                            String strSqlUpdateMedBillForSettlementTotal = "update [dbo].[tbl_medbill] set [dbo].[tbl_medbill].[SettlementTotal] = @SettlementTotal " +
                                                                           "where ([dbo].[tbl_medbill].[IsDeleted] IS NULL or [dbo].[tbl_medbill].[IsDeleted] = 0) and " +
                                                                           "[dbo].[tbl_medbill].[BillNo] = @MedBillNo";

                            SqlCommand cmdUpdateMedBillForSettlementTotal = new SqlCommand(strSqlUpdateMedBillForSettlementTotal, connRN5);
                            cmdUpdateMedBillForSettlementTotal.CommandType = CommandType.Text;

                            cmdUpdateMedBillForSettlementTotal.Parameters.AddWithValue("@SettlementTotal", SettlementTotal);
                            cmdUpdateMedBillForSettlementTotal.Parameters.AddWithValue("@MedBillNo", MedBillNoForSettlementTotal);

                            if (connRN5.State != ConnectionState.Closed)
                            {
                                connRN5.Close();
                                connRN5.Open();
                            }
                            else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                            int nMedBillUpdatedForSettlementTotal = cmdUpdateMedBillForSettlementTotal.ExecuteNonQuery();
                            if (connRN5.State != ConnectionState.Closed) connRN.Close();
                        }
                        // prepare settlement gv
                        //MedBillNo

                        String strSqlQueryForSettlement = "select [dbo].[tbl_settlement].[Name], [dbo].[tbl_settlement_type_code].[SettlementTypeValue], [dbo].[tbl_settlement].[Amount], " +
                                  "[dbo].[tbl_settlement].[PersonalResponsibilityCredit], [dbo].[tbl_payment_method].[PaymentMethod_Value], " +
                                  "[dbo].[tbl_settlement].[Approved], [dbo].[tbl_settlement].[ApprovedDate], " +
                                  "[dbo].[tbl_settlement].[CheckNo], [dbo].[tbl_settlement].[CheckDate], [dbo].[tbl_settlement].[CheckReconciled], " +
                                  "[dbo].[tbl_settlement].[ACH_Number], [dbo].[tbl_settlement].[ACH_Date], [dbo].[tbl_settlement].[ACH_Reconciled], " +
                                  "[dbo].[tbl_Credit_Card__c].[Name], [dbo].[tbl_settlement].[CMMCreditCardPaidDate], [dbo].[tbl_settlement].[CC_Reconciled], " +
                                  "[dbo].[tbl_settlement].[AllowedAmount], [dbo].[tbl_settlement].[IneligibleReason], " +
                                  "[dbo].[tbl_settlement].[Notes] " +
                                  "from [dbo].[tbl_settlement] inner join [dbo].[tbl_settlement_type_code] " +
                                  "on [dbo].[tbl_settlement].[SettlementType] = [dbo].[tbl_settlement_type_code].[SettlementTypeCode] " +
                                  "inner join [dbo].[tbl_payment_method] on [dbo].[tbl_settlement].[CMMPaymentMethod] = [dbo].[tbl_payment_method].[PaymentMethod_Id] " +
                                  "inner join [dbo].[tbl_Credit_Card__c] on [dbo].[tbl_settlement].[CMMCreditCard] = [dbo].[tbl_Credit_Card__c].[CreditCard_Id]" +
                                  "where [dbo].[tbl_settlement].[MedicalBillID] = @MedBillNo and " +
                                  "([dbo].[tbl_settlement].[IsDeleted] = 0 or [dbo].[tbl_settlement].[IsDeleted] IS NULL) " +
                                  "order by [dbo].[tbl_settlement].[Name]";

                        SqlCommand cmdQueryForSettlement = new SqlCommand(strSqlQueryForSettlement, connRN5);
                        cmdQueryForSettlement.CommandType = CommandType.Text;

                        cmdQueryForSettlement.Parameters.AddWithValue("@MedBillNo", strNewMedBillNo);

                        SqlDependency dependencySettlementInMedBill = new SqlDependency(cmdQueryForSettlement);
                        dependencySettlementInMedBill.OnChange += new OnChangeEventHandler(OnSettlementsInMedBillEditChange);

                        if (connRN5.State != ConnectionState.Closed)
                        {
                            connRN5.Close();
                            connRN5.Open();
                        }
                        else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                        SqlDataReader rdrSettlement = cmdQueryForSettlement.ExecuteReader();
                        gvSettlementsInMedBill.Rows.Clear();
                        if (rdrSettlement.HasRows)
                        {
                            while (rdrSettlement.Read())
                            {
                                DataGridViewRow row = new DataGridViewRow();
                                row.Cells.Add(new DataGridViewCheckBoxCell { Value = false });
                                if (!rdrSettlement.IsDBNull(0)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlement.GetString(0) });
                                if (!rdrSettlement.IsDBNull(1))
                                {
                                    DataGridViewComboBoxCell comboCellSettlementType = new DataGridViewComboBoxCell();

                                    for (int i = 0; i < lstSettlementType.Count; i++)
                                    {
                                        comboCellSettlementType.Items.Add(lstSettlementType[i].SettlementTypeValue);
                                    }
                                    for (int i = 0; i < comboCellSettlementType.Items.Count; i++)
                                    {
                                        if (rdrSettlement.GetString(1) == comboCellSettlementType.Items[i].ToString())
                                            comboCellSettlementType.Value = comboCellSettlementType.Items[i];
                                    }

                                    row.Cells.Add(comboCellSettlementType);
                                }
                                else
                                {
                                    DataGridViewComboBoxCell comboCellSettlementType = new DataGridViewComboBoxCell();
                                    for (int i = 0; i < lstSettlementType.Count; i++)
                                    {
                                        comboCellSettlementType.Items.Add(lstSettlementType[i].SettlementTypeValue);
                                    }

                                    for (int i = 0; i < comboCellSettlementType.Items.Count; i++)
                                    {
                                        if (rdrSettlement.GetString(1) == comboCellSettlementType.Items[i].ToString())
                                            comboCellSettlementType.Value = comboCellSettlementType.Items[i];
                                    }

                                    row.Cells.Add(comboCellSettlementType);
                                }

                                if (!rdrSettlement.IsDBNull(2)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlement.GetDecimal(2).ToString("C") });
                                else
                                {
                                    Decimal Zero = 0;
                                    row.Cells.Add(new DataGridViewTextBoxCell { Value = Zero.ToString("C") });
                                }


                                if (!rdrSettlement.IsDBNull(3)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlement.GetDecimal(3).ToString("C") });
                                else
                                {
                                    Decimal Zero = 0;
                                    row.Cells.Add(new DataGridViewTextBoxCell { Value = Zero.ToString("C") });
                                }

                                if (!rdrSettlement.IsDBNull(4))
                                {
                                    DataGridViewComboBoxCell comboCellPaymentMethod = new DataGridViewComboBoxCell();

                                    for (int i = 0; i < lstPaymentMethod.Count; i++)
                                    {
                                        if (lstPaymentMethod[i].PaymentMethodValue != null) comboCellPaymentMethod.Items.Add(lstPaymentMethod[i].PaymentMethodValue);
                                        else comboCellPaymentMethod.Items.Add(String.Empty);
                                    }

                                    for (int i = 0; i < comboCellPaymentMethod.Items.Count; i++)
                                    {
                                        if (rdrSettlement.GetString(4) == comboCellPaymentMethod.Items[i].ToString())
                                            comboCellPaymentMethod.Value = comboCellPaymentMethod.Items[i];
                                    }

                                    row.Cells.Add(comboCellPaymentMethod);
                                }
                                else
                                {
                                    DataGridViewComboBoxCell comboCellPaymentMethod = new DataGridViewComboBoxCell();

                                    for (int i = 0; i < lstPaymentMethod.Count; i++)
                                    {
                                        if (lstPaymentMethod[i].PaymentMethodValue != null) comboCellPaymentMethod.Items.Add(lstPaymentMethod[i].PaymentMethodValue);
                                        else comboCellPaymentMethod.Items.Add(String.Empty);
                                    }

                                    for (int i = 0; i < comboCellPaymentMethod.Items.Count; i++)
                                    {
                                        if ((!rdrSettlement.IsDBNull(4)) && comboCellPaymentMethod.Items[i] != null)
                                        {
                                            if (rdrSettlement.GetString(4) == comboCellPaymentMethod.Items[i].ToString())
                                                comboCellPaymentMethod.Value = comboCellPaymentMethod.Items[i];
                                        }
                                        else comboCellPaymentMethod.Value = null;
                                    }

                                    row.Cells.Add(comboCellPaymentMethod);

                                }

                                if (!rdrSettlement.IsDBNull(5))
                                {

                                    DataGridViewCheckBoxCell approvedCell = new DataGridViewCheckBoxCell();
                                    approvedCell.Value = rdrSettlement.GetBoolean(5);
                                    approvedCell.Style.Alignment = DataGridViewContentAlignment.MiddleCenter;
                                    row.Cells.Add(approvedCell);
                                }
                                else
                                {
                                    DataGridViewCheckBoxCell approvedCell = new DataGridViewCheckBoxCell();
                                    approvedCell.Value = false;
                                    approvedCell.Style.Alignment = DataGridViewContentAlignment.MiddleCenter;
                                    row.Cells.Add(approvedCell);
                                }

                                if (!rdrSettlement.IsDBNull(6)) row.Cells.Add(new CalendarCell { Value = DateTime.Parse(rdrSettlement.GetDateTime(6).ToString("MM/dd/yyyy")) });
                                else row.Cells.Add(new CalendarCell { Value = null });

                                // Payment information
                                if (!rdrSettlement.IsDBNull(4))
                                {
                                    String strPaymentMethod = rdrSettlement.GetString(4);

                                    switch (strPaymentMethod)
                                    {
                                        case "Check":
                                            if (!rdrSettlement.IsDBNull(7)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlement.GetString(7) });
                                            else row.Cells.Add(new DataGridViewTextBoxCell { Value = null });
                                            row.Cells.Add(new DataGridViewTextBoxCell { Value = null });
                                            DataGridViewComboBoxCell comboCellCreditCardNoneForCheck = new DataGridViewComboBoxCell();
                                            for (int i = 0; i < lstCreditCardInfo.Count; i++)
                                            {
                                                if (lstCreditCardInfo[i].CreditCardNo != null) comboCellCreditCardNoneForCheck.Items.Add(lstCreditCardInfo[i].CreditCardNo);
                                                else comboCellCreditCardNoneForCheck.Items.Add(String.Empty);
                                            }
                                            row.Cells.Add(comboCellCreditCardNoneForCheck);
                                            if (!rdrSettlement.IsDBNull(8)) row.Cells.Add(new CalendarCell { Value = DateTime.Parse(rdrSettlement.GetDateTime(8).ToString("MM/dd/yyyy")) });
                                            else row.Cells.Add(new CalendarCell { Value = String.Empty });
                                            if (!rdrSettlement.IsDBNull(9)) row.Cells.Add(new DataGridViewCheckBoxCell { Value = rdrSettlement.GetBoolean(9) });
                                            else row.Cells.Add(new DataGridViewCheckBoxCell { Value = false });
                                            break;
                                        case "ACH/Banking":
                                            row.Cells.Add(new DataGridViewTextBoxCell { Value = null });
                                            if (!rdrSettlement.IsDBNull(10)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlement.GetString(10) });
                                            else row.Cells.Add(new DataGridViewTextBoxCell { Value = null });
                                            DataGridViewComboBoxCell comboCellCreditCardNoneForACH = new DataGridViewComboBoxCell();
                                            for (int i = 0; i < lstCreditCardInfo.Count; i++)
                                            {
                                                if (lstCreditCardInfo[i].CreditCardNo != null)
                                                    comboCellCreditCardNoneForACH.Items.Add(lstCreditCardInfo[i].CreditCardNo);
                                                else comboCellCreditCardNoneForACH.Items.Add(String.Empty);
                                            }
                                            row.Cells.Add(comboCellCreditCardNoneForACH);
                                            if (!rdrSettlement.IsDBNull(11)) row.Cells.Add(new CalendarCell { Value = DateTime.Parse(rdrSettlement.GetDateTime(11).ToString("MM/dd/yyyy")) });
                                            else row.Cells.Add(new CalendarCell { Value = String.Empty });
                                            if (!rdrSettlement.IsDBNull(12)) row.Cells.Add(new DataGridViewCheckBoxCell { Value = rdrSettlement.GetBoolean(12) });
                                            else row.Cells.Add(new DataGridViewCheckBoxCell { Value = false });
                                            break;
                                        case "Credit Card":
                                            row.Cells.Add(new DataGridViewTextBoxCell { Value = null });
                                            row.Cells.Add(new DataGridViewTextBoxCell { Value = null });
                                            DataGridViewComboBoxCell comboCellCreditCard = new DataGridViewComboBoxCell();
                                            if (!rdrSettlement.IsDBNull(13))
                                            {
                                                for (int i = 0; i < lstCreditCardInfo.Count; i++)
                                                {
                                                    if (lstCreditCardInfo[i].CreditCardNo != null) comboCellCreditCard.Items.Add(lstCreditCardInfo[i].CreditCardNo);
                                                    else comboCellCreditCard.Items.Add(String.Empty);
                                                }
                                                for (int i = 0; i < comboCellCreditCard.Items.Count; i++)
                                                {
                                                    if (rdrSettlement.GetString(13) == comboCellCreditCard.Items[i].ToString())
                                                        comboCellCreditCard.Value = comboCellCreditCard.Items[i];
                                                }
                                            }
                                            else
                                            {
                                                for (int i = 0; i < lstCreditCardInfo.Count; i++)
                                                {
                                                    if (lstCreditCardInfo[i].CreditCardNo != null) comboCellCreditCard.Items.Add(lstCreditCardInfo[i].CreditCardNo);
                                                    else comboCellCreditCard.Items.Add(String.Empty);
                                                }
                                                comboCellCreditCard.Value = String.Empty;
                                            }
                                            row.Cells.Add(comboCellCreditCard);
                                            if (!rdrSettlement.IsDBNull(14)) row.Cells.Add(new CalendarCell { Value = DateTime.Parse(rdrSettlement.GetDateTime(14).ToString("MM/dd/yyyy")) });
                                            else row.Cells.Add(new CalendarCell { Value = String.Empty });
                                            if (!rdrSettlement.IsDBNull(15)) row.Cells.Add(new DataGridViewCheckBoxCell { Value = rdrSettlement.GetBoolean(15) });
                                            else row.Cells.Add(new DataGridViewCheckBoxCell { Value = false });
                                            break;
                                        default:
                                            row.Cells.Add(new DataGridViewTextBoxCell { Value = null });
                                            row.Cells.Add(new DataGridViewTextBoxCell { Value = null });
                                            DataGridViewComboBoxCell comboCellCreditCardNone = new DataGridViewComboBoxCell();
                                            for (int i = 0; i < lstCreditCardInfo.Count; i++)
                                            {
                                                if (lstCreditCardInfo[i].CreditCardNo != null) comboCellCreditCardNone.Items.Add(lstCreditCardInfo[i].CreditCardNo);
                                                else comboCellCreditCardNone.Items.Add(String.Empty);
                                            }
                                            row.Cells.Add(comboCellCreditCardNone);
                                            row.Cells.Add(new CalendarCell { Value = null });
                                            row.Cells.Add(new DataGridViewCheckBoxCell { Value = null });
                                            break;
                                    }
                                }
                                else
                                {

                                    DataGridViewTextBoxCell txtCheckNoCell = new DataGridViewTextBoxCell();
                                    txtCheckNoCell.Value = null;
                                    row.Cells.Add(txtCheckNoCell);
                                    DataGridViewTextBoxCell txtACHNoCell = new DataGridViewTextBoxCell();
                                    txtACHNoCell.Value = null;
                                    row.Cells.Add(txtACHNoCell);
                                    DataGridViewComboBoxCell comboCreditCardCell = new DataGridViewComboBoxCell();
                                    for (int i = 0; i < lstCreditCardInfo.Count; i++)
                                    {
                                        if (lstCreditCardInfo[i].CreditCardNo != null) comboCreditCardCell.Items.Add(lstCreditCardInfo[i].CreditCardNo);
                                        else comboCreditCardCell.Items.Add(String.Empty);
                                    }
                                    row.Cells.Add(comboCreditCardCell);
                                    comboCreditCardCell.ReadOnly = true;
                                    CalendarCell calPaymentDate = new CalendarCell();
                                    calPaymentDate.Value = null;
                                    row.Cells.Add(calPaymentDate);
                                    DataGridViewCheckBoxCell chkReconciledCell = new DataGridViewCheckBoxCell();
                                    chkReconciledCell.Value = false;
                                    row.Cells.Add(chkReconciledCell);
                                }

                                if (!rdrSettlement.IsDBNull(16)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlement.GetDecimal(16).ToString("C") });
                                else row.Cells.Add(new DataGridViewTextBoxCell { Value = null });

                                if (!rdrSettlement.IsDBNull(17))
                                {
                                    if (dicIneligibleReason.Count > 0)
                                    {
                                        DataGridViewComboBoxCell comboCellIneligibleReason = new DataGridViewComboBoxCell();
                                        for (int i = 0; i < dicIneligibleReason.Count; i++)
                                        {
                                            comboCellIneligibleReason.Items.Add(dicIneligibleReason[i]);
                                        }
                                        //comboCellIneligibleReason.Sorted = true;
                                        comboCellIneligibleReason.Value = comboCellIneligibleReason.Items[rdrSettlement.GetInt32(17)];
                                        row.Cells.Add(comboCellIneligibleReason);
                                    }
                                }
                                else
                                {
                                    if (dicIneligibleReason.Count > 0)
                                    {
                                        DataGridViewComboBoxCell comboCellIneligibleReason = new DataGridViewComboBoxCell();
                                        for (int i = 0; i < dicIneligibleReason.Count; i++)
                                        {
                                            comboCellIneligibleReason.Items.Add(dicIneligibleReason[i]);
                                        }
                                        //comboCellIneligibleReason.Sorted = true;
                                        comboCellIneligibleReason.Value = comboCellIneligibleReason.Items[0];
                                        row.Cells.Add(comboCellIneligibleReason);
                                    }
                                }

                                if (!rdrSettlement.IsDBNull(18)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlement.GetString(18) });
                                else row.Cells.Add(new DataGridViewTextBoxCell { Value = null });

                                gvSettlementsInMedBill.Rows.Add(row);
                            }
                        }
                        rdrSettlement.Close();
                        if (connRN5.State != ConnectionState.Closed) connRN5.Close();

                        String strIllnessIdForIncidentSharedTotal = String.Empty;

                        if (txtMedBill_Illness.Text.Trim() != String.Empty)
                        {
                            String IllnessNo = txtMedBill_Illness.Text.Trim();

                            String strSqlQueryForIllnessId = "select [dbo].[tbl_illness].[Illness_Id] from [dbo].[tbl_illness] where [dbo].[tbl_illness].[IllnessNo] = @IllnessNo";

                            SqlCommand cmdQueryForIllnessId = new SqlCommand(strSqlQueryForIllnessId, connRN5);
                            cmdQueryForIllnessId.CommandType = CommandType.Text;

                            cmdQueryForIllnessId.Parameters.AddWithValue("@IllnessNo", txtMedBill_Illness.Text.Trim());

                            if (connRN5.State != ConnectionState.Closed)
                            {
                                connRN5.Close();
                                connRN5.Open();
                            }
                            else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                            Object objIllnessId = cmdQueryForIllnessId.ExecuteScalar();
                            if (connRN5.State != ConnectionState.Closed) connRN5.Close();

                            if (objIllnessId != null) strIllnessIdForIncidentSharedTotal = objIllnessId.ToString();
                            else
                            {
                                MessageBox.Show("No Illness Id for given Illness No", "Error");
                                return;
                            }
                        }

                        String strIncidentIdForIncidentSharedTotal = String.Empty;

                        if (txtMedBill_Incident.Text.Trim() != String.Empty)
                        {
                            String IncidentNo = txtMedBill_Incident.Text.Trim();

                            String strSqlQueryForIncidentId = "select [dbo].[tbl_incident].[Incident_id] from [dbo].[tbl_incident] where [dbo].[tbl_incident].[IncidentNo] = @IncidentNo";

                            SqlCommand cmdQueryForIncidentId = new SqlCommand(strSqlQueryForIncidentId, connRN5);
                            cmdQueryForIncidentId.CommandType = CommandType.Text;

                            cmdQueryForIncidentId.Parameters.AddWithValue("@IncidentNo", txtMedBill_Incident.Text.Trim());

                            if (connRN5.State != ConnectionState.Closed)
                            {
                                connRN5.Close();
                                connRN5.Open();
                            }
                            else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                            Object objIncidentId = cmdQueryForIncidentId.ExecuteScalar();
                            if (connRN5.State != ConnectionState.Closed) connRN5.Close();

                            if (objIncidentId != null) strIncidentIdForIncidentSharedTotal = objIncidentId.ToString();
                            else
                            {
                                MessageBox.Show("No Incident Id for given Incident No", "Error");
                                return;
                            }
                        }

                        // Calculate the Total Shared Amount in Medical Bill

                        if (gvSettlementsInMedBill.Rows.Count > 0)
                        {
                            String strSqlQueryForTotalSharedAmountSettlementInMedBill = "select sum([dbo].[tbl_settlement].[Amount]) from [dbo].[tbl_settlement] " +
                                                                                        "inner join [dbo].[tbl_settlement_type_code] " +
                                                                                        "on [dbo].[tbl_settlement].[SettlementType] = [dbo].[tbl_settlement_type_code].[SettlementTypeCode] " +
                                                                                        "where [dbo].[tbl_settlement].[MedicalBillID] = @MedBillId and " +
                                                                                        "([dbo].[tbl_settlement].[IsDeleted] = 0 or [dbo].[tbl_settlement].[IsDeleted] IS NULL) and " +
                                                                                        "([dbo].[tbl_settlement_type_code].[SettlementTypeValue] = 'CMM Member Reimbursement' or " +
                                                                                        "[dbo].[tbl_settlement_type_code].[SettlementTypeValue] = 'CMM Provider Payment' or " +
                                                                                        "[dbo].[tbl_settlement_type_code].[SettlementTypeValue] = 'PR Reimbursement')";

                            SqlCommand cmdQueryForTotalSharedAmountInSettlemetsInMedBill = new SqlCommand(strSqlQueryForTotalSharedAmountSettlementInMedBill, connRN5);
                            cmdQueryForTotalSharedAmountInSettlemetsInMedBill.CommandType = CommandType.Text;

                            cmdQueryForTotalSharedAmountInSettlemetsInMedBill.Parameters.AddWithValue("@MedBillId", txtMedBillNo.Text.Trim());

                            if (connRN5.State != ConnectionState.Closed)
                            {
                                connRN5.Close();
                                connRN5.Open();
                            }
                            else if (connRN5.State == ConnectionState.Closed) connRN5.Open();

                            Object objTotalSharedAmountSettlementInMedBill = cmdQueryForTotalSharedAmountInSettlemetsInMedBill.ExecuteScalar();
                            if (connRN5.State != ConnectionState.Closed) connRN5.Close();

                            Decimal TotalSharedAmountSettlement = 0;
                            if (objTotalSharedAmountSettlementInMedBill.ToString() != String.Empty)
                            {
                                TotalSharedAmountSettlement = Decimal.Parse(objTotalSharedAmountSettlementInMedBill.ToString());
                            }

                            String strSqlQueryForMedicalProviderRefund = "select sum([dbo].[tbl_settlement].[Amount]) from [dbo].[tbl_settlement] " +
                                                                         "inner join [dbo].[tbl_settlement_type_code] " +
                                                                         "on [dbo].[tbl_settlement].[SettlementType] = [dbo].[tbl_settlement_type_code].[SettlementTypeCode] " +
                                                                         "where [dbo].[tbl_settlement].[MedicalBillID] = @MedBillId and " +
                                                                         "([dbo].[tbl_settlement].[IsDeleted] = 0 or [dbo].[tbl_settlement].[IsDeleted] IS NULL) and " +
                                                                         "[dbo].[tbl_settlement_type_code].[SettlementTypeValue] = 'Medical Provider Refund'";

                            SqlCommand cmdQueryForMedicalProviderRefund = new SqlCommand(strSqlQueryForMedicalProviderRefund, connRN5);
                            cmdQueryForMedicalProviderRefund.CommandType = CommandType.Text;

                            cmdQueryForMedicalProviderRefund.Parameters.AddWithValue("@MedBillId", txtMedBillNo.Text.Trim());

                            if (connRN5.State != ConnectionState.Closed)
                            {
                                connRN5.Close();
                                connRN5.Open();
                            }
                            else if (connRN5.State == ConnectionState.Closed) connRN5.Open();

                            Object objMedicalProviderRefund = cmdQueryForMedicalProviderRefund.ExecuteScalar();

                            Decimal MedicalProviderRefund = 0;
                            if (objMedicalProviderRefund.ToString() != String.Empty) MedicalProviderRefund = Decimal.Parse(objMedicalProviderRefund.ToString());

                            TotalSharedAmountSettlement -= MedicalProviderRefund;

                            String strSqlUpdateMedBillForTotalSharedAmount = "update [dbo].[tbl_medbill] set [dbo].[tbl_medbill].[TotalSharedAmount] = @TotalSharedAmount " +
                                                     "where [dbo].[tbl_medbill].[BillNo] = @MedBillNo and " +
                                                     "([dbo].[tbl_medbill].[IsDeleted] = 0 or [dbo].[tbl_medbill].[IsDeleted] IS NULL) and " +
                                                     "[dbo].[tbl_medbill].[Illness_Id] = @IllnessId and " +
                                                     "[dbo].[tbl_medbill].[Incident_Id] = @IncidentId and " +
                                                     "[dbo].[tbl_medbill].[Individual_Id] = @IndividualId";

                            SqlCommand cmdUpdateMedBillForTotalSharedAmount = new SqlCommand(strSqlUpdateMedBillForTotalSharedAmount, connRN5);
                            cmdUpdateMedBillForTotalSharedAmount.CommandType = CommandType.Text;

                            cmdUpdateMedBillForTotalSharedAmount.Parameters.AddWithValue("@TotalSharedAmount", TotalSharedAmountSettlement);
                            cmdUpdateMedBillForTotalSharedAmount.Parameters.AddWithValue("@MedBillNo", txtMedBillNo.Text.Trim());
                            cmdUpdateMedBillForTotalSharedAmount.Parameters.AddWithValue("@IllnessId", Int32.Parse(strIllnessIdForIncidentSharedTotal));
                            cmdUpdateMedBillForTotalSharedAmount.Parameters.AddWithValue("@IncidentId", Int32.Parse(strIncidentIdForIncidentSharedTotal));
                            cmdUpdateMedBillForTotalSharedAmount.Parameters.AddWithValue("@IndividualId", txtIndividualIDMedBill.Text.Trim());

                            if (connRN5.State != ConnectionState.Closed)
                            {
                                connRN5.Close();
                                connRN5.Open();
                            }
                            else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                            int nMedBillUpdated = cmdUpdateMedBillForTotalSharedAmount.ExecuteNonQuery();
                            if (connRN5.State != ConnectionState.Closed) connRN5.Close();

                            if (nMedBillUpdated == 0)
                            {
                                MessageBox.Show("The Medical Bill has not been updated with Total Shared Amount.", "Error");
                                return;
                            }

                            if (strIllnessIdForIncidentSharedTotal != String.Empty &&
                                strIncidentIdForIncidentSharedTotal != String.Empty)
                            {

                                String strSqlQueryForIncidentTotalSharedAmount = "select sum([dbo].[tbl_medbill].[TotalSharedAmount]) from [dbo].[tbl_medbill] " +
                                                     "where ([dbo].[tbl_medbill].[IsDeleted] = 0 or [dbo].[tbl_medbill].[IsDeleted] IS NULL) and " +
                                                     "[dbo].[tbl_medbill].[Illness_Id] = @IllnessId and " +
                                                     "[dbo].[tbl_medbill].[Incident_Id] = @IncidentId and " +
                                                     "[dbo].[tbl_medbill].[Individual_Id] = @IndividualId";

                                SqlCommand cmdQueryForIncidentTotalSharedAmount = new SqlCommand(strSqlQueryForIncidentTotalSharedAmount, connRN5);
                                cmdQueryForIncidentTotalSharedAmount.CommandType = CommandType.Text;

                                cmdQueryForIncidentTotalSharedAmount.Parameters.AddWithValue("@IllnessId", Int32.Parse(strIllnessIdForIncidentSharedTotal));
                                cmdQueryForIncidentTotalSharedAmount.Parameters.AddWithValue("@IncidentId", Int32.Parse(strIncidentIdForIncidentSharedTotal));
                                cmdQueryForIncidentTotalSharedAmount.Parameters.AddWithValue("@IndividualId", txtIndividualIDMedBill.Text.Trim());

                                if (connRN5.State != ConnectionState.Closed)
                                {
                                    connRN5.Close();
                                    connRN5.Open();
                                }
                                else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                                Object objIncidentTotalSharedAmount = cmdQueryForIncidentTotalSharedAmount.ExecuteScalar();
                                if (connRN5.State != ConnectionState.Closed) connRN5.Close();

                                Decimal IncidentTotalSharedAmount = 0;
                                if (objIncidentTotalSharedAmount.ToString() != String.Empty)
                                {
                                    IncidentTotalSharedAmount = Decimal.Parse(objIncidentTotalSharedAmount.ToString());
                                }
                                else
                                {
                                    MessageBox.Show("No Incident Total Shared Amount", "Error");
                                    return;
                                }

                                String strUpdateIncidentSharedTotal = "update [dbo].[tbl_incident] set [dbo].[tbl_incident].[TotalSharedAmount] = @TotalSharedAmount " +
                                          "where ([dbo].[tbl_incident].[IsDeleted] = 0 or [dbo].[tbl_incident].[IsDeleted] IS NULL) and " +
                                          "[dbo].[tbl_incident].[Incident_id] = @IncidentId and" +
                                          "[dbo].[tbl_incident].[Illness_id] = @IllnessId and " +
                                          "[dbo].[tbl_incident].[Individual_id] = @IndividualId";

                                SqlCommand cmdUpdateIncidentSharedTotal = new SqlCommand(strUpdateIncidentSharedTotal, connRN5);
                                cmdUpdateIncidentSharedTotal.CommandType = CommandType.Text;

                                cmdUpdateIncidentSharedTotal.Parameters.AddWithValue("@TotalSharedAmount", IncidentTotalSharedAmount);
                                cmdUpdateIncidentSharedTotal.Parameters.AddWithValue("@IncidentId", Int32.Parse(strIncidentIdForIncidentSharedTotal));
                                cmdUpdateIncidentSharedTotal.Parameters.AddWithValue("@IllnessId", Int32.Parse(strIllnessIdForIncidentSharedTotal));
                                cmdUpdateIncidentSharedTotal.Parameters.AddWithValue("@IndividualId", txtIndividualIDMedBill.Text.Trim());

                                if (connRN5.State != ConnectionState.Closed)
                                {
                                    connRN5.Close();
                                    connRN5.Open();
                                }
                                else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                                int nIncidentUpdated = cmdUpdateIncidentSharedTotal.ExecuteNonQuery();
                                if (connRN5.State != ConnectionState.Closed) connRN5.Close();

                                // check whether nIncidentUpdate is 1 or 3
                                if (nIncidentUpdated == 3)
                                {
                                    String strSqlQueryForIllnessTotalSharedAmount = "select sum([dbo].[tbl_incident].[TotalSharedAmount]) from [dbo].[tbl_incident] " +
                                                   "where ([dbo].[tbl_incident].[IsDeleted] = 0 or [dbo].[tbl_incident].[IsDeleted] IS NULL) and " +
                                                   "[dbo].[tbl_incident].[Illness_id] = @IllnessId and " +
                                                   "[dbo].[tbl_incident].[Individual_id] = @IndividualId";


                                    SqlCommand cmdQueryForIllnessTotalSharedAmount = new SqlCommand(strSqlQueryForIllnessTotalSharedAmount, connRN5);
                                    cmdQueryForIllnessTotalSharedAmount.CommandType = CommandType.Text;

                                    cmdQueryForIllnessTotalSharedAmount.Parameters.AddWithValue("@IllnessId", Int32.Parse(strIllnessIdForIncidentSharedTotal));
                                    cmdQueryForIllnessTotalSharedAmount.Parameters.AddWithValue("@IndividualId", txtIndividualIDMedBill.Text.Trim());

                                    if (connRN5.State != ConnectionState.Closed)
                                    {
                                        connRN5.Close();
                                        connRN5.Open();
                                    }
                                    else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                                    Object objIllnessTotalSharedAmount = cmdQueryForIllnessTotalSharedAmount.ExecuteScalar();
                                    if (connRN5.State != ConnectionState.Closed) connRN5.Close();

                                    Decimal IllnessTotalSharedAmount = 0;
                                    if (objIllnessTotalSharedAmount.ToString() != String.Empty) IllnessTotalSharedAmount = Decimal.Parse(objIllnessTotalSharedAmount.ToString());

                                    String strSqlUpdateIllnessSharedTotal = "update [dbo].[tbl_illness] set [dbo].[tbl_illness].[TotalSharedAmount] = @TotalSharedAmount " +
                                            "where ([dbo].[tbl_illness].[IsDeleted] = 0 or [dbo].[tbl_illness].[IsDeleted] IS NULL) and " +
                                            "[dbo].[tbl_illness].[Illness_Id] = @IllnessId and " +
                                            "[dbo].[tbl_illness].[Individual_Id] = @IndividualId";

                                    SqlCommand cmdUpdateIllnessSharedTotal = new SqlCommand(strSqlUpdateIllnessSharedTotal, connRN5);
                                    cmdUpdateIllnessSharedTotal.CommandType = CommandType.Text;

                                    cmdUpdateIllnessSharedTotal.Parameters.AddWithValue("@TotalSharedAmount", IllnessTotalSharedAmount);
                                    cmdUpdateIllnessSharedTotal.Parameters.AddWithValue("@IllnessId", Int32.Parse(strIllnessIdForIncidentSharedTotal));
                                    cmdUpdateIllnessSharedTotal.Parameters.AddWithValue("@IndividualId", txtIndividualIDMedBill.Text.Trim());

                                    if (connRN5.State != ConnectionState.Closed)
                                    {
                                        connRN5.Close();
                                        connRN5.Open();
                                    }
                                    else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                                    int nIllnessUpdated = cmdUpdateIllnessSharedTotal.ExecuteNonQuery();
                                    if (connRN5.State != ConnectionState.Closed) connRN5.Close();

                                    if (nIllnessUpdated == 1)
                                    {
                                        String strSqlQueryForIndividualTotalSharedAmount = "select sum([dbo].[tbl_illness].[TotalSharedAmount]) from [dbo].[tbl_illness] " +
                                                       "where ([dbo].[tbl_illness].[IsDeleted] = 0 or [dbo].[tbl_illness].[IsDeleted] IS NULL) and " +
                                                       "[dbo].[tbl_illness].[Individual_Id] = @IndividualId";

                                        SqlCommand cmdQueryForIndividualTotalSharedAmount = new SqlCommand(strSqlQueryForIndividualTotalSharedAmount, connRN5);
                                        cmdQueryForIndividualTotalSharedAmount.CommandType = CommandType.Text;

                                        cmdQueryForIndividualTotalSharedAmount.Parameters.AddWithValue("@IndividualId", txtIndividualIDMedBill.Text.Trim());

                                        if (connRN5.State != ConnectionState.Closed)
                                        {
                                            connRN5.Close();
                                            connRN5.Open();
                                        }
                                        else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                                        Object objIndividualTotalSharedAmount = cmdQueryForIndividualTotalSharedAmount.ExecuteScalar();
                                        if (connRN5.State != ConnectionState.Closed) connRN5.Close();

                                        Decimal IndividualTotalSharedAmount = 0;
                                        if (objIndividualTotalSharedAmount.ToString() != String.Empty) IndividualTotalSharedAmount = Decimal.Parse(objIndividualTotalSharedAmount.ToString());


                                        String strSqlUpdateIndividualTotalSharedAmount = "update [dbo].[contact] set [dbo].[contact].[c4g_Total_Shared_Amount__c] = @IndividualTotalSharedAmount " +
                                                                                         "where ([dbo].[contact].[IsDeleted] = 0 or [dbo].[contact].[IsDeleted] IS NULL) and " +
                                                                                         "[dbo].[contact].[Individual_ID__c] = @IndividualId";

                                        SqlCommand cmdUpdateIndividualTotalSharedAmount = new SqlCommand(strSqlUpdateIndividualTotalSharedAmount, connSalesforce2);
                                        cmdUpdateIndividualTotalSharedAmount.CommandType = CommandType.Text;

                                        cmdUpdateIndividualTotalSharedAmount.Parameters.AddWithValue("@IndividualTotalSharedAmount", IndividualTotalSharedAmount);
                                        cmdUpdateIndividualTotalSharedAmount.Parameters.AddWithValue("@IndividualId", txtIndividualIDMedBill.Text.Trim());

                                        if (connSalesforce2.State == ConnectionState.Open)
                                        {
                                            connSalesforce2.Close();
                                            connSalesforce2.Open();
                                        }
                                        else if (connSalesforce2.State == ConnectionState.Closed) connSalesforce2.Open();

                                        int nIndividualUpdated = cmdUpdateIndividualTotalSharedAmount.ExecuteNonQuery();
                                        if (connSalesforce2.State == ConnectionState.Open) connSalesforce2.Close();

                                        if (nIndividualUpdated == 1) txtTotalSharedAmount.Text = IndividualTotalSharedAmount.ToString("C");

                                        if (nIndividualUpdated != 1)
                                        {
                                            MessageBox.Show("Individual Total Shared Amount has not been updated.", "Alert");
                                            return;
                                        }
                                    }
                                    else
                                    {
                                        MessageBox.Show("Illness total Shared Amount has not been updated.", "Alert");
                                        return;
                                    }
                                }
                                else
                                {
                                    MessageBox.Show("Incident Total Shared Amount has not been updated.", "Alert");
                                    return;
                                }
                            }
                        }

                        String strSqlQueryForTotalMedBillAmountForIndividualId = "select sum([dbo].[tbl_medbill].[BillAmount]) from [dbo].[tbl_medbill] " +
                                                                                    "where [dbo].[tbl_medbill].[Individual_Id] = @IndividualId and " +
                                                                                    "[dbo].[tbl_medbill].[IsDeleted] = 0";

                        SqlCommand cmdQueryForTotalMedBillAmountForIndividualId = new SqlCommand(strSqlQueryForTotalMedBillAmountForIndividualId, connRN5);
                        cmdQueryForTotalMedBillAmountForIndividualId.CommandType = CommandType.Text;

                        cmdQueryForTotalMedBillAmountForIndividualId.Parameters.AddWithValue("@IndividualId", txtIndividualIDMedBill.Text.Trim());

                        if (connRN5.State != ConnectionState.Closed)
                        {
                            connRN5.Close();
                            connRN5.Open();
                        }
                        else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                        Object objTotalMedBillAmountForIndividualId = cmdQueryForTotalMedBillAmountForIndividualId.ExecuteScalar();
                        if (connRN5.State != ConnectionState.Closed) connRN5.Close();

                        Decimal TotalMedBillAmountForIndividualId = 0;
                        if (objTotalMedBillAmountForIndividualId != null) TotalMedBillAmountForIndividualId = Decimal.Parse(objTotalMedBillAmountForIndividualId.ToString());

                        String strSqlUpdateIndividualTotalMedBillAmount = "update [dbo].[contact] set [dbo].[contact].[c4g_Incidents_Total_Amount__c] = @MedBillTotalForIndividual " +
                                                                            "where ([dbo].[contact].[IsDeleted] IS NULL or [dbo].[contact].[IsDeleted] = 0) and " +
                                                                            "[dbo].[contact].[Individual_ID__c] = @IndividualId";

                        SqlCommand cmdUpdateIndividualTotalMedBillAmount = new SqlCommand(strSqlUpdateIndividualTotalMedBillAmount, connSalesforce2);
                        cmdUpdateIndividualTotalMedBillAmount.CommandType = CommandType.Text;

                        cmdUpdateIndividualTotalMedBillAmount.Parameters.AddWithValue("@MedBillTotalForIndividual", TotalMedBillAmountForIndividualId);
                        cmdUpdateIndividualTotalMedBillAmount.Parameters.AddWithValue("@IndividualId", txtIndividualIDMedBill.Text.Trim());

                        if (connSalesforce2.State == ConnectionState.Open)
                        {
                            connSalesforce2.Close();
                            connSalesforce2.Open();
                        }
                        else if (connSalesforce2.State == ConnectionState.Closed) connSalesforce2.Open();

                        int nIndividualTotalMedBillUpdated = cmdUpdateIndividualTotalMedBillAmount.ExecuteNonQuery();
                        if (connSalesforce2.State == ConnectionState.Open) connSalesforce2.Close();

                        if (nIndividualTotalMedBillUpdated == 1) txtTotalMedBillAmount.Text = TotalMedBillAmountForIndividualId.ToString("C");

                        if (nIndividualTotalMedBillUpdated != 1)
                        {
                            MessageBox.Show("The individual Medical Bill Amount Total has not been updated.", "Error");
                            return;
                        }

                    }
                    else if (nRowInserted == 0)
                    {
                        MessageBox.Show("The Medical Bill has not been saved.", "Error");
                        return;
                    }

                    bIsModified = false;

                }
                else if (ResultMedBillNo.ToString() == strMedBillNo)
                {
                    String strIndividualId = String.Empty;
                    String strCaseId = String.Empty;
                    String strBillStatus = String.Empty;
                    String strIllnessId = String.Empty;
                    String strIncidentId = String.Empty;

                    String MedBillNo = txtMedBillNo.Text.Trim();
                    String IndividualId = txtIndividualIDMedBill.Text.Trim();
                    strIndividualId = IndividualId;

                    if (txtMedBill_Illness.Text.Trim() != String.Empty)
                    {
                        String IllnessNo = txtMedBill_Illness.Text.Trim();

                        String strSqlQueryForIllnessId = "select [dbo].[tbl_illness].[Illness_Id] from [dbo].[tbl_illness] where [dbo].[tbl_illness].[IllnessNo] = @IllnessNo";

                        SqlCommand cmdQueryForIllnessId = new SqlCommand(strSqlQueryForIllnessId, connRN5);
                        cmdQueryForIllnessId.CommandType = CommandType.Text;

                        cmdQueryForIllnessId.Parameters.AddWithValue("@IllnessNo", IllnessNo);

                        if (connRN5.State != ConnectionState.Closed)
                        {
                            connRN5.Close();
                            connRN5.Open();
                        }
                        else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                        Object objIllnessId = cmdQueryForIllnessId.ExecuteScalar();
                        if (connRN5.State != ConnectionState.Closed) connRN5.Close();

                        if (objIllnessId != null) strIllnessId = objIllnessId.ToString();
                        else
                        {
                            MessageBox.Show("No Illness Id for given Illness No", "Error");
                            return;
                        }
                    }

                    if (txtMedBill_Incident.Text.Trim() != String.Empty)
                    {
                        String IncidentNo = txtMedBill_Incident.Text.Trim();

                        String strSqlQueryForIncidentId = "select [dbo].[tbl_incident].[Incident_id] from [dbo].[tbl_incident] where [dbo].[tbl_incident].[IncidentNo] = @IncidentNo";

                        SqlCommand cmdQueryForIncidentId = new SqlCommand(strSqlQueryForIncidentId, connRN5);
                        cmdQueryForIncidentId.CommandType = CommandType.Text;

                        cmdQueryForIncidentId.Parameters.AddWithValue("@IncidentNo", IncidentNo);

                        if (connRN5.State != ConnectionState.Closed)
                        {
                            connRN5.Close();
                            connRN5.Open();
                        }
                        else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                        Object objIncidentId = cmdQueryForIncidentId.ExecuteScalar();
                        if (connRN5.State != ConnectionState.Closed) connRN5.Close();

                        if (objIncidentId != null) strIncidentId = objIncidentId.ToString();
                        else
                        {
                            MessageBox.Show("No Incident Id for given Incident No", "Error");
                            return;
                        }
                    }

                    // Get medical provider id
                    //String strSqlQueryForMedicalProviderId = "select [dbo].[tbl_MedicalProvider].[ID] from [dbo].[tbl_MedicalProvider] where [dbo].[tbl_MedicalProvider].[Name] = @MedicalProviderName";
                    String strSqlQueryForMedicalProviderId = "select [dbo].[account].[Id] from [dbo].[account] where [dbo].[account].[Name] = @MedicalProviderName";

                    SqlCommand cmdQueryForMedicalProviderId = new SqlCommand(strSqlQueryForMedicalProviderId, connSalesforce2);
                    cmdQueryForMedicalProviderId.CommandType = CommandType.Text;

                    cmdQueryForMedicalProviderId.Parameters.AddWithValue("@MedicalProviderName", txtMedicalProvider.Text.Trim());

                    if (connSalesforce2.State != ConnectionState.Closed)
                    {
                        connSalesforce2.Close();
                        connSalesforce2.Open();
                    }
                    else if (connSalesforce2.State == ConnectionState.Closed) connSalesforce2.Open();
                    Object objMedicalProviderId = cmdQueryForMedicalProviderId.ExecuteScalar();
                    if (connSalesforce2.State == ConnectionState.Open) connSalesforce2.Close();

                    String MedicalProviderId = String.Empty;
                    if (objMedicalProviderId != null) MedicalProviderId = objMedicalProviderId.ToString();
                    else
                    {
                        MessageBox.Show("No Medical Provider Id for Medical Provider name: " + txtMedicalProvider.Text.Trim(), "Error", MessageBoxButtons.OK);
                        return;
                    }

                    int nPatientType = 0;   // default outpatient

                    if (rbOutpatient.Checked) nPatientType = 0;
                    else if (rbInpatient.Checked) nPatientType = 1;

                    if (chkNPFMedBill.Checked && strNPFDestinationFilePathMedBill == String.Empty)
                    {
                        MessageBox.Show("No NPF Destination File Path specified.");
                        return;
                    }

                    if (chkIBMedBill.Checked && strIBDestinationFilePathMedBill == String.Empty)
                    {
                        MessageBox.Show("No IB Destination File Path specified.");
                        return;
                    }

                    if (chkPoPMedBill.Checked && strPoPDestinationFilePathMedBill == String.Empty)
                    {
                        MessageBox.Show("No PoP Destination File Path specified.");
                        return;
                    }

                    if (chkMedRecMedBill.Checked && strMedRecDestinationFilePathMedBill == String.Empty)
                    {
                        MessageBox.Show("No Med Rec Destination File Path specified.");
                        return;
                    }

                    if (chkOtherDocMedBill.Checked && strOtherDocDestinationFilePathMedBill == String.Empty)
                    {
                        MessageBox.Show("No Other Doc Destination File Path specified.");
                        return;
                    }


                    String strNote = String.Empty;

                    if (comboMedBillType.SelectedItem.ToString() == "Medical Bill")
                    {
                        strNote = txtMedBillNote.Text.Trim();
                    }
                    else if (comboMedBillType.SelectedItem.ToString() == "Prescription")
                    {
                        strNote = txtPrescriptionNote.Text.Trim();
                    }
                    else if (comboMedBillType.SelectedItem.ToString() == "Physical Therapy")
                    {
                        strNote = txtPhysicalTherapyRxNote.Text.Trim();
                    }

                    // Update the Medical Bill
                    String strSqlUpdateMedBill = "update [dbo].[tbl_medbill] " +
                                                 "set [dbo].[tbl_medbill].[LastModifiedDate] = @NewLastModifiedDate, " +
                                                 "[dbo].[tbl_medbill].[LastModifiedById] = @NewLastModifiedById, " +
                                                 "[dbo].[tbl_medbill].[Case_Id] = @NewCaseId, [dbo].[tbl_medbill].[Incident_Id] = @NewIncidentId, " +
                                                 "[dbo].[tbl_medbill].[Illness_Id] = @NewIllnessId, " +
                                                 "[dbo].[tbl_medbill].[NPF_Form] = @NewNPF_Form, " +
                                                 "[dbo].[tbl_medbill].[NPF_SourceFileName] = @NewNPF_SourceFileName, " +
                                                 "[dbo].[tbl_medbill].[NPF_DestinationFileName] = @NewNPF_DestinationFileName, " +
                                                 "[dbo].[tbl_medbill].[IB_Form] = @NewIB_Form, " +
                                                 "[dbo].[tbl_medbill].[IB_SourceFileName] = @NewIB_SourceFileName, " +
                                                 "[dbo].[tbl_medbill].[IB_DestinationFileName] = @NewIB_DestinationFileName, " +
                                                 "[dbo].[tbl_medbill].[POP_Form] = @NewPOP_Form, " +
                                                 "[dbo].[tbl_medbill].[POP_SourceFileName] = @NewPOP_SourceFileName, " +
                                                 "[dbo].[tbl_medbill].[POP_DestinationFileName] = @NewPOP_DestinationFileName, " +
                                                 "[dbo].[tbl_medbill].[MedRec_Form] = @NewMedRec_Form, " +
                                                 "[dbo].[tbl_medbill].[MedRec_SourceFileName] = @NewMedRec_SourceFileName, " +
                                                 "[dbo].[tbl_medbill].[MedRec_DestinationFileName] = @NewMedRec_DestinationFileName, " +
                                                 "[dbo].[tbl_medbill].[Unknown_Form] = @NewUnknown_Form, " +
                                                 "[dbo].[tbl_medbill].[Unknown_SourceFileName] = @NewUnknown_SourceFileName, " +
                                                 "[dbo].[tbl_medbill].[Unknown_DestinationFileName] = @NewUnknown_DestinationFileName, " +
                                                 "[dbo].[tbl_medbill].[BillAmount] = @NewBillAmount, [dbo].[tbl_medbill].[MedBillType_Id] = @NewMedBillType_Id, " +
                                                 "[dbo].[tbl_medbill].[BillStatus] = @NewMedBillStatus, " +
                                                 "[dbo].[tbl_medbill].[BillClosed] = @NewMedBillClosed, " +
                                                 "[dbo].[tbl_medbill].[SettlementTotal] = @NewSettlementTotal, [dbo].[tbl_medbill].[Balance] = @NewBalance, " +
                                                 "[dbo].[tbl_medbill].[BillDate] = @NewBillDate, [dbo].[tbl_medbill].[DueDate] = @NewDueDate, [dbo].[tbl_medbill].[TotalSharedAmount] = @NewTotalSharedAmount, " +
                                                 "[dbo].[tbl_medbill].[Guarantor] = @NewGuarantor, " +
                                                 "[dbo].[tbl_medbill].[MedicalProvider_Id] = @NewMedicalProviderId, " +
                                                 "[dbo].[tbl_medbill].[Account_At_Provider] = @NewAccountAtProvider, " +
                                                 "[dbo].[tbl_medbill].[ProviderPhoneNumber] = @NewProviderPhoneNo, " +
                                                 "[dbo].[tbl_medbill].[ProviderContactPerson] = @NewProviderContactPerson, " +
                                                 "[dbo].[tbl_medbill].[ProposalLetterSentDate] = @NewProposalLetterSentDate, " +
                                                 "[dbo].[tbl_medbill].[HIPPASentDate] = @NewHIPPASentDate, " +
                                                 "[dbo].[tbl_medbill].[MedicalRecordDate] = @NewMedicalRecordDate, " +
                                                 "[dbo].[tbl_medbill].[PrescriptionDrugName] = @NewPrescriptionDrugName, [dbo].[tbl_medbill].[PrescriptionNo] = @NewPrescriptionNo, " +
                                                 "[dbo].[tbl_medbill].[PrescriptionDescription] = @NewPrescriptionDescription, " +
                                                 "[dbo].[tbl_medbill].[TotalNumberOfPhysicalTherapy] = @NewTotalNumberOfPhysicalTherapy, " +
                                                 "[dbo].[tbl_medbill].[PatientTypeId] = @NewPatientTypeId, " +
                                                 "[dbo].[tbl_medbill].[Note] = @Note, " +
                                                 "[dbo].[tbl_medbill].[WellBeingCareTotal] = @NewWellBeingCareTotal, [dbo].[tbl_medbill].[WellBeingCare] = @NewWellBeingCare, " +
                                                 "[dbo].[tbl_medbill].[IneligibleReason] = @NewIneligibleReason, [dbo].[tbl_medbill].[PendingReason] = @NewPendingReason " +
                                                 "where [dbo].[tbl_medbill].[BillNo] = @MedBillNo and [dbo].[tbl_medbill].[Contact_Id] = @IndividualId";

                    SqlCommand cmdUpdateMedBill = new SqlCommand(strSqlUpdateMedBill, connRN7);
                    cmdUpdateMedBill.CommandType = CommandType.Text;

                    cmdUpdateMedBill.Parameters.AddWithValue("@NewLastModifiedDate", DateTime.Today.ToString("MM/dd/yyyy"));
                    cmdUpdateMedBill.Parameters.AddWithValue("@NewLastModifiedById", nLoggedUserId);
                    cmdUpdateMedBill.Parameters.AddWithValue("@NewCaseId", txtMedBill_CaseNo.Text.Trim());
                    cmdUpdateMedBill.Parameters.AddWithValue("@NewIncidentId", strIncidentId);
                    cmdUpdateMedBill.Parameters.AddWithValue("@NewIllnessId", strIllnessId);

                    // Documents for Medical Bill
                    cmdUpdateMedBill.Parameters.AddWithValue("@NewNPF_Form", chkNPFMedBill.Checked);
                    if (strNPFSourceFilePathMedBill != String.Empty) cmdUpdateMedBill.Parameters.AddWithValue("@NewNPF_SourceFileName", strNPFSourceFilePathMedBill);
                    else cmdUpdateMedBill.Parameters.AddWithValue("@NewNPF_SourceFileName", DBNull.Value);
                    if (strNPFDestinationFilePathMedBill != String.Empty) cmdUpdateMedBill.Parameters.AddWithValue("@NewNPF_DestinationFileName", strNPFDestinationFilePathMedBill);
                    else cmdUpdateMedBill.Parameters.AddWithValue("@NewNPF_DestinationFileName", DBNull.Value);
                    cmdUpdateMedBill.Parameters.AddWithValue("@NewIB_Form", chkIBMedBill.Checked);
                    if (strIBSourceFilePathMedBill != String.Empty) cmdUpdateMedBill.Parameters.AddWithValue("@NewIB_SourceFileName", strIBSourceFilePathMedBill);
                    else cmdUpdateMedBill.Parameters.AddWithValue("@NewIB_SourceFileName", DBNull.Value);
                    if (strIBDestinationFilePathMedBill != String.Empty) cmdUpdateMedBill.Parameters.AddWithValue("@NewIB_DestinationFileName", strIBDestinationFilePathMedBill);
                    else cmdUpdateMedBill.Parameters.AddWithValue("@NewIB_DestinationFileName", DBNull.Value);
                    cmdUpdateMedBill.Parameters.AddWithValue("@NewPOP_Form", chkPoPMedBill.Checked);
                    if (strPoPSourceFilePathMedBill != String.Empty) cmdUpdateMedBill.Parameters.AddWithValue("@NewPOP_SourceFileName", strPoPSourceFilePathMedBill);
                    else cmdUpdateMedBill.Parameters.AddWithValue("@NewPOP_SourceFileName", DBNull.Value);
                    if (strPoPDestinationFilePathMedBill != String.Empty) cmdUpdateMedBill.Parameters.AddWithValue("@NewPOP_DestinationFileName", strPoPDestinationFilePathMedBill);
                    else cmdUpdateMedBill.Parameters.AddWithValue("@NewPOP_DestinationFileName", DBNull.Value);
                    cmdUpdateMedBill.Parameters.AddWithValue("@NewMedRec_Form", chkMedRecMedBill.Checked);
                    if (strMedRecSourceFilePathMedBill != String.Empty) cmdUpdateMedBill.Parameters.AddWithValue("@NewMedRec_SourceFileName", strMedRecSourceFilePathMedBill);
                    else cmdUpdateMedBill.Parameters.AddWithValue("@NewMedRec_SourceFileName", DBNull.Value);
                    if (strMedRecDestinationFilePathMedBill != String.Empty) cmdUpdateMedBill.Parameters.AddWithValue("@NewMedRec_DestinationFileName", strMedRecDestinationFilePathMedBill);
                    else cmdUpdateMedBill.Parameters.AddWithValue("@NewMedRec_DestinationFileName", DBNull.Value);
                    cmdUpdateMedBill.Parameters.AddWithValue("@NewUnknown_Form", chkOtherDocMedBill.Checked);
                    if (strOtherDocSourceFilePathMedBill != String.Empty) cmdUpdateMedBill.Parameters.AddWithValue("@NewUnknown_SourceFileName", strOtherDocSourceFilePathMedBill);
                    else cmdUpdateMedBill.Parameters.AddWithValue("@NewUnknown_SourceFileName", DBNull.Value);
                    if (strOtherDocDestinationFilePathMedBill != String.Empty) cmdUpdateMedBill.Parameters.AddWithValue("@NewUnknown_DestinationFileName", strOtherDocDestinationFilePathMedBill);
                    else cmdUpdateMedBill.Parameters.AddWithValue("@NewUnknown_DestinationFileName", DBNull.Value);

                    Decimal BillAmount = 0;
                    Decimal BillAmountResult = 0;

                    if (Decimal.TryParse(txtMedBillAmount.Text.Trim(), NumberStyles.Currency, new CultureInfo("en-US"), out BillAmountResult))
                    {
                        BillAmount = BillAmountResult;
                        cmdUpdateMedBill.Parameters.AddWithValue("@NewBillAmount", BillAmount);
                    }
                    else
                    {
                        MessageBox.Show("Bill Amount is invalid.", "Error");
                        return;
                    }
                    cmdUpdateMedBill.Parameters.AddWithValue("@NewMedBillType_Id", comboMedBillType.SelectedIndex + 1);
                    cmdUpdateMedBill.Parameters.AddWithValue("@NewMedBillStatus", comboMedBillStatus.SelectedIndex);
                    if (cbMedBillClosed.SelectedIndex == 0) cmdUpdateMedBill.Parameters.AddWithValue("@NewMedBillClosed", 0);
                    else if (cbMedBillClosed.SelectedIndex == 1) cmdUpdateMedBill.Parameters.AddWithValue("@NewMedBillClosed", 1);

                    /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                    cmdUpdateMedBill.Parameters.AddWithValue("@NewSettlementTotal", 0);
                    /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////



                    Decimal BalanceResult = 0;
                    Decimal Balance = 0;

                    if (Decimal.TryParse(txtBalance.Text.Trim(), NumberStyles.Currency, new CultureInfo("en-US"), out BalanceResult))
                    {
                        Balance = BalanceResult;
                        cmdUpdateMedBill.Parameters.AddWithValue("@NewBalance", Balance);
                    }
                    else
                    {
                        MessageBox.Show("Balance is invalid.", "Error");
                        return;
                    }

                    //cmdUpdateMedBill.Parameters.AddWithValue("@NewBalance", 0);
                    /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

                    cmdUpdateMedBill.Parameters.AddWithValue("@NewBillDate", dtpBillDate.Value);
                    cmdUpdateMedBill.Parameters.AddWithValue("@NewDueDate", dtpDueDate.Value);
                    cmdUpdateMedBill.Parameters.AddWithValue("@NewTotalSharedAmount", 0);
                    cmdUpdateMedBill.Parameters.AddWithValue("@NewGuarantor", txtMedBillGuarantor.Text.Trim());
                    Boolean bMedicalProvider = false;
                    foreach (MedicalProviderInfo info in lstMedicalProvider)
                    {
                        if (info.Name.Trim() == txtMedicalProvider.Text.Trim())
                        {
                            cmdUpdateMedBill.Parameters.AddWithValue("@NewMedicalProviderId", info.ID);
                            bMedicalProvider = true;
                            break;
                        }
                    }
                    if (!bMedicalProvider)
                    {
                        MessageBox.Show("Medical Provider name is invalid.", "Error");
                        return;
                    }

                    cmdUpdateMedBill.Parameters.AddWithValue("@NewAccountAtProvider", txtMedBillAccountNoAtProvider.Text.Trim());
                    cmdUpdateMedBill.Parameters.AddWithValue("@NewProviderPhoneNo", txtMedProviderPhoneNo.Text.Trim());
                    cmdUpdateMedBill.Parameters.AddWithValue("@NewProviderContactPerson", txtProviderContactPerson.Text.Trim());
                    cmdUpdateMedBill.Parameters.AddWithValue("@NewProposalLetterSentDate", dtpProposalLetterSentDate.Value);
                    cmdUpdateMedBill.Parameters.AddWithValue("@NewHIPPASentDate", dtpHippaSentDate.Value);
                    cmdUpdateMedBill.Parameters.AddWithValue("@NewMedicalRecordDate", dtpMedicalRecordDate.Value);

                    if (comboMedBillType.SelectedIndex == 0 || comboMedBillType.SelectedIndex == 3)        // Medical Bill Type - Medical Bill
                    {
                        cmdUpdateMedBill.Parameters.AddWithValue("@NewPrescriptionDrugName", String.Empty);
                        cmdUpdateMedBill.Parameters.AddWithValue("@NewPrescriptionNo", String.Empty);
                        cmdUpdateMedBill.Parameters.AddWithValue("@NewPrescriptionDescription", String.Empty);

                        cmdUpdateMedBill.Parameters.AddWithValue("@NewTotalNumberOfPhysicalTherapy", DBNull.Value);

                        cmdUpdateMedBill.Parameters.AddWithValue("@NewPatientTypeId", nPatientType);
                        if (comboPendingReason.SelectedIndex == -1) cmdUpdateMedBill.Parameters.AddWithValue("@NewPendingReason", 0);
                        else cmdUpdateMedBill.Parameters.AddWithValue("@NewPendingReason", comboPendingReason.SelectedIndex);
                        if (comboIneligibleReason.SelectedIndex == -1) cmdUpdateMedBill.Parameters.AddWithValue("@NewIneligibleReason", 0);
                        else cmdUpdateMedBill.Parameters.AddWithValue("@NewIneligibleReason", comboIneligibleReason.SelectedIndex);

                        cmdUpdateMedBill.Parameters.AddWithValue("@Note", strNote);

                    }
                    else if (comboMedBillType.SelectedIndex == 1)        // Medical Bill Type - Prescription
                    {
                        cmdUpdateMedBill.Parameters.AddWithValue("@NewPatientTypeId", DBNull.Value);
                        //cmdUpdateMedBill.Parameters.AddWithValue("@NewPendingReason", 0);
                        //cmdUpdateMedBill.Parameters.AddWithValue("@NewIneligibleReason", 0);

                        if (comboPendingReason.SelectedIndex == -1) cmdUpdateMedBill.Parameters.AddWithValue("@NewPendingReason", 0);
                        else cmdUpdateMedBill.Parameters.AddWithValue("@NewPendingReason", comboPendingReason.SelectedIndex);
                        if (comboIneligibleReason.SelectedIndex == -1) cmdUpdateMedBill.Parameters.AddWithValue("@NewIneligibleReason", 0);
                        else cmdUpdateMedBill.Parameters.AddWithValue("@NewIneligibleReason", comboIneligibleReason.SelectedIndex);

                        cmdUpdateMedBill.Parameters.AddWithValue("@NewTotalNumberOfPhysicalTherapy", 0);

                        cmdUpdateMedBill.Parameters.AddWithValue("@NewPrescriptionDrugName", txtPrescriptionName.Text.Trim());
                        cmdUpdateMedBill.Parameters.AddWithValue("@NewPrescriptionNo", txtNumberOfMedication.Text.Trim());
                        cmdUpdateMedBill.Parameters.AddWithValue("@NewPrescriptionDescription", txtPrescriptionDescription.Text.Trim());

                        cmdUpdateMedBill.Parameters.AddWithValue("@Note", strNote);
                    }
                    else if (comboMedBillType.SelectedIndex == 2)        // Medical Bill Type - Physical Therapy
                    {
                        cmdUpdateMedBill.Parameters.AddWithValue("@NewPrescriptionDrugName", String.Empty);
                        cmdUpdateMedBill.Parameters.AddWithValue("@NewPrescriptionNo", String.Empty);
                        cmdUpdateMedBill.Parameters.AddWithValue("@NewPrescriptionDescription", String.Empty);

                        cmdUpdateMedBill.Parameters.AddWithValue("@NewPatientTypeId", DBNull.Value);
                        //cmdUpdateMedBill.Parameters.AddWithValue("@NewPendingReason", 0);
                        //cmdUpdateMedBill.Parameters.AddWithValue("@NewIneligibleReason", 0);

                        if (comboPendingReason.SelectedIndex == -1) cmdUpdateMedBill.Parameters.AddWithValue("@NewPendingReason", 0);
                        else cmdUpdateMedBill.Parameters.AddWithValue("@NewPendingReason", comboPendingReason.SelectedIndex);
                        if (comboIneligibleReason.SelectedIndex == -1) cmdUpdateMedBill.Parameters.AddWithValue("@NewIneligibleReason", 0);
                        else cmdUpdateMedBill.Parameters.AddWithValue("@NewIneligibleReason", comboIneligibleReason.SelectedIndex);

                        int nNumberOfPhysicalTherapy = 0;
                        short NumPhysicalTherapyResult = 0;
                        if (Int16.TryParse(txtNumPhysicalTherapy.Text.Trim(), out NumPhysicalTherapyResult))
                        {
                            nNumberOfPhysicalTherapy = NumPhysicalTherapyResult;
                            cmdUpdateMedBill.Parameters.AddWithValue("@NewTotalNumberOfPhysicalTherapy", nNumberOfPhysicalTherapy);
                        }
                        else
                        {
                            MessageBox.Show("Please enter a positive integer in Number of Physical Therapy Text Box.", "Error");
                            return;
                        }

                        cmdUpdateMedBill.Parameters.AddWithValue("@Note", strNote);
                    }
                    else if (comboMedBillType.SelectedIndex == 3)        // Medicabl Bill Type - Medical Record
                    {

                    }


                    cmdUpdateMedBill.Parameters.AddWithValue("@NewWellBeingCareTotal", 0);
                    cmdUpdateMedBill.Parameters.AddWithValue("@NewWellBeingCare", 0);
                    cmdUpdateMedBill.Parameters.AddWithValue("@MedBillNo", MedBillNo);
                    cmdUpdateMedBill.Parameters.AddWithValue("@IndividualId", IndividualId);

                    if (connRN7.State != ConnectionState.Closed)
                    {
                        connRN7.Close();
                        connRN7.Open();
                    }
                    else if (connRN7.State == ConnectionState.Closed) connRN7.Open();
                    int nAffectedRow = cmdUpdateMedBill.ExecuteNonQuery();
                    if (connRN7.State != ConnectionState.Closed) connRN7.Close();

                    if (nAffectedRow == 1)
                    {
                        // Delete MedBill in use
                        String MedBillInUse = txtMedBillNo.Text.Trim();
                        String strSqlDeleteMedBillInUse = "delete from [dbo].[tbl_MedBillInUse] " +
                                                          "where [dbo].[tbl_MedBillInUse].[BillNo] = @BillNo and [dbo].[tbl_MedBillInUse].[EditingStaff] = @ModifyingStaff";

                        //MedBillNo
                        SqlCommand cmdDeleteMedBillInUse = new SqlCommand(strSqlDeleteMedBillInUse, connRN7);
                        cmdDeleteMedBillInUse.CommandType = CommandType.Text;

                        cmdDeleteMedBillInUse.Parameters.AddWithValue("@BillNo", MedBillInUse);
                        cmdDeleteMedBillInUse.Parameters.AddWithValue("@ModifyingStaff", nLoggedUserId);

                        if (connRN7.State != ConnectionState.Closed)
                        {
                            connRN7.Close();
                            connRN7.Open();
                        }
                        else if (connRN7.State == ConnectionState.Closed) connRN7.Open();
                        int nMedBillInUseDeleted = cmdDeleteMedBillInUse.ExecuteNonQuery();
                        //if (nMedBillInUseDeleted == 0)
                        //{
                        //    MessageBox.Show("Medical Bill in use: " + MedBillInUse + " has not been deleted from tbl_MedBillInUse.", "Error");
                        //}
                        if (connRN7.State != ConnectionState.Closed) connRN7.Close();

                        // handle Well Being Care case
                        String strNewMedBillNo = String.Empty;

                        if (txtMedBillNo.Text.Trim() != String.Empty) strNewMedBillNo = txtMedBillNo.Text.Trim();

                        //Boolean bWellBeingCare = true;
                        //Boolean bWellBeingCareEligible = true;

                        //String strSqlQueryForICD10CodeForWellBeingCare = "select [dbo].[tbl_medbill].[BillNo], [dbo].[tbl_illness].[ICD_10_Id] from [dbo].[tbl_medbill] " +
                        //                                                 "inner join [dbo].[tbl_illness] on [dbo].[tbl_medbill].[Illness_Id] = [dbo].[tbl_illness].[Illness_Id] " +
                        //                                                 "where [dbo].[tbl_medbill].[BillNo] = @MedBillNo and " +
                        //                                                 "[dbo].[tbl_medbill].[Individual_Id] = @IndividualId";

                        //SqlCommand cmdQueryForICD10CodeForWellBeingCare = new SqlCommand(strSqlQueryForICD10CodeForWellBeingCare, connRN7);
                        //cmdQueryForICD10CodeForWellBeingCare.CommandType = CommandType.Text;

                        //cmdQueryForICD10CodeForWellBeingCare.Parameters.AddWithValue("@MedBillNo", strNewMedBillNo);
                        //cmdQueryForICD10CodeForWellBeingCare.Parameters.AddWithValue("@IndividualId", strIndividualId);

                        //String ICD10Code = String.Empty;

                        //if (connRN7.State != ConnectionState.Closed)
                        //{
                        //    connRN7.Close();
                        //    connRN7.Open();
                        //}
                        //else if (connRN7.State == ConnectionState.Closed) connRN7.Open();

                        //SqlDataReader rdrICD10CodeForWellBeingCare = cmdQueryForICD10CodeForWellBeingCare.ExecuteReader();
                        //if (rdrICD10CodeForWellBeingCare.HasRows)
                        //{
                        //    rdrICD10CodeForWellBeingCare.Read();
                        //    if (!rdrICD10CodeForWellBeingCare.IsDBNull(1)) ICD10Code = rdrICD10CodeForWellBeingCare.GetString(1);
                        //}
                        //rdrICD10CodeForWellBeingCare.Close();
                        //if (connRN7.State == ConnectionState.Open) connRN7.Close();

                        //if (ICD10Code != "Z00.00" && ICD10Code != "Z00.012") bWellBeingCare = false;

                        //if (ICD10Code == "Z00.00" || ICD10Code == "Z00.012")
                        //{

                        //    String strSqlQueryForProgramForIndividual = "select [dbo].[contact].[Individual_ID__c], [dbo].[program].[Name] from [dbo].[contact] " +
                        //                                                "inner join [dbo].[program] on [dbo].[contact].[c4g_Plan__c] = [dbo].[program].[ID] " +
                        //                                                "where [dbo].[contact].[Individual_ID__c] = @IndividualId";

                        //    SqlCommand cmdQueryForProgramForIndividual = new SqlCommand(strSqlQueryForProgramForIndividual, connSalesforce2);
                        //    cmdQueryForProgramForIndividual.CommandType = CommandType.Text;

                        //    cmdQueryForProgramForIndividual.Parameters.AddWithValue("@IndividualId", strIndividualId);

                        //    if (connSalesforce2.State != ConnectionState.Closed)
                        //    {
                        //        connSalesforce2.Close();
                        //        connSalesforce2.Open();
                        //    }
                        //    else if (connSalesforce2.State == ConnectionState.Closed) connSalesforce2.Open();

                        //    String ProgramName = String.Empty;

                        //    SqlDataReader rdrProgramForIndividual = cmdQueryForProgramForIndividual.ExecuteReader();
                        //    if (rdrProgramForIndividual.HasRows)
                        //    {
                        //        rdrProgramForIndividual.Read();
                        //        if (!rdrProgramForIndividual.IsDBNull(1)) ProgramName = rdrProgramForIndividual.GetString(1);
                        //    }
                        //    rdrProgramForIndividual.Close();
                        //    if (connSalesforce2.State == ConnectionState.Open) connSalesforce2.Close();

                        //    if (ProgramName == "Gold Plus" || ProgramName == "Gold Medi-I" || ProgramName == "Gold Medi-II")
                        //    {
                        //        String strSqlQueryForIndividualStartDate = "select [dbo].[contact].[Membership_IND_Start_date__c] from [dbo].[contact] " +
                        //                                                   "where [dbo].[contact].[Individual_ID__c] = @IndividualId";

                        //        SqlCommand cmdQueryForIndividualStartDate = new SqlCommand(strSqlQueryForIndividualStartDate, connSalesforce2);
                        //        cmdQueryForIndividualStartDate.CommandType = CommandType.Text;

                        //        cmdQueryForIndividualStartDate.Parameters.AddWithValue("@IndividualId", strIndividualId);

                        //        if (connSalesforce2.State != ConnectionState.Closed)
                        //        {
                        //            connSalesforce2.Close();
                        //            connSalesforce2.Open();
                        //        }
                        //        else if (connSalesforce2.State == ConnectionState.Closed) connSalesforce2.Open();

                        //        Object objMembershipIndStartDate = cmdQueryForIndividualStartDate.ExecuteScalar();

                        //        if (connSalesforce2.State == ConnectionState.Open) connSalesforce2.Close();

                        //        DateTime MembershipIndStartDate = new DateTime();
                        //        if (objMembershipIndStartDate != null)
                        //        {
                        //            MembershipIndStartDate = DateTime.Parse(objMembershipIndStartDate.ToString());
                        //        }

                        //        if (dtpBillDate.Value > MembershipIndStartDate.AddMonths(6))
                        //        {

                        //            // this query has to be modified - no Aniv_Date on [dbo].[contact] table
                        //            //String strSqlQueryForAnivDateForIndividualId = "select [dbo].[contact].[Aniv_Date], [dbo].[contact].[Membership_IND_Start_date__c] from [dbo].[contact] " +
                        //            //                                               "where [dbo].[contact].[Individual_ID__c] = @IndividualId";

                        //            //SqlCommand cmdQueryForAnivDateForIndividualId = new SqlCommand(strSqlQueryForAnivDateForIndividualId, connRN5);

                        //            //cmdQueryForAnivDateForIndividualId.CommandType = CommandType.Text;

                        //            //cmdQueryForAnivDateForIndividualId.Parameters.AddWithValue("@IndividualId", strIncidentId);


                        //            //if (connSalesforce.State != ConnectionState.Closed)
                        //            //{
                        //            //    connSalesforce.Close();
                        //            //    connSalesforce.Open();
                        //            //}
                        //            //else if (connSalesforce.State == ConnectionState.Closed) connSalesforce.Open();

                        //            //DateTime? AnivDate = null;
                        //            //DateTime? StartDate = null;

                        //            //SqlDataReader rdrAnivDate = cmdQueryForAnivDateForIndividualId.ExecuteReader();
                        //            //if (rdrAnivDate.HasRows)
                        //            //{
                        //            //    rdrAnivDate.Read();
                        //            //    if (!rdrAnivDate.IsDBNull(0)) AnivDate = rdrAnivDate.GetDateTime(0);
                        //            //    if (!rdrAnivDate.IsDBNull(1)) StartDate = rdrAnivDate.GetDateTime(1);
                        //            //}
                        //            //rdrAnivDate.Close();
                        //            //if (connSalesforce.State == ConnectionState.Open) connSalesforce.Close();

                        //            DateTime IndividualAnivDate = DateTime.Parse(txtAnivDate.Text);
                        //            //if (AnivDate != null) IndividualAnivDate = AnivDate.Value;
                        //            //else IndividualAnivDate = StartDate.Value;



                        //            int nAnivYear = dtpBillDate.Value.Year;

                        //            DateTime IndividualThisAnivDate = new DateTime(nAnivYear, IndividualAnivDate.Month, 1);
                        //            DateTime IndividualLastAnivDate = new DateTime(nAnivYear - 1, IndividualAnivDate.Month, 1);

                        //            String strSqlQueryForWellBeingIncidentsPerAnivYear = "select count([dbo].[tbl_incident].[IncidentNo]) from [dbo].[tbl_incident] " +
                        //                                                                 "inner join [dbo].[tbl_illness] on [dbo].[tbl_incident].[Illness_id] = [dbo].[tbl_illness].[Illness_Id] " +
                        //                                                                 "inner join [dbo].[tbl_medbill] on [dbo].[tbl_incident].[Incident_id] = [dbo].[tbl_medbill].[Incident_Id] " +
                        //                                                                 "where [dbo].[tbl_medbill].[Individual_Id] = @IndividualId and " +
                        //                                                                 "([dbo].[tbl_illness].[ICD_10_Id] = 'Z00.00' or [dbo].[tbl_illness].[ICD_10_Id] = 'Z00.012') and " +
                        //                                                                 "[dbo].[tbl_medbill].[BillDate] >= @LastAnivDate and " +
                        //                                                                 "[dbo].[tbl_medbill].[BillDate] < @ThisAnivDate";

                        //            SqlCommand cmdQueryForWellBeingIncidentsPerAnivYear = new SqlCommand(strSqlQueryForWellBeingIncidentsPerAnivYear, connRN7);
                        //            cmdQueryForWellBeingIncidentsPerAnivYear.CommandType = CommandType.Text;

                        //            cmdQueryForWellBeingIncidentsPerAnivYear.Parameters.AddWithValue("@IndividualId", strIndividualId);
                        //            cmdQueryForWellBeingIncidentsPerAnivYear.Parameters.AddWithValue("@LastAnivDate", IndividualLastAnivDate);
                        //            cmdQueryForWellBeingIncidentsPerAnivYear.Parameters.AddWithValue("@ThisAnivDate", IndividualThisAnivDate);

                        //            if (connRN7.State != ConnectionState.Closed)
                        //            {
                        //                connRN7.Close();
                        //                connRN7.Open();
                        //            }
                        //            else if (connRN7.State == ConnectionState.Closed) connRN7.Open();
                        //            Object objIncidentCount = cmdQueryForWellBeingIncidentsPerAnivYear.ExecuteScalar();
                        //            if (connRN7.State == ConnectionState.Open) connRN7.Close();

                        //            int nIncidentCount = Int32.Parse(objIncidentCount.ToString());

                        //            if (nIncidentCount == 1)
                        //            {
                        //                String strSqlQueryForWellBeingIncidentId = "select [dbo].[tbl_incident].[Incident_id] from [dbo].[tbl_incident] " +
                        //                                                           "inner join [dbo].[tbl_illness] on [dbo].[tbl_incident].[Illness_id] = [dbo].[tbl_illness].[Illness_Id] " +
                        //                                                           "inner join [dbo].[tbl_medbill] on [dbo].[tbl_incident].[Incident_id] = [dbo].[tbl_medbill].[Incident_Id] " +
                        //                                                           "where [dbo].[tbl_medbill].[Individual_Id] = @IndividualId and " +
                        //                                                           "([dbo].[tbl_illness].[ICD_10_Id] = 'Z00.00' or [dbo].[tbl_illness].[ICD_10_Id] = 'Z00.012') and " +
                        //                                                           "[dbo].[tbl_medbill].[BillDate] >= @LastAnivDate and " +
                        //                                                           "[dbo].[tbl_medbill].[BillDate] < @ThisAnivDate";

                        //                SqlCommand cmdQueryForWellBeingIncidentId = new SqlCommand(strSqlQueryForWellBeingIncidentId, connRN7);
                        //                cmdQueryForWellBeingIncidentId.CommandType = CommandType.Text;

                        //                cmdQueryForWellBeingIncidentId.Parameters.AddWithValue("@IndividualId", strIndividualId);
                        //                cmdQueryForWellBeingIncidentId.Parameters.AddWithValue("@LastAnivDate", IndividualLastAnivDate);
                        //                cmdQueryForWellBeingIncidentId.Parameters.AddWithValue("@ThisAnivDate", IndividualThisAnivDate);

                        //                if (connRN7.State != ConnectionState.Closed)
                        //                {
                        //                    connRN7.Close();
                        //                    connRN7.Open();
                        //                }
                        //                else if (connRN7.State == ConnectionState.Closed) connRN7.Open();

                        //                Object objWellBeingIncidentId = cmdQueryForWellBeingIncidentId.ExecuteScalar();
                        //                if (connRN7.State == ConnectionState.Open) connRN7.Close();

                        //                if (objWellBeingIncidentId != null)
                        //                {
                        //                    int nWellBeingIncidentId = Int32.Parse(objWellBeingIncidentId.ToString());

                        //                    String strSqlQueryForWellBeingTotalForIncident = "select sum([dbo].[tbl_medbill].[TotalSharedAmount]) from [dbo].[tbl_medbill] " +
                        //                                                                     "where [dbo].[tbl_medbill].[Incident_Id] = @IncidentId";

                        //                    SqlCommand cmdQueryForWellBeingTotalForIncident = new SqlCommand(strSqlQueryForWellBeingTotalForIncident, connRN7);
                        //                    cmdQueryForWellBeingTotalForIncident.CommandType = CommandType.Text;

                        //                    cmdQueryForWellBeingTotalForIncident.Parameters.AddWithValue("@IncidentId", nWellBeingIncidentId);

                        //                    if (connRN7.State != ConnectionState.Closed)
                        //                    {
                        //                        connRN7.Close();
                        //                        connRN7.Open();
                        //                    }
                        //                    else if (connRN7.State == ConnectionState.Closed) connRN7.Open();

                        //                    Object objWellBeingTotalForIncident = cmdQueryForWellBeingTotalForIncident.ExecuteScalar();
                        //                    if (connRN7.State == ConnectionState.Open) connRN7.Close();

                        //                    Decimal WellBeingTotalForIncident = Decimal.Parse(objWellBeingTotalForIncident.ToString());

                        //                    if (WellBeingTotalForIncident > 500)
                        //                    {
                        //                        // Set the well being care med bill ineligible strNewMedBillNo
                        //                        String strSqlUpdateMedBillWellBeingCareIneligible = "update [dbo].[tbl_medbill] set [dbo].[medbill].[BillStatus] = 3, " +
                        //                                                                            "[dbo].[tbl_medbill].[WellBeingCare] = 0 " +
                        //                                                                            "where [dbo].[tbl_medbill].[BillNo] = @WellBeingCareMedBill";

                        //                        SqlCommand cmdUpdateMedBillWellBeingCareIneligible = new SqlCommand(strSqlUpdateMedBillWellBeingCareIneligible, connRN7);
                        //                        cmdUpdateMedBillWellBeingCareIneligible.CommandType = CommandType.Text;

                        //                        cmdUpdateMedBillWellBeingCareIneligible.Parameters.AddWithValue("@WellBeingCareMedBill", strNewMedBillNo);

                        //                        if (connRN7.State != ConnectionState.Closed)
                        //                        {
                        //                            connRN7.Close();
                        //                            connRN7.Open();
                        //                        }
                        //                        else if (connRN7.State == ConnectionState.Closed) connRN7.Open();

                        //                        int nWellBeingMedBillUpdated = cmdUpdateMedBillWellBeingCareIneligible.ExecuteNonQuery();

                        //                        if (connRN7.State == ConnectionState.Open) connRN7.Close();

                        //                        if (nWellBeingMedBillUpdated == 0)
                        //                        {
                        //                            MessageBox.Show("The well being med bill is not updated.", "Error");
                        //                            return;
                        //                        }
                        //                    }
                        //                    else
                        //                    {
                        //                        // set the well being care med bill eligible
                        //                        String strSqlUpdateMedBillWellBeingCareEligible = "update [dbo].[tbl_medbill] set [dbo].[tbl_medbill].[BillStatus] = 2, " +
                        //                                                                          "[dbo].[tbl_medbill].[WellBeingCare] = 1 " +
                        //                                                                          "where [dbo].[tbl_medbill].[BillNo] = @WellBeingCareMedBill";

                        //                        SqlCommand cmdUpdateMedBillWellBeingCareEligible = new SqlCommand(strSqlUpdateMedBillWellBeingCareEligible, connRN7);
                        //                        cmdUpdateMedBillWellBeingCareEligible.CommandType = CommandType.Text;

                        //                        cmdUpdateMedBillWellBeingCareEligible.Parameters.AddWithValue("@WellBeingCareMedBill", strNewMedBillNo);

                        //                        if (connRN7.State != ConnectionState.Closed)
                        //                        {
                        //                            connRN7.Close();
                        //                            connRN7.Open();
                        //                        }
                        //                        else if (connRN7.State == ConnectionState.Closed) connRN7.Open();

                        //                        int nWellBeingMedBillUpdated = cmdUpdateMedBillWellBeingCareEligible.ExecuteNonQuery();

                        //                        if (connRN7.State == ConnectionState.Open) connRN7.Close();

                        //                        if (nWellBeingMedBillUpdated == 0)
                        //                        {
                        //                            MessageBox.Show("The well being med bill is not updated.", "Error");
                        //                            return;
                        //                        }
                        //                    }
                        //                }
                        //            }
                        //            else if (nIncidentCount > 1)
                        //            {
                        //                // Ineligible for Well Being Care
                        //                String strSqlUpdateMedBillWellBeingCareIneligible = "update [dbo].[tbl_medbill] set [dbo].[tbl_medbill].[BillStatus] = 3, " +
                        //                                                                    "[dbo].[tbl_medbill].[WellBeingCare] = 0 " +
                        //                                                                    "where [dbo].[tbl_medbill].[BillNo] = @WellBeingCareMedBill";

                        //                SqlCommand cmdUpdateMedBillWellBeingCareIneligible = new SqlCommand(strSqlUpdateMedBillWellBeingCareIneligible, connRN7);
                        //                cmdUpdateMedBillWellBeingCareIneligible.CommandType = CommandType.Text;

                        //                cmdUpdateMedBillWellBeingCareIneligible.Parameters.AddWithValue("@WellBeingCareMedBill", strNewMedBillNo);

                        //                if (connRN7.State != ConnectionState.Closed)
                        //                {
                        //                    connRN7.Close();
                        //                    connRN7.Open();
                        //                }
                        //                else if (connRN7.State == ConnectionState.Closed) connRN7.Open();

                        //                int nWellBeingMedBillUpdated = cmdUpdateMedBillWellBeingCareIneligible.ExecuteNonQuery();
                        //                if (connRN7.State == ConnectionState.Open) connRN7.Close();

                        //                if (nWellBeingMedBillUpdated == 0)
                        //                {
                        //                    MessageBox.Show("The well being med bill is not updated.", "Error");
                        //                    return;
                        //                }
                        //            }
                        //        }
                        //    }
                        //}

                        ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                        if (gvSettlementsInMedBill.Rows.Count > 0)
                        {
                            for (int i = 0; i < gvSettlementsInMedBill.Rows.Count; i++)
                            {
                                if (gvSettlementsInMedBill["SettlementTypeValue", i]?.Value == null)
                                {
                                    MessageBox.Show("You have to select a Settlement Type.", "Alert");
                                    return;
                                }

                                Decimal result, SettlementAmount;
                                if (Decimal.TryParse(gvSettlementsInMedBill["SettlementAmount", i]?.Value?.ToString(), NumberStyles.Currency, new CultureInfo("en-US"), out result)) SettlementAmount = result;
                                else
                                {
                                    MessageBox.Show("You have to enter decimal value in Settlement Amount field in Settlement " + gvSettlementsInMedBill[1, i]?.Value?.ToString(), "Alert");
                                    return;
                                }

                                result = 0;
                                Decimal PersonalResponsibilityAmount = 0;

                                if ((gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "Self Pay Discount") ||
                                    (gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "3rd Party Discount") ||
                                    (gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "Member Payment"))
                                {
                                    if (gvSettlementsInMedBill["PersonalResponsibility", i]?.Value != null)
                                    {
                                        if (Decimal.TryParse(gvSettlementsInMedBill["PersonalResponsibility", i]?.Value?.ToString(), NumberStyles.Currency, new CultureInfo("en-US"), out result)) PersonalResponsibilityAmount = result;
                                        else
                                        {
                                            MessageBox.Show("Invalid Personal Responsibility.", "Error");
                                            return;
                                        }
                                    }
                                }

                                result = 0;
                                Decimal AllowedAmount = 0;
                                if (gvSettlementsInMedBill["AllowedAmount", i]?.Value?.ToString() != null)
                                {
                                    if (Decimal.TryParse(gvSettlementsInMedBill["AllowedAmount", i]?.Value?.ToString(), NumberStyles.Currency, new CultureInfo("en-US"), out result)) AllowedAmount = result;
                                    else
                                    {
                                        MessageBox.Show("You have to enter decimal value in Allowed Amount field in Settlement " + gvSettlementsInMedBill[1, i]?.Value?.ToString(), "Alert");
                                        return;
                                    }
                                }
                            }

                            ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

                            Decimal MedBillAmount = Decimal.Parse(txtMedBillAmount.Text.Trim(), NumberStyles.Currency, new CultureInfo("en-US"));
                            Decimal SettlementAmountTotal = 0;

                            for (int i = 0; i < gvSettlementsInMedBill.Rows.Count; i++)
                            {
                                Decimal result = 0;
                                Decimal SettlementAmount = 0;
                                if (gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "Self Pay Discount" ||
                                    gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "3rd Party Discount" ||
                                    gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "Member Payment" ||
                                    gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "CMM Provider Payment" ||
                                    gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "CMM Discount" ||
                                    gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "CMM Member Reimbursement" ||
                                    gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "Ineligible")
                                {
                                    if (Decimal.TryParse(gvSettlementsInMedBill["SettlementAmount", i]?.Value?.ToString(), NumberStyles.Currency, new CultureInfo("en-US"), out result))
                                    {
                                        SettlementAmount = result;
                                        SettlementAmountTotal += SettlementAmount;
                                        if (SettlementAmountTotal > MedBillAmount)
                                        {
                                            MessageBox.Show("The total of settlement amount exceeds medical bill amount.");
                                            return;
                                        }
                                    }
                                }
                            }

                            /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                            Boolean bError = false;

                            String strSqlQueryForSettlementType = "select [dbo].[tbl_settlement_type_code].[SettlementTypeCode], [dbo].[tbl_settlement_type_code].[SettlementTypeValue] " +
                                        "from [dbo].[tbl_settlement_type_code]";

                            SqlCommand cmdQueryForSettlementType = new SqlCommand(strSqlQueryForSettlementType, connRN5);
                            cmdQueryForSettlementType.CommandType = CommandType.Text;

                            if (connRN5.State != ConnectionState.Closed)
                            {
                                connRN5.Close();
                                connRN5.Open();
                            }
                            else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                            SqlDataReader rdrSettlementType = cmdQueryForSettlementType.ExecuteReader();
                            lstSettlementType.Clear();
                            if (rdrSettlementType.HasRows)
                            {
                                while (rdrSettlementType.Read())
                                {
                                    if (rdrSettlementType.GetInt16(0) > 0)
                                        lstSettlementType.Add(new SettlementTypeInfo { SettlementTypeCode = rdrSettlementType.GetInt16(0), SettlementTypeValue = rdrSettlementType.GetString(1) });
                                }
                            }
                            rdrSettlementType.Close();
                            if (connRN5.State != ConnectionState.Closed) connRN5.Close();

                            for (int i = 0; i < gvSettlementsInMedBill.Rows.Count; i++)
                            {
                                String SettlementName = gvSettlementsInMedBill["SettlementName", i].Value.ToString();

                                // Check whether or not the settlement is already in data base
                                String strSqlQueryForSettlementName = "select [dbo].[tbl_settlement].[Name] from [dbo].[tbl_settlement] where [dbo].[tbl_settlement].[Name] = @Settlement";

                                SqlCommand cmdQueryForSettlementName = new SqlCommand(strSqlQueryForSettlementName, connRN5);
                                cmdQueryForSettlementName.CommandType = CommandType.Text;

                                cmdQueryForSettlementName.Parameters.AddWithValue("@Settlement", SettlementName);

                                if (connRN5.State != ConnectionState.Closed)
                                {
                                    connRN5.Close();
                                    connRN5.Open();
                                }
                                else if (connRN5.State == ConnectionState.Closed) connRN5.Open();

                                Object objResultSettlementName = cmdQueryForSettlementName.ExecuteScalar();
                                if (connRN5.State != ConnectionState.Closed) connRN5.Close();

                                if (objResultSettlementName == null)   // new settlement: save the settlement by using insert sql statement
                                {

                                    String strSqlCreateNewSettlement = "insert into [dbo].[tbl_settlement] (IsDeleted, Name, CreateDate, CreateByID, LastModifiedDate, LastModifiedByID, SystemModifiedStamp, " +
                                                                        "LastActivityDate, LastViewedDate, MedicalBillID, " +
                                                                        "SettlementType, Amount, PersonalResponsibilityCredit, CMMPaymentMethod, " +
                                                                        "CheckNo, CheckDate, CheckReconciled, ACH_Number, ACH_Date, ACH_Reconciled, CMMCreditCard, CMMCreditCardPaidDate, CC_Reconciled, " +
                                                                        "AllowedAmount, Notes, Approved, ApprovedDate, IneligibleReason) " +
                                                                        "values (0, @SettlementName, @CreateDate, @CreateByID, @LastModifiedDate, @LastModifiedByID, @SystemModifiedStamp, " +
                                                                        "@LastActivityDate, @LastViewedDate, @MedBillID, " +
                                                                        "@SettlementType, @SettlementAmount, @PersonalResponsibilityCredit, @CMMPaymentMethod, " +
                                                                        "@CheckNo, @CheckDate, @IsCheckReconciled, @ACH_Number, @ACH_Date, @IsACH_Reconciled, @CMMCreditCard, @CMMCreditCardPaidDate, @IsCC_Reconciled, " +
                                                                        "@AllowedAmount, @Notes, @IsApproved, @ApprovedDate, @IneligibleReason)";

                                    SqlCommand cmdInsertNewSettlement = new SqlCommand(strSqlCreateNewSettlement, connRN5);
                                    cmdInsertNewSettlement.CommandType = CommandType.Text;

                                    String NewSettlementName = gvSettlementsInMedBill["SettlementName", i].Value.ToString();
                                    String NewSettlementType = String.Empty;
                                    if (gvSettlementsInMedBill["SettlementTypeValue", i].Value != null) NewSettlementType = gvSettlementsInMedBill["SettlementTypeValue", i].Value.ToString();
                                    int nNewSettlementType = 0;
                                    for (int j = 0; j < lstSettlementType.Count; j++)
                                    {
                                        if (NewSettlementType == lstSettlementType[j].SettlementTypeValue) nNewSettlementType = lstSettlementType[j].SettlementTypeCode;
                                    }
                                    Decimal result = 0;
                                    Decimal SettlementAmount = 0;
                                    if (Decimal.TryParse(gvSettlementsInMedBill["SettlementAmount", i]?.Value?.ToString(), NumberStyles.Currency, new CultureInfo("en-US"), out result))
                                    {
                                        SettlementAmount = result;
                                        cmdInsertNewSettlement.Parameters.AddWithValue("@SettlementAmount", SettlementAmount);
                                    }

                                    result = 0;
                                    Decimal PersonalResponsibilityAmount = 0;
                                    if (Decimal.TryParse(gvSettlementsInMedBill["PersonalResponsibility", i]?.Value?.ToString(), NumberStyles.Currency, new CultureInfo("en-US"), out result)) PersonalResponsibilityAmount = result;
                                    cmdInsertNewSettlement.Parameters.AddWithValue("@PersonalResponsibilityCredit", PersonalResponsibilityAmount);

                                    int NewIsApproved = 0;
                                    if (gvSettlementsInMedBill["Approved", i]?.Value != null)
                                    {
                                        if ((Boolean)gvSettlementsInMedBill["Approved", i]?.Value == true) NewIsApproved = 1;
                                    }
                                    DateTime? NewApprovedDate = null;
                                    //if (gvSettlementsInMedBill["ApprovedDate", i]?.Value != null) NewApprovedDate = DateTime.Parse(gvSettlementsInMedBill["ApprovedDate", i].Value.ToString());
                                    if (gvSettlementsInMedBill["ApprovedDate", i]?.Value != null)
                                    {
                                        DateTime resultApprovedDate;
                                        if (DateTime.TryParse(gvSettlementsInMedBill["ApprovedDate", i]?.Value?.ToString(), out resultApprovedDate))
                                            NewApprovedDate = resultApprovedDate;

                                        //NewApprovedDate = DateTime.Parse(gvSettlementsInMedBill["ApprovedDate", i].Value.ToString());
                                    }
                                    //else if (gvSettlementsInMedBill["ApprovedDate", i]?.Value?.ToString() != String.Empty) 

                                    String NewCMMPaymentMethod = String.Empty;
                                    if (gvSettlementsInMedBill["PaymentMethod", i]?.Value != null) NewCMMPaymentMethod = gvSettlementsInMedBill["PaymentMethod", i].Value.ToString();
                                    int nNewCMMPaymentMethod = 0;
                                    for (int j = 0; j < lstPaymentMethod.Count; j++)
                                    {
                                        if (NewCMMPaymentMethod == lstPaymentMethod[j].PaymentMethodValue) nNewCMMPaymentMethod = lstPaymentMethod[j].PaymentMethodId;
                                    }

                                    String NewCheckNo = String.Empty;
                                    DateTime? NewCheckDate = null;
                                    int NewCheckReconciled = 0;
                                    if (gvSettlementsInMedBill["PaymentMethod", i]?.Value?.ToString() == "Check")
                                    {
                                        if (gvSettlementsInMedBill["CheckNo", i].Value != null) NewCheckNo = gvSettlementsInMedBill["CheckNo", i].Value.ToString();
                                        if (gvSettlementsInMedBill["PaymentDate", i].Value != null) NewCheckDate = DateTime.Parse(gvSettlementsInMedBill["PaymentDate", i].Value.ToString());
                                        if (gvSettlementsInMedBill["Reconciled", i].Value != null) NewCheckReconciled = 1;
                                    }

                                    String NewACH_Number = String.Empty;
                                    DateTime? NewACH_Date = null;
                                    int NewACH_Reconciled = 0;
                                    if (gvSettlementsInMedBill["PaymentMethod", i]?.Value?.ToString() == "ACH/Banking")
                                    {
                                        if (gvSettlementsInMedBill["ACHNo", i].Value != null) NewACH_Number = gvSettlementsInMedBill["ACHNo", i].Value.ToString();
                                        if (gvSettlementsInMedBill["PaymentDate", i].Value != null) NewACH_Date = DateTime.Parse(gvSettlementsInMedBill["PaymentDate", i].Value.ToString());
                                        if (gvSettlementsInMedBill["Reconciled", i].Value != null) NewACH_Reconciled = 1;
                                    }

                                    int nCMMCreditCard = 0;
                                    DateTime? NewCreditCardPaidDate = null;
                                    int NewIsCCReconciled = 0;

                                    if (gvSettlementsInMedBill["PaymentMethod", i]?.Value?.ToString() == "Credit Card")
                                    {
                                        String CreditCard = gvSettlementsInMedBill[13, i]?.Value?.ToString();
                                        for (int j = 0; j < lstCreditCardInfo.Count; j++)
                                        {
                                            if (CreditCard == lstCreditCardInfo[j].CreditCardNo)
                                            {
                                                nCMMCreditCard = lstCreditCardInfo[j].CreditCardId;
                                            }
                                        }
                                        if (gvSettlementsInMedBill["PaymentDate", i].Value != null)
                                            NewCreditCardPaidDate = DateTime.Parse(gvSettlementsInMedBill["PaymentDate", i].Value.ToString());
                                        if (gvSettlementsInMedBill["Reconciled", i].Value != null) NewIsCCReconciled = 1;
                                    }

                                    Decimal NewAllowedAmount = 0;
                                    if (gvSettlementsInMedBill["AllowedAmount", i].Value != null) NewAllowedAmount = Decimal.Parse(gvSettlementsInMedBill["AllowedAmount", i].Value.ToString());
                                    String NewNote = String.Empty;
                                    if (gvSettlementsInMedBill["Note", i].Value != null) NewNote = gvSettlementsInMedBill["Note", i].Value.ToString();


                                    cmdInsertNewSettlement.Parameters.AddWithValue("@SettlementName", NewSettlementName);
                                    cmdInsertNewSettlement.Parameters.AddWithValue("@CreateDate", DateTime.Today);
                                    cmdInsertNewSettlement.Parameters.AddWithValue("@CreateByID", nLoggedUserId);
                                    cmdInsertNewSettlement.Parameters.AddWithValue("@LastModifiedDate", DateTime.Today);
                                    cmdInsertNewSettlement.Parameters.AddWithValue("@LastModifiedByID", nLoggedUserId);
                                    cmdInsertNewSettlement.Parameters.AddWithValue("@SystemModifiedStamp", DateTime.Today);
                                    cmdInsertNewSettlement.Parameters.AddWithValue("@LastActivityDate", DateTime.Today);
                                    cmdInsertNewSettlement.Parameters.AddWithValue("@LastViewedDate", DateTime.Today);
                                    cmdInsertNewSettlement.Parameters.AddWithValue("@MedBillID", txtMedBillNo.Text.Trim());
                                    cmdInsertNewSettlement.Parameters.AddWithValue("@SettlementType", nNewSettlementType);

                                    cmdInsertNewSettlement.Parameters.AddWithValue("@IsApproved", NewIsApproved);

                                    if (NewApprovedDate != null) cmdInsertNewSettlement.Parameters.AddWithValue("@ApprovedDate", NewApprovedDate);
                                    else cmdInsertNewSettlement.Parameters.AddWithValue("@ApprovedDate", DBNull.Value);

                                    cmdInsertNewSettlement.Parameters.AddWithValue("@CMMPaymentMethod", nNewCMMPaymentMethod);

                                    if (NewCheckNo != String.Empty) cmdInsertNewSettlement.Parameters.AddWithValue("@CheckNo", NewCheckNo);
                                    else cmdInsertNewSettlement.Parameters.AddWithValue("@CheckNo", DBNull.Value);

                                    if (NewCheckDate != null) cmdInsertNewSettlement.Parameters.AddWithValue("@CheckDate", NewCheckDate);
                                    else cmdInsertNewSettlement.Parameters.AddWithValue("@CheckDate", DBNull.Value);

                                    cmdInsertNewSettlement.Parameters.AddWithValue("@IsCheckReconciled", NewCheckReconciled);

                                    if (NewACH_Number != null) cmdInsertNewSettlement.Parameters.AddWithValue("@ACH_Number", NewACH_Number);
                                    else cmdInsertNewSettlement.Parameters.AddWithValue("@ACH_Number", DBNull.Value);

                                    if (NewACH_Date != null) cmdInsertNewSettlement.Parameters.AddWithValue("@ACH_Date", NewACH_Date);
                                    else cmdInsertNewSettlement.Parameters.AddWithValue("@ACH_Date", DBNull.Value);

                                    cmdInsertNewSettlement.Parameters.AddWithValue("@IsACH_Reconciled", NewACH_Reconciled);
                                    cmdInsertNewSettlement.Parameters.AddWithValue("@CMMCreditCard", nCMMCreditCard);

                                    if (NewCreditCardPaidDate != null) cmdInsertNewSettlement.Parameters.AddWithValue("@CMMCreditCardPaidDate", NewCreditCardPaidDate);
                                    else cmdInsertNewSettlement.Parameters.AddWithValue("@CMMCreditCardPaidDate", DBNull.Value);

                                    cmdInsertNewSettlement.Parameters.AddWithValue("@IsCC_Reconciled", NewIsCCReconciled);
                                    cmdInsertNewSettlement.Parameters.AddWithValue("@AllowedAmount", NewAllowedAmount);

                                    if (NewNote != null) cmdInsertNewSettlement.Parameters.AddWithValue("@Notes", NewNote);
                                    else cmdInsertNewSettlement.Parameters.AddWithValue("@Notes", DBNull.Value);

                                    int nIneligibleReason = 0;
                                    for (int j = 0; j < dicIneligibleReason.Count; j++)
                                    {
                                        if (gvSettlementsInMedBill["IneligibleReason", i]?.Value?.ToString() == dicIneligibleReason[j]) nIneligibleReason = j;
                                    }
                                    cmdInsertNewSettlement.Parameters.AddWithValue("@IneligibleReason", nIneligibleReason);

                                    if (connRN5.State != ConnectionState.Closed)
                                    {
                                        connRN5.Close();
                                        connRN5.Open();
                                    }
                                    else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                                    int nSettlementInserted = cmdInsertNewSettlement.ExecuteNonQuery();
                                    if (connRN5.State != ConnectionState.Closed) connRN5.Close();

                                    if (nSettlementInserted == 0) bError = true;

                                }
                                else  // the settlement with the name exist, update the settlement
                                {
                                    String UpdateSettlementName = objResultSettlementName.ToString();
                                    String UpdateMedBill = txtMedBillNo.Text.Trim();

                                    String strSqlUpdateSettlement = "update [dbo].[tbl_settlement] set [dbo].[tbl_settlement].[LastModifiedDate] = @LastModifiedDate, " +
                                                                    "[dbo].[tbl_settlement].[LastModifiedByID] = @LastModifiedByID, " +
                                                                    "[dbo].[tbl_settlement].[LastActivityDate] = @LastActivityDate, " +
                                                                    "[dbo].[tbl_settlement].[SettlementType] = @SettlementType, " +
                                                                    "[dbo].[tbl_settlement].[Amount] = @SettlementAmount, " +
                                                                    "[dbo].[tbl_settlement].[PersonalResponsibilityCredit] = @PersonalResponsibilityCredit, " +
                                                                    "[dbo].[tbl_settlement].[Approved] = @IsApproved, " +
                                                                    "[dbo].[tbl_settlement].[ApprovedDate] = @ApprovedDate, " +
                                                                    "[dbo].[tbl_settlement].[CMMPaymentMethod] = @CMMPaymentMethod, " +
                                                                    "[dbo].[tbl_settlement].[CheckNo] = @CheckNo, " +
                                                                    "[dbo].[tbl_settlement].[CheckDate] = @CheckDate, " +
                                                                    "[dbo].[tbl_settlement].[CheckReconciled] = @CheckReconciled, " +
                                                                    "[dbo].[tbl_settlement].[ACH_Number] = @ACH_Number, " +
                                                                    "[dbo].[tbl_settlement].[ACH_Date] = @ACH_Date, " +
                                                                    "[dbo].[tbl_settlement].[ACH_Reconciled] = @ACH_Reconciled, " +
                                                                    "[dbo].[tbl_settlement].[CMMCreditCard] = @CMMCreditCard, " +
                                                                    "[dbo].[tbl_settlement].[CMMCreditCardPaidDate] = @CMMCreditCardPaidDate, " +
                                                                    "[dbo].[tbl_settlement].[CC_Reconciled] = @CC_Reconciled, " +
                                                                    "[dbo].[tbl_settlement].[AllowedAmount] = @AllowedAmount, " +
                                                                    "[dbo].[tbl_settlement].[Notes] = @Note, " +
                                                                    "[dbo].[tbl_settlement].[IneligibleReason] = @IneligibleReason " +
                                                                    "where [dbo].[tbl_settlement].[Name] = @SettlementName and [dbo].[tbl_settlement].[MedicalBillID] = @MedBillName";

                                    int nSettlementType = 0;
                                    String strSettlementType = String.Empty;
                                    if (gvSettlementsInMedBill["SettlementTypeValue", i].Value != null) strSettlementType = gvSettlementsInMedBill["SettlementTypeValue", i].Value.ToString();
                                    for (int j = 0; j < lstSettlementType.Count; j++)
                                    {
                                        if (strSettlementType == lstSettlementType[j].SettlementTypeValue) nSettlementType = lstSettlementType[j].SettlementTypeCode;
                                    }

                                    Decimal SettlementAmount = 0;
                                    if (gvSettlementsInMedBill["SettlementAmount", i].Value != null)
                                    {
                                        SettlementAmount = Decimal.Parse(gvSettlementsInMedBill["SettlementAmount", i].Value.ToString(), NumberStyles.Currency);
                                    }

                                    Decimal PersonalResponsibilityAmt = 0;
                                    if (gvSettlementsInMedBill["PersonalResponsibility", i].Value != null)
                                    {
                                        PersonalResponsibilityAmt = Decimal.Parse(gvSettlementsInMedBill["PersonalResponsibility", i].Value.ToString(), NumberStyles.Currency);
                                    }

                                    // Payment method
                                    int nPaymentMethod = 0;
                                    String PaymentMethod = String.Empty;
                                    if (gvSettlementsInMedBill["PaymentMethod", i].Value != null)
                                        PaymentMethod = gvSettlementsInMedBill["PaymentMethod", i].Value.ToString();
                                    for (int j = 0; j < lstPaymentMethod.Count; j++)
                                    {
                                        if (PaymentMethod == lstPaymentMethod[j].PaymentMethodValue) nPaymentMethod = lstPaymentMethod[j].PaymentMethodId;
                                    }

                                    // Approved or not
                                    int nApproved = 0;
                                    if (gvSettlementsInMedBill["Approved", i].Value != null)
                                    {
                                        if ((Boolean)gvSettlementsInMedBill["Approved", i].Value) nApproved = 1;
                                    }

                                    //if (gvSettlementsInMedBill["ApprovedDate", i]?.Value != null)
                                    //{
                                    //    DateTime resultApprovedDate;
                                    //    if (DateTime.TryParse(gvSettlementsInMedBill["ApprovedDate", i]?.Value.ToString(), out resultApprovedDate))
                                    //        NewApprovedDate = resultApprovedDate;

                                    //    //NewApprovedDate = DateTime.Parse(gvSettlementsInMedBill["ApprovedDate", i].Value.ToString());
                                    //}

                                    DateTime? ApprovedDate = null;
                                    if (gvSettlementsInMedBill["ApprovedDate", i]?.Value != null)
                                    {
                                        DateTime resultApprovedDate;
                                        if (DateTime.TryParse(gvSettlementsInMedBill["ApprovedDate", i]?.Value?.ToString(), out resultApprovedDate))
                                            ApprovedDate = resultApprovedDate;
                                        //ApprovedDate = DateTime.Parse(gvSettlementsInMedBill["ApprovedDate", i].Value.ToString());
                                    }


                                    String CheckNo = String.Empty;
                                    DateTime? CheckIssueDate = null;
                                    int nCheckReconciled = 0;

                                    String ACH_No = String.Empty;
                                    DateTime? ACH_Date = null;
                                    int nACHReconciled = 0;

                                    String CreditCard = String.Empty;
                                    int nCreditCard = 0;
                                    DateTime? CreditCardPaidDate = null;
                                    int nCCReconciled = 0;

                                    switch (PaymentMethod)
                                    {
                                        case "Check":
                                            if (gvSettlementsInMedBill["CheckNo", i].Value != null) CheckNo = gvSettlementsInMedBill["CheckNo", i].Value.ToString();
                                            if (gvSettlementsInMedBill["PaymentDate", i].Value != null)
                                            {
                                                if (gvSettlementsInMedBill["PaymentDate", i].Value.ToString() != String.Empty) CheckIssueDate = DateTime.Parse(gvSettlementsInMedBill["PaymentDate", i].Value.ToString());
                                            }
                                            Boolean bCheckReconciledResult = false;
                                            if (gvSettlementsInMedBill["Reconciled", i].Value != null)
                                            {
                                                if (Boolean.TryParse(gvSettlementsInMedBill["Reconciled", i].Value.ToString(), out bCheckReconciledResult))
                                                {
                                                    if (bCheckReconciledResult) nCheckReconciled = 1;
                                                }
                                            }
                                            break;
                                        case "ACH/Banking":
                                            if (gvSettlementsInMedBill["ACHNo", i].Value != null) ACH_No = gvSettlementsInMedBill["ACHNo", i].Value.ToString();
                                            if (gvSettlementsInMedBill["PaymentDate", i].Value != null)
                                            {
                                                if (gvSettlementsInMedBill["PaymentDate", i].Value.ToString() != String.Empty) ACH_Date = DateTime.Parse(gvSettlementsInMedBill["PaymentDate", i].Value.ToString());
                                            }
                                            Boolean bACHReconciledResult = false;
                                            if (gvSettlementsInMedBill["Reconciled", i].Value != null)
                                            {
                                                if (Boolean.TryParse(gvSettlementsInMedBill["Reconciled", i].Value.ToString(), out bACHReconciledResult))
                                                {
                                                    if (bACHReconciledResult) nACHReconciled = 1;
                                                }
                                            }
                                            break;
                                        case "Credit Card":
                                            if (gvSettlementsInMedBill["CreditCard", i].Value != null) CreditCard = gvSettlementsInMedBill["CreditCard", i].Value.ToString();
                                            for (int j = 0; j < lstCreditCardInfo.Count; j++)
                                            {
                                                if (CreditCard == lstCreditCardInfo[j].CreditCardNo) nCreditCard = lstCreditCardInfo[j].CreditCardId;
                                            }
                                            if (gvSettlementsInMedBill["PaymentDate", i].Value != null)
                                            {
                                                if (gvSettlementsInMedBill["PaymentDate", i].Value.ToString() != String.Empty)
                                                    CreditCardPaidDate = DateTime.Parse(gvSettlementsInMedBill["PaymentDate", i].Value.ToString());
                                            }
                                            Boolean bCCReconciledResult = false;
                                            if (gvSettlementsInMedBill[15, i].Value != null)
                                            {
                                                if (Boolean.TryParse(gvSettlementsInMedBill["Reconciled", i].Value.ToString(), out bCCReconciledResult))
                                                {
                                                    if (bCCReconciledResult) nCCReconciled = 1;
                                                }
                                            }
                                            break;
                                    }

                                    // Allowed Amount
                                    Decimal AllowedAmount = 0;
                                    if (gvSettlementsInMedBill["AllowedAmount", i].Value != null)
                                    {
                                        AllowedAmount = Decimal.Parse(gvSettlementsInMedBill["AllowedAmount", i].Value.ToString(), NumberStyles.Currency);
                                    }

                                    // Note
                                    String Note = String.Empty;
                                    if (gvSettlementsInMedBill["Note", i].Value != null) Note = gvSettlementsInMedBill["Note", i].Value.ToString();



                                    SqlCommand cmdUpdateSettlement = new SqlCommand(strSqlUpdateSettlement, connRN5);
                                    cmdUpdateSettlement.CommandType = CommandType.Text;

                                    cmdUpdateSettlement.Parameters.AddWithValue("@LastModifiedDate", DateTime.Today);
                                    cmdUpdateSettlement.Parameters.AddWithValue("@LastModifiedByID", nLoggedUserId);
                                    cmdUpdateSettlement.Parameters.AddWithValue("@LastActivityDate", DateTime.Today);
                                    cmdUpdateSettlement.Parameters.AddWithValue("@SettlementType", nSettlementType);


                                    cmdUpdateSettlement.Parameters.AddWithValue("@SettlementAmount", SettlementAmount);
                                    cmdUpdateSettlement.Parameters.AddWithValue("@PersonalResponsibilityCredit", PersonalResponsibilityAmt);

                                    cmdUpdateSettlement.Parameters.AddWithValue("@IsApproved", nApproved);
                                    if (ApprovedDate != null) cmdUpdateSettlement.Parameters.AddWithValue("@ApprovedDate", ApprovedDate);
                                    else cmdUpdateSettlement.Parameters.AddWithValue("@ApprovedDate", DBNull.Value);

                                    cmdUpdateSettlement.Parameters.AddWithValue("@CMMPaymentMethod", nPaymentMethod);

                                    if (CheckNo != String.Empty) cmdUpdateSettlement.Parameters.AddWithValue("@CheckNo", CheckNo);
                                    else cmdUpdateSettlement.Parameters.AddWithValue("@CheckNo", DBNull.Value);

                                    if (CheckIssueDate != null) cmdUpdateSettlement.Parameters.AddWithValue("@CheckDate", CheckIssueDate);
                                    else cmdUpdateSettlement.Parameters.AddWithValue("@CheckDate", DBNull.Value);

                                    cmdUpdateSettlement.Parameters.AddWithValue("@CheckReconciled", nCheckReconciled);

                                    if (ACH_No != String.Empty) cmdUpdateSettlement.Parameters.AddWithValue("@ACH_Number", ACH_No);
                                    else cmdUpdateSettlement.Parameters.AddWithValue("@ACH_Number", DBNull.Value);

                                    if (ACH_Date != null) cmdUpdateSettlement.Parameters.AddWithValue("@ACH_Date", ACH_Date);
                                    else cmdUpdateSettlement.Parameters.AddWithValue("@ACH_Date", DBNull.Value);

                                    cmdUpdateSettlement.Parameters.AddWithValue("@ACH_Reconciled", nACHReconciled);
                                    cmdUpdateSettlement.Parameters.AddWithValue("@CMMCreditCard", nCreditCard);

                                    if (CreditCardPaidDate != null) cmdUpdateSettlement.Parameters.AddWithValue("@CMMCreditCardPaidDate", CreditCardPaidDate);
                                    else cmdUpdateSettlement.Parameters.AddWithValue("@CMMCreditCardPaidDate", DBNull.Value);
                                    cmdUpdateSettlement.Parameters.AddWithValue("@CC_Reconciled", nCCReconciled);
                                    cmdUpdateSettlement.Parameters.AddWithValue("@AllowedAmount", AllowedAmount);
                                    if (Note != String.Empty) cmdUpdateSettlement.Parameters.AddWithValue("@Note", Note);
                                    else cmdUpdateSettlement.Parameters.AddWithValue("@Note", DBNull.Value);

                                    cmdUpdateSettlement.Parameters.AddWithValue("@SettlementName", UpdateSettlementName);
                                    cmdUpdateSettlement.Parameters.AddWithValue("@MedBillName", UpdateMedBill);

                                    int nIneligibleReason = 0;
                                    for (int j = 0; j < dicIneligibleReason.Count; j++)
                                    {
                                        if (gvSettlementsInMedBill["IneligibleReason", i]?.Value?.ToString() == dicIneligibleReason[j]) nIneligibleReason = j;
                                    }
                                    cmdUpdateSettlement.Parameters.AddWithValue("@IneligibleReason", nIneligibleReason);

                                    if (connRN5.State != ConnectionState.Closed)
                                    {
                                        connRN5.Close();
                                        connRN5.Open();
                                    }
                                    else if (connRN5.State == ConnectionState.Closed) connRN5.Open();

                                    int nRowUpdated = cmdUpdateSettlement.ExecuteNonQuery();
                                    if (connRN5.State != ConnectionState.Closed) connRN5.Close();

                                    if (nRowUpdated == 0) bError = true;
                                }
                            }

                            ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

                            for (int i = 0; i < gvSettlementsInMedBill.Rows.Count; i++)
                            {
                                if (gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() != "Ineligible")
                                {
                                    gvSettlementsInMedBill["IneligibleReason", i].Value = null;
                                    gvSettlementsInMedBill["IneligibleReason", i].ReadOnly = true;
                                }
                            }

                            if (bError == false)
                            {
                                MessageBox.Show("Settlements have been saved.", "Info");
                            }
                            else if (bError == true)
                            {
                                MessageBox.Show("Some of settlments have not been saved.", "Error");
                                //return;
                            }

                            // 
                            // update settlement total for medical bill
                            String MedBillNoForSettlementTotal = txtMedBillNo.Text.Trim();
                            String strSqlQueryForSettlementTotal = "Select sum([dbo].[tbl_settlement].[Amount]) from [dbo].[tbl_settlement] " +
                                                                   "where ([dbo].[tbl_settlement].[IsDeleted] IS NULL or [dbo].[tbl_settlement].[IsDeleted] = 0) and " +
                                                                   "[dbo].[tbl_settlement].[MedicalBillID] = @MedBillNo";

                            SqlCommand cmdQueryForSettlementTotal = new SqlCommand(strSqlQueryForSettlementTotal, connRN5);
                            cmdQueryForSettlementTotal.CommandType = CommandType.Text;

                            cmdQueryForSettlementTotal.Parameters.AddWithValue("@MedBillNo", MedBillNoForSettlementTotal);

                            if (connRN5.State != ConnectionState.Closed)
                            {
                                connRN5.Close();
                                connRN5.Open();
                            }
                            else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                            Decimal SettlementTotal = (Decimal)cmdQueryForSettlementTotal.ExecuteScalar();
                            if (connRN5.State != ConnectionState.Closed) connRN.Close();

                            String strSqlUpdateMedBillForSettlementTotal = "update [dbo].[tbl_medbill] set [dbo].[tbl_medbill].[SettlementTotal] = @SettlementTotal " +
                                                                           "where ([dbo].[tbl_medbill].[IsDeleted] IS NULL or [dbo].[tbl_medbill].[IsDeleted] = 0) and " +
                                                                           "[dbo].[tbl_medbill].[BillNo] = @MedBillNo";

                            SqlCommand cmdUpdateMedBillForSettlementTotal = new SqlCommand(strSqlUpdateMedBillForSettlementTotal, connRN5);
                            cmdUpdateMedBillForSettlementTotal.CommandType = CommandType.Text;

                            cmdUpdateMedBillForSettlementTotal.Parameters.AddWithValue("@SettlementTotal", SettlementTotal);
                            cmdUpdateMedBillForSettlementTotal.Parameters.AddWithValue("@MedBillNo", MedBillNoForSettlementTotal);

                            if (connRN5.State != ConnectionState.Closed)
                            {
                                connRN5.Close();
                                connRN5.Open();
                            }
                            else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                            int nMedBillUpdatedForSettlementTotal = cmdUpdateMedBillForSettlementTotal.ExecuteNonQuery();
                            if (connRN5.State != ConnectionState.Closed) connRN.Close();

                        }

                        MessageBox.Show("The Medical Bill has been updated.", "Information");

                        if (cbMedBillClosed.SelectedIndex == 1)
                        {
                            String CaseNo = txtMedBill_CaseNo.Text.Trim();

                            String strSqlQueryForMedBillsInCase = "select [dbo].[tbl_medbill].[BillClosed], [dbo].[tbl_medbill].[BillNo] from [dbo].[tbl_medbill] " +
                                                                  "where ([dbo].[tbl_medbill].[IsDeleted] IS NULL or [dbo].[tbl_medbill].[IsDeleted] = 0) and " +
                                                                  "[dbo].[tbl_medbill].[Individual_Id] = @IndividualId and " +
                                                                  "[dbo].[tbl_medbill].[Case_Id] = @CaseId";

                            SqlCommand cmdQueryForMedBillsInCase = new SqlCommand(strSqlQueryForMedBillsInCase, connRN5);
                            cmdQueryForMedBillsInCase.CommandType = CommandType.Text;

                            cmdQueryForMedBillsInCase.Parameters.AddWithValue("@IndividualId", IndividualId);
                            cmdQueryForMedBillsInCase.Parameters.AddWithValue("@CaseId", CaseNo);

                            if (connRN5.State != ConnectionState.Closed)
                            {
                                connRN5.Close();
                                connRN5.Open();
                            }
                            else if (connRN5.State == ConnectionState.Closed) connRN5.Open();

                            SqlDataReader rdrMedBillsInCase = cmdQueryForMedBillsInCase.ExecuteReader();

                            Boolean bBillClosed = true;
                            if (rdrMedBillsInCase.HasRows)
                            {
                                while (rdrMedBillsInCase.Read())
                                {
                                    if (!rdrMedBillsInCase.IsDBNull(0))
                                    {
                                        if (rdrMedBillsInCase.GetBoolean(0) == false) bBillClosed = false;
                                    }
                                    else bBillClosed = false;
                                }
                            }
                            rdrMedBillsInCase.Close();
                            if (connRN5.State != ConnectionState.Closed) connRN5.Close();

                            if (bBillClosed == true)
                            {
                                String strSetCaseToClosed = "update [dbo].[tbl_case] set [dbo].[tbl_case].[Case_status] = 2 " +
                                                            "where ([dbo].[tbl_case].[IsDeleted] IS NULL or [dbo].[tbl_case].[IsDeleted] = 0) and " +
                                                            "[dbo].[tbl_case].[Case_Name] = @CaseNo and " +
                                                            "[dbo].[tbl_case].[individual_id] = @IndividualId";

                                SqlCommand cmdSetCaseToClosed = new SqlCommand(strSetCaseToClosed, connRN5);
                                cmdSetCaseToClosed.CommandType = CommandType.Text;

                                cmdSetCaseToClosed.Parameters.AddWithValue("@CaseNo", CaseNo);
                                cmdSetCaseToClosed.Parameters.AddWithValue("@IndividualId", IndividualId);

                                if (connRN5.State != ConnectionState.Closed)
                                {
                                    connRN5.Close();
                                    connRN5.Open();
                                }
                                else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                                int nCaseClosed = cmdSetCaseToClosed.ExecuteNonQuery();
                                if (connRN5.State != ConnectionState.Closed) connRN5.Close();

                                if (nCaseClosed == 1)
                                {
                                    MessageBox.Show("The case has been closed.", "Information");
                                    cbCaseStatus.SelectedIndex = 2;
                                    cbCaseStatus.Enabled = true;
                                }
                            }
                        }
                        //////////////////////////////////////////////////////////////////////////////////////////////////////////////////

                        if (gvSettlementsInMedBill.Rows.Count > 0)
                        {
                            String strSqlQueryForTotalSharedAmountInMedBill = "select sum([dbo].[tbl_settlement].[Amount]) from [dbo].[tbl_settlement] " +
                                                      "inner join [dbo].[tbl_settlement_type_code] on " +
                                                      "[dbo].[tbl_settlement].[SettlementType] = [dbo].[tbl_settlement_type_code].[SettlementTypeCode] " +
                                                      "where [dbo].[tbl_settlement].[MedicalBillID] = @MedBillNo and " +
                                                      "([dbo].[tbl_settlement].[IsDeleted] = 0 or [dbo].[tbl_settlement].[IsDeleted] IS NULL) and " +
                                                      "([dbo].[tbl_settlement_type_code].[SettlementTypeValue] = 'CMM Provider Payment' or " +
                                                      "[dbo].[tbl_settlement_type_code].[SettlementTypeValue] = 'CMM Member Reimbursement' or " +
                                                      "[dbo].[tbl_settlement_type_code].[SettlementTypeValue] = 'PR Reimbursement')";

                            SqlCommand cmdQueryForTotalSharedAmountInMedBill = new SqlCommand(strSqlQueryForTotalSharedAmountInMedBill, connRN5);
                            cmdQueryForTotalSharedAmountInMedBill.CommandType = CommandType.Text;

                            cmdQueryForTotalSharedAmountInMedBill.Parameters.AddWithValue("@MedBillNo", strMedBillNo);

                            if (connRN5.State != ConnectionState.Closed)
                            {
                                connRN5.Close();
                                connRN5.Open();
                            }
                            else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                            Object objTotalSharedAmountInMedBill = cmdQueryForTotalSharedAmountInMedBill.ExecuteScalar();
                            if (connRN5.State != ConnectionState.Closed) connRN5.Close();

                            Decimal TotalSharedAmountInMedBill = 0;
                            if (objTotalSharedAmountInMedBill.ToString() != String.Empty) TotalSharedAmountInMedBill = Decimal.Parse(objTotalSharedAmountInMedBill.ToString());

                            String strSqlQueryForMedicalProviderRefund = "select sum([dbo].[tbl_settlement].[Amount]) from [dbo].[tbl_settlement] " +
                                                                         "inner join [dbo].[tbl_settlement_type_code] on " +
                                                                         "[dbo].[tbl_settlement].[SettlementType] = [dbo].[tbl_settlement_type_code].[SettlementTypeCode] " +
                                                                         "where [dbo].[tbl_settlement].[MedicalBillID] = @MedBillNo and " +
                                                                         "([dbo].[tbl_settlement].[IsDeleted] = 0 or [dbo].[tbl_settlement].[IsDeleted] IS NULL) and " +
                                                                         "[dbo].[tbl_settlement_type_code].[SettlementTypeValue] = 'Medical Provider Refund'";

                            SqlCommand cmdQueryForMedicalProviderRefund = new SqlCommand(strSqlQueryForMedicalProviderRefund, connRN5);
                            cmdQueryForMedicalProviderRefund.CommandType = CommandType.Text;

                            cmdQueryForMedicalProviderRefund.Parameters.AddWithValue("@MedBillNo", strMedBillNo);

                            if (connRN5.State != ConnectionState.Closed)
                            {
                                connRN5.Close();
                                connRN5.Open();
                            }
                            else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                            Object objTotalMedicalProviderRefund = cmdQueryForMedicalProviderRefund.ExecuteScalar();
                            if (connRN5.State != ConnectionState.Closed) connRN5.Close();

                            Decimal TotalMedicalProviderRefund = 0;
                            if (objTotalMedicalProviderRefund.ToString() != String.Empty) TotalMedicalProviderRefund = Decimal.Parse(objTotalMedicalProviderRefund.ToString());

                            TotalSharedAmountInMedBill -= TotalMedicalProviderRefund;

                            String strSqlUpdateMedBillWithTotalSharedAmount = "update [dbo].[tbl_medbill] set [dbo].[tbl_medbill].[TotalSharedAmount] = @TotalSharedAmount " +
                                                      "where [dbo].[tbl_medbill].[BillNo] = @MedBillNo and " +
                                                      "([dbo].[tbl_medbill].[IsDeleted] = 0 or [dbo].[tbl_medbill].[IsDeleted] IS NULL) and " +
                                                      "[dbo].[tbl_medbill].[Illness_Id] = @IllnessId and " +
                                                      "[dbo].[tbl_medbill].[Incident_Id] = @IncidentId and " +
                                                      "[dbo].[tbl_medbill].[Individual_Id] = @IndividualId";


                            SqlCommand cmdUpdateMedBillWithTotalSharedAmount = new SqlCommand(strSqlUpdateMedBillWithTotalSharedAmount, connRN5);
                            cmdUpdateMedBillWithTotalSharedAmount.CommandType = CommandType.Text;

                            cmdUpdateMedBillWithTotalSharedAmount.Parameters.AddWithValue("@TotalSharedAmount", TotalSharedAmountInMedBill);
                            cmdUpdateMedBillWithTotalSharedAmount.Parameters.AddWithValue("@MedBillNo", strMedBillNo);
                            cmdUpdateMedBillWithTotalSharedAmount.Parameters.AddWithValue("@IllnessId", Int32.Parse(strIllnessId));
                            cmdUpdateMedBillWithTotalSharedAmount.Parameters.AddWithValue("@IncidentId", Int32.Parse(strIncidentId));
                            cmdUpdateMedBillWithTotalSharedAmount.Parameters.AddWithValue("@IndividualId", txtIndividualIDMedBill.Text.Trim());

                            if (connRN5.State != ConnectionState.Closed)
                            {
                                connRN5.Close();
                                connRN5.Open();
                            }
                            else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                            int nMedBillUpdated = cmdUpdateMedBillWithTotalSharedAmount.ExecuteNonQuery();
                            if (connRN5.State != ConnectionState.Closed) connRN5.Close();

                            if (nMedBillUpdated == 0)
                            {
                                MessageBox.Show("The Medical Bill has not been updated with Total Shared Amount.", "Error");
                                return;
                            }

                            String strSqlQueryForIncidentTotalSharedAmount = "select sum([dbo].[tbl_medbill].[TotalSharedAmount]) from [dbo].[tbl_medbill] " +
                                                     "where ([dbo].[tbl_medbill].[IsDeleted] = 0 or [dbo].[tbl_medbill].[IsDeleted] IS NULL) and " +
                                                     "[dbo].[tbl_medbill].[Illness_Id] = @IllnessId and " +
                                                     "[dbo].[tbl_medbill].[Incident_Id] = @IncidentId and " +
                                                     "[dbo].[tbl_medbill].[Individual_Id] = @IndividualId";

                            SqlCommand cmdQueryForIncidentTotalSharedAmount = new SqlCommand(strSqlQueryForIncidentTotalSharedAmount, connRN5);
                            cmdQueryForIncidentTotalSharedAmount.CommandType = CommandType.Text;

                            cmdQueryForIncidentTotalSharedAmount.Parameters.AddWithValue("@IllnessId", Int32.Parse(strIllnessId));
                            cmdQueryForIncidentTotalSharedAmount.Parameters.AddWithValue("@IncidentId", Int32.Parse(strIncidentId));
                            cmdQueryForIncidentTotalSharedAmount.Parameters.AddWithValue("@IndividualId", txtIndividualIDMedBill.Text.Trim());

                            if (connRN5.State != ConnectionState.Closed)
                            {
                                connRN5.Close();
                                connRN5.Open();
                            }
                            else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                            Object objIncidentTotalSharedAmount = cmdQueryForIncidentTotalSharedAmount.ExecuteScalar();
                            if (connRN5.State != ConnectionState.Closed) connRN5.Close();

                            Decimal IncidentTotalSharedAmount = 0;
                            if (objIncidentTotalSharedAmount.ToString() != String.Empty) IncidentTotalSharedAmount = Decimal.Parse(objIncidentTotalSharedAmount.ToString());
                            else
                            {
                                MessageBox.Show("No Incident Total Shared Amount", "Error");
                                return;
                            }

                            String strSqlUpdateIncidentSharedTotalAmount = "update [dbo].[tbl_incident] set [dbo].[tbl_incident].[TotalSharedAmount] = @TotalSharedAmount," +
                                                                           "[dbo].[tbl_incident].[ModifiStaff] = @ModifiStaff " +
                                                                           "where ([dbo].[tbl_incident].[IsDeleted] = 0 or [dbo].[tbl_incident].[IsDeleted] IS NULL) and " +
                                                                           "[dbo].[tbl_incident].[Illness_id] = @IllnessId and " +
                                                                           "[dbo].[tbl_incident].[Incident_id] = @IncidentId and " +
                                                                           "[dbo].[tbl_incident].[Individual_id] = @IndividualId";

                            SqlCommand cmdUpdateIncidentSharedTotal = new SqlCommand(strSqlUpdateIncidentSharedTotalAmount, connRN5);
                            cmdUpdateIncidentSharedTotal.CommandType = CommandType.Text;

                            cmdUpdateIncidentSharedTotal.Parameters.AddWithValue("@TotalSharedAmount", IncidentTotalSharedAmount);
                            cmdUpdateIncidentSharedTotal.Parameters.AddWithValue("@ModifiStaff", nLoggedUserId);
                            cmdUpdateIncidentSharedTotal.Parameters.AddWithValue("@IllnessId", Int32.Parse(strIllnessId));
                            cmdUpdateIncidentSharedTotal.Parameters.AddWithValue("@IncidentId", Int32.Parse(strIncidentId));
                            cmdUpdateIncidentSharedTotal.Parameters.AddWithValue("@IndividualId", txtIndividualIDMedBill.Text.Trim());

                            if (connRN5.State != ConnectionState.Closed)
                            {
                                connRN5.Close();
                                connRN5.Open();
                            }
                            else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                            int nIncidentUpdated = cmdUpdateIncidentSharedTotal.ExecuteNonQuery(); // incident id is null in incident_history table
                            if (connRN5.State != ConnectionState.Closed) connRN5.Close();

                            if (nIncidentUpdated == 3)
                            {
                                String strSqlQueryForIllnessTotalSharedAmount = "select sum([dbo].[tbl_incident].[TotalSharedAmount]) from [dbo].[tbl_incident] " +
                                                    "where ([dbo].[tbl_incident].[IsDeleted] = 0 or [dbo].[tbl_incident].[IsDeleted] IS NULL) and " +
                                                    "[dbo].[tbl_incident].[Illness_id] = @IllnessId and " +
                                                    "[dbo].[tbl_incident].[Individual_id] = @IndividualId";

                                SqlCommand cmdQueryForIllnessTotalSharedAmount = new SqlCommand(strSqlQueryForIllnessTotalSharedAmount, connRN5);
                                cmdQueryForIllnessTotalSharedAmount.CommandType = CommandType.Text;

                                cmdQueryForIllnessTotalSharedAmount.Parameters.AddWithValue("@IllnessId", Int32.Parse(strIllnessId));
                                cmdQueryForIllnessTotalSharedAmount.Parameters.AddWithValue("@IndividualId", txtIndividualIDMedBill.Text.Trim());

                                if (connRN5.State != ConnectionState.Closed)
                                {
                                    connRN5.Close();
                                    connRN5.Open();
                                }
                                else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                                Object objIllnessTotalSharedAmount = cmdQueryForIllnessTotalSharedAmount.ExecuteScalar();
                                if (connRN5.State != ConnectionState.Closed) connRN5.Close();

                                Decimal IllnessTotalSharedAmount = 0;
                                if (objIllnessTotalSharedAmount.ToString() != String.Empty) IllnessTotalSharedAmount = Decimal.Parse(objIllnessTotalSharedAmount.ToString());

                                String strSqlUpdateIllnessSharedTotal = "update [dbo].[tbl_illness] set [dbo].[tbl_illness].[TotalSharedAmount] = @TotalSharedAmount " +
                                            "where ([dbo].[tbl_illness].[IsDeleted] = 0 or [dbo].[tbl_illness].[IsDeleted] IS NULL) and " +
                                            "[dbo].[tbl_illness].[Illness_Id] = @IllnessId and " +
                                            "[dbo].[tbl_illness].[Individual_Id] = @IndividualId";

                                SqlCommand cmdUpdateIllnessSharedTotal = new SqlCommand(strSqlUpdateIllnessSharedTotal, connRN5);
                                cmdUpdateIllnessSharedTotal.CommandType = CommandType.Text;

                                cmdUpdateIllnessSharedTotal.Parameters.AddWithValue("@TotalSharedAmount", IllnessTotalSharedAmount);
                                cmdUpdateIllnessSharedTotal.Parameters.AddWithValue("@IllnessId", Int32.Parse(strIllnessId));
                                cmdUpdateIllnessSharedTotal.Parameters.AddWithValue("@IndividualId", txtIndividualIDMedBill.Text.Trim());

                                if (connRN5.State != ConnectionState.Closed)
                                {
                                    connRN5.Close();
                                    connRN5.Open();
                                }
                                else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                                int nIllnessUpdated = cmdUpdateIllnessSharedTotal.ExecuteNonQuery();
                                if (connRN5.State != ConnectionState.Closed) connRN5.Close();

                                if (nIllnessUpdated == 1)
                                {

                                    String strSqlQueryForIndividualTotalSharedAmount = "select sum([dbo].[tbl_illness].[TotalSharedAmount]) from [dbo].[tbl_illness] " +
                                                        "where ([dbo].[tbl_illness].[IsDeleted] = 0 or [dbo].[tbl_illness].[IsDeleted] IS NULL) and " +
                                                        "[dbo].[tbl_illness].[Individual_Id] = @IndividualId";

                                    SqlCommand cmdQueryForIndividualTotalSharedAmount = new SqlCommand(strSqlQueryForIndividualTotalSharedAmount, connRN5);
                                    cmdQueryForIndividualTotalSharedAmount.CommandType = CommandType.Text;
                                    cmdQueryForIndividualTotalSharedAmount.Parameters.AddWithValue("@IndividualId", txtIndividualIDMedBill.Text.Trim());

                                    if (connRN5.State != ConnectionState.Closed)
                                    {
                                        connRN5.Close();
                                        connRN5.Open();
                                    }
                                    else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                                    Object objIndividualTotalSharedAmount = cmdQueryForIndividualTotalSharedAmount.ExecuteScalar();
                                    if (connRN5.State != ConnectionState.Closed) connRN5.Close();

                                    Decimal IndividualTotalSharedAmount = 0;
                                    if (objIndividualTotalSharedAmount.ToString() != String.Empty) IndividualTotalSharedAmount = Decimal.Parse(objIndividualTotalSharedAmount.ToString());

                                    String strSqlUpdateIndividualTotalSharedAmount = "update [dbo].[contact] set [dbo].[contact].[c4g_Total_Shared_Amount__c] = @IndividualTotalSharedAmount " +
                                                                                     "where ([dbo].[contact].[IsDeleted] = 0 or [dbo].[contact].[IsDeleted] IS NULL) and " +
                                                                                     "[dbo].[contact].[Individual_ID__c] = @IndividualId";

                                    SqlCommand cmdUpdateIndividualTotalSharedAmount = new SqlCommand(strSqlUpdateIndividualTotalSharedAmount, connSalesforce4);
                                    cmdUpdateIndividualTotalSharedAmount.CommandType = CommandType.Text;

                                    cmdUpdateIndividualTotalSharedAmount.Parameters.AddWithValue("@IndividualTotalSharedAmount", IndividualTotalSharedAmount);
                                    cmdUpdateIndividualTotalSharedAmount.Parameters.AddWithValue("@IndividualId", txtIndividualIDMedBill.Text.Trim());

                                    if (connSalesforce4.State == ConnectionState.Open)
                                    {
                                        connSalesforce4.Close();
                                        connSalesforce4.Open();
                                    }
                                    else if (connSalesforce4.State == ConnectionState.Closed) connSalesforce4.Open();
                                    int nIndividualUpdated = cmdUpdateIndividualTotalSharedAmount.ExecuteNonQuery();
                                    if (connSalesforce4.State != ConnectionState.Closed) connSalesforce4.Close();

                                    if (nIndividualUpdated == 1) txtTotalSharedAmount.Text = IndividualTotalSharedAmount.ToString("C");

                                    if (nIndividualUpdated != 1)
                                    {
                                        MessageBox.Show("Individual Total Shared Amount has not been updated.", "Error");
                                        return;
                                    }
                                }
                                else
                                {
                                    MessageBox.Show("Illness Total Shared Amount has not been updated.", "Error");
                                    return;
                                }

                                // Calculate Well Being incident total
                                String strSqlQueryForWellBeingIncidentTotal = "select sum([dbo].[tbl_incident].[TotalSharedAmount]) from [dbo].[tbl_incident] " +
                                                                              "where ([dbo].[tbl_incident].[IsDeleted] = 0 or [dbo].[tbl_incident].[IsDeleted] IS NULL) and " +
                                                                              "[dbo].[tbl_incident].[Illness_id] = @IllnessId and " +
                                                                              "[dbo].[tbl_incident].[Individual_id] = @IndividualId and " +
                                                                              "[dbo].[tbl_incident].[IsWellBeing] = 1";

                                SqlCommand cmdQueryForIllnessWellBeingTotalSharedAmount = new SqlCommand(strSqlQueryForWellBeingIncidentTotal, connRN5);
                                cmdQueryForIllnessWellBeingTotalSharedAmount.CommandType = CommandType.Text;

                                cmdQueryForIllnessWellBeingTotalSharedAmount.Parameters.AddWithValue("@IllnessId", Int32.Parse(strIllnessId));
                                cmdQueryForIllnessWellBeingTotalSharedAmount.Parameters.AddWithValue("@IndividualId", txtIndividualIDMedBill.Text.Trim());

                                if (connRN5.State != ConnectionState.Closed)
                                {
                                    connRN5.Close();
                                    connRN5.Open();
                                }
                                else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                                Object objWellBeingSum = cmdQueryForIllnessWellBeingTotalSharedAmount.ExecuteScalar();
                                if (connRN5.State != ConnectionState.Closed) connRN5.Close();
                                Decimal WellBeingSum = 0;
                                if (objWellBeingSum.ToString() != String.Empty) WellBeingSum = Decimal.Parse(objWellBeingSum.ToString());

                                // Update [dbo].[contact] table with well being care total
                                String strSqlUpdateContactWithWellBeingCareTotal = "update [dbo].[contact] set [dbo].[contact].[c4g_Well_Being_Care_Shared__c] = @WellBeingSum " +
                                                                                   "where ([dbo].[contact].[IsDeleted] = 0 or [dbo].[contact].[IsDeleted] IS NULL) and " +
                                                                                   "[dbo].[contact].[Individual_ID__c] = @IndividualId";

                                SqlCommand cmdUpdateContactWithWellBeingCareTotal = new SqlCommand(strSqlUpdateContactWithWellBeingCareTotal, connSalesforce4);
                                cmdUpdateContactWithWellBeingCareTotal.CommandType = CommandType.Text;

                                cmdUpdateContactWithWellBeingCareTotal.Parameters.AddWithValue("@WellBeingSum", WellBeingSum);
                                cmdUpdateContactWithWellBeingCareTotal.Parameters.AddWithValue("@IndividualId", txtIndividualIDMedBill.Text.Trim());

                                if (connSalesforce4.State != ConnectionState.Closed)
                                {
                                    connSalesforce4.Close();
                                    connSalesforce4.Open();
                                }
                                else if (connSalesforce4.State == ConnectionState.Closed) connSalesforce4.Open();
                                int nRowContactUpdated = cmdUpdateContactWithWellBeingCareTotal.ExecuteNonQuery();
                                if (connSalesforce4.State != ConnectionState.Closed) connSalesforce4.Close();

                                if (nRowContactUpdated == 0)
                                {
                                    MessageBox.Show("No contact has been updated.", "Error");
                                    return;
                                }

                                txtWellBeingAmt.Text = WellBeingSum.ToString("C");

                                Decimal TotalSharedAmount = 0;
                                Decimal TotalSharedAmountResult = 0;
                                if (Decimal.TryParse(txtTotalSharedAmount.Text.Trim(), NumberStyles.Currency, new CultureInfo("en-US"), out TotalSharedAmountResult))
                                {
                                    TotalSharedAmount = TotalSharedAmountResult;
                                }
                                else
                                {
                                    MessageBox.Show("Invalid total shared amount.", "Error");
                                    return;
                                }

                                Decimal Over10KAmount = TotalSharedAmount - WellBeingSum;
                                txtOver10KAmount.Text = Over10KAmount.ToString("C");
                                String strSqlUpdateContactForover10kShareAmount = "update [dbo].[contact] set [dbo].[contact].[Total_10K_Share_Amount__c] = @Total10KShareAmount " +
                                                                                  "where ([dbo].[contact].[IsDeleted] = 0 or [dbo].[contact].[IsDeleted] Is NULL) and " +
                                                                                  "[dbo].[contact].[Individual_ID__c] = @IndividualId";

                                SqlCommand cmdUpdateContactForOver10kShareAmount = new SqlCommand(strSqlUpdateContactForover10kShareAmount, connSalesforce4);
                                cmdUpdateContactForOver10kShareAmount.CommandType = CommandType.Text;

                                cmdUpdateContactForOver10kShareAmount.Parameters.AddWithValue("@Total10KShareAmount", Over10KAmount);
                                cmdUpdateContactForOver10kShareAmount.Parameters.AddWithValue("@IndividualId", txtIndividualIDMedBill.Text.Trim());

                                if (connSalesforce4.State != ConnectionState.Closed)
                                {
                                    connSalesforce4.Close();
                                    connSalesforce4.Open();
                                }
                                else if (connSalesforce4.State == ConnectionState.Closed) connSalesforce4.Open();
                                int nRowContactUpdatedForOver10K = cmdUpdateContactForOver10kShareAmount.ExecuteNonQuery();
                                if (connSalesforce4.State != ConnectionState.Closed) connSalesforce4.Close();

                                if (nRowContactUpdatedForOver10K == 0)
                                {
                                    MessageBox.Show("No contact has been updated.", "Error");
                                    return;
                                }
                            }
                            else
                            {
                                MessageBox.Show("Incident Total Shared Amount has not been updated.", "Error");
                                return;
                            }
                        }
                        String strSqlQueryForTotalMedBillAmountForIndividualId = "select sum([dbo].[tbl_medbill].[BillAmount]) from [dbo].[tbl_medbill] " +
                                                         "where [dbo].[tbl_medbill].[Individual_Id] = @IndividualId and " +
                                                         "([dbo].[tbl_medbill].[IsDeleted] = 0 or [dbo].[tbl_medbill].[IsDeleted] IS NULL)";

                        SqlCommand cmdQueryForTotalMedBillAmountForIndividualId = new SqlCommand(strSqlQueryForTotalMedBillAmountForIndividualId, connRN5);
                        cmdQueryForTotalMedBillAmountForIndividualId.CommandType = CommandType.Text;

                        cmdQueryForTotalMedBillAmountForIndividualId.Parameters.AddWithValue("@IndividualId", txtIndividualIDMedBill.Text.Trim());

                        if (connRN5.State != ConnectionState.Closed)
                        {
                            connRN5.Close();
                            connRN5.Open();
                        }
                        else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                        Object objTotalMedBillAmountForIndividualId = cmdQueryForTotalMedBillAmountForIndividualId.ExecuteScalar();
                        if (connRN5.State != ConnectionState.Closed) connRN5.Close();

                        Decimal TotalMedBillAmountForIndividualId = 0;
                        if (objTotalMedBillAmountForIndividualId != null) TotalMedBillAmountForIndividualId = Decimal.Parse(objTotalMedBillAmountForIndividualId.ToString());

                        String strSqlUpdateIndividualTotalMedBillAmount = "update [dbo].[contact] set [dbo].[contact].[c4g_Incidents_Total_Amount__c] = @MedBillTotalForIndividual " +
                                                                          "where ([dbo].[contact].[IsDeleted] = 0 or [dbo].[contact].[IsDeleted] Is NULL) and " +
                                                                          "[dbo].[contact].[Individual_ID__c] = @IndividualId";

                        SqlCommand cmdUpdateIndividualTotalMedBillAmount = new SqlCommand(strSqlUpdateIndividualTotalMedBillAmount, connSalesforce4);
                        cmdUpdateIndividualTotalMedBillAmount.CommandType = CommandType.Text;

                        cmdUpdateIndividualTotalMedBillAmount.Parameters.AddWithValue("@MedBillTotalForIndividual", TotalMedBillAmountForIndividualId);
                        cmdUpdateIndividualTotalMedBillAmount.Parameters.AddWithValue("@IndividualId", txtIndividualIDMedBill.Text.Trim());

                        if (connSalesforce4.State == ConnectionState.Open)
                        {
                            connSalesforce4.Close();
                            connSalesforce4.Open();
                        }
                        else if (connSalesforce4.State == ConnectionState.Closed) connSalesforce4.Open();

                        int nIndividualTotalMedBillUpdated = cmdUpdateIndividualTotalMedBillAmount.ExecuteNonQuery();
                        if (connSalesforce4.State == ConnectionState.Open) connSalesforce4.Close();

                        if (nIndividualTotalMedBillUpdated == 1) txtTotalMedBillAmount.Text = TotalMedBillAmountForIndividualId.ToString("C");



                        //////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                        return;
                    }
                    else if (nAffectedRow == 0)
                    {
                        MessageBox.Show("The Medical Bill has not been updated.", "Error");
                        return;
                    }

                    bIsModified = false;
                }
            }
            else if (dlgResult == DialogResult.No)
            {
                return;
            }

            Cursor.Current = Cursors.Default;
        }


        /// <summary>
        /// //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>

        private void btnBrowseNPF_Click(object sender, EventArgs e)
        {
            OpenFileDialog OpenSourceFileDlg = new OpenFileDialog();

            OpenSourceFileDlg.Filter = "PDF Files | *.pdf; | JPG Files | *.jpg; *.jpeg";
            OpenSourceFileDlg.DefaultExt = "pdf";
            OpenSourceFileDlg.RestoreDirectory = true;

            if (OpenSourceFileDlg.ShowDialog() == DialogResult.OK)
            {
                strNPFormFilePathSource = OpenSourceFileDlg.FileName;
                strNPFormFilePathDestination = strDestinationPath + "_NPF_" + DateTime.Now.ToString("MM-dd-yyyy-HH-mm-ss") + "_" + OpenSourceFileDlg.SafeFileName;
                txtNPFFormFilePath.Text = strNPFormFilePathSource;
                btnNPFFormUpload.Enabled = true;
                return;
            }
            else return;
        }

        private void btnViewNPF_Click(object sender, EventArgs e)
        {
            if (chkMedBillNPFReceived.Checked)
            {
                String CaseName = strCaseIdSelected;
                String ContactId = strContactIdSelected;

                String strSqlQueryForNPFForm = "select dbo.tbl_case.NPF_Form_Destination_File_Name from dbo.tbl_case where dbo.tbl_case.Case_Name = @Case_Name and dbo.tbl_case.Contact_ID = @ContactId";

                SqlCommand cmdQueryForNPFForm = new SqlCommand(strSqlQueryForNPFForm, connRN);
                cmdQueryForNPFForm.CommandType = CommandType.Text;

                cmdQueryForNPFForm.Parameters.AddWithValue("@Case_Name", CaseName);
                cmdQueryForNPFForm.Parameters.AddWithValue("@ContactId", ContactId);

                //if (connRN.State == ConnectionState.Closed) connRN.Open();
                if (connRN.State != ConnectionState.Closed)
                {
                    connRN.Close();
                    connRN.Open();
                }
                else if (connRN.State == ConnectionState.Closed) connRN.Open();
                //String NPF_FileName = cmdQueryForNPFForm.ExecuteScalar() as String;
                Object objNPF_FileName = cmdQueryForNPFForm.ExecuteScalar();
                if (connRN.State != ConnectionState.Closed) connRN.Close();

                String NPF_FileName = String.Empty;

                if (objNPF_FileName != null) NPF_FileName = objNPF_FileName.ToString();
                else
                {
                    MessageBox.Show("No NPF Form Destination File Name for Case Name: " + CaseName, "Error", MessageBoxButtons.OK);
                    return;
                }

                if (NPF_FileName != String.Empty)
                {
                    ProcessStartInfo psi = new ProcessStartInfo();
                    psi.FileName = NPF_FileName;

                    Process.Start(psi);
                }
            }
        }

        private void btnViewIB_Click(object sender, EventArgs e)
        {
            if (chkMedBill_IBReceived.Checked)
            {
                String CaseName = strCaseIdSelected;
                String ContactId = strContactIdSelected;

                String strSqlQueryForIBForm = "select dbo.tbl_case.IB_Form_Destination_File_Name from dbo.tbl_case where dbo.tbl_case.Case_Name = @Case_Name and dbo.tbl_case.Contact_ID = @ContactId";

                SqlCommand cmdQueryForIBForm = new SqlCommand(strSqlQueryForIBForm, connRN);
                cmdQueryForIBForm.CommandType = CommandType.Text;

                cmdQueryForIBForm.Parameters.AddWithValue("@Case_Name", CaseName);
                cmdQueryForIBForm.Parameters.AddWithValue("@ContactId", ContactId);

                //if (connRN.State == ConnectionState.Closed) connRN.Open();
                if (connRN.State != ConnectionState.Closed)
                {
                    connRN.Close();
                    connRN.Open();
                }
                else if (connRN.State == ConnectionState.Closed) connRN.Open();
                //String IB_FileName = cmdQueryForIBForm.ExecuteScalar() as String;
                Object objIB_FileName = cmdQueryForIBForm.ExecuteScalar();
                if (connRN.State != ConnectionState.Closed) connRN.Close();

                String IB_FileName = String.Empty;
                if (objIB_FileName != null) IB_FileName = objIB_FileName.ToString();
                else
                {
                    MessageBox.Show("No IB Form Destination File Name for Case Name: " + CaseName, "Error", MessageBoxButtons.OK);
                    return;
                }

                if (IB_FileName != String.Empty)
                {
                    ProcessStartInfo psi = new ProcessStartInfo();
                    psi.FileName = IB_FileName;

                    Process.Start(psi);
                }
            }
        }

        private void btnViewPoP_Click(object sender, EventArgs e)
        {
            if (chkMedBillPOPReceived.Checked)
            {
                String CaseName = strCaseIdSelected;
                String ContactId = strContactIdSelected;

                String strSqlQueryForPOPForm = "select dbo.tbl_case.POP_Form_Destination_File_Name from dbo.tbl_case where dbo.tbl_case.Case_Name = @Case_Name and dbo.tbl_case.Contact_ID = @ContactId";

                SqlCommand cmdQueryForPOPForm = new SqlCommand(strSqlQueryForPOPForm, connRN);
                cmdQueryForPOPForm.CommandType = CommandType.Text;

                cmdQueryForPOPForm.Parameters.AddWithValue("@Case_Name", CaseName);
                cmdQueryForPOPForm.Parameters.AddWithValue("@ContactId", ContactId);

                //if (connRN.State == ConnectionState.Closed) connRN.Open();
                if (connRN.State != ConnectionState.Closed)
                {
                    connRN.Close();
                    connRN.Open();
                }
                else if (connRN.State == ConnectionState.Closed) connRN.Open();
                //String POP_FileName = cmdQueryForPOPForm.ExecuteScalar() as String;
                Object objPOP_FileName = cmdQueryForPOPForm.ExecuteScalar();
                if (connRN.State != ConnectionState.Closed) connRN.Close();

                String POP_FileName = String.Empty;
                if (objPOP_FileName != null) POP_FileName = objPOP_FileName.ToString();
                else
                {
                    MessageBox.Show("No POP Form Destination File Name for Case Name: " + CaseName, "Error", MessageBoxButtons.OK);
                    return;
                }

                if (POP_FileName != String.Empty)
                {
                    ProcessStartInfo psi = new ProcessStartInfo();
                    psi.FileName = POP_FileName;

                    Process.Start(psi);
                }
            }
        }

        private void btnViewMedRecord_Click(object sender, EventArgs e)
        {
            if (chkMedRecordReceived.Checked)
            {
                String CaseName = strCaseIdSelected;
                String ContactId = strContactIdSelected;

                String strSqlQueryForMedRecordForm = "select dbo.tbl_case.MedRec_Form_Destination_File_Name from dbo.tbl_case where dbo.tbl_case.Case_Name = @Case_Name and dbo.tbl_case.Contact_ID = @ContactId";

                SqlCommand cmdQueryForMedRecordForm = new SqlCommand(strSqlQueryForMedRecordForm, connRN);
                cmdQueryForMedRecordForm.CommandType = CommandType.Text;

                cmdQueryForMedRecordForm.Parameters.AddWithValue("@Case_Name", CaseName);
                cmdQueryForMedRecordForm.Parameters.AddWithValue("@ContactId", ContactId);

                //if (connRN.State == ConnectionState.Closed) connRN.Open();
                if (connRN.State != ConnectionState.Closed)
                {
                    connRN.Close();
                    connRN.Open();
                }
                else if (connRN.State == ConnectionState.Closed) connRN.Open();
                //String MedRecord_FileName = cmdQueryForMedRecordForm.ExecuteScalar() as String;
                Object objMedRecord_FileName = cmdQueryForMedRecordForm.ExecuteScalar();
                if (connRN.State != ConnectionState.Closed) connRN.Close();

                String MedRecord_FileName = String.Empty;
                if (objMedRecord_FileName != null) MedRecord_FileName = objMedRecord_FileName.ToString();
                else
                {
                    MessageBox.Show("No Med Rec Form Destination File Name for Case Name: " + CaseName, "Error", MessageBoxButtons.OK);
                    return;
                }

                if (MedRecord_FileName != String.Empty)
                {
                    ProcessStartInfo psi = new ProcessStartInfo();
                    psi.FileName = MedRecord_FileName;

                    Process.Start(psi);
                }
            }
        }

        private void btnViewOtherDoc_Click(object sender, EventArgs e)
        {
            if (chkOtherDocReceived.Checked)
            {
                String CaseName = strCaseIdSelected;
                String ContactId = strContactIdSelected;

                String strSqlQueryForUnknownDocForm = "select dbo.tbl_case.Unknown_Form_Destination_File_Name from dbo.tbl_case where dbo.tbl_case.Case_Name = @Case_Name and dbo.tbl_case.Contact_ID = @ContactId";

                SqlCommand cmdQueryForUnknownDocForm = new SqlCommand(strSqlQueryForUnknownDocForm, connRN);
                cmdQueryForUnknownDocForm.CommandType = CommandType.Text;

                cmdQueryForUnknownDocForm.Parameters.AddWithValue("@Case_Name", CaseName);
                cmdQueryForUnknownDocForm.Parameters.AddWithValue("@ContactId", ContactId);

                //if (connRN.State == ConnectionState.Closed) connRN.Open();
                if (connRN.State != ConnectionState.Closed)
                {
                    connRN.Close();
                    connRN.Open();
                }
                else if (connRN.State == ConnectionState.Closed) connRN.Open();
                //String UnknownDoc_FileName = cmdQueryForUnknownDocForm.ExecuteScalar() as String;
                Object objUnknownDoc_FileName = cmdQueryForUnknownDocForm.ExecuteScalar();
                if (connRN.State != ConnectionState.Closed) connRN.Close();

                String UnknownDoc_FileName = String.Empty;
                if (objUnknownDoc_FileName != null) UnknownDoc_FileName = objUnknownDoc_FileName.ToString();
                else
                {
                    MessageBox.Show("No Unknown Form Destination File Name for Case Name: " + CaseName, "Error", MessageBoxButtons.OK);
                    return;
                }

                if (UnknownDoc_FileName != String.Empty)
                {
                    ProcessStartInfo psi = new ProcessStartInfo();
                    psi.FileName = UnknownDoc_FileName;

                    Process.Start(psi);
                }
            }
        }

        public String MedBillNote(int med_bill_note_id)
        {
            if (med_bill_note_id >= 0)
            {
                String strMedBillNote = String.Empty;

                String strSqlQueryForMedicalNote1Value = "select dbo.tbl_MedBillNoteType.MedBillNoteTypeValue from dbo.tbl_MedBillNoteType " +
                                                         "where dbo.tbl_MedBillNoteType.MedBillNoteTypeId = @MedBillNoteTypeId";

                SqlCommand cmdQueryForMedicalNote1 = new SqlCommand(strSqlQueryForMedicalNote1Value, connRN);
                cmdQueryForMedicalNote1.CommandType = CommandType.Text;

                cmdQueryForMedicalNote1.Parameters.AddWithValue("@MedBillNoteTypeId", med_bill_note_id);

                //if (connRN.State == ConnectionState.Closed) connRN.Open();
                if (connRN.State != ConnectionState.Closed)
                {
                    connRN.Close();
                    connRN.Open();
                }
                else if (connRN.State == ConnectionState.Closed) connRN.Open();
                //strMedBillNote = cmdQueryForMedicalNote1.ExecuteScalar().ToString();
                Object objMedBillNote = cmdQueryForMedicalNote1.ExecuteScalar();
                if (connRN.State != ConnectionState.Closed) connRN.Close();

                if (objMedBillNote != null) strMedBillNote = objMedBillNote.ToString();
                else
                {
                    //MessageBox.Show("No Medical Note Type")
                }

                return strMedBillNote;
            }
            else return String.Empty;
        }

        private void btnMedBillCreationPgUpperCancel_Click(object sender, EventArgs e)
        {

            DialogResult dlgClose = MessageBox.Show("Do you want to close Medical Bill Page?", "Alert", MessageBoxButtons.YesNo);

            if (dlgClose == DialogResult.Yes)
            {
                DialogResult dlgResult = MessageBox.Show("Do you want to save the change?", "Alert", MessageBoxButtons.YesNo);

                if (dlgResult == DialogResult.Yes)
                {
                    String strMedBillNo = txtMedBillNo.Text.Trim();

                    String strSqlQueryForMedBill = "select [dbo].[tbl_medbill].[BillNo] from [dbo].[tbl_medbill] where [dbo].[tbl_medbill].[BillNo] = @MedBillNo";

                    SqlCommand cmdQueryForMedBill = new SqlCommand(strSqlQueryForMedBill, connRN5);
                    cmdQueryForMedBill.Parameters.AddWithValue("@MedBillNo", strMedBillNo);

                    if (connRN5.State != ConnectionState.Closed)
                    {
                        connRN5.Close();
                        connRN5.Open();
                    }
                    else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                    Object ResultMedBillNo = cmdQueryForMedBill.ExecuteScalar();
                    if (connRN5.State != ConnectionState.Closed) connRN5.Close();

                    if (ResultMedBillNo == null)
                    {
                        String strIndividualId = String.Empty;
                        String strCaseId = String.Empty;
                        String strBillStatus = String.Empty;
                        String strIllnessId = String.Empty;
                        String strIncidentId = String.Empty;

                        String strNewMedBillNo = String.Empty;
                        String strMedProvider = String.Empty;
                        String strPrescriptionName = String.Empty;
                        String strPrescriptionNo = String.Empty;
                        String strPrescriptionDescription = String.Empty;

                        if (txtMedBill_Illness.Text.Trim() != String.Empty)
                        {
                            String IllnessNo = txtMedBill_Illness.Text.Trim();

                            String strSqlQueryForIllnessId = "select [dbo].[tbl_illness].[Illness_Id] from [dbo].[tbl_illness] where [dbo].[tbl_illness].[IllnessNo] = @IllnessNo";

                            SqlCommand cmdQueryForIllnessId = new SqlCommand(strSqlQueryForIllnessId, connRN5);
                            cmdQueryForIllnessId.CommandType = CommandType.Text;

                            cmdQueryForIllnessId.Parameters.AddWithValue("@IllnessNo", IllnessNo);

                            if (connRN5.State != ConnectionState.Closed)
                            {
                                connRN5.Close();
                                connRN5.Open();
                            }
                            else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                            Object objIllnessId = cmdQueryForIllnessId.ExecuteScalar();
                            if (connRN5.State != ConnectionState.Closed) connRN5.Close();

                            if (objIllnessId != null) strIllnessId = objIllnessId.ToString();
                            else
                            {
                                MessageBox.Show("No Illness Id for given Illness No", "Error");
                                return;
                            }
                        }

                        if (txtMedBill_Incident.Text.Trim() != String.Empty)
                        {
                            String IncidentNo = txtMedBill_Incident.Text.Trim();

                            String strSqlQueryForIncidentId = "select [dbo].[tbl_incident].[Incident_id] from [dbo].[tbl_incident] where [dbo].[tbl_incident].[IncidentNo] = @IncidentNo";

                            SqlCommand cmdQueryForIncidentId = new SqlCommand(strSqlQueryForIncidentId, connRN5);
                            cmdQueryForIncidentId.CommandType = CommandType.Text;

                            cmdQueryForIncidentId.Parameters.AddWithValue("@IncidentNo", IncidentNo);

                            if (connRN5.State != ConnectionState.Closed)
                            {
                                connRN5.Close();
                                connRN5.Open();
                            }
                            else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                            Object objIncidentId = cmdQueryForIncidentId.ExecuteScalar();
                            if (connRN5.State != ConnectionState.Closed) connRN5.Close();

                            if (objIncidentId != null) strIncidentId = objIncidentId.ToString();
                            else
                            {
                                MessageBox.Show("No Incident Id for given Incident No", "Error");
                                return;
                            }
                        }

                        if (txtIndividualIDMedBill.Text.Trim() != String.Empty) strIndividualId = txtIndividualIDMedBill.Text.Trim();
                        if (txtMedBill_CaseNo.Text.Trim() != String.Empty) strCaseId = txtMedBill_CaseNo.Text.Trim();
                        //if (txtMedicalBillStatus.Text.Trim() != String.Empty) strBillStatus = txtMedicalBillStatus.Text.Trim();

                        if (txtMedBill_Illness.Text.Trim() != String.Empty) strIllnessId = Illness.IllnessId;
                        //if (txtMedBill_Incident.Text.Trim() != String.Empty) strIncidentId = txtMedBill_Incident.Text.Trim();
                        //strIncidentId = Incident.IncidentId;

                        if (txtMedBillNo.Text.Trim() != String.Empty) strNewMedBillNo = txtMedBillNo.Text.Trim();

                        String MedicalProvider = String.Empty;

                        if (txtMedicalProvider.Text.Trim() != String.Empty)
                        {
                            MedicalProvider = txtMedicalProvider.Text.Trim();
                        }

                        String PrescriptionName = String.Empty;

                        if (txtPrescriptionName.Text.Trim() != String.Empty)
                        {
                            PrescriptionName = txtPrescriptionName.Text.Trim();
                        }

                        String PrescriptionNo = String.Empty;

                        if (txtNumberOfMedication.Text.Trim() != String.Empty)
                        {
                            PrescriptionNo = txtNumberOfMedication.Text.Trim();
                        }

                        String PrescriptionDescription = String.Empty;

                        if (txtPrescriptionDescription.Text.Trim() != String.Empty)
                        {
                            PrescriptionDescription = txtPrescriptionDescription.Text.Trim();
                        }


                        int nPatientType = 0;   // default outpatient

                        if (rbOutpatient.Checked) nPatientType = 0;
                        else if (rbInpatient.Checked) nPatientType = 1;

                        //int nSelectedMedNote = cbMedicalBillNote1.SelectedIndex;

                        String strNote = String.Empty;

                        if (comboMedBillType.SelectedItem.ToString() == "Medical Bill")
                        {
                            strNote = txtMedBillNote.Text.Trim();
                        }
                        else if (comboMedBillType.SelectedItem.ToString() == "Prescription")
                        {
                            strNote = txtPrescriptionNote.Text.Trim();
                        }
                        else if (comboMedBillType.SelectedItem.ToString() == "Physical Therapy")
                        {
                            strNote = txtPhysicalTherapyRxNote.Text.Trim();
                        }



                        String strSqlInsertNewMedBill = "insert into dbo.tbl_medbill (IsDeleted, BillNo, MedBillType_Id, CreatedDate, CreatedById, LastModifiedDate, LastModifiedById, " +
                                                        "LastActivityDate, LastViewedDate, LastReferencedDate, Case_Id, Incident_Id, Illness_Id, BillAmount, SettlementTotal, " +
                                                        "Balance, BillDate, TotalSharedAmount, Individual_Id, Contact_Id, MedicalProvider_Id, PendingReason, " +
                                                        "Account_At_Provider, ProviderPhoneNumber, ProviderContactPerson, " +
                                                        "ProposalLetterSentDate, HIPPASentDate, MedicalRecordDate, " +
                                                        "BillStatus, ProofOfPaymentReceivedDate, IneligibleReason, OriginalPrescription, PersonalResponsibilityCredit, " +
                                                        "WellBeingCareTotal, WellBeingCare, DueDate, TotalNumberOfPhysicalTherapy, " +
                                                        "PrescriptionDrugName, PrescriptionNo, PrescriptionDescription, " +
                                                        "PatientTypeId, Note) " +
                                                        "values (@IsDeleted, @BillNo, @MedBillType_Id, @CreatedDate, @CreateById, @LastModifiedDate, @LastModifiedById, " +
                                                        "@LastActivityDate, @LastViewedDate, @LastReferencedDate, @Case_Id, @Incident_Id, @Illness_Id, @BillAmount, @SettlementTotal, " +
                                                        "@Balance, @BillDate, @TotalSharedAmount, @Individual_Id, @Contact_Id, @MedicalProvider_Id, @PendingReason, " +
                                                        "@Account_At_Provider, @ProviderPhoneNo, @ProviderContactPerson, " +
                                                        "@ProposalLetterSentDate, @HIPPASentDate, @MedicalRecordDate, " +
                                                        "@BillStatus, @ProofOfPaymentReceivedDate, @IneligibleReason, @OriginalPrescription, @PersonalResponsibilityCredit, " +
                                                        "@WellBeingCareTotal, @WellBeingCare, @DueDate, @TotalNumberOfPhysicalTherapy, " +
                                                        "@PrescriptionDrugName, @PrescriptionNo, @PrescriptionDescription, " +
                                                        "@PatientTypeId, @Note)";

                        SqlCommand cmdInsertNewMedBill = new SqlCommand(strSqlInsertNewMedBill, connRN5);
                        cmdInsertNewMedBill.CommandType = CommandType.Text;

                        cmdInsertNewMedBill.Parameters.AddWithValue("@IsDeleted", 0);
                        cmdInsertNewMedBill.Parameters.AddWithValue("@BillNo", strNewMedBillNo);
                        cmdInsertNewMedBill.Parameters.AddWithValue("@MedBillType_Id", comboMedBillType.SelectedIndex + 1);
                        cmdInsertNewMedBill.Parameters.AddWithValue("@CreatedDate", DateTime.Today);
                        cmdInsertNewMedBill.Parameters.AddWithValue("@CreateById", nLoggedUserId);
                        cmdInsertNewMedBill.Parameters.AddWithValue("@LastModifiedDate", DateTime.Today);
                        cmdInsertNewMedBill.Parameters.AddWithValue("@LastModifiedById", nLoggedUserId);
                        cmdInsertNewMedBill.Parameters.AddWithValue("@LastActivityDate", DateTime.Today);
                        cmdInsertNewMedBill.Parameters.AddWithValue("@LastViewedDate", DateTime.Today);
                        cmdInsertNewMedBill.Parameters.AddWithValue("@LastReferencedDate", DateTime.Today);
                        cmdInsertNewMedBill.Parameters.AddWithValue("@Case_Id", strCaseId);
                        cmdInsertNewMedBill.Parameters.AddWithValue("@Incident_Id", strIncidentId);
                        cmdInsertNewMedBill.Parameters.AddWithValue("@Illness_Id", strIllnessId);
                        Decimal dBillAmount = 0;
                        Decimal BillAmount = 0;

                        if (Decimal.TryParse(txtMedBillAmount.Text.Trim(), NumberStyles.Currency, new CultureInfo("en-US"), out dBillAmount))
                        {
                            BillAmount = dBillAmount;
                            cmdInsertNewMedBill.Parameters.AddWithValue("@BillAmount", BillAmount);
                        }
                        else
                        {
                            MessageBox.Show("Bill Amount should be currency value.", "Error", MessageBoxButtons.OK);
                            return;
                        }
                        cmdInsertNewMedBill.Parameters.AddWithValue("@SettlementTotal", 0);

                        Decimal dBalance = 0;
                        if (!Decimal.TryParse(txtMedBillAmount.Text.Trim(), NumberStyles.Currency, new CultureInfo("en-US"), out dBalance))
                        {
                            MessageBox.Show("Balance should be currency value.", "Error");
                        }
                        else
                        {
                            cmdInsertNewMedBill.Parameters.AddWithValue("@Balance", Decimal.Parse(txtBalance.Text.Trim(), NumberStyles.Currency, new CultureInfo("en-US")));
                        }

                        cmdInsertNewMedBill.Parameters.AddWithValue("@BillDate", dtpBillDate.Value);

                        Decimal TotalSharedAmount = 0;
                        for (int i = 0; i < gvSettlementsInMedBill.Rows.Count; i++)
                        {
                            if ((gvSettlementsInMedBill["SettlementType", i].Value.ToString() == "CMM Provider Payment") ||
                                (gvSettlementsInMedBill["SettlementType", i].Value.ToString() == "CMM Member Reimbursement"))
                                TotalSharedAmount += Decimal.Parse(gvSettlementsInMedBill["SettlementType", i].Value.ToString(), NumberStyles.Currency, new CultureInfo("en-US"));
                            if (gvSettlementsInMedBill["SettlementType", i].Value.ToString() == "Medical Provider Refund")
                                TotalSharedAmount -= Decimal.Parse(gvSettlementsInMedBill["SettlementType", i].Value.ToString(), NumberStyles.Currency, new CultureInfo("en-US"));
                        }

                        cmdInsertNewMedBill.Parameters.AddWithValue("@TotalSharedAmount", TotalSharedAmount);
                        cmdInsertNewMedBill.Parameters.AddWithValue("@Individual_Id", strIndividualId);
                        cmdInsertNewMedBill.Parameters.AddWithValue("@Contact_Id", strIndividualId);
                        foreach (MedicalProviderInfo info in lstMedicalProvider)
                        {
                            if (info.Name.Trim() == txtMedicalProvider.Text.Trim())
                            {
                                cmdInsertNewMedBill.Parameters.AddWithValue("@MedicalProvider_Id", info.ID);
                                break;
                            }
                        }

                        cmdInsertNewMedBill.Parameters.AddWithValue("@Account_At_Provider", txtMedBillAccountNoAtProvider.Text.Trim());
                        cmdInsertNewMedBill.Parameters.AddWithValue("@ProviderPhoneNo", txtMedProviderPhoneNo.Text.Trim());
                        cmdInsertNewMedBill.Parameters.AddWithValue("@ProviderContactPerson", txtProviderContactPerson.Text.Trim());
                        cmdInsertNewMedBill.Parameters.AddWithValue("@ProposalLetterSentDate", dtpProposalLetterSentDate.Value);
                        cmdInsertNewMedBill.Parameters.AddWithValue("@HIPPASentDate", dtpHippaSentDate.Value);
                        cmdInsertNewMedBill.Parameters.AddWithValue("@MedicalRecordDate", dtpMedicalRecordDate.Value);
                        cmdInsertNewMedBill.Parameters.AddWithValue("@BillStatus", comboMedBillStatus.SelectedIndex);
                        cmdInsertNewMedBill.Parameters.AddWithValue("@ProofOfPaymentReceivedDate", DateTime.Today);
                        cmdInsertNewMedBill.Parameters.AddWithValue("@OriginalPrescription", DBNull.Value);
                        cmdInsertNewMedBill.Parameters.AddWithValue("@PersonalResponsibilityCredit", 500);
                        cmdInsertNewMedBill.Parameters.AddWithValue("@WellBeingCareTotal", 0);
                        cmdInsertNewMedBill.Parameters.AddWithValue("@WellBeingCare", 0);
                        //cmdInsertNewMedBill.Parameters.AddWithValue("@Memo", DBNull.Value);
                        cmdInsertNewMedBill.Parameters.AddWithValue("@DueDate", DateTime.Today);

                        if (comboMedBillType.SelectedIndex == 0)        // Medical Bill Type : Medical Bill
                        {
                            cmdInsertNewMedBill.Parameters.AddWithValue("@PrescriptionDrugName", String.Empty);
                            cmdInsertNewMedBill.Parameters.AddWithValue("@PrescriptionNo", String.Empty);
                            cmdInsertNewMedBill.Parameters.AddWithValue("@PrescriptionDescription", String.Empty);

                            cmdInsertNewMedBill.Parameters.AddWithValue("@TotalNumberOfPhysicalTherapy", 0);

                            cmdInsertNewMedBill.Parameters.AddWithValue("@PatientTypeId", nPatientType);
                            if (comboPendingReason.SelectedIndex == -1) cmdInsertNewMedBill.Parameters.AddWithValue("@PendingReason", 0);
                            else cmdInsertNewMedBill.Parameters.AddWithValue("@PendingReason", comboPendingReason.SelectedIndex);
                            if (comboIneligibleReason.SelectedIndex == -1) cmdInsertNewMedBill.Parameters.AddWithValue("@IneligibleReason", 0);
                            else cmdInsertNewMedBill.Parameters.AddWithValue("@IneligibleReason", comboIneligibleReason.SelectedIndex);

                            cmdInsertNewMedBill.Parameters.AddWithValue("@Note", strNote);
                        }
                        else if (comboMedBillType.SelectedIndex == 1)   // Medical Bill Type : Prescription
                        {
                            cmdInsertNewMedBill.Parameters.AddWithValue("@PatientTypeId", DBNull.Value);
                            cmdInsertNewMedBill.Parameters.AddWithValue("@PendingReason", 0);
                            cmdInsertNewMedBill.Parameters.AddWithValue("@IneligibleReason", 0);

                            cmdInsertNewMedBill.Parameters.AddWithValue("@TotalNumberOfPhysicalTherapy", 0);

                            cmdInsertNewMedBill.Parameters.AddWithValue("@PrescriptionDrugName", txtPrescriptionName.Text.Trim());
                            cmdInsertNewMedBill.Parameters.AddWithValue("@PrescriptionNo", txtNumberOfMedication.Text.Trim());
                            cmdInsertNewMedBill.Parameters.AddWithValue("@PrescriptionDescription", txtPrescriptionDescription.Text.Trim());
                            cmdInsertNewMedBill.Parameters.AddWithValue("@Note", strNote);
                        }
                        else if (comboMedBillType.SelectedIndex == 2)   // Medical Bill Type : Physical Therapy
                        {
                            cmdInsertNewMedBill.Parameters.AddWithValue("@PrescriptionDrugName", String.Empty);
                            cmdInsertNewMedBill.Parameters.AddWithValue("@PrescriptionNo", String.Empty);
                            cmdInsertNewMedBill.Parameters.AddWithValue("@PrescriptionDescription", String.Empty);

                            cmdInsertNewMedBill.Parameters.AddWithValue("@PatientTypeId", DBNull.Value);
                            cmdInsertNewMedBill.Parameters.AddWithValue("@PendingReason", 0);
                            cmdInsertNewMedBill.Parameters.AddWithValue("@IneligibleReason", 0);

                            int nNumberOfPhysicalTherapy = 0;
                            short result = 0;
                            if (Int16.TryParse(txtNumPhysicalTherapy.Text.Trim(), out result))
                            {
                                nNumberOfPhysicalTherapy = result;
                                cmdInsertNewMedBill.Parameters.AddWithValue("@TotalNumberOfPhysicalTherapy", nNumberOfPhysicalTherapy);
                            }
                            else MessageBox.Show("Please enter a positive integer in Number of Physical Therapy Text Box.", "Alert");

                            cmdInsertNewMedBill.Parameters.AddWithValue("@Note", strNote);
                        }

                        //if (connRN.State == ConnectionState.Closed) connRN.Open();
                        if (connRN5.State != ConnectionState.Closed)
                        {
                            connRN5.Close();
                            connRN5.Open();
                        }
                        else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                        int nRowInserted = cmdInsertNewMedBill.ExecuteNonQuery();
                        if (connRN5.State != ConnectionState.Closed) connRN5.Close();

                        if (nRowInserted == 1)
                        {
                            MessageBox.Show("The Medical Bill has been saved.", "Information");
                        }
                        else if (nRowInserted == 0)
                        {
                            MessageBox.Show("The Medical Bill has not been saved.", "Error");
                        }

                        bIsModified = false;

                        //tbCMMManager.TabPages.Remove(tbpgMedicalBill);
                        //tbCMMManager.SelectedTab = tbCMMManager.TabPages["tbpgCreateCase"];

                    }
                    else if (ResultMedBillNo.ToString() == strMedBillNo)
                    {
                        // update the med bill
                        String strIllnessId = String.Empty;
                        String strIncidentId = String.Empty;

                        String MedBillNo = txtMedBillNo.Text.Trim();
                        String IndividualId = txtIndividualIDMedBill.Text.Trim();
                        strIncidentId = Incident.IncidentId;


                        if (txtMedBill_Illness.Text.Trim() != String.Empty)
                        {
                            String IllnessNo = txtMedBill_Illness.Text.Trim();

                            String strSqlQueryForIllnessId = "select [dbo].[tbl_illness].[Illness_Id] from [dbo].[tbl_illness] where [dbo].[tbl_illness].[IllnessNo] = @IllnessNo";

                            SqlCommand cmdQueryForIllnessId = new SqlCommand(strSqlQueryForIllnessId, connRN5);
                            cmdQueryForIllnessId.CommandType = CommandType.Text;

                            cmdQueryForIllnessId.Parameters.AddWithValue("@IllnessNo", IllnessNo);

                            if (connRN5.State != ConnectionState.Closed)
                            {
                                connRN5.Close();
                                connRN5.Open();
                            }
                            else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                            Object objIllnessId = cmdQueryForIllnessId.ExecuteScalar();
                            if (connRN5.State != ConnectionState.Closed) connRN5.Close();

                            if (objIllnessId != null) strIllnessId = objIllnessId.ToString();
                            else
                            {
                                MessageBox.Show("No Illness Id for given Illness No", "Error");
                                return;
                            }
                        }

                        if (txtMedBill_Incident.Text.Trim() != String.Empty)
                        {
                            String IncidentNo = txtMedBill_Incident.Text.Trim();

                            String strSqlQueryForIncidentId = "select [dbo].[tbl_incident].[Incident_id] from [dbo].[tbl_incident] where [dbo].[tbl_incident].[IncidentNo] = @IncidentNo";

                            SqlCommand cmdQueryForIncidentId = new SqlCommand(strSqlQueryForIncidentId, connRN5);
                            cmdQueryForIncidentId.CommandType = CommandType.Text;

                            cmdQueryForIncidentId.Parameters.AddWithValue("@IncidentNo", IncidentNo);

                            if (connRN5.State != ConnectionState.Closed)
                            {
                                connRN5.Close();
                                connRN5.Open();
                            }
                            else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                            Object objIncidentId = cmdQueryForIncidentId.ExecuteScalar();
                            if (connRN5.State != ConnectionState.Closed) connRN5.Close();

                            if (objIncidentId != null) strIncidentId = objIncidentId.ToString();
                            else
                            {
                                MessageBox.Show("No Incident Id for given Incident No", "Error");
                                return;
                            }
                        }

                        //String strSqlQueryForIllnessId = "select [dbo].[tbl_illness].[Illness_Id] from [dbo].[tbl_illness] " +
                        //            "where [dbo].[tbl_illness].[Individual_Id] = @IndividualId and [dbo].[tbl_illness].[IllnessNo] = @IllnessNo";

                        //SqlCommand cmdQueryForIllnessId = new SqlCommand(strSqlQueryForIllnessId, connRN);
                        //cmdQueryForIllnessId.CommandType = CommandType.Text;

                        //cmdQueryForIllnessId.Parameters.AddWithValue("@IndividualId", IndividualId);
                        //cmdQueryForIllnessId.Parameters.AddWithValue("@IllnessNo", txtMedBill_Illness.Text.Trim());

                        ////if (connRN.State == ConnectionState.Closed) connRN.Open();
                        //if (connRN.State != ConnectionState.Closed)
                        //{
                        //    connRN.Close();
                        //    connRN.Open();
                        //}
                        //else if (connRN.State == ConnectionState.Closed) connRN.Open();
                        ////int nIllnessId = Int32.Parse(cmdQueryForIllnessId.ExecuteScalar().ToString());
                        //Object objIllnessId = cmdQueryForIllnessId.ExecuteScalar();
                        //if (connRN.State != ConnectionState.Closed) connRN.Close();

                        //int nIllnessId = 0;
                        //int nIllnessIdResult = 0;
                        //if (objIllnessId != null)
                        //{
                        //    if (Int32.TryParse(objIllnessId.ToString(), NumberStyles.Integer, new CultureInfo("en-US"), out nIllnessIdResult)) nIllnessId = nIllnessIdResult;
                        //}
                        //else
                        //{
                        //    MessageBox.Show("No Illness Id for Illness No: " + txtMedBill_Illness.Text.Trim(), "Error", MessageBoxButtons.OK);
                        //    return;
                        //}

                        // Get medical provider id
                        //String strSqlQueryForMedicalProviderId = "select [dbo].[tbl_MedicalProvider].[ID] from [dbo].[tbl_MedicalProvider] where [dbo].[tbl_MedicalProvider].[Name] = @MedicalProviderName";

                        //SqlCommand cmdQueryForMedicalProviderId = new SqlCommand(strSqlQueryForMedicalProviderId, connRN5);
                        //cmdQueryForMedicalProviderId.CommandType = CommandType.Text;

                        //cmdQueryForMedicalProviderId.Parameters.AddWithValue("@MedicalProviderName", txtMedicalProvider.Text.Trim());

                        ////if (connRN.State == ConnectionState.Closed) connRN.Open();
                        //if (connRN5.State != ConnectionState.Closed)
                        //{
                        //    connRN5.Close();
                        //    connRN5.Open();
                        //}
                        //else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                        ////String MedicalProviderId = cmdQueryForMedicalProviderId.ExecuteScalar().ToString();
                        //Object objMedicalProviderId = cmdQueryForMedicalProviderId.ExecuteScalar();
                        //if (connRN5.State != ConnectionState.Closed) connRN5.Close();

                        String strSqlQueryForMedicalProviderId = "select [dbo].[account].[Id] from [dbo].[account] where [dbo].[account].[Name] = @MedicalProviderName";

                        SqlCommand cmdQueryForMedicalProviderId = new SqlCommand(strSqlQueryForMedicalProviderId, connSalesforce2);
                        cmdQueryForMedicalProviderId.CommandType = CommandType.Text;

                        cmdQueryForMedicalProviderId.Parameters.AddWithValue("@MedicalProviderName", txtMedicalProvider.Text.Trim());

                        if (connSalesforce2.State != ConnectionState.Closed)
                        {
                            connSalesforce2.Close();
                            connSalesforce2.Open();
                        }
                        else if (connSalesforce2.State == ConnectionState.Closed) connSalesforce2.Open();
                        Object objMedicalProviderId = cmdQueryForMedicalProviderId.ExecuteScalar();
                        if (connSalesforce2.State == ConnectionState.Open) connSalesforce2.Close();

                        String MedicalProviderId = String.Empty;
                        if (objMedicalProviderId != null) MedicalProviderId = objMedicalProviderId.ToString();
                        else
                        {
                            MessageBox.Show("No Medical Provider Id for Medical Provider Name: " + txtMedicalProvider.Text.Trim(), "Error", MessageBoxButtons.OK);
                            return;
                        }

                        int nPatientType = 0;   // default outpatient

                        if (rbOutpatient.Checked) nPatientType = 0;
                        else if (rbInpatient.Checked) nPatientType = 1;

                        String strNote = String.Empty;

                        if (comboMedBillType.SelectedItem.ToString() == "Medical Bill")
                        {
                            strNote = txtMedBillNote.Text.Trim();
                        }
                        else if (comboMedBillType.SelectedItem.ToString() == "Prescription")
                        {
                            strNote = txtPrescriptionNote.Text.Trim();
                        }
                        else if (comboMedBillType.SelectedItem.ToString() == "Physical Therapy")
                        {
                            strNote = txtPhysicalTherapyRxNote.Text.Trim();
                        }

                        // Update the Medical Bill
                        String strSqlUpdateMedBill = "update [dbo].[tbl_medbill] set [dbo].[tbl_medbill].[LastModifiedDate] = @NewLastModifiedDate, [dbo].[tbl_medbill].[LastModifiedById] = @NewLastModifiedById, " +
                                                         "[dbo].[tbl_medbill].[Case_Id] = @NewCaseId, [dbo].[tbl_medbill].[Incident_Id] = @NewIncidentId, [dbo].[tbl_medbill].[Illness_Id] = @NewIllnessId, " +
                                                         "[dbo].[tbl_medbill].[BillAmount] = @NewBillAmount, [dbo].[tbl_medbill].[MedBillType_Id] = @NewMedBillType_Id, " +
                                                         "[dbo].[tbl_medbill].[SettlementTotal] = @NewSettlementTotal, [dbo].[tbl_medbill].[Balance] = @NewBalance, " +
                                                         "[dbo].[tbl_medbill].[BillDate] = @NewBillDate, [dbo].[tbl_medbill].[DueDate] = @NewDueDate, [dbo].[tbl_medbill].[TotalSharedAmount] = @NewTotalSharedAmount, " +
                                                         "[dbo].[tbl_medbill].[Guarantor] = @NewGuarantor, " +
                                                         "[dbo].[tbl_medbill].[MedicalProvider_Id] = @NewMedicalProviderId, " +
                                                         "[dbo].[tbl_medbill].[Account_At_Provider] = @NewAccountAtProvider, " +
                                                         "[dbo].[tbl_medbill].[ProviderPhoneNumber] = @NewProviderPhoneNo, " +
                                                         "[dbo].[tbl_medbill].[ProviderContactPerson] = @NewProviderContactPerson, " +
                                                         "[dbo].[tbl_medbill].[ProposalLetterSentDate] = @NewProposalLetterSentDate, " +
                                                         "[dbo].[tbl_medbill].[HIPPASentDate] = @NewHIPPASentDate, " +
                                                         "[dbo].[tbl_medbill].[MedicalRecordDate] = @NewMedicalRecordDate, " +
                                                         "[dbo].[tbl_medbill].[PrescriptionDrugName] = @NewPrescriptionDrugName, [dbo].[tbl_medbill].[PrescriptionNo] = @NewPrescriptionNo, " +
                                                         "[dbo].[tbl_medbill].[PrescriptionDescription] = @NewPrescriptionDescription, " +
                                                         "[dbo].[tbl_medbill].[TotalNumberOfPhysicalTherapy] = @NewTotalNumberOfPhysicalTherapy, " +
                                                         "[dbo].[tbl_medbill].[PatientTypeId] = @NewPatientTypeId, " +
                                                         "[dbo].[tbl_medbill].[Note] = @Note, " +
                                                         "[dbo].[tbl_medbill].[WellBeingCareTotal] = @NewWellBeingCareTotal, [dbo].[tbl_medbill].[WellBeingCare] = @NewWellBeingCare, " +
                                                         "[dbo].[tbl_medbill].[IneligibleReason] = @NewIneligibleReason, [dbo].[tbl_medbill].[PendingReason] = @NewPendingReason, " +
                                                         "[dbo].[tbl_medbill].[OriginalPrescription] = @NewOriginalPrescription " +
                                                         "where [dbo].[tbl_medbill].[BillNo] = @MedBillNo and [dbo].[tbl_medbill].[Contact_Id] = @IndividualId";

                        SqlCommand cmdUpdateMedBill = new SqlCommand(strSqlUpdateMedBill, connRN5);
                        cmdUpdateMedBill.CommandType = CommandType.Text;

                        cmdUpdateMedBill.Parameters.AddWithValue("@NewLastModifiedDate", DateTime.Today.ToString("MM/dd/yyyy"));
                        cmdUpdateMedBill.Parameters.AddWithValue("@NewLastModifiedById", nLoggedUserId);
                        cmdUpdateMedBill.Parameters.AddWithValue("@NewCaseId", txtMedBill_CaseNo.Text.Trim());
                        cmdUpdateMedBill.Parameters.AddWithValue("@NewIncidentId", strIncidentId);
                        cmdUpdateMedBill.Parameters.AddWithValue("@NewIllnessId", strIllnessId);
                        Decimal resultBillAmount = 0;
                        Decimal BillAmount = 0;
                        if (Decimal.TryParse(txtMedBillAmount.Text.Trim(), NumberStyles.Currency, new CultureInfo("en-US"), out resultBillAmount))
                        {
                            BillAmount = resultBillAmount;
                            cmdUpdateMedBill.Parameters.AddWithValue("@NewBillAmount", BillAmount);
                        }
                        else
                        {
                            MessageBox.Show("Invalid Bill Amount", "Error", MessageBoxButtons.OK);
                            return;
                        }
                        //cmdUpdateMedBill.Parameters.AddWithValue("@NewBillAmount", Decimal.Parse(txtMedBillAmount.Text.Substring(1).Trim()));
                        cmdUpdateMedBill.Parameters.AddWithValue("@NewMedBillType_Id", comboMedBillType.SelectedIndex + 1);
                        cmdUpdateMedBill.Parameters.AddWithValue("@NewSettlementTotal", 0);
                        cmdUpdateMedBill.Parameters.AddWithValue("@NewBalance", 0);
                        cmdUpdateMedBill.Parameters.AddWithValue("@NewBillDate", dtpBillDate.Value);
                        cmdUpdateMedBill.Parameters.AddWithValue("@NewDueDate", dtpDueDate.Value);
                        cmdUpdateMedBill.Parameters.AddWithValue("@NewTotalSharedAmount", 0);
                        cmdUpdateMedBill.Parameters.AddWithValue("@NewGuarantor", txtMedBillGuarantor.Text.Trim());
                        cmdUpdateMedBill.Parameters.AddWithValue("@NewMedicalProviderId", MedicalProviderId);
                        cmdUpdateMedBill.Parameters.AddWithValue("@NewAccountAtProvider", txtMedBillAccountNoAtProvider.Text.Trim());
                        cmdUpdateMedBill.Parameters.AddWithValue("@NewProviderPhoneNo", txtMedProviderPhoneNo.Text.Trim());
                        cmdUpdateMedBill.Parameters.AddWithValue("@NewProviderContactPerson", txtProviderContactPerson.Text.Trim());
                        cmdUpdateMedBill.Parameters.AddWithValue("@NewProposalLetterSentDate", dtpProposalLetterSentDate.Value);
                        cmdUpdateMedBill.Parameters.AddWithValue("@NewHIPPASentDate", dtpHippaSentDate.Value);
                        cmdUpdateMedBill.Parameters.AddWithValue("@NewMedicalRecordDate", dtpMedicalRecordDate.Value);

                        if (comboMedBillType.SelectedIndex == 0)        // Medical Bill Type - Medical Bill
                        {
                            cmdUpdateMedBill.Parameters.AddWithValue("@NewPrescriptionDrugName", String.Empty);
                            cmdUpdateMedBill.Parameters.AddWithValue("@NewPrescriptionNo", String.Empty);
                            cmdUpdateMedBill.Parameters.AddWithValue("@NewPrescriptionDescription", String.Empty);

                            cmdUpdateMedBill.Parameters.AddWithValue("@NewTotalNumberOfPhysicalTherapy", DBNull.Value);

                            cmdUpdateMedBill.Parameters.AddWithValue("@NewPatientTypeId", nPatientType);
                            if (comboPendingReason.SelectedIndex == -1) cmdUpdateMedBill.Parameters.AddWithValue("@NewPendingReason", 0);
                            else cmdUpdateMedBill.Parameters.AddWithValue("@NewPendingReason", comboPendingReason.SelectedIndex);
                            if (comboIneligibleReason.SelectedIndex == -1) cmdUpdateMedBill.Parameters.AddWithValue("@NewIneligibleReason", 0);
                            else cmdUpdateMedBill.Parameters.AddWithValue("@NewIneligibleReason", comboIneligibleReason.SelectedIndex);

                            cmdUpdateMedBill.Parameters.AddWithValue("@Note", strNote);

                        }
                        if (comboMedBillType.SelectedIndex == 1)        // Medical Bill Type - Prescription
                        {
                            cmdUpdateMedBill.Parameters.AddWithValue("@NewPatientTypeId", DBNull.Value);
                            cmdUpdateMedBill.Parameters.AddWithValue("@NewPendingReason", 0);
                            cmdUpdateMedBill.Parameters.AddWithValue("@NewIneligibleReason", 0);

                            cmdUpdateMedBill.Parameters.AddWithValue("@NewTotalNumberOfPhysicalTherapy", 0);

                            cmdUpdateMedBill.Parameters.AddWithValue("@NewPrescriptionDrugName", txtPrescriptionName.Text.Trim());
                            cmdUpdateMedBill.Parameters.AddWithValue("@NewPrescriptionNo", txtNumberOfMedication.Text.Trim());
                            cmdUpdateMedBill.Parameters.AddWithValue("@NewPrescriptionDescription", txtPrescriptionDescription.Text.Trim());

                            cmdUpdateMedBill.Parameters.AddWithValue("@Note", strNote);
                        }
                        if (comboMedBillType.SelectedIndex == 2)        // Medical Bill Type - Physical Therapy
                        {
                            cmdUpdateMedBill.Parameters.AddWithValue("@NewPrescriptionDrugName", String.Empty);
                            cmdUpdateMedBill.Parameters.AddWithValue("@NewPrescriptionNo", String.Empty);
                            cmdUpdateMedBill.Parameters.AddWithValue("@NewPrescriptionDescription", String.Empty);

                            cmdUpdateMedBill.Parameters.AddWithValue("@NewPatientTypeId", DBNull.Value);
                            cmdUpdateMedBill.Parameters.AddWithValue("@NewPendingReason", 0);
                            cmdUpdateMedBill.Parameters.AddWithValue("@NewIneligibleReason", 0);

                            int nNumberOfPhysicalTherapy = 0;
                            short result = 0;
                            if (Int16.TryParse(txtNumPhysicalTherapy.Text.Trim(), out result))
                            {
                                nNumberOfPhysicalTherapy = result;
                                cmdUpdateMedBill.Parameters.AddWithValue("@NewTotalNumberOfPhysicalTherapy", nNumberOfPhysicalTherapy);
                            }
                            else MessageBox.Show("Please enter a positive integer in Number of Physical Therapy Text Box.", "Alert");

                            cmdUpdateMedBill.Parameters.AddWithValue("@Note", strNote);
                        }


                        cmdUpdateMedBill.Parameters.AddWithValue("@NewWellBeingCareTotal", 0);
                        cmdUpdateMedBill.Parameters.AddWithValue("@NewWellBeingCare", 0);
                        cmdUpdateMedBill.Parameters.AddWithValue("@NewOriginalPrescription", String.Empty);
                        cmdUpdateMedBill.Parameters.AddWithValue("@MedBillNo", MedBillNo);
                        cmdUpdateMedBill.Parameters.AddWithValue("@IndividualId", IndividualId);

                        //if (connRN.State == ConnectionState.Closed) connRN.Open();
                        if (connRN5.State != ConnectionState.Closed)
                        {
                            connRN5.Close();
                            connRN5.Open();
                        }
                        else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                        int nAffectedRow = cmdUpdateMedBill.ExecuteNonQuery();
                        if (connRN5.State != ConnectionState.Closed) connRN5.Close();

                        if (nAffectedRow == 1)
                        {
                            MessageBox.Show("The Medical Bill has been updated.", "Information");
                        }
                        else if (nAffectedRow == 0)
                        {
                            MessageBox.Show("The Medical Bill has not been updated.", "Error");
                        }

                        bIsModified = false;

                        //tbCMMManager.TabPages.Remove(tbpgMedicalBill);
                        //tbCMMManager.SelectedIndex = 4;

                    }

                    tbCMMManager.TabPages.Remove(tbpgMedicalBill);
                    tbCMMManager.SelectedIndex = 4;
                }
                else if (dlgResult == DialogResult.No)
                {
                    tbCMMManager.TabPages.Remove(tbpgMedicalBill);
                    tbCMMManager.SelectedIndex = 4;
                    return;
                }
                //else if (dlgResult == DialogResult.Cancel)
                //{
                //    return;
                //}
            }
            else return;
        }

        //private void btnNewMedBill_Click(object sender, EventArgs e)
        //{

        //    int nRowSelected;
        //    String strCaseNameSelected = String.Empty;
        //    String strIndividualId = txtIndividualID.Text.Trim();
        //    String strPatientLastName = txtLastName.Text.Trim();
        //    String strPatientFirstName = txtFirstName.Text.Trim();
        //    String strPatientMiddleName = txtMiddleName.Text.Trim();
        //    String strDateOfBirth = txtDateOfBirth.Text.Trim();
        //    String strSSN = txtIndividualSSN.Text.Trim();
        //    String strStreetAddr = txtStreetAddress1.Text.Trim();
        //    String strCity = txtCity1.Text.Trim();
        //    String strState = txtState1.Text.Trim();
        //    String strZip = txtZip1.Text.Trim();


        //    if (gvCaseViewCaseHistory.Rows.Count > 0)
        //    {
        //        nRowSelected = gvCaseViewCaseHistory.CurrentCell.RowIndex;

        //        txtIndividualIDMedBill.Text = strIndividualId.Trim();

        //        if (strPatientMiddleName != String.Empty) txtPatientNameMedBill.Text = strPatientLastName + ", " + strPatientFirstName + " " + strPatientMiddleName;
        //        else txtPatientNameMedBill.Text = strPatientLastName + ", " + strPatientFirstName;

        //        txtMedBillDOB.Text = strDateOfBirth;
        //        txtMedBillSSN.Text = strSSN;
        //        txtMedBillAddress.Text = strStreetAddr + ", " + strCity + ", " + strState + " " + strZip;

        //        strCaseNameSelected = gvCaseViewCaseHistory["CaseName", nRowSelected].Value.ToString().Trim();
        //        strCaseIdSelected = strCaseNameSelected;
        //        strContactIdSelected = gvCaseViewCaseHistory["Individual_Id", nRowSelected].Value.ToString().Trim();

        //        strCaseIdForIllness = strCaseNameSelected;
        //        txtMedBill_CaseNo.Text = strCaseNameSelected;
        //        txtMedicalBillStatus.Text = "Pending Status";


        //        String strSqlQueryForCase = "select dbo.tbl_case.Case_Name, dbo.tbl_case.[NPF_Form], dbo.tbl_case.[NPF_Form_File_Name], dbo.tbl_case.[NPF_Receiv_Date], " +
        //                                    "dbo.tbl_case.[IB_Form], dbo.tbl_case.[IB_Form_File_Name], dbo.tbl_case.[IB_Receiv_Date], " +
        //                                    "dbo.tbl_case.[POP_Form], dbo.tbl_case.[POP_Form_File_Name], dbo.tbl_case.[POP_Receiv_Date], " +
        //                                    "dbo.tbl_case.[MedRec_Form], dbo.tbl_case.[MedRec_Form_File_Name], dbo.tbl_case.[MedRec_Receiv_Date], " +
        //                                    "dbo.tbl_case.[Unknown_Form], dbo.tbl_case.[Unknown_Form_File_Name], dbo.tbl_case.[Unknown_Receiv_Date] " +
        //                                    "from dbo.tbl_case where Case_Name = @CaseId";

        //        SqlCommand cmdQueryForDocumentReceivedDate = new SqlCommand(strSqlQueryForCase, connRN);
        //        cmdQueryForDocumentReceivedDate.CommandType = CommandType.Text;

        //        cmdQueryForDocumentReceivedDate.Parameters.AddWithValue("@CaseId", strCaseNameSelected);

        //        connRN.Open();
        //        SqlDataReader rdrDocsReceivedDate = cmdQueryForDocumentReceivedDate.ExecuteReader();

        //        if (rdrDocsReceivedDate.HasRows)
        //        {
        //            rdrDocsReceivedDate.Read();

        //            if (rdrDocsReceivedDate.GetBoolean(1) == true)
        //            {
        //                chkMedBillNPFReceived.Checked = true;
        //                dtpMedBillNPF.Format = DateTimePickerFormat.Short;
        //                dtpMedBillNPF.Value = rdrDocsReceivedDate.GetDateTime(3);
        //                btnViewNPF.Enabled = true;
        //            }
        //            else
        //            {
        //                dtpMedBillNPF.Format = DateTimePickerFormat.Custom;
        //                dtpMedBillNPF.CustomFormat = " ";
        //                btnViewNPF.Enabled = false;
        //            }

        //            chkMedBillNPFReceived.Enabled = false;

        //            if (rdrDocsReceivedDate.GetBoolean(4) == true)
        //            {
        //                chkMedBill_IBReceived.Checked = true;
        //                dtpMedBill_IB.Format = DateTimePickerFormat.Short;
        //                dtpMedBill_IB.Value = rdrDocsReceivedDate.GetDateTime(6);
        //                btnViewIB.Enabled = true;
        //            }
        //            else
        //            {
        //                dtpMedBill_IB.Format = DateTimePickerFormat.Custom;
        //                dtpMedBill_IB.CustomFormat = " ";
        //                btnViewIB.Enabled = false;
        //            }

        //            chkMedBill_IBReceived.Enabled = false;

        //            if (rdrDocsReceivedDate.GetBoolean(7) == true)
        //            {
        //                chkMedBillPOPReceived.Checked = true;
        //                dtpMedBillPOP.Format = DateTimePickerFormat.Short;
        //                dtpMedBillPOP.Value = rdrDocsReceivedDate.GetDateTime(9);
        //                btnViewPoP.Enabled = true;
        //            }
        //            else
        //            {
        //                dtpMedBillPOP.Format = DateTimePickerFormat.Custom;
        //                dtpMedBillPOP.CustomFormat = " ";
        //                btnViewPoP.Enabled = false;
        //            }

        //            chkMedBillPOPReceived.Enabled = false;

        //            if (rdrDocsReceivedDate.GetBoolean(10) == true)
        //            {
        //                chkMedRecordReceived.Checked = true;
        //                dtpMedBillMedRecord.Format = DateTimePickerFormat.Short;
        //                dtpMedBillMedRecord.Value = rdrDocsReceivedDate.GetDateTime(12);
        //                btnViewMedRecord.Enabled = true;
        //            }
        //            else
        //            {
        //                dtpMedBillMedRecord.Format = DateTimePickerFormat.Custom;
        //                dtpMedBillMedRecord.CustomFormat = " ";
        //                btnViewMedRecord.Enabled = false;
        //            }

        //            chkMedRecordReceived.Enabled = false;

        //            if (rdrDocsReceivedDate.GetBoolean(13) == true)
        //            {
        //                chkOtherDocReceived.Checked = true;
        //                dtpMedBillOtherDoc.Format = DateTimePickerFormat.Short;
        //                dtpMedBillOtherDoc.Value = rdrDocsReceivedDate.GetDateTime(15);
        //                btnViewOtherDoc.Enabled = true;
        //            }
        //            else
        //            {
        //                dtpMedBillOtherDoc.Format = DateTimePickerFormat.Custom;
        //                dtpMedBillOtherDoc.CustomFormat = " ";
        //                btnViewOtherDoc.Enabled = false;
        //            }

        //            chkOtherDocReceived.Enabled = false;

        //        }
        //        connRN.Close();

        //        ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

        //        String strQueryForICD10Codes = "select dbo.[ICD10 Code].ID, dbo.[ICD10 Code].ICD10_CODE__C, dbo.[ICD10 Code].Name from [dbo].[ICD10 Code]";

        //        SqlCommand cmdQueryForICD10Codes = new SqlCommand(strQueryForICD10Codes, connSalesforce);

        //        cmdQueryForICD10Codes.CommandType = CommandType.Text;
        //        cmdQueryForICD10Codes.CommandText = strQueryForICD10Codes;

        //        connSalesforce.Open();
        //        SqlDataReader rdrICD10Codes = cmdQueryForICD10Codes.ExecuteReader();


        //        lstICD10CodeInfo.Clear();

        //        if (rdrICD10Codes.HasRows)
        //        {
        //            while (rdrICD10Codes.Read())
        //            {
        //                lstICD10CodeInfo.Add(new ICD10CodeInfo { Id = rdrICD10Codes.GetString(0), ICD10Code = rdrICD10Codes.GetString(1), Name = rdrICD10Codes.GetString(2) });
        //            }
        //        }

        //        connSalesforce.Close();

        //        var srcICD10Codes = new AutoCompleteStringCollection();

        //        for (int i = 0; i < lstICD10CodeInfo.Count; i++)
        //        {
        //            srcICD10Codes.Add(lstICD10CodeInfo[i].ICD10Code);
        //        }

        //        txtMedBill_ICD10Code.AutoCompleteMode = AutoCompleteMode.SuggestAppend;
        //        txtMedBill_ICD10Code.AutoCompleteSource = AutoCompleteSource.CustomSource;
        //        txtMedBill_ICD10Code.AutoCompleteCustomSource = srcICD10Codes;

        //        ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        //        String strSqlQueryForMaxMedBillNo = "select max(dbo.tbl_medbill.BillNo) from dbo.tbl_medbill";

        //        SqlCommand cmdQueryForMaxBillNo = new SqlCommand(strSqlQueryForMaxMedBillNo, connRN);
        //        cmdQueryForMaxBillNo.CommandType = CommandType.Text;

        //        connRN.Open();
        //        String strMaxMedBillNo = cmdQueryForMaxBillNo.ExecuteScalar().ToString();
        //        connRN.Close();
        //        String strNewMedBillNo = String.Empty;


        //        if (strMaxMedBillNo != String.Empty)
        //        {
        //            int nNewMedBillNo = Int32.Parse(strMaxMedBillNo.Substring(8));
        //            nNewMedBillNo++;
        //            int nLeadingZero = 0;
        //            while ((nNewMedBillNo.ToString().Length + nLeadingZero) < 7) nLeadingZero++;
        //            strNewMedBillNo = "MEDBILL-";
        //            for (int i = 0; i < nLeadingZero; i++) strNewMedBillNo += '0';

        //            strNewMedBillNo += nNewMedBillNo.ToString();
        //        }


        //        txtMedBillNo.Text = strNewMedBillNo;


        //        ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        //        String strSqlQueryForMedicalProvider = "select dbo.tbl_MedicalProvider.ID, dbo.tbl_MedicalProvider.Name, dbo.tbl_MedicalProvider.Type from dbo.tbl_MedicalProvider";

        //        SqlCommand cmdQueryForMedicalProvider = new SqlCommand(strSqlQueryForMedicalProvider, connRN);
        //        cmdQueryForMedicalProvider.CommandType = CommandType.Text;

        //        connRN.Open();

        //        SqlDataReader rdrMedicalProvider = cmdQueryForMedicalProvider.ExecuteReader();

        //        lstMedicalProvider.Clear();
        //        if (rdrMedicalProvider.HasRows)
        //        {
        //            while (rdrMedicalProvider.Read())
        //            {
        //                MedicalProviderInfo info = new MedicalProviderInfo();

        //                if (!rdrMedicalProvider.IsDBNull(0)) info.ID = rdrMedicalProvider.GetString(0);
        //                if (!rdrMedicalProvider.IsDBNull(1)) info.Name = rdrMedicalProvider.GetString(1);
        //                if (!rdrMedicalProvider.IsDBNull(2)) info.Type = rdrMedicalProvider.GetString(2);

        //                lstMedicalProvider.Add(info);
        //            }
        //        }

        //        connRN.Close();

        //        var srcMedicalProvider = new AutoCompleteStringCollection();

        //        for (int i = 0; i < lstMedicalProvider.Count; i++)
        //        {
        //            srcMedicalProvider.Add(lstMedicalProvider[i].Name);
        //        }

        //        txtMedicalProvider.AutoCompleteMode = AutoCompleteMode.SuggestAppend;
        //        txtMedicalProvider.AutoCompleteSource = AutoCompleteSource.CustomSource;
        //        txtMedicalProvider.AutoCompleteCustomSource = srcMedicalProvider;


        //        tbCMMManager.TabPages.Insert(3, tbpgMedicalBill);
        //        tbCMMManager.SelectedIndex = 3;
        //    }
        //}

        private void btnNewMedBill_Case_Click(object sender, EventArgs e)
        {
            //if (!tbCMMManager.TabPages.Contains(tbpgMedicalBill))
            //{
            MedBillStart = PrevTabPage;
            medbillMode = MedBillMode.AddNew;

            //gvCaseViewCaseHistory
            int nRowSelected;

            String strCaseNameSelected = String.Empty;
            String strPatientLastName = txtLastName.Text.Trim();
            String strPatientFirstName = txtFirstName.Text.Trim();
            String strPatientMiddleName = txtMiddleName.Text.Trim();
            String strDateOfBirth = dtpBirthDate.Value.ToString("MM/dd/yyyy");
            String strSSN = txtIndividualSSN.Text.Trim();
            String strStreetAddr = txtStreetAddress1.Text.Trim();
            String strCity = txtCity1.Text.Trim();
            String strState = txtState1.Text.Trim();
            String strZip = txtZip1.Text.Trim();
            String strCurrentProgram = txtProgram.Text.Trim();

            if (PrevTabPage == TabPage.Individual)
            {
                if (gvProcessingCaseNo.Rows.Count > 0)
                {
                    InitializeMedBillTabOnNewMedBill();

                    //nRowSelected = gvProcessingCaseNo.CurrentCell.RowIndex;

                    txtIndividualIDMedBill.Text = strIndividualId.Trim();

                    if (strPatientMiddleName != String.Empty) txtPatientNameMedBill.Text = strPatientLastName + ", " + strPatientFirstName + " " + strPatientMiddleName;
                    else txtPatientNameMedBill.Text = strPatientLastName + ", " + strPatientFirstName;

                    txtMedBillDOB.Text = strDateOfBirth;
                    txtMedBillSSN.Text = strSSN;
                    txtMedBillAddress.Text = strStreetAddr + ", " + strCity + ", " + strState + " " + strZip;

                    //strCaseNameSelected = gvProcessingCaseNo["CaseIdForIndividual", nRowSelected].Value.ToString().Trim();
                    strCaseNameSelected = txtCaseName.Text.Trim();
                    strCaseIdSelected = strCaseNameSelected;
                    strContactIdSelected = strIndividualId;

                    strCaseIdForIllness = strCaseNameSelected;
                    txtMedBill_CaseNo.Text = strCaseNameSelected;
                    txtMemberProgram.Text = strCurrentProgram;

                    //txtMedicalBillStatus.Text = "Pending Status";

                    String strSqlQueryForCase = "select dbo.tbl_case.Case_Name, dbo.tbl_case.[NPF_Form], dbo.tbl_case.[NPF_Form_File_Name], dbo.tbl_case.[NPF_Receiv_Date], " +
                            "dbo.tbl_case.[IB_Form], dbo.tbl_case.[IB_Form_File_Name], dbo.tbl_case.[IB_Receiv_Date], " +
                            "dbo.tbl_case.[POP_Form], dbo.tbl_case.[POP_Form_File_Name], dbo.tbl_case.[POP_Receiv_Date], " +
                            "dbo.tbl_case.[MedRec_Form], dbo.tbl_case.[MedRec_Form_File_Name], dbo.tbl_case.[MedRec_Receiv_Date], " +
                            "dbo.tbl_case.[Unknown_Form], dbo.tbl_case.[Unknown_Form_File_Name], dbo.tbl_case.[Unknown_Receiv_Date] " +
                            "from dbo.tbl_case where Case_Name = @CaseId";

                    SqlCommand cmdQueryForDocumentReceivedDate = new SqlCommand(strSqlQueryForCase, connRN4);
                    cmdQueryForDocumentReceivedDate.CommandType = CommandType.Text;

                    cmdQueryForDocumentReceivedDate.Parameters.AddWithValue("@CaseId", strCaseNameSelected);

                    //if (connRN.State == ConnectionState.Closed) connRN.Open();
                    if (connRN4.State != ConnectionState.Closed)
                    {
                        connRN4.Close();
                        connRN4.Open();
                    }
                    else if (connRN4.State == ConnectionState.Closed) connRN4.Open();
                    SqlDataReader rdrDocsReceivedDate = cmdQueryForDocumentReceivedDate.ExecuteReader();

                    if (rdrDocsReceivedDate.HasRows)
                    {
                        rdrDocsReceivedDate.Read();

                        if (rdrDocsReceivedDate.GetBoolean(1) == true)
                        {
                            chkMedBillNPFReceived.Checked = true;
                            dtpMedBillNPF.Format = DateTimePickerFormat.Short;
                            dtpMedBillNPF.Value = rdrDocsReceivedDate.GetDateTime(3);
                            btnViewNPF.Enabled = true;
                        }
                        else
                        {
                            dtpMedBillNPF.Format = DateTimePickerFormat.Custom;
                            dtpMedBillNPF.CustomFormat = " ";
                            btnViewNPF.Enabled = false;
                        }

                        chkMedBillNPFReceived.Enabled = false;

                        if (rdrDocsReceivedDate.GetBoolean(4) == true)
                        {
                            chkMedBill_IBReceived.Checked = true;
                            dtpMedBill_IB.Format = DateTimePickerFormat.Short;
                            dtpMedBill_IB.Value = rdrDocsReceivedDate.GetDateTime(6);
                            btnViewIB.Enabled = true;
                        }
                        else
                        {
                            dtpMedBill_IB.Format = DateTimePickerFormat.Custom;
                            dtpMedBill_IB.CustomFormat = " ";
                            btnViewIB.Enabled = false;
                        }

                        chkMedBill_IBReceived.Enabled = false;

                        if (rdrDocsReceivedDate.GetBoolean(7) == true)
                        {
                            chkMedBillPOPReceived.Checked = true;
                            dtpMedBillPOP.Format = DateTimePickerFormat.Short;
                            dtpMedBillPOP.Value = rdrDocsReceivedDate.GetDateTime(9);
                            btnViewPoP.Enabled = true;
                        }
                        else
                        {
                            dtpMedBillPOP.Format = DateTimePickerFormat.Custom;
                            dtpMedBillPOP.CustomFormat = " ";
                            btnViewPoP.Enabled = false;
                        }

                        chkMedBillPOPReceived.Enabled = false;

                        if (rdrDocsReceivedDate.GetBoolean(10) == true)
                        {
                            chkMedRecordReceived.Checked = true;
                            dtpMedBillMedRecord.Format = DateTimePickerFormat.Short;
                            dtpMedBillMedRecord.Value = rdrDocsReceivedDate.GetDateTime(12);
                            btnViewMedRecord.Enabled = true;
                        }
                        else
                        {
                            dtpMedBillMedRecord.Format = DateTimePickerFormat.Custom;
                            dtpMedBillMedRecord.CustomFormat = " ";
                            btnViewMedRecord.Enabled = false;
                        }

                        chkMedRecordReceived.Enabled = false;

                        if (rdrDocsReceivedDate.GetBoolean(13) == true)
                        {
                            chkOtherDocReceived.Checked = true;
                            dtpMedBillOtherDoc.Format = DateTimePickerFormat.Short;
                            dtpMedBillOtherDoc.Value = rdrDocsReceivedDate.GetDateTime(15);
                            btnViewOtherDoc.Enabled = true;
                        }
                        else
                        {
                            dtpMedBillOtherDoc.Format = DateTimePickerFormat.Custom;
                            dtpMedBillOtherDoc.CustomFormat = " ";
                            btnViewOtherDoc.Enabled = false;
                        }

                        chkOtherDocReceived.Enabled = false;

                    }
                    rdrDocsReceivedDate.Close();
                    if (connRN4.State != ConnectionState.Closed) connRN4.Close();

                    //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

                    String strQueryForICD10Codes = "select dbo.[ICD10 Code].ID, dbo.[ICD10 Code].ICD10_CODE__C, dbo.[ICD10 Code].Name from [dbo].[ICD10 Code]";

                    SqlCommand cmdQueryForICD10Codes = new SqlCommand(strQueryForICD10Codes, connSalesforce3);

                    cmdQueryForICD10Codes.CommandType = CommandType.Text;
                    cmdQueryForICD10Codes.CommandText = strQueryForICD10Codes;

                    //if (connSalesforce.State == ConnectionState.Closed) connSalesforce.Open();
                    if (connSalesforce3.State == ConnectionState.Open)
                    {
                        connSalesforce3.Close();
                        connSalesforce3.Open();
                    }
                    else if (connSalesforce3.State == ConnectionState.Closed) connSalesforce3.Open();
                    SqlDataReader rdrICD10Codes = cmdQueryForICD10Codes.ExecuteReader();

                    lstICD10CodeInfo.Clear();
                    if (rdrICD10Codes.HasRows)
                    {
                        while (rdrICD10Codes.Read())
                        {
                            lstICD10CodeInfo.Add(new ICD10CodeInfo { Id = rdrICD10Codes.GetString(0), ICD10Code = rdrICD10Codes.GetString(1), Name = rdrICD10Codes.GetString(2) });
                        }
                    }
                    rdrICD10Codes.Close();
                    if (connSalesforce3.State != ConnectionState.Closed) connSalesforce3.Close();

                    var srcICD10Codes = new AutoCompleteStringCollection();

                    for (int i = 0; i < lstICD10CodeInfo.Count; i++)
                    {
                        srcICD10Codes.Add(lstICD10CodeInfo[i].ICD10Code);
                    }

                    txtMedBill_ICD10Code.AutoCompleteMode = AutoCompleteMode.SuggestAppend;
                    txtMedBill_ICD10Code.AutoCompleteSource = AutoCompleteSource.CustomSource;
                    txtMedBill_ICD10Code.AutoCompleteCustomSource = srcICD10Codes;

                    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

                    String strSqlQueryForCountMedBill = "select count([dbo].[tbl_medbill].[BillNo]) from [dbo].[tbl_medbill]";

                    SqlCommand cmdQueryForCountMedBill = new SqlCommand(strSqlQueryForCountMedBill, connRN4);
                    cmdQueryForCountMedBill.CommandType = CommandType.Text;

                    if (connRN4.State != ConnectionState.Closed)
                    {
                        connRN4.Close();
                        connRN4.Open();
                    }
                    else if (connRN4.State == ConnectionState.Closed) connRN4.Open();
                    int nMedBillCount = (int)cmdQueryForCountMedBill.ExecuteScalar();
                    if (connRN4.State != ConnectionState.Closed) connRN4.Close();


                    String strNewMedBillNo = String.Empty;
                    if (nMedBillCount > 0)
                    {
                        if (connRN4.State != ConnectionState.Closed)
                        {
                            connRN4.Close();
                            connRN4.Open();
                        }
                        else if (connRN4.State == ConnectionState.Closed) connRN4.Open();

                        SqlCommand cmdNewMedBillId = connRN4.CreateCommand();
                        SqlTransaction tranGetNewMedBillId = connRN4.BeginTransaction(IsolationLevel.Serializable);

                        cmdNewMedBillId.Connection = connRN4;
                        cmdNewMedBillId.Transaction = tranGetNewMedBillId;

                        try
                        {
                            String strSqlQueryForLastMedBillId = "select [dbo].[tbl_LastID].[MedBillId] from [dbo].[tbl_LastID] where [dbo].[tbl_LastID].[Id] = 1";
                            cmdNewMedBillId.CommandType = CommandType.Text;
                            cmdNewMedBillId.CommandText = strSqlQueryForLastMedBillId;

                            Object objLastMedBillNo = cmdNewMedBillId.ExecuteScalar();

                            String NewMedBillNo = String.Empty;
                            if (objLastMedBillNo != null) NewMedBillNo = objLastMedBillNo.ToString();

                            int nNewMedBillNo = Int32.Parse(NewMedBillNo.Substring(10));
                            nNewMedBillNo++;

                            int nLeadingZero = 0;
                            while ((nNewMedBillNo.ToString().Length + nLeadingZero) < 7) nLeadingZero++;
                            strNewMedBillNo = "RNMEDBILL-";
                            for (int i = 0; i < nLeadingZero; i++) strNewMedBillNo += '0';

                            strNewMedBillNo += nNewMedBillNo.ToString();

                            String strSqlUpdateLastMedBillId = "update [dbo].[tbl_LastID] set [dbo].[tbl_LastID].[MedBillId] = @NewMedBillId where [dbo].[tbl_LastID].[Id] = 1";
                            cmdNewMedBillId.CommandType = CommandType.Text;
                            cmdNewMedBillId.CommandText = strSqlUpdateLastMedBillId;

                            cmdNewMedBillId.Parameters.AddWithValue("@NewMedBillId", strNewMedBillNo);

                            int nNewMedBillNoUpdated = cmdNewMedBillId.ExecuteNonQuery();

                            tranGetNewMedBillId.Commit();
                        }
                        catch (Exception ex)
                        {
                            try
                            {
                                tranGetNewMedBillId.Rollback();
                                MessageBox.Show(ex.Message, "Error");
                                return;
                            }
                            catch (SqlException se)
                            {
                                MessageBox.Show(se.Message, "Sql Error");
                                return;
                            }
                        }

                        if (connRN4.State != ConnectionState.Closed) connRN4.Close();
                    }
                    else
                    {
                        strNewMedBillNo = "RNMEDBILL-0150000";

                        if (connRN4.State != ConnectionState.Closed)
                        {
                            connRN4.Close();
                            connRN4.Open();
                        }
                        else if (connRN4.State == ConnectionState.Closed) connRN4.Open();

                        SqlCommand cmdNewMedBillId = connRN4.CreateCommand();
                        SqlTransaction tranGetNewMedBillId = connRN4.BeginTransaction(IsolationLevel.Serializable);

                        cmdNewMedBillId.Connection = connRN4;
                        cmdNewMedBillId.Transaction = tranGetNewMedBillId;

                        try
                        {
                            String strSqlUpdateLastMedBillId = "update [dbo].[tbl_LastID] set [dbo].[tbl_LastID].[MedBillId] = @NewMedBillId where [dbo].[tbl_LastID].[Id] = 1";
                            cmdNewMedBillId.CommandType = CommandType.Text;
                            cmdNewMedBillId.CommandText = strSqlUpdateLastMedBillId;

                            cmdNewMedBillId.Parameters.AddWithValue("@NewMedBillId", strNewMedBillNo);

                            int nNewMedBillNoUpdated = cmdNewMedBillId.ExecuteNonQuery();

                            tranGetNewMedBillId.Commit();
                        }
                        catch (Exception ex)
                        {
                            try
                            {
                                tranGetNewMedBillId.Rollback();
                                MessageBox.Show(ex.Message, "Error");
                                return;
                            }
                            catch (SqlException se)
                            {
                                MessageBox.Show(se.Message, "Sql Error");
                                return;
                            }
                        }

                        if (connRN4.State != ConnectionState.Closed) connRN4.Close();

                    }

                    //String strSqlQueryForMaxMedBillNo = "select max(dbo.tbl_medbill.BillNo) from dbo.tbl_medbill";

                    //SqlCommand cmdQueryForMaxBillNo = new SqlCommand(strSqlQueryForMaxMedBillNo, connRN4);
                    //cmdQueryForMaxBillNo.CommandType = CommandType.Text;

                    ////if (connRN.State == ConnectionState.Closed) connRN.Open();
                    //if (connRN4.State != ConnectionState.Closed)
                    //{
                    //    connRN4.Close();
                    //    connRN4.Open();
                    //}
                    //else if (connRN4.State == ConnectionState.Closed) connRN4.Open();
                    ////String strMaxMedBillNo = cmdQueryForMaxBillNo.ExecuteScalar().ToString();
                    //Object objMaxMedBillNo = cmdQueryForMaxBillNo.ExecuteScalar();
                    //if (connRN4.State != ConnectionState.Closed) connRN4.Close();

                    //String strMaxMedBillNo = String.Empty;
                    //if (objMaxMedBillNo != null) strMaxMedBillNo = objMaxMedBillNo.ToString();

                    ////String strNewMedBillNo = String.Empty;
                    //if (strMaxMedBillNo != String.Empty)
                    //{
                    //    int nNewMedBillNo = Int32.Parse(strMaxMedBillNo.Substring(8));
                    //    nNewMedBillNo++;
                    //    int nLeadingZero = 0;
                    //    while ((nNewMedBillNo.ToString().Length + nLeadingZero) < 7) nLeadingZero++;
                    //    strNewMedBillNo = "MEDBILL-";
                    //    for (int i = 0; i < nLeadingZero; i++) strNewMedBillNo += '0';

                    //    strNewMedBillNo += nNewMedBillNo.ToString();
                    //}
                    //else strNewMedBillNo = "MEDBILL - 0150000";
                    txtMedBillNo.Text = strNewMedBillNo;

                    // Populate Medical Bill Type combo box

                    String strSqlQueryForMedBillTypes = "select [dbo].[tbl_medbill_type].[MedBillTypeName] from [dbo].[tbl_medbill_type]";

                    SqlCommand cmdQueryForMedBillTypes = new SqlCommand(strSqlQueryForMedBillTypes, connRN4);
                    cmdQueryForMedBillTypes.CommandType = CommandType.Text;

                    //if (connRN.State == ConnectionState.Closed) connRN.Open();
                    if (connRN4.State != ConnectionState.Closed)
                    {
                        connRN4.Close();
                        connRN4.Open();
                    }
                    else if (connRN4.State == ConnectionState.Closed) connRN4.Open();

                    SqlDataReader rdrMedBillTypes = cmdQueryForMedBillTypes.ExecuteReader();
                    comboMedBillType.Items.Clear();
                    if (rdrMedBillTypes.HasRows)
                    {
                        while (rdrMedBillTypes.Read())
                        {
                            if (!rdrMedBillTypes.IsDBNull(0)) comboMedBillType.Items.Add(rdrMedBillTypes.GetString(0));
                        }
                    }
                    rdrMedBillTypes.Close();
                    if (connRN4.State != ConnectionState.Closed) connRN4.Close();
                    comboMedBillType.SelectedIndex = (int)MedBillType.MedicalBill - 1;

                    comboMedBillStatus.Items.Clear();
                    if (dicMedBillStatus.Count > 0)
                    {
                        for (int i = 0; i < dicMedBillStatus.Count; i++)
                        {
                            comboMedBillStatus.Items.Add(dicMedBillStatus[i]);
                        }
                        comboMedBillStatus.SelectedIndex = 0;
                    }

                    //foreach (MedBillStatusInfo info in lstMedBillStatusInfo)
                    //{
                    //    if (info.IsDeleted == false)
                    //    {
                    //        comboMedBillStatus.Items.Add(info.BillStatusValue);
                    //    }
                    //}




                    // Populate Pending Reason
                    comboPendingReason.Items.Clear();
                    if (dicPendingReason.Count > 0)
                    {
                        for (int i = 0; i < dicPendingReason.Count; i++)
                        {
                            comboPendingReason.Items.Add(dicPendingReason[i]);
                        }
                        comboPendingReason.SelectedIndex = 0;
                    }
                    //comboPendingReason.Sorted = true;

                    // Populate Ineligible Reason
                    comboIneligibleReason.Items.Clear();
                    if (dicIneligibleReason.Count > 0)
                    {
                        for (int i = 0; i < dicIneligibleReason.Count; i++)
                        {
                            comboIneligibleReason.Items.Add(dicIneligibleReason[i]);
                        }
                        comboIneligibleReason.SelectedIndex = 0;
                    }
                    

                    
                    
                    //comboIneligibleReason.Sorted = true;

                    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                    //String strSqlQueryForMedicalProvider = "select dbo.tbl_MedicalProvider.ID, dbo.tbl_MedicalProvider.Name, dbo.tbl_MedicalProvider.Type from dbo.tbl_MedicalProvider";

                    //SqlCommand cmdQueryForMedicalProvider = new SqlCommand(strSqlQueryForMedicalProvider, connRN4);
                    //cmdQueryForMedicalProvider.CommandType = CommandType.Text;

                    ////if (connRN.State == ConnectionState.Closed) connRN.Open();
                    //if (connRN4.State != ConnectionState.Closed)
                    //{
                    //    connRN4.Close();
                    //    connRN4.Open();
                    //}
                    //else if (connRN4.State == ConnectionState.Closed) connRN4.Open();

                    //SqlDataReader rdrMedicalProvider = cmdQueryForMedicalProvider.ExecuteReader();

                    //lstMedicalProvider.Clear();
                    //if (rdrMedicalProvider.HasRows)
                    //{
                    //    while (rdrMedicalProvider.Read())
                    //    {
                    //        MedicalProviderInfo info = new MedicalProviderInfo();

                    //        if (!rdrMedicalProvider.IsDBNull(0)) info.ID = rdrMedicalProvider.GetString(0);
                    //        if (!rdrMedicalProvider.IsDBNull(1)) info.Name = rdrMedicalProvider.GetString(1);
                    //        if (!rdrMedicalProvider.IsDBNull(2)) info.Type = rdrMedicalProvider.GetString(2);

                    //        lstMedicalProvider.Add(info);
                    //    }
                    //}

                    //if (connRN4.State != ConnectionState.Closed) connRN4.Close();

                    var srcMedicalProvider = new AutoCompleteStringCollection();

                    for (int i = 0; i < lstMedicalProvider.Count; i++)
                    {
                        srcMedicalProvider.Add(lstMedicalProvider[i].Name);
                    }

                    // added 05/28/19
                    txtMedicalProvider.AutoCompleteMode = AutoCompleteMode.SuggestAppend;
                    txtMedicalProvider.AutoCompleteSource = AutoCompleteSource.CustomSource;
                    txtMedicalProvider.AutoCompleteCustomSource = srcMedicalProvider;

                    // Settlement gv
                    //String strSqlQueryForSettlement = "select [dbo].[tbl_settlement].[Name], [dbo].[tbl_settlement_type_code].[SettlementTypeValue], [dbo].[tbl_settlement].[Amount], " +
                    //          "[dbo].[tbl_settlement].[PersonalResponsibilityCredit], [dbo].[tbl_payment_method].[PaymentMethod_Value], " +
                    //          "[dbo].[tbl_settlement].[Approved], [dbo].[tbl_settlement].[ApprovedDate], " +
                    //          "[dbo].[tbl_settlement].[CheckNo], [dbo].[tbl_settlement].[CheckDate], [dbo].[tbl_settlement].[CheckReconciled], " +
                    //          "[dbo].[tbl_settlement].[ACH_Number], [dbo].[tbl_settlement].[ACH_Date], [dbo].[tbl_settlement].[ACH_Reconciled], " +
                    //          "[dbo].[tbl_Credit_Card__c].[Name], [dbo].[tbl_settlement].[CMMCreditCardPaidDate], [dbo].[tbl_settlement].[CC_Reconciled], " +
                    //          "[dbo].[tbl_settlement].[AllowedAmount], [dbo].[tbl_settlement].[IneligibleReason], " +
                    //          "[dbo].[tbl_settlement].[Notes] " +
                    //          "from [dbo].[tbl_settlement] inner join [dbo].[tbl_settlement_type_code] " +
                    //          "on [dbo].[tbl_settlement].[SettlementType] = [dbo].[tbl_settlement_type_code].[SettlementTypeCode] " +
                    //          "inner join [dbo].[tbl_payment_method] on [dbo].[tbl_settlement].[CMMPaymentMethod] = [dbo].[tbl_payment_method].[PaymentMethod_Id] " +
                    //          "inner join [dbo].[tbl_Credit_Card__c] on [dbo].[tbl_settlement].[CMMCreditCard] = [dbo].[tbl_Credit_Card__c].[CreditCard_Id]" +
                    //          "where [dbo].[tbl_settlement].[MedicalBillID] = @MedBillNo and " +
                    //          "[dbo].[tbl_settlement].[IsDeleted] = 0 " +
                    //          "order by [dbo].[tbl_settlement].[Name]";

                    //SqlCommand cmdQueryForSettlement = new SqlCommand(strSqlQueryForSettlement, connRN);
                    //cmdQueryForSettlement.CommandType = CommandType.Text;

                    //cmdQueryForSettlement.Parameters.AddWithValue("@MedBillNo", MedBillNo);

                    //SqlDependency dependencySettlementInMedBill = new SqlDependency(cmdQueryForSettlement);
                    //dependencySettlementInMedBill.OnChange += new OnChangeEventHandler(OnSettlementsInMedBillEditChange);

                    ////if (connRN.State == ConnectionState.Closed) connRN.Open();
                    //if (connRN.State != ConnectionState.Closed)
                    //{
                    //    connRN.Close();
                    //    connRN.Open();
                    //}
                    //else if (connRN.State == ConnectionState.Closed) connRN.Open();
                    //SqlDataReader rdrSettlement = cmdQueryForSettlement.ExecuteReader();
                    //gvSettlementsInMedBill.Rows.Clear();
                    //if (rdrSettlement.HasRows)
                    //{
                    //    while (rdrSettlement.Read())
                    //    {
                    //        DataGridViewRow row = new DataGridViewRow();
                    //        row.Cells.Add(new DataGridViewCheckBoxCell { Value = false });
                    //        if (!rdrSettlement.IsDBNull(0)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlement.GetString(0) });
                    //        if (!rdrSettlement.IsDBNull(1))
                    //        {
                    //            DataGridViewComboBoxCell comboCellSettlementType = new DataGridViewComboBoxCell();

                    //            for (int i = 0; i < lstSettlementType.Count; i++)
                    //            {
                    //                comboCellSettlementType.Items.Add(lstSettlementType[i].SettlementTypeValue);
                    //            }
                    //            for (int i = 0; i < comboCellSettlementType.Items.Count; i++)
                    //            {
                    //                if (rdrSettlement.GetString(1) == comboCellSettlementType.Items[i].ToString())
                    //                    comboCellSettlementType.Value = comboCellSettlementType.Items[i];
                    //            }

                    //            row.Cells.Add(comboCellSettlementType);
                    //        }
                    //        else
                    //        {
                    //            DataGridViewComboBoxCell comboCellSettlementType = new DataGridViewComboBoxCell();
                    //            for (int i = 0; i < lstSettlementType.Count; i++)
                    //            {
                    //                comboCellSettlementType.Items.Add(lstSettlementType[i].SettlementTypeValue);
                    //            }

                    //            for (int i = 0; i < comboCellSettlementType.Items.Count; i++)
                    //            {
                    //                if (rdrSettlement.GetString(1) == comboCellSettlementType.Items[i].ToString())
                    //                    comboCellSettlementType.Value = comboCellSettlementType.Items[i];
                    //            }

                    //            row.Cells.Add(comboCellSettlementType);
                    //        }

                    //        if (!rdrSettlement.IsDBNull(2)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlement.GetDecimal(2).ToString("C") });
                    //        else
                    //        {
                    //            Decimal Zero = 0;
                    //            row.Cells.Add(new DataGridViewTextBoxCell { Value = Zero.ToString("C") });
                    //        }


                    //        if (!rdrSettlement.IsDBNull(3)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlement.GetDecimal(3).ToString("C") });
                    //        else
                    //        {
                    //            Decimal Zero = 0;
                    //            row.Cells.Add(new DataGridViewTextBoxCell { Value = Zero.ToString("C") });
                    //        }

                    //        /////////////////////////////////////////////////////////////////////
                    //        if (!rdrSettlement.IsDBNull(4))
                    //        {
                    //            DataGridViewComboBoxCell comboCellPaymentMethod = new DataGridViewComboBoxCell();

                    //            for (int i = 0; i < lstPaymentMethod.Count; i++)
                    //            {
                    //                if (lstPaymentMethod[i].PaymentMethodValue != null) comboCellPaymentMethod.Items.Add(lstPaymentMethod[i].PaymentMethodValue);
                    //                else comboCellPaymentMethod.Items.Add(String.Empty);
                    //            }

                    //            for (int i = 0; i < comboCellPaymentMethod.Items.Count; i++)
                    //            {
                    //                if (rdrSettlement.GetString(4) == comboCellPaymentMethod.Items[i].ToString())
                    //                    comboCellPaymentMethod.Value = comboCellPaymentMethod.Items[i];
                    //            }

                    //            row.Cells.Add(comboCellPaymentMethod);
                    //        }
                    //        else
                    //        {
                    //            DataGridViewComboBoxCell comboCellPaymentMethod = new DataGridViewComboBoxCell();

                    //            for (int i = 0; i < lstPaymentMethod.Count; i++)
                    //            {
                    //                if (lstPaymentMethod[i].PaymentMethodValue != null) comboCellPaymentMethod.Items.Add(lstPaymentMethod[i].PaymentMethodValue);
                    //                else comboCellPaymentMethod.Items.Add(String.Empty);
                    //                //comboCellPaymentMethod.Items.Add(lstPaymentMethod[i].PaymentMethodValue);
                    //            }

                    //            for (int i = 0; i < comboCellPaymentMethod.Items.Count; i++)
                    //            {
                    //                if ((!rdrSettlement.IsDBNull(4)) && comboCellPaymentMethod.Items[i] != null)
                    //                {
                    //                    if (rdrSettlement.GetString(4) == comboCellPaymentMethod.Items[i].ToString())
                    //                        comboCellPaymentMethod.Value = comboCellPaymentMethod.Items[i];
                    //                }
                    //                else comboCellPaymentMethod.Value = null;
                    //            }

                    //            row.Cells.Add(comboCellPaymentMethod);

                    //        }

                    //        /////////////////////////////////////////////////////////////////////
                    //        if (!rdrSettlement.IsDBNull(5))
                    //        {

                    //            DataGridViewCheckBoxCell approvedCell = new DataGridViewCheckBoxCell();
                    //            approvedCell.Value = rdrSettlement.GetBoolean(5);
                    //            approvedCell.Style.Alignment = DataGridViewContentAlignment.MiddleCenter;
                    //            row.Cells.Add(approvedCell);
                    //        }
                    //        else
                    //        {
                    //            DataGridViewCheckBoxCell approvedCell = new DataGridViewCheckBoxCell();
                    //            approvedCell.Value = false;
                    //            approvedCell.Style.Alignment = DataGridViewContentAlignment.MiddleCenter;
                    //            row.Cells.Add(approvedCell);
                    //        }

                    //        if (!rdrSettlement.IsDBNull(6)) row.Cells.Add(new CalendarCell { Value = DateTime.Parse(rdrSettlement.GetDateTime(6).ToString("MM/dd/yyyy")) });
                    //        else row.Cells.Add(new CalendarCell { Value = null });

                    //        // Payment information
                    //        if (!rdrSettlement.IsDBNull(4))
                    //        {
                    //            String strPaymentMethod = rdrSettlement.GetString(4);

                    //            switch (strPaymentMethod)
                    //            {
                    //                case "Check":
                    //                    if (!rdrSettlement.IsDBNull(7)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlement.GetString(7) });
                    //                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = null });
                    //                    row.Cells.Add(new DataGridViewTextBoxCell { Value = null });
                    //                    DataGridViewComboBoxCell comboCellCreditCardNoneForCheck = new DataGridViewComboBoxCell();
                    //                    for (int i = 0; i < lstCreditCardInfo.Count; i++)
                    //                    {
                    //                        if (lstCreditCardInfo[i].CreditCardNo != null) comboCellCreditCardNoneForCheck.Items.Add(lstCreditCardInfo[i].CreditCardNo);
                    //                        else comboCellCreditCardNoneForCheck.Items.Add(String.Empty);
                    //                    }
                    //                    row.Cells.Add(comboCellCreditCardNoneForCheck);
                    //                    if (!rdrSettlement.IsDBNull(8)) row.Cells.Add(new CalendarCell { Value = DateTime.Parse(rdrSettlement.GetDateTime(8).ToString("MM/dd/yyyy")) });
                    //                    if (!rdrSettlement.IsDBNull(9)) row.Cells.Add(new DataGridViewCheckBoxCell { Value = rdrSettlement.GetBoolean(9) });
                    //                    break;
                    //                case "ACH/Banking":
                    //                    row.Cells.Add(new DataGridViewTextBoxCell { Value = null });
                    //                    if (!rdrSettlement.IsDBNull(10)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlement.GetString(10) });
                    //                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = null });
                    //                    DataGridViewComboBoxCell comboCellCreditCardNoneForACH = new DataGridViewComboBoxCell();
                    //                    for (int i = 0; i < lstCreditCardInfo.Count; i++)
                    //                    {
                    //                        if (lstCreditCardInfo[i].CreditCardNo != null)
                    //                            comboCellCreditCardNoneForACH.Items.Add(lstCreditCardInfo[i].CreditCardNo);
                    //                        else comboCellCreditCardNoneForACH.Items.Add(String.Empty);
                    //                    }
                    //                    row.Cells.Add(comboCellCreditCardNoneForACH);
                    //                    if (!rdrSettlement.IsDBNull(11)) row.Cells.Add(new CalendarCell { Value = DateTime.Parse(rdrSettlement.GetDateTime(11).ToString("MM/dd/yyyy")) });
                    //                    if (!rdrSettlement.IsDBNull(12)) row.Cells.Add(new DataGridViewCheckBoxCell { Value = rdrSettlement.GetBoolean(12) });
                    //                    break;
                    //                case "Credit Card":
                    //                    row.Cells.Add(new DataGridViewTextBoxCell { Value = null });
                    //                    row.Cells.Add(new DataGridViewTextBoxCell { Value = null });
                    //                    DataGridViewComboBoxCell comboCellCreditCard = new DataGridViewComboBoxCell();
                    //                    if (!rdrSettlement.IsDBNull(13))
                    //                    {
                    //                        for (int i = 0; i < lstCreditCardInfo.Count; i++)
                    //                        {
                    //                            if (lstCreditCardInfo[i].CreditCardNo != null) comboCellCreditCard.Items.Add(lstCreditCardInfo[i].CreditCardNo);
                    //                            else comboCellCreditCard.Items.Add(String.Empty);
                    //                        }
                    //                        for (int i = 0; i < comboCellCreditCard.Items.Count; i++)
                    //                        {
                    //                            if (rdrSettlement.GetString(13) == comboCellCreditCard.Items[i].ToString())
                    //                                comboCellCreditCard.Value = comboCellCreditCard.Items[i];
                    //                        }
                    //                    }
                    //                    else
                    //                    {
                    //                        //DataGridViewComboBoxCell comboCellCreditCard = new DataGridViewComboBoxCell();
                    //                        for (int i = 0; i < lstCreditCardInfo.Count; i++)
                    //                        {
                    //                            if (lstCreditCardInfo[i].CreditCardNo != null) comboCellCreditCard.Items.Add(lstCreditCardInfo[i].CreditCardNo);
                    //                            else comboCellCreditCard.Items.Add(String.Empty);
                    //                        }
                    //                        comboCellCreditCard.Value = String.Empty;
                    //                        //row.Cells.Add(comboCellCreditCard);
                    //                    }
                    //                    row.Cells.Add(comboCellCreditCard);
                    //                    if (!rdrSettlement.IsDBNull(14)) row.Cells.Add(new CalendarCell { Value = DateTime.Parse(rdrSettlement.GetDateTime(14).ToString("MM/dd/yyyy")) });
                    //                    else row.Cells.Add(new CalendarCell { Value = String.Empty });
                    //                    if (!rdrSettlement.IsDBNull(15)) row.Cells.Add(new DataGridViewCheckBoxCell { Value = rdrSettlement.GetBoolean(15) });
                    //                    else row.Cells.Add(new DataGridViewCheckBoxCell { Value = false });
                    //                    break;
                    //                default:
                    //                    row.Cells.Add(new DataGridViewTextBoxCell { Value = null });
                    //                    row.Cells.Add(new DataGridViewTextBoxCell { Value = null });
                    //                    DataGridViewComboBoxCell comboCellCreditCardNone = new DataGridViewComboBoxCell();
                    //                    for (int i = 0; i < lstCreditCardInfo.Count; i++)
                    //                    {
                    //                        if (lstCreditCardInfo[i].CreditCardNo != null) comboCellCreditCardNone.Items.Add(lstCreditCardInfo[i].CreditCardNo);
                    //                        else comboCellCreditCardNone.Items.Add(String.Empty);
                    //                    }
                    //                    row.Cells.Add(comboCellCreditCardNone);
                    //                    row.Cells.Add(new CalendarCell { Value = null });
                    //                    row.Cells.Add(new DataGridViewCheckBoxCell { Value = null });
                    //                    break;
                    //            }
                    //        }
                    //        else
                    //        {

                    //            DataGridViewTextBoxCell txtCheckNoCell = new DataGridViewTextBoxCell();
                    //            txtCheckNoCell.Value = null;
                    //            row.Cells.Add(txtCheckNoCell);
                    //            DataGridViewTextBoxCell txtACHNoCell = new DataGridViewTextBoxCell();
                    //            txtACHNoCell.Value = null;
                    //            row.Cells.Add(txtACHNoCell);
                    //            DataGridViewComboBoxCell comboCreditCardCell = new DataGridViewComboBoxCell();
                    //            for (int i = 0; i < lstCreditCardInfo.Count; i++)
                    //            {
                    //                if (lstCreditCardInfo[i].CreditCardNo != null) comboCreditCardCell.Items.Add(lstCreditCardInfo[i].CreditCardNo);
                    //                else comboCreditCardCell.Items.Add(String.Empty);
                    //            }
                    //            row.Cells.Add(comboCreditCardCell);
                    //            comboCreditCardCell.ReadOnly = true;
                    //            CalendarCell calPaymentDate = new CalendarCell();
                    //            calPaymentDate.Value = null;
                    //            row.Cells.Add(calPaymentDate);
                    //            DataGridViewCheckBoxCell chkReconciledCell = new DataGridViewCheckBoxCell();
                    //            chkReconciledCell.Value = false;
                    //            row.Cells.Add(chkReconciledCell);

                    //        }


                    //        if (!rdrSettlement.IsDBNull(16)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlement.GetDecimal(16).ToString("C") });
                    //        else row.Cells.Add(new DataGridViewTextBoxCell { Value = null });

                    //        if (!rdrSettlement.IsDBNull(17))
                    //        {
                    //            if (dicIneligibleReason.Count > 0)
                    //            {
                    //                DataGridViewComboBoxCell comboCellIneligibleReason = new DataGridViewComboBoxCell();
                    //                for (int i = 0; i < dicIneligibleReason.Count; i++)
                    //                {
                    //                    comboCellIneligibleReason.Items.Add(dicIneligibleReason[i]);
                    //                }
                    //                comboCellIneligibleReason.Value = comboCellIneligibleReason.Items[rdrSettlement.GetInt32(17)];
                    //                row.Cells.Add(comboCellIneligibleReason);
                    //            }
                    //        }
                    //        else
                    //        {
                    //            if (dicIneligibleReason.Count > 0)
                    //            {
                    //                DataGridViewComboBoxCell comboCellIneligibleReason = new DataGridViewComboBoxCell();
                    //                for (int i = 0; i < dicIneligibleReason.Count; i++)
                    //                {
                    //                    comboCellIneligibleReason.Items.Add(dicIneligibleReason[i]);
                    //                }
                    //                comboCellIneligibleReason.Value = comboCellIneligibleReason.Items[0];
                    //                row.Cells.Add(comboCellIneligibleReason);
                    //            }
                    //        }

                    //        if (!rdrSettlement.IsDBNull(18)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlement.GetString(18) });
                    //        else row.Cells.Add(new DataGridViewTextBoxCell { Value = null });

                    //        gvSettlementsInMedBill.Rows.Add(row);
                    //        //AddNewRowToGVSettlementSafely(row);
                    //    }
                    //}
                    //if (connRN.State != ConnectionState.Closed) connRN.Close();

                    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                    ///
                    //Decimal PersonalResponsibilityAmount = 0;

                    //foreach (IncidentProgramInfo incdProgram in lstIncidentProgramInfo)
                    //{
                    //    if (incdProgram.bPersonalResponsibilityProgram == true) PersonalResponsibilityAmount = incdProgram.PersonalResponsibilityAmount;
                    //}

                    //for (int i = 0; i < gvSettlementsInMedBill.Rows.Count; i++)
                    //{
                    //    if (gvSettlementsInMedBill["PersonalResponsibility", i]?.Value != null)
                    //    {
                    //        Decimal result = 0;
                    //        if (Decimal.TryParse(gvSettlementsInMedBill["PersonalResponsibility", i]?.Value?.ToString(), NumberStyles.Currency, new CultureInfo("en-US"), out result))
                    //        {
                    //            PersonalResponsibilityAmount -= result;
                    //        }
                    //    }
                    //}

                    //txtPersonalResponsibility.Text = PersonalResponsibilityAmount.ToString("C");

                    //if (PersonalResponsibilityAmount < 0) txtPersonalResponsibility.BackColor = Color.Yellow;

                    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////

                    for (int i = 0; i < gvSettlementsInMedBill.Rows.Count; i++)
                    {
                        if (gvSettlementsInMedBill["PaymentMethod", i]?.Value?.ToString() == "Check")
                        {
                            gvSettlementsInMedBill.Rows[i].Cells["CheckNo"].ReadOnly = false;
                            gvSettlementsInMedBill.Rows[i].Cells["PaymentDate"].ReadOnly = false;
                            gvSettlementsInMedBill.Rows[i].Cells["Reconciled"].ReadOnly = false;
                            gvSettlementsInMedBill.Rows[i].Cells["ACHNo"].ReadOnly = true;
                            gvSettlementsInMedBill.Rows[i].Cells["CreditCard"].ReadOnly = true;
                        }

                        if (gvSettlementsInMedBill["PaymentMethod", i]?.Value?.ToString() == "ACH/Banking")
                        {
                            gvSettlementsInMedBill.Rows[i].Cells["ACHNo"].ReadOnly = false;
                            gvSettlementsInMedBill.Rows[i].Cells["PaymentDate"].ReadOnly = false;
                            gvSettlementsInMedBill.Rows[i].Cells["Reconciled"].ReadOnly = false;
                            gvSettlementsInMedBill.Rows[i].Cells["CheckNo"].ReadOnly = true;
                            gvSettlementsInMedBill.Rows[i].Cells["CreditCard"].ReadOnly = true;
                        }

                        if (gvSettlementsInMedBill["PaymentMethod", i]?.Value?.ToString() == "Credit Card")
                        {
                            gvSettlementsInMedBill.Rows[i].Cells["CreditCard"].ReadOnly = false;
                            gvSettlementsInMedBill.Rows[i].Cells["PaymentDate"].ReadOnly = false;
                            gvSettlementsInMedBill.Rows[i].Cells["Reconciled"].ReadOnly = false;
                            gvSettlementsInMedBill.Rows[i].Cells["CheckNo"].ReadOnly = true;
                            gvSettlementsInMedBill.Rows[i].Cells["ACHNo"].ReadOnly = true;
                        }
                        if (gvSettlementsInMedBill["PaymentMethod", i]?.Value == null)
                        {
                            gvSettlementsInMedBill.Rows[i].Cells["CheckNo"].ReadOnly = true;
                            gvSettlementsInMedBill.Rows[i].Cells["ACHNo"].ReadOnly = true;
                            gvSettlementsInMedBill.Rows[i].Cells["CreditCard"].ReadOnly = true;
                            gvSettlementsInMedBill.Rows[i].Cells["PaymentDate"].ReadOnly = true;
                            gvSettlementsInMedBill.Rows[i].Cells["Reconciled"].ReadOnly = true;
                        }
                    }

                    for (int i = 0; i < gvSettlementsInMedBill.Rows.Count; i++)
                    {
                        if (gvSettlementsInMedBill[2, i]?.Value?.ToString() == "Ineligible") gvSettlementsInMedBill.Rows[i].DefaultCellStyle.BackColor = Color.Salmon;
                        else
                        {
                            gvSettlementsInMedBill["IneligibleReason", i].Value = null;
                            gvSettlementsInMedBill["IneligibleReason", i].ReadOnly = true;
                        }
                    }

                    if (txtMedBillAmount.Text.Trim() != String.Empty)
                    {
                        Decimal SettlementTotal = 0;
                        Decimal Balance = 0;
                        Decimal Result = 0;
                        Decimal BillAmount = 0;
                        if (Decimal.TryParse(txtMedBillAmount.Text.Trim(), NumberStyles.Currency, new CultureInfo("en-US"), out Result))
                        {
                            BillAmount = Result;

                            for (int i = 0; i < gvSettlementsInMedBill.Rows.Count; i++)
                            {
                                Decimal Settlement = Decimal.Parse(gvSettlementsInMedBill["SettlementAmount", i].Value.ToString(), NumberStyles.Currency, new CultureInfo("en-US"));
                                SettlementTotal += Settlement;
                            }
                            if (SettlementTotal > BillAmount) MessageBox.Show("Settlement Total exceeds the Medical Bill Amount.", "Alert");
                            else
                            {
                                Balance = BillAmount - SettlementTotal;
                                txtBalance.Text = Balance.ToString("C");
                            }
                        }
                    }

                    //btnAddNewSettlement.Enabled = true;
                    ////btnEditSettlement.Enabled = true;
                    //btnSaveSettlement.Enabled = true;
                    //btnDeleteSettlement.Enabled = true;

                    //tbCMMManager.TabPages.Insert(5, tbpgMedicalBill);
                    //tbCMMManager.SelectedIndex = 5;


                    // Med Bill fields initialization
                    cbMedBillClosed.SelectedIndex = 0;
                    txtMedBillAmount.Text = String.Empty;
                    txtBalance.Text = String.Empty;
                    rbOutpatient.Checked = false;
                    rbInpatient.Checked = false;
                    txtMedBillNote.Text = String.Empty;

                    // Prescription fields initialization
                    txtMedBillAmount.Text = String.Empty;
                    txtBalance.Text = String.Empty;
                    txtPrescriptionName.Text = String.Empty;
                    txtNumberOfMedication.Text = String.Empty;
                    txtPrescriptionDescription.Text = String.Empty;
                    txtPrescriptionNote.Text = String.Empty;

                    // Physical Therapy fields initialization
                    txtMedBillAmount.Text = String.Empty;
                    txtBalance.Text = String.Empty;
                    txtNumPhysicalTherapy.Text = String.Empty;
                    txtPhysicalTherapyRxNote.Text = String.Empty;



                    // Prepare settlement gridview



                    //// Etc group
                    //txtMedBillAccountNoAtProvider.Text = String.Empty;
                    //txtMedProviderPhoneNo.Text = String.Empty;
                    //txtProviderContactPerson.Text = String.Empty;

                    //tbCMMManager.TabPages.Remove(tbpgCreateCase);
                    //tbCMMManager.TabPages.Insert(5, tbpgMedicalBill);
                    //tbCMMManager.SelectedIndex = 5;

                    EnableMedicalBillForm();

                    btnMedBillCreatePgUpperSave.Enabled = true;
                    //btnMedBillCreationPgLowerSave.Enabled = true;

                    tbCMMManager.SelectedTab = tbpgMedicalBill;

                }
                else
                {
                    MessageBox.Show("Please create a case first.", "Alert");
                }
            }
            //else if (PrevTabPage == TabPage.CaseView)
            else
            {
                if (gvCaseViewCaseHistory.Rows.Count > 0)
                {
                    InitializeMedBillTabOnNewMedBill();
                    //nRowSelected = gvCaseViewCaseHistory.CurrentCell.RowIndex;

                    txtIndividualIDMedBill.Text = strIndividualId.Trim();

                    if (strPatientMiddleName != String.Empty) txtPatientNameMedBill.Text = strPatientLastName + ", " + strPatientFirstName + " " + strPatientMiddleName;
                    else txtPatientNameMedBill.Text = strPatientLastName + ", " + strPatientFirstName;

                    txtMedBillDOB.Text = strDateOfBirth;
                    txtMedBillSSN.Text = strSSN;
                    txtMedBillAddress.Text = strStreetAddr + ", " + strCity + ", " + strState + " " + strZip;

                    //strCaseNameSelected = gvCaseViewCaseHistory["CaseName", nRowSelected].Value.ToString().Trim();
                    strCaseNameSelected = txtCaseName.Text.Trim();
                    strCaseIdSelected = strCaseNameSelected;
                    //strContactIdSelected = gvCaseViewCaseHistory["Individual_Id", nRowSelected].Value.ToString().Trim();
                    strContactIdSelected = strIndividualId;

                    strCaseIdForIllness = strCaseNameSelected;
                    txtMedBill_CaseNo.Text = strCaseNameSelected;
                    txtMemberProgram.Text = strCurrentProgram;
                    //txtMedicalBillStatus.Text = "Pending Status";


                    String strSqlQueryForCase = "select dbo.tbl_case.Case_Name, dbo.tbl_case.[NPF_Form], dbo.tbl_case.[NPF_Form_File_Name], dbo.tbl_case.[NPF_Receiv_Date], " +
                                                "dbo.tbl_case.[IB_Form], dbo.tbl_case.[IB_Form_File_Name], dbo.tbl_case.[IB_Receiv_Date], " +
                                                "dbo.tbl_case.[POP_Form], dbo.tbl_case.[POP_Form_File_Name], dbo.tbl_case.[POP_Receiv_Date], " +
                                                "dbo.tbl_case.[MedRec_Form], dbo.tbl_case.[MedRec_Form_File_Name], dbo.tbl_case.[MedRec_Receiv_Date], " +
                                                "dbo.tbl_case.[Unknown_Form], dbo.tbl_case.[Unknown_Form_File_Name], dbo.tbl_case.[Unknown_Receiv_Date] " +
                                                "from dbo.tbl_case where Case_Name = @CaseId";

                    SqlCommand cmdQueryForDocumentReceivedDate = new SqlCommand(strSqlQueryForCase, connRN4);
                    cmdQueryForDocumentReceivedDate.CommandType = CommandType.Text;

                    cmdQueryForDocumentReceivedDate.Parameters.AddWithValue("@CaseId", strCaseNameSelected);

                    //if (connRN.State == ConnectionState.Closed) connRN.Open();
                    if (connRN4.State != ConnectionState.Closed)
                    {
                        connRN4.Close();
                        connRN4.Open();
                    }
                    else if (connRN4.State == ConnectionState.Closed) connRN4.Open();
                    SqlDataReader rdrDocsReceivedDate = cmdQueryForDocumentReceivedDate.ExecuteReader();

                    if (rdrDocsReceivedDate.HasRows)
                    {
                        rdrDocsReceivedDate.Read();

                        if (rdrDocsReceivedDate.GetBoolean(1) == true)
                        {
                            chkMedBillNPFReceived.Checked = true;
                            dtpMedBillNPF.Format = DateTimePickerFormat.Short;
                            dtpMedBillNPF.Value = rdrDocsReceivedDate.GetDateTime(3);
                            btnViewNPF.Enabled = true;
                        }
                        else
                        {
                            dtpMedBillNPF.Format = DateTimePickerFormat.Custom;
                            dtpMedBillNPF.CustomFormat = " ";
                            btnViewNPF.Enabled = false;
                        }

                        chkMedBillNPFReceived.Enabled = false;

                        if (rdrDocsReceivedDate.GetBoolean(4) == true)
                        {
                            chkMedBill_IBReceived.Checked = true;
                            dtpMedBill_IB.Format = DateTimePickerFormat.Short;
                            dtpMedBill_IB.Value = rdrDocsReceivedDate.GetDateTime(6);
                            btnViewIB.Enabled = true;
                        }
                        else
                        {
                            dtpMedBill_IB.Format = DateTimePickerFormat.Custom;
                            dtpMedBill_IB.CustomFormat = " ";
                            btnViewIB.Enabled = false;
                        }

                        chkMedBill_IBReceived.Enabled = false;

                        if (rdrDocsReceivedDate.GetBoolean(7) == true)
                        {
                            chkMedBillPOPReceived.Checked = true;
                            dtpMedBillPOP.Format = DateTimePickerFormat.Short;
                            dtpMedBillPOP.Value = rdrDocsReceivedDate.GetDateTime(9);
                            btnViewPoP.Enabled = true;
                        }
                        else
                        {
                            dtpMedBillPOP.Format = DateTimePickerFormat.Custom;
                            dtpMedBillPOP.CustomFormat = " ";
                            btnViewPoP.Enabled = false;
                        }

                        chkMedBillPOPReceived.Enabled = false;

                        if (rdrDocsReceivedDate.GetBoolean(10) == true)
                        {
                            chkMedRecordReceived.Checked = true;
                            dtpMedBillMedRecord.Format = DateTimePickerFormat.Short;
                            dtpMedBillMedRecord.Value = rdrDocsReceivedDate.GetDateTime(12);
                            btnViewMedRecord.Enabled = true;
                        }
                        else
                        {
                            dtpMedBillMedRecord.Format = DateTimePickerFormat.Custom;
                            dtpMedBillMedRecord.CustomFormat = " ";
                            btnViewMedRecord.Enabled = false;
                        }

                        chkMedRecordReceived.Enabled = false;

                        if (rdrDocsReceivedDate.GetBoolean(13) == true)
                        {
                            chkOtherDocReceived.Checked = true;
                            dtpMedBillOtherDoc.Format = DateTimePickerFormat.Short;
                            dtpMedBillOtherDoc.Value = rdrDocsReceivedDate.GetDateTime(15);
                            btnViewOtherDoc.Enabled = true;
                        }
                        else
                        {
                            dtpMedBillOtherDoc.Format = DateTimePickerFormat.Custom;
                            dtpMedBillOtherDoc.CustomFormat = " ";
                            btnViewOtherDoc.Enabled = false;
                        }

                        chkOtherDocReceived.Enabled = false;

                    }
                    rdrDocsReceivedDate.Close();
                    if (connRN4.State != ConnectionState.Closed) connRN4.Close();


                    //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

                    String strQueryForICD10Codes = "select dbo.[ICD10 Code].ID, dbo.[ICD10 Code].ICD10_CODE__C, dbo.[ICD10 Code].Name from [dbo].[ICD10 Code]";

                    SqlCommand cmdQueryForICD10Codes = new SqlCommand(strQueryForICD10Codes, connSalesforce3);

                    cmdQueryForICD10Codes.CommandType = CommandType.Text;
                    cmdQueryForICD10Codes.CommandText = strQueryForICD10Codes;

                    //if (connSalesforce.State == ConnectionState.Closed) connSalesforce.Open();
                    if (connSalesforce3.State == ConnectionState.Open)
                    {
                        connSalesforce3.Close();
                        connSalesforce3.Open();
                    }
                    else if (connSalesforce3.State == ConnectionState.Closed) connSalesforce3.Open();
                    SqlDataReader rdrICD10Codes = cmdQueryForICD10Codes.ExecuteReader();

                    lstICD10CodeInfo.Clear();
                    if (rdrICD10Codes.HasRows)
                    {
                        while (rdrICD10Codes.Read())
                        {
                            lstICD10CodeInfo.Add(new ICD10CodeInfo { Id = rdrICD10Codes.GetString(0), ICD10Code = rdrICD10Codes.GetString(1), Name = rdrICD10Codes.GetString(2) });
                        }
                    }
                    rdrICD10Codes.Close();
                    if (connSalesforce3.State != ConnectionState.Closed) connSalesforce3.Close();

                    var srcICD10Codes = new AutoCompleteStringCollection();

                    for (int i = 0; i < lstICD10CodeInfo.Count; i++)
                    {
                        srcICD10Codes.Add(lstICD10CodeInfo[i].ICD10Code);
                    }

                    txtMedBill_ICD10Code.AutoCompleteMode = AutoCompleteMode.SuggestAppend;
                    txtMedBill_ICD10Code.AutoCompleteSource = AutoCompleteSource.CustomSource;
                    txtMedBill_ICD10Code.AutoCompleteCustomSource = srcICD10Codes;

                    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                    ///

                    String strSqlQueryForCountMedBill = "select count([dbo].[tbl_medbill].[BillNo]) from [dbo].[tbl_medbill]";

                    SqlCommand cmdQueryForCountMedBill = new SqlCommand(strSqlQueryForCountMedBill, connRN4);
                    cmdQueryForCountMedBill.CommandType = CommandType.Text;

                    if (connRN4.State != ConnectionState.Closed)
                    {
                        connRN4.Close();
                        connRN4.Open();
                    }
                    else if (connRN4.State == ConnectionState.Closed) connRN4.Open();
                    int nMedBillCount = (int)cmdQueryForCountMedBill.ExecuteScalar();
                    if (connRN4.State != ConnectionState.Closed) connRN4.Close();

                    String strNewMedBillNo = String.Empty;
                    if (nMedBillCount > 0)
                    {
                        if (connRN4.State != ConnectionState.Closed)
                        {
                            connRN4.Close();
                            connRN4.Open();
                        }
                        else if (connRN4.State == ConnectionState.Closed) connRN4.Open();

                        SqlCommand cmdNewMedBillId = connRN4.CreateCommand();
                        SqlTransaction tranGetNewMedBillId = connRN4.BeginTransaction(IsolationLevel.Serializable);

                        cmdNewMedBillId.Connection = connRN4;
                        cmdNewMedBillId.Transaction = tranGetNewMedBillId;

                        try
                        {
                            String strSqlQueryForLastMedBillId = "select [dbo].[tbl_LastID].[MedBillId] from [dbo].[tbl_LastID] where [dbo].[tbl_LastID].[Id] = 1";
                            cmdNewMedBillId.CommandType = CommandType.Text;
                            cmdNewMedBillId.CommandText = strSqlQueryForLastMedBillId;

                            Object objLastMedBillNo = cmdNewMedBillId.ExecuteScalar();

                            String NewMedBillNo = String.Empty;
                            if (objLastMedBillNo != null) NewMedBillNo = objLastMedBillNo.ToString();

                            int nNewMedBillNo = Int32.Parse(NewMedBillNo.Substring(10));
                            nNewMedBillNo++;

                            int nLeadingZero = 0;
                            while ((nNewMedBillNo.ToString().Length + nLeadingZero) < 7) nLeadingZero++;
                            strNewMedBillNo = "RNMEDBILL-";
                            for (int i = 0; i < nLeadingZero; i++) strNewMedBillNo += '0';

                            strNewMedBillNo += nNewMedBillNo.ToString();

                            String strSqlUpdateLastMedBillId = "update [dbo].[tbl_LastID] set [dbo].[tbl_LastID].[MedBillId] = @NewMedBillId where [dbo].[tbl_LastID].[Id] = 1";
                            cmdNewMedBillId.CommandType = CommandType.Text;
                            cmdNewMedBillId.CommandText = strSqlUpdateLastMedBillId;

                            cmdNewMedBillId.Parameters.AddWithValue("@NewMedBillId", strNewMedBillNo);

                            int nNewMedBillNoUpdated = cmdNewMedBillId.ExecuteNonQuery();

                            tranGetNewMedBillId.Commit();
                        }
                        catch (Exception ex)
                        {
                            try
                            {
                                tranGetNewMedBillId.Rollback();
                                MessageBox.Show(ex.Message, "Error");
                                return;
                            }
                            catch (SqlException se)
                            {
                                MessageBox.Show(se.Message, "Sql Error");
                                return;
                            }
                        }

                        if (connRN4.State != ConnectionState.Closed) connRN4.Close();
                    }
                    else
                    {
                        strNewMedBillNo = "RNMEDBILL-0150000";

                        if (connRN4.State != ConnectionState.Closed)
                        {
                            connRN4.Close();
                            connRN4.Open();
                        }
                        else if (connRN4.State == ConnectionState.Closed) connRN4.Open();

                        SqlCommand cmdNewMedBillId = connRN4.CreateCommand();
                        SqlTransaction tranGetNewMedBillId = connRN4.BeginTransaction(IsolationLevel.Serializable);

                        cmdNewMedBillId.Connection = connRN4;
                        cmdNewMedBillId.Transaction = tranGetNewMedBillId;

                        try
                        {
                            String strSqlUpdateLastMedBillId = "update [dbo].[tbl_LastID] set [dbo].[tbl_LastID].[MedBillId] = @NewMedBillId where [dbo].[tbl_LastID].[Id] = 1";
                            cmdNewMedBillId.CommandType = CommandType.Text;
                            cmdNewMedBillId.CommandText = strSqlUpdateLastMedBillId;

                            cmdNewMedBillId.Parameters.AddWithValue("@NewMedBillId", strNewMedBillNo);

                            int nNewMedBillNoUpdated = cmdNewMedBillId.ExecuteNonQuery();

                            tranGetNewMedBillId.Commit();
                        }
                        catch (Exception ex)
                        {
                            try
                            {
                                tranGetNewMedBillId.Rollback();
                                MessageBox.Show(ex.Message, "Error");
                                return;
                            }
                            catch (SqlException se)
                            {
                                MessageBox.Show(se.Message, "Sql Error");
                                return;
                            }
                        }

                        if (connRN4.State != ConnectionState.Closed) connRN4.Close();

                    }
                    /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                    //String strSqlQueryForMaxMedBillNo = "select max(dbo.tbl_medbill.BillNo) from dbo.tbl_medbill";

                    //SqlCommand cmdQueryForMaxBillNo = new SqlCommand(strSqlQueryForMaxMedBillNo, connRN4);
                    //cmdQueryForMaxBillNo.CommandType = CommandType.Text;

                    ////if (connRN.State == ConnectionState.Closed) connRN.Open();
                    //if (connRN4.State != ConnectionState.Closed)
                    //{
                    //    connRN4.Close();
                    //    connRN4.Open();
                    //}
                    //else if (connRN4.State == ConnectionState.Closed) connRN4.Open();
                    ////String strMaxMedBillNo = cmdQueryForMaxBillNo.ExecuteScalar().ToString();
                    //Object objMaxMedBillNo = cmdQueryForMaxBillNo.ExecuteScalar();
                    //if (connRN4.State != ConnectionState.Closed) connRN4.Close();

                    //String strMaxMedBillNo = String.Empty;

                    //if (objMaxMedBillNo != null) strMaxMedBillNo = objMaxMedBillNo.ToString();

                    //String strNewMedBillNo = String.Empty;

                    //if (strMaxMedBillNo != String.Empty)
                    //{
                    //    int nNewMedBillNo = Int32.Parse(strMaxMedBillNo.Substring(8));
                    //    nNewMedBillNo++;
                    //    int nLeadingZero = 0;
                    //    while ((nNewMedBillNo.ToString().Length + nLeadingZero) < 7) nLeadingZero++;
                    //    strNewMedBillNo = "MEDBILL-";
                    //    for (int i = 0; i < nLeadingZero; i++) strNewMedBillNo += '0';

                    //    strNewMedBillNo += nNewMedBillNo.ToString();
                    //}
                    //else strNewMedBillNo = "MEDBILL - 0150000";
                    txtMedBillNo.Text = strNewMedBillNo;

                    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                    /// Populate the medical bill types
                    /// 
                    //String strSqlQueryForMedBillTypes = "select [dbo].[tbl_medbill_type].[MedBillTypeId], [dbo].[tbl_medbill_type].[MedBillTypeName] from [dbo].[tbl_medbill_type]";
                    String strSqlQueryForMedBillTypes = "select [dbo].[tbl_medbill_type].[MedBillTypeName] from [dbo].[tbl_medbill_type]";

                    SqlCommand cmdQueryForMedBillTypes = new SqlCommand(strSqlQueryForMedBillTypes, connRN4);
                    cmdQueryForMedBillTypes.CommandType = CommandType.Text;

                    //if (connRN.State == ConnectionState.Closed) connRN.Open();
                    if (connRN4.State != ConnectionState.Closed)
                    {
                        connRN4.Close();
                        connRN4.Open();
                    }
                    else if (connRN4.State == ConnectionState.Closed) connRN4.Open();
                    SqlDataReader rdrMedBillTypes = cmdQueryForMedBillTypes.ExecuteReader();
                    comboMedBillType.Items.Clear();

                    if (rdrMedBillTypes.HasRows)
                    {
                        while (rdrMedBillTypes.Read())
                        {
                            if (!rdrMedBillTypes.IsDBNull(0)) comboMedBillType.Items.Add(rdrMedBillTypes.GetString(0));
                        }
                    }
                    rdrMedBillTypes.Close();
                    if (connRN4.State != ConnectionState.Closed) connRN4.Close();
                    comboMedBillType.SelectedIndex = (int)MedBillType.MedicalBill - 1;

                    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                    /// Populate the medical bill status
                    /// 
                    comboMedBillStatus.Items.Clear();
                    if (dicMedBillStatus.Count > 0)
                    {
                        for (int i = 0; i < dicMedBillStatus.Count; i++)
                        {
                            comboMedBillStatus.Items.Add(dicMedBillStatus[i]);
                        }
                        comboMedBillStatus.SelectedIndex = 0;
                    }

                    //foreach (MedBillStatusInfo info in lstMedBillStatusInfo)
                    //{
                    //    if (info.IsDeleted == false)
                    //    {
                    //        comboMedBillStatus.Items.Add(info.BillStatusValue);
                    //    }
                    //}

                    // Populate Pending Reason
                    comboPendingReason.Items.Clear();
                    if (dicPendingReason.Count > 0)
                    {
                        for (int i = 0; i < dicPendingReason.Count; i++)
                        {
                            comboPendingReason.Items.Add(dicPendingReason[i]);
                        }
                        comboPendingReason.SelectedIndex = 0;
                    }
                    //comboPendingReason.Sorted = true;

                    // Populate Ineligible Reason
                    comboIneligibleReason.Items.Clear();
                    if (dicIneligibleReason.Count > 0)
                    {
                        for (int i = 0; i < dicIneligibleReason.Count; i++)
                        {
                            comboIneligibleReason.Items.Add(dicIneligibleReason[i]);
                        }
                        comboIneligibleReason.SelectedIndex = 0;
                    }

                    //comboIneligibleReason.Sorted = true;

                    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                    //String strSqlQueryForMedicalProvider = "select dbo.tbl_MedicalProvider.ID, dbo.tbl_MedicalProvider.Name, dbo.tbl_MedicalProvider.Type from dbo.tbl_MedicalProvider";

                    //SqlCommand cmdQueryForMedicalProvider = new SqlCommand(strSqlQueryForMedicalProvider, connRN4);
                    //cmdQueryForMedicalProvider.CommandType = CommandType.Text;

                    ////if (connRN.State == ConnectionState.Closed) connRN.Open();
                    //if (connRN4.State != ConnectionState.Closed)
                    //{
                    //    connRN4.Close();
                    //    connRN4.Open();
                    //}
                    //else if (connRN4.State == ConnectionState.Closed) connRN4.Open();

                    //SqlDataReader rdrMedicalProvider = cmdQueryForMedicalProvider.ExecuteReader();

                    //lstMedicalProvider.Clear();
                    //if (rdrMedicalProvider.HasRows)
                    //{
                    //    while (rdrMedicalProvider.Read())
                    //    {
                    //        MedicalProviderInfo info = new MedicalProviderInfo();

                    //        if (!rdrMedicalProvider.IsDBNull(0)) info.ID = rdrMedicalProvider.GetString(0);
                    //        if (!rdrMedicalProvider.IsDBNull(1)) info.Name = rdrMedicalProvider.GetString(1);
                    //        if (!rdrMedicalProvider.IsDBNull(2)) info.Type = rdrMedicalProvider.GetString(2);

                    //        lstMedicalProvider.Add(info);
                    //    }
                    //}

                    //if (connRN4.State != ConnectionState.Closed) connRN4.Close();

                    var srcMedicalProvider = new AutoCompleteStringCollection();

                    for (int i = 0; i < lstMedicalProvider.Count; i++)
                    {
                        srcMedicalProvider.Add(lstMedicalProvider[i].Name);
                    }

                    txtMedicalProvider.AutoCompleteMode = AutoCompleteMode.SuggestAppend;
                    txtMedicalProvider.AutoCompleteSource = AutoCompleteSource.CustomSource;
                    txtMedicalProvider.AutoCompleteCustomSource = srcMedicalProvider;

                    // Prepare settlement gv
                    //String strSqlQueryForSettlement = "select [dbo].[tbl_settlement].[Name], [dbo].[tbl_settlement_type_code].[SettlementTypeValue], [dbo].[tbl_settlement].[Amount], " +
                    //          "[dbo].[tbl_settlement].[PersonalResponsibilityCredit], [dbo].[tbl_payment_method].[PaymentMethod_Value], " +
                    //          "[dbo].[tbl_settlement].[Approved], [dbo].[tbl_settlement].[ApprovedDate], " +
                    //          "[dbo].[tbl_settlement].[CheckNo], [dbo].[tbl_settlement].[CheckDate], [dbo].[tbl_settlement].[CheckReconciled], " +
                    //          "[dbo].[tbl_settlement].[ACH_Number], [dbo].[tbl_settlement].[ACH_Date], [dbo].[tbl_settlement].[ACH_Reconciled], " +
                    //          "[dbo].[tbl_Credit_Card__c].[Name], [dbo].[tbl_settlement].[CMMCreditCardPaidDate], [dbo].[tbl_settlement].[CC_Reconciled], " +
                    //          "[dbo].[tbl_settlement].[AllowedAmount], [dbo].[tbl_settlement].[IneligibleReason], " +
                    //          "[dbo].[tbl_settlement].[Notes] " +
                    //          "from [dbo].[tbl_settlement] inner join [dbo].[tbl_settlement_type_code] " +
                    //          "on [dbo].[tbl_settlement].[SettlementType] = [dbo].[tbl_settlement_type_code].[SettlementTypeCode] " +
                    //          "inner join [dbo].[tbl_payment_method] on [dbo].[tbl_settlement].[CMMPaymentMethod] = [dbo].[tbl_payment_method].[PaymentMethod_Id] " +
                    //          "inner join [dbo].[tbl_Credit_Card__c] on [dbo].[tbl_settlement].[CMMCreditCard] = [dbo].[tbl_Credit_Card__c].[CreditCard_Id]" +
                    //          "where [dbo].[tbl_settlement].[MedicalBillID] = @MedBillNo and " +
                    //          "[dbo].[tbl_settlement].[IsDeleted] = 0 " +
                    //          "order by [dbo].[tbl_settlement].[Name]";

                    //SqlCommand cmdQueryForSettlement = new SqlCommand(strSqlQueryForSettlement, connRN);
                    //cmdQueryForSettlement.CommandType = CommandType.Text;

                    //cmdQueryForSettlement.Parameters.AddWithValue("@MedBillNo", MedBillNo);

                    //SqlDependency dependencySettlementInMedBill = new SqlDependency(cmdQueryForSettlement);
                    //dependencySettlementInMedBill.OnChange += new OnChangeEventHandler(OnSettlementsInMedBillEditChange);

                    ////if (connRN.State == ConnectionState.Closed) connRN.Open();
                    //if (connRN.State != ConnectionState.Closed)
                    //{
                    //    connRN.Close();
                    //    connRN.Open();
                    //}
                    //else if (connRN.State == ConnectionState.Closed) connRN.Open();
                    //SqlDataReader rdrSettlement = cmdQueryForSettlement.ExecuteReader();
                    //gvSettlementsInMedBill.Rows.Clear();
                    //if (rdrSettlement.HasRows)
                    //{
                    //    while (rdrSettlement.Read())
                    //    {
                    //        DataGridViewRow row = new DataGridViewRow();
                    //        row.Cells.Add(new DataGridViewCheckBoxCell { Value = false });
                    //        if (!rdrSettlement.IsDBNull(0)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlement.GetString(0) });
                    //        if (!rdrSettlement.IsDBNull(1))
                    //        {
                    //            DataGridViewComboBoxCell comboCellSettlementType = new DataGridViewComboBoxCell();

                    //            for (int i = 0; i < lstSettlementType.Count; i++)
                    //            {
                    //                comboCellSettlementType.Items.Add(lstSettlementType[i].SettlementTypeValue);
                    //            }
                    //            for (int i = 0; i < comboCellSettlementType.Items.Count; i++)
                    //            {
                    //                if (rdrSettlement.GetString(1) == comboCellSettlementType.Items[i].ToString())
                    //                    comboCellSettlementType.Value = comboCellSettlementType.Items[i];
                    //            }

                    //            row.Cells.Add(comboCellSettlementType);
                    //        }
                    //        else
                    //        {
                    //            DataGridViewComboBoxCell comboCellSettlementType = new DataGridViewComboBoxCell();
                    //            for (int i = 0; i < lstSettlementType.Count; i++)
                    //            {
                    //                comboCellSettlementType.Items.Add(lstSettlementType[i].SettlementTypeValue);
                    //            }

                    //            for (int i = 0; i < comboCellSettlementType.Items.Count; i++)
                    //            {
                    //                if (rdrSettlement.GetString(1) == comboCellSettlementType.Items[i].ToString())
                    //                    comboCellSettlementType.Value = comboCellSettlementType.Items[i];
                    //            }

                    //            row.Cells.Add(comboCellSettlementType);
                    //        }

                    //        if (!rdrSettlement.IsDBNull(2)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlement.GetDecimal(2).ToString("C") });
                    //        else
                    //        {
                    //            Decimal Zero = 0;
                    //            row.Cells.Add(new DataGridViewTextBoxCell { Value = Zero.ToString("C") });
                    //        }


                    //        if (!rdrSettlement.IsDBNull(3)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlement.GetDecimal(3).ToString("C") });
                    //        else
                    //        {
                    //            Decimal Zero = 0;
                    //            row.Cells.Add(new DataGridViewTextBoxCell { Value = Zero.ToString("C") });
                    //        }

                    //        /////////////////////////////////////////////////////////////////////
                    //        if (!rdrSettlement.IsDBNull(4))
                    //        {
                    //            DataGridViewComboBoxCell comboCellPaymentMethod = new DataGridViewComboBoxCell();

                    //            for (int i = 0; i < lstPaymentMethod.Count; i++)
                    //            {
                    //                if (lstPaymentMethod[i].PaymentMethodValue != null) comboCellPaymentMethod.Items.Add(lstPaymentMethod[i].PaymentMethodValue);
                    //                else comboCellPaymentMethod.Items.Add(String.Empty);
                    //            }

                    //            for (int i = 0; i < comboCellPaymentMethod.Items.Count; i++)
                    //            {
                    //                if (rdrSettlement.GetString(4) == comboCellPaymentMethod.Items[i].ToString())
                    //                    comboCellPaymentMethod.Value = comboCellPaymentMethod.Items[i];
                    //            }

                    //            row.Cells.Add(comboCellPaymentMethod);
                    //        }
                    //        else
                    //        {
                    //            DataGridViewComboBoxCell comboCellPaymentMethod = new DataGridViewComboBoxCell();

                    //            for (int i = 0; i < lstPaymentMethod.Count; i++)
                    //            {
                    //                if (lstPaymentMethod[i].PaymentMethodValue != null) comboCellPaymentMethod.Items.Add(lstPaymentMethod[i].PaymentMethodValue);
                    //                else comboCellPaymentMethod.Items.Add(String.Empty);
                    //                //comboCellPaymentMethod.Items.Add(lstPaymentMethod[i].PaymentMethodValue);
                    //            }

                    //            for (int i = 0; i < comboCellPaymentMethod.Items.Count; i++)
                    //            {
                    //                if ((!rdrSettlement.IsDBNull(4)) && comboCellPaymentMethod.Items[i] != null)
                    //                {
                    //                    if (rdrSettlement.GetString(4) == comboCellPaymentMethod.Items[i].ToString())
                    //                        comboCellPaymentMethod.Value = comboCellPaymentMethod.Items[i];
                    //                }
                    //                else comboCellPaymentMethod.Value = null;
                    //            }

                    //            row.Cells.Add(comboCellPaymentMethod);

                    //        }

                    //        /////////////////////////////////////////////////////////////////////
                    //        if (!rdrSettlement.IsDBNull(5))
                    //        {

                    //            DataGridViewCheckBoxCell approvedCell = new DataGridViewCheckBoxCell();
                    //            approvedCell.Value = rdrSettlement.GetBoolean(5);
                    //            approvedCell.Style.Alignment = DataGridViewContentAlignment.MiddleCenter;
                    //            row.Cells.Add(approvedCell);
                    //        }
                    //        else
                    //        {
                    //            DataGridViewCheckBoxCell approvedCell = new DataGridViewCheckBoxCell();
                    //            approvedCell.Value = false;
                    //            approvedCell.Style.Alignment = DataGridViewContentAlignment.MiddleCenter;
                    //            row.Cells.Add(approvedCell);
                    //        }

                    //        if (!rdrSettlement.IsDBNull(6)) row.Cells.Add(new CalendarCell { Value = DateTime.Parse(rdrSettlement.GetDateTime(6).ToString("MM/dd/yyyy")) });
                    //        else row.Cells.Add(new CalendarCell { Value = null });

                    //        // Payment information
                    //        if (!rdrSettlement.IsDBNull(4))
                    //        {
                    //            String strPaymentMethod = rdrSettlement.GetString(4);

                    //            switch (strPaymentMethod)
                    //            {
                    //                case "Check":
                    //                    if (!rdrSettlement.IsDBNull(7)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlement.GetString(7) });
                    //                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = null });
                    //                    row.Cells.Add(new DataGridViewTextBoxCell { Value = null });
                    //                    DataGridViewComboBoxCell comboCellCreditCardNoneForCheck = new DataGridViewComboBoxCell();
                    //                    for (int i = 0; i < lstCreditCardInfo.Count; i++)
                    //                    {
                    //                        if (lstCreditCardInfo[i].CreditCardNo != null) comboCellCreditCardNoneForCheck.Items.Add(lstCreditCardInfo[i].CreditCardNo);
                    //                        else comboCellCreditCardNoneForCheck.Items.Add(String.Empty);
                    //                    }
                    //                    row.Cells.Add(comboCellCreditCardNoneForCheck);
                    //                    if (!rdrSettlement.IsDBNull(8)) row.Cells.Add(new CalendarCell { Value = DateTime.Parse(rdrSettlement.GetDateTime(8).ToString("MM/dd/yyyy")) });
                    //                    if (!rdrSettlement.IsDBNull(9)) row.Cells.Add(new DataGridViewCheckBoxCell { Value = rdrSettlement.GetBoolean(9) });
                    //                    break;
                    //                case "ACH/Banking":
                    //                    row.Cells.Add(new DataGridViewTextBoxCell { Value = null });
                    //                    if (!rdrSettlement.IsDBNull(10)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlement.GetString(10) });
                    //                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = null });
                    //                    DataGridViewComboBoxCell comboCellCreditCardNoneForACH = new DataGridViewComboBoxCell();
                    //                    for (int i = 0; i < lstCreditCardInfo.Count; i++)
                    //                    {
                    //                        if (lstCreditCardInfo[i].CreditCardNo != null)
                    //                            comboCellCreditCardNoneForACH.Items.Add(lstCreditCardInfo[i].CreditCardNo);
                    //                        else comboCellCreditCardNoneForACH.Items.Add(String.Empty);
                    //                    }
                    //                    row.Cells.Add(comboCellCreditCardNoneForACH);
                    //                    if (!rdrSettlement.IsDBNull(11)) row.Cells.Add(new CalendarCell { Value = DateTime.Parse(rdrSettlement.GetDateTime(11).ToString("MM/dd/yyyy")) });
                    //                    if (!rdrSettlement.IsDBNull(12)) row.Cells.Add(new DataGridViewCheckBoxCell { Value = rdrSettlement.GetBoolean(12) });
                    //                    break;
                    //                case "Credit Card":
                    //                    row.Cells.Add(new DataGridViewTextBoxCell { Value = null });
                    //                    row.Cells.Add(new DataGridViewTextBoxCell { Value = null });
                    //                    DataGridViewComboBoxCell comboCellCreditCard = new DataGridViewComboBoxCell();
                    //                    if (!rdrSettlement.IsDBNull(13))
                    //                    {
                    //                        for (int i = 0; i < lstCreditCardInfo.Count; i++)
                    //                        {
                    //                            if (lstCreditCardInfo[i].CreditCardNo != null) comboCellCreditCard.Items.Add(lstCreditCardInfo[i].CreditCardNo);
                    //                            else comboCellCreditCard.Items.Add(String.Empty);
                    //                        }
                    //                        for (int i = 0; i < comboCellCreditCard.Items.Count; i++)
                    //                        {
                    //                            if (rdrSettlement.GetString(13) == comboCellCreditCard.Items[i].ToString())
                    //                                comboCellCreditCard.Value = comboCellCreditCard.Items[i];
                    //                        }
                    //                    }
                    //                    else
                    //                    {
                    //                        //DataGridViewComboBoxCell comboCellCreditCard = new DataGridViewComboBoxCell();
                    //                        for (int i = 0; i < lstCreditCardInfo.Count; i++)
                    //                        {
                    //                            if (lstCreditCardInfo[i].CreditCardNo != null) comboCellCreditCard.Items.Add(lstCreditCardInfo[i].CreditCardNo);
                    //                            else comboCellCreditCard.Items.Add(String.Empty);
                    //                        }
                    //                        comboCellCreditCard.Value = String.Empty;
                    //                        //row.Cells.Add(comboCellCreditCard);
                    //                    }
                    //                    row.Cells.Add(comboCellCreditCard);
                    //                    if (!rdrSettlement.IsDBNull(14)) row.Cells.Add(new CalendarCell { Value = DateTime.Parse(rdrSettlement.GetDateTime(14).ToString("MM/dd/yyyy")) });
                    //                    else row.Cells.Add(new CalendarCell { Value = String.Empty });
                    //                    if (!rdrSettlement.IsDBNull(15)) row.Cells.Add(new DataGridViewCheckBoxCell { Value = rdrSettlement.GetBoolean(15) });
                    //                    else row.Cells.Add(new DataGridViewCheckBoxCell { Value = false });
                    //                    break;
                    //                default:
                    //                    row.Cells.Add(new DataGridViewTextBoxCell { Value = null });
                    //                    row.Cells.Add(new DataGridViewTextBoxCell { Value = null });
                    //                    DataGridViewComboBoxCell comboCellCreditCardNone = new DataGridViewComboBoxCell();
                    //                    for (int i = 0; i < lstCreditCardInfo.Count; i++)
                    //                    {
                    //                        if (lstCreditCardInfo[i].CreditCardNo != null) comboCellCreditCardNone.Items.Add(lstCreditCardInfo[i].CreditCardNo);
                    //                        else comboCellCreditCardNone.Items.Add(String.Empty);
                    //                    }
                    //                    row.Cells.Add(comboCellCreditCardNone);
                    //                    row.Cells.Add(new CalendarCell { Value = null });
                    //                    row.Cells.Add(new DataGridViewCheckBoxCell { Value = null });
                    //                    break;
                    //            }
                    //        }
                    //        else
                    //        {

                    //            DataGridViewTextBoxCell txtCheckNoCell = new DataGridViewTextBoxCell();
                    //            txtCheckNoCell.Value = null;
                    //            row.Cells.Add(txtCheckNoCell);
                    //            DataGridViewTextBoxCell txtACHNoCell = new DataGridViewTextBoxCell();
                    //            txtACHNoCell.Value = null;
                    //            row.Cells.Add(txtACHNoCell);
                    //            DataGridViewComboBoxCell comboCreditCardCell = new DataGridViewComboBoxCell();
                    //            for (int i = 0; i < lstCreditCardInfo.Count; i++)
                    //            {
                    //                if (lstCreditCardInfo[i].CreditCardNo != null) comboCreditCardCell.Items.Add(lstCreditCardInfo[i].CreditCardNo);
                    //                else comboCreditCardCell.Items.Add(String.Empty);
                    //            }
                    //            row.Cells.Add(comboCreditCardCell);
                    //            comboCreditCardCell.ReadOnly = true;
                    //            CalendarCell calPaymentDate = new CalendarCell();
                    //            calPaymentDate.Value = null;
                    //            row.Cells.Add(calPaymentDate);
                    //            DataGridViewCheckBoxCell chkReconciledCell = new DataGridViewCheckBoxCell();
                    //            chkReconciledCell.Value = false;
                    //            row.Cells.Add(chkReconciledCell);

                    //        }


                    //        if (!rdrSettlement.IsDBNull(16)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlement.GetDecimal(16).ToString("C") });
                    //        else row.Cells.Add(new DataGridViewTextBoxCell { Value = null });

                    //        if (!rdrSettlement.IsDBNull(17))
                    //        {
                    //            if (dicIneligibleReason.Count > 0)
                    //            {
                    //                DataGridViewComboBoxCell comboCellIneligibleReason = new DataGridViewComboBoxCell();
                    //                for (int i = 0; i < dicIneligibleReason.Count; i++)
                    //                {
                    //                    comboCellIneligibleReason.Items.Add(dicIneligibleReason[i]);
                    //                }
                    //                comboCellIneligibleReason.Value = comboCellIneligibleReason.Items[rdrSettlement.GetInt32(17)];
                    //                row.Cells.Add(comboCellIneligibleReason);
                    //            }
                    //        }
                    //        else
                    //        {
                    //            if (dicIneligibleReason.Count > 0)
                    //            {
                    //                DataGridViewComboBoxCell comboCellIneligibleReason = new DataGridViewComboBoxCell();
                    //                for (int i = 0; i < dicIneligibleReason.Count; i++)
                    //                {
                    //                    comboCellIneligibleReason.Items.Add(dicIneligibleReason[i]);
                    //                }
                    //                comboCellIneligibleReason.Value = comboCellIneligibleReason.Items[0];
                    //                row.Cells.Add(comboCellIneligibleReason);
                    //            }
                    //        }

                    //        if (!rdrSettlement.IsDBNull(18)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlement.GetString(18) });
                    //        else row.Cells.Add(new DataGridViewTextBoxCell { Value = null });

                    //        gvSettlementsInMedBill.Rows.Add(row);
                    //        //AddNewRowToGVSettlementSafely(row);
                    //    }
                    //}
                    //if (connRN.State != ConnectionState.Closed) connRN.Close();

                    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                    ///
                    //Decimal PersonalResponsibilityAmount = 0;

                    //foreach (IncidentProgramInfo incdProgram in lstIncidentProgramInfo)
                    //{
                    //    if (incdProgram.bPersonalResponsibilityProgram == true) PersonalResponsibilityAmount = incdProgram.PersonalResponsibilityAmount;
                    //}

                    //for (int i = 0; i < gvSettlementsInMedBill.Rows.Count; i++)
                    //{
                    //    if (gvSettlementsInMedBill["PersonalResponsibility", i]?.Value != null)
                    //    {
                    //        Decimal result = 0;
                    //        if (Decimal.TryParse(gvSettlementsInMedBill["PersonalResponsibility", i]?.Value?.ToString(), NumberStyles.Currency, new CultureInfo("en-US"), out result))
                    //        {
                    //            PersonalResponsibilityAmount -= result;
                    //        }
                    //    }
                    //}

                    //txtPersonalResponsibility.Text = PersonalResponsibilityAmount.ToString("C");

                    //if (PersonalResponsibilityAmount < 0) txtPersonalResponsibility.BackColor = Color.Yellow;

                    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////

                    for (int i = 0; i < gvSettlementsInMedBill.Rows.Count; i++)
                    {
                        if (gvSettlementsInMedBill["PaymentMethod", i]?.Value?.ToString() == "Check")
                        {
                            gvSettlementsInMedBill.Rows[i].Cells["CheckNo"].ReadOnly = false;
                            gvSettlementsInMedBill.Rows[i].Cells["PaymentDate"].ReadOnly = false;
                            gvSettlementsInMedBill.Rows[i].Cells["Reconciled"].ReadOnly = false;
                            gvSettlementsInMedBill.Rows[i].Cells["ACHNo"].ReadOnly = true;
                            gvSettlementsInMedBill.Rows[i].Cells["CreditCard"].ReadOnly = true;
                        }

                        if (gvSettlementsInMedBill["PaymentMethod", i]?.Value?.ToString() == "ACH/Banking")
                        {
                            gvSettlementsInMedBill.Rows[i].Cells["ACHNo"].ReadOnly = false;
                            gvSettlementsInMedBill.Rows[i].Cells["PaymentDate"].ReadOnly = false;
                            gvSettlementsInMedBill.Rows[i].Cells["Reconciled"].ReadOnly = false;
                            gvSettlementsInMedBill.Rows[i].Cells["CheckNo"].ReadOnly = true;
                            gvSettlementsInMedBill.Rows[i].Cells["CreditCard"].ReadOnly = true;
                        }

                        if (gvSettlementsInMedBill["PaymentMethod", i]?.Value?.ToString() == "Credit Card")
                        {
                            gvSettlementsInMedBill.Rows[i].Cells["CreditCard"].ReadOnly = false;
                            gvSettlementsInMedBill.Rows[i].Cells["PaymentDate"].ReadOnly = false;
                            gvSettlementsInMedBill.Rows[i].Cells["Reconciled"].ReadOnly = false;
                            gvSettlementsInMedBill.Rows[i].Cells["CheckNo"].ReadOnly = true;
                            gvSettlementsInMedBill.Rows[i].Cells["ACHNo"].ReadOnly = true;
                        }
                        if (gvSettlementsInMedBill["PaymentMethod", i]?.Value == null)
                        {
                            gvSettlementsInMedBill.Rows[i].Cells["CheckNo"].ReadOnly = true;
                            gvSettlementsInMedBill.Rows[i].Cells["ACHNo"].ReadOnly = true;
                            gvSettlementsInMedBill.Rows[i].Cells["CreditCard"].ReadOnly = true;
                            gvSettlementsInMedBill.Rows[i].Cells["PaymentDate"].ReadOnly = true;
                            gvSettlementsInMedBill.Rows[i].Cells["Reconciled"].ReadOnly = true;
                        }
                    }

                    for (int i = 0; i < gvSettlementsInMedBill.Rows.Count; i++)
                    {
                        if (gvSettlementsInMedBill[2, i]?.Value?.ToString() == "Ineligible") gvSettlementsInMedBill.Rows[i].DefaultCellStyle.BackColor = Color.Salmon;
                        else
                        {
                            gvSettlementsInMedBill["IneligibleReason", i].Value = null;
                            gvSettlementsInMedBill["IneligibleReason", i].ReadOnly = true;
                        }
                    }

                    if (txtMedBillAmount.Text.Trim() != String.Empty)
                    {
                        Decimal SettlementTotal = 0;
                        Decimal Balance = 0;
                        Decimal Result = 0;
                        Decimal BillAmount = 0;
                        if (Decimal.TryParse(txtMedBillAmount.Text.Trim(), NumberStyles.Currency, new CultureInfo("en-US"), out Result))
                        {
                            BillAmount = Result;

                            for (int i = 0; i < gvSettlementsInMedBill.Rows.Count; i++)
                            {
                                Decimal Settlement = Decimal.Parse(gvSettlementsInMedBill["SettlementAmount", i].Value.ToString(), NumberStyles.Currency, new CultureInfo("en-US"));
                                SettlementTotal += Settlement;
                            }
                            if (SettlementTotal > BillAmount) MessageBox.Show("Settlement Total exceeds the Medical Bill Amount.", "Alert");
                            else
                            {
                                Balance = BillAmount - SettlementTotal;
                                txtBalance.Text = Balance.ToString("C");
                            }
                        }
                    }

                    //btnAddNewSettlement.Enabled = true;
                    ////btnEditSettlement.Enabled = true;
                    //btnSaveSettlement.Enabled = true;
                    //btnDeleteSettlement.Enabled = true;

                    //tbCMMManager.TabPages.Insert(5, tbpgMedicalBill);
                    //tbCMMManager.SelectedIndex = 5;

                    // Med Bill fields initialization
                    txtMedBillAmount.Text = String.Empty;
                    txtBalance.Text = String.Empty;
                    rbOutpatient.Checked = false;
                    rbInpatient.Checked = false;
                    txtMedBillNote.Text = String.Empty;

                    // Prescription fields initialization
                    txtMedBillAmount.Text = String.Empty;
                    txtBalance.Text = String.Empty;
                    txtPrescriptionName.Text = String.Empty;
                    txtNumberOfMedication.Text = String.Empty;
                    txtPrescriptionDescription.Text = String.Empty;
                    txtPrescriptionNote.Text = String.Empty;

                    // Physical Therapy fields initialization
                    txtMedBillAmount.Text = String.Empty;
                    txtBalance.Text = String.Empty;
                    txtNumPhysicalTherapy.Text = String.Empty;
                    txtPhysicalTherapyRxNote.Text = String.Empty;

                    //// Etc group
                    //txtMedBillAccountNoAtProvider.Text = String.Empty;
                    //txtMedProviderPhoneNo.Text = String.Empty;
                    //txtProviderContactPerson.Text = String.Empty;

                    //tbCMMManager.TabPages.Remove(tbpgCreateCase);
                    //tbCMMManager.TabPages.Insert(5, tbpgMedicalBill);
                    //tbCMMManager.SelectedIndex = 5;

                    EnableMedicalBillForm();

                    btnMedBillCreatePgUpperSave.Enabled = true;
                    //btnMedBillCreationPgLowerSave.Enabled = true;
                    tbCMMManager.SelectedTab = tbpgMedicalBill;
                }
                else
                {
                    MessageBox.Show("Please create a case first", "Alert");
                }
            }



            /////////////////////////////////////////////////////////////////////////////////////////////////////
            //btnAddNewSettlement.Enabled = false;
            //btnSaveSettlement.Enabled = false;
            ////btnEditSettlement.Enabled = false;
            //btnDeleteSettlement.Enabled = false;

            //}
            //else MessageBox.Show("Medical Bill page is already open", "Alert");
        }

        private void InitializeMedBillTabOnNewMedBill()
        {
            txtMedBill_Illness.Text = String.Empty;
            txtMedBill_Incident.Text = String.Empty;
            txtIncdProgram.Text = String.Empty;
            txtMemberProgram.Text = String.Empty;

            txtMedBill_ICD10Code.Text = String.Empty;
            txtMedBillDiseaseName.Text = String.Empty;

            txtNPFMedBillFileName.Text = String.Empty;
            txtIBMedBillFileName.Text = String.Empty;
            txtPoPMedBillFileName.Text = String.Empty;
            txtMedRecMedBillFileName.Text = String.Empty;
            txtOtherDocMedBillFileName.Text = String.Empty;

            txtNPFMedBillFileName.Text = String.Empty;
            txtIBMedBillFileName.Text = String.Empty;
            txtPoPMedBillFileName.Text = String.Empty;
            txtMedRecMedBillFileName.Text = String.Empty;
            txtOtherDocMedBillFileName.Text = String.Empty;

            chkNPFMedBill.Checked = false;
            chkIBMedBill.Checked = false;
            chkPoPMedBill.Checked = false;
            chkMedRecMedBill.Checked = false;
            chkOtherDocMedBill.Checked = false;

            strNPFormFileNameMedBill = String.Empty;
            strNPFSourceFilePathMedBill = String.Empty;
            strNPFDestinationFilePathMedBill = String.Empty;

            strIBFileNameMedBill = String.Empty;
            strIBSourceFilePathMedBill = String.Empty;
            strIBDestinationFilePathMedBill = String.Empty;

            strPoPFileNameMedBill = String.Empty;
            strPoPSourceFilePathMedBill = String.Empty;
            strPoPDestinationFilePathMedBill = String.Empty;

            strMedRecFileNameMedBill = String.Empty;
            strMedRecSourceFilePathMedBill = String.Empty;
            strMedRecDestinationFilePathMedBill = String.Empty;

            strOtherDocFileNameMedBill = String.Empty;
            strOtherDocSourceFilePathMedBill = String.Empty;
            strOtherDocDestinationFilePathMedBill = String.Empty;

            txtMedBillAmount.Text = String.Empty;

            comboPendingReason.SelectedIndex = -1;
            comboIneligibleReason.SelectedIndex = -1;

            txtNumPhysicalTherapy.Text = String.Empty;
            txtPhysicalTherapyRxNote.Text = String.Empty;
            
            txtNumberOfMedication.Text = String.Empty;
            txtPrescriptionDescription.Text = String.Empty;
            txtPrescriptionName.Text = String.Empty;
            txtPrescriptionNote.Text = String.Empty;

            txtMedicalProvider.Text = String.Empty;
            rbInpatient.Checked = false;
            rbOutpatient.Checked = false;

            txtTotalSharedAmtMedBill.Text = String.Empty;

            // Etc group
            txtMedBillAccountNoAtProvider.Text = String.Empty;
            txtMedProviderPhoneNo.Text = String.Empty;
            txtProviderContactPerson.Text = String.Empty;

            dtpBillDate.Text = String.Empty;
            dtpDueDate.Text = String.Empty;

            txtMedBillNote.Text = String.Empty;

            gvSettlementsInMedBill.Rows.Clear();
        }

        private void tbCMMManager_SelectedIndexChanged(object sender, EventArgs e)
        {
            if ((tbCMMManager.SelectedTab == tbCMMManager.TabPages["tbpgDashboardRNManager"]) ||
                (tbCMMManager.SelectedTab == tbCMMManager.TabPages["tbpgDashboardRNStaff"]) ||
                (tbCMMManager.SelectedTab == tbCMMManager.TabPages["tbpgDashboardNPManager"]) ||
                (tbCMMManager.SelectedTab == tbCMMManager.TabPages["tbpgDashboardNPStaff"]) ||
                (tbCMMManager.SelectedTab == tbCMMManager.TabPages["tbpgDashboardFDManager"]) ||
                (tbCMMManager.SelectedTab == tbCMMManager.TabPages["tbpgDashboardFDStaff"]))
            {
                BeforePrevTabPage = PrevTabPage;
                PrevTabPage = CurrentTabPage;
                CurrentTabPage = TabPage.DashBoard;
            }

            if (tbCMMManager.SelectedTab == tbCMMManager.TabPages["tbpgIndividual"])
            {
                BeforePrevTabPage = PrevTabPage;
                PrevTabPage = CurrentTabPage;
                CurrentTabPage = TabPage.Individual;
            }

            if (tbCMMManager.SelectedTab == tbCMMManager.TabPages["tbpgCaseView"])
            {
                BeforePrevTabPage = PrevTabPage;
                PrevTabPage = CurrentTabPage;
                CurrentTabPage = TabPage.CaseView;
            }

            if (tbCMMManager.SelectedTab == tbCMMManager.TabPages["tbpgCreateCase"])
            {
                BeforePrevTabPage = PrevTabPage;
                PrevTabPage = CurrentTabPage;
                CurrentTabPage = TabPage.Case;
            }

            if (tbCMMManager.SelectedTab == tbCMMManager.TabPages["tbpgMedicalBill"])
            {
                BeforePrevTabPage = PrevTabPage;
                PrevTabPage = CurrentTabPage;
                CurrentTabPage = TabPage.MedBill;
            }
        }

        //private void gvSettlementsInMedBill_RowsAdded(object sender, DataGridViewRowsAddedEventArgs e)
        //{

        //}

        //private void gvSettlementsInMedBill_RowValidated(object sender, DataGridViewCellEventArgs e)
        //{
        //    MessageBox.Show("Row has been validated");
        //}

        private void btnAddNewSettlement_Click(object sender, EventArgs e)
        {
            Decimal MedBillAmount = 0;
            Decimal Result = 0;

            if (txtMedBill_Illness.Text.Trim() == String.Empty)
            {
                MessageBox.Show("Illness No is empty", "Error");
                return;
            }

            if (txtMedBill_Incident.Text.Trim() == String.Empty)
            {
                MessageBox.Show("Incident No is empty.", "Error");
                return;
            }

            if (Decimal.TryParse(txtMedBillAmount.Text.Trim(), NumberStyles.Currency, new CultureInfo("en-US"), out Result))
            {
                MedBillAmount = Result;
            }
            else
            {
                MessageBox.Show("The Medical Bill Amount is invalid.", "Error");
                return;
            }

            if (txtMedicalProvider.Text.Trim() == String.Empty)
            {
                MessageBox.Show("The Medical Provider name is empty.", "Error");
                return;
            }



            settlementMode = SettlementMode.AddNew;
            String SettlementName = "RNSTLM-";

            int nFirstSettlementNo = 300000;

            String strSqlQueryForCountSettlement = "select count([dbo].[tbl_settlement].[Name]) from [dbo].[tbl_settlement]";

            SqlCommand cmdQueryForCountSettlement = new SqlCommand(strSqlQueryForCountSettlement, connRN5);
            cmdQueryForCountSettlement.CommandType = CommandType.Text;

            if (connRN5.State != ConnectionState.Closed)
            {
                connRN5.Close();
                connRN5.Open();
            }
            else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
            int nSettlementCount = (int)cmdQueryForCountSettlement.ExecuteScalar();
            if (connRN.State != ConnectionState.Closed) connRN.Close();

            if (nSettlementCount > 0)
            {
                if (connRN5.State != ConnectionState.Closed)
                {
                    connRN5.Close();
                    connRN5.Open();
                }
                if (connRN5.State == ConnectionState.Closed) connRN5.Open();

                SqlCommand cmdSettlementNo = connRN5.CreateCommand();
                SqlTransaction tranSettlementNo = connRN5.BeginTransaction(IsolationLevel.Serializable);

                cmdSettlementNo.Connection = connRN5;
                cmdSettlementNo.Transaction = tranSettlementNo;

                try
                {
                    String strSqlQueryForLastSettlementNo = "select [dbo].[tbl_LastID].[SettlementId] from [dbo].[tbl_LastID] where [dbo].[tbl_LastID].[Id] = 1";

                    cmdSettlementNo.CommandText = strSqlQueryForLastSettlementNo;
                    cmdSettlementNo.CommandType = CommandType.Text;

                    Object objLastSettlementNo = cmdSettlementNo.ExecuteScalar();
                    String strLastSettlementNo = String.Empty;

                    if (objLastSettlementNo != null) strLastSettlementNo = objLastSettlementNo.ToString();

                    int nNewSettlementNo = Int32.Parse(strLastSettlementNo.Substring(7));
                    nNewSettlementNo++;

                    int nLeadingZero = 0;
                    while ((nNewSettlementNo.ToString().Length + nLeadingZero) < 7) nLeadingZero++;
                    for (int i = 0; i < nLeadingZero; i++) SettlementName += '0';

                    SettlementName += nNewSettlementNo.ToString();

                    String strSqlUpdateLastSettlementNo = "update [dbo].[tbl_LastID] set [dbo].[tbl_LastID].[SettlementId] = @NewSettlementNo where [dbo].[tbl_LastID].[Id] = 1";

                    cmdSettlementNo.CommandText = strSqlUpdateLastSettlementNo;
                    cmdSettlementNo.CommandType = CommandType.Text;

                    cmdSettlementNo.Parameters.AddWithValue("@NewSettlementNo", SettlementName);
                    int nSettlementNameUpdated = cmdSettlementNo.ExecuteNonQuery();

                    tranSettlementNo.Commit();
                }
                catch (Exception ex)
                {
                    try
                    {
                        tranSettlementNo.Rollback();
                        MessageBox.Show(ex.Message, "Error");
                        return;
                    }
                    catch (SqlException se)
                    {
                        MessageBox.Show(se.Message, "Sql Error");
                        return;
                    }
                }
                if (connRN5.State != ConnectionState.Closed) connRN5.Close();
            }
            else if (nSettlementCount == 0)
            {

                if (connRN5.State != ConnectionState.Closed)
                {
                    connRN5.Close();
                    connRN5.Open();
                }
                if (connRN5.State == ConnectionState.Closed) connRN5.Open();

                SqlCommand cmdSettlementNo = connRN5.CreateCommand();
                SqlTransaction tranSettlementNo = connRN5.BeginTransaction(IsolationLevel.Serializable);

                cmdSettlementNo.Connection = connRN5;
                cmdSettlementNo.Transaction = tranSettlementNo;

                try
                {
                    SettlementName += nFirstSettlementNo.ToString();
                    String strUpdateLastSettlementNo = "update [dbo].[tbl_LastID] set [dbo].[tbl_LastID].[SettlementId] = @FirstSettlementNo where [dbo].[tbl_LastID].[Id] = 1";

                    cmdSettlementNo.CommandText = strUpdateLastSettlementNo;
                    cmdSettlementNo.CommandType = CommandType.Text;

                    cmdSettlementNo.Parameters.AddWithValue("@FirstSettlementNo", SettlementName);
                    int nSettlementNoUpdated = cmdSettlementNo.ExecuteNonQuery();
                    tranSettlementNo.Commit();
                }
                catch (Exception ex)
                {
                    try
                    {
                        tranSettlementNo.Rollback();
                        MessageBox.Show(ex.Message, "Error");
                        return;
                    }
                    catch (SqlException se)
                    {
                        MessageBox.Show(se.Message, "Sql Error");
                        return;
                    }
                }
                if (connRN5.State != ConnectionState.Closed) connRN5.Close();
            }

            //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
            //String strSqlQueryForMaxSettlementName = "select max([dbo].[tbl_settlement].[Name]) from [dbo].[tbl_settlement]";

            //SqlCommand cmdQueryForMaxSettlement = new SqlCommand(strSqlQueryForMaxSettlementName, connRN5);
            //cmdQueryForMaxSettlement.CommandType = CommandType.Text;

            ////if (connRN.State == ConnectionState.Closed) connRN.Open();
            //if (connRN5.State != ConnectionState.Closed)
            //{
            //    connRN5.Close();
            //    connRN5.Open();
            //}
            //else if (connRN5.State == ConnectionState.Closed) connRN5.Open();

            ////String MaxSettlementName = cmdQueryForMaxSettlement.ExecuteScalar().ToString();
            //Object objMaxSettlementName = cmdQueryForMaxSettlement.ExecuteScalar();
            //if (connRN.State != ConnectionState.Closed) connRN.Close();

            //String MaxSettlementName = String.Empty;

            //if (objMaxSettlementName != null) MaxSettlementName = objMaxSettlementName.ToString();

            //if (MaxSettlementName == String.Empty) SettlementName += nFirstSettlementNo.ToString();
            //else
            //{
            //    int NextSettlementNo = Int32.Parse(MaxSettlementName.Substring(5));
            //    NextSettlementNo++;
            //    SettlementName += NextSettlementNo.ToString();
            //}

            if (gvSettlementsInMedBill.Rows.Count == 0)
            {
                gvSettlementsInMedBill.Rows.Add();
                gvSettlementsInMedBill["Selected", 0].Value = true;
                gvSettlementsInMedBill["SettlementName", 0].Value = SettlementName;

                // Populate settlement type
                DataGridViewComboBoxCell comboCellSettlementType = new DataGridViewComboBoxCell();
                for (int i = 0; i < lstSettlementType.Count; i++)
                {
                    comboCellSettlementType.Items.Add(lstSettlementType[i].SettlementTypeValue);
                }
                gvSettlementsInMedBill[2, 0] = comboCellSettlementType;

                DataGridViewCheckBoxCell chkApprovedCell = new DataGridViewCheckBoxCell();
                chkApprovedCell.Style.Alignment = DataGridViewContentAlignment.MiddleCenter;



                gvSettlementsInMedBill["Approved", 0] = chkApprovedCell;
                chkApprovedCell.ReadOnly = true;

                //if (LoggedInUserRole == UserRole.RNManager || 
                //    LoggedInUserRole == UserRole.FDManager ||
                //    LoggedInUserRole == UserRole.NPManager ||
                //    LoggedInUserRole == UserRole.MSManager ||
                //    LoggedInUserRole == UserRole.Administrator ||
                //    LoggedInUserRole == UserRole.SuperAdmin ||
                //    LoggedInUserRole == UserRole.Executive)
                //    chkApprovedCell.ReadOnly = false;
                //else if (LoggedInUserRole == UserRole.RNStaff ||
                //         LoggedInUserRole == UserRole.FDStaff ||
                //         LoggedInUserRole == UserRole.NPStaff ||
                //         LoggedInUserRole == UserRole.MSStaff)
                //    chkApprovedCell.ReadOnly = true;


                //////////////////////////////////////////////////////////////////////////////////////////////
                CalendarCell calendarCell = new CalendarCell();
                gvSettlementsInMedBill["ApprovedDate", 0] = calendarCell;
                gvSettlementsInMedBill["ApprovedDate", 0].Value = null;
                gvSettlementsInMedBill["ApprovedDate", 0].ReadOnly = true;

                DataGridViewComboBoxCell comboCellPaymentType = new DataGridViewComboBoxCell();
                for (int i = 0; i < lstPaymentMethod.Count; i++)
                {
                    comboCellPaymentType.Items.Add(lstPaymentMethod[i].PaymentMethodValue);
                }
                gvSettlementsInMedBill["PaymentMethod", 0] = comboCellPaymentType;

                for (int i = 0; i < comboCellPaymentType.Items.Count - 1; i++)
                {
                    if (comboCellPaymentType.Items[i].ToString() == "None")
                        gvSettlementsInMedBill["PaymentMethod", 0].Value = comboCellPaymentType.Items[i];
                }

                // Populate credit cards
                DataGridViewComboBoxCell comboCellCreditCards = new DataGridViewComboBoxCell();
                for (int i = 0; i < lstCreditCardInfo.Count; i++)
                {
                    comboCellCreditCards.Items.Add(lstCreditCardInfo[i].CreditCardNo);
                }

                gvSettlementsInMedBill["CreditCard", 0] = comboCellCreditCards;

                for (int i = 0; i < comboCellCreditCards.Items.Count; i++)
                {
                    if (comboCellCreditCards.Items[i].ToString() == "None")
                        gvSettlementsInMedBill["CreditCard", 0].Value = comboCellCreditCards.Items[i];
                }

                DataGridViewCheckBoxCell Reconciled = new DataGridViewCheckBoxCell();

                Reconciled.Style.Alignment = DataGridViewContentAlignment.MiddleCenter;

                gvSettlementsInMedBill["Reconciled", 0] = Reconciled;

                //DataGridViewComboBoxCell comboIneligibleReasonCell = new DataGridViewComboBoxCell();
                gvSettlementsInMedBill["IneligibleReason", 0].Value = null;
                gvSettlementsInMedBill["IneligibleReason", 0].ReadOnly = true;

                //btnSaveSettlement.Enabled = true;
                btnDeleteSettlement.Enabled = true;

            }
            else if (gvSettlementsInMedBill.Rows.Count > 0)
            {
                Boolean bNotEmpty = false;
                for (int i = 2; i < gvSettlementsInMedBill.ColumnCount; i++)
                {
                    if (gvSettlementsInMedBill.Rows[gvSettlementsInMedBill.Rows.Count - 1].Cells[i].Value != null)
                    {
                        bNotEmpty = true;
                        break;
                    }
                }
                if (bNotEmpty)
                {
                    gvSettlementsInMedBill.Rows.Add();
                    gvSettlementsInMedBill["Selected", gvSettlementsInMedBill.Rows.Count - 1].Value = true;
                    gvSettlementsInMedBill["SettlementName", gvSettlementsInMedBill.Rows.Count - 1].Value = SettlementName;

                    //String NextSettlementName = gvSettlementsInMedBill["SettlementName", gvSettlementsInMedBill.Rows.Count - 2].Value.ToString();

                    //int nNextSettlementNo = Int32.Parse(NextSettlementName.Substring(5));
                    //nNextSettlementNo++;
                    //NextSettlementName = NextSettlementName.Substring(0, 4) + "-" + nNextSettlementNo.ToString();

                    //if (Int32.Parse(SettlementName.Substring(5)) >= Int32.Parse(NextSettlementName.Substring(5)))
                    //    gvSettlementsInMedBill["SettlementName", gvSettlementsInMedBill.Rows.Count - 1].Value = SettlementName;
                    //else gvSettlementsInMedBill["SettlementName", gvSettlementsInMedBill.Rows.Count - 1].Value = NextSettlementName;

                    // Populate settlement type
                    DataGridViewComboBoxCell comboCellSettlementType = new DataGridViewComboBoxCell();

                    for (int i = 0; i < lstSettlementType.Count; i++)
                    {
                        comboCellSettlementType.Items.Add(lstSettlementType[i].SettlementTypeValue);
                    }
                    gvSettlementsInMedBill["SettlementTypeValue", gvSettlementsInMedBill.Rows.Count - 1] = comboCellSettlementType;



                    // Populate payment method type
                    DataGridViewComboBoxCell comboCellPaymentType = new DataGridViewComboBoxCell();
                    for (int i = 0; i < lstPaymentMethod.Count; i++)
                    {
                        if (lstPaymentMethod[i].PaymentMethodValue != null) comboCellPaymentType.Items.Add(lstPaymentMethod[i].PaymentMethodValue);
                        else comboCellPaymentType.Items.Add(String.Empty);
                    }

                    gvSettlementsInMedBill["PaymentMethod", gvSettlementsInMedBill.Rows.Count - 1] = comboCellPaymentType;

                    for (int i = 0; i < comboCellPaymentType.Items.Count - 1; i++)
                    {
                        if (comboCellPaymentType.Items[i].ToString() == "None")
                            gvSettlementsInMedBill["PaymentMethod", gvSettlementsInMedBill.Rows.Count - 1].Value = comboCellPaymentType.Items[i];
                    }

                    // Approved check box
                    DataGridViewCheckBoxCell approvedCell = new DataGridViewCheckBoxCell();
                    approvedCell.Style.Alignment = DataGridViewContentAlignment.MiddleCenter;

                    gvSettlementsInMedBill["Approved", gvSettlementsInMedBill.Rows.Count - 1] = approvedCell;
                    gvSettlementsInMedBill["Approved", gvSettlementsInMedBill.Rows.Count - 1].ReadOnly = true;

                    if (LoggedInUserRole == UserRole.RNManager ||
                        LoggedInUserRole == UserRole.NPManager ||
                        LoggedInUserRole == UserRole.FDManager ||
                        LoggedInUserRole == UserRole.MSManager ||
                        LoggedInUserRole == UserRole.Administrator ||
                        LoggedInUserRole == UserRole.SuperAdmin ||
                        LoggedInUserRole == UserRole.Executive)
                    {
                        if ((gvSettlementsInMedBill["SettlementTypeValue", gvSettlementsInMedBill.Rows.Count - 1]?.Value?.ToString() == "CMM Provider Payment" ||
                             gvSettlementsInMedBill["SettlementTypeValue", gvSettlementsInMedBill.Rows.Count - 1]?.Value?.ToString() == "CMM Member Reimbursement" ||
                             gvSettlementsInMedBill["SettlementTypeValue", gvSettlementsInMedBill.Rows.Count - 1]?.Value?.ToString() == "PR Reimbursement") &&
                            (gvSettlementsInMedBill["PaymentMethod", gvSettlementsInMedBill.Rows.Count - 1]?.Value?.ToString() == "Check" ||
                             gvSettlementsInMedBill["PaymentMethod", gvSettlementsInMedBill.Rows.Count - 1]?.Value?.ToString() == "ACH/Banking" ||
                             gvSettlementsInMedBill["PaymentMethod", gvSettlementsInMedBill.Rows.Count - 1]?.Value?.ToString() == "Credit Card"))
                        {
                            approvedCell.ReadOnly = false;
                        }
                        else
                            approvedCell.ReadOnly = true;

                    }
                    else if (LoggedInUserRole == UserRole.RNStaff ||
                             LoggedInUserRole == UserRole.NPStaff ||
                             LoggedInUserRole == UserRole.FDStaff ||
                             LoggedInUserRole == UserRole.MSStaff) approvedCell.ReadOnly = true;

                    CalendarCell calendarCell = new CalendarCell();
                    gvSettlementsInMedBill["ApprovedDate", gvSettlementsInMedBill.Rows.Count - 1] = calendarCell;
                    gvSettlementsInMedBill["ApprovedDate", gvSettlementsInMedBill.Rows.Count - 1].Value = null;
                    gvSettlementsInMedBill["ApprovedDate", gvSettlementsInMedBill.Rows.Count - 1].ReadOnly = true;

                    //if (LoggedInUserRole == UserRole.RNManager) gvSettlementsInMedBill["Approved", gvSettlementsInMedBill.Rows.Count - 1].ReadOnly = false;
                    //else if (LoggedInUserRole == UserRole.RNStaff) gvSettlementsInMedBill["Approved", gvSettlementsInMedBill.Rows.Count - 1].ReadOnly = true;




                    // Populate credit cards
                    DataGridViewComboBoxCell comboCellCreditCards = new DataGridViewComboBoxCell();
                    for (int i = 0; i < lstCreditCardInfo.Count; i++)
                    {
                        if (lstCreditCardInfo[i].CreditCardNo != null) comboCellCreditCards.Items.Add(lstCreditCardInfo[i].CreditCardNo);
                        else comboCellCreditCards.Items.Add(String.Empty);
                    }
                    gvSettlementsInMedBill["CreditCard", gvSettlementsInMedBill.Rows.Count - 1] = comboCellCreditCards;
                    for (int i = 0; i < comboCellCreditCards.Items.Count; i++)
                    {
                        if (comboCellCreditCards.Items[i].ToString() == String.Empty)
                            gvSettlementsInMedBill["CreditCard", gvSettlementsInMedBill.Rows.Count - 1].Value = comboCellCreditCards.Items[i];
                    }

                    if (gvSettlementsInMedBill["PaymentMethod", gvSettlementsInMedBill.Rows.Count - 1]?.Value?.ToString() == "Check")
                    {
                        gvSettlementsInMedBill.Rows[gvSettlementsInMedBill.Rows.Count - 1].Cells["CheckNo"].ReadOnly = false;
                        gvSettlementsInMedBill.Rows[gvSettlementsInMedBill.Rows.Count - 1].Cells["PaymentDate"].ReadOnly = false;
                        gvSettlementsInMedBill.Rows[gvSettlementsInMedBill.Rows.Count - 1].Cells["Reconciled"].ReadOnly = false;

                        gvSettlementsInMedBill.Rows[gvSettlementsInMedBill.Rows.Count - 1].Cells["ACHNo"].ReadOnly = true;
                        gvSettlementsInMedBill.Rows[gvSettlementsInMedBill.Rows.Count - 1].Cells["CreditCard"].ReadOnly = true;
                    }

                    if (gvSettlementsInMedBill["PaymentMethod", gvSettlementsInMedBill.Rows.Count - 1]?.Value?.ToString() == "ACH/Banking")
                    {
                        gvSettlementsInMedBill.Rows[gvSettlementsInMedBill.Rows.Count - 1].Cells["ACHNo"].ReadOnly = false;
                        gvSettlementsInMedBill.Rows[gvSettlementsInMedBill.Rows.Count - 1].Cells["PaymentDate"].ReadOnly = false;
                        gvSettlementsInMedBill.Rows[gvSettlementsInMedBill.Rows.Count - 1].Cells["Reconciled"].ReadOnly = false;

                        gvSettlementsInMedBill.Rows[gvSettlementsInMedBill.Rows.Count - 1].Cells["CheckNo"].ReadOnly = true;
                        gvSettlementsInMedBill.Rows[gvSettlementsInMedBill.Rows.Count - 1].Cells["CreditCard"].ReadOnly = true;
                    }

                    if (gvSettlementsInMedBill["PaymentMethod", gvSettlementsInMedBill.Rows.Count - 1]?.Value?.ToString() == "Credit Card")
                    {
                        gvSettlementsInMedBill.Rows[gvSettlementsInMedBill.Rows.Count - 1].Cells["CreditCard"].ReadOnly = false;
                        gvSettlementsInMedBill.Rows[gvSettlementsInMedBill.Rows.Count - 1].Cells["PaymentDate"].ReadOnly = false;
                        gvSettlementsInMedBill.Rows[gvSettlementsInMedBill.Rows.Count - 1].Cells["Reconciled"].ReadOnly = false;

                        gvSettlementsInMedBill.Rows[gvSettlementsInMedBill.Rows.Count - 1].Cells["CheckNo"].ReadOnly = true;
                        gvSettlementsInMedBill.Rows[gvSettlementsInMedBill.Rows.Count - 1].Cells["ACHNo"].ReadOnly = true;
                    }
                    if (gvSettlementsInMedBill["PaymentMethod", gvSettlementsInMedBill.Rows.Count - 1]?.Value?.ToString() == String.Empty)
                    {
                        gvSettlementsInMedBill.Rows[gvSettlementsInMedBill.Rows.Count - 1].Cells["CheckNo"].ReadOnly = true;
                        gvSettlementsInMedBill.Rows[gvSettlementsInMedBill.Rows.Count - 1].Cells["ACHNo"].ReadOnly = true;
                        gvSettlementsInMedBill.Rows[gvSettlementsInMedBill.Rows.Count - 1].Cells["CreditCard"].ReadOnly = true;

                        gvSettlementsInMedBill.Rows[gvSettlementsInMedBill.Rows.Count - 1].Cells["PaymentDate"].ReadOnly = true;
                        gvSettlementsInMedBill.Rows[gvSettlementsInMedBill.Rows.Count - 1].Cells["Reconciled"].ReadOnly = true;
                    }

                    DataGridViewCheckBoxCell ReconciledCel = new DataGridViewCheckBoxCell();
                    ReconciledCel.Style.Alignment = DataGridViewContentAlignment.MiddleCenter;

                    gvSettlementsInMedBill["Reconciled", gvSettlementsInMedBill.Rows.Count - 1] = ReconciledCel;

                    gvSettlementsInMedBill["IneligibleReason", gvSettlementsInMedBill.Rows.Count - 1].Value = null;
                    gvSettlementsInMedBill["IneligibleReason", gvSettlementsInMedBill.Rows.Count - 1].ReadOnly = true;

                    //btnSaveSettlement.Enabled = true;
                    btnDeleteSettlement.Enabled = true;

                }
                else
                {
                    MessageBox.Show("The last row is empty!");
                }
            }
        }

        //private void btnSave_Click(object sender, EventArgs e)
        //{
        //    Boolean bSelected = false;
        //    for (int i = 0; i < gvSettlementsInMedBill.Rows.Count; i++)
        //    {
        //        if ((Boolean)gvSettlementsInMedBill[0, i].Value == true) bSelected = true;
        //    }
        //    if (!bSelected)
        //    {
        //        MessageBox.Show("You have to select at least one settlement to save.", "Alert");
        //        return;
        //    }

        //    for (int i = 0; i < gvSettlementsInMedBill.Rows.Count; i++)
        //    {
        //        if ((Boolean)gvSettlementsInMedBill[0, i].Value == true)
        //        {
        //            if (gvSettlementsInMedBill["SettlementTypeValue", i]?.Value == null)
        //            {
        //                MessageBox.Show("You have to select a Settlement Type.", "Alert");
        //                return;
        //            }

        //            Decimal result, SettlementAmount;
        //            if (Decimal.TryParse(gvSettlementsInMedBill["SettlementAmount", i]?.Value?.ToString(), NumberStyles.Currency, new CultureInfo("en-US"), out result)) SettlementAmount = result;
        //            else
        //            {
        //                MessageBox.Show("You have to enter decimal value in Settlement Amount field in Settlement " + gvSettlementsInMedBill[1, i]?.Value?.ToString(), "Alert");
        //                return;
        //            }

        //            result = 0;
        //            Decimal PersonalResponsibilityAmount = 0;

        //            if ((gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "Self Pay Discount") ||
        //                (gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "3rd Party Discount") ||
        //                (gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "Member Payment"))
        //            {
        //                if (Decimal.TryParse(gvSettlementsInMedBill["PersonalResponsibility", i]?.Value?.ToString(), NumberStyles.Currency, new CultureInfo("en-US"), out result)) PersonalResponsibilityAmount = result;
        //                else
        //                {
        //                    MessageBox.Show("You have to enter decimal value in Personal Responsibility field in Settlement " + gvSettlementsInMedBill[1, i]?.Value?.ToString(), "Alert");
        //                    return;
        //                }
        //            }

        //            result = 0;
        //            Decimal AllowedAmount = 0;
        //            if (gvSettlementsInMedBill["AllowedAmount", i]?.Value?.ToString() != null)
        //            {
        //                if (Decimal.TryParse(gvSettlementsInMedBill["AllowedAmount", i]?.Value?.ToString(), NumberStyles.Currency, new CultureInfo("en-US"), out result)) AllowedAmount = result;
        //                else
        //                {
        //                    MessageBox.Show("You have to enter decimal value in Allowed Amount field in Settlement " + gvSettlementsInMedBill[1, i]?.Value?.ToString(), "Alert");
        //                    return;
        //                }
        //            }
        //        }
        //    }

        //    Decimal MedBillAmount = Decimal.Parse(txtMedBillAmount.Text.Trim(), NumberStyles.Currency, new CultureInfo("en-US"));
        //    Decimal SettlementAmountTotal = 0;

        //    for (int i = 0; i < gvSettlementsInMedBill.Rows.Count; i++)
        //    {
        //        Decimal result = 0;
        //        Decimal SettlementAmount = 0;
        //        if (gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "Self Pay Discount" ||
        //            gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "3rd Party Discount" ||
        //            gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "Member Payment" ||
        //            gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "CMM Provider Payment" ||
        //            gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "CMM Discount" ||
        //            gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "CMM Member Reimbursement" ||
        //            gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "Ineligible")
        //        {
        //            if (Decimal.TryParse(gvSettlementsInMedBill["SettlementAmount", i]?.Value?.ToString(), NumberStyles.Currency, new CultureInfo("en-US"), out result))
        //            {
        //                SettlementAmount = result;
        //                SettlementAmountTotal += SettlementAmount;
        //                if (SettlementAmountTotal > MedBillAmount)
        //                {
        //                    MessageBox.Show("The total of settlement amount exceeds medical bill amount.");
        //                    return;
        //                }
        //            }
        //        }
        //    }

        //    Boolean bError = false;
        //    int nSelected = 0;

        //    for(int i = 0; i < gvSettlementsInMedBill.Rows.Count; i++)
        //    {
        //        if ((Boolean)gvSettlementsInMedBill["Selected", i].Value == true)
        //        {
        //            nSelected++;
        //        }
        //    }

        //    for (int i = 0; i < gvSettlementsInMedBill.Rows.Count; i++)
        //    {
        //        if ((Boolean)gvSettlementsInMedBill["Selected", i].Value == true)
        //        {
        //            String strSqlQueryForSettlementType = "select [dbo].[tbl_settlement_type_code].[SettlementTypeCode], [dbo].[tbl_settlement_type_code].[SettlementTypeValue] " +
        //                                                  "from [dbo].[tbl_settlement_type_code]";

        //            SqlCommand cmdQueryForSettlementType = new SqlCommand(strSqlQueryForSettlementType, connRN);
        //            cmdQueryForSettlementType.CommandType = CommandType.Text;

        //            //if (connRN.State == ConnectionState.Closed) connRN.Open();
        //            if (connRN.State != ConnectionState.Closed)
        //            {
        //                connRN.Close();
        //                connRN.Open();
        //            }
        //            else if (connRN.State == ConnectionState.Closed) connRN.Open();
        //            SqlDataReader rdrSettlementType = cmdQueryForSettlementType.ExecuteReader();
        //            lstSettlementType.Clear();
        //            if (rdrSettlementType.HasRows)
        //            {
        //                while (rdrSettlementType.Read())
        //                {
        //                    if (rdrSettlementType.GetInt16(0) > 0)
        //                        lstSettlementType.Add(new SettlementTypeInfo { SettlementTypeCode = rdrSettlementType.GetInt16(0), SettlementTypeValue = rdrSettlementType.GetString(1) });
        //                }
        //            }
        //            if (connRN.State != ConnectionState.Closed) connRN.Close();

        //            String SettlementName = gvSettlementsInMedBill["SettlementName", i].Value.ToString();

        //            // Check whether or not the settlement is already in data base
        //            String strSqlQueryForSettlementName = "select [dbo].[tbl_settlement].[Name] from [dbo].[tbl_settlement] where [dbo].[tbl_settlement].[Name] = @Settlement";

        //            SqlCommand cmdQueryForSettlementName = new SqlCommand(strSqlQueryForSettlementName, connRN);
        //            cmdQueryForSettlementName.CommandType = CommandType.Text;

        //            cmdQueryForSettlementName.Parameters.AddWithValue("@Settlement", SettlementName);

        //            //if (connRN.State == ConnectionState.Closed) connRN.Open();
        //            if (connRN.State != ConnectionState.Closed)
        //            {
        //                connRN.Close();
        //                connRN.Open();
        //            }
        //            else if (connRN.State == ConnectionState.Closed) connRN.Open();

        //            Object objResultSettlementName = cmdQueryForSettlementName.ExecuteScalar();
        //            if (connRN.State != ConnectionState.Closed) connRN.Close();

        //            if (objResultSettlementName == null)   // new settlement: save the settlement by using insert sql statement
        //            {

        //                String strSqlCreateNewSettlement = "insert into [dbo].[tbl_settlement] (IsDeleted, Name, CreateDate, CreateByID, LastModifiedDate, LastModifiedByID, SystemModifiedStamp, " +
        //                                                   "LastActivityDate, LastViewedDate, MedicalBillID, " +
        //                                                   "SettlementType, Amount, PersonalResponsibilityCredit, CMMPaymentMethod, " +
        //                                                   "CheckNo, CheckDate, CheckReconciled, ACH_Number, ACH_Date, ACH_Reconciled, CMMCreditCard, CMMCreditCardPaidDate, CC_Reconciled, " +
        //                                                   "AllowedAmount, Notes, Approved, ApprovedDate, IneligibleReason) " +
        //                                                   "values (0, @SettlementName, @CreateDate, @CreateByID, @LastModifiedDate, @LastModifiedByID, @SystemModifiedStamp, " +
        //                                                   "@LastActivityDate, @LastViewedDate, @MedBillID, " +
        //                                                   "@SettlementType, @SettlementAmount, @PersonalResponsibilityCredit, @CMMPaymentMethod, " +
        //                                                   "@CheckNo, @CheckDate, @IsCheckReconciled, @ACH_Number, @ACH_Date, @IsACH_Reconciled, @CMMCreditCard, @CMMCreditCardPaidDate, @IsCC_Reconciled, " +
        //                                                   "@AllowedAmount, @Notes, @IsApproved, @ApprovedDate, @IneligibleReason)";

        //                SqlCommand cmdInsertNewSettlement = new SqlCommand(strSqlCreateNewSettlement, connRN);
        //                cmdInsertNewSettlement.CommandType = CommandType.Text;

        //                String NewSettlementName = gvSettlementsInMedBill["SettlementName", i].Value.ToString();
        //                String NewSettlementType = String.Empty;
        //                if (gvSettlementsInMedBill["SettlementTypeValue", i].Value != null) NewSettlementType = gvSettlementsInMedBill["SettlementTypeValue", i].Value.ToString();
        //                int nNewSettlementType = 0;
        //                for (int j = 0; j < lstSettlementType.Count; j++)
        //                {
        //                    if (NewSettlementType == lstSettlementType[j].SettlementTypeValue) nNewSettlementType = lstSettlementType[j].SettlementTypeCode;
        //                }
        //                Decimal result = 0;
        //                Decimal SettlementAmount = 0;
        //                if (Decimal.TryParse(gvSettlementsInMedBill["SettlementAmount", i]?.Value?.ToString(), NumberStyles.Currency, new CultureInfo("en-US"), out result))
        //                {
        //                    SettlementAmount = result;
        //                    cmdInsertNewSettlement.Parameters.AddWithValue("@SettlementAmount", SettlementAmount);
        //                }

        //                result = 0;
        //                Decimal PersonalResponsibilityAmount = 0;
        //                if (Decimal.TryParse(gvSettlementsInMedBill["PersonalResponsibility", i]?.Value?.ToString(), NumberStyles.Currency, new CultureInfo("en-US"), out result)) PersonalResponsibilityAmount = result;
        //                cmdInsertNewSettlement.Parameters.AddWithValue("@PersonalResponsibilityCredit", PersonalResponsibilityAmount);

        //                int NewIsApproved = 0;
        //                if (gvSettlementsInMedBill["Approved", i]?.Value != null)
        //                {
        //                    if ((Boolean)gvSettlementsInMedBill["Approved", i]?.Value == true) NewIsApproved = 1;
        //                }
        //                DateTime? NewApprovedDate = null;
        //                if (gvSettlementsInMedBill["ApprovedDate", i]?.Value != null) NewApprovedDate = DateTime.Parse(gvSettlementsInMedBill["ApprovedDate", i].Value.ToString());

        //                String NewCMMPaymentMethod = String.Empty;
        //                if (gvSettlementsInMedBill["PaymentMethod", i]?.Value != null) NewCMMPaymentMethod = gvSettlementsInMedBill["PaymentMethod", i].Value.ToString();
        //                int nNewCMMPaymentMethod = 0;
        //                for (int j = 0; j < lstPaymentMethod.Count; j++)
        //                {
        //                    if (NewCMMPaymentMethod == lstPaymentMethod[j].PaymentMethodValue) nNewCMMPaymentMethod = lstPaymentMethod[j].PaymentMethodId;
        //                }

        //                String NewCheckNo = String.Empty;
        //                DateTime? NewCheckDate = null;
        //                int NewCheckReconciled = 0;
        //                if (gvSettlementsInMedBill["PaymentMethod", i]?.Value?.ToString() == "Check")
        //                {
        //                    if (gvSettlementsInMedBill["CheckNo", i].Value != null) NewCheckNo = gvSettlementsInMedBill["CheckNo", i].Value.ToString();
        //                    if (gvSettlementsInMedBill["PaymentDate", i].Value != null) NewCheckDate = DateTime.Parse(gvSettlementsInMedBill["PaymentDate", i].Value.ToString());
        //                    if (gvSettlementsInMedBill["Reconciled", i].Value != null) NewCheckReconciled = 1;
        //                }

        //                String NewACH_Number = String.Empty;
        //                DateTime? NewACH_Date = null;
        //                int NewACH_Reconciled = 0;
        //                if (gvSettlementsInMedBill["PaymentMethod", i]?.Value?.ToString() == "ACH/Banking")
        //                {
        //                    if (gvSettlementsInMedBill["ACHNo", i].Value != null) NewACH_Number = gvSettlementsInMedBill["ACHNo", i].Value.ToString();
        //                    if (gvSettlementsInMedBill["PaymentDate", i].Value != null) NewACH_Date = DateTime.Parse(gvSettlementsInMedBill["PaymentDate", i].Value.ToString());
        //                    if (gvSettlementsInMedBill["Reconciled", i].Value != null) NewACH_Reconciled = 1;
        //                }

        //                int nCMMCreditCard = 0;
        //                DateTime? NewCreditCardPaidDate = null;
        //                int NewIsCCReconciled = 0;

        //                if (gvSettlementsInMedBill["PaymentMethod", i]?.Value?.ToString() == "Credit Card")
        //                {
        //                    String CreditCard = gvSettlementsInMedBill[13, i]?.Value?.ToString();
        //                    for (int j = 0; j < lstCreditCardInfo.Count; j++)
        //                    {
        //                        if (CreditCard == lstCreditCardInfo[j].CreditCardNo)
        //                        {
        //                            nCMMCreditCard = lstCreditCardInfo[j].CreditCardId;
        //                        }
        //                    }
        //                    if (gvSettlementsInMedBill["PaymentDate", i].Value != null)
        //                        NewCreditCardPaidDate = DateTime.Parse(gvSettlementsInMedBill["PaymentDate", i].Value.ToString());
        //                    if (gvSettlementsInMedBill["Reconciled", i].Value != null) NewIsCCReconciled = 1;
        //                }

        //                Decimal NewAllowedAmount = 0;
        //                if (gvSettlementsInMedBill["AllowedAmount", i].Value != null) NewAllowedAmount = Decimal.Parse(gvSettlementsInMedBill["AllowedAmount", i].Value.ToString());
        //                String NewNote = String.Empty;
        //                if (gvSettlementsInMedBill["Note", i].Value != null) NewNote = gvSettlementsInMedBill["Note", i].Value.ToString();


        //                cmdInsertNewSettlement.Parameters.AddWithValue("@SettlementName", NewSettlementName);
        //                cmdInsertNewSettlement.Parameters.AddWithValue("@CreateDate", DateTime.Today);
        //                cmdInsertNewSettlement.Parameters.AddWithValue("@CreateByID", nLoggedUserId);
        //                cmdInsertNewSettlement.Parameters.AddWithValue("@LastModifiedDate", DateTime.Today);
        //                cmdInsertNewSettlement.Parameters.AddWithValue("@LastModifiedByID", nLoggedUserId);
        //                cmdInsertNewSettlement.Parameters.AddWithValue("@SystemModifiedStamp", DateTime.Today);
        //                cmdInsertNewSettlement.Parameters.AddWithValue("@LastActivityDate", DateTime.Today);
        //                cmdInsertNewSettlement.Parameters.AddWithValue("@LastViewedDate", DateTime.Today);
        //                cmdInsertNewSettlement.Parameters.AddWithValue("@MedBillID", txtMedBillNo.Text.Trim());
        //                cmdInsertNewSettlement.Parameters.AddWithValue("@SettlementType", nNewSettlementType);

        //                cmdInsertNewSettlement.Parameters.AddWithValue("@IsApproved", NewIsApproved);

        //                if (NewApprovedDate != null) cmdInsertNewSettlement.Parameters.AddWithValue("@ApprovedDate", NewApprovedDate);
        //                else cmdInsertNewSettlement.Parameters.AddWithValue("@ApprovedDate", DBNull.Value);

        //                cmdInsertNewSettlement.Parameters.AddWithValue("@CMMPaymentMethod", nNewCMMPaymentMethod);

        //                if (NewCheckNo != String.Empty) cmdInsertNewSettlement.Parameters.AddWithValue("@CheckNo", NewCheckNo);
        //                else cmdInsertNewSettlement.Parameters.AddWithValue("@CheckNo", DBNull.Value);

        //                if (NewCheckDate != null) cmdInsertNewSettlement.Parameters.AddWithValue("@CheckDate", NewCheckDate);
        //                else cmdInsertNewSettlement.Parameters.AddWithValue("@CheckDate", DBNull.Value);

        //                cmdInsertNewSettlement.Parameters.AddWithValue("@IsCheckReconciled", NewCheckReconciled);

        //                if (NewACH_Number != null) cmdInsertNewSettlement.Parameters.AddWithValue("@ACH_Number", NewACH_Number);
        //                else cmdInsertNewSettlement.Parameters.AddWithValue("@ACH_Number", DBNull.Value);

        //                if (NewACH_Date != null) cmdInsertNewSettlement.Parameters.AddWithValue("@ACH_Date", NewACH_Date);
        //                else cmdInsertNewSettlement.Parameters.AddWithValue("@ACH_Date", DBNull.Value);

        //                cmdInsertNewSettlement.Parameters.AddWithValue("@IsACH_Reconciled", NewACH_Reconciled);
        //                cmdInsertNewSettlement.Parameters.AddWithValue("@CMMCreditCard", nCMMCreditCard);

        //                if (NewCreditCardPaidDate != null) cmdInsertNewSettlement.Parameters.AddWithValue("@CMMCreditCardPaidDate", NewCreditCardPaidDate);
        //                else cmdInsertNewSettlement.Parameters.AddWithValue("@CMMCreditCardPaidDate", DBNull.Value);

        //                cmdInsertNewSettlement.Parameters.AddWithValue("@IsCC_Reconciled", NewIsCCReconciled);
        //                cmdInsertNewSettlement.Parameters.AddWithValue("@AllowedAmount", NewAllowedAmount);

        //                if (NewNote != null) cmdInsertNewSettlement.Parameters.AddWithValue("@Notes", NewNote);
        //                else cmdInsertNewSettlement.Parameters.AddWithValue("@Notes", DBNull.Value);

        //                int nIneligibleReason = 0;
        //                for (int j = 0; j < dicIneligibleReason.Count; j++)
        //                {
        //                    if (gvSettlementsInMedBill["IneligibleReason", i]?.Value?.ToString() == dicIneligibleReason[j]) nIneligibleReason = j;
        //                }
        //                cmdInsertNewSettlement.Parameters.AddWithValue("@IneligibleReason", nIneligibleReason);

        //                //if (connRN.State == ConnectionState.Closed) connRN.Open();
        //                if (connRN.State != ConnectionState.Closed)
        //                {
        //                    connRN.Close();
        //                    connRN.Open();
        //                }
        //                else if (connRN.State == ConnectionState.Closed) connRN.Open();
        //                int nRowInserted = cmdInsertNewSettlement.ExecuteNonQuery();
        //                if (connRN.State != ConnectionState.Closed) connRN.Close();

        //                //if (nRowInserted == 1)
        //                //{
        //                //    MessageBox.Show("Settlements have been saved.", "Information");
        //                //    return;
        //                //}
        //                //else
        //                //{
        //                //    MessageBox.Show("Some of settlement have not been saved.", "Error");
        //                //}
        //                if (nRowInserted == 1)
        //                {
        //                    //SettlementAmount
        //                    //if ((SettlementType)nNewSettlementType == SettlementType.MemberReimbursement ||
        //                    //    (SettlementType)nNewSettlementType == SettlementType.CMMProviderPayment)
        //                    //{
        //                    //    //String strSqlUpdateMedBill = "update [dbo].[tbl_medbill] set [dbo].[tbl_medbill].[TotalSharedAmount] = @Settlement"  
        //                    //    // 11/01/18 begin here
        //                    //}



        //                }

        //                if (nRowInserted == 0) bError = true;

        //            }
        //            else  // the settlement with the name exist, update the settlement
        //            {
        //                String UpdateSettlementName = objResultSettlementName.ToString();
        //                String UpdateMedBill = txtMedBillNo.Text.Trim();

        //                String strSqlUpdateSettlement = "update [dbo].[tbl_settlement] set [dbo].[tbl_settlement].[LastModifiedDate] = @LastModifiedDate, " +
        //                                                "[dbo].[tbl_settlement].[LastModifiedByID] = @LastModifiedByID, " +
        //                                                "[dbo].[tbl_settlement].[LastActivityDate] = @LastActivityDate, " +
        //                                                "[dbo].[tbl_settlement].[SettlementType] = @SettlementType, " +
        //                                                "[dbo].[tbl_settlement].[Amount] = @SettlementAmount, " +
        //                                                "[dbo].[tbl_settlement].[PersonalResponsibilityCredit] = @PersonalResponsibilityCredit, " +
        //                                                "[dbo].[tbl_settlement].[Approved] = @IsApproved, " +
        //                                                "[dbo].[tbl_settlement].[ApprovedDate] = @ApprovedDate, " +
        //                                                "[dbo].[tbl_settlement].[CMMPaymentMethod] = @CMMPaymentMethod, " +
        //                                                "[dbo].[tbl_settlement].[CheckNo] = @CheckNo, " +
        //                                                "[dbo].[tbl_settlement].[CheckDate] = @CheckDate, " +
        //                                                "[dbo].[tbl_settlement].[CheckReconciled] = @CheckReconciled, " +
        //                                                "[dbo].[tbl_settlement].[ACH_Number] = @ACH_Number, " +
        //                                                "[dbo].[tbl_settlement].[ACH_Date] = @ACH_Date, " +
        //                                                "[dbo].[tbl_settlement].[ACH_Reconciled] = @ACH_Reconciled, " +
        //                                                "[dbo].[tbl_settlement].[CMMCreditCard] = @CMMCreditCard, " +
        //                                                "[dbo].[tbl_settlement].[CMMCreditCardPaidDate] = @CMMCreditCardPaidDate, " +
        //                                                "[dbo].[tbl_settlement].[CC_Reconciled] = @CC_Reconciled, " +
        //                                                "[dbo].[tbl_settlement].[AllowedAmount] = @AllowedAmount, " +
        //                                                "[dbo].[tbl_settlement].[Notes] = @Note, " +
        //                                                "[dbo].[tbl_settlement].[IneligibleReason] = @IneligibleReason " +
        //                                                "where [dbo].[tbl_settlement].[Name] = @SettlementName and [dbo].[tbl_settlement].[MedicalBillID] = @MedBillName";

        //                int nSettlementType = 0;
        //                String strSettlementType = String.Empty;
        //                if (gvSettlementsInMedBill["SettlementTypeValue", i].Value != null) strSettlementType = gvSettlementsInMedBill["SettlementTypeValue", i].Value.ToString();
        //                for (int j = 0; j < lstSettlementType.Count; j++)
        //                {
        //                    if (strSettlementType == lstSettlementType[j].SettlementTypeValue) nSettlementType = lstSettlementType[j].SettlementTypeCode;
        //                }

        //                Decimal SettlementAmount = 0;
        //                if (gvSettlementsInMedBill["SettlementAmount", i].Value != null)
        //                {
        //                    SettlementAmount = Decimal.Parse(gvSettlementsInMedBill["SettlementAmount", i].Value.ToString(), NumberStyles.Currency);
        //                }

        //                Decimal PersonalResponsibilityAmt = 0;
        //                if (gvSettlementsInMedBill["PersonalResponsibility", i].Value != null)
        //                {
        //                    PersonalResponsibilityAmt = Decimal.Parse(gvSettlementsInMedBill["PersonalResponsibility", i].Value.ToString(), NumberStyles.Currency);
        //                }

        //                // Payment method
        //                int nPaymentMethod = 0;
        //                String PaymentMethod = String.Empty;
        //                if (gvSettlementsInMedBill["PaymentMethod", i].Value != null)
        //                    PaymentMethod = gvSettlementsInMedBill["PaymentMethod", i].Value.ToString();
        //                for (int j = 0; j < lstPaymentMethod.Count; j++)
        //                {
        //                    if (PaymentMethod == lstPaymentMethod[j].PaymentMethodValue) nPaymentMethod = lstPaymentMethod[j].PaymentMethodId;
        //                }

        //                // Approved or not
        //                int nApproved = 0;
        //                if (gvSettlementsInMedBill["Approved", i].Value != null)
        //                {
        //                    if ((Boolean)gvSettlementsInMedBill["Approved", i].Value) nApproved = 1;
        //                }

        //                DateTime? ApprovedDate = null;
        //                if (gvSettlementsInMedBill["ApprovedDate", i].Value != null) ApprovedDate = DateTime.Parse(gvSettlementsInMedBill["ApprovedDate", i].Value.ToString());


        //                String CheckNo = String.Empty;
        //                DateTime? CheckIssueDate = null;
        //                int nCheckReconciled = 0;

        //                String ACH_No = String.Empty;
        //                DateTime? ACH_Date = null;
        //                int nACHReconciled = 0;

        //                String CreditCard = String.Empty;
        //                int nCreditCard = 0;
        //                DateTime? CreditCardPaidDate = null;
        //                int nCCReconciled = 0;

        //                switch (PaymentMethod)
        //                {
        //                    case "Check":
        //                        if (gvSettlementsInMedBill["CheckNo", i].Value != null) CheckNo = gvSettlementsInMedBill["CheckNo", i].Value.ToString();
        //                        if (gvSettlementsInMedBill["PaymentDate", i].Value != null)
        //                        {
        //                            if (gvSettlementsInMedBill["PaymentDate", i].Value.ToString() != String.Empty) CheckIssueDate = DateTime.Parse(gvSettlementsInMedBill["PaymentDate", i].Value.ToString());
        //                        }
        //                        Boolean bCheckReconciledResult = false;
        //                        if (gvSettlementsInMedBill["Reconciled", i].Value != null)
        //                        {
        //                            if (Boolean.TryParse(gvSettlementsInMedBill["Reconciled", i].Value.ToString(), out bCheckReconciledResult))
        //                            {
        //                                if (bCheckReconciledResult) nCheckReconciled = 1;
        //                            }
        //                        }
        //                        break;
        //                    case "ACH/Banking":
        //                        if (gvSettlementsInMedBill["ACHNo", i].Value != null) ACH_No = gvSettlementsInMedBill["ACHNo", i].Value.ToString();
        //                        if (gvSettlementsInMedBill["PaymentDate", i].Value != null)
        //                        {
        //                            if (gvSettlementsInMedBill["PaymentDate", i].Value.ToString() != String.Empty) ACH_Date = DateTime.Parse(gvSettlementsInMedBill["PaymentDate", i].Value.ToString());
        //                        }
        //                        Boolean bACHReconciledResult = false;
        //                        if (gvSettlementsInMedBill["Reconciled", i].Value != null)
        //                        {
        //                            if (Boolean.TryParse(gvSettlementsInMedBill["Reconciled", i].Value.ToString(), out bACHReconciledResult))
        //                            {
        //                                if (bACHReconciledResult) nACHReconciled = 1;
        //                            }
        //                        }
        //                        break;
        //                    case "Credit Card":
        //                        if (gvSettlementsInMedBill["CreditCard", i].Value != null) CreditCard = gvSettlementsInMedBill["CreditCard", i].Value.ToString();
        //                        for (int j = 0; j < lstCreditCardInfo.Count; j++)
        //                        {
        //                            if (CreditCard == lstCreditCardInfo[j].CreditCardNo) nCreditCard = lstCreditCardInfo[j].CreditCardId;
        //                        }
        //                        if (gvSettlementsInMedBill["PaymentDate", i].Value != null)
        //                        {
        //                            if (gvSettlementsInMedBill["PaymentDate", i].Value.ToString() != String.Empty)
        //                                CreditCardPaidDate = DateTime.Parse(gvSettlementsInMedBill["PaymentDate", i].Value.ToString());
        //                        }
        //                        Boolean bCCReconciledResult = false;
        //                        if (gvSettlementsInMedBill[15, i].Value != null)
        //                        {
        //                            if (Boolean.TryParse(gvSettlementsInMedBill["Reconciled", i].Value.ToString(), out bCCReconciledResult))
        //                            {
        //                                if (bCCReconciledResult) nCCReconciled = 1;
        //                            }
        //                        }
        //                        break;
        //                }

        //                // Allowed Amount
        //                Decimal AllowedAmount = 0;
        //                if (gvSettlementsInMedBill["AllowedAmount", i].Value != null)
        //                {
        //                    AllowedAmount = Decimal.Parse(gvSettlementsInMedBill["AllowedAmount", i].Value.ToString(), NumberStyles.Currency);
        //                }

        //                // Note
        //                String Note = String.Empty;
        //                if (gvSettlementsInMedBill["Note", i].Value != null) Note = gvSettlementsInMedBill["Note", i].Value.ToString();



        //                SqlCommand cmdUpdateSettlement = new SqlCommand(strSqlUpdateSettlement, connRN);
        //                cmdUpdateSettlement.CommandType = CommandType.Text;

        //                cmdUpdateSettlement.Parameters.AddWithValue("@LastModifiedDate", DateTime.Today);
        //                cmdUpdateSettlement.Parameters.AddWithValue("@LastModifiedByID", nLoggedUserId);
        //                cmdUpdateSettlement.Parameters.AddWithValue("@LastActivityDate", DateTime.Today);
        //                cmdUpdateSettlement.Parameters.AddWithValue("@SettlementType", nSettlementType);


        //                cmdUpdateSettlement.Parameters.AddWithValue("@SettlementAmount", SettlementAmount);
        //                cmdUpdateSettlement.Parameters.AddWithValue("@PersonalResponsibilityCredit", PersonalResponsibilityAmt);

        //                cmdUpdateSettlement.Parameters.AddWithValue("@IsApproved", nApproved);
        //                if (ApprovedDate != null) cmdUpdateSettlement.Parameters.AddWithValue("@ApprovedDate", ApprovedDate);
        //                else cmdUpdateSettlement.Parameters.AddWithValue("@ApprovedDate", DBNull.Value);

        //                cmdUpdateSettlement.Parameters.AddWithValue("@CMMPaymentMethod", nPaymentMethod);

        //                if (CheckNo != String.Empty) cmdUpdateSettlement.Parameters.AddWithValue("@CheckNo", CheckNo);
        //                else cmdUpdateSettlement.Parameters.AddWithValue("@CheckNo", DBNull.Value);

        //                if (CheckIssueDate != null) cmdUpdateSettlement.Parameters.AddWithValue("@CheckDate", CheckIssueDate);
        //                else cmdUpdateSettlement.Parameters.AddWithValue("@CheckDate", DBNull.Value);

        //                cmdUpdateSettlement.Parameters.AddWithValue("@CheckReconciled", nCheckReconciled);

        //                if (ACH_No != String.Empty) cmdUpdateSettlement.Parameters.AddWithValue("@ACH_Number", ACH_No);
        //                else cmdUpdateSettlement.Parameters.AddWithValue("@ACH_Number", DBNull.Value);

        //                if (ACH_Date != null) cmdUpdateSettlement.Parameters.AddWithValue("@ACH_Date", ACH_Date);
        //                else cmdUpdateSettlement.Parameters.AddWithValue("@ACH_Date", DBNull.Value);

        //                cmdUpdateSettlement.Parameters.AddWithValue("@ACH_Reconciled", nACHReconciled);
        //                cmdUpdateSettlement.Parameters.AddWithValue("@CMMCreditCard", nCreditCard);

        //                if (CreditCardPaidDate != null) cmdUpdateSettlement.Parameters.AddWithValue("@CMMCreditCardPaidDate", CreditCardPaidDate);
        //                else cmdUpdateSettlement.Parameters.AddWithValue("@CMMCreditCardPaidDate", DBNull.Value);
        //                cmdUpdateSettlement.Parameters.AddWithValue("@CC_Reconciled", nCCReconciled);
        //                cmdUpdateSettlement.Parameters.AddWithValue("@AllowedAmount", AllowedAmount);
        //                if (Note != String.Empty) cmdUpdateSettlement.Parameters.AddWithValue("@Note", Note);
        //                else cmdUpdateSettlement.Parameters.AddWithValue("@Note", DBNull.Value);

        //                cmdUpdateSettlement.Parameters.AddWithValue("@SettlementName", UpdateSettlementName);
        //                cmdUpdateSettlement.Parameters.AddWithValue("@MedBillName", UpdateMedBill);

        //                int nIneligibleReason = 0;
        //                for (int j = 0; j < dicIneligibleReason.Count; j++)
        //                {
        //                    if (gvSettlementsInMedBill["IneligibleReason", i]?.Value?.ToString() == dicIneligibleReason[j]) nIneligibleReason = j;
        //                }
        //                cmdUpdateSettlement.Parameters.AddWithValue("@IneligibleReason", nIneligibleReason);

        //                //if (connRN.State == ConnectionState.Closed) connRN.Open();
        //                if (connRN.State != ConnectionState.Closed)
        //                {
        //                    connRN.Close();
        //                    connRN.Open();
        //                }
        //                else if (connRN.State == ConnectionState.Closed) connRN.Open();

        //                int nRowUpdated = cmdUpdateSettlement.ExecuteNonQuery();
        //                if (connRN.State != ConnectionState.Closed) connRN.Close();

        //                //if (nRowUpdated == 1)
        //                //{
        //                //    MessageBox.Show("Settlements have been saved.", "Information");
        //                //    return;
        //                //}
        //                //else
        //                //{
        //                //    MessageBox.Show("Some of settlement have not been saved.", "Error");
        //                //}

        //                if (nRowUpdated == 0) bError = true;
        //            }
        //        }
        //    }

        //    ////////////////////////////////////////////////////////////////////////////////////////////////////////

        //    for (int i = 0; i < gvSettlementsInMedBill.Rows.Count; i++)
        //    {
        //        if (gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() != "Ineligible")
        //        {
        //            gvSettlementsInMedBill["IneligibleReason", i].Value = null;
        //            gvSettlementsInMedBill["IneligibleReason", i].ReadOnly = true;
        //        }
        //    }

        //    if ((bError == false)&&(nSelected > 0))
        //    {
        //        MessageBox.Show("Settlements have been saved.", "Info");
        //        return;
        //    }
        //    else if ((bError == true)&&(nSelected > 0))
        //    {
        //        MessageBox.Show("Some of settlments have not been saved.", "Error");
        //        return;
        //    }
        //}

        private void OnSettlementsInMedBillChange(object sender, SqlNotificationEventArgs e)
        {
            if (e.Type == SqlNotificationType.Change)
            {
                SqlDependency dependency = sender as SqlDependency;
                dependency.OnChange -= OnSettlementsInMedBillChange;

                UpdateGridViewSettlementsInMedBill();
            }

        }

        private void UpdateGridViewSettlementsInMedBill()
        {
            //String MedicalBillNo = String.Empty;
            //MedicalBillNo = gvMedBill[1, nRowSelected].Value.ToString();




            String strSqlQueryForSettlementsInMedBill = "select [dbo].[tbl_settlement].[SelfPayDiscount], [dbo].[tbl_settlement].[_3rdPartyDiscount], [dbo].[tbl_settlement].[MemberPayment], " +
                                            "[dbo].[tbl_settlement].[CMMProviderPayment], [dbo].[tbl_settlement].[Eligibility], [dbo].[tbl_settlement].[AllowedAmount], " +
                                            "[dbo].[tbl_settlement].[CMMDiscount], [dbo].[tbl_settlement].[MemberReimbursement], " +
                                            "[dbo].[tbl_payment_method].[PaymentMethod_Value], [dbo].[tbl_settlement].[CheckNo], [dbo].[tbl_settlement].[CheckDate], [dbo].[tbl_settlement].[CheckReconciled], " +
                                            "[dbo].[tbl_Credit_Card__c].[Name], [dbo].[tbl_settlement].[CMMCreditCardPaidDay], [dbo].[tbl_settlement].[CC_Reconciled], " +
                                            "[dbo].[tbl_settlement].[ACH_Number], [dbo].[tbl_settlement].[ACH_Date], [dbo].[tbl_settlement].[ACH_Reconciled],  " +
                                            "[dbo].[tbl_settlement].[Notes], [dbo].[tbl_settlement].[Approved], [dbo].[tbl_settlement].[ApprovedDate] " +
                                            "from (([dbo].[tbl_settlement] inner join [dbo].[tbl_Credit_Card__c] on [dbo].[tbl_settlement].[CMMCreditCard] = [dbo].[tbl_Credit_Card__c].[CreditCard_Id]) " +
                                            "inner join [dbo].[tbl_payment_method] on [dbo].[tbl_settlement].[CMMPaymentMethod] = [dbo].[tbl_payment_method].[PaymentMethod_Id]) " +
                                            "where [dbo].[tbl_settlement].[MedicalBillID] = @MedBillNo";


            SqlCommand cmdQueryForSettlementInMedBill = new SqlCommand(strSqlQueryForSettlementsInMedBill, connRN);
            cmdQueryForSettlementInMedBill.CommandType = CommandType.Text;

            cmdQueryForSettlementInMedBill.Parameters.AddWithValue("@MedBillNo", MedicalBillNo);
            cmdQueryForSettlementInMedBill.Notification = null;

            SqlDependency dependencySettlements = new SqlDependency(cmdQueryForSettlementInMedBill);
            dependencySettlements.OnChange += new OnChangeEventHandler(OnSettlementsInMedBillChange);

            //if (connRN.State == ConnectionState.Closed) connRN.Open();
            if (connRN.State != ConnectionState.Closed)
            {
                connRN.Close();
                connRN.Open();
            }
            else if (connRN.State == ConnectionState.Closed) connRN.Open();
            SqlDataReader rdrSettlements = cmdQueryForSettlementInMedBill.ExecuteReader();

            gvSettlementsInMedBill.Rows.Clear();
            if (rdrSettlements.HasRows)
            {

                while (rdrSettlements.Read())
                {

                    DataGridViewRow row = new DataGridViewRow();
                    row.Cells.Add(new DataGridViewCheckBoxCell { Value = false });
                    if (!rdrSettlements.IsDBNull(0)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlements.GetDecimal(0).ToString("C") });
                    if (!rdrSettlements.IsDBNull(1)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlements.GetDecimal(1).ToString("C") });
                    if (!rdrSettlements.IsDBNull(2)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlements.GetDecimal(2).ToString("C") });
                    if (!rdrSettlements.IsDBNull(3)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlements.GetDecimal(3).ToString("C") });
                    if (!rdrSettlements.IsDBNull(4))
                    {
                        DataGridViewComboBoxCell cellEligibility = new DataGridViewComboBoxCell();
                        cellEligibility.Items.Add("Yes");
                        cellEligibility.Items.Add("No");

                        if (rdrSettlements.GetBoolean(4)) cellEligibility.Value = "Yes";
                        else cellEligibility.Value = "No";

                        row.Cells.Add(cellEligibility);
                    }
                    if (!rdrSettlements.IsDBNull(5)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlements.GetDecimal(5).ToString("C") });
                    if (!rdrSettlements.IsDBNull(6)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlements.GetDecimal(6).ToString("C") });
                    if (!rdrSettlements.IsDBNull(7)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlements.GetDecimal(7).ToString("C") });
                    if (!rdrSettlements.IsDBNull(8))
                    {
                        DataGridViewComboBoxCell cellPaymentMethod = new DataGridViewComboBoxCell();

                        foreach (PaymentMethod paymt_method in lstPaymentMethod)
                        {
                            cellPaymentMethod.Items.Add(paymt_method.PaymentMethodValue);
                        }

                        cellPaymentMethod.Value = rdrSettlements.GetString(8);

                        row.Cells.Add(cellPaymentMethod);
                    }
                    if (!rdrSettlements.IsDBNull(9)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlements.GetString(9) });
                    if (!rdrSettlements.IsDBNull(10)) row.Cells.Add(new CalendarCell { Value = rdrSettlements.GetDateTime(10) });
                    if (!rdrSettlements.IsDBNull(11)) row.Cells.Add(new DataGridViewCheckBoxCell { Value = rdrSettlements.GetBoolean(11) });

                    // Credit Card Info
                    if (!rdrSettlements.IsDBNull(12))
                    {
                        DataGridViewComboBoxCell cellCreditCard = new DataGridViewComboBoxCell();

                        foreach (CreditCardInfo info in lstCreditCardInfo)
                        {
                            cellCreditCard.Items.Add(info.CreditCardNo);
                        }

                        cellCreditCard.Value = rdrSettlements.GetString(12);
                        row.Cells.Add(cellCreditCard);
                    }
                    if (!rdrSettlements.IsDBNull(13)) row.Cells.Add(new CalendarCell { Value = rdrSettlements.GetDateTime(13) });
                    if (!rdrSettlements.IsDBNull(14)) row.Cells.Add(new DataGridViewCheckBoxCell { Value = rdrSettlements.GetBoolean(14) });
                    if (!rdrSettlements.IsDBNull(15)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlements.GetString(15) });
                    if (!rdrSettlements.IsDBNull(16)) row.Cells.Add(new CalendarCell { Value = rdrSettlements.GetDateTime(16) });
                    if (!rdrSettlements.IsDBNull(17)) row.Cells.Add(new DataGridViewCheckBoxCell { Value = rdrSettlements.GetBoolean(17) });
                    if (!rdrSettlements.IsDBNull(18)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlements.GetString(18) });
                    if (!rdrSettlements.IsDBNull(19)) row.Cells.Add(new DataGridViewCheckBoxCell { Value = rdrSettlements.GetBoolean(19) });
                    if (!rdrSettlements.IsDBNull(20)) row.Cells.Add(new CalendarCell { Value = rdrSettlements.GetDateTime(20) });

                    gvSettlementsInMedBill.Rows.Add(row);

                }

                for (int i = 0; i < gvSettlementsInMedBill.Rows.Count; i++)
                {
                    if (gvSettlementsInMedBill[5, i].Value.ToString() == "No") gvSettlementsInMedBill.Rows[i].DefaultCellStyle.BackColor = Color.Red;
                }
            }
            rdrSettlements.Close();
            if (connRN.State != ConnectionState.Closed) connRN.Close();


            ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

            //String strSqlQueryForSettlementsInMedBill = "select [dbo].[tbl_settlement].[ServiceDate], [dbo].[tbl_settlement].[Description_CPT_Code], [dbo].[tbl_settlement].[Amount], " +
            //                                            "[dbo].[tbl_settlement].[SelfPayDiscount], [dbo].[tbl_settlement].[_3rdPartyDiscount], [dbo].[tbl_settlement].[MemberPayment], " +
            //                                            "[dbo].[tbl_settlement].[RemainingBalance], [dbo].[tbl_settlement].[CMMProviderPayment], [dbo].[tbl_settlement].[MedicareValue], " +
            //                                            "[dbo].[tbl_settlement].[Eligibility], [dbo].[tbl_settlement].[AllowedAmount], [dbo].[tbl_settlement].[CMMDiscount], " +
            //                                            "[dbo].[tbl_settlement].[MemberReimbursement], [dbo].[tbl_settlement].[CMMPaymentMethod], [dbo].[tbl_settlement].[AdjustmentFinalBalance], " +
            //                                            "[dbo].[tbl_settlement].[CheckNo], [dbo].[tbl_settlement].[CheckDate], [dbo].[tbl_settlement].[CheckReconciled], " +
            //                                            "[dbo].[tbl_settlement].[CMMCreditCard], [dbo].[tbl_settlement].[CMMCreditCardPopulated], [dbo].[tbl_settlement].[CMMCreditCardPaidDay], " +
            //                                            "[dbo].[tbl_settlement].[CC_Reconciled], [dbo].[tbl_settlement].[ACH_Number], [dbo].[tbl_settlement].[ACH_Date], " +
            //                                            "[dbo].[tbl_settlement].[ACH_Reconciled], [dbo].[tbl_settlement].[Notes], " +
            //                                            "[dbo].[tbl_settlement].[AmountOver150KIncidentLimitFormula], [dbo].[tbl_settlement].[AmountOver150KIncidentLimitSnapShot], " +
            //                                            "[dbo].[tbl_settlement].[WellBeingCare], [dbo].[tbl_settlement].[PersonalResponsibilityAmountForReset], " +
            //                                            "[dbo].[tbl_settlement].[WellBeingCareSharedForReset], [dbo].[tbl_settlement].[MedicalBillDate], " +
            //                                            "[dbo].[tbl_settlement].[PersonalResponsibilityForBill], " +
            //                                            "[dbo].[tbl_settlement].[Approved], [dbo].[tbl_settlement].[ApprovedDate] " +
            //                                            "from [dbo].[tbl_settlement] where [dbo].[tbl_settlement].[MedicalBillID] = @MedBillId";

            //SqlCommand cmdQueryForSettlementInMedBill = new SqlCommand(strSqlQueryForSettlementsInMedBill, connRN);
            //cmdQueryForSettlementInMedBill.CommandType = CommandType.Text;

            //cmdQueryForSettlementInMedBill.Parameters.AddWithValue("@MedBillId", MedicalBillNo);
            //cmdQueryForSettlementInMedBill.Notification = null;

            //SqlDependency dependencySettlements = new SqlDependency(cmdQueryForSettlementInMedBill);
            //dependencySettlements.OnChange += new OnChangeEventHandler(OnSettlementsInMedBillChange);

            //connRN.Open();
            //SqlDataReader rdrSettlements = cmdQueryForSettlementInMedBill.ExecuteReader();

            //gvSettlementsInMedBill.Rows.Clear();
            //if (rdrSettlements.HasRows)
            //{

            //    while (rdrSettlements.Read())
            //    {
            //        DataGridViewRow row = new DataGridViewRow();
            //        row.Cells.Add(new DataGridViewCheckBoxCell { Value = false });
            //        if (!rdrSettlements.IsDBNull(0)) row.Cells.Add(new CalendarCell { Value = rdrSettlements.GetDateTime(0).ToString("MM/dd/yyyy") });
            //        if (!rdrSettlements.IsDBNull(1)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlements.GetString(1) });
            //        if (!rdrSettlements.IsDBNull(2)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlements.GetDecimal(2) });
            //        if (!rdrSettlements.IsDBNull(3)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlements.GetDecimal(3) });
            //        if (!rdrSettlements.IsDBNull(4)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlements.GetDecimal(4) });
            //        if (!rdrSettlements.IsDBNull(5)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlements.GetDecimal(5) });
            //        if (!rdrSettlements.IsDBNull(6)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlements.GetDecimal(6) });
            //        if (!rdrSettlements.IsDBNull(7)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlements.GetDecimal(7) });
            //        if (!rdrSettlements.IsDBNull(8)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlements.GetDecimal(8) });
            //        DataGridViewComboBoxCell cellEligibility = new DataGridViewComboBoxCell();
            //        cellEligibility.Items.Add("Yes");
            //        cellEligibility.Items.Add("No");
            //        if (!rdrSettlements.IsDBNull(9))
            //        {
            //            if (rdrSettlements.GetBoolean(9)) cellEligibility.Value = "Yes";
            //            else cellEligibility.Value = "No";
            //        }
            //        row.Cells.Add(cellEligibility);


            //        if (!rdrSettlements.IsDBNull(10)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlements.GetDecimal(10) });
            //        if (!rdrSettlements.IsDBNull(11)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlements.GetDecimal(11) });
            //        if (!rdrSettlements.IsDBNull(12)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlements.GetDecimal(12) });
            //        DataGridViewComboBoxCell cellPaymentMethod = new DataGridViewComboBoxCell();
            //        cellPaymentMethod.Items.Add("Check");
            //        cellPaymentMethod.Items.Add("Credit Card");
            //        cellPaymentMethod.Items.Add("ACH");
            //        if (!rdrSettlements.IsDBNull(13))
            //        {
            //            switch (rdrSettlements.GetInt16(13))
            //            {
            //                case 0:
            //                    cellPaymentMethod.Value = "Check";
            //                    break;
            //                case 1:
            //                    cellPaymentMethod.Value = "Credit Card";
            //                    break;
            //                case 2:
            //                    cellPaymentMethod.Value = "ACH";
            //                    break;
            //            }
            //        }
            //        row.Cells.Add(cellPaymentMethod);

            //        if (!rdrSettlements.IsDBNull(14)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlements.GetDecimal(14) });
            //        if (!rdrSettlements.IsDBNull(15)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlements.GetString(15) });
            //        if (!rdrSettlements.IsDBNull(16)) row.Cells.Add(new CalendarCell { Value = rdrSettlements.GetDateTime(16).ToString("MM/dd/yyyy") });
            //        if (!rdrSettlements.IsDBNull(17)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlements.GetString(17) });
            //        DataGridViewComboBoxCell cellCreditCard = new DataGridViewComboBoxCell();
            //        cellCreditCard.Items.Add("2383");
            //        cellCreditCard.Items.Add("5482");
            //        cellCreditCard.Items.Add("2959");
            //        if (!rdrSettlements.IsDBNull(18))
            //        {
            //            switch (rdrSettlements.GetInt16(18))
            //            {
            //                case 0:
            //                    cellCreditCard.Value = "2383";
            //                    break;
            //                case 1:
            //                    cellCreditCard.Value = "5482";
            //                    break;
            //                case 2:
            //                    cellCreditCard.Value = "2959";
            //                    break;
            //            }
            //            row.Cells.Add(cellCreditCard);
            //        }

            //        if (!rdrSettlements.IsDBNull(19)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlements.GetString(19) });
            //        if (!rdrSettlements.IsDBNull(20)) row.Cells.Add(new CalendarCell { Value = rdrSettlements.GetDateTime(20).ToString("MM/dd/yyyy") });
            //        if (!rdrSettlements.IsDBNull(21)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlements.GetString(21) });
            //        if (!rdrSettlements.IsDBNull(22)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlements.GetString(22) });
            //        if (!rdrSettlements.IsDBNull(23)) row.Cells.Add(new CalendarCell { Value = rdrSettlements.GetDateTime(23).ToString("MM/dd/yyyy") });
            //        if (!rdrSettlements.IsDBNull(24)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlements.GetString(24) });
            //        if (!rdrSettlements.IsDBNull(25)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlements.GetString(25) });
            //        if (!rdrSettlements.IsDBNull(26)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlements.GetString(26) });
            //        if (!rdrSettlements.IsDBNull(27)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlements.GetDecimal(27) });
            //        if (!rdrSettlements.IsDBNull(28)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlements.GetDecimal(28) });
            //        if (!rdrSettlements.IsDBNull(29)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlements.GetDecimal(29) });
            //        if (!rdrSettlements.IsDBNull(30)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlements.GetDecimal(30) });
            //        if (!rdrSettlements.IsDBNull(31)) row.Cells.Add(new CalendarCell { Value = rdrSettlements.GetDateTime(31).ToString("MM/dd/yyyy") });
            //        if (!rdrSettlements.IsDBNull(32)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlements.GetDecimal(32) });
            //        if (!rdrSettlements.IsDBNull(33)) row.Cells.Add(new DataGridViewCheckBoxCell { Value = rdrSettlements.GetBoolean(33) });
            //        if (!rdrSettlements.IsDBNull(34)) row.Cells.Add(new CalendarCell { Value = rdrSettlements.GetDateTime(34).ToString("MM/dd/yyyy") });

            //        gvSettlementsInMedBill.Rows.Add(row);
            //    }

            //    for (int i = 0; i < gvSettlementsInMedBill.Rows.Count; i++)
            //    {
            //        if (gvSettlementsInMedBill[10, i].Value.ToString() == "No") gvSettlementsInMedBill.Rows[i].DefaultCellStyle.BackColor = Color.Red;
            //    }
            //}

            //connRN.Close();
        }

        private void gvSettlementsInMedBill_CurrentCellDirtyStateChanged(object sender, EventArgs e)
        {
            //if (gvSettlementsInMedBill.IsCurrentCellDirty && PrevViewToMedicalBill == ViewPrevToMedBill.CaseView)
            if (gvSettlementsInMedBill.IsCurrentCellDirty)
            {
                gvSettlementsInMedBill.CommitEdit(DataGridViewDataErrorContexts.Commit);
            }
        }

        private void gvSettlementsInMedBill_CellValueChanged(object sender, DataGridViewCellEventArgs e)
        {
            if (gvSettlementsInMedBill.Rows.Count > 0)
            {
                if (e.ColumnIndex == 2)     // if the settlement is ineligible, change background color to red
                {
                    if ((gvSettlementsInMedBill[2, e.RowIndex]?.Value?.ToString() == "CMM Provider Payment" ||
                         gvSettlementsInMedBill[2, e.RowIndex]?.Value?.ToString() == "CMM Member Reimbursement" ||
                         gvSettlementsInMedBill[2, e.RowIndex]?.Value?.ToString() == "PR Reimbursement") &&
                        (gvSettlementsInMedBill[5, e.RowIndex]?.Value?.ToString() == "Check" ||
                         gvSettlementsInMedBill[5, e.RowIndex]?.Value?.ToString() == "ACH/Banking" ||
                         gvSettlementsInMedBill[5, e.RowIndex]?.Value?.ToString() == "Credit Card"))
                        gvSettlementsInMedBill[6, e.RowIndex].ReadOnly = false;
                    else
                        gvSettlementsInMedBill[6, e.RowIndex].ReadOnly = true;

                    if (gvSettlementsInMedBill[2, e.RowIndex]?.Value?.ToString() == "Ineligible")
                    {
                        if (dicIneligibleReason.Count > 0)
                        {
                            DataGridViewComboBoxCell comboCellIneligibleReason = new DataGridViewComboBoxCell();
                            for (int i = 0; i < dicIneligibleReason.Count; i++)
                            {
                                comboCellIneligibleReason.Items.Add(dicIneligibleReason[i]);
                            }
                            //comboCellIneligibleReason.Sorted = true;
                            comboCellIneligibleReason.Value = comboCellIneligibleReason.Items[0];
                            gvSettlementsInMedBill["IneligibleReason", e.RowIndex].ReadOnly = false;
                            gvSettlementsInMedBill["IneligibleReason", e.RowIndex] = comboCellIneligibleReason;
                        }
                        //gvSettlementsInMedBill["Approved", e.RowIndex].ReadOnly = true;
                        gvSettlementsInMedBill.Rows[e.RowIndex].DefaultCellStyle.BackColor = Color.Salmon;
                        //return;
                    }
                    else
                    {
                        gvSettlementsInMedBill["IneligibleReason", e.RowIndex].Value = null;
                        gvSettlementsInMedBill["IneligibleReason", e.RowIndex].ReadOnly = true;
                        //gvSettlementsInMedBill["ApprovedDate", e.RowIndex].ReadOnly = false;
                        gvSettlementsInMedBill.Rows[e.RowIndex].DefaultCellStyle.BackColor = Color.White;
                        //return;
                    }

                    if (gvSettlementsInMedBill["SettlementTypeValue", e.RowIndex]?.Value?.ToString() == null ||
                        gvSettlementsInMedBill["SettlementTypeValue", e.RowIndex]?.Value?.ToString() == "3rd Party Discount" ||
                        gvSettlementsInMedBill["SettlementTypeValue", e.RowIndex]?.Value?.ToString() == "Member Payment" ||
                        gvSettlementsInMedBill["SettlementTypeValue", e.RowIndex]?.Value?.ToString() == "CMM Discount" ||
                        gvSettlementsInMedBill["SettlementTypeValue", e.RowIndex]?.Value?.ToString() == "Ineligible" ||
                        gvSettlementsInMedBill["SettlementTypeValue", e.RowIndex]?.Value?.ToString() == "Medical Provider Refund" ||
                        gvSettlementsInMedBill["SettlementTypeValue", e.RowIndex]?.Value?.ToString() == "Member Discount")
                    {
                        gvSettlementsInMedBill["Approved", e.RowIndex].Value = false;
                        gvSettlementsInMedBill["ApprovedDate", e.RowIndex].Value = String.Empty;
                        gvSettlementsInMedBill["Approved", e.RowIndex].ReadOnly = true;
                        gvSettlementsInMedBill["ApprovedDate", e.RowIndex].ReadOnly = true;
                    }
                    else
                    {
                        gvSettlementsInMedBill["Approved", e.RowIndex].ReadOnly = false;
                        gvSettlementsInMedBill["ApprovedDate", e.RowIndex].ReadOnly = false;
                    }
                    return;
                }
                if (e.ColumnIndex == 3)     // show alert if the settlement amount total exceed med bill amount
                {

                    Decimal MedBillAmount = Decimal.Parse(txtMedBillAmount.Text.Trim(), NumberStyles.Currency, new CultureInfo("en-US"));
                    Decimal Balance = 0;
                    Decimal SettlementTotal = 0;
                    for (int i = 0; i < gvSettlementsInMedBill.Rows.Count; i++)
                    {
                        Decimal settlementAmount = 0;
                        Decimal result = 0;
                        if (gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() != "PR Reimbursement" &&
                            gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() != "Medical Provider Refund")
                        {
                            if (gvSettlementsInMedBill["SettlementAmount", i]?.Value != null)
                            {
                                if (Decimal.TryParse(gvSettlementsInMedBill["SettlementAmount", i]?.Value?.ToString(), NumberStyles.Currency, new CultureInfo("en-US"), out result))
                                {
                                    settlementAmount = result;
                                    SettlementTotal += settlementAmount;
                                    Balance = MedBillAmount - SettlementTotal;
                                    txtBalance.Text = Balance.ToString("C");
                                }
                                else MessageBox.Show("Invalid Settlement Total format.", "Alert");
                            }
                        }
                    }
                    Decimal TotalSharedAmount = 0;
                    for (int i = 0; i < gvSettlementsInMedBill.Rows.Count; i++)
                    {
                        Decimal SharedAmount = 0;
                        Decimal MedicalProviderRefund = 0;
                        Decimal result = 0;
                        if (gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "CMM Member Reimbursement" ||
                            gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "CMM Provider Payment" ||
                            gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "PR Reimbursement")
                        {
                            if (Decimal.TryParse(gvSettlementsInMedBill["SettlementAmount", i]?.Value?.ToString(), NumberStyles.Currency, new CultureInfo("en-US"), out result))
                            {
                                SharedAmount = result;
                                TotalSharedAmount += SharedAmount;
                                txtTotalSharedAmtMedBill.Text = TotalSharedAmount.ToString("C");
                            }
                        }
                        else if (gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "Medical Provider Refund")
                        {
                            if (Decimal.TryParse(gvSettlementsInMedBill["SettlementAmount", i]?.Value?.ToString(), NumberStyles.Currency, new CultureInfo("en-US"), out result))
                            {
                                MedicalProviderRefund = result;
                                TotalSharedAmount -= MedicalProviderRefund;
                                txtTotalSharedAmtMedBill.Text = TotalSharedAmount.ToString("C");
                            }
                        }
                    }
                    if (SettlementTotal > MedBillAmount)
                    {
                        MessageBox.Show("The total settlement amount exceeds Med Bill Amount.", "Alert");
                        gvSettlementsInMedBill.CurrentCell = gvSettlementsInMedBill.Rows[e.RowIndex].Cells[3];
                        return;
                    }
                }

                if (e.ColumnIndex == 4)
                {

                    Decimal PersonalResponsibility = PersonalResponsibilityAmountInMedBill;
                    Decimal SumPersonalResponsibility = 0;

                    Decimal result = 0;
                    if ((gvSettlementsInMedBill["SettlementTypeValue", e.RowIndex]?.Value?.ToString() == "Self Pay Discount") ||
                        (gvSettlementsInMedBill["SettlementTypeValue", e.RowIndex]?.Value?.ToString() == "3rd Party Discount") ||
                        (gvSettlementsInMedBill["SettlementTypeValue", e.RowIndex]?.Value?.ToString() == "Member Discount") ||
                        (gvSettlementsInMedBill["SettlementTypeValue", e.RowIndex]?.Value?.ToString() == "Member Payment"))
                    {
                        result = 0;
                        for (int i = 0; i < gvSettlementsInMedBill.Rows.Count; i++)
                        {
                            if (Decimal.TryParse(gvSettlementsInMedBill["PersonalResponsibility", i]?.Value?.ToString(), NumberStyles.Currency, new CultureInfo("en-US"), out result))
                            {
                                SumPersonalResponsibility = result;
                                PersonalResponsibility -= SumPersonalResponsibility;
                                txtPersonalResponsibility.Text = PersonalResponsibility.ToString("C");
                            }
                            else if (gvSettlementsInMedBill["PersonalResponsibility", i]?.Value == null)
                            {
                                txtPersonalResponsibility.Text = PersonalResponsibility.ToString("C");
                            }
                            else if (gvSettlementsInMedBill["PersonalResponsibility", i]?.Value?.ToString() != String.Empty)
                            {
                                MessageBox.Show("Invalid Personal Responsibility Amount", "Error");
                                return;
                            }
                        }

                        // Update txtPersonalResponsibility textbox
                        //PersonalResponsibility -= SumPersonalResponsibility;
                        //if (PersonalResponsibility < 0) txtPersonalResponsibility.BackColor = Color.Yellow;
                        //else if (PersonalResponsibility >= 0) txtPersonalResponsibility.BackColor = Color.White;
                        //txtPersonalResponsibility.Text = PersonalResponsibility.ToString("C");
                    }
                    else
                    {
                        MessageBox.Show("You have to select Self Pay Discount, 3rd Party Discount, or Member Payment to enter Personal Responsibility", "Alert");
                        return;
                    }
                }

                if (e.ColumnIndex == 5)     // when one payment method is selected, clear other payment info
                {
                    if ((gvSettlementsInMedBill[2, e.RowIndex]?.Value?.ToString() == "CMM Provider Payment" ||
                         gvSettlementsInMedBill[2, e.RowIndex]?.Value?.ToString() == "CMM Member Reimbursement" ||
                         gvSettlementsInMedBill[2, e.RowIndex]?.Value?.ToString() == "PR Reimbursement") &&
                        (gvSettlementsInMedBill[5, e.RowIndex]?.Value?.ToString() == "Check" ||
                         gvSettlementsInMedBill[5, e.RowIndex]?.Value?.ToString() == "ACH/Banking" ||
                         gvSettlementsInMedBill[5, e.RowIndex]?.Value?.ToString() == "Credit Card"))
                        gvSettlementsInMedBill[6, e.RowIndex].ReadOnly = false;
                    else
                        gvSettlementsInMedBill[6, e.RowIndex].ReadOnly = true;

                    if (gvSettlementsInMedBill["PaymentMethod", e.RowIndex]?.Value?.ToString() == "Check")
                    {

                        gvSettlementsInMedBill.Rows[e.RowIndex].Cells["CheckNo"].ReadOnly = false;
                        gvSettlementsInMedBill.Rows[e.RowIndex].Cells["PaymentDate"].ReadOnly = false;
                        gvSettlementsInMedBill.Rows[e.RowIndex].Cells["Reconciled"].ReadOnly = false;

                        gvSettlementsInMedBill["ACHNo", e.RowIndex].Value = String.Empty;
                        gvSettlementsInMedBill.Rows[e.RowIndex].Cells["ACHNo"].ReadOnly = true;

                        gvSettlementsInMedBill["CreditCard", e.RowIndex].Value = String.Empty;
                        gvSettlementsInMedBill.Rows[e.RowIndex].Cells["CreditCard"].ReadOnly = true;

                        //gvSettlementsInMedBill.CurrentCell = gvSettlementsInMedBill.Rows[e.RowIndex].Cells["CheckNo"];
                    }
                    if (gvSettlementsInMedBill["PaymentMethod", e.RowIndex]?.Value?.ToString() == "ACH/Banking")
                    {

                        gvSettlementsInMedBill.Rows[e.RowIndex].Cells["ACHNo"].ReadOnly = false;
                        gvSettlementsInMedBill.Rows[e.RowIndex].Cells["PaymentDate"].ReadOnly = false;
                        gvSettlementsInMedBill.Rows[e.RowIndex].Cells["Reconciled"].ReadOnly = false;

                        gvSettlementsInMedBill["CheckNo", e.RowIndex].Value = String.Empty;
                        gvSettlementsInMedBill.Rows[e.RowIndex].Cells["CheckNo"].ReadOnly = true;

                        gvSettlementsInMedBill["CreditCard", e.RowIndex].Value = String.Empty;
                        gvSettlementsInMedBill.Rows[e.RowIndex].Cells["CreditCard"].ReadOnly = true;

                        //gvSettlementsInMedBill.CurrentCell = gvSettlementsInMedBill.Rows[e.RowIndex].Cells["ACHNo"];
                    }
                    if (gvSettlementsInMedBill["PaymentMethod", e.RowIndex]?.Value?.ToString() == "Credit Card")
                    {
                        gvSettlementsInMedBill.Rows[e.RowIndex].Cells["CreditCard"].ReadOnly = false;
                        gvSettlementsInMedBill.Rows[e.RowIndex].Cells["PaymentDate"].ReadOnly = false;
                        gvSettlementsInMedBill.Rows[e.RowIndex].Cells["Reconciled"].ReadOnly = false;

                        gvSettlementsInMedBill["CheckNo", e.RowIndex].Value = String.Empty;
                        gvSettlementsInMedBill.Rows[e.RowIndex].Cells["CheckNo"].ReadOnly = true;

                        gvSettlementsInMedBill["ACHNo", e.RowIndex].Value = String.Empty;
                        gvSettlementsInMedBill.Rows[e.RowIndex].Cells["ACHNo"].ReadOnly = true;

                        //gvSettlementsInMedBill.CurrentCell = gvSettlementsInMedBill.Rows[e.RowIndex].Cells["CreditCard"];
                    }

                    if (gvSettlementsInMedBill[6, e.RowIndex]?.Value?.ToString() == "None")
                    {
                        gvSettlementsInMedBill["CheckNo", e.RowIndex].Value = String.Empty;
                        gvSettlementsInMedBill.Rows[e.RowIndex].Cells["CheckNo"].ReadOnly = true;

                        gvSettlementsInMedBill["ACHDate", e.RowIndex].Value = String.Empty;
                        gvSettlementsInMedBill.Rows[e.RowIndex].Cells["ACHDate"].ReadOnly = true;

                        gvSettlementsInMedBill["CreditCard", e.RowIndex].Value = String.Empty;
                        gvSettlementsInMedBill.Rows[e.RowIndex].Cells["CreditCard"].ReadOnly = true;

                        gvSettlementsInMedBill["PaymentDate", e.RowIndex].Value = String.Empty;
                        gvSettlementsInMedBill.Rows[e.RowIndex].Cells["PaymentDate"].ReadOnly = true;
                        gvSettlementsInMedBill["Reconciled", e.RowIndex].Value = 0;
                        gvSettlementsInMedBill.Rows[e.RowIndex].Cells["Reconciled"].ReadOnly = true;

                        gvSettlementsInMedBill.CurrentCell = gvSettlementsInMedBill.Rows[e.RowIndex].Cells["Note"];
                    }
                }

                // modify this section to check settlement type and payment method applicable
                if (e.ColumnIndex == 6)
                {
                    if (gvSettlementsInMedBill["SettlementTypeValue", e.RowIndex]?.Value?.ToString() == "CMM Provider Payment" ||
                        gvSettlementsInMedBill["SettlementTypeValue", e.RowIndex]?.Value?.ToString() == "CMM Member Reimbursement" ||
                        gvSettlementsInMedBill["SettlementTypeValue", e.RowIndex]?.Value?.ToString() == "PR Reimbursement")
                    {
                        if ((Boolean)gvSettlementsInMedBill["Approved", e.RowIndex]?.Value == true)
                        {
                            CalendarCell approvedDateCell = new CalendarCell();
                            approvedDateCell.Value = DateTime.Today.ToString("MM/dd/yyyy");
                            gvSettlementsInMedBill["ApprovedDate", e.RowIndex] = approvedDateCell;
                        }
                        else
                        {
                            CalendarCell approvedDateCell = new CalendarCell();
                            approvedDateCell.Value = null;
                            gvSettlementsInMedBill["ApprovedDate", e.RowIndex] = approvedDateCell;
                        }
                    }
                }
            }
        }

        private void gvProcessingCaseNo_CellDoubleClick(object sender, DataGridViewCellEventArgs e)
        {

            if (e.RowIndex > -1)
            {
                DataGridView gvCaseUnderProgress = (DataGridView)sender;
                String IndividualId = String.Empty;
                //String CaseId = String.Empty;
                String IndividualName = String.Empty;
                Boolean bCaseInUse = false;

                int nRowSelected = 0;

                if (gvCaseUnderProgress.Rows.Count > 0)
                {

                    //tbCMMManager.TabPages.Insert(3, tbpgCaseView);
                    //tbCMMManager.TabPages.Insert(4, tbpgCreateCase);
                    //tbCMMManager.SelectedTab = tbpgCreateCase;


                    //nRowSelected = gvCaseUnderProgress.CurrentCell.RowIndex;
                    nRowSelected = e.RowIndex;

                    IndividualId = txtIndividualID.Text.Trim();
                    CaseIdForCasePageMedBill = gvCaseUnderProgress["CaseIdForIndividual", nRowSelected].Value.ToString().Trim();

                    String strSqlQueryForCaseInUse = "select [dbo].[tbl_CaseInUse].[Case_Name], [dbo].[tbl_CaseInUse].[EditingStaff] from [dbo].[tbl_CaseInUse] " +
                                                     "where [dbo].[tbl_CaseInUse].[Case_Name] = @CaseInUse";

                    SqlCommand cmdCaseInUse = new SqlCommand(strSqlQueryForCaseInUse, connRN2);
                    cmdCaseInUse.CommandType = CommandType.Text;

                    cmdCaseInUse.Parameters.AddWithValue("@CaseInUse", CaseIdForCasePageMedBill);

                    if (connRN2.State != ConnectionState.Closed)
                    {
                        connRN2.Close();
                        connRN2.Open();
                    }
                    else if (connRN2.State == ConnectionState.Closed) connRN2.Open();
                    SqlDataReader rdrCaseInUse = cmdCaseInUse.ExecuteReader();
                    if (rdrCaseInUse.HasRows)
                    {
                        rdrCaseInUse.Read();
                        if (CaseIdForCasePageMedBill == rdrCaseInUse.GetString(0).Trim() &&
                            nLoggedUserId != rdrCaseInUse.GetInt16(1))
                        {
                            MessageBox.Show("The Case: " + CaseIdForCasePageMedBill + " is in use.", "Alert");
                            rdrCaseInUse.Close();
                            if (connRN2.State != ConnectionState.Closed) connRN2.Close();
                            bCaseInUse = true;
                            //return;
                        }
                    }
                    else
                    {
                        rdrCaseInUse.Close();
                        if (connRN2.State != ConnectionState.Closed) connRN2.Close();

                        String strSqlInsertCaseInUse = "insert into [dbo].[tbl_CaseInUse] (Case_Name, EditingStaff) values (@CaseNO, @EditingStaff)";

                        SqlCommand cmdInsertCaseInUse = new SqlCommand(strSqlInsertCaseInUse, connRN2);
                        cmdInsertCaseInUse.CommandType = CommandType.Text;

                        cmdInsertCaseInUse.Parameters.AddWithValue("@CaseNo", CaseIdForCasePageMedBill);
                        cmdInsertCaseInUse.Parameters.AddWithValue("@EditingStaff", nLoggedUserId);

                        if (connRN2.State != ConnectionState.Closed)
                        {
                            connRN2.Close();
                            connRN2.Open();
                        }
                        else if (connRN2.State == ConnectionState.Closed) connRN2.Open();
                        int nCaseInUserInserted = cmdInsertCaseInUse.ExecuteNonQuery();
                        if (nCaseInUserInserted != 1)
                        {
                            MessageBox.Show("Case in use: " + CaseIdForCasePageMedBill + " has not been inserted.", "Error");
                            if (connRN2.State != ConnectionState.Closed) connRN2.Close();
                            return;
                        }
                        if (connRN2.State != ConnectionState.Closed) connRN2.Close();
                    }

                    IndividualName = txtLastName.Text.Trim() + ", " + txtFirstName.Text.Trim() + " " + txtMiddleName.Text.Trim();

                    txtCreateCaseIndividualName.Text = IndividualName;

                    String strSqlQueryForCaseStatus = "select [dbo].[tbl_case_status_code].[CaseStatusValue] from [dbo].[tbl_case_status_code]";
                    SqlCommand cmdQueryForCaseStatus = new SqlCommand(strSqlQueryForCaseStatus, connRN2);
                    cmdQueryForCaseStatus.CommandType = CommandType.Text;

                    if (connRN2.State != ConnectionState.Closed)
                    {
                        connRN2.Close();
                        connRN2.Open();
                    }
                    else if (connRN2.State == ConnectionState.Closed) connRN2.Open();

                    SqlDataReader rdrCaseStatus = cmdQueryForCaseStatus.ExecuteReader();
                    cbCaseStatus.Items.Clear();
                    if (rdrCaseStatus.HasRows)
                    {
                        while (rdrCaseStatus.Read())
                        {
                            cbCaseStatus.Items.Add(rdrCaseStatus.GetString(0));
                        }
                    }
                    rdrCaseStatus.Close();
                    if (connRN2.State != ConnectionState.Closed) connRN2.Close();


                    String strSqlQueryForCase = "select [dbo].[tbl_case].[Case_Name], [dbo].[tbl_case].[Contact_ID], [dbo].[tbl_case].[CreateDate], [dbo].[tbl_case].[ModifiDate], " +
                                                "[dbo].[tbl_case].[CreateStaff], [dbo].[tbl_case].[ModifiStaff], [dbo].[tbl_case].[Case_status], " +
                                                "[dbo].[tbl_case].[NPF_Form], [dbo].[tbl_case].[NPF_Form_File_Name], [dbo].[tbl_case].[NPF_Form_Destination_File_Name], [dbo].[tbl_case].[NPF_Receiv_Date], " +
                                                "[dbo].[tbl_case].[IB_Form], [dbo].[tbl_case].[IB_Form_File_Name], [dbo].[tbl_case].[IB_Form_Destination_File_Name], [dbo].[tbl_case].[IB_Receiv_Date], " +
                                                "[dbo].[tbl_case].[POP_Form], [dbo].[tbl_case].[POP_Form_File_Name], [dbo].[tbl_case].[POP_Form_Destination_File_Name], [dbo].[tbl_case].[POP_Receiv_Date], " +
                                                "[dbo].[tbl_case].[MedRec_Form], [dbo].[tbl_case].[MedRec_Form_File_Name], [dbo].[tbl_case].[MedRec_Form_Destination_File_Name], [dbo].[tbl_case].[MedRec_Receiv_Date], " +
                                                "[dbo].[tbl_case].[Unknown_Form], [dbo].[tbl_case].[Unknown_Form_File_Name], [dbo].[tbl_case].[Unknown_Form_Destination_File_Name], [dbo].[tbl_case].[Unknown_Receiv_Date], " +
                                                "[dbo].[tbl_case].[Case_status], [dbo].[tbl_case].[Note] " +
                                                "from [dbo].[tbl_case] where [dbo].[tbl_case].[Case_Name] = @CaseName and [dbo].[tbl_case].[Contact_ID] = @IndividualID";

                    SqlCommand cmdQueryForCase = new SqlCommand(strSqlQueryForCase, connRN2);
                    cmdQueryForCase.CommandType = CommandType.Text;

                    cmdQueryForCase.Parameters.AddWithValue("@CaseName", CaseIdForCasePageMedBill);
                    cmdQueryForCase.Parameters.AddWithValue("@IndividualID", IndividualId);

                    //if (connRN.State == ConnectionState.Closed) connRN.Open();
                    if (connRN2.State != ConnectionState.Closed)
                    {
                        connRN2.Close();
                        connRN2.Open();
                    }
                    else if (connRN2.State == ConnectionState.Closed) connRN2.Open();

                    SqlDataReader rdrCaseForIndividual = cmdQueryForCase.ExecuteReader();
                    if (rdrCaseForIndividual.HasRows)
                    {
                        rdrCaseForIndividual.Read();

                        txtCaseName.Text = rdrCaseForIndividual.GetString(0);
                        txtCaseIndividualID.Text = rdrCaseForIndividual.GetString(1);

                        // NPF Form
                        if (rdrCaseForIndividual.GetBoolean(7) == true) chkNPF_CaseCreationPage.Checked = true;
                        if (!rdrCaseForIndividual.IsDBNull(8)) strNPFormFilePathSource = rdrCaseForIndividual.GetString(8);
                        if (!rdrCaseForIndividual.IsDBNull(9))
                        {
                            strNPFormFilePathDestination = rdrCaseForIndividual.GetString(9);
                            txtNPFFormFilePath.Text = strNPFormFilePathDestination;
                            if (strNPFormFilePathDestination != String.Empty)
                            {
                                btnNPFFormView.Enabled = true;
                                btnNPFFormDelete.Enabled = true;
                            }
                        }
                        if (!rdrCaseForIndividual.IsDBNull(10))
                        {
                            dtpNPFReceivedDate.Checked = true;
                            dtpNPFReceivedDate.Value = rdrCaseForIndividual.GetDateTime(10);
                            dtpNPFReceivedDate.Text = rdrCaseForIndividual.GetDateTime(10).ToString("MM/dd/yyyy");
                        }
                        //txtNPFUploadDate.Text = rdrCaseForIndividual.GetDateTime(10).ToString("MM/dd/yyyy");

                        // IB Form
                        if (rdrCaseForIndividual.GetBoolean(11) == true) chkIB_CaseCreationPage.Checked = true;
                        if (!rdrCaseForIndividual.IsDBNull(12)) strIBFilePathSource = rdrCaseForIndividual.GetString(12);
                        if (!rdrCaseForIndividual.IsDBNull(13))
                        {
                            strIBFilePathDestination = rdrCaseForIndividual.GetString(13);
                            txtIBFilePath.Text = strIBFilePathDestination;
                            if (strIBFilePathDestination != String.Empty)
                            {
                                btnIBView.Enabled = true;
                                btnDeleteIB.Enabled = true;
                            }
                        }
                        if (!rdrCaseForIndividual.IsDBNull(14))
                        {
                            dtpIBReceivedDate.Checked = true;
                            dtpIBReceivedDate.Value = rdrCaseForIndividual.GetDateTime(14);
                            dtpIBReceivedDate.Text = rdrCaseForIndividual.GetDateTime(14).ToString("MM/dd/yyyy");
                        }
                        //txtIBUploadDate.Text = rdrCaseForIndividual.GetDateTime(14).ToString("MM/dd/yyyy");

                        // POP Form
                        if (rdrCaseForIndividual.GetBoolean(15) == true) chkPoP_CaseCreationPage.Checked = true;
                        if (!rdrCaseForIndividual.IsDBNull(16)) strPoPFilePathSource = rdrCaseForIndividual.GetString(16);
                        if (!rdrCaseForIndividual.IsDBNull(17))
                        {
                            strPopFilePathDestination = rdrCaseForIndividual.GetString(17);
                            txtPopFilePath.Text = strPopFilePathDestination;
                            if (strPopFilePathDestination != String.Empty)
                            {
                                btnPoPView.Enabled = true;
                                btnDeletePoP.Enabled = true;
                            }
                        }
                        if (!rdrCaseForIndividual.IsDBNull(18))
                        {
                            dtpPoPReceivedDate.Checked = true;
                            dtpPoPReceivedDate.Value = rdrCaseForIndividual.GetDateTime(18);
                            dtpPoPReceivedDate.Text = rdrCaseForIndividual.GetDateTime(18).ToString("MM/dd/yyyy");
                        }
                        //txtPoPUploadDate.Text = rdrCaseForIndividual.GetDateTime(18).ToString("MM/dd/yyyy");

                        // Med Rec Form
                        if (rdrCaseForIndividual.GetBoolean(19) == true) chkMedicalRecordCaseCreationPage.Checked = true;
                        if (!rdrCaseForIndividual.IsDBNull(20)) txtMedicalRecordFilePath.Text = rdrCaseForIndividual.GetString(20);
                        if (!rdrCaseForIndividual.IsDBNull(21))
                        {
                            strMedRecordFilePathDestination = rdrCaseForIndividual.GetString(21);
                            txtMedicalRecordFilePath.Text = strMedRecordFilePathDestination;
                            if (strMedRecordFilePathDestination != String.Empty)
                            {
                                btnMedicalRecordView.Enabled = true;
                                btnDeleteMedicalRecord.Enabled = true;
                            }
                        }
                        if (!rdrCaseForIndividual.IsDBNull(22))
                        {
                            dtpMRReceivedDate.Checked = true;
                            dtpMRReceivedDate.Value = rdrCaseForIndividual.GetDateTime(22);
                            dtpMRReceivedDate.Text = rdrCaseForIndividual.GetDateTime(22).ToString("MM/dd/yyyy");
                        }
                        //txtMRUploadDate.Text = rdrCaseForIndividual.GetDateTime(22).ToString("MM/dd/yyyy");

                        // Unknown Doc Form
                        if (rdrCaseForIndividual.GetBoolean(23) == true) chkOtherDocCaseCreationPage.Checked = true;
                        if (!rdrCaseForIndividual.IsDBNull(24)) strUnknownDocFilePathSource = rdrCaseForIndividual.GetString(24);
                        if (!rdrCaseForIndividual.IsDBNull(25))
                        {
                            strUnknownDocFilePathDestination = rdrCaseForIndividual.GetString(25);
                            txtOtherDocumentFilePath.Text = strUnknownDocFilePathDestination;
                            if (strUnknownDocFilePathDestination != String.Empty)
                            {
                                btnOtherDocView.Enabled = true;
                                btnDeleteMedicalRecord.Enabled = true;
                            }
                        }
                        if (!rdrCaseForIndividual.IsDBNull(26))
                        {
                            dtpOtherDocReceivedDate.Checked = true;
                            dtpOtherDocReceivedDate.Value = rdrCaseForIndividual.GetDateTime(26);
                            dtpOtherDocReceivedDate.Text = rdrCaseForIndividual.GetDateTime(26).ToString("MM/dd/yyyy");
                        }
                        //txtOtherDocUploadDate.Text = rdrCaseForIndividual.GetDateTime(26).ToString("MM/dd/yyyy");

                        // Case status
                        //if (rdrCaseForIndividual.GetBoolean(27) == true) txtCaseStatus.Text = "Complete and Ready";
                        //else txtCaseStatus.Text = "Pending - Additional Documents required";
                        if (!rdrCaseForIndividual.IsDBNull(27))
                        {
                            switch (rdrCaseForIndividual.GetInt16(27))
                            {
                                case (int)CaseStatus.OnGoing:
                                    cbCaseStatus.SelectedIndex = (int)CaseStatus.OnGoing;
                                    break;
                                case (int)CaseStatus.Processing:
                                    cbCaseStatus.SelectedIndex = (int)CaseStatus.Processing;
                                    break;
                                case (int)CaseStatus.Closed:
                                    cbCaseStatus.SelectedIndex = (int)CaseStatus.Closed;
                                    break;
                            }
                        }

                        // Note
                        if (!rdrCaseForIndividual.IsDBNull(28)) txtNoteOnCase.Text = rdrCaseForIndividual.GetString(28);


                        // Individual Name

                        //tbCMMManager.TabPages.Insert(3, tbpgCaseView);
                        //tbCMMManager.TabPages.Insert(4, tbpgCreateCase);
                        //tbCMMManager.SelectedIndex = 4;
                    }
                    rdrCaseForIndividual.Close();
                    if (connRN2.State != ConnectionState.Closed) connRN2.Close();

                    //String strSqlQueryForTaskInCase = "select [dbo].[tbl_task].[whoid], [dbo].[tbl_task].[whatid], [dbo].[tbl_task_assigned_to].[User_Name], " +
                    //                                  "[dbo].[tbl_task].[Subject], [dbo].[tbl_task].[DueDate], [dbo].[tbl_task_related_to_code].[TaskRelatedToValue], " +
                    //                                  "[dbo].[tbl_task].[CreateDate], [dbo].[tbl_task_created_by].[User_Name], " +
                    //                                  "[dbo].[tbl_task].[LastModifiedDate], [dbo].[tbl_ModifiStaff].[Staff_Name], " +
                    //                                  "[dbo].[tbl_task].[ActivityDate], [dbo].[tbl_task].[Comment], [dbo].[tbl_task].[Solution], " +
                    //                                  "[dbo].[tbl_task].[Status], [dbo].tbl_task].[Priority] " +
                    //                                  "from [dbo].[tbl_task] " +
                    //                                  "inner join[dbo].[tbl_task_assigned_to] on[dbo].[tbl_task].[AssignedTo] = [dbo].[tbl_task_assigned_to].[User_Id] " +
                    //                                  "inner join [dbo].[tbl_task_related_to_code] on[dbo].[tbl_task].[RelatedToTableId] = [dbo].[tbl_task_related_to_code].[TaskRelatedToId]" +
                    //                                  "inner join [dbo].[tbl_task_created_by] on [dbo].[tbl_task].[CreatedById] = [dbo].[tbl_task_created_by].[User_Id] " +
                    //                                  "inner join [dbo].[tbl_task_ModifiStaff] on [dbo].[tbl_task].[LastModifiedById] = [dbo].[tbl_ModifiStaff].[ModifiStaff_Id] " +
                    //                                  "where [dbo].[tbl_task].[CreatedById] = @CreateStaff or [dbo].[tbl_task].[AssignedTo] = @AssignedToStaff";

                    //SqlCommand cmdQueryForTaskInCase = new SqlCommand(strSqlQueryForTaskInCase, connRN2);
                    //cmdQueryForTaskInCase.CommandType = CommandType.Text;

                    //if (connRN2.State != ConnectionState.Closed)
                    //{
                    //    connRN2.Close();
                    //    connRN2.Open();
                    //}
                    //else if (connRN2.State == ConnectionState.Closed) connRN2.Open();

                    //SqlDataReader rdrTaskInCase = cmdQueryForTaskInCase.ExecuteReader();
                    //// 02/25/19 show Tasks here


                    //if (connRN2.State != ConnectionState.Closed) connRN2.Close();

                    String strSqlQueryForMedBillInCase = "select [dbo].[tbl_medbill].[BillNo], [dbo].[tbl_medbill_type].[MedBillTypeName], " +
                                        "[dbo].[tbl_medbill].[CreatedDate], [dbo].[tbl_CreateStaff].[Staff_Name], " +
                                        "[dbo].[tbl_medbill].[LastModifiedDate], [dbo].[tbl_ModifiStaff].[Staff_Name], " +
                                        "[dbo].[tbl_medbill].[BillAmount], [dbo].[tbl_medbill].[SettlementTotal], " +
                                        "[dbo].[tbl_medbill].[TotalSharedAmount], [dbo].[tbl_medbill].[Balance] " +
                                        "from [dbo].[tbl_medbill] " +
                                        "inner join [dbo].[tbl_medbill_type] on [dbo].[tbl_medbill].[MedBillType_Id] = [dbo].[tbl_medbill_type].[MedBillTypeId] " +
                                        "inner join [dbo].[tbl_CreateStaff] on [dbo].[tbl_medbill].[CreatedById] = [dbo].[tbl_CreateStaff].[CreateStaff_Id] " +
                                        "inner join [dbo].[tbl_ModifiStaff] on [dbo].[tbl_medbill].[LastModifiedById] = [dbo].[tbl_ModifiStaff].[ModifiStaff_Id] " +
                                        "where [dbo].[tbl_medbill].[Case_Id] = @CaseName and " +
                                        "[dbo].[tbl_medbill].[Contact_Id] = @IndividualId and " +
                                        "([dbo].[tbl_medbill].[IsDeleted] = 0 or [dbo].[tbl_medbill].[IsDeleted] IS NULL)";

                    SqlCommand cmdQueryForMedBillsInCase = new SqlCommand(strSqlQueryForMedBillInCase, connRN2);
                    cmdQueryForMedBillsInCase.CommandType = CommandType.Text;

                    cmdQueryForMedBillsInCase.Parameters.AddWithValue("@CaseName", CaseIdForCasePageMedBill);
                    cmdQueryForMedBillsInCase.Parameters.AddWithValue("@IndividualId", IndividualId);

                    SqlDependency dependencyMedBillInCase = new SqlDependency(cmdQueryForMedBillsInCase);
                    dependencyMedBillInCase.OnChange += new OnChangeEventHandler(OnMedBillsInCaseChange);



                    //if (connRN.State == ConnectionState.Closed) connRN.Open();
                    if (connRN2.State != ConnectionState.Closed)
                    {
                        connRN2.Close();
                        connRN2.Open();
                    }
                    else if (connRN2.State == ConnectionState.Closed) connRN2.Open();

                    SqlDataReader rdrMedBillInCase = cmdQueryForMedBillsInCase.ExecuteReader();
                    gvCasePageMedBills.Rows.Clear();
                    if (rdrMedBillInCase.HasRows)
                    {
                        while (rdrMedBillInCase.Read())
                        {
                            DataGridViewRow row = new DataGridViewRow();

                            row.Cells.Add(new DataGridViewCheckBoxCell { Value = false });
                            row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillInCase.GetString(0) });
                            row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillInCase.GetString(1) });
                            row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillInCase.GetDateTime(2).ToString("MM/dd/yyyy") });
                            row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillInCase.GetDecimal(6).ToString("C") });
                            row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillInCase.GetDecimal(7).ToString("C") });
                            row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillInCase.GetDecimal(8).ToString("C") });
                            row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillInCase.GetDecimal(9).ToString("C") });
                            row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillInCase.GetString(3) });
                            row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillInCase.GetDateTime(4).ToString("MM/dd/yyyy") });
                            row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillInCase.GetString(5) });

                            gvCasePageMedBills.Rows.Add(row);
                        }
                        btnEditMedBill.Enabled = true;
                        btnDeleteMedBill.Enabled = true;
                    }
                    rdrMedBillInCase.Close();
                    if (connRN2.State != ConnectionState.Closed) connRN2.Close();
                    gvCasePageMedBills.Enabled = true;
                    gvCasePageMedBills.Controls[0].Enabled = true;
                    gvCasePageMedBills.Controls[1].Enabled = true;

                    String strSqlQueryForTaskInCase = "select [dbo].[tbl_task].[whoid], [dbo].[tbl_task].[IndividualName], " +
                                  "[dbo].[tbl_task_assigned_to].[User_Name], [dbo].[tbl_task].[whatid], " +
                                  "[dbo].[tbl_task].[Subject], [dbo].[tbl_task].[DueDate], [dbo].[tbl_task_related_to_code].[TaskRelatedToValue], " +
                                  "[dbo].[tbl_task].[CreateDate], [dbo].[tbl_task_created_by].[User_Name], [dbo].[tbl_task].[ActivityDate], " +
                                  "[dbo].[tbl_task].[Comment], [dbo].[tbl_task].[Solution], " +
                                  "[dbo].[tbl_task_status_code].[TaskStatusValue], [dbo].[tbl_task_priority_code].[TaskPriorityValue], " +
                                  "[dbo].[tbl_task].[ReminderDateTime], [dbo].[tbl_task].[id] " +
                                  "from [dbo].[tbl_task] " +
                                  "inner join [dbo].[tbl_task_assigned_to] on [dbo].[tbl_task].[AssignedTo] = [dbo].[tbl_task_assigned_to].[User_Id] " +
                                  "inner join [dbo].[tbl_task_related_to_code] on [dbo].[tbl_task].[RelatedToTableId] = [dbo].[tbl_task_related_to_code].[TaskRelatedToId] " +
                                  "inner join [dbo].[tbl_task_created_by] on [dbo].[tbl_task].[CreatedById] = [dbo].[tbl_task_created_by].[User_Id] " +
                                  "inner join [dbo].[tbl_task_status_code] on [dbo].[tbl_task].[Status] = [dbo].[tbl_task_status_code].[TaskStatusCode] " +
                                  "inner join [dbo].[tbl_task_priority_code] on [dbo].[tbl_task].[Priority] = [dbo].[tbl_task_priority_code].[TaskPriorityCode] " +
                                  "where [dbo].[tbl_task].[whatid] = @CaseNo";

                    SqlCommand cmdQueryForTaskInCase = new SqlCommand(strSqlQueryForTaskInCase, connRN2);
                    cmdQueryForTaskInCase.CommandType = CommandType.Text;

                    cmdQueryForTaskInCase.Parameters.AddWithValue("@CaseNo", CaseIdForCasePageMedBill);

                    SqlDependency dependencyTaskInCase = new SqlDependency(cmdQueryForTaskInCase);
                    dependencyTaskInCase.OnChange += new OnChangeEventHandler(OnTaskInCaseChange);

                    if (connRN2.State != ConnectionState.Closed)
                    {
                        connRN2.Close();
                        connRN2.Open();
                    }
                    else if (connRN2.State == ConnectionState.Closed) connRN2.Open();
                    gvTaskInCase.Rows.Clear();
                    SqlDataReader rdrTaskInCase = cmdQueryForTaskInCase.ExecuteReader();
                    if (rdrTaskInCase.HasRows)
                    {
                        while (rdrTaskInCase.Read())
                        {
                            DataGridViewRow row = new DataGridViewRow();
                            if (!rdrTaskInCase.IsDBNull(0)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrTaskInCase.GetString(0) });
                            else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                            if (!rdrTaskInCase.IsDBNull(1)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrTaskInCase.GetString(1) });
                            else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                            if (!rdrTaskInCase.IsDBNull(2)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrTaskInCase.GetString(2) });
                            else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                            if (!rdrTaskInCase.IsDBNull(3)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrTaskInCase.GetString(3) });
                            else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                            if (!rdrTaskInCase.IsDBNull(4)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrTaskInCase.GetString(4) });
                            else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                            if (!rdrTaskInCase.IsDBNull(5)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrTaskInCase.GetDateTime(5).ToString("MM/dd/yyyy") });
                            else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                            if (!rdrTaskInCase.IsDBNull(6)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrTaskInCase.GetString(6) });
                            else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                            if (!rdrTaskInCase.IsDBNull(7)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrTaskInCase.GetDateTime(7).ToString("MM/dd/yyyy") });
                            else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                            if (!rdrTaskInCase.IsDBNull(8)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrTaskInCase.GetString(8) });
                            else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                            if (!rdrTaskInCase.IsDBNull(9)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrTaskInCase.GetDateTime(9).ToString("MM/dd/yyyy") });
                            else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                            if (!rdrTaskInCase.IsDBNull(10)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrTaskInCase.GetString(10) });
                            else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                            if (!rdrTaskInCase.IsDBNull(11)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrTaskInCase.GetString(11) });
                            else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                            if (!rdrTaskInCase.IsDBNull(12)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrTaskInCase.GetString(12) });
                            else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                            if (!rdrTaskInCase.IsDBNull(13)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrTaskInCase.GetString(13) });
                            else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                            if (!rdrTaskInCase.IsDBNull(14)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrTaskInCase.GetInt32(14) });
                            else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                            if (!rdrTaskInCase.IsDBNull(15)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrTaskInCase.GetInt32(15) });
                            else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });

                            gvTaskInCase.Rows.Add(row);
                        }
                    }
                    rdrTaskInCase.Close();
                    if (connRN2.State != ConnectionState.Closed) connRN2.Close();
                    EnableCaseForm();
                    gvTaskInCase.Enabled = true;
                    gvTaskInCase.Controls[0].Enabled = true;
                    gvTaskInCase.Controls[1].Enabled = true;

                    btnCaseCreationSaveUpper.Enabled = true;
                    btnNewMedBill_Case.Enabled = true;

                    if (bCaseInUse)
                    {
                        DisableCaseForm();

                        btnNPFFormView.Enabled = true;
                        btnIBView.Enabled = true;
                        btnPoPView.Enabled = true;
                        btnMedicalRecordView.Enabled = true;
                        btnOtherDocView.Enabled = true;

                        gvCasePageMedBills.Enabled = true;

                    }

                    tbCMMManager.SelectedTab = tbpgCreateCase;

                }
            }
        }

        private void ClearTaskInCaseSafely()
        {
            gvTaskInCase.BeginInvoke(new RemoveAllRowsTaskInCase(RemoveAllTaskInCase));
        }

        private void AddRowTaskInCaseSafely(DataGridViewRow row)
        {
            gvTaskInCase.BeginInvoke(new AddRowToTaskInCase(AddRowTaskInCase), row);
        }

        private void RemoveRowTaskInCaseSafely(int i)
        {
            gvTaskInCase.BeginInvoke(new RemoveTaskInCase(RemoveRowTaskInCase), i);
        }


        private void AddRowTaskInCase(DataGridViewRow row)
        {
            gvTaskInCase.Rows.Add(row);
        }

        private void RemoveRowTaskInCase(int i)
        {
            gvTaskInCase.Rows.RemoveAt(i);
        }

        private void RemoveAllTaskInCase()
        {
            gvTaskInCase.Rows.Clear();
        }

        private void OnTaskInCaseChange(object sender, SqlNotificationEventArgs e)
        {
            if (e.Type == SqlNotificationType.Change)
            {
                SqlDependency dependency = sender as SqlDependency;
                dependency.OnChange -= OnTaskInCaseChange;

                UpdateGridViewTaskInCaseChange();
            }
        }

        private void UpdateGridViewTaskInCaseChange()
        {
            String strSqlQueryForTaskInCase = "select [dbo].[tbl_task].[whoid], [dbo].[tbl_task].[IndividualName], " +
                                          "[dbo].[tbl_task_assigned_to].[User_Name], [dbo].[tbl_task].[whatid], " +
                                          "[dbo].[tbl_task].[Subject], [dbo].[tbl_task].[DueDate], [dbo].[tbl_task_related_to_code].[TaskRelatedToValue], " +
                                          "[dbo].[tbl_task].[CreateDate], [dbo].[tbl_task_created_by].[User_Name], [dbo].[tbl_task].[ActivityDate], " +
                                          "[dbo].[tbl_task].[Comment], [dbo].[tbl_task].[Solution], " +
                                          "[dbo].[tbl_task_status_code].[TaskStatusValue], [dbo].[tbl_task_priority_code].[TaskPriorityValue], " +
                                          "[dbo].[tbl_task].[ReminderDateTime], [dbo].[tbl_task].[id] " +
                                          "from [dbo].[tbl_task] " +
                                          "inner join [dbo].[tbl_task_assigned_to] on [dbo].[tbl_task].[AssignedTo] = [dbo].[tbl_task_assigned_to].[User_Id] " +
                                          "inner join [dbo].[tbl_task_related_to_code] on [dbo].[tbl_task].[RelatedToTableId] = [dbo].[tbl_task_related_to_code].[TaskRelatedToId] " +
                                          "inner join [dbo].[tbl_task_created_by] on [dbo].[tbl_task].[CreatedById] = [dbo].[tbl_task_created_by].[User_Id] " +
                                          "inner join [dbo].[tbl_task_status_code] on [dbo].[tbl_task].[Status] = [dbo].[tbl_task_status_code].[TaskStatusCode] " +
                                          "inner join [dbo].[tbl_task_priority_code] on [dbo].[tbl_task].[Priority] = [dbo].[tbl_task_priority_code].[TaskPriorityCode] " +
                                          "where [dbo].[tbl_task].[whatid] = @CaseNo";

            SqlCommand cmdQueryForTaskInCase = new SqlCommand(strSqlQueryForTaskInCase, connRN2);
            cmdQueryForTaskInCase.CommandType = CommandType.Text;

            cmdQueryForTaskInCase.Parameters.AddWithValue("@CaseNo", CaseIdForCasePageMedBill);

            SqlDependency dependencyTaskInCase = new SqlDependency(cmdQueryForTaskInCase);
            dependencyTaskInCase.OnChange += new OnChangeEventHandler(OnTaskInCaseChange);

            if (connRN2.State != ConnectionState.Closed)
            {
                connRN2.Close();
                connRN2.Open();
            }
            else if (connRN2.State == ConnectionState.Closed) connRN2.Open();

            if (IsHandleCreated) ClearTaskInCaseSafely();
            else gvTaskInCase.Rows.Clear();
            SqlDataReader rdrTaskInCase = cmdQueryForTaskInCase.ExecuteReader();
            if (rdrTaskInCase.HasRows)
            {
                while (rdrTaskInCase.Read())
                {
                    DataGridViewRow row = new DataGridViewRow();
                    if (!rdrTaskInCase.IsDBNull(0)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrTaskInCase.GetString(0) });
                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                    if (!rdrTaskInCase.IsDBNull(1)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrTaskInCase.GetString(1) });
                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                    if (!rdrTaskInCase.IsDBNull(2)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrTaskInCase.GetString(2) });
                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                    if (!rdrTaskInCase.IsDBNull(3)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrTaskInCase.GetString(3) });
                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                    if (!rdrTaskInCase.IsDBNull(4)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrTaskInCase.GetString(4) });
                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                    if (!rdrTaskInCase.IsDBNull(5)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrTaskInCase.GetDateTime(5).ToString("MM/dd/yyyy") });
                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                    if (!rdrTaskInCase.IsDBNull(6)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrTaskInCase.GetString(6) });
                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                    if (!rdrTaskInCase.IsDBNull(7)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrTaskInCase.GetDateTime(7).ToString("MM/dd/yyyy") });
                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                    if (!rdrTaskInCase.IsDBNull(8)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrTaskInCase.GetString(8) });
                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                    if (!rdrTaskInCase.IsDBNull(9)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrTaskInCase.GetDateTime(9).ToString("MM/dd/yyyy") });
                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                    if (!rdrTaskInCase.IsDBNull(10)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrTaskInCase.GetString(10) });
                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                    if (!rdrTaskInCase.IsDBNull(11)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrTaskInCase.GetString(11) });
                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                    if (!rdrTaskInCase.IsDBNull(12)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrTaskInCase.GetString(12) });
                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                    if (!rdrTaskInCase.IsDBNull(13)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrTaskInCase.GetString(13) });
                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                    if (!rdrTaskInCase.IsDBNull(14)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrTaskInCase.GetInt32(14) });
                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                    if (!rdrTaskInCase.IsDBNull(15)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrTaskInCase.GetInt32(15) });
                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });

                    if (IsHandleCreated) AddRowTaskInCaseSafely(row);
                    else gvTaskInCase.Rows.Add(row);
                }
            }
            rdrTaskInCase.Close();
            if (connRN2.State != ConnectionState.Closed) connRN2.Close();
        }

        private void OnMedBillsInCaseChange(object sender, SqlNotificationEventArgs e)
        {
            if (e.Type == SqlNotificationType.Change)
            {
                SqlDependency dependency = sender as SqlDependency;
                dependency.OnChange -= OnMedBillsInCaseChange;

                UpdateGridViewMedBillsInCase();
            }
        }

        private void UpdateGridViewMedBillsInCase()
        {
            String IndividualId = txtIndividualID.Text.Trim();
            //String CaseId = gvProcessingCaseNo["CaseIdForIndividual", nRowSelected].Value.ToString().Trim();

            String strSqlQueryForMedBillInCase = "select [dbo].[tbl_medbill].[BillNo], [dbo].[tbl_medbill_type].[MedBillTypeName], " +
                 "[dbo].[tbl_medbill].[CreatedDate], [dbo].[tbl_CreateStaff].[Staff_Name], " +
                 "[dbo].[tbl_medbill].[LastModifiedDate], [dbo].[tbl_ModifiStaff].[Staff_Name], " +
                 "[dbo].[tbl_medbill].[BillAmount], [dbo].[tbl_medbill].[SettlementTotal], [dbo].[tbl_medbill].[TotalSharedAmount], [dbo].[tbl_medbill].[Balance] " +
                 "from [dbo].[tbl_medbill] " +
                 "inner join [dbo].[tbl_medbill_type] on [dbo].[tbl_medbill].[MedBillType_Id] = [dbo].[tbl_medbill_type].[MedBillTypeId] " +
                 "inner join [dbo].[tbl_CreateStaff] on [dbo].[tbl_medbill].[CreatedById] = [dbo].[tbl_CreateStaff].[CreateStaff_Id] " +
                 "inner join [dbo].[tbl_ModifiStaff] on [dbo].[tbl_medbill].[LastModifiedById] = [dbo].[tbl_ModifiStaff].[ModifiStaff_Id] " +
                 "where [dbo].[tbl_medbill].[Case_Id] = @CaseName and " +
                 "[dbo].[tbl_medbill].[Contact_Id] = @IndividualId and " +
                 "[dbo].[tbl_medbill].[IsDeleted] = 0";

            SqlCommand cmdQueryForMedBillsInCase = new SqlCommand(strSqlQueryForMedBillInCase, connRN2);
            cmdQueryForMedBillsInCase.CommandType = CommandType.Text;

            cmdQueryForMedBillsInCase.Parameters.AddWithValue("@CaseName", CaseIdForCasePageMedBill);
            cmdQueryForMedBillsInCase.Parameters.AddWithValue("@IndividualId", IndividualId);

            SqlDependency dependencyMedBillInCase = new SqlDependency(cmdQueryForMedBillsInCase);
            dependencyMedBillInCase.OnChange += new OnChangeEventHandler(OnMedBillsInCaseChange);

            //if (connRN.State == ConnectionState.Closed) connRN.Open();
            if (connRN2.State != ConnectionState.Closed)
            {
                connRN2.Close();
                connRN2.Open();
            }
            else if (connRN2.State == ConnectionState.Closed) connRN2.Open();
            SqlDataReader rdrMedBillInCase = cmdQueryForMedBillsInCase.ExecuteReader();

            //gvCasePageMedBills.Rows.Clear();
            if (IsHandleCreated) ClearMedBillInCaseSafely();
            else gvCasePageMedBills.Rows.Clear();

            if (rdrMedBillInCase.HasRows)
            {
                while (rdrMedBillInCase.Read())
                {
                    DataGridViewRow row = new DataGridViewRow();

                    //row.Cells.Add(new DataGridViewCheckBoxCell { Value = false });
                    //row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillInCase.GetString(0) });
                    //row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillInCase.GetString(1) });
                    //row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillInCase.GetDateTime(2).ToString("MM/dd/yyyy") });
                    //row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillInCase.GetString(3) });
                    //row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillInCase.GetDateTime(4).ToString("MM/dd/yyyy") });
                    //row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillInCase.GetString(5) });
                    //row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillInCase.GetDecimal(6).ToString("C") });
                    //row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillInCase.GetDecimal(7).ToString("C") });
                    //row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillInCase.GetDecimal(8).ToString("C") });
                    //row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillInCase.GetDecimal(9).ToString("C") });

                    row.Cells.Add(new DataGridViewCheckBoxCell { Value = false });
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillInCase.GetString(0) });
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillInCase.GetString(1) });
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillInCase.GetDateTime(2).ToString("MM/dd/yyyy") });
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillInCase.GetDecimal(6).ToString("C") });
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillInCase.GetDecimal(7).ToString("C") });
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillInCase.GetDecimal(8).ToString("C") });
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillInCase.GetDecimal(9).ToString("C") });
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillInCase.GetString(3) });
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillInCase.GetDateTime(4).ToString("MM/dd/yyyy") });
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillInCase.GetString(5) });


                    //gvCasePageMedBills.Rows.Add(row);
                    if (IsHandleCreated) AddNewRowToMedBillInCaseSafely(row);
                    else gvCasePageMedBills.Rows.Add(row);
                }
                if (IsHandleCreated) EnableEditMedBillSafely();
                else btnEditMedBill.Enabled = true;
                if (IsHandleCreated) EnableDeleteMedBillSafely();
                else btnDeleteMedBill.Enabled = true;
            }
            rdrMedBillInCase.Close();
            if (connRN2.State != ConnectionState.Closed) connRN2.Close();
        }

        private void EnableEditMedBillSafely()
        {
            btnEditMedBill.BeginInvoke(new EnableEditMedBillButton(EnableEditMedBill));
        }

        private void DisableEditMedBillSafely()
        {
            btnEditMedBill.BeginInvoke(new DisableEditMedBillButton(DisableEditMedBill));
        }

        private void EnableEditMedBill()
        {
            btnEditMedBill.Enabled = true;
        }

        private void DisableEditMedBill()
        {
            btnEditMedBill.Enabled = false;
        }

        private void EnableDeleteMedBillSafely()
        {
            btnDeleteMedBill.BeginInvoke(new EnableDeleteMedBillButton(EnableDeleteMedBill));
        }

        private void DisableDeleteMedBillSafely()
        {
            btnDeleteMedBill.BeginInvoke(new DisableDeleteMedBillButton(DisableDeleteMedBill));
        }

        private void EnableDeleteMedBill()
        {
            btnDeleteMedBill.Enabled = true;
        }

        private void DisableDeleteMedBill()
        {
            btnDeleteMedBill.Enabled = false;
        }

        private void gvCasePageMedBills_CellDoubleClick(object sender, DataGridViewCellEventArgs e)
        {

            if (e.RowIndex <= -1)
            {
                return;
            }

            DataGridView gvMedBill = (DataGridView)sender;
            String IndividualId = String.Empty;
            String CaseNo = String.Empty;

            if (gvMedBill.Rows.Count > 0)
            {
                InitializeMedBillTabOnNewMedBill();

                //PrevViewToMedicalBill = ViewPrevToMedBill.CaseView;

                String IndividualName = String.Empty;
                String CaseNameInMedBill = txtCaseName.Text.Trim();
                String IndividualIdInMedBill = txtCaseIndividualID.Text.Trim();
                Boolean bMedBillInUse = false;

                String MedBillNoForCase = gvCasePageMedBills["MedBillNo", e.RowIndex].Value.ToString();
                MedBillNoForTask = MedBillNoForCase;

                String strSqlQueryForMedBillInUse = "select [dbo].[tbl_MedBillInUse].[BillNo], [dbo].[tbl_MedBillInUse].[EditingStaff] from [dbo].[tbl_MedBillInUse] " +
                                                    "where [dbo].[tbl_MedBillInUse].[BillNo] = @MedBillInUse";

                SqlCommand cmdQueryForMedBillInUse = new SqlCommand(strSqlQueryForMedBillInUse, connRN4);
                cmdQueryForMedBillInUse.CommandType = CommandType.Text;

                cmdQueryForMedBillInUse.Parameters.AddWithValue("@MedBillInUse", MedBillNoForCase);

                if (connRN4.State != ConnectionState.Closed)
                {
                    connRN4.Close();
                    connRN4.Open();
                }
                else if (connRN4.State == ConnectionState.Closed) connRN4.Open();
                SqlDataReader rdrMedBillInUse = cmdQueryForMedBillInUse.ExecuteReader();
                if (rdrMedBillInUse.HasRows)
                {
                    rdrMedBillInUse.Read();
                    if (MedBillNoForCase == rdrMedBillInUse.GetString(0).Trim() &&
                        nLoggedUserId != rdrMedBillInUse.GetInt16(1))
                    {
                        MessageBox.Show("The Medical Bill: " + MedBillNoForCase + " is in use.", "Alert");
                        rdrMedBillInUse.Close();
                        if (connRN4.State != ConnectionState.Closed) connRN4.Close();
                        bMedBillInUse = true;
                        //return;
                    }
                }
                else
                {
                    rdrMedBillInUse.Close();
                    if (connRN4.State != ConnectionState.Closed) connRN.Close();

                    String strSqlInsertMedBillInUse = "insert into [dbo].[tbl_MedBillInUse] (BillNo, EditingStaff) values (@MedBillNo, @ModifyingStaff)";

                    SqlCommand cmdInsertMedBillInUse = new SqlCommand(strSqlInsertMedBillInUse, connRN4);
                    cmdInsertMedBillInUse.CommandType = CommandType.Text;

                    cmdInsertMedBillInUse.Parameters.AddWithValue("@MedBillNo", MedBillNoForCase);
                    cmdInsertMedBillInUse.Parameters.AddWithValue("@ModifyingStaff", nLoggedUserId);

                    if (connRN4.State != ConnectionState.Closed)
                    {
                        connRN4.Close();
                        connRN4.Open();
                    }
                    else if (connRN4.State == ConnectionState.Closed) connRN4.Open();
                    int nMedBillInUseInserted = cmdInsertMedBillInUse.ExecuteNonQuery();
                    if (nMedBillInUseInserted != 1)
                    {
                        MessageBox.Show("Medical Bill in use: " + MedBillNoForCase + " has not been inserted.", "Error");
                        if (connRN4.State != ConnectionState.Closed) connRN4.Close();
                        return;
                    }
                    if (connRN4.State != ConnectionState.Closed) connRN4.Close();
                }


                //if (connRN4.State != ConnectionState.Closed) connRN4.Close();


                //////////////////////////////////////////////////////////////////////////////////
                String strPatientLastName = txtLastName.Text.Trim();
                String strPatientFirstName = txtFirstName.Text.Trim();
                String strPatientMiddleName = txtMiddleName.Text.Trim();
                String strDateOfBirth = dtpBirthDate.Value.ToString("MM/dd/yyyy");
                String strSSN = txtIndividualSSN.Text.Trim();
                String strStreetAddr = txtStreetAddress1.Text.Trim();
                String strCity = txtCity1.Text.Trim();
                String strState = txtState1.Text.Trim();
                String strZip = txtZip1.Text.Trim();

                switch (IndividualSearched.IndividualPlan)
                {
                    case Plan.GoldPlus:
                        txtMemberProgram.Text = "Gold Plus";
                        break;
                    case Plan.Gold:
                        txtMemberProgram.Text = "Gold";
                        break;
                    case Plan.Silver:
                        txtMemberProgram.Text = "Silver";
                        break;
                    case Plan.Bronze:
                        txtMemberProgram.Text = "Bronze";
                        break;
                    case Plan.GoldMedi_I:
                        txtMemberProgram.Text = "Gold Medi-I";
                        break;
                    case Plan.GoldMedi_II:
                        txtMemberProgram.Text = "Gold Medi-II";
                        break;
                }

                txtIndividualIDMedBill.Text = IndividualIdInMedBill;
                if (strPatientMiddleName.Trim() == String.Empty) txtPatientNameMedBill.Text = strPatientLastName + ", " + strPatientFirstName;
                else if (strPatientMiddleName.Trim() != String.Empty) txtPatientNameMedBill.Text = strPatientLastName + ", " + strPatientFirstName + " " + strPatientMiddleName;

                txtMedBillDOB.Text = strDateOfBirth;
                txtMedBillSSN.Text = strSSN;
                txtMedBillAddress.Text = strStreetAddr + ", " + strCity + ", " + strState + " " + strZip;

                // populate Medical Bill types
                String strSqlQueryForMedBillTypes = "select [dbo].[tbl_medbill_type].[MedBillTypeId], [dbo].[tbl_medbill_type].[MedBillTypeName] from [dbo].[tbl_medbill_type]";

                SqlCommand cmdQueryForMedBillTypes = new SqlCommand(strSqlQueryForMedBillTypes, connRN4);
                cmdQueryForMedBillTypes.CommandType = CommandType.Text;

                //if (connRN.State == ConnectionState.Closed) connRN.Open();
                if (connRN4.State != ConnectionState.Closed)
                {
                    connRN4.Close();
                    connRN4.Open();
                }
                else if (connRN4.State == ConnectionState.Closed) connRN4.Open();

                SqlDataReader rdrMedBillTypes = cmdQueryForMedBillTypes.ExecuteReader();
                dicMedBillTypes.Clear();

                if (rdrMedBillTypes.HasRows)
                {
                    while (rdrMedBillTypes.Read())
                    {
                        if (!rdrMedBillTypes.IsDBNull(0) && !rdrMedBillTypes.IsDBNull(1))
                        {
                            dicMedBillTypes.Add(rdrMedBillTypes.GetInt16(0), rdrMedBillTypes.GetString(1));
                        }
                    }
                }
                rdrMedBillTypes.Close();
                if (connRN4.State != ConnectionState.Closed) connRN4.Close();



                // Get the Medical Bill Note Type info
                //List<MedBillNoteTypeInfo> lstMedBillNoteTypeInfo = new List<MedBillNoteTypeInfo>();
                //String strSqlQueryForMedBillNoteTypeInfo = "select [dbo].[tbl_MedBillNoteType].[MedBillNoteTypeId], [dbo].[tbl_MedBillNoteType].[MedBillNoteTypeValue] from [dbo].[tbl_MedBillNoteType]";

                //SqlCommand cmdQueryForMedBillNoteTypeInfo = new SqlCommand(strSqlQueryForMedBillNoteTypeInfo, connRN);
                //cmdQueryForMedBillNoteTypeInfo.CommandType = CommandType.Text;

                //if (connRN.State != ConnectionState.Closed)
                //{
                //    connRN.Close();
                //    connRN.Open();
                //}
                //else if (connRN.State == ConnectionState.Closed) connRN.Open();
                //SqlDataReader rdrMedBillNoteType = cmdQueryForMedBillNoteTypeInfo.ExecuteReader();
                //if (rdrMedBillNoteType.HasRows)
                //{
                //    while (rdrMedBillNoteType.Read())
                //    {
                //        if (!rdrMedBillNoteType.IsDBNull(0) && !rdrMedBillNoteType.IsDBNull(1))
                //        {
                //            lstMedBillNoteTypeInfo.Add(new MedBillNoteTypeInfo { MedBillNoteTypeId = rdrMedBillNoteType.GetInt16(0), MedBillNoteTypeValue = rdrMedBillNoteType.GetString(1) });
                //        }
                //    }
                //}
                //if (connRN.State != ConnectionState.Closed) connRN.Close();

                // Populate Pending Reason
                comboPendingReason.Items.Clear();

                if (dicPendingReason.Count > 0)
                {
                    for (int i = 0; i < dicPendingReason.Count; i++)
                    {
                        comboPendingReason.Items.Add(dicPendingReason[i]);
                    }
                    comboPendingReason.SelectedIndex = 0;
                }
                //comboPendingReason.Sorted = true;
                // Populate Ineligible Reason
                comboIneligibleReason.Items.Clear();

                if (dicIneligibleReason.Count > 0)
                {
                    for (int i = 0; i < dicIneligibleReason.Count; i++)
                    {
                        comboIneligibleReason.Items.Add(dicIneligibleReason[i]);
                    }
                    comboIneligibleReason.SelectedIndex = 0;
                }

                //if (lstIneligibleReasonInfo.Count > 0)
                //{
                //    foreach (IneligibleReasonInfo info in lstIneligibleReasonInfo)
                //    {
                //        comboIneligibleReason.Items.Add(info.IneligibleReason);
                //    }
                //    comboIneligibleReason.SelectedIndex = 0;
                //}

                //comboIneligibleReason.Sorted = true;

                //tbCMMManager.TabPages.Insert(5, tbpgMedicalBill);
                //tbCMMManager.SelectedTab = tbpgMedicalBill;



                //String strSqlQueryForMedicalProvider = "select [dbo].[account].[Id], [dbo].[account].[Name], [dbo].[account].[Type] from [dbo].[account] " +
                //                       "where [dbo].[account].[RecordTypeId] = '01237000000EVmlAAG'";

                //SqlCommand cmdQueryForMedicalProvider = new SqlCommand(strSqlQueryForMedicalProvider, connSalesforce);
                //cmdQueryForMedicalProvider.CommandType = CommandType.Text;

                ////if (connRN.State == ConnectionState.Closed) connRN.Open();
                //if (connSalesforce.State != ConnectionState.Closed)
                //{
                //    connSalesforce.Close();
                //    connSalesforce.Open();
                //}
                //else if (connSalesforce.State == ConnectionState.Closed) connSalesforce.Open();

                //SqlDataReader rdrMedicalProvider = cmdQueryForMedicalProvider.ExecuteReader();

                //lstMedicalProvider.Clear();
                //if (rdrMedicalProvider.HasRows)
                //{
                //    while (rdrMedicalProvider.Read())
                //    {
                //        MedicalProviderInfo info = new MedicalProviderInfo();

                //        if (!rdrMedicalProvider.IsDBNull(0)) info.ID = rdrMedicalProvider.GetString(0);
                //        if (!rdrMedicalProvider.IsDBNull(1)) info.Name = rdrMedicalProvider.GetString(1);
                //        if (!rdrMedicalProvider.IsDBNull(2)) info.Type = rdrMedicalProvider.GetString(2);

                //        lstMedicalProvider.Add(info);
                //    }
                //}
                //rdrMedicalProvider.Close();
                //if (connSalesforce.State != ConnectionState.Closed) connSalesforce.Close();

                //var srcMedicalProvider = new AutoCompleteStringCollection();
                //for (int i = 0; i < lstMedicalProvider.Count; i++)
                //{
                //    srcMedicalProvider.Add(lstMedicalProvider[i].Name);
                //}

                //txtMedicalProvider.AutoCompleteMode = AutoCompleteMode.SuggestAppend;
                //txtMedicalProvider.AutoCompleteSource = AutoCompleteSource.CustomSource;
                //txtMedicalProvider.AutoCompleteCustomSource = srcMedicalProvider;


                /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                // Get medical bill info
                String ICD10Code = String.Empty;
                
                //String strSqlQueryForMedBillEdit = "select [dbo].[tbl_medbill].[Case_Id], [dbo].[tbl_medbill].[Illness_Id], [dbo].[tbl_medbill].[Incident_Id], " +
                //                                   "[dbo].[tbl_medbill].[BillNo], [dbo].[tbl_medbill].[MedBillType_Id], [dbo].[tbl_medbill].[BillStatus], [dbo].[tbl_medbill].[BillClosed], " +
                //                                   "[dbo].[tbl_medbill].[BillAmount], [dbo].[tbl_MedicalProvider].[Name], " +
                //                                   "[dbo].[tbl_medbill].[PrescriptionDrugName], [dbo].[tbl_medbill].[PrescriptionNo], [dbo].[tbl_medbill].[PrescriptionDescription], " +
                //                                   "[dbo].[tbl_medbill].[TotalNumberOfPhysicalTherapy], [dbo].[tbl_medbill].[PatientTypeId], " +
                //                                   "[dbo].[tbl_medbill].[BillDate], [dbo].[tbl_medbill].[DueDate], " +
                //                                   "[dbo].[tbl_medbill].[Account_At_Provider], [dbo].[tbl_MedicalProvider].[PHONE], [dbo].[tbl_medbill].[ProviderContactPerson], " +
                //                                   "[dbo].[tbl_medbill].[Note], " +
                //                                   "[dbo].[tbl_illness].[ICD_10_Id], " +
                //                                   "[dbo].[tbl_medbill].[PendingReason], [dbo].[tbl_medbill].[IneligibleReason], " +
                //                                   "[dbo].[tbl_medbill].[Account_At_Provider], [dbo].[tbl_medbill].[ProviderPhoneNumber], [dbo].[tbl_medbill].[ProviderContactPerson], " +
                //                                   "[dbo].[tbl_medbill].[ProposalLetterSentDate], [dbo].[tbl_medbill].[HIPPASentDate], [dbo].[tbl_medbill].[MedicalRecordDate] " +
                //                                   "from (([dbo].[tbl_medbill] inner join [dbo].[tbl_illness] on [dbo].[tbl_medbill].[Illness_Id] = [dbo].[tbl_illness].[Illness_Id]) " +
                //                                   "inner join [dbo].[tbl_MedicalProvider] on [dbo].[tbl_medbill].[MedicalProvider_Id] = [dbo].[tbl_MedicalProvider].[ID]) " +
                //                                   "where [dbo].[tbl_medbill].[BillNo] = @MedBillNo and " +
                //                                   "[dbo].[tbl_medbill].[Case_Id] = @CaseName and " +
                //                                   "[dbo].[tbl_medbill].[Contact_Id] = @IndividualId and" +
                //                                   "[dbo].[tbl_medbill].[IsDeleted] = 0";

                //String strSqlQueryForMedicalProviderId = 


                //String strSqlQueryForMedBillEdit = "select [dbo].[tbl_medbill].[Case_Id], [dbo].[tbl_illness].[IllnessNo], [dbo].[tbl_incident].[IncidentNo], " +
                //                "[dbo].[tbl_medbill].[BillNo], [dbo].[tbl_medbill].[MedBillType_Id], [dbo].[tbl_medbill].[BillStatus], [dbo].[tbl_medbill].[BillClosed], " +
                //                "[dbo].[tbl_medbill].[BillAmount], [dbo].[tbl_MedicalProvider].[Name], " +
                //                "[dbo].[tbl_medbill].[PrescriptionDrugName], [dbo].[tbl_medbill].[PrescriptionNo], [dbo].[tbl_medbill].[PrescriptionDescription], " +
                //                "[dbo].[tbl_medbill].[TotalNumberOfPhysicalTherapy], [dbo].[tbl_medbill].[PatientTypeId], " +
                //                "[dbo].[tbl_medbill].[BillDate], [dbo].[tbl_medbill].[DueDate], " +
                //                "[dbo].[tbl_medbill].[Account_At_Provider], [dbo].[tbl_medbill].[ProviderContactPerson], " +
                //                "[dbo].[tbl_medbill].[Note], " +
                //                "[dbo].[tbl_illness].[ICD_10_Id], " +
                //                "[dbo].[tbl_medbill].[PendingReason], [dbo].[tbl_medbill].[IneligibleReason], " +
                //                "[dbo].[tbl_medbill].[Account_At_Provider], [dbo].[tbl_medbill].[ProviderPhoneNumber], [dbo].[tbl_medbill].[ProviderContactPerson], " +
                //                "[dbo].[tbl_medbill].[ProposalLetterSentDate], [dbo].[tbl_medbill].[HIPPASentDate], [dbo].[tbl_medbill].[MedicalRecordDate], " +
                //                "[dbo].[tbl_medbill].[Illness_Id], [dbo].[tbl_medbill].[Incident_Id] " +
                //                "from [dbo].[tbl_medbill] " +
                //                "inner join [dbo].[tbl_illness] on [dbo].[tbl_medbill].[Illness_Id] = [dbo].[tbl_illness].[Illness_Id] " +
                //                "inner join [dbo].[tbl_incident] on [dbo].[tbl_medbill].[Incident_Id] = [dbo].[tbl_incident].[Incident_id] " +
                //                "inner join [dbo].[tbl_MedicalProvider] on [dbo].[tbl_medbill].[MedicalProvider_Id] = [dbo].[tbl_MedicalProvider].[ID] " +
                //                "where [dbo].[tbl_medbill].[BillNo] = @MedBillNo and " +
                //                "[dbo].[tbl_medbill].[Case_Id] = @CaseName and " +
                //                "[dbo].[tbl_medbill].[Contact_Id] = @IndividualId and" +
                //                "[dbo].[tbl_medbill].[IsDeleted] = 0";

                String MedicalProviderId = String.Empty;

                String strSqlQueryForMedBillEdit = "select [dbo].[tbl_medbill].[Case_Id], [dbo].[tbl_illness].[IllnessNo], [dbo].[tbl_incident].[IncidentNo], " +
                                "[dbo].[tbl_medbill].[BillNo], [dbo].[tbl_medbill].[MedBillType_Id], [dbo].[tbl_medbill].[BillStatus], [dbo].[tbl_medbill].[BillClosed], " +
                                "[dbo].[tbl_medbill].[BillAmount], [dbo].[tbl_medbill].[MedicalProvider_Id], " +
                                "[dbo].[tbl_medbill].[PrescriptionDrugName], [dbo].[tbl_medbill].[PrescriptionNo], [dbo].[tbl_medbill].[PrescriptionDescription], " +
                                "[dbo].[tbl_medbill].[TotalNumberOfPhysicalTherapy], [dbo].[tbl_medbill].[PatientTypeId], " +
                                "[dbo].[tbl_medbill].[BillDate], [dbo].[tbl_medbill].[DueDate], " +
                                "[dbo].[tbl_medbill].[Account_At_Provider], [dbo].[tbl_medbill].[ProviderContactPerson], " +
                                "[dbo].[tbl_medbill].[Note], " +
                                "[dbo].[tbl_illness].[ICD_10_Id], " +
                                "[dbo].[tbl_medbill].[PendingReason], [dbo].[tbl_medbill].[IneligibleReason], " +
                                "[dbo].[tbl_medbill].[Account_At_Provider], [dbo].[tbl_medbill].[ProviderPhoneNumber], [dbo].[tbl_medbill].[ProviderContactPerson], " +
                                "[dbo].[tbl_medbill].[ProposalLetterSentDate], [dbo].[tbl_medbill].[HIPPASentDate], [dbo].[tbl_medbill].[MedicalRecordDate], " +
                                "[dbo].[tbl_medbill].[Illness_Id], [dbo].[tbl_medbill].[Incident_Id], " +
                                "[dbo].[tbl_medbill].[NPF_Form], [dbo].[tbl_medbill].[NPF_SourceFileName], [dbo].[tbl_medbill].[NPF_DestinationFileName], " +
                                "[dbo].[tbl_medbill].[IB_Form], [dbo].[tbl_medbill].[IB_SourceFileName], [dbo].[tbl_medbill].[IB_DestinationFileName], " +
                                "[dbo].[tbl_medbill].[POP_Form], [dbo].[tbl_medbill].[POP_SourceFileName], [dbo].[tbl_medbill].[POP_DestinationFileName], " +
                                "[dbo].[tbl_medbill].[MedRec_Form], [dbo].[tbl_medbill].[MedRec_SourceFileName], [dbo].[tbl_medbill].[MedRec_DestinationFileName], " +
                                "[dbo].[tbl_medbill].[Unknown_Form], [dbo].[tbl_medbill].[Unknown_SourceFileName], [dbo].[tbl_medbill].[Unknown_DestinationFileName] " +
                                "from [dbo].[tbl_medbill] " +
                                "inner join [dbo].[tbl_illness] on [dbo].[tbl_medbill].[Illness_Id] = [dbo].[tbl_illness].[Illness_Id] " +
                                "inner join [dbo].[tbl_incident] on [dbo].[tbl_medbill].[Incident_Id] = [dbo].[tbl_incident].[Incident_id] " +
                                "where [dbo].[tbl_medbill].[BillNo] = @MedBillNo and " +
                                "[dbo].[tbl_medbill].[Case_Id] = @CaseName and " +
                                "[dbo].[tbl_medbill].[Contact_Id] = @IndividualId and" +
                                "[dbo].[tbl_medbill].[IsDeleted] = 0";

                SqlCommand cmdQueryForMedBillEdit = new SqlCommand(strSqlQueryForMedBillEdit, connRN4);
                cmdQueryForMedBillEdit.CommandType = CommandType.Text;

                cmdQueryForMedBillEdit.Parameters.AddWithValue("@MedBillNo", MedBillNoForCase);
                cmdQueryForMedBillEdit.Parameters.AddWithValue("@CaseName", CaseNameInMedBill);
                cmdQueryForMedBillEdit.Parameters.AddWithValue("@IndividualId", IndividualIdInMedBill);

                //if (connRN.State == ConnectionState.Closed) connRN.Open();
                if (connRN4.State != ConnectionState.Closed)
                {
                    connRN4.Close();
                    connRN4.Open();
                }
                else if (connRN4.State == ConnectionState.Closed) connRN4.Open();

                SqlDataReader rdrMedBillEdit = cmdQueryForMedBillEdit.ExecuteReader();
                if (rdrMedBillEdit.HasRows)
                {
                    rdrMedBillEdit.Read();

                    if (!rdrMedBillEdit.IsDBNull(0)) txtMedBill_CaseNo.Text = rdrMedBillEdit.GetString(0).Trim();
                    if (!rdrMedBillEdit.IsDBNull(1))
                    {
                        Illness.IllnessNo = rdrMedBillEdit.GetString(1).Trim();
                        txtMedBill_Illness.Text = rdrMedBillEdit.GetString(1).Trim();
                    }
                    if (!rdrMedBillEdit.IsDBNull(2))
                    {
                        Incident.IncidentNo = rdrMedBillEdit.GetString(2).Trim();
                        txtMedBill_Incident.Text = rdrMedBillEdit.GetString(2).Trim();
                    }

                    if (!rdrMedBillEdit.IsDBNull(3)) txtMedBillNo.Text = rdrMedBillEdit.GetString(3).Trim();

                    if (!rdrMedBillEdit.IsDBNull(4))
                    {
                        comboMedBillType.Items.Clear();
                        for (int i = 1; i <= dicMedBillTypes.Count; i++)
                        {
                            comboMedBillType.Items.Add(dicMedBillTypes[i]);
                        }
                        comboMedBillType.SelectedIndex = rdrMedBillEdit.GetInt16(4) - 1;
                    }

                    if (!rdrMedBillEdit.IsDBNull(5))
                    {
                        if (dicMedBillStatus.Count > 0)
                        {
                            comboMedBillStatus.Items.Clear();
                            for (int i = 0; i < dicMedBillStatus.Count; i++)
                            {
                                comboMedBillStatus.Items.Add(dicMedBillStatus[i]);
                            }
                            comboMedBillStatus.SelectedIndex = rdrMedBillEdit.GetInt16(5);
                        }

                        //if (lstMedBillStatusInfo.Count > 0)
                        //{
                        //    comboMedBillStatus.Items.Clear();
                        //    foreach (MedBillStatusInfo info in lstMedBillStatusInfo)
                        //    {
                        //        if (info.IsDeleted == false) comboMedBillStatus.Items.Add(info.BillStatusValue);
                        //    }
                        //    if (rdrMedBillEdit.GetInt16(5) == 0 || rdrMedBillEdit.GetInt16(5) == 2)
                        //}
                    }
                    if (!rdrMedBillEdit.IsDBNull(6))
                    {
                        if (rdrMedBillEdit.GetBoolean(6) == true) cbMedBillClosed.SelectedIndex = 1;
                        else cbMedBillClosed.SelectedIndex = 0;
                    }
                    else cbMedBillClosed.SelectedIndex = 0;

                    if (!rdrMedBillEdit.IsDBNull(7))
                    {
                        txtMedBillAmount.Text = rdrMedBillEdit.GetDecimal(7).ToString("C");
                        txtBalance.Text = rdrMedBillEdit.GetDecimal(7).ToString("C");
                    }
                    //if (!rdrMedBillEdit.IsDBNull(8)) txtMedicalProvider.Text = rdrMedBillEdit.GetString(8).Trim();
                    if (!rdrMedBillEdit.IsDBNull(8)) MedicalProviderId = rdrMedBillEdit.GetString(8).Trim();
                    if (!rdrMedBillEdit.IsDBNull(9)) txtPrescriptionName.Text = rdrMedBillEdit.GetString(9).Trim();
                    if (!rdrMedBillEdit.IsDBNull(10)) txtNumberOfMedication.Text = rdrMedBillEdit.GetString(10).Trim();
                    if (!rdrMedBillEdit.IsDBNull(11)) txtPrescriptionDescription.Text = rdrMedBillEdit.GetString(11).Trim();
                    if (!rdrMedBillEdit.IsDBNull(12)) txtNumPhysicalTherapy.Text = rdrMedBillEdit.GetInt16(12).ToString();
                    if (!rdrMedBillEdit.IsDBNull(13))
                    {
                        int nPatientType = rdrMedBillEdit.GetInt16(13);

                        if (nPatientType == 0) rbOutpatient.Checked = true;
                        else if (nPatientType == 1) rbInpatient.Checked = true;
                    }
                    // Bill date
                    if (!rdrMedBillEdit.IsDBNull(14))
                    {
                        dtpBillDate.Checked = true;
                        dtpBillDate.Text = rdrMedBillEdit.GetDateTime(14).ToString("MM/dd/yyyy");
                    }
                    else
                    {
                        dtpBillDate.Format = DateTimePickerFormat.Custom;
                        dtpBillDate.CustomFormat = " ";
                    }

                    // Due date
                    if (!rdrMedBillEdit.IsDBNull(15))
                    {
                        dtpDueDate.Checked = true;
                        dtpDueDate.Text = rdrMedBillEdit.GetDateTime(15).ToString("MM/dd/yyyy");
                    }
                    else
                    {
                        dtpDueDate.Format = DateTimePickerFormat.Custom;
                        dtpDueDate.CustomFormat = " ";
                    }

                    if (!rdrMedBillEdit.IsDBNull(16)) txtMedBillAccountNoAtProvider.Text = rdrMedBillEdit.GetString(16);
                    //if (!rdrMedBillEdit.IsDBNull(17)) txtMedProviderPhoneNo.Text = rdrMedBillEdit.GetString(17);
                    if (!rdrMedBillEdit.IsDBNull(17)) txtProviderContactPerson.Text = rdrMedBillEdit.GetString(17);

                    if (!rdrMedBillEdit.IsDBNull(18))
                    {
                        if (comboMedBillType.SelectedIndex == 0) txtMedBillNote.Text = rdrMedBillEdit.GetString(18);
                        if (comboMedBillType.SelectedIndex == 1) txtPrescriptionNote.Text = rdrMedBillEdit.GetString(18);
                        if (comboMedBillType.SelectedIndex == 2) txtPhysicalTherapyRxNote.Text = rdrMedBillEdit.GetString(18);
                    }

                    if (!rdrMedBillEdit.IsDBNull(19))
                    {
                        ICD10Code = rdrMedBillEdit.GetString(19).Trim();
                        Illness.ICD10Code = ICD10Code;
                        //txtMedBill_Illness.Text = ICD10Code;
                    }

                    //if ((comboMedBillType.SelectedIndex == 0) && (!rdrMedBillEdit.IsDBNull(20)))
                    if (!rdrMedBillEdit.IsDBNull(20))
                    {
                        comboPendingReason.SelectedIndex = rdrMedBillEdit.GetInt32(20);
                    }

                    //if ((comboMedBillType.SelectedIndex == 0) && (!rdrMedBillEdit.IsDBNull(21)))
                    if (!rdrMedBillEdit.IsDBNull(21))
                    {
                        comboIneligibleReason.SelectedIndex = rdrMedBillEdit.GetInt32(21);
                    }

                    // Reset fields

                    if (comboMedBillType.SelectedIndex == 0 || comboMedBillType.SelectedIndex == 3)       // Medical Bill Type - Medical Bill
                    {
                        txtPrescriptionName.Text = String.Empty;
                        txtPrescriptionDescription.Text = String.Empty;
                        txtPrescriptionNote.Text = String.Empty;
                        txtNumberOfMedication.Text = String.Empty;

                        txtNumPhysicalTherapy.Text = String.Empty;
                        txtPhysicalTherapyRxNote.Text = String.Empty;
                    }
                    else if (comboMedBillType.SelectedIndex == 1)       // Medical Bill Type - Prescription
                    {
                        txtNumPhysicalTherapy.Text = String.Empty;
                        txtPhysicalTherapyRxNote.Text = String.Empty;

                        rbInpatient.Checked = false;
                        rbOutpatient.Checked = false;

                        //comboPendingReason.SelectedIndex = 0;
                        //comboIneligibleReason.SelectedIndex = 0;

                        txtMedBillNote.Text = String.Empty;
                    }
                    else if (comboMedBillType.SelectedIndex == 2)       // Medical Bill Type - Physical Therapy
                    {
                        txtPrescriptionName.Text = String.Empty;
                        txtPrescriptionDescription.Text = String.Empty;
                        txtPrescriptionNote.Text = String.Empty;
                        txtNumberOfMedication.Text = String.Empty;

                        rbInpatient.Checked = false;
                        rbOutpatient.Checked = false;

                        //comboPendingReason.SelectedIndex = 0;
                        //comboIneligibleReason.SelectedIndex = 0;

                        txtMedBillNote.Text = String.Empty;
                    }

                    if (!rdrMedBillEdit.IsDBNull(22)) txtMedBillAccountNoAtProvider.Text = rdrMedBillEdit.GetString(22);
                    if (!rdrMedBillEdit.IsDBNull(23)) txtMedProviderPhoneNo.Text = rdrMedBillEdit.GetString(23);
                    if (!rdrMedBillEdit.IsDBNull(24)) txtProviderContactPerson.Text = rdrMedBillEdit.GetString(24);

                    if (!rdrMedBillEdit.IsDBNull(25))
                    {
                        dtpProposalLetterSentDate.Checked = true;
                        dtpProposalLetterSentDate.Value = rdrMedBillEdit.GetDateTime(25);
                        dtpProposalLetterSentDate.Format = DateTimePickerFormat.Short;
                    }
                    if (!rdrMedBillEdit.IsDBNull(26))
                    {
                        dtpHippaSentDate.Checked = true;
                        dtpHippaSentDate.Value = rdrMedBillEdit.GetDateTime(26);
                        dtpHippaSentDate.Format = DateTimePickerFormat.Short;
                    }
                    if (!rdrMedBillEdit.IsDBNull(27))
                    {
                        dtpMedicalRecordDate.Checked = true;
                        dtpMedicalRecordDate.Value = rdrMedBillEdit.GetDateTime(27);
                        dtpMedicalRecordDate.Format = DateTimePickerFormat.Short;
                    }

                    if (!rdrMedBillEdit.IsDBNull(28)) Illness.IllnessId = rdrMedBillEdit.GetString(28);
                    else Illness.IllnessId = String.Empty;

                    if (!rdrMedBillEdit.IsDBNull(29)) Incident.IncidentId = rdrMedBillEdit.GetString(29);
                    else Incident.IncidentId = String.Empty;

                    if (!rdrMedBillEdit.IsDBNull(30)) chkNPFMedBill.Checked = rdrMedBillEdit.GetBoolean(30);
                    else chkNPFMedBill.Checked = false;

                    if (!rdrMedBillEdit.IsDBNull(31))
                    {
                        strNPFSourceFilePathMedBill = rdrMedBillEdit.GetString(31);
                        strNPFormFileNameMedBill = Path.GetFileName(strNPFSourceFilePathMedBill);
                        txtNPFMedBillFileName.Text = strNPFormFileNameMedBill;
                    }
                    else txtNPFMedBillFileName.Text = String.Empty;

                    if (!rdrMedBillEdit.IsDBNull(32)) strNPFDestinationFilePathMedBill = rdrMedBillEdit.GetString(32);
                    else strNPFDestinationFilePathMedBill = String.Empty;

                    if (!rdrMedBillEdit.IsDBNull(33)) chkIBMedBill.Checked = rdrMedBillEdit.GetBoolean(33);
                    else chkIBMedBill.Checked = false;

                    if (!rdrMedBillEdit.IsDBNull(34))
                    {
                        strIBSourceFilePathMedBill = rdrMedBillEdit.GetString(34);
                        strIBFileNameMedBill = Path.GetFileName(strIBSourceFilePathMedBill);
                        txtIBMedBillFileName.Text = strIBFileNameMedBill;

                    }
                    else txtIBMedBillFileName.Text = String.Empty;

                    if (!rdrMedBillEdit.IsDBNull(35)) strIBDestinationFilePathMedBill = rdrMedBillEdit.GetString(35);
                    else strIBDestinationFilePathMedBill = String.Empty;

                    if (!rdrMedBillEdit.IsDBNull(36)) chkPoPMedBill.Checked = rdrMedBillEdit.GetBoolean(36);
                    else chkPoPMedBill.Checked = false;

                    if (!rdrMedBillEdit.IsDBNull(37))
                    {
                        strPoPSourceFilePathMedBill = rdrMedBillEdit.GetString(37);
                        strPoPFileNameMedBill = Path.GetFileName(strPoPSourceFilePathMedBill);
                        txtPoPMedBillFileName.Text = strPoPFileNameMedBill;
                    }
                    else txtPoPMedBillFileName.Text = String.Empty;

                    if (!rdrMedBillEdit.IsDBNull(38)) strPoPDestinationFilePathMedBill = rdrMedBillEdit.GetString(38);
                    else strPoPDestinationFilePathMedBill = String.Empty;

                    if (!rdrMedBillEdit.IsDBNull(39)) chkMedRecMedBill.Checked = rdrMedBillEdit.GetBoolean(39);
                    else chkMedRecMedBill.Checked = false;

                    if (!rdrMedBillEdit.IsDBNull(40))
                    {
                        strMedRecSourceFilePathMedBill = rdrMedBillEdit.GetString(40);
                        strMedRecFileNameMedBill = Path.GetFileName(strMedRecSourceFilePathMedBill);
                        txtMedRecMedBillFileName.Text = strMedRecFileNameMedBill;
                    }
                    else txtMedRecMedBillFileName.Text = String.Empty;

                    if (!rdrMedBillEdit.IsDBNull(41)) strMedRecDestinationFilePathMedBill = rdrMedBillEdit.GetString(41);
                    else strMedRecDestinationFilePathMedBill = String.Empty;

                    if (!rdrMedBillEdit.IsDBNull(42)) chkOtherDocMedBill.Checked = rdrMedBillEdit.GetBoolean(42);
                    else chkOtherDocMedBill.Checked = false;

                    if (!rdrMedBillEdit.IsDBNull(43))
                    {
                        strOtherDocSourceFilePathMedBill = rdrMedBillEdit.GetString(43);
                        strOtherDocFileNameMedBill = Path.GetFileName(strOtherDocSourceFilePathMedBill);
                        txtOtherDocMedBillFileName.Text = strOtherDocFileNameMedBill;
                    }

                    if (!rdrMedBillEdit.IsDBNull(44)) strOtherDocDestinationFilePathMedBill = rdrMedBillEdit.GetString(44);
                    else strOtherDocDestinationFilePathMedBill = String.Empty;

                }
                rdrMedBillEdit.Close();
                if (connRN4.State != ConnectionState.Closed) connRN4.Close();

                ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                ///

                String strSqlQueryForMedicalProviderName = "select [dbo].[Account].[Name] from [dbo].[account] where [dbo].[account].[Id] = @MedicalProviderId";

                SqlCommand cmdQueryForMedicalProviderName = new SqlCommand(strSqlQueryForMedicalProviderName, connSalesforce4);
                cmdQueryForMedicalProviderName.CommandType = CommandType.Text;

                cmdQueryForMedicalProviderName.Parameters.AddWithValue("@MedicalProviderId", MedicalProviderId);

                if (connSalesforce4.State != ConnectionState.Closed)
                {
                    connSalesforce4.Close();
                    connSalesforce4.Open();
                }
                else if (connSalesforce4.State == ConnectionState.Closed) connSalesforce4.Open();
                Object objMedicalProviderName = cmdQueryForMedicalProviderName.ExecuteScalar();
                if (connSalesforce4.State != ConnectionState.Closed) connSalesforce4.Close();

                String MedicalProviderName = String.Empty;
                if (objMedicalProviderName != null) MedicalProviderName = objMedicalProviderName.ToString();

                txtMedicalProvider.Text = MedicalProviderName;

                String IncidentNo = txtMedBill_Incident.Text.Trim();
                String IndividualIdMedBill = txtCaseIndividualID.Text.Trim();

                String strSqlQueryForIncident = "select [dbo].[tbl_incident].[Program_id], [dbo].[tbl_program].[ProgramName], [dbo].[tbl_incident].[IsDeleted] " +
                                                "from [dbo].[tbl_incident] " +
                                                "inner join [dbo].[tbl_program] on [dbo].[tbl_incident].[Program_id] = [dbo].[tbl_program].[Program_Id] " +
                                                "where [dbo].[tbl_incident].[Individual_id] = @IndividualId and " +
                                                "[dbo].[tbl_incident].[IncidentNo] = @IncidentNo " +
                                                "order by [dbo].[tbl_incident].[Program_id]";

                SqlCommand cmdQueryForIncident = new SqlCommand(strSqlQueryForIncident, connRN4);
                cmdQueryForIncident.CommandType = CommandType.Text;

                cmdQueryForIncident.Parameters.AddWithValue("@IndividualId", IndividualIdMedBill);
                cmdQueryForIncident.Parameters.AddWithValue("@IncidentNo", IncidentNo);

                if (connRN4.State != ConnectionState.Closed)
                {
                    connRN4.Close();
                    connRN4.Open();
                }
                else if (connRN4.State == ConnectionState.Closed) connRN4.Open();

                SqlDataReader rdrIncident = cmdQueryForIncident.ExecuteReader();
                lstIncidentProgramInfo.Clear();
                if (rdrIncident.HasRows)
                {
                    while (rdrIncident.Read())
                    {
                        if (!rdrIncident.IsDBNull(0) && !rdrIncident.IsDBNull(1))
                        {
                            IncidentProgramInfo incidentProgram = new IncidentProgramInfo(rdrIncident.GetBoolean(2), rdrIncident.GetInt16(0), rdrIncident.GetString(1).Trim());
                            lstIncidentProgramInfo.Add(incidentProgram);
                        }
                    }
                }
                rdrIncident.Close();
                if (connRN4.State == ConnectionState.Open) connRN4.Close();



                ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                /// PR calculation old version
                /// 

                //String strSqlQueryForIncidentChange = "select [dbo].[tbl_incident_history].[Program_id], [dbo].[tbl_program].[ProgramName], [dbo].[tbl_incident_history].[IsDeleted] " +
                //                                        "from [dbo].[tbl_incident_history] " +
                //                                        "inner join [dbo].[tbl_program] on [dbo].[tbl_incident_history].[Program_id] = [dbo].[tbl_program].[Program_Id] " +
                //                                        "where ([dbo].[tbl_incident_history].[Operation] = 2 or " +
                //                                        "[dbo].[tbl_incident_history].[Operation] = 3 or " +
                //                                        "[dbo].[tbl_incident_history].[Operation] = 4) and " +
                //                                        "[dbo].[tbl_incident_history].[Individual_id] = @IndividualId and" +
                //                                        "[dbo].[tbl_incident_history].[IncidentNo] = @IncidentNo " +
                //                                        "order by [dbo].[tbl_incident_history].[Program_id]";

                //SqlCommand cmdQueryForIncidentChange = new SqlCommand(strSqlQueryForIncidentChange, connRN4);
                //cmdQueryForIncidentChange.CommandType = CommandType.Text;

                //cmdQueryForIncidentChange.Parameters.AddWithValue("@IndividualId", IndividualIdMedBill);
                //cmdQueryForIncidentChange.Parameters.AddWithValue("@IncidentNo", IncidentNo);

                //if (connRN4.State != ConnectionState.Closed)
                //{
                //    connRN4.Close();
                //    connRN4.Open();
                //}
                //else if (connRN4.State == ConnectionState.Closed) connRN4.Open();
                //SqlDataReader rdrIncidentChange = cmdQueryForIncidentChange.ExecuteReader();
                ////lstIncidentProgramInfo.Clear();
                //if (rdrIncidentChange.HasRows)
                //{
                //    while (rdrIncidentChange.Read())
                //    {
                //        if (!rdrIncidentChange.IsDBNull(0) && !rdrIncidentChange.IsDBNull(1))
                //        {
                //            IncidentProgramInfo incidentProgram = new IncidentProgramInfo(rdrIncidentChange.GetBoolean(2), rdrIncidentChange.GetInt16(0), rdrIncidentChange.GetString(1).Trim());
                //            lstIncidentProgramInfo.Add(incidentProgram);
                //        }
                //    }
                //}
                //rdrIncidentChange.Close();
                //if (connRN4.State == ConnectionState.Open) connRN4.Close();

                //foreach (IncidentProgramInfo incdInfo in lstIncidentProgramInfo)
                //{
                //    if (incdInfo.bIsDeleted == true)
                //    {
                //        MessageBox.Show("The Incident has been deleted. Personal Responsibility cannot be calculated.", "Error");
                //        lstIncidentProgramInfo.Clear();
                //    }
                //}

                //Boolean bBronze = false;
                //Boolean bSilver = false;
                //Boolean bGold = false;
                //Boolean bGoldPlus = false;
                //Boolean bGoldMed1 = false;
                //Boolean bGoldMed2 = false;

                //if (lstIncidentProgramInfo.Count > 0)
                //{
                //    foreach (IncidentProgramInfo incidentInfo in lstIncidentProgramInfo)
                //    {
                //        if ((incidentInfo.IncidentProgramId == 3) &&
                //            (incidentInfo.bIsDeleted == false))
                //        {
                //            incidentInfo.bPersonalResponsibilityProgram = true;
                //            bBronze = true;
                //            break;
                //        }
                //    }

                //    foreach (IncidentProgramInfo incidentInfo in lstIncidentProgramInfo)
                //    {
                //        if ((incidentInfo.IncidentProgramId == 2) &&
                //            (bBronze == false) &&
                //            (incidentInfo.bIsDeleted == false))
                //        {
                //            incidentInfo.bPersonalResponsibilityProgram = true;
                //            bSilver = true;
                //            break;
                //        }
                //    }

                //    foreach (IncidentProgramInfo incidentInfo in lstIncidentProgramInfo)
                //    {
                //        if ((incidentInfo.IncidentProgramId == 1) &&
                //            (bBronze == false) &&
                //            (bSilver == false) &&
                //            (incidentInfo.bIsDeleted == false))
                //        {
                //            incidentInfo.bPersonalResponsibilityProgram = true;
                //            break;
                //        }
                //    }

                //    foreach (IncidentProgramInfo incidentInfo in lstIncidentProgramInfo)
                //    {
                //        if ((incidentInfo.IncidentProgramId == 0) &&
                //            (bBronze == false) &&
                //            (bSilver == false) &&
                //            (bGold == false) &&
                //            (incidentInfo.bIsDeleted == false))
                //        {
                //            incidentInfo.bPersonalResponsibilityProgram = true;
                //            break;
                //        }
                //    }

                //    foreach (IncidentProgramInfo incidentInfo in lstIncidentProgramInfo)
                //    {
                //        if ((incidentInfo.IncidentProgramId == 4) &&
                //            (bBronze == false) &&
                //            (bSilver == false) &&
                //            (bGold == false) &&
                //            (bGoldPlus == false) &&
                //            (incidentInfo.bIsDeleted == false))
                //        {
                //            incidentInfo.bPersonalResponsibilityProgram = true;
                //            break;
                //        }
                //    }

                //    foreach (IncidentProgramInfo incidentInfo in lstIncidentProgramInfo)
                //    {
                //        if ((incidentInfo.IncidentProgramId == 5) &&
                //            (bBronze == false) &&
                //            (bSilver == false) &&
                //            (bGold == false) &&
                //            (bGoldPlus == false) &&
                //            (bGoldMed1 == false) &&
                //            (incidentInfo.bIsDeleted == false))
                //        {
                //            incidentInfo.bPersonalResponsibilityProgram = true;
                //            break;
                //        }
                //    }
                //}


                //foreach (IncidentProgramInfo incidentInfo in lstIncidentProgramInfo)
                //{
                //    if (incidentInfo.bPersonalResponsibilityProgram == true)
                //        PersonalResponsibilityAmountInMedBill = incidentInfo.PersonalResponsibilityAmount;
                //}
                ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

                // PR calculation


                //String strSqlQueryForIncidentProgram = "select [dbo].[tbl_incident].[Program_id] from [dbo].[tbl_incident] " +
                //                                       "where [dbo].[tbl_incident].[Individual_id] = @IndividualId and" +
                //                                       "[dbo].[tbl_incidend].[Case_id] = @CaseId and " +
                //                                       "[dbo].[tbl_incident].[Illness_id] = @IllnessId and " +
                //                                       "[dbo].[tbl_incident].[IncidentNo] = @IncidentNo";


                //String strSqlQueryForIncidentChange = "select [dbo].[tbl_incident_history].[Program_id], [dbo].[tbl_program].[ProgramName], [dbo].[tbl_incident_history].[IsDeleted] " +
                //                                        "from [dbo].[tbl_incident_history] " +
                //                                        "inner join [dbo].[tbl_program] on [dbo].[tbl_incident_history].[Program_id] = [dbo].[tbl_program].[Program_Id] " +
                //                                        "where ([dbo].[tbl_incident_history].[Operation] = 2 or " +
                //                                        "[dbo].[tbl_incident_history].[Operation] = 3 or " +
                //                                        "[dbo].[tbl_incident_history].[Operation] = 4) and " +
                //                                        "[dbo].[tbl_incident_history].[Individual_id] = @IndividualId and" +
                //                                        "[dbo].[tbl_incident_history].[IncidentNo] = @IncidentNo " +
                //                                        "order by [dbo].[tbl_incident_history].[Program_id]";

                //SqlCommand cmdQueryForIncidentChange = new SqlCommand(strSqlQueryForIncidentChange, connRN4);
                //cmdQueryForIncidentChange.CommandType = CommandType.Text;

                //cmdQueryForIncidentChange.Parameters.AddWithValue("@IndividualId", IndividualIdMedBill);
                //cmdQueryForIncidentChange.Parameters.AddWithValue("@IncidentNo", IncidentNo);

                //if (connRN4.State != ConnectionState.Closed)
                //{
                //    connRN4.Close();
                //    connRN4.Open();
                //}
                //else if (connRN4.State == ConnectionState.Closed) connRN4.Open();
                //SqlDataReader rdrIncidentChange = cmdQueryForIncidentChange.ExecuteReader();
                ////lstIncidentProgramInfo.Clear();
                //if (rdrIncidentChange.HasRows)
                //{
                //    while (rdrIncidentChange.Read())
                //    {
                //        if (!rdrIncidentChange.IsDBNull(0) && !rdrIncidentChange.IsDBNull(1))
                //        {
                //            IncidentProgramInfo incidentProgram = new IncidentProgramInfo(rdrIncidentChange.GetBoolean(2), rdrIncidentChange.GetInt16(0), rdrIncidentChange.GetString(1).Trim());
                //            lstIncidentProgramInfo.Add(incidentProgram);
                //        }
                //    }
                //}
                //rdrIncidentChange.Close();
                //if (connRN4.State == ConnectionState.Open) connRN4.Close();

                /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

                // Get disease name

                if (ICD10Code != String.Empty)
                {
                    String strSqlQueryForDiseaseName = "select [dbo].[ICD10 Code].[Name] from [dbo].[ICD10 Code] where [dbo].[ICD10 Code].[ICD10_CODE__C] = @ICD10Code";

                    SqlCommand cmdQueryForDiseaseName = new SqlCommand(strSqlQueryForDiseaseName, connSalesforce4);
                    cmdQueryForDiseaseName.CommandType = CommandType.Text;

                    cmdQueryForDiseaseName.Parameters.AddWithValue("@ICD10Code", ICD10Code);

                    if (connSalesforce4.State == ConnectionState.Open)
                    {
                        connSalesforce4.Close();
                        connSalesforce4.Open();
                    }
                    else if (connSalesforce4.State == ConnectionState.Closed) connSalesforce4.Open();
                    String DiseaseName = String.Empty;
                    Object objDiseaseName = cmdQueryForDiseaseName.ExecuteScalar();

                    if (objDiseaseName != null) DiseaseName = objDiseaseName.ToString();
                    else
                    {
                        MessageBox.Show("No Disease Name for ICD 10 Code: " + ICD10Code, "Error", MessageBoxButtons.OK);
                        return;
                    }

                    if (connSalesforce4.State != ConnectionState.Closed) connSalesforce4.Close();

                    txtMedBill_ICD10Code.Text = ICD10Code;
                    txtMedBillDiseaseName.Text = DiseaseName;
                }
                else
                {
                    txtMedBill_ICD10Code.Text = String.Empty;
                    txtMedBillDiseaseName.Text = String.Empty;
                }
                // Get documents info
                String strSqlQueryForDocumentsInfo = "select [dbo].[tbl_case].[NPF_Form], [dbo].[tbl_case].[NPF_Receiv_Date], " +
                                                        "[dbo].[tbl_case].[IB_Form], [dbo].[tbl_case].[IB_Receiv_Date], " +
                                                        "[dbo].[tbl_case].[POP_Form], [dbo].[tbl_case].[POP_Receiv_Date], " +
                                                        "[dbo].[tbl_case].[MedRec_Form], [dbo].[tbl_case].[MedRec_Receiv_Date], " +
                                                        "[dbo].[tbl_case].[Unknown_Form], [dbo].[tbl_case].[Unknown_Receiv_Date] " +
                                                        "from [dbo].[tbl_case] where [dbo].[tbl_case].[Case_Name] = @CaseId and " +
                                                        "[dbo].[tbl_case].[Contact_ID] = @IndividualId and " +
                                                        "[dbo].[tbl_case].[IsDeleted] = 0";

                SqlCommand cmdQueryForDocInfo = new SqlCommand(strSqlQueryForDocumentsInfo, connRN4);
                cmdQueryForDocInfo.CommandType = CommandType.Text;

                cmdQueryForDocInfo.Parameters.AddWithValue("@CaseId", CaseNameInMedBill);
                cmdQueryForDocInfo.Parameters.AddWithValue("@IndividualId", IndividualIdInMedBill);

                //if (connRN.State == ConnectionState.Closed) connRN.Open();
                if (connRN4.State != ConnectionState.Closed)
                {
                    connRN4.Close();
                    connRN4.Open();
                }
                else if (connRN4.State == ConnectionState.Closed) connRN4.Open();
                SqlDataReader rdrDocInfo = cmdQueryForDocInfo.ExecuteReader();
                if (rdrDocInfo.HasRows)
                {
                    rdrDocInfo.Read();

                    if (!rdrDocInfo.IsDBNull(0))
                    {
                        if (rdrDocInfo.GetBoolean(0))
                        {
                            chkMedBillNPFReceived.Checked = true;
                            chkMedBillNPFReceived.Enabled = false;
                            dtpMedBillNPF.Checked = true;
                            dtpMedBillNPF.Text = rdrDocInfo.GetDateTime(1).ToString("MM/dd/yyyy");
                            dtpMedBillNPF.Enabled = false;
                            btnViewNPF.Enabled = true;
                        }
                        else
                        {
                            chkMedBillNPFReceived.Checked = false;
                            chkMedBillNPFReceived.Enabled = false;
                            dtpMedBillNPF.Format = DateTimePickerFormat.Custom;
                            dtpMedBillNPF.CustomFormat = " ";
                            dtpMedBillNPF.Enabled = false;
                            btnViewNPF.Enabled = false;
                        }
                    }
                    if (!rdrDocInfo.IsDBNull(2))
                    {
                        if (rdrDocInfo.GetBoolean(2))
                        {
                            chkMedBill_IBReceived.Checked = true;
                            chkMedBill_IBReceived.Enabled = false;
                            dtpMedBill_IB.Checked = true;
                            dtpMedBill_IB.Text = rdrDocInfo.GetDateTime(3).ToString("MM/dd/yyyy");
                            dtpMedBill_IB.Enabled = false;
                            btnViewIB.Enabled = true;
                        }
                        else
                        {
                            chkMedBill_IBReceived.Checked = false;
                            chkMedBill_IBReceived.Enabled = false;
                            dtpMedBill_IB.Format = DateTimePickerFormat.Custom;
                            dtpMedBill_IB.CustomFormat = " ";
                            dtpMedBill_IB.Enabled = false;
                            btnViewIB.Enabled = false;
                        }
                    }
                    if (!rdrDocInfo.IsDBNull(4))
                    {
                        if (rdrDocInfo.GetBoolean(4))
                        {
                            chkMedBillPOPReceived.Checked = true;
                            chkMedBillPOPReceived.Enabled = false;
                            dtpMedBillPOP.Checked = true;
                            dtpMedBillPOP.Text = rdrDocInfo.GetDateTime(5).ToString("MM/dd/yyyy");
                            dtpMedBillPOP.Enabled = false;
                            btnViewPoP.Enabled = true;
                        }
                        else
                        {
                            chkMedBillPOPReceived.Checked = false;
                            chkMedBillPOPReceived.Enabled = false;
                            dtpMedBillPOP.Format = DateTimePickerFormat.Custom;
                            dtpMedBillPOP.CustomFormat = " ";
                            dtpMedBillPOP.Enabled = false;
                            btnViewPoP.Enabled = false;
                        }
                    }
                    if (!rdrDocInfo.IsDBNull(6))
                    {
                        if (rdrDocInfo.GetBoolean(6))
                        {
                            chkMedRecordReceived.Checked = true;
                            chkMedRecordReceived.Enabled = false;
                            dtpMedBillMedRecord.Checked = true;
                            dtpMedBillMedRecord.Text = rdrDocInfo.GetDateTime(7).ToString("MM/dd/yyyy");
                            dtpMedBillMedRecord.Enabled = false;
                            btnViewMedRecord.Enabled = true;
                        }
                        else
                        {
                            chkMedRecordReceived.Checked = false;
                            chkMedRecordReceived.Enabled = false;
                            dtpMedBillMedRecord.Format = DateTimePickerFormat.Custom;
                            dtpMedBillMedRecord.CustomFormat = " ";
                            dtpMedBillMedRecord.Enabled = false;
                            btnViewMedRecord.Enabled = false;
                        }
                    }

                    if (!rdrDocInfo.IsDBNull(8))
                    {
                        if (rdrDocInfo.GetBoolean(8))
                        {
                            chkOtherDocReceived.Checked = true;
                            chkOtherDocReceived.Enabled = false;
                            dtpMedBillOtherDoc.Checked = true;
                            dtpMedBillOtherDoc.Text = rdrDocInfo.GetDateTime(9).ToString("MM/dd/yyyy");
                            dtpMedBillOtherDoc.Enabled = false;
                            btnViewOtherDoc.Enabled = true;
                        }
                        else
                        {
                            chkOtherDocReceived.Checked = false;
                            chkOtherDocReceived.Enabled = false;
                            dtpMedBillOtherDoc.Format = DateTimePickerFormat.Custom;
                            dtpMedBillOtherDoc.CustomFormat = " ";
                            dtpMedBillOtherDoc.Enabled = false;
                            btnViewOtherDoc.Enabled = false;
                        }
                    }

                    strCaseIdSelected = CaseNameInMedBill;
                    strContactIdSelected = IndividualIdInMedBill;
                }
                rdrDocInfo.Close();
                if (connRN4.State != ConnectionState.Closed) connRN4.Close();

                String strSqlQueryForIncidentProgram = "select [dbo].[tbl_program].[ProgramName] from [dbo].[tbl_program] " +
                                                        "inner join [dbo].[tbl_incident] on [dbo].[tbl_program].[Program_id] = [dbo].[tbl_incident].[Program_id] " +
                                                        "where [dbo].[tbl_incident].[Individual_id] = @IndividualId and [dbo].[tbl_incident].[IncidentNo] = @IncidentNo";

                SqlCommand cmdQueryForIncidentProgram = new SqlCommand(strSqlQueryForIncidentProgram, connRN4);
                cmdQueryForIncidentProgram.CommandType = CommandType.Text;

                cmdQueryForIncidentProgram.Parameters.AddWithValue("@IndividualId", IndividualIdInMedBill);
                cmdQueryForIncidentProgram.Parameters.AddWithValue("@IncidentNo", txtMedBill_Incident.Text.Trim());

                if (connRN4.State != ConnectionState.Closed)
                {
                    connRN4.Close();
                    connRN4.Open();
                }
                else if (connRN4.State == ConnectionState.Closed) connRN4.Open();
                Object objIncidentProgramName = cmdQueryForIncidentProgram.ExecuteScalar();
                if (connRN4.State != ConnectionState.Closed) connRN4.Close();

                String IncidentProgramName = String.Empty;
                if (objIncidentProgramName != null) IncidentProgramName = objIncidentProgramName.ToString();
                else
                {
                    MessageBox.Show("No Program Name for Incident No: " + txtMedBill_Incident.Text.Trim(), "Error", MessageBoxButtons.OK);
                    return;
                }

                if (IncidentProgramName != String.Empty) txtIncdProgram.Text = IncidentProgramName;

                if (txtIncdProgram.Text.Trim() != txtMemberProgram.Text.Trim())
                {
                    txtIncdProgram.BackColor = Color.Red;
                    txtMemberProgram.BackColor = Color.Red;
                }
                else if (txtIncdProgram.Text.Trim() == txtMemberProgram.Text.Trim())
                {
                    txtIncdProgram.BackColor = Color.White;
                    txtMemberProgram.BackColor = Color.FromKnownColor(KnownColor.Control);
                }

                ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                //String strSqlQueryForMedicalProvider = "select dbo.tbl_MedicalProvider.ID, dbo.tbl_MedicalProvider.Name, dbo.tbl_MedicalProvider.Type from dbo.tbl_MedicalProvider";

                //SqlCommand cmdQueryForMedicalProvider = new SqlCommand(strSqlQueryForMedicalProvider, connRN4);
                //cmdQueryForMedicalProvider.CommandType = CommandType.Text;

                ////if (connRN.State == ConnectionState.Closed) connRN.Open();

                //if (connRN4.State != ConnectionState.Closed)
                //{
                //    connRN4.Close();
                //    connRN4.Open();
                //}
                //else if (connRN4.State == ConnectionState.Closed) connRN4.Open();

                //SqlDataReader rdrMedicalProvider = cmdQueryForMedicalProvider.ExecuteReader();

                //lstMedicalProvider.Clear();
                //if (rdrMedicalProvider.HasRows)
                //{
                //    while (rdrMedicalProvider.Read())
                //    {
                //        MedicalProviderInfo info = new MedicalProviderInfo();

                //        if (!rdrMedicalProvider.IsDBNull(0)) info.ID = rdrMedicalProvider.GetString(0);
                //        if (!rdrMedicalProvider.IsDBNull(1)) info.Name = rdrMedicalProvider.GetString(1);
                //        if (!rdrMedicalProvider.IsDBNull(2)) info.Type = rdrMedicalProvider.GetString(2);

                //        lstMedicalProvider.Add(info);
                //    }
                //}

                //if (connRN4.State != ConnectionState.Closed) connRN4.Close();

                var srcMedicalProvider = new AutoCompleteStringCollection();

                for (int i = 0; i < lstMedicalProvider.Count; i++)
                {
                    srcMedicalProvider.Add(lstMedicalProvider[i].Name);
                }

                txtMedicalProvider.AutoCompleteMode = AutoCompleteMode.SuggestAppend;
                txtMedicalProvider.AutoCompleteSource = AutoCompleteSource.CustomSource;
                txtMedicalProvider.AutoCompleteCustomSource = srcMedicalProvider;

                //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                int nRowSelected = gvMedBill.CurrentCell.RowIndex;

                IndividualId = txtCaseIndividualID.Text.Trim();
                CaseNo = txtCaseName.Text.Trim();
                MedicalBillNo = gvMedBill[1, nRowSelected].Value.ToString();


                lstPaymentMethod.Clear();
                String strSqlQueryForPaymentMethod = "select [dbo].[tbl_payment_method].[PaymentMethod_Id], [dbo].[tbl_payment_method].[PaymentMethod_Value] from [dbo].[tbl_payment_method] " +
                                                        "order by [dbo].[tbl_payment_method].[PaymentMethod_Value]";

                SqlCommand cmdQueryForPaymentMethod = new SqlCommand(strSqlQueryForPaymentMethod, connRN4);
                cmdQueryForPaymentMethod.CommandType = CommandType.Text;

                //if (connRN.State == ConnectionState.Closed) connRN.Open();
                if (connRN4.State != ConnectionState.Closed)
                {
                    connRN4.Close();
                    connRN4.Open();
                }
                else if (connRN4.State == ConnectionState.Closed) connRN4.Open();
                SqlDataReader rdrPaymentMethod = cmdQueryForPaymentMethod.ExecuteReader();
                if (rdrPaymentMethod.HasRows)
                {
                    while (rdrPaymentMethod.Read())
                    {
                        if (!rdrPaymentMethod.IsDBNull(1)) lstPaymentMethod.Add(new PaymentMethod { PaymentMethodId = rdrPaymentMethod.GetInt16(0), PaymentMethodValue = rdrPaymentMethod.GetString(1) });
                        else lstPaymentMethod.Add(new PaymentMethod { PaymentMethodId = rdrPaymentMethod.GetInt16(0), PaymentMethodValue = null });
                    }
                }
                rdrPaymentMethod.Close();
                if (connRN4.State != ConnectionState.Closed) connRN4.Close();

                // Retrieve credit card info
                lstCreditCardInfo.Clear();
                String strSqlQueryForCreditCardInfo = "select [dbo].[tbl_Credit_Card__c].[CreditCard_Id], [dbo].[tbl_Credit_Card__c].[Name] from [dbo].[tbl_Credit_Card__c]";

                SqlCommand cmdQueryForCreditCardInfo = new SqlCommand(strSqlQueryForCreditCardInfo, connRN4);
                cmdQueryForCreditCardInfo.CommandType = CommandType.Text;

                if (connRN4.State != ConnectionState.Closed)
                {
                    connRN4.Close();
                    connRN4.Open();
                }
                else if (connRN4.State == ConnectionState.Closed) connRN4.Open();

                SqlDataReader rdrCreditCardInfo = cmdQueryForCreditCardInfo.ExecuteReader();
                if (rdrCreditCardInfo.HasRows)
                {
                    while (rdrCreditCardInfo.Read())
                    {
                        if (!rdrCreditCardInfo.IsDBNull(1))
                            lstCreditCardInfo.Add(new CreditCardInfo { CreditCardId = rdrCreditCardInfo.GetInt16(0), CreditCardNo = rdrCreditCardInfo.GetString(1) });
                        else
                            lstCreditCardInfo.Add(new CreditCardInfo { CreditCardId = rdrCreditCardInfo.GetInt16(0), CreditCardNo = null });
                    }
                }
                rdrCreditCardInfo.Close();
                if (connRN4.State != ConnectionState.Closed) connRN4.Close();

                String strSqlQueryForSettlement = "select [dbo].[tbl_settlement].[Name], [dbo].[tbl_settlement_type_code].[SettlementTypeValue], [dbo].[tbl_settlement].[Amount], " +
                                                    "[dbo].[tbl_settlement].[PersonalResponsibilityCredit], [dbo].[tbl_payment_method].[PaymentMethod_Value], " +
                                                    "[dbo].[tbl_settlement].[Approved], [dbo].[tbl_settlement].[ApprovedDate], " +
                                                    "[dbo].[tbl_settlement].[CheckNo], [dbo].[tbl_settlement].[CheckDate], [dbo].[tbl_settlement].[CheckReconciled], " +
                                                    "[dbo].[tbl_settlement].[ACH_Number], [dbo].[tbl_settlement].[ACH_Date], [dbo].[tbl_settlement].[ACH_Reconciled], " +
                                                    "[dbo].[tbl_Credit_Card__c].[Name], [dbo].[tbl_settlement].[CMMCreditCardPaidDate], [dbo].[tbl_settlement].[CC_Reconciled], " +
                                                    "[dbo].[tbl_settlement].[AllowedAmount], [dbo].[tbl_settlement].[IneligibleReason], " +
                                                    "[dbo].[tbl_settlement].[Notes] " +
                                                    "from [dbo].[tbl_settlement] inner join [dbo].[tbl_settlement_type_code] " +
                                                    "on [dbo].[tbl_settlement].[SettlementType] = [dbo].[tbl_settlement_type_code].[SettlementTypeCode] " +
                                                    "inner join [dbo].[tbl_payment_method] on [dbo].[tbl_settlement].[CMMPaymentMethod] = [dbo].[tbl_payment_method].[PaymentMethod_Id] " +
                                                    "inner join [dbo].[tbl_Credit_Card__c] on [dbo].[tbl_settlement].[CMMCreditCard] = [dbo].[tbl_Credit_Card__c].[CreditCard_Id]" +
                                                    "where [dbo].[tbl_settlement].[MedicalBillID] = @MedBillNo and " +
                                                    "[dbo].[tbl_settlement].[IsDeleted] = 0 " +
                                                    "order by [dbo].[tbl_settlement].[Name]";

                SqlCommand cmdQueryForSettlement = new SqlCommand(strSqlQueryForSettlement, connRN4);
                cmdQueryForSettlement.CommandType = CommandType.Text;

                cmdQueryForSettlement.Parameters.AddWithValue("@MedBillNo", MedBillNoForCase);

                SqlDependency dependencySettlementInMedBill = new SqlDependency(cmdQueryForSettlement);
                dependencySettlementInMedBill.OnChange += new OnChangeEventHandler(OnSettlementsInMedBillEditChange);

                //if (connRN.State == ConnectionState.Closed) connRN.Open();
                if (connRN4.State != ConnectionState.Closed)
                {
                    connRN4.Close();
                    connRN4.Open();
                }
                else if (connRN4.State == ConnectionState.Closed) connRN4.Open();
                SqlDataReader rdrSettlement = cmdQueryForSettlement.ExecuteReader();
                gvSettlementsInMedBill.Rows.Clear();
                if (rdrSettlement.HasRows)
                {
                    while (rdrSettlement.Read())
                    {
                        DataGridViewRow row = new DataGridViewRow();
                        row.Cells.Add(new DataGridViewCheckBoxCell { Value = false });
                        if (!rdrSettlement.IsDBNull(0)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlement.GetString(0) });
                        if (!rdrSettlement.IsDBNull(1))
                        {
                            DataGridViewComboBoxCell comboCellSettlementType = new DataGridViewComboBoxCell();

                            for (int i = 0; i < lstSettlementType.Count; i++)
                            {
                                comboCellSettlementType.Items.Add(lstSettlementType[i].SettlementTypeValue);
                            }
                            for (int i = 0; i < comboCellSettlementType.Items.Count; i++)
                            {
                                if (rdrSettlement.GetString(1) == comboCellSettlementType.Items[i].ToString())
                                    comboCellSettlementType.Value = comboCellSettlementType.Items[i];
                            }

                            row.Cells.Add(comboCellSettlementType);
                        }
                        else
                        {
                            DataGridViewComboBoxCell comboCellSettlementType = new DataGridViewComboBoxCell();
                            for (int i = 0; i < lstSettlementType.Count; i++)
                            {
                                comboCellSettlementType.Items.Add(lstSettlementType[i].SettlementTypeValue);
                            }

                            for (int i = 0; i < comboCellSettlementType.Items.Count; i++)
                            {
                                if (rdrSettlement.GetString(1) == comboCellSettlementType.Items[i].ToString())
                                    comboCellSettlementType.Value = comboCellSettlementType.Items[i];
                            }

                            row.Cells.Add(comboCellSettlementType);
                        }

                        if (!rdrSettlement.IsDBNull(2)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlement.GetDecimal(2).ToString("C") });
                        else
                        {
                            Decimal Zero = 0;
                            row.Cells.Add(new DataGridViewTextBoxCell { Value = Zero.ToString("C") });
                        }


                        if (!rdrSettlement.IsDBNull(3)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlement.GetDecimal(3).ToString("C") });
                        else
                        {
                            Decimal Zero = 0;
                            row.Cells.Add(new DataGridViewTextBoxCell { Value = Zero.ToString("C") });
                        }

                        /////////////////////////////////////////////////////////////////////
                        if (!rdrSettlement.IsDBNull(4))
                        {
                            DataGridViewComboBoxCell comboCellPaymentMethod = new DataGridViewComboBoxCell();

                            for (int i = 0; i < lstPaymentMethod.Count; i++)
                            {
                                if (lstPaymentMethod[i].PaymentMethodValue != null) comboCellPaymentMethod.Items.Add(lstPaymentMethod[i].PaymentMethodValue);
                                else comboCellPaymentMethod.Items.Add(String.Empty);
                            }

                            for (int i = 0; i < comboCellPaymentMethod.Items.Count; i++)
                            {
                                if (rdrSettlement.GetString(4) == comboCellPaymentMethod.Items[i].ToString())
                                    comboCellPaymentMethod.Value = comboCellPaymentMethod.Items[i];
                            }

                            row.Cells.Add(comboCellPaymentMethod);
                        }
                        else
                        {
                            DataGridViewComboBoxCell comboCellPaymentMethod = new DataGridViewComboBoxCell();

                            for (int i = 0; i < lstPaymentMethod.Count; i++)
                            {
                                if (lstPaymentMethod[i].PaymentMethodValue != null) comboCellPaymentMethod.Items.Add(lstPaymentMethod[i].PaymentMethodValue);
                                else comboCellPaymentMethod.Items.Add(String.Empty);
                                //comboCellPaymentMethod.Items.Add(lstPaymentMethod[i].PaymentMethodValue);
                            }

                            for (int i = 0; i < comboCellPaymentMethod.Items.Count; i++)
                            {
                                if ((!rdrSettlement.IsDBNull(4)) && comboCellPaymentMethod.Items[i] != null)
                                {
                                    if (rdrSettlement.GetString(4) == comboCellPaymentMethod.Items[i].ToString())
                                        comboCellPaymentMethod.Value = comboCellPaymentMethod.Items[i];
                                }
                                else comboCellPaymentMethod.Value = null;
                            }

                            row.Cells.Add(comboCellPaymentMethod);

                        }

                        /////////////////////////////////////////////////////////////////////
                        if (!rdrSettlement.IsDBNull(5))
                        {

                            DataGridViewCheckBoxCell approvedCell = new DataGridViewCheckBoxCell();
                            approvedCell.Value = rdrSettlement.GetBoolean(5);
                            approvedCell.Style.Alignment = DataGridViewContentAlignment.MiddleCenter;
                            row.Cells.Add(approvedCell);
                            if (LoggedInUserRole == UserRole.SuperAdmin || LoggedInUserRole == UserRole.RNManager) row.Cells[6].ReadOnly = false;
                            else row.Cells[6].ReadOnly = true;

                            //if (LoggedInUserRole == UserRole.RNStaff ||
                            //    LoggedInUserRole == UserRole.NPStaff ||
                            //    LoggedInUserRole == UserRole.FDStaff ||
                            //    LoggedInUserRole == UserRole.MSStaff)
                            //    row.Cells[6].ReadOnly = true;
                            //else if (LoggedInUserRole == UserRole.RNManager ||
                            //         LoggedInUserRole == UserRole.NPManager ||
                            //         LoggedInUserRole == UserRole.FDManager ||
                            //         LoggedInUserRole == UserRole.MSManager ||
                            //         LoggedInUserRole == UserRole.Administrator ||
                            //         LoggedInUserRole == UserRole.SuperAdmin ||
                            //         LoggedInUserRole == UserRole.Executive)
                                     
                            //    row.Cells[6].ReadOnly = false;
                        }
                        else
                        {
                            DataGridViewCheckBoxCell approvedCell = new DataGridViewCheckBoxCell();
                            approvedCell.Value = false;
                            approvedCell.Style.Alignment = DataGridViewContentAlignment.MiddleCenter;
                            row.Cells.Add(approvedCell);
                            if (LoggedInUserRole == UserRole.SuperAdmin || LoggedInUserRole == UserRole.RNManager) row.Cells[6].ReadOnly = false;
                            else row.Cells[6].ReadOnly = true;

                            //if (LoggedInUserRole == UserRole.RNStaff ||
                            //    LoggedInUserRole == UserRole.NPStaff ||
                            //    LoggedInUserRole == UserRole.FDStaff ||
                            //    LoggedInUserRole == UserRole.MSStaff)
                            //    row.Cells[6].ReadOnly = true;
                            //else if (LoggedInUserRole == UserRole.RNManager ||
                            //         LoggedInUserRole == UserRole.NPManager ||
                            //         LoggedInUserRole == UserRole.FDManager ||
                            //         LoggedInUserRole == UserRole.MSManager ||
                            //         LoggedInUserRole == UserRole.Administrator ||
                            //         LoggedInUserRole == UserRole.SuperAdmin ||
                            //         LoggedInUserRole == UserRole.Executive)
                            //    row.Cells[6].ReadOnly = false;
                        }

                        if (!rdrSettlement.IsDBNull(6))
                        {
                            row.Cells.Add(new CalendarCell { Value = DateTime.Parse(rdrSettlement.GetDateTime(6).ToString("MM/dd/yyyy")) });
                            row.Cells[7].ReadOnly = true;
                        }
                        else
                        {
                            row.Cells.Add(new CalendarCell { Value = null });
                            row.Cells[7].ReadOnly = true;
                        }

                        // Payment information
                        if (!rdrSettlement.IsDBNull(4))
                        {
                            String strPaymentMethod = rdrSettlement.GetString(4);

                            switch (strPaymentMethod)
                            {
                                case "Check":
                                    if (!rdrSettlement.IsDBNull(7)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlement.GetString(7) });
                                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = null });
                                    row.Cells.Add(new DataGridViewTextBoxCell { Value = null });
                                    DataGridViewComboBoxCell comboCellCreditCardNoneForCheck = new DataGridViewComboBoxCell();
                                    for (int i = 0; i < lstCreditCardInfo.Count; i++)
                                    {
                                        if (lstCreditCardInfo[i].CreditCardNo != null) comboCellCreditCardNoneForCheck.Items.Add(lstCreditCardInfo[i].CreditCardNo);
                                        else comboCellCreditCardNoneForCheck.Items.Add(String.Empty);
                                    }
                                    row.Cells.Add(comboCellCreditCardNoneForCheck);
                                    if (!rdrSettlement.IsDBNull(8))
                                    {
                                        row.Cells.Add(new CalendarCell { Value = DateTime.Parse(rdrSettlement.GetDateTime(8).ToString("MM/dd/yyyy")) });
                                    }
                                    else
                                    {
                                        row.Cells.Add(new CalendarCell { Value = String.Empty });
                                    }
                                    if (!rdrSettlement.IsDBNull(9))
                                    {
                                        row.Cells.Add(new DataGridViewCheckBoxCell { Value = rdrSettlement.GetBoolean(9) });
                                    }
                                    else
                                    {
                                        row.Cells.Add(new DataGridViewCheckBoxCell { Value = null });
                                    }
                                    break;
                                case "ACH/Banking":
                                    row.Cells.Add(new DataGridViewTextBoxCell { Value = null });
                                    if (!rdrSettlement.IsDBNull(10)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlement.GetString(10) });
                                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = null });
                                    DataGridViewComboBoxCell comboCellCreditCardNoneForACH = new DataGridViewComboBoxCell();
                                    for (int i = 0; i < lstCreditCardInfo.Count; i++)
                                    {
                                        if (lstCreditCardInfo[i].CreditCardNo != null)
                                            comboCellCreditCardNoneForACH.Items.Add(lstCreditCardInfo[i].CreditCardNo);
                                        else comboCellCreditCardNoneForACH.Items.Add(String.Empty);
                                    }
                                    row.Cells.Add(comboCellCreditCardNoneForACH);
                                    if (!rdrSettlement.IsDBNull(11))
                                    {
                                        row.Cells.Add(new CalendarCell { Value = DateTime.Parse(rdrSettlement.GetDateTime(11).ToString("MM/dd/yyyy")) });
                                    }
                                    else
                                    {
                                        row.Cells.Add(new CalendarCell { Value = String.Empty });
                                    }
                                    if (!rdrSettlement.IsDBNull(12))
                                    {
                                        row.Cells.Add(new DataGridViewCheckBoxCell { Value = rdrSettlement.GetBoolean(12) });
                                    }
                                    else
                                    {
                                        row.Cells.Add(new DataGridViewCheckBoxCell { Value = null });
                                    }
                                    break;
                                case "Credit Card":
                                    row.Cells.Add(new DataGridViewTextBoxCell { Value = null });
                                    row.Cells.Add(new DataGridViewTextBoxCell { Value = null });
                                    DataGridViewComboBoxCell comboCellCreditCard = new DataGridViewComboBoxCell();
                                    if (!rdrSettlement.IsDBNull(13))
                                    {
                                        for (int i = 0; i < lstCreditCardInfo.Count; i++)
                                        {
                                            if (lstCreditCardInfo[i].CreditCardNo != null) comboCellCreditCard.Items.Add(lstCreditCardInfo[i].CreditCardNo);
                                            else comboCellCreditCard.Items.Add(String.Empty);
                                        }
                                        for (int i = 0; i < comboCellCreditCard.Items.Count; i++)
                                        {
                                            if (rdrSettlement.GetString(13) == comboCellCreditCard.Items[i].ToString())
                                                comboCellCreditCard.Value = comboCellCreditCard.Items[i];
                                        }
                                    }
                                    else
                                    {
                                        //DataGridViewComboBoxCell comboCellCreditCard = new DataGridViewComboBoxCell();
                                        for (int i = 0; i < lstCreditCardInfo.Count; i++)
                                        {
                                            if (lstCreditCardInfo[i].CreditCardNo != null) comboCellCreditCard.Items.Add(lstCreditCardInfo[i].CreditCardNo);
                                            else comboCellCreditCard.Items.Add(String.Empty);
                                        }
                                        comboCellCreditCard.Value = String.Empty;
                                        //row.Cells.Add(comboCellCreditCard);
                                    }
                                    row.Cells.Add(comboCellCreditCard);
                                    if (!rdrSettlement.IsDBNull(14)) row.Cells.Add(new CalendarCell { Value = DateTime.Parse(rdrSettlement.GetDateTime(14).ToString("MM/dd/yyyy")) });
                                    else row.Cells.Add(new CalendarCell { Value = String.Empty });
                                    if (!rdrSettlement.IsDBNull(15)) row.Cells.Add(new DataGridViewCheckBoxCell { Value = rdrSettlement.GetBoolean(15) });
                                    else row.Cells.Add(new DataGridViewCheckBoxCell { Value = false });
                                    break;
                                default:
                                    row.Cells.Add(new DataGridViewTextBoxCell { Value = null });
                                    row.Cells.Add(new DataGridViewTextBoxCell { Value = null });
                                    DataGridViewComboBoxCell comboCellCreditCardNone = new DataGridViewComboBoxCell();
                                    for (int i = 0; i < lstCreditCardInfo.Count; i++)
                                    {
                                        if (lstCreditCardInfo[i].CreditCardNo != null) comboCellCreditCardNone.Items.Add(lstCreditCardInfo[i].CreditCardNo);
                                        else comboCellCreditCardNone.Items.Add(String.Empty);
                                    }
                                    row.Cells.Add(comboCellCreditCardNone);
                                    row.Cells.Add(new CalendarCell { Value = null });
                                    row.Cells.Add(new DataGridViewCheckBoxCell { Value = null });
                                    break;
                            }
                        }
                        else
                        {

                            DataGridViewTextBoxCell txtCheckNoCell = new DataGridViewTextBoxCell();
                            txtCheckNoCell.Value = null;
                            row.Cells.Add(txtCheckNoCell);
                            DataGridViewTextBoxCell txtACHNoCell = new DataGridViewTextBoxCell();
                            txtACHNoCell.Value = null;
                            row.Cells.Add(txtACHNoCell);
                            DataGridViewComboBoxCell comboCreditCardCell = new DataGridViewComboBoxCell();
                            for (int i = 0; i < lstCreditCardInfo.Count; i++)
                            {
                                if (lstCreditCardInfo[i].CreditCardNo != null) comboCreditCardCell.Items.Add(lstCreditCardInfo[i].CreditCardNo);
                                else comboCreditCardCell.Items.Add(String.Empty);
                            }
                            row.Cells.Add(comboCreditCardCell);
                            comboCreditCardCell.ReadOnly = true;
                            CalendarCell calPaymentDate = new CalendarCell();
                            calPaymentDate.Value = null;
                            row.Cells.Add(calPaymentDate);
                            DataGridViewCheckBoxCell chkReconciledCell = new DataGridViewCheckBoxCell();
                            chkReconciledCell.Value = false;
                            row.Cells.Add(chkReconciledCell);

                        }


                        if (!rdrSettlement.IsDBNull(16)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlement.GetDecimal(16).ToString("C") });
                        else row.Cells.Add(new DataGridViewTextBoxCell { Value = null });

                        if (!rdrSettlement.IsDBNull(17))
                        {
                            if (dicIneligibleReason.Count > 0)
                            {
                                DataGridViewComboBoxCell comboCellIneligibleReason = new DataGridViewComboBoxCell();
                                for (int i = 0; i < dicIneligibleReason.Count; i++)
                                {
                                    comboCellIneligibleReason.Items.Add(dicIneligibleReason[i]);
                                }
                                comboCellIneligibleReason.Value = comboCellIneligibleReason.Items[rdrSettlement.GetInt32(17)];
                                //comboIneligibleReason.Sorted = true;
                                row.Cells.Add(comboCellIneligibleReason);
                            }
                        }
                        else
                        {
                            if (dicIneligibleReason.Count > 0)
                            {
                                DataGridViewComboBoxCell comboCellIneligibleReason = new DataGridViewComboBoxCell();
                                for (int i = 0; i < dicIneligibleReason.Count; i++)
                                {
                                    comboCellIneligibleReason.Items.Add(dicIneligibleReason[i]);
                                }
                                comboCellIneligibleReason.Value = comboCellIneligibleReason.Items[0];
                                //comboIneligibleReason.Sorted = true;
                                row.Cells.Add(comboCellIneligibleReason);
                            }
                        }

                        if (!rdrSettlement.IsDBNull(18)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlement.GetString(18) });
                        else row.Cells.Add(new DataGridViewTextBoxCell { Value = null });

                        gvSettlementsInMedBill.Rows.Add(row);
                        //AddNewRowToGVSettlementSafely(row);
                    }
                }
                rdrSettlement.Close();
                if (connRN4.State != ConnectionState.Closed) connRN4.Close();

                for (int i = 0; i < gvSettlementsInMedBill.Rows.Count; i++)
                {
                    if (gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "3rd Party Discount" ||
                        gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "Member Payment" ||
                        gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "CMM Discount" ||
                        gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "Ineligible" ||
                        gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "Medical Provider Refund" ||
                        gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "Member Discount")
                    {
                        gvSettlementsInMedBill["Approved", i].Value = false;
                        gvSettlementsInMedBill["Approved", i].ReadOnly = true;
                    }

                    gvSettlementsInMedBill["ApprovedDate", i].ReadOnly = true;
                }

                gvSettlementsInMedBill.Enabled = true;
                gvSettlementsInMedBill.Controls[0].Enabled = true;
                gvSettlementsInMedBill.Controls[1].Enabled = true;

                ////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                ///
                //Decimal PersonalResponsibilityAmount = 0;

                //foreach (IncidentProgramInfo incdProgram in lstIncidentProgramInfo)
                //{
                //    if (incdProgram.bPersonalResponsibilityProgram == true) PersonalResponsibilityAmount = incdProgram.PersonalResponsibilityAmount;
                //}

                //for (int i = 0; i < gvSettlementsInMedBill.Rows.Count; i++)
                //{
                //    if (gvSettlementsInMedBill["PersonalResponsibility", i]?.Value != null)
                //    {
                //        Decimal result = 0;
                //        if (Decimal.TryParse(gvSettlementsInMedBill["PersonalResponsibility", i]?.Value?.ToString(), NumberStyles.Currency, new CultureInfo("en-US"), out result))
                //        {
                //            PersonalResponsibilityAmount -= result;
                //        }
                //    }
                //}

                //txtPersonalResponsibility.Text = PersonalResponsibilityAmount.ToString("C");

                //if (PersonalResponsibilityAmount < 0) txtPersonalResponsibility.BackColor = Color.Yellow;

                ////////////////////////////////////////////////////////////////////////////////////////////////////////////////

                for (int i = 0; i < gvSettlementsInMedBill.Rows.Count; i++)
                {
                    if (gvSettlementsInMedBill["PaymentMethod", i]?.Value?.ToString() == "Check")
                    {
                        gvSettlementsInMedBill.Rows[i].Cells["CheckNo"].ReadOnly = false;
                        gvSettlementsInMedBill.Rows[i].Cells["PaymentDate"].ReadOnly = false;
                        gvSettlementsInMedBill.Rows[i].Cells["Reconciled"].ReadOnly = false;
                        gvSettlementsInMedBill.Rows[i].Cells["ACHNo"].ReadOnly = true;
                        gvSettlementsInMedBill.Rows[i].Cells["CreditCard"].ReadOnly = true;
                    }

                    if (gvSettlementsInMedBill["PaymentMethod", i]?.Value?.ToString() == "ACH/Banking")
                    {
                        gvSettlementsInMedBill.Rows[i].Cells["ACHNo"].ReadOnly = false;
                        gvSettlementsInMedBill.Rows[i].Cells["PaymentDate"].ReadOnly = false;
                        gvSettlementsInMedBill.Rows[i].Cells["Reconciled"].ReadOnly = false;
                        gvSettlementsInMedBill.Rows[i].Cells["CheckNo"].ReadOnly = true;
                        gvSettlementsInMedBill.Rows[i].Cells["CreditCard"].ReadOnly = true;
                    }

                    if (gvSettlementsInMedBill["PaymentMethod", i]?.Value?.ToString() == "Credit Card")
                    {
                        gvSettlementsInMedBill.Rows[i].Cells["CreditCard"].ReadOnly = false;
                        gvSettlementsInMedBill.Rows[i].Cells["PaymentDate"].ReadOnly = false;
                        gvSettlementsInMedBill.Rows[i].Cells["Reconciled"].ReadOnly = false;
                        gvSettlementsInMedBill.Rows[i].Cells["CheckNo"].ReadOnly = true;
                        gvSettlementsInMedBill.Rows[i].Cells["ACHNo"].ReadOnly = true;
                    }
                    if (gvSettlementsInMedBill["PaymentMethod", i]?.Value == null)
                    {
                        gvSettlementsInMedBill.Rows[i].Cells["CheckNo"].ReadOnly = true;
                        gvSettlementsInMedBill.Rows[i].Cells["ACHNo"].ReadOnly = true;
                        gvSettlementsInMedBill.Rows[i].Cells["CreditCard"].ReadOnly = true;
                        gvSettlementsInMedBill.Rows[i].Cells["PaymentDate"].ReadOnly = true;
                        gvSettlementsInMedBill.Rows[i].Cells["Reconciled"].ReadOnly = true;
                    }
                }

                for (int i = 0; i < gvSettlementsInMedBill.Rows.Count; i++)
                {
                    if (gvSettlementsInMedBill[2, i]?.Value?.ToString() == "Ineligible") gvSettlementsInMedBill.Rows[i].DefaultCellStyle.BackColor = Color.Salmon;
                    else
                    {
                        gvSettlementsInMedBill["IneligibleReason", i].Value = null;
                        gvSettlementsInMedBill["IneligibleReason", i].ReadOnly = true;
                    }
                }

                if (txtMedBillAmount.Text.Trim() != String.Empty)
                {
                    Decimal SettlementTotal = 0;
                    Decimal Balance = 0;
                    Decimal Result = 0;
                    Decimal BillAmount = 0;
                    if (Decimal.TryParse(txtMedBillAmount.Text.Trim(), NumberStyles.Currency, new CultureInfo("en-US"), out Result))
                    {
                        BillAmount = Result;

                        for (int i = 0; i < gvSettlementsInMedBill.Rows.Count; i++)
                        {
                            if (gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() != "PR Reimbursement" &&
                                gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() != "Medical Provider Refund")
                            {
                                Decimal Settlement = Decimal.Parse(gvSettlementsInMedBill["SettlementAmount", i]?.Value?.ToString(), NumberStyles.Currency, new CultureInfo("en-US"));
                                SettlementTotal += Settlement;
                            }
                        }
                        if (SettlementTotal > BillAmount) MessageBox.Show("Settlement Total exceeds the Medical Bill Amount.", "Alert");
                        else
                        {
                            Balance = BillAmount - SettlementTotal;
                            txtBalance.Text = Balance.ToString("C");
                        }
                    }
                }

                Decimal TotalSharedAmount = 0;
                //if (gvSettlementsInMedBill.Rows.Count == 0) txtTotalSharedAmtMedBill.Text = TotalSharedAmount.ToString("C");
                txtTotalSharedAmtMedBill.Text = TotalSharedAmount.ToString("C");

                for (int i = 0; i < gvSettlementsInMedBill.Rows.Count; i++)
                {
                    Decimal SharedAmount = 0;
                    Decimal MedicalProviderRefund = 0;
                    Decimal result = 0;

                    if (gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "CMM Provider Payment" ||
                        gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "CMM Member Reimbursement" ||
                        gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "PR Reimbursement")
                    {
                        if (Decimal.TryParse(gvSettlementsInMedBill["SettlementAmount", i]?.Value?.ToString(), NumberStyles.Currency, new CultureInfo("en-US"), out result))
                        {
                            SharedAmount = result;
                            TotalSharedAmount += SharedAmount;
                            txtTotalSharedAmtMedBill.Text = TotalSharedAmount.ToString("C");
                        }
                    }
                    else if (gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "Medical Provider Refund")
                    {
                        if (Decimal.TryParse(gvSettlementsInMedBill["SettlementAmount", i]?.Value?.ToString(), NumberStyles.Currency, new CultureInfo("en-US"), out result))
                        {
                            MedicalProviderRefund = result;
                            TotalSharedAmount -= MedicalProviderRefund;
                            txtTotalSharedAmtMedBill.Text = TotalSharedAmount.ToString("C");
                        }
                    }
                }

                //PersonalResponsibilityAmountInMedBill

                Decimal PersonResponsibilityAmt = PersonalResponsibilityAmountInMedBill;
                Decimal PersonalResponsibilityBalance = PersonalResponsibilityAmountInMedBill;
                Decimal TotalPersonalResponsibilityShared = 0;

                for (int i = 0; i < gvSettlementsInMedBill.Rows.Count; i++)
                {
                    Decimal PersonalResponsibilityShared = 0;
                    Decimal result = 0;

                    if (gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "Self Pay Discount" ||
                        gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "3rd Party Discount" ||
                        gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "Member Payment")
                    {
                        if (Decimal.TryParse(gvSettlementsInMedBill["PersonalResponsibility", i]?.Value?.ToString(), NumberStyles.Currency, new CultureInfo("en-US"), out result))
                        {
                            PersonalResponsibilityShared = result;
                            TotalPersonalResponsibilityShared += PersonalResponsibilityShared;
                            PersonalResponsibilityBalance -= TotalPersonalResponsibilityShared;
                        }
                    }
                }

                txtPersonalResponsibility.Text = PersonalResponsibilityBalance.ToString("C");

                //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                String strSqlQueryForTaskInMedBill = "select [dbo].[tbl_task].[Subject], [dbo].[tbl_task].[DueDate], [dbo].[tbl_user].[User_Name], " +
                                                     "[dbo].[tbl_task_status_code].[TaskStatusValue], [dbo].[tbl_task].[id] " +
                                                     "from [dbo].[tbl_task] " +
                                                     "inner join [dbo].[tbl_user] on [dbo].[tbl_task].[AssignedTo] = [dbo].[tbl_user].[User_Id] " +
                                                     "inner join [dbo].[tbl_task_status_code] on [dbo].[tbl_task].[Status] = [dbo].[tbl_task_status_code].[TaskStatusCode] " +
                                                     "where ([dbo].[tbl_task].[IsDeleted] IS NULL or [dbo].[tbl_task].[IsDeleted] = 0) and " +
                                                     "[dbo].[tbl_task].[whatid] = @MedBillNo " +
                                                     "order by [dbo].[tbl_task].[CreateDate] desc";

                SqlCommand cmdQueryForTask = new SqlCommand(strSqlQueryForTaskInMedBill, connRN4);
                cmdQueryForTask.CommandType = CommandType.Text;

                cmdQueryForTask.Parameters.AddWithValue("@MedBillNo", MedBillNoForTask);

                SqlDependency dependencyTask = new SqlDependency(cmdQueryForTask);
                dependencyTask.OnChange += new OnChangeEventHandler(OnTaskInMedBillChange);

                if (connRN4.State != ConnectionState.Closed)
                {
                    connRN4.Close();
                    connRN4.Open();
                }
                else if (connRN4.State == ConnectionState.Closed) connRN4.Open();

                SqlDataReader rdrTaskForMedBill = cmdQueryForTask.ExecuteReader();
                gvMostRecentTasks.Rows.Clear();
                if (rdrTaskForMedBill.HasRows)
                {
                    while (rdrTaskForMedBill.Read())
                    {
                        DataGridViewRow row = new DataGridViewRow();
                        if (!rdrTaskForMedBill.IsDBNull(0)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrTaskForMedBill.GetString(0) });
                        else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                        if (!rdrTaskForMedBill.IsDBNull(1)) row.Cells.Add(new CalendarCell { Value = rdrTaskForMedBill.GetDateTime(1).ToString("MM/dd/yyyy") });
                        else row.Cells.Add(new CalendarCell { Value = String.Empty });
                        if (!rdrTaskForMedBill.IsDBNull(2)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrTaskForMedBill.GetString(2) });
                        else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                        if (!rdrTaskForMedBill.IsDBNull(3)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrTaskForMedBill.GetString(3) });
                        else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                        if (!rdrTaskForMedBill.IsDBNull(4)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrTaskForMedBill.GetInt32(4).ToString() });
                        else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                        gvMostRecentTasks.Rows.Add(row);
                    }
                }
                rdrTaskForMedBill.Close();

                if (connRN4.State == ConnectionState.Open) connRN4.Close();
                //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                ///

                EnableMedicalBillForm();
                gvMostRecentTasks.Enabled = true;
                gvMostRecentTasks.Controls[0].Enabled = true;
                gvMostRecentTasks.Controls[1].Enabled = true;

                btnMedBillCreatePgUpperSave.Enabled = true;
                //btnMedBillCreationPgLowerSave.Enabled = true;

                if (bMedBillInUse == true)
                {
                    DisableMedicalBillForm();

                    EnableGroupDocumentProcessingForViewing();
                    EnableGroupMedBillDocumentsForViewing();
                }

                tbCMMManager.SelectedTab = tbpgMedicalBill;
            }
            //}
            //else
            //{
            //    MessageBox.Show("Medical Bill page already open");
            //}
        }

        private void EnableGroupDocumentProcessingForViewing()
        {
            grpDocumentProcessing.Enabled = true;

            chkOtherDocReceived.Enabled = false;
            chkMedRecordReceived.Enabled = false;
            chkMedBillPOPReceived.Enabled = false;
            chkMedBill_IBReceived.Enabled = false;
            chkMedBillNPFReceived.Enabled = false;

            dtpMedBillOtherDoc.Enabled = false;
            dtpMedBillMedRecord.Enabled = false;
            dtpMedBillPOP.Enabled = false;
            dtpMedBill_IB.Enabled = false;
            dtpMedBillNPF.Enabled = false;

            btnViewNPF.Enabled = true;
            btnViewIB.Enabled = true;
            btnViewPoP.Enabled = true;
            btnViewMedRecord.Enabled = true;
            btnViewOtherDoc.Enabled = true;
        }

        private void EnableGroupMedBillDocumentsForViewing()
        {
            grpMedBillDocuments.Enabled = true;

            txtOtherDocMedBillFileName.Enabled = false;
            txtMedRecMedBillFileName.Enabled = false;
            txtPoPMedBillFileName.Enabled = false;
            txtIBMedBillFileName.Enabled = false;
            txtNPFMedBillFileName.Enabled = false;

            btnIBUploadMedBill.Enabled = false;
            btnOtherDocUploadMedBill.Enabled = false;
            btnMedRecUploadMedBill.Enabled = false;
            btnPoPUploadMedBill.Enabled = false;
            btnNPFUploadMedBill.Enabled = false;

            chkOtherDocMedBill.Enabled = false;
            chkMedRecMedBill.Enabled = false;
            chkPoPMedBill.Enabled = false;
            chkIBMedBill.Enabled = false;
            chkNPFMedBill.Enabled = false;

            btnOtherDocMedBillView.Enabled = true;
            btnMedRecMedBillView.Enabled = true;
            btnPoPMedBillView.Enabled = true;
            btnIBMedBillView.Enabled = true;
            btnNPFMedBillView.Enabled = true;

        }

        private void OnTaskInMedBillChange(object sender, SqlNotificationEventArgs e)
        {
            if (e.Type == SqlNotificationType.Change)
            {
                SqlDependency dependency = sender as SqlDependency;
                dependency.OnChange -= OnTaskInMedBillChange;

                UpdateGridViewTaskInMedBill();
            }
        }

        private void UpdateGridViewTaskInMedBill()
        {
            String strSqlQueryForTaskInMedBill = "select [dbo].[tbl_task].[Subject], [dbo].[tbl_task].[DueDate], [dbo].[tbl_user].[User_Name], " +
                                                 "[dbo].[tbl_task_status_code].[TaskStatusValue], [dbo].[tbl_task].[id] " +
                                                 "from [dbo].[tbl_task] " +
                                                 "inner join [dbo].[tbl_user] on [dbo].[tbl_task].[AssignedTo] = [dbo].[tbl_user].[User_Id] " +
                                                 "inner join [dbo].[tbl_task_status_code] on [dbo].[tbl_task].[Status] = [dbo].[tbl_task_status_code].[TaskStatusCode] " +
                                                 "where ([dbo].[tbl_task].[IsDeleted] IS NULL or [dbo].[tbl_task].[IsDeleted] = 0) and " +
                                                 "[dbo].[tbl_task].[whatid] = @MedBillNo " +
                                                 "order by [dbo].[tbl_task].[CreateDate] desc";

            SqlCommand cmdQueryForTask = new SqlCommand(strSqlQueryForTaskInMedBill, connRN4);
            cmdQueryForTask.CommandType = CommandType.Text;

            cmdQueryForTask.Parameters.AddWithValue("@MedBillNo", MedBillNoForTask);

            SqlDependency dependencyTask = new SqlDependency(cmdQueryForTask);
            dependencyTask.OnChange += new OnChangeEventHandler(OnTaskInMedBillChange);

            if (connRN4.State != ConnectionState.Closed)
            {
                connRN4.Close();
                connRN4.Open();
            }
            else if (connRN4.State == ConnectionState.Closed) connRN4.Open();

            // 12/20/18 begin here
            SqlDataReader rdrTaskForMedBill = cmdQueryForTask.ExecuteReader();
            if (IsHandleCreated) ClearTaskInMedBillSafely();
            else gvMostRecentTasks.Rows.Clear();

            if (rdrTaskForMedBill.HasRows)
            {
                while (rdrTaskForMedBill.Read())
                {
                    DataGridViewRow row = new DataGridViewRow();
                    if (!rdrTaskForMedBill.IsDBNull(0)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrTaskForMedBill.GetString(0) });
                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                    if (!rdrTaskForMedBill.IsDBNull(1)) row.Cells.Add(new CalendarCell { Value = rdrTaskForMedBill.GetDateTime(1).ToString("MM/dd/yyyy") });
                    else row.Cells.Add(new CalendarCell { Value = String.Empty });
                    if (!rdrTaskForMedBill.IsDBNull(2)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrTaskForMedBill.GetString(2) });
                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                    if (!rdrTaskForMedBill.IsDBNull(3)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrTaskForMedBill.GetString(3) });
                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                    if (!rdrTaskForMedBill.IsDBNull(4)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrTaskForMedBill.GetInt32(4).ToString() });
                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });

                    if (IsHandleCreated) AddRowToTaskInMedBillSafely(row);
                    else gvMostRecentTasks.Rows.Add(row);
                }
            }
            rdrTaskForMedBill.Close();

            if (connRN4.State == ConnectionState.Open) connRN4.Close();
        }

        //private void AttachControlEventHandlers()
        //{
        //txtMedBillGuarantor.TextChanged += new EventHandler(txtMedBillGuarantor_TextChanged);
        //txtMedBill_Illness.TextChanged += new EventHandler(txtMedBill_Illness_TextChanged);
        //txtMedBill_Incident.TextChanged += new EventHandler(txtMedBill_Incident_TextChanged);
        //txtMedBillAmount.TextChanged += new EventHandler(txtMedBillAmount_TextChanged);
        //txtBalance.TextChanged += new EventHandler(txtBalance_TextChanged);
        //txtPrescriptionName.TextChanged += new EventHandler(txtPrescriptionName_TextChanged);
        //txtPrescriptionNo.TextChanged += new EventHandler(txtPrescriptionNo_TextChanged);
        //txtPrescriptionDescription.TextChanged += new EventHandler(txtPrescriptionDescription_TextChanged);
        //txtNumPhysicalTherapy.TextChanged += new EventHandler(txtNumPhysicalTherapy_TextChanged);
        //cbMedicalBillNote1.SelectedIndexChanged += new EventHandler(cbMedicalBillNote1_SelectedIndexChanged);
        //cbMedicalBillNote2.SelectedIndexChanged += new EventHandler(cbMedicalBillNote2_SelectedIndexChanged);
        //cbMedicalBillNote3.SelectedIndexChanged += new EventHandler(cbMedicalBillNote3_SelectedIndexChanged);
        //cbMedicalBillNote4.SelectedIndexChanged += new EventHandler(cbMedicalBillNote4_SelectedIndexChanged);
        //txtMedicalBillNote1.TextChanged += new EventHandler(txtMedicalBillNote1_TextChanged);
        //txtMedicalBillNote2.TextChanged += new EventHandler(txtMedicalBillNote2_TextChanged);
        //txtMedicalBillNote3.TextChanged += new EventHandler(txtMedicalBillNote3_TextChanged);
        //txtMedicalBillNote4.TextChanged += new EventHandler(txtMedicalBillNote4_TextChanged);


        //dtpBillDate.ValueChanged += new EventHandler(dtpBillDate_ValueChanged);
        //dtpDueDate.ValueChanged += new EventHandler(dtpDueDate_ValueChanged);
        //}

        //private void DetachControlEventHandlers()
        //{
        //txtMedBillGuarantor.TextChanged -= txtMedBillGuarantor_TextChanged;
        //txtMedBill_Illness.TextChanged -= txtMedBill_Illness_TextChanged;
        //txtMedBill_Incident.TextChanged -= txtMedBill_Incident_TextChanged;
        //txtMedBillAmount.TextChanged -= txtMedBillAmount_TextChanged;
        //txtBalance.TextChanged -= txtBalance_TextChanged;
        //txtPrescriptionName.TextChanged -= txtPrescriptionName_TextChanged;
        //txtPrescriptionNo.TextChanged -= txtPrescriptionNo_TextChanged;
        //txtPrescriptionDescription.TextChanged -= txtPrescriptionDescription_TextChanged;
        //txtNumPhysicalTherapy.TextChanged -= txtNumPhysicalTherapy_TextChanged;
        //cbMedicalBillNote1.SelectedIndexChanged -= cbMedicalBillNote1_SelectedIndexChanged;
        //cbMedicalBillNote2.SelectedIndexChanged -= cbMedicalBillNote2_SelectedIndexChanged;
        //cbMedicalBillNote3.SelectedIndexChanged -= cbMedicalBillNote3_SelectedIndexChanged;
        //cbMedicalBillNote4.SelectedIndexChanged -= cbMedicalBillNote4_SelectedIndexChanged;
        //txtMedicalBillNote1.TextChanged -= txtMedicalBillNote1_TextChanged;
        //txtMedicalBillNote2.TextChanged -= txtMedicalBillNote2_TextChanged;
        //txtMedicalBillNote3.TextChanged -= txtMedicalBillNote3_TextChanged;
        //txtMedicalBillNote4.TextChanged -= txtMedicalBillNote4_TextChanged;


        //dtpBillDate.ValueChanged -= dtpBillDate_ValueChanged;
        //dtpDueDate.ValueChanged -= dtpDueDate_ValueChanged;
        //}



        private void gvCaseViewCaseHistory_CellClick(object sender, DataGridViewCellEventArgs e)
        {
            DataGridView gvCaseHistory = (DataGridView)sender;

            //DataGridViewCheckBoxColumn chkSelected = gvCaseHistory[0, 0] as DataGridViewCheckBoxColumn;
            for (int i = 0; i < gvCaseHistory.Rows.Count; i++)
            {

            }
        }

        private void btnEditCase_Click(object sender, EventArgs e)
        {
            //if (!tbCMMManager.TabPages.Contains(tbpgCreateCase))
            //{
            caseMode = CaseMode.Edit;

            IndividualIdSelected = txtCaseHistoryIndividualID.Text.Trim();
            String IndividualName = txtCaseHistoryIndividualName.Text.Trim();
            int nRowSelected = 0;

            int nNumberOfRowSelected = 0;
            //Boolean bSelected = false;

            Boolean bCaseInUse = false;

            for (int i = 0; i < gvCaseViewCaseHistory.Rows.Count; i++)
            {
                if ((Boolean)gvCaseViewCaseHistory[0, i].Value)
                {
                    nNumberOfRowSelected++;
                    nRowSelected = i;
                }
            }

            if (nNumberOfRowSelected == 0)
            {
                MessageBox.Show("Please select a case.");
            }
            else if (nNumberOfRowSelected >= 2)
            {
                MessageBox.Show("More than one row selected");
            }
            else if (nNumberOfRowSelected == 1)
            {

                CaseIdForCasePageMedBill = gvCaseViewCaseHistory["CaseName", nRowSelected].Value.ToString().Trim();

                String strSqlQueryForCaseInUse = "select [dbo].[tbl_CaseInUse].[Case_Name], [dbo].[tbl_CaseInUse].[EditingStaff] from [dbo].[tbl_CaseInUse] " +
                                                 "where [dbo].[tbl_CaseInUse].[Case_Name] = @CaseInUse";

                SqlCommand cmdCaseInUse = new SqlCommand(strSqlQueryForCaseInUse, connRN3);
                cmdCaseInUse.CommandType = CommandType.Text;

                cmdCaseInUse.Parameters.AddWithValue("@CaseInUse", CaseIdForCasePageMedBill);

                if (connRN3.State != ConnectionState.Closed)
                {
                    connRN3.Close();
                    connRN3.Open();
                }
                else if (connRN3.State == ConnectionState.Closed) connRN3.Open();
                SqlDataReader rdrCaseInUse = cmdCaseInUse.ExecuteReader();
                if (rdrCaseInUse.HasRows)
                {
                    rdrCaseInUse.Read();
                    if (CaseIdForCasePageMedBill == rdrCaseInUse.GetString(0).Trim() &&
                        nLoggedUserId != rdrCaseInUse.GetInt16(1))
                    {
                        MessageBox.Show("The Case: " + CaseIdForCasePageMedBill + " is in use.", "Alert");
                        rdrCaseInUse.Close();
                        if (connRN2.State != ConnectionState.Closed) connRN2.Close();
                        bCaseInUse = true;
                        //return;
                    }
                }
                else
                {
                    rdrCaseInUse.Close();
                    if (connRN2.State != ConnectionState.Closed) connRN2.Close();

                    String strSqlInsertCaseInUse = "insert into [dbo].[tbl_CaseInUse] (Case_Name, EditingStaff) values (@CaseNO, @EditingStaff)";

                    SqlCommand cmdInsertCaseInUse = new SqlCommand(strSqlInsertCaseInUse, connRN3);
                    cmdInsertCaseInUse.CommandType = CommandType.Text;

                    cmdInsertCaseInUse.Parameters.AddWithValue("@CaseNo", CaseIdForCasePageMedBill);
                    cmdInsertCaseInUse.Parameters.AddWithValue("@EditingStaff", nLoggedUserId);

                    if (connRN3.State != ConnectionState.Closed)
                    {
                        connRN3.Close();
                        connRN3.Open();
                    }
                    else if (connRN3.State == ConnectionState.Closed) connRN3.Open();
                    int nCaseInUserInserted = cmdInsertCaseInUse.ExecuteNonQuery();
                    if (nCaseInUserInserted != 1)
                    {
                        MessageBox.Show("Case in use: " + CaseIdForCasePageMedBill + " has not been inserted.", "Error");
                        if (connRN3.State != ConnectionState.Closed) connRN3.Close();
                        return;
                    }
                    if (connRN3.State != ConnectionState.Closed) connRN3.Close();
                }

                String strSqlQueryForCaseStatus = "select [dbo].[tbl_case_status_code].[CaseStatusValue] from [dbo].[tbl_case_status_code]";
                SqlCommand cmdQueryForCaseStatus = new SqlCommand(strSqlQueryForCaseStatus, connRN3);
                cmdQueryForCaseStatus.CommandType = CommandType.Text;

                if (connRN3.State != ConnectionState.Closed)
                {
                    connRN3.Close();
                    connRN3.Open();
                }
                else if (connRN3.State == ConnectionState.Closed) connRN3.Open();

                SqlDataReader rdrCaseStatus = cmdQueryForCaseStatus.ExecuteReader();
                cbCaseStatus.Items.Clear();
                if (rdrCaseStatus.HasRows)
                {
                    while (rdrCaseStatus.Read())
                    {
                        cbCaseStatus.Items.Add(rdrCaseStatus.GetString(0));
                    }
                }
                rdrCaseStatus.Close();
                if (connRN3.State != ConnectionState.Closed) connRN3.Close();

                //tbCMMManager.TabPages.Insert(4, tbpgCreateCase);
                //tbCMMManager.SelectedTab = tbpgCreateCase;

                CaseIdSelected = gvCaseViewCaseHistory[1, nRowSelected].Value.ToString();
                strCaseIdForIllness = CaseIdSelected;

                //String strSqlQueryForCaseInfoSelected = "select [dbo].[tbl_case].[Case_Name], [dbo].[tbl_case].[Contact_ID], " +
                //                                        "[dbo].[tbl_case].[NPF_Form], [dbo].[tbl_case].[NPF_Form_File_Name], [dbo].[tbl_case].[NPF_Form_Destination_File_Name], [dbo].[tbl_case].[NPF_Receiv_Date], " +
                //                                        "[dbo].[tbl_case].[IB_Form], [dbo].[tbl_case].[IB_Form_File_Name], [dbo].[tbl_case].[IB_Form_Destination_File_Name], [dbo].[tbl_case].[IB_Receiv_Date], " +
                //                                        "[dbo].[tbl_case].[POP_Form], [dbo].[tbl_case].[POP_Form_File_Name], [dbo].[tbl_case].[POP_Form_Destination_File_Name], [dbo].[tbl_case].[POP_Receiv_Date], " +
                //                                        "[dbo].[tbl_case].[MedRec_Form], [dbo].[tbl_case].[MedRec_Form_File_Name], " +
                //                                        "[dbo].[tbl_case].[MedRec_Form_Destination_File_Name], [dbo].[tbl_case].[MedRec_Receiv_Date], " +
                //                                        "[dbo].[tbl_case].[Unknown_Form], [dbo].[tbl_case].[Unknown_Form_File_Name], " +
                //                                        "[dbo].[tbl_case].[Unknown_Form_Destination_File_Name], [dbo].[tbl_case].[Unknown_Receiv_Date], " +
                //                                        "[dbo].[tbl_case].[Case_status], [dbo].[tbl_case].[Note] " +
                //                                        "from [dbo].[tbl_case] " +
                //                                        "where [dbo].[tbl_case].[Case_Name] = @CaseId and [dbo].[tbl_case].[Contact_ID] = @IndividualID";

                String strSqlQueryForCaseInfoSelected = "select [dbo].[tbl_case].[Case_Name], [dbo].[tbl_case].[Contact_ID], " +
                                                        "[dbo].[tbl_case].[NPF_Form], [dbo].[tbl_case].[NPF_Form_File_Name], [dbo].[tbl_case].[NPF_Receiv_Date], " +
                                                        "[dbo].[tbl_case].[IB_Form], [dbo].[tbl_case].[IB_Form_File_Name], [dbo].[tbl_case].[IB_Receiv_Date], " +
                                                        "[dbo].[tbl_case].[POP_Form], [dbo].[tbl_case].[POP_Form_File_Name], [dbo].[tbl_case].[POP_Receiv_Date], " +
                                                        "[dbo].[tbl_case].[MedRec_Form], [dbo].[tbl_case].[MedRec_Form_File_Name], [dbo].[tbl_case].[MedRec_Receiv_Date], " +
                                                        "[dbo].[tbl_case].[Unknown_Form], [dbo].[tbl_case].[Unknown_Form_File_Name], [dbo].[tbl_case].[Unknown_Receiv_Date], " +
                                                        "[dbo].[tbl_case].[Case_status], [dbo].[tbl_case].[Note] " +
                                                        "from [dbo].[tbl_case] " +
                                                        "where [dbo].[tbl_case].[IsDeleted] = 0 and " +
                                                        "[dbo].[tbl_case].[Case_Name] = @CaseId and " +
                                                        "[dbo].[tbl_case].[Contact_ID] = @IndividualID";

                SqlCommand cmdQueryForCaseInfo = new SqlCommand(strSqlQueryForCaseInfoSelected, connRN3);
                cmdQueryForCaseInfo.CommandType = CommandType.Text;

                cmdQueryForCaseInfo.Parameters.AddWithValue("@CaseId", CaseIdSelected);
                cmdQueryForCaseInfo.Parameters.AddWithValue("@IndividualID", IndividualIdSelected);

                //if (connRN.State == ConnectionState.Closed) connRN.Open();
                if (connRN3.State != ConnectionState.Closed)
                {
                    connRN3.Close();
                    connRN3.Open();
                }
                else if (connRN3.State == ConnectionState.Closed) connRN3.Open();
                SqlDataReader rdrCaseInfo = cmdQueryForCaseInfo.ExecuteReader();

                if (rdrCaseInfo.HasRows)
                {
                    rdrCaseInfo.Read();

                    // Populate NPF Form Info
                    if (!rdrCaseInfo.IsDBNull(0)) txtCaseName.Text = rdrCaseInfo.GetString(0);
                    if (!rdrCaseInfo.IsDBNull(1)) txtCaseIndividualID.Text = rdrCaseInfo.GetString(1);

                    if (txtMiddleName.Text == String.Empty) txtCreateCaseIndividualName.Text = txtLastName.Text + ", " + txtFirstName.Text;
                    else txtCreateCaseIndividualName.Text = txtLastName.Text + ", " + txtFirstName.Text + " " + txtMiddleName.Text;

                    if (!rdrCaseInfo.IsDBNull(2))
                    {
                        chkNPF_CaseCreationPage.Checked = (Boolean)rdrCaseInfo.GetBoolean(2);
                    }
                    if (!rdrCaseInfo.IsDBNull(3)) txtNPFFormFilePath.Text = rdrCaseInfo.GetString(3);
                    if (!rdrCaseInfo.IsDBNull(4))
                    {
                        dtpNPFReceivedDate.Checked = true;
                        dtpNPFReceivedDate.Value = rdrCaseInfo.GetDateTime(4);
                        dtpNPFReceivedDate.Text = rdrCaseInfo.GetDateTime(4).ToString("MM/dd/yyyy");
                    }
                    //txtNPFUploadDate.Text = rdrCaseInfo.GetDateTime(4).ToString("MM/dd/yyyy");

                    // Populate IB Form Info
                    if (!rdrCaseInfo.IsDBNull(5))
                    {
                        chkIB_CaseCreationPage.Checked = (Boolean)rdrCaseInfo.GetBoolean(5);
                    }
                    if (!rdrCaseInfo.IsDBNull(6)) txtIBFilePath.Text = rdrCaseInfo.GetString(6);
                    if (!rdrCaseInfo.IsDBNull(7))
                    {
                        dtpIBReceivedDate.Checked = true;
                        dtpIBReceivedDate.Value = rdrCaseInfo.GetDateTime(7);
                        dtpIBReceivedDate.Text = rdrCaseInfo.GetDateTime(7).ToString("MM/dd/yyyy");
                    }
                    //txtIBUploadDate.Text = rdrCaseInfo.GetDateTime(7).ToString("MM/dd/yyyy");

                    // Populate POP Form Info
                    if (!rdrCaseInfo.IsDBNull(8))
                    {
                        chkPoP_CaseCreationPage.Checked = (Boolean)rdrCaseInfo.GetBoolean(8);
                    }
                    if (!rdrCaseInfo.IsDBNull(9)) txtPopFilePath.Text = rdrCaseInfo.GetString(9);
                    if (!rdrCaseInfo.IsDBNull(10))
                    {
                        dtpPoPReceivedDate.Checked = true;
                        dtpPoPReceivedDate.Value = rdrCaseInfo.GetDateTime(10);
                        dtpPoPReceivedDate.Text = rdrCaseInfo.GetDateTime(10).ToString("MM/dd/yyyy");
                    }
                    //txtPoPUploadDate.Text = rdrCaseInfo.GetDateTime(10).ToString("MM/dd/yyyy");

                    // Populate Med Rec Form Info
                    if (!rdrCaseInfo.IsDBNull(11))
                    {
                        chkMedicalRecordCaseCreationPage.Checked = (Boolean)rdrCaseInfo.GetBoolean(11);
                    }
                    if (!rdrCaseInfo.IsDBNull(12)) txtMedicalRecordFilePath.Text = rdrCaseInfo.GetString(12);
                    if (!rdrCaseInfo.IsDBNull(13))
                    {
                        dtpMRReceivedDate.Checked = true;
                        dtpMRReceivedDate.Value = rdrCaseInfo.GetDateTime(13);
                        dtpMRReceivedDate.Text = rdrCaseInfo.GetDateTime(13).ToString("MM/dd/yyyy");
                    }
                    //txtMRUploadDate.Text = rdrCaseInfo.GetDateTime(13).ToString("MM/dd/yyyy");

                    // Populate Unknown Doc Info
                    if (!rdrCaseInfo.IsDBNull(14))
                    {
                        chkOtherDocCaseCreationPage.Checked = (Boolean)rdrCaseInfo.GetBoolean(14);
                    }
                    if (!rdrCaseInfo.IsDBNull(15)) txtOtherDocumentFilePath.Text = rdrCaseInfo.GetString(15);
                    if (!rdrCaseInfo.IsDBNull(16))
                    {
                        dtpOtherDocReceivedDate.Checked = true;
                        dtpOtherDocReceivedDate.Value = rdrCaseInfo.GetDateTime(16);
                        dtpOtherDocReceivedDate.Text = rdrCaseInfo.GetDateTime(16).ToString("MM/dd/yyyy");
                    }
                    //txtOtherDocUploadDate.Text = rdrCaseInfo.GetDateTime(16).ToString("MM/dd/yyyy");

                    // Populate case status
                    if (!rdrCaseInfo.IsDBNull(17))
                    {
                        //if (rdrCaseInfo.GetBoolean(17))
                        //{
                        //    txtCaseStatus.Text = "Complete and Ready";
                        //}
                        //else
                        //{
                        //    txtCaseStatus.Text = "Pending - Additional Documents required";
                        //}
                        switch (rdrCaseInfo.GetInt16(17))
                        {
                            case (int)CaseStatus.OnGoing:
                                cbCaseStatus.SelectedIndex = (int)CaseStatus.OnGoing;
                                cbCaseStatus.Enabled = true;
                                break;
                            case (int)CaseStatus.Processing:
                                cbCaseStatus.SelectedIndex = (int)CaseStatus.Processing;
                                cbCaseStatus.Enabled = true;
                                break;
                            case (int)CaseStatus.Closed:
                                cbCaseStatus.SelectedIndex = (int)CaseStatus.Closed;
                                cbCaseStatus.Enabled = true;
                                break;
                        }
                    }

                    // Populate Note
                    if (!rdrCaseInfo.IsDBNull(18))
                    {
                        txtNoteOnCase.Text = rdrCaseInfo.GetString(18);
                    }

                    // Populate note
                    if (!rdrCaseInfo.IsDBNull(18)) txtNoteOnCase.Text = rdrCaseInfo.GetString(18);
                }
                rdrCaseInfo.Close();
                if (connRN3.State != ConnectionState.Closed) connRN3.Close();

                // Populate the gvCasePageMedBills with Med Bill in the case
                String strSqlQueryForMedBillsInCase = "select [dbo].[tbl_medbill].[BillNo], [dbo].[tbl_medbill_type].[MedBillTypeName], [dbo].[tbl_medbill].[CreatedDate], [dbo].[tbl_CreateStaff].[Staff_Name], " +
                                                        "[dbo].[tbl_medbill].[LastModifiedDate], [dbo].[tbl_ModifiStaff].[Staff_Name], " +
                                                        "[dbo].[tbl_medbill].[BillAmount], [dbo].[tbl_medbill].[SettlementTotal], [dbo].[tbl_medbill].[TotalSharedAmount], [dbo].[tbl_medbill].[Balance] " +
                                                        "from ((([dbo].[tbl_medbill] inner join [dbo].[tbl_medbill_type] on [dbo].[tbl_medbill].[MedBillType_Id] = [dbo].[tbl_medbill_type].[MedBillTypeId]) " +
                                                        "inner join [dbo].[tbl_CreateStaff] on [dbo].[tbl_medbill].[CreatedById] = [dbo].[tbl_CreateStaff].[CreateStaff_Id]) " +
                                                        "inner join [dbo].[tbl_ModifiStaff] on [dbo].[tbl_medbill].[LastModifiedById] = [dbo].[tbl_ModifiStaff].[ModifiStaff_Id]) " +
                                                        "where [dbo].[tbl_medbill].[Case_Id] = @CaseName and " +
                                                        "[dbo].[tbl_medbill].[Contact_Id] = @IndividualId and " +
                                                        "[dbo].[tbl_medbill].[IsDeleted] = 0";

                SqlCommand cmdQueryForMedBillsInCase = new SqlCommand(strSqlQueryForMedBillsInCase, connRN3);
                cmdQueryForMedBillsInCase.CommandType = CommandType.Text;

                cmdQueryForMedBillsInCase.Parameters.AddWithValue("@CaseName", CaseIdSelected);
                cmdQueryForMedBillsInCase.Parameters.AddWithValue("@IndividualId", IndividualIdSelected);

                SqlDependency dependencyMedBillsInCaseEdit = new SqlDependency(cmdQueryForMedBillsInCase);
                dependencyMedBillsInCaseEdit.OnChange += new OnChangeEventHandler(OnMedBillsInCaseEditChange);

                //if (connRN.State == ConnectionState.Closed) connRN.Open();
                if (connRN3.State != ConnectionState.Closed)
                {
                    connRN3.Close();
                    connRN3.Open();
                }
                else if (connRN3.State == ConnectionState.Closed) connRN3.Open();
                SqlDataReader rdrMedBillsInCase = cmdQueryForMedBillsInCase.ExecuteReader();

                gvCasePageMedBills.Rows.Clear();
                if (rdrMedBillsInCase.HasRows)
                {
                    while (rdrMedBillsInCase.Read())
                    {
                        DataGridViewRow row = new DataGridViewRow();

                        row.Cells.Add(new DataGridViewCheckBoxCell { Value = false });
                        if (!rdrMedBillsInCase.IsDBNull(0)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillsInCase.GetString(0) });
                        if (!rdrMedBillsInCase.IsDBNull(1)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillsInCase.GetString(1) });
                        if (!rdrMedBillsInCase.IsDBNull(2)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillsInCase.GetDateTime(2).ToString("MM/dd/yyyy") });
                        if (!rdrMedBillsInCase.IsDBNull(3)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillsInCase.GetString(3) });
                        if (!rdrMedBillsInCase.IsDBNull(4)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillsInCase.GetDateTime(4).ToString("MM/dd/yyyy") });
                        if (!rdrMedBillsInCase.IsDBNull(5)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillsInCase.GetString(5) });
                        if (!rdrMedBillsInCase.IsDBNull(6)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillsInCase.GetDecimal(6).ToString("C") });
                        if (!rdrMedBillsInCase.IsDBNull(7)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillsInCase.GetDecimal(7).ToString("C") });
                        if (!rdrMedBillsInCase.IsDBNull(8)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillsInCase.GetDecimal(8).ToString("C") });
                        if (!rdrMedBillsInCase.IsDBNull(9)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillsInCase.GetDecimal(9).ToString("C") });

                        gvCasePageMedBills.Rows.Add(row);
                    }
                }
                rdrMedBillsInCase.Close();
                if (connRN3.State != ConnectionState.Closed) connRN3.Close();
                /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

                String strSqlQueryForTaskInCase = "select [dbo].[tbl_task].[whoid], [dbo].[tbl_task].[IndividualName], " +
                                                  "[dbo].[tbl_task_assigned_to].[User_Name], [dbo].[tbl_task].[whatid], " +
                                                  "[dbo].[tbl_task].[Subject], [dbo].[tbl_task].[DueDate], [dbo].[tbl_task_related_to_code].[TaskRelatedToValue], " +
                                                  "[dbo].[tbl_task].[CreateDate], [dbo].[tbl_task_created_by].[User_Name], [dbo].[tbl_task].[ActivityDate], " +
                                                  "[dbo].[tbl_task].[Comment], [dbo].[tbl_task].[Solution], " +
                                                  "[dbo].[tbl_task_status_code].[TaskStatusValue], [dbo].[tbl_task_priority_code].[TaskPriorityValue], " +
                                                  "[dbo].[tbl_task].[ReminderDateTime], [dbo].[tbl_task].[id] " +
                                                  "from [dbo].[tbl_task] " +
                                                  "inner join [dbo].[tbl_task_assigned_to] on [dbo].[tbl_task].[AssignedTo] = [dbo].[tbl_task_assigned_to].[User_Id] " +
                                                  "inner join [dbo].[tbl_task_related_to_code] on [dbo].[tbl_task].[RelatedToTableId] = [dbo].[tbl_task_related_to_code].[TaskRelatedToId] " +
                                                  "inner join [dbo].[tbl_task_created_by] on [dbo].[tbl_task].[CreatedById] = [dbo].[tbl_task_created_by].[User_Id] " +
                                                  "inner join [dbo].[tbl_task_status_code] on [dbo].[tbl_task].[Status] = [dbo].[tbl_task_status_code].[TaskStatusCode] " +
                                                  "inner join [dbo].[tbl_task_priority_code] on [dbo].[tbl_task].[Priority] = [dbo].[tbl_task_priority_code].[TaskPriorityCode] " +
                                                  "where [dbo].[tbl_task].[whatid] = @CaseNo";

                SqlCommand cmdQueryForTaskInCase = new SqlCommand(strSqlQueryForTaskInCase, connRN2);
                cmdQueryForTaskInCase.CommandType = CommandType.Text;

                cmdQueryForTaskInCase.Parameters.AddWithValue("@CaseNo", CaseIdForCasePageMedBill);

                SqlDependency dependencyTaskInCase = new SqlDependency(cmdQueryForTaskInCase);
                dependencyTaskInCase.OnChange += new OnChangeEventHandler(OnTaskInCaseChange);

                if (connRN2.State != ConnectionState.Closed)
                {
                    connRN2.Close();
                    connRN2.Open();
                }
                else if (connRN2.State == ConnectionState.Closed) connRN2.Open();
                gvTaskInCase.Rows.Clear();
                SqlDataReader rdrTaskInCase = cmdQueryForTaskInCase.ExecuteReader();
                if (rdrTaskInCase.HasRows)
                {
                    while (rdrTaskInCase.Read())
                    {
                        DataGridViewRow row = new DataGridViewRow();
                        if (!rdrTaskInCase.IsDBNull(0)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrTaskInCase.GetString(0) });
                        else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                        if (!rdrTaskInCase.IsDBNull(1)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrTaskInCase.GetString(1) });
                        else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                        if (!rdrTaskInCase.IsDBNull(2)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrTaskInCase.GetString(2) });
                        else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                        if (!rdrTaskInCase.IsDBNull(3)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrTaskInCase.GetString(3) });
                        else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                        if (!rdrTaskInCase.IsDBNull(4)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrTaskInCase.GetString(4) });
                        else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                        if (!rdrTaskInCase.IsDBNull(5)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrTaskInCase.GetDateTime(5).ToString("MM/dd/yyyy") });
                        else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                        if (!rdrTaskInCase.IsDBNull(6)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrTaskInCase.GetString(6) });
                        else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                        if (!rdrTaskInCase.IsDBNull(7)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrTaskInCase.GetDateTime(7).ToString("MM/dd/yyyy") });
                        else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                        if (!rdrTaskInCase.IsDBNull(8)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrTaskInCase.GetString(8) });
                        else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                        if (!rdrTaskInCase.IsDBNull(9)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrTaskInCase.GetDateTime(9).ToString("MM/dd/yyyy") });
                        else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                        if (!rdrTaskInCase.IsDBNull(10)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrTaskInCase.GetString(10) });
                        else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                        if (!rdrTaskInCase.IsDBNull(11)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrTaskInCase.GetString(11) });
                        else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                        if (!rdrTaskInCase.IsDBNull(12)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrTaskInCase.GetString(12) });
                        else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                        if (!rdrTaskInCase.IsDBNull(13)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrTaskInCase.GetString(13) });
                        else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                        if (!rdrTaskInCase.IsDBNull(14)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrTaskInCase.GetInt32(14) });
                        else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                        if (!rdrTaskInCase.IsDBNull(15)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrTaskInCase.GetInt32(15) });
                        else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });

                        gvTaskInCase.Rows.Add(row);
                    }
                }
                rdrTaskInCase.Close();
                if (connRN2.State != ConnectionState.Closed) connRN2.Close();
                //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                EnableCaseForm();

                btnNewMedBill_Case.Enabled = true;
                btnEditMedBill.Enabled = true;
                btnDeleteMedBill.Enabled = true;

                btnCaseCreationSaveUpper.Enabled = true;

                if (bCaseInUse)
                {
                    DisableCaseForm();

                    btnNPFFormView.Enabled = true;
                    //btnNPFFormView.Enabled = true;
                    btnIBView.Enabled = true;
                    btnPoPView.Enabled = true;
                    btnMedicalRecordView.Enabled = true;
                    btnOtherDocView.Enabled = true;

                    gvCasePageMedBills.Enabled = true;
                }
                //btnCaseCreationLowerSave.Enabled = true;

                tbCMMManager.SelectedTab = tbpgCreateCase;
            }
        }

        private void ClearMedBillsInCaseEditSafely()
        {
            gvCasePageMedBills.BeginInvoke(new RemoveAllMedBillsInCaseEdit(ClearAllMedBillsInCaseEdit));
        }

        private void AddRowMedBillsInCaseEditSafely(DataGridViewRow row)
        {
            gvCasePageMedBills.BeginInvoke(new AddRowToMedBillsInCaseEdit(AddRowMedBillsInCaseEdit), row);
        }


        private void ClearAllMedBillsInCaseEdit()
        {
            gvCasePageMedBills.Rows.Clear();
        }

        private void AddRowMedBillsInCaseEdit(DataGridViewRow row)
        {
            gvCasePageMedBills.Rows.Add(row);
        }

        private void OnMedBillsInCaseEditChange(object sender, SqlNotificationEventArgs e)
        {
            if (e.Type == SqlNotificationType.Change)
            {
                SqlDependency dependency = sender as SqlDependency;
                dependency.OnChange -= OnMedBillsInCaseEditChange;

                UpdateGridViewMedBillsInCaseEdit();

            }
        }

        private void UpdateGridViewMedBillsInCaseEdit()
        {
            String strSqlQueryForMedBillsInCase = "select [dbo].[tbl_medbill].[BillNo], [dbo].[tbl_medbill_type].[MedBillTypeName], [dbo].[tbl_medbill].[CreatedDate], [dbo].[tbl_CreateStaff].[Staff_Name], " +
                                                  "[dbo].[tbl_medbill].[LastModifiedDate], [dbo].[tbl_ModifiStaff].[Staff_Name], " +
                                                  "[dbo].[tbl_medbill].[BillAmount], [dbo].[tbl_medbill].[SettlementTotal], [dbo].[tbl_medbill].[TotalSharedAmount], [dbo].[tbl_medbill].[Balance] " +
                                                  "from ((([dbo].[tbl_medbill] inner join [dbo].[tbl_medbill_type] on [dbo].[tbl_medbill].[MedBillType_Id] = [dbo].[tbl_medbill_type].[MedBillTypeId]) " +
                                                  "inner join [dbo].[tbl_CreateStaff] on [dbo].[tbl_medbill].[CreatedById] = [dbo].[tbl_CreateStaff].[CreateStaff_Id]) " +
                                                  "inner join [dbo].[tbl_ModifiStaff] on [dbo].[tbl_medbill].[LastModifiedById] = [dbo].[tbl_ModifiStaff].[ModifiStaff_Id]) " +
                                                  "where [dbo].[tbl_medbill].[Case_Id] = @CaseName and " +
                                                  "[dbo].[tbl_medbill].[Contact_Id] = @IndividualId and " +
                                                  "[dbo].[tbl_medbill].[IsDeleted] = 0";

            SqlCommand cmdQueryForMedBillsInCase = new SqlCommand(strSqlQueryForMedBillsInCase, connRN3);
            cmdQueryForMedBillsInCase.CommandType = CommandType.Text;

            cmdQueryForMedBillsInCase.Parameters.AddWithValue("@CaseName", CaseIdSelected);
            cmdQueryForMedBillsInCase.Parameters.AddWithValue("@IndividualId", IndividualIdSelected);

            SqlDependency dependencyMedBillsInCaseEdit = new SqlDependency(cmdQueryForMedBillsInCase);
            dependencyMedBillsInCaseEdit.OnChange += new OnChangeEventHandler(OnMedBillsInCaseEditChange);

            //if (connRN.State == ConnectionState.Closed) connRN.Open();
            if (connRN3.State != ConnectionState.Closed)
            {
                connRN3.Close();
                connRN3.Open();
            }
            else if (connRN3.State == ConnectionState.Closed) connRN3.Open();
            SqlDataReader rdrMedBillsInCase = cmdQueryForMedBillsInCase.ExecuteReader();

            //gvCasePageMedBills.Rows.Clear();
            if (IsHandleCreated) ClearMedBillsInCaseEditSafely();
            else gvCasePageMedBills.Rows.Clear();

            if (rdrMedBillsInCase.HasRows)
            {
                while (rdrMedBillsInCase.Read())
                {
                    DataGridViewRow row = new DataGridViewRow();

                    row.Cells.Add(new DataGridViewCheckBoxCell { Value = false });
                    if (!rdrMedBillsInCase.IsDBNull(0)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillsInCase.GetString(0) });
                    if (!rdrMedBillsInCase.IsDBNull(1)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillsInCase.GetString(1) });
                    if (!rdrMedBillsInCase.IsDBNull(2)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillsInCase.GetDateTime(2).ToString("MM/dd/yyyy") });
                    if (!rdrMedBillsInCase.IsDBNull(3)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillsInCase.GetString(3) });
                    if (!rdrMedBillsInCase.IsDBNull(4)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillsInCase.GetDateTime(4).ToString("MM/dd/yyyy") });
                    if (!rdrMedBillsInCase.IsDBNull(5)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillsInCase.GetString(5) });
                    if (!rdrMedBillsInCase.IsDBNull(6)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillsInCase.GetDecimal(6).ToString("C") });
                    if (!rdrMedBillsInCase.IsDBNull(7)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillsInCase.GetDecimal(7).ToString("C") });
                    if (!rdrMedBillsInCase.IsDBNull(8)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillsInCase.GetDecimal(8).ToString("C") });
                    if (!rdrMedBillsInCase.IsDBNull(9)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillsInCase.GetDecimal(9).ToString("C") });

                    //gvCasePageMedBills.Rows.Add(row);
                    //if (IsHandleCreated) AddRowMedBillsInCaseEdit(row);
                    if (IsHandleCreated) AddRowMedBillsInCaseEditSafely(row);
                    else gvCasePageMedBills.Rows.Add(row);
                }
            }
            rdrMedBillsInCase.Close();
            if (connRN3.State != ConnectionState.Closed) connRN3.Close();
        }

        private void btnEditMedBill_Click(object sender, EventArgs e)
        {

            //if (!tbCMMManager.TabPages.Contains(tbpgMedicalBill))
            //{
            medbillMode = MedBillMode.Edit;

            String MedBillNo = String.Empty;
            int nNumberOfRowSelected = 0;

            for (int i = 0; i < gvCasePageMedBills.Rows.Count; i++)
            {
                if ((Boolean)gvCasePageMedBills[0, i].Value)
                {
                    MedBillNo = gvCasePageMedBills[1, i].Value.ToString();
                    nNumberOfRowSelected++;
                }
            }

            if (nNumberOfRowSelected == 0)
            {
                MessageBox.Show("Please select a medical bill.");
                return;
            }
            else if (nNumberOfRowSelected >= 2)
            {
                MessageBox.Show("More than one medical bill selected.");
                return;
            }
            else if (nNumberOfRowSelected == 1)
            {
                InitializeMedBillTabOnNewMedBill();
                //tbCMMManager.TabPages.Insert(5, tbpgMedicalBill);
                tbCMMManager.SelectedTab = tbpgMedicalBill;

                //String CaseNameInMedBillEdit = txtCaseName.Text.Trim();
                //String IndividualIdInMedBillEdit = txtCaseIndividualID.Text.Trim();
                String IndividualName = String.Empty;

                String CaseNameInMedBill = txtCaseName.Text.Trim();
                String IndividualIdInMedBill = txtCaseIndividualID.Text.Trim();
                //MedBillNo = gvCasePageMedBills[1, i].Value.ToString();

                switch (IndividualSearched.IndividualPlan)
                {
                    case Plan.GoldPlus:
                        txtMemberProgram.Text = "Gold Plus";
                        break;
                    case Plan.Gold:
                        txtMemberProgram.Text = "Gold";
                        break;
                    case Plan.Silver:
                        txtMemberProgram.Text = "Silver";
                        break;
                    case Plan.Bronze:
                        txtMemberProgram.Text = "Bronze";
                        break;
                    case Plan.GoldMedi_I:
                        txtMemberProgram.Text = "Gold Medi-I";
                        break;
                    case Plan.GoldMedi_II:
                        txtMemberProgram.Text = "Gold Medi-II";
                        break;
                }

                //////////////////////////////////////////////////////////////////////////////////

                //String strCaseNameSelected = String.Empty;
                String strPatientLastName = txtLastName.Text.Trim();
                String strPatientFirstName = txtFirstName.Text.Trim();
                String strPatientMiddleName = txtMiddleName.Text.Trim();
                String strDateOfBirth = dtpBirthDate.Value.ToString("MM/dd/yyyy");
                String strSSN = txtIndividualSSN.Text.Trim();
                String strStreetAddr = txtStreetAddress1.Text.Trim();
                String strCity = txtCity1.Text.Trim();
                String strState = txtState1.Text.Trim();
                String strZip = txtZip1.Text.Trim();

                txtIndividualIDMedBill.Text = IndividualIdInMedBill;
                if (strPatientMiddleName.Trim() == String.Empty) txtPatientNameMedBill.Text = strPatientLastName + ", " + strPatientFirstName;
                else if (strPatientMiddleName.Trim() != String.Empty) txtPatientNameMedBill.Text = strPatientLastName + ", " + strPatientFirstName + " " + strPatientMiddleName;

                txtMedBillDOB.Text = strDateOfBirth;
                txtMedBillSSN.Text = strSSN;
                txtMedBillAddress.Text = strStreetAddr + ", " + strCity + ", " + strState + " " + strZip;

                ///////////////////////////////////////////////////////////////////////////////////
                // MedBillNo, CaseNameInMedBill, IndividualIdInMedBill
                String strSqlQueryForMedBillTypes = "select [dbo].[tbl_medbill_type].[MedBillTypeId], [dbo].[tbl_medbill_type].[MedBillTypeName] from [dbo].[tbl_medbill_type]";

                SqlCommand cmdQueryForMedBillTypes = new SqlCommand(strSqlQueryForMedBillTypes, connRN4);
                cmdQueryForMedBillTypes.CommandType = CommandType.Text;

                //if (connRN.State == ConnectionState.Closed) connRN.Open();
                if (connRN4.State != ConnectionState.Closed)
                {
                    connRN4.Close();
                    connRN4.Open();
                }
                else if (connRN4.State == ConnectionState.Closed) connRN4.Open();
                SqlDataReader rdrMedBillTypes = cmdQueryForMedBillTypes.ExecuteReader();
                dicMedBillTypes.Clear();

                if (rdrMedBillTypes.HasRows)
                {
                    while (rdrMedBillTypes.Read())
                    {
                        if (!rdrMedBillTypes.IsDBNull(0) && !rdrMedBillTypes.IsDBNull(1))
                        {
                            dicMedBillTypes.Add(rdrMedBillTypes.GetInt16(0), rdrMedBillTypes.GetString(1));
                        }
                    }
                }
                rdrMedBillTypes.Close();
                if (connRN4.State != ConnectionState.Closed) connRN4.Close();
                /////////////////////////////////////////////////////////////////////////////////////////
                ///

                // Populate Pending Reason
                comboPendingReason.Items.Clear();
                if (dicPendingReason.Count > 0)
                {
                    for (int i = 0; i < dicPendingReason.Count; i++)
                    {
                        comboPendingReason.Items.Add(dicPendingReason[i]);
                    }
                    comboPendingReason.SelectedIndex = 0;
                }
                //comboPendingReason.Sorted = true;

                // Populate Ineligible Reason
                comboIneligibleReason.Items.Clear();
                if (dicIneligibleReason.Count > 0)
                {
                    for (int i = 0; i < dicIneligibleReason.Count; i++)
                    {
                        comboIneligibleReason.Items.Add(dicIneligibleReason[i]);
                    }
                    comboIneligibleReason.SelectedIndex = 0;
                }
                //comboIneligibleReason.Sorted = true;

                // Get the Medical Bill Note Type info
                //List<MedBillNoteTypeInfo> lstMedBillNoteTypeInfo = new List<MedBillNoteTypeInfo>();

                //String strSqlQueryForMedBillNoteTypeInfo = "select [dbo].[tbl_MedBillNoteType].[MedBillNoteTypeId], [dbo].[tbl_MedBillNoteType].[MedBillNoteTypeValue] from [dbo].[tbl_MedBillNoteType]";

                //SqlCommand cmdQueryForMedBillNoteTypeInfo = new SqlCommand(strSqlQueryForMedBillNoteTypeInfo, connRN);
                //cmdQueryForMedBillNoteTypeInfo.CommandType = CommandType.Text;

                //connRN.Open();
                //SqlDataReader rdrMedBillNoteType = cmdQueryForMedBillNoteTypeInfo.ExecuteReader();
                //if (rdrMedBillNoteType.HasRows)
                //{
                //    while (rdrMedBillNoteType.Read())
                //    {
                //        if (!rdrMedBillNoteType.IsDBNull(0) && !rdrMedBillNoteType.IsDBNull(1))
                //        {
                //            lstMedBillNoteTypeInfo.Add(new MedBillNoteTypeInfo { MedBillNoteTypeId = rdrMedBillNoteType.GetInt16(0), MedBillNoteTypeValue = rdrMedBillNoteType.GetString(1) });
                //        }
                //    }
                //}
                //connRN.Close();

                // Get medical bill info
                String ICD10Code = String.Empty;
                //String strSqlQueryForMedBillEdit = "select [dbo].[tbl_medbill].[Case_Id], [dbo].[tbl_medbill].[Illness_Id], [dbo].[tbl_medbill].[Incident_Id], " +
                //                                   "[dbo].[tbl_medbill].[BillNo], [dbo].[tbl_medbill].[MedBillType_Id], [dbo].[tbl_medbill].[BillStatus], [dbo].[tbl_medbill].[BillClosed], " +
                //                                   "[dbo].[tbl_medbill].[BillAmount], [dbo].[tbl_MedicalProvider].[Name], " +
                //                                   "[dbo].[tbl_medbill].[PrescriptionDrugName], [dbo].[tbl_medbill].[PrescriptionNo], [dbo].[tbl_medbill].[PrescriptionDescription], " +
                //                                   "[dbo].[tbl_medbill].[TotalNumberOfPhysicalTherapy], [dbo].[tbl_medbill].[PatientTypeId], " +
                //                                   "[dbo].[tbl_medbill].[BillDate], [dbo].[tbl_medbill].[DueDate], " +
                //                                   "[dbo].[tbl_medbill].[Account_At_Provider], [dbo].[tbl_MedicalProvider].[PHONE], [dbo].[tbl_medbill].[ProviderContactPerson], " +
                //                                   "[dbo].[tbl_medbill].[Note], " +
                //                                   "[dbo].[tbl_illness].[ICD_10_Id], " +
                //                                   "[dbo].[tbl_medbill].[PendingReason], [dbo].[tbl_medbill].[IneligibleReason], " +
                //                                   "[dbo].[tbl_medbill].[Account_At_Provider], [dbo].[tbl_medbill].[ProviderPhoneNumber], [dbo].[tbl_medbill].[ProviderContactPerson], " +
                //                                   "[dbo].[tbl_medbill].[ProposalLetterSentDate], [dbo].[tbl_medbill].[HIPPASentDate], [dbo].[tbl_medbill].[MedicalRecordDate] " +
                //                                   "from (([dbo].[tbl_medbill] inner join [dbo].[tbl_illness] on [dbo].[tbl_medbill].[Illness_Id] = [dbo].[tbl_illness].[Illness_Id]) " +
                //                                   "inner join [dbo].[tbl_MedicalProvider] on [dbo].[tbl_medbill].[MedicalProvider_Id] = [dbo].[tbl_MedicalProvider].[ID]) " +
                //                                   "where [dbo].[tbl_medbill].[BillNo] = @MedBillNo and " +
                //                                   "[dbo].[tbl_medbill].[Case_Id] = @CaseName and " +
                //                                   "[dbo].[tbl_medbill].[Contact_Id] = @IndividualId and " +
                //                                   "[dbo].[tbl_medbill].[IsDeleted] = 0";


                String strSqlQueryForMedBillEdit = "select [RN_DB].[dbo].[tbl_medbill].[Case_Id], [RN_DB].[dbo].[tbl_illness].[IllnessNo], [RN_DB].[dbo].[tbl_incident].[IncidentNo], " +
                                                    "[RN_DB].[dbo].[tbl_medbill].[BillNo], [RN_DB].[dbo].[tbl_medbill].[MedBillType_Id], [RN_DB].[dbo].[tbl_medbill].[BillStatus], " +
                                                    "[RN_DB].[dbo].[tbl_medbill].[BillClosed], " +
                                                    "[RN_DB].[dbo].[tbl_medbill].[BillAmount], [SalesForce].[dbo].[account].[Name], " +
                                                    "[RN_DB].[dbo].[tbl_medbill].[PrescriptionDrugName], [RN_DB].[dbo].[tbl_medbill].[PrescriptionNo], [RN_DB].[dbo].[tbl_medbill].[PrescriptionDescription], " +
                                                    "[RN_DB].[dbo].[tbl_medbill].[TotalNumberOfPhysicalTherapy], [RN_DB].[dbo].[tbl_medbill].[PatientTypeId], " +
                                                    "[RN_DB].[dbo].[tbl_medbill].[BillDate], [RN_DB].[dbo].[tbl_medbill].[DueDate], " +
                                                    "[RN_DB].[dbo].[tbl_medbill].[Account_At_Provider], [SalesForce].[dbo].[account].[Phone], [RN_DB].[dbo].[tbl_medbill].[ProviderContactPerson], " +
                                                    "[RN_DB].[dbo].[tbl_medbill].[Note], " +
                                                    "[RN_DB].[dbo].[tbl_illness].[ICD_10_Id], " +
                                                    "[RN_DB].[dbo].[tbl_medbill].[PendingReason], [RN_DB].[dbo].[tbl_medbill].[IneligibleReason], " +
                                                    "[RN_DB].[dbo].[tbl_medbill].[Account_At_Provider], [RN_DB].[dbo].[tbl_medbill].[ProviderPhoneNumber], [RN_DB].[dbo].[tbl_medbill].[ProviderContactPerson], " +
                                                    "[RN_DB].[dbo].[tbl_medbill].[ProposalLetterSentDate], [RN_DB].[dbo].[tbl_medbill].[HIPPASentDate], [RN_DB].[dbo].[tbl_medbill].[MedicalRecordDate], " +
                                                    "[RN_DB].[dbo].[tbl_medbill].[Illness_Id], [RN_DB].[dbo].[tbl_medbill].[Incident_Id], " +
                                                    "[RN_DB].[dbo].[tbl_medbill].[NPF_Form], [RN_DB].[dbo].[tbl_medbill].[NPF_SourceFileName], [RN_DB].[dbo].[tbl_medbill].[NPF_DestinationFileName], " +
                                                    "[RN_DB].[dbo].[tbl_medbill].[IB_Form], [RN_DB].[dbo].[tbl_medbill].[IB_SourceFileName], [RN_DB].[dbo].[tbl_medbill].[IB_DestinationFileName], " +
                                                    "[RN_DB].[dbo].[tbl_medbill].[POP_Form], [RN_DB].[dbo].[tbl_medbill].[POP_SourceFileName], [RN_DB].[dbo].[tbl_medbill].[POP_DestinationFileName], " +
                                                    "[RN_DB].[dbo].[tbl_medbill].[MedRec_Form], [RN_DB].[dbo].[tbl_medbill].[MedRec_SourceFileName], [RN_DB].[dbo].[tbl_medbill].[MedRec_DestinationFileName], " +
                                                    "[RN_DB].[dbo].[tbl_medbill].[Unknown_Form], [RN_DB].[dbo].[tbl_medbill].[Unknown_SourceFileName], [RN_DB].[dbo].[tbl_medbill].[Unknown_DestinationFileName] " +
                                                    "from [RN_DB].[dbo].[tbl_medbill] " +
                                                    "inner join [RN_DB].[dbo].[tbl_illness] on [RN_DB].[dbo].[tbl_medbill].[Illness_Id] = [RN_DB].[dbo].[tbl_illness].[Illness_Id] " +
                                                    "inner join [RN_DB].[dbo].[tbl_incident] on [RN_DB].[dbo].[tbl_medbill].[Incident_Id] = [RN_DB].[dbo].[tbl_incident].[Incident_id] " +
                                                    "inner join [SalesForce].[dbo].[account] on [RN_DB].[dbo].[tbl_medbill].[MedicalProvider_Id] = [SalesForce].[dbo].[account].[Id] " +
                                                    "where [RN_DB].[dbo].[tbl_medbill].[BillNo] = @MedBillNo and " +
                                                    "[RN_DB].[dbo].[tbl_medbill].[Case_Id] = @CaseName and " +
                                                    "[RN_DB].[dbo].[tbl_medbill].[Contact_Id] = @IndividualId and" +
                                                    "[RN_DB].[dbo].[tbl_medbill].[IsDeleted] = 0";

                SqlCommand cmdQueryForMedBillEdit = new SqlCommand(strSqlQueryForMedBillEdit, connRN4);
                cmdQueryForMedBillEdit.CommandType = CommandType.Text;

                cmdQueryForMedBillEdit.Parameters.AddWithValue("@MedBillNo", MedBillNo);
                cmdQueryForMedBillEdit.Parameters.AddWithValue("@CaseName", CaseNameInMedBill);
                cmdQueryForMedBillEdit.Parameters.AddWithValue("@IndividualId", IndividualIdInMedBill);

                if (connRN4.State != ConnectionState.Closed)
                {
                    connRN4.Close();
                    connRN4.Open();
                }
                else if (connRN4.State == ConnectionState.Closed) connRN4.Open();

                SqlDataReader rdrMedBillEdit = cmdQueryForMedBillEdit.ExecuteReader();
                if (rdrMedBillEdit.HasRows)
                {
                    rdrMedBillEdit.Read();

                    if (!rdrMedBillEdit.IsDBNull(0)) txtMedBill_CaseNo.Text = rdrMedBillEdit.GetString(0).Trim();
                    if (!rdrMedBillEdit.IsDBNull(1))
                    {
                        Illness.IllnessNo = rdrMedBillEdit.GetString(1).Trim();
                        txtMedBill_Illness.Text = rdrMedBillEdit.GetString(1).Trim();
                    }
                    if (!rdrMedBillEdit.IsDBNull(2))
                    {
                        Incident.IncidentNo = rdrMedBillEdit.GetString(2).Trim();
                        txtMedBill_Incident.Text = rdrMedBillEdit.GetString(2).Trim();
                    }

                    if (!rdrMedBillEdit.IsDBNull(3)) txtMedBillNo.Text = rdrMedBillEdit.GetString(3).Trim();

                    if (!rdrMedBillEdit.IsDBNull(4))
                    {
                        comboMedBillType.Items.Clear();
                        for (int i = 1; i <= dicMedBillTypes.Count; i++)
                        {
                            comboMedBillType.Items.Add(dicMedBillTypes[i]);
                        }
                        comboMedBillType.SelectedIndex = rdrMedBillEdit.GetInt16(4) - 1;
                    }

                    if (!rdrMedBillEdit.IsDBNull(5))
                    {
                        if (dicMedBillStatus.Count > 0)
                        {
                            comboMedBillStatus.Items.Clear();
                            for (int i = 0; i < dicMedBillStatus.Count; i++)
                            {
                                comboMedBillStatus.Items.Add(dicMedBillStatus[i]);
                            }
                            comboMedBillStatus.SelectedIndex = rdrMedBillEdit.GetInt16(5);
                        }
                    }
                    if (!rdrMedBillEdit.IsDBNull(6))
                    {
                        if (rdrMedBillEdit.GetBoolean(6) == true) cbMedBillClosed.SelectedIndex = 1;
                        else cbMedBillClosed.SelectedIndex = 0;
                    }
                    else cbMedBillClosed.SelectedIndex = 0;

                    if (!rdrMedBillEdit.IsDBNull(7))
                    {
                        txtMedBillAmount.Text = rdrMedBillEdit.GetDecimal(7).ToString("C");
                        txtBalance.Text = rdrMedBillEdit.GetDecimal(7).ToString("C");
                    }
                    if (!rdrMedBillEdit.IsDBNull(8)) txtMedicalProvider.Text = rdrMedBillEdit.GetString(8).Trim();
                    if (!rdrMedBillEdit.IsDBNull(9)) txtPrescriptionName.Text = rdrMedBillEdit.GetString(9).Trim();
                    if (!rdrMedBillEdit.IsDBNull(10)) txtNumberOfMedication.Text = rdrMedBillEdit.GetString(10).Trim();
                    if (!rdrMedBillEdit.IsDBNull(11)) txtPrescriptionDescription.Text = rdrMedBillEdit.GetString(11).Trim();
                    if (!rdrMedBillEdit.IsDBNull(12)) txtNumPhysicalTherapy.Text = rdrMedBillEdit.GetInt16(12).ToString();
                    if (!rdrMedBillEdit.IsDBNull(13))
                    {
                        int nPatientType = rdrMedBillEdit.GetInt16(13);

                        if (nPatientType == 0) rbOutpatient.Checked = true;
                        else if (nPatientType == 1) rbInpatient.Checked = true;
                    }
                    // Bill date
                    if (!rdrMedBillEdit.IsDBNull(14))
                    {
                        dtpBillDate.Text = rdrMedBillEdit.GetDateTime(14).ToString("MM/dd/yyyy");
                    }
                    else
                    {
                        dtpBillDate.Format = DateTimePickerFormat.Custom;
                        dtpBillDate.CustomFormat = " ";
                    }

                    // Due date
                    if (!rdrMedBillEdit.IsDBNull(15))
                    {
                        dtpDueDate.Text = rdrMedBillEdit.GetDateTime(15).ToString("MM/dd/yyyy");
                    }
                    else
                    {
                        dtpDueDate.Format = DateTimePickerFormat.Custom;
                        dtpDueDate.CustomFormat = " ";
                    }

                    if (!rdrMedBillEdit.IsDBNull(16)) txtMedBillAccountNoAtProvider.Text = rdrMedBillEdit.GetString(16);
                    if (!rdrMedBillEdit.IsDBNull(17)) txtMedProviderPhoneNo.Text = rdrMedBillEdit.GetString(17);
                    if (!rdrMedBillEdit.IsDBNull(18)) txtProviderContactPerson.Text = rdrMedBillEdit.GetString(18);

                    if (!rdrMedBillEdit.IsDBNull(19))
                    {
                        if (comboMedBillType.SelectedIndex == 0) txtMedBillNote.Text = rdrMedBillEdit.GetString(19);
                        if (comboMedBillType.SelectedIndex == 1) txtPrescriptionNote.Text = rdrMedBillEdit.GetString(19);
                        if (comboMedBillType.SelectedIndex == 2) txtPhysicalTherapyRxNote.Text = rdrMedBillEdit.GetString(19);
                    }

                    if (!rdrMedBillEdit.IsDBNull(20))
                    {
                        ICD10Code = rdrMedBillEdit.GetString(20).Trim();
                        Illness.ICD10Code = ICD10Code;
                        //txtMedBill_Illness.Text = ICD10Code;
                    }

                    if ((comboMedBillType.SelectedIndex == 0) && (!rdrMedBillEdit.IsDBNull(21)))
                    {
                        comboPendingReason.SelectedIndex = rdrMedBillEdit.GetInt32(21);
                    }

                    if ((comboMedBillType.SelectedIndex == 0) && (!rdrMedBillEdit.IsDBNull(22)))
                    {
                        comboIneligibleReason.SelectedIndex = rdrMedBillEdit.GetInt32(22);
                    }

                    // Reset fields

                    if (comboMedBillType.SelectedIndex == 0)       // Medical Bill Type - Medical Bill
                    {
                        txtPrescriptionName.Text = String.Empty;
                        txtPrescriptionDescription.Text = String.Empty;
                        txtPrescriptionNote.Text = String.Empty;
                        txtNumberOfMedication.Text = String.Empty;

                        txtNumPhysicalTherapy.Text = String.Empty;
                        txtPhysicalTherapyRxNote.Text = String.Empty;
                    }
                    else if (comboMedBillType.SelectedIndex == 1)       // Medical Bill Type - Prescription
                    {
                        txtNumPhysicalTherapy.Text = String.Empty;
                        txtPhysicalTherapyRxNote.Text = String.Empty;

                        rbInpatient.Checked = false;
                        rbOutpatient.Checked = false;

                        comboPendingReason.SelectedIndex = 0;
                        comboIneligibleReason.SelectedIndex = 0;

                        txtMedBillNote.Text = String.Empty;
                    }
                    else if (comboMedBillType.SelectedIndex == 2)       // Medical Bill Type - Physical Therapy
                    {
                        txtPrescriptionName.Text = String.Empty;
                        txtPrescriptionDescription.Text = String.Empty;
                        txtPrescriptionNote.Text = String.Empty;
                        txtNumberOfMedication.Text = String.Empty;

                        rbInpatient.Checked = false;
                        rbOutpatient.Checked = false;

                        comboPendingReason.SelectedIndex = 0;
                        comboIneligibleReason.SelectedIndex = 0;

                        txtMedBillNote.Text = String.Empty;
                    }

                    if (!rdrMedBillEdit.IsDBNull(23)) txtMedBillAccountNoAtProvider.Text = rdrMedBillEdit.GetString(23);
                    if (!rdrMedBillEdit.IsDBNull(24)) txtMedProviderPhoneNo.Text = rdrMedBillEdit.GetString(24);
                    if (!rdrMedBillEdit.IsDBNull(25)) txtProviderContactPerson.Text = rdrMedBillEdit.GetString(25);

                    if (!rdrMedBillEdit.IsDBNull(26))
                    {
                        dtpProposalLetterSentDate.Value = rdrMedBillEdit.GetDateTime(26);
                        dtpProposalLetterSentDate.Format = DateTimePickerFormat.Short;
                    }
                    if (!rdrMedBillEdit.IsDBNull(27))
                    {
                        dtpHippaSentDate.Value = rdrMedBillEdit.GetDateTime(27);
                        dtpHippaSentDate.Format = DateTimePickerFormat.Short;
                    }
                    if (!rdrMedBillEdit.IsDBNull(28))
                    {
                        dtpMedicalRecordDate.Value = rdrMedBillEdit.GetDateTime(28);
                        dtpMedicalRecordDate.Format = DateTimePickerFormat.Short;
                    }

                    if (!rdrMedBillEdit.IsDBNull(29)) Illness.IllnessId = rdrMedBillEdit.GetString(29);
                    else Illness.IllnessId = String.Empty;

                    if (!rdrMedBillEdit.IsDBNull(30)) Incident.IncidentId = rdrMedBillEdit.GetString(30);
                    else Incident.IncidentId = String.Empty;

                    if (!rdrMedBillEdit.IsDBNull(31)) chkNPFMedBill.Checked = rdrMedBillEdit.GetBoolean(31);
                    else chkNPFMedBill.Checked = false;

                    if (!rdrMedBillEdit.IsDBNull(32))
                    {
                        strNPFSourceFilePathMedBill = rdrMedBillEdit.GetString(32);
                        strNPFormFileNameMedBill = Path.GetFileName(strNPFSourceFilePathMedBill);
                        txtNPFMedBillFileName.Text = strNPFormFileNameMedBill;
                    }
                    else txtNPFMedBillFileName.Text = String.Empty;

                    if (!rdrMedBillEdit.IsDBNull(33)) strNPFDestinationFilePathMedBill = rdrMedBillEdit.GetString(33);
                    else strNPFDestinationFilePathMedBill = String.Empty;

                    if (!rdrMedBillEdit.IsDBNull(34)) chkIBMedBill.Checked = rdrMedBillEdit.GetBoolean(34);
                    else chkIBMedBill.Checked = false;

                    if (!rdrMedBillEdit.IsDBNull(35))
                    {
                        strIBSourceFilePathMedBill = rdrMedBillEdit.GetString(35);
                        strIBFileNameMedBill = Path.GetFileName(strIBSourceFilePathMedBill);
                        txtIBMedBillFileName.Text = strIBFileNameMedBill;

                    }
                    else txtIBMedBillFileName.Text = String.Empty;

                    if (!rdrMedBillEdit.IsDBNull(36)) strIBDestinationFilePathMedBill = rdrMedBillEdit.GetString(36);
                    else strIBDestinationFilePathMedBill = String.Empty;

                    if (!rdrMedBillEdit.IsDBNull(37)) chkPoPMedBill.Checked = rdrMedBillEdit.GetBoolean(37);
                    else chkPoPMedBill.Checked = false;

                    if (!rdrMedBillEdit.IsDBNull(38))
                    {
                        strPoPSourceFilePathMedBill = rdrMedBillEdit.GetString(38);
                        strPoPFileNameMedBill = Path.GetFileName(strPoPSourceFilePathMedBill);
                        txtPoPMedBillFileName.Text = strPoPFileNameMedBill;
                    }
                    else txtPoPMedBillFileName.Text = String.Empty;

                    if (!rdrMedBillEdit.IsDBNull(39)) strPoPDestinationFilePathMedBill = rdrMedBillEdit.GetString(39);
                    else strPoPDestinationFilePathMedBill = String.Empty;

                    if (!rdrMedBillEdit.IsDBNull(40)) chkMedRecMedBill.Checked = rdrMedBillEdit.GetBoolean(40);
                    else chkMedRecMedBill.Checked = false;

                    if (!rdrMedBillEdit.IsDBNull(41))
                    {
                        strMedRecSourceFilePathMedBill = rdrMedBillEdit.GetString(41);
                        strMedRecFileNameMedBill = Path.GetFileName(strMedRecSourceFilePathMedBill);
                        txtMedRecMedBillFileName.Text = strMedRecFileNameMedBill;
                    }
                    else txtMedRecMedBillFileName.Text = String.Empty;

                    if (!rdrMedBillEdit.IsDBNull(42)) strMedRecDestinationFilePathMedBill = rdrMedBillEdit.GetString(42);
                    else strMedRecDestinationFilePathMedBill = String.Empty;

                    if (!rdrMedBillEdit.IsDBNull(43)) chkOtherDocMedBill.Checked = rdrMedBillEdit.GetBoolean(43);
                    else chkOtherDocMedBill.Checked = false;

                    if (!rdrMedBillEdit.IsDBNull(44))
                    {
                        strOtherDocSourceFilePathMedBill = rdrMedBillEdit.GetString(44);
                        strOtherDocFileNameMedBill = Path.GetFileName(strOtherDocSourceFilePathMedBill);
                        txtOtherDocMedBillFileName.Text = strOtherDocFileNameMedBill;
                    }

                    if (!rdrMedBillEdit.IsDBNull(45)) strOtherDocDestinationFilePathMedBill = rdrMedBillEdit.GetString(45);
                    else strOtherDocDestinationFilePathMedBill = String.Empty;

                }
                rdrMedBillEdit.Close();
                if (connRN4.State != ConnectionState.Closed) connRN4.Close();





                //if (connRN.State == ConnectionState.Closed) connRN.Open();
                //if (connRN.State != ConnectionState.Closed)
                //{
                //    connRN.Close();
                //    connRN.Open();
                //}
                //else if (connRN.State == ConnectionState.Closed) connRN.Open();
                //SqlDataReader rdrMedBillEdit = cmdQueryForMedBillEdit.ExecuteReader();
                //if (rdrMedBillEdit.HasRows)
                //{
                //    rdrMedBillEdit.Read();

                //    if (!rdrMedBillEdit.IsDBNull(0)) txtMedBill_CaseNo.Text = rdrMedBillEdit.GetString(0).Trim();
                //    if (!rdrMedBillEdit.IsDBNull(1)) Illness.IllnessId = rdrMedBillEdit.GetString(1).Trim();
                //    if (!rdrMedBillEdit.IsDBNull(2)) txtMedBill_Incident.Text = rdrMedBillEdit.GetString(2).Trim();

                //    if (!rdrMedBillEdit.IsDBNull(3)) txtMedBillNo.Text = rdrMedBillEdit.GetString(3).Trim();
                //    if (!rdrMedBillEdit.IsDBNull(4))
                //    {
                //        // populate medical bill types
                //        comboMedBillType.Items.Clear();
                //        for (int i = 1; i <= dicMedBillTypes.Count; i++)
                //        {
                //            comboMedBillType.Items.Add(dicMedBillTypes[i]);
                //        }
                //        comboMedBillType.SelectedIndex = rdrMedBillEdit.GetInt16(4) - 1;
                //    }

                //    if (!rdrMedBillEdit.IsDBNull(5))
                //    {
                //        comboMedBillStatus.Items.Clear();
                //        if (dicMedBillStatus.Count > 0)
                //        {
                //            for (int i = 0; i < dicMedBillStatus.Count; i++)
                //            {
                //                comboMedBillStatus.Items.Add(dicMedBillStatus[i]);
                //            }
                //            //comboMedBillStatus.SelectedIndex = 0;
                //            comboMedBillStatus.SelectedIndex = rdrMedBillEdit.GetInt16(5);
                //        }
                //    }

                //    if (!rdrMedBillEdit.IsDBNull(6))
                //    {
                //        if (rdrMedBillEdit.GetBoolean(6) == true) cbMedBillClosed.SelectedIndex = 1;
                //        else cbMedBillClosed.SelectedIndex = 0;
                //    }
                //    else cbMedBillClosed.SelectedIndex = 0;

                //    if (!rdrMedBillEdit.IsDBNull(7))
                //    {
                //        txtMedBillAmount.Text = rdrMedBillEdit.GetDecimal(7).ToString("C");
                //        txtBalance.Text = rdrMedBillEdit.GetDecimal(7).ToString("C");
                //    }
                //    if (!rdrMedBillEdit.IsDBNull(8)) txtMedicalProvider.Text = rdrMedBillEdit.GetString(8).Trim();
                //    if (!rdrMedBillEdit.IsDBNull(9)) txtPrescriptionName.Text = rdrMedBillEdit.GetString(9).Trim();
                //    if (!rdrMedBillEdit.IsDBNull(10)) txtNumberOfMedication.Text = rdrMedBillEdit.GetString(10).Trim();
                //    if (!rdrMedBillEdit.IsDBNull(11)) txtPrescriptionDescription.Text = rdrMedBillEdit.GetString(11).Trim();
                //    if (!rdrMedBillEdit.IsDBNull(12)) txtNumPhysicalTherapy.Text = rdrMedBillEdit.GetInt16(12).ToString();
                //    if (!rdrMedBillEdit.IsDBNull(13))
                //    {
                //        int nPatientType = rdrMedBillEdit.GetInt16(13);

                //        if (nPatientType == 0) rbOutpatient.Checked = true;
                //        else if (nPatientType == 1) rbInpatient.Checked = true;
                //    }
                //    // Bill date
                //    if (!rdrMedBillEdit.IsDBNull(14))
                //    {
                //        dtpBillDate.Text = rdrMedBillEdit.GetDateTime(14).ToString("MM/dd/yyyy");
                //    }
                //    else
                //    {
                //        dtpBillDate.Format = DateTimePickerFormat.Custom;
                //        dtpBillDate.CustomFormat = " ";
                //    }

                //    // Due date
                //    if (!rdrMedBillEdit.IsDBNull(15))
                //    {
                //        dtpDueDate.Text = rdrMedBillEdit.GetDateTime(15).ToString("MM/dd/yyyy");
                //    }
                //    else
                //    {
                //        dtpDueDate.Format = DateTimePickerFormat.Custom;
                //        dtpDueDate.CustomFormat = " ";
                //    }

                //    if (!rdrMedBillEdit.IsDBNull(16)) txtMedBillAccountNoAtProvider.Text = rdrMedBillEdit.GetString(16);
                //    if (!rdrMedBillEdit.IsDBNull(17)) txtMedProviderPhoneNo.Text = rdrMedBillEdit.GetString(17);
                //    if (!rdrMedBillEdit.IsDBNull(18)) txtProviderContactPerson.Text = rdrMedBillEdit.GetString(18);

                //    if (!rdrMedBillEdit.IsDBNull(19))
                //    {
                //        if (comboMedBillType.SelectedItem.ToString() == "Medical Bill") txtMedBillNote.Text = rdrMedBillEdit.GetString(19);
                //        if (comboMedBillType.SelectedItem.ToString() == "Prescription") txtPrescriptionNote.Text = rdrMedBillEdit.GetString(19);
                //        if (comboMedBillType.SelectedItem.ToString() == "Physical Therapy") txtPhysicalTherapyRxNote.Text = rdrMedBillEdit.GetString(19);
                //    }

                //    if (!rdrMedBillEdit.IsDBNull(20))
                //    {
                //        ICD10Code = rdrMedBillEdit.GetString(20).Trim();
                //        Illness.ICD10Code = ICD10Code;
                //        txtMedBill_Illness.Text = ICD10Code;
                //    }

                //    if ((comboMedBillType.SelectedIndex == 0)&&(!rdrMedBillEdit.IsDBNull(21)))
                //    {
                //        comboPendingReason.SelectedIndex = rdrMedBillEdit.GetInt32(21);
                //    }

                //    if ((comboMedBillType.SelectedIndex == 0)&&(!rdrMedBillEdit.IsDBNull(22)))
                //    {
                //        comboIneligibleReason.SelectedIndex = rdrMedBillEdit.GetInt32(22);
                //    }

                //    //comboMedBillType.SelectedIndex = rdrMedBillEdit.GetInt16(4) - 1;

                //    if (comboMedBillType.SelectedIndex == 0)       // Medical Bill Type - Medical Bill
                //    {
                //        txtPrescriptionName.Text = String.Empty;
                //        txtPrescriptionDescription.Text = String.Empty;
                //        txtPrescriptionNote.Text = String.Empty;
                //        txtNumberOfMedication.Text = String.Empty;

                //        txtNumPhysicalTherapy.Text = String.Empty;
                //        txtPhysicalTherapyRxNote.Text = String.Empty;
                //    }
                //    else if (comboMedBillType.SelectedIndex == 1)       // Medical Bill Type - Prescription
                //    {
                //        txtNumPhysicalTherapy.Text = String.Empty;
                //        txtPhysicalTherapyRxNote.Text = String.Empty;

                //        rbInpatient.Checked = false;
                //        rbOutpatient.Checked = false;

                //        comboPendingReason.SelectedIndex = 0;
                //        comboIneligibleReason.SelectedIndex = 0;

                //        txtMedBillNote.Text = String.Empty;
                //    }
                //    else if (comboMedBillType.SelectedIndex == 2)       // Medical Bill Type - Physical Therapy
                //    {
                //        txtPrescriptionName.Text = String.Empty;
                //        txtPrescriptionDescription.Text = String.Empty;
                //        txtPrescriptionNote.Text = String.Empty;
                //        txtNumberOfMedication.Text = String.Empty;

                //        rbInpatient.Checked = false;
                //        rbOutpatient.Checked = false;

                //        comboPendingReason.SelectedIndex = 0;
                //        comboIneligibleReason.SelectedIndex = 0;

                //        txtMedBillNote.Text = String.Empty;
                //    }

                //    if (!rdrMedBillEdit.IsDBNull(23)) txtMedBillAccountNoAtProvider.Text = rdrMedBillEdit.GetString(23);
                //    if (!rdrMedBillEdit.IsDBNull(24)) txtMedProviderPhoneNo.Text = rdrMedBillEdit.GetString(24);
                //    if (!rdrMedBillEdit.IsDBNull(25)) txtProviderContactPerson.Text = rdrMedBillEdit.GetString(25);

                //    if (!rdrMedBillEdit.IsDBNull(26))
                //    {
                //        dtpProposalLetterSentDate.Value = rdrMedBillEdit.GetDateTime(26);
                //        dtpProposalLetterSentDate.Format = DateTimePickerFormat.Short;
                //    }
                //    if (!rdrMedBillEdit.IsDBNull(27))
                //    {
                //        dtpHippaSentDate.Value = rdrMedBillEdit.GetDateTime(27);
                //        dtpHippaSentDate.Format = DateTimePickerFormat.Short;
                //    }
                //    if (!rdrMedBillEdit.IsDBNull(28))
                //    {
                //        dtpMedicalRecordDate.Value = rdrMedBillEdit.GetDateTime(28);
                //        dtpMedicalRecordDate.Format = DateTimePickerFormat.Short;
                //    }

                //}

                //if (connRN.State != ConnectionState.Closed) connRN.Close();



                //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                // Calculate the personal responsibility balance
                //String IncidentNo = txtMedBill_Incident.Text.Trim();
                //String IndividualId = txtCaseIndividualID.Text.Trim();

                //String strSqlQueryForIncidentChange = "select [cdc].[dbo_tbl_incident_CT].[Program_id], [dbo].[tbl_program].[ProgramName] from [cdc].[dbo_tbl_incident_CT] " +
                //                                      "inner join [dbo].[tbl_program] on [cdc].[dbo_tbl_incident_CT].[Program_id] = [dbo].[tbl_program].[Program_Id] " +
                //                                      "where [cdc].[dbo_tbl_incident_CT].[Incident_id] = @IncidentId and [cdc].[dbo_tbl_incident_CT].[Individual_id] = @IndividualId and " +
                //                                      "([cdc].[dbo_tbl_incident_CT].[__$operation] = 2 or [cdc].[dbo_tbl_incident_CT].[__$operation] = 3 or " +
                //                                      "[cdc].[dbo_tbl_incident_CT].[__$operation] = 4) " +      // capture incident program for insert, update
                //                                      "order by [cdc].[dbo_tbl_incident_CT].[Program_id]";

                //SqlCommand cmdQueryForIncidentChange = new SqlCommand(strSqlQueryForIncidentChange, connRN);
                //cmdQueryForIncidentChange.CommandType = CommandType.Text;

                //cmdQueryForIncidentChange.Parameters.AddWithValue("@IncidentId", IncidentNo);
                //cmdQueryForIncidentChange.Parameters.AddWithValue("@IndividualId", IndividualId);

                //connRN.Open();
                //SqlDataReader rdrIncidentChange = cmdQueryForIncidentChange.ExecuteReader();
                //if (rdrIncidentChange.HasRows)
                //{
                //    while (rdrIncidentChange.Read())
                //    {
                //        //lstIncidentProgramInfo.Add(new IncidentProgramInfo { IncidentProgramId = rdrIncidentChange.GetInt16(0), IncidentProgramName = rdrIncidentChange.GetString(1).Trim() });
                //        IncidentProgramInfo incidentProgram = new IncidentProgramInfo(rdrIncidentChange.GetInt16(0), rdrIncidentChange.GetString(1).Trim());
                //        lstIncidentProgramInfo.Add(incidentProgram);
                //    }
                //}
                //connRN.Close();

                //Boolean bBronze = false;
                //Boolean bSilver = false;
                //Boolean bGold = false;
                //Boolean bGoldPlus = false;
                //Boolean bGoldMed1 = false;
                //Boolean bGoldMed2 = false;

                //foreach (IncidentProgramInfo incidentInfo in lstIncidentProgramInfo)
                //{
                //    if (incidentInfo.IncidentProgramId == 3)
                //    {
                //        incidentInfo.bPersonalResponsibilityProgram = true;
                //        bBronze = true;
                //        break;
                //    }
                //}

                //foreach (IncidentProgramInfo incidentInfo in lstIncidentProgramInfo)
                //{
                //    if ((incidentInfo.IncidentProgramId == 2) && (bBronze == false))
                //    {
                //        incidentInfo.bPersonalResponsibilityProgram = true;
                //        bSilver = true;
                //        break;
                //    }
                //}

                //foreach (IncidentProgramInfo incidentInfo in lstIncidentProgramInfo)
                //{
                //    if ((incidentInfo.IncidentProgramId == 1) && (bBronze == false) && (bSilver == false))
                //    {
                //        incidentInfo.bPersonalResponsibilityProgram = true;
                //        break;
                //    }
                //}

                //foreach (IncidentProgramInfo incidentInfo in lstIncidentProgramInfo)
                //{
                //    if ((incidentInfo.IncidentProgramId == 0) && (bBronze == false) && (bSilver == false) && (bGold == false))
                //    {
                //        incidentInfo.bPersonalResponsibilityProgram = true;
                //        break;
                //    }
                //}

                //foreach (IncidentProgramInfo incidentInfo in lstIncidentProgramInfo)
                //{
                //    if ((incidentInfo.IncidentProgramId == 4) && (bBronze == false) && (bSilver == false) && (bGold == false) && (bGoldPlus == false))
                //    {
                //        incidentInfo.bPersonalResponsibilityProgram = true;
                //        break;
                //    }
                //}

                //foreach (IncidentProgramInfo incidentInfo in lstIncidentProgramInfo)
                //{
                //    if ((incidentInfo.IncidentProgramId == 5) && (bBronze == false) && (bSilver == false) && (bGold == false) && (bGoldPlus == false) && (bGoldMed1 == false))
                //    {
                //        incidentInfo.bPersonalResponsibilityProgram = true;
                //        break;
                //    }
                //}

                //foreach (IncidentProgramInfo incidentInfo in lstIncidentProgramInfo)
                //{
                //    if (incidentInfo.bPersonalResponsibilityProgram == true)
                //        PersonalResponsibilityAmountInMedBill = incidentInfo.PersonalResponsibilityAmount;
                //}

                ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

                String IncidentNo = txtMedBill_Incident.Text.Trim();
                String IndividualIdMedBill = txtCaseIndividualID.Text.Trim();

                String strSqlQueryForIncident = "select [dbo].[tbl_incident].[Program_id], [dbo].[tbl_program].[ProgramName], [dbo].[tbl_incident].[IsDeleted] " +
                                "from [dbo].[tbl_incident] " +
                                "inner join [dbo].[tbl_program] on [dbo].[tbl_incident].[Program_id] = [dbo].[tbl_program].[Program_Id] " +
                                "where [dbo].[tbl_incident].[Individual_id] = @IndividualId and " +
                                "[dbo].[tbl_incident].[IncidentNo] = @IncidentNo " +
                                "order by [dbo].[tbl_incident].[Program_id]";

                SqlCommand cmdQueryForIncident = new SqlCommand(strSqlQueryForIncident, connRN4);
                cmdQueryForIncident.CommandType = CommandType.Text;

                cmdQueryForIncident.Parameters.AddWithValue("@IndividualId", IndividualIdMedBill);
                cmdQueryForIncident.Parameters.AddWithValue("@IncidentNo", IncidentNo);

                if (connRN4.State != ConnectionState.Closed)
                {
                    connRN4.Close();
                    connRN4.Open();
                }
                else if (connRN4.State == ConnectionState.Closed) connRN4.Open();

                SqlDataReader rdrIncident = cmdQueryForIncident.ExecuteReader();
                lstIncidentProgramInfo.Clear();
                if (rdrIncident.HasRows)
                {
                    while (rdrIncident.Read())
                    {
                        if (!rdrIncident.IsDBNull(0) && !rdrIncident.IsDBNull(1))
                        {
                            IncidentProgramInfo incidentProgram = new IncidentProgramInfo(rdrIncident.GetBoolean(2), rdrIncident.GetInt16(0), rdrIncident.GetString(1).Trim());
                            lstIncidentProgramInfo.Add(incidentProgram);
                        }
                    }
                }
                rdrIncident.Close();
                if (connRN4.State == ConnectionState.Open) connRN4.Close();

                String strSqlQueryForIncidentChange = "select [dbo].[tbl_incident_history].[Program_id], [dbo].[tbl_program].[ProgramName], [dbo].[tbl_incident_history].[IsDeleted] " +
                                        "from [dbo].[tbl_incident_history] " +
                                        "inner join [dbo].[tbl_program] on [dbo].[tbl_incident_history].[Program_id] = [dbo].[tbl_program].[Program_Id] " +
                                        "where ([dbo].[tbl_incident_history].[Operation] = 2 or " +
                                        "[dbo].[tbl_incident_history].[Operation] = 3 or " +
                                        "[dbo].[tbl_incident_history].[Operation] = 4) and " +
                                        "[dbo].[tbl_incident_history].[Individual_id] = @IndividualId and" +
                                        "[dbo].[tbl_incident_history].[IncidentNo] = @IncidentNo " +
                                        "order by [dbo].[tbl_incident_history].[Program_id]";

                SqlCommand cmdQueryForIncidentChange = new SqlCommand(strSqlQueryForIncidentChange, connRN4);
                cmdQueryForIncidentChange.CommandType = CommandType.Text;

                cmdQueryForIncidentChange.Parameters.AddWithValue("@IndividualId", IndividualIdMedBill);
                cmdQueryForIncidentChange.Parameters.AddWithValue("@IncidentNo", IncidentNo);

                if (connRN4.State != ConnectionState.Closed)
                {
                    connRN4.Close();
                    connRN4.Open();
                }
                else if (connRN4.State == ConnectionState.Closed) connRN4.Open();
                SqlDataReader rdrIncidentChange = cmdQueryForIncidentChange.ExecuteReader();
                //lstIncidentProgramInfo.Clear();
                if (rdrIncidentChange.HasRows)
                {
                    while (rdrIncidentChange.Read())
                    {
                        if (!rdrIncidentChange.IsDBNull(0) && !rdrIncidentChange.IsDBNull(1))
                        {
                            IncidentProgramInfo incidentProgram = new IncidentProgramInfo(rdrIncidentChange.GetBoolean(2), rdrIncidentChange.GetInt16(0), rdrIncidentChange.GetString(1).Trim());
                            lstIncidentProgramInfo.Add(incidentProgram);
                        }
                    }
                }
                rdrIncidentChange.Close();
                if (connRN4.State == ConnectionState.Open) connRN4.Close();

                foreach (IncidentProgramInfo incdInfo in lstIncidentProgramInfo)
                {
                    if (incdInfo.bIsDeleted == true)
                    {
                        MessageBox.Show("The Incident has been deleted. Personal Responsibility cannot be calculated.", "Error");
                        lstIncidentProgramInfo.Clear();
                    }
                }

                Boolean bBronze = false;
                Boolean bSilver = false;
                Boolean bGold = false;
                Boolean bGoldPlus = false;
                Boolean bGoldMed1 = false;
                Boolean bGoldMed2 = false;

                if (lstIncidentProgramInfo.Count > 0)
                {
                    foreach (IncidentProgramInfo incidentInfo in lstIncidentProgramInfo)
                    {
                        if ((incidentInfo.IncidentProgramId == 3) &&
                            (incidentInfo.bIsDeleted == false))
                        {
                            incidentInfo.bPersonalResponsibilityProgram = true;
                            bBronze = true;
                            break;
                        }
                    }

                    foreach (IncidentProgramInfo incidentInfo in lstIncidentProgramInfo)
                    {
                        if ((incidentInfo.IncidentProgramId == 2) &&
                            (bBronze == false) &&
                            (incidentInfo.bIsDeleted == false))
                        {
                            incidentInfo.bPersonalResponsibilityProgram = true;
                            bSilver = true;
                            break;
                        }
                    }

                    foreach (IncidentProgramInfo incidentInfo in lstIncidentProgramInfo)
                    {
                        if ((incidentInfo.IncidentProgramId == 1) &&
                            (bBronze == false) &&
                            (bSilver == false) &&
                            (incidentInfo.bIsDeleted == false))
                        {
                            incidentInfo.bPersonalResponsibilityProgram = true;
                            break;
                        }
                    }

                    foreach (IncidentProgramInfo incidentInfo in lstIncidentProgramInfo)
                    {
                        if ((incidentInfo.IncidentProgramId == 0) &&
                            (bBronze == false) &&
                            (bSilver == false) &&
                            (bGold == false) &&
                            (incidentInfo.bIsDeleted == false))
                        {
                            incidentInfo.bPersonalResponsibilityProgram = true;
                            break;
                        }
                    }

                    foreach (IncidentProgramInfo incidentInfo in lstIncidentProgramInfo)
                    {
                        if ((incidentInfo.IncidentProgramId == 4) &&
                            (bBronze == false) &&
                            (bSilver == false) &&
                            (bGold == false) &&
                            (bGoldPlus == false) &&
                            (incidentInfo.bIsDeleted == false))
                        {
                            incidentInfo.bPersonalResponsibilityProgram = true;
                            break;
                        }
                    }

                    foreach (IncidentProgramInfo incidentInfo in lstIncidentProgramInfo)
                    {
                        if ((incidentInfo.IncidentProgramId == 5) &&
                            (bBronze == false) &&
                            (bSilver == false) &&
                            (bGold == false) &&
                            (bGoldPlus == false) &&
                            (bGoldMed1 == false) &&
                            (incidentInfo.bIsDeleted == false))
                        {
                            incidentInfo.bPersonalResponsibilityProgram = true;
                            break;
                        }
                    }
                }

                foreach (IncidentProgramInfo incidentInfo in lstIncidentProgramInfo)
                {
                    if (incidentInfo.bPersonalResponsibilityProgram == true)
                        PersonalResponsibilityAmountInMedBill = incidentInfo.PersonalResponsibilityAmount;
                }

                ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                // Get disease name
                if (ICD10Code != String.Empty)
                {
                    String strSqlQueryForDiseaseName = "select [dbo].[ICD10 Code].[Name] from [dbo].[ICD10 Code] where [dbo].[ICD10 Code].[ICD10_CODE__C] = @ICD10Code";

                    SqlCommand cmdQueryForDiseaseName = new SqlCommand(strSqlQueryForDiseaseName, connSalesforce3);
                    cmdQueryForDiseaseName.CommandType = CommandType.Text;

                    cmdQueryForDiseaseName.Parameters.AddWithValue("@ICD10Code", ICD10Code);

                    if (connSalesforce3.State == ConnectionState.Open)
                    {
                        connSalesforce3.Close();
                        connSalesforce3.Open();
                    }
                    else if (connSalesforce3.State == ConnectionState.Closed) connSalesforce3.Open();
                    //String DiseaseName = cmdQueryForDiseaseName.ExecuteScalar().ToString();
                    Object objDiseaseName = cmdQueryForDiseaseName.ExecuteScalar();
                    if (connSalesforce3.State != ConnectionState.Closed) connSalesforce3.Close();

                    String DiseaseName = String.Empty;

                    if (objDiseaseName != null) DiseaseName = objDiseaseName.ToString();
                    else
                    {
                        MessageBox.Show("No Disease Name for the ICD 10 Code: " + ICD10Code, "Error", MessageBoxButtons.OK);
                        return;
                    }

                    txtMedBill_ICD10Code.Text = ICD10Code;
                    txtMedBillDiseaseName.Text = DiseaseName;
                }
                else
                {
                    txtMedBill_ICD10Code.Text = String.Empty;
                    txtMedBillDiseaseName.Text = String.Empty;
                }

                // Get documents info
                String strSqlQueryForDocumentsInfo = "select [dbo].[tbl_case].[NPF_Form], [dbo].[tbl_case].[NPF_Receiv_Date], " +
                                                        "[dbo].[tbl_case].[IB_Form], [dbo].[tbl_case].[IB_Receiv_Date], " +
                                                        "[dbo].[tbl_case].[POP_Form], [dbo].[tbl_case].[POP_Receiv_Date], " +
                                                        "[dbo].[tbl_case].[MedRec_Form], [dbo].[tbl_case].[MedRec_Receiv_Date], " +
                                                        "[dbo].[tbl_case].[Unknown_Form], [dbo].[tbl_case].[Unknown_Receiv_Date] " +
                                                        "from [dbo].[tbl_case] where [dbo].[tbl_case].[Case_Name] = @CaseId and " +
                                                        "[dbo].[tbl_case].[Contact_ID] = @IndividualId and" +
                                                        "[dbo].[tbl_case].[IsDeleted] = 0";

                SqlCommand cmdQueryForDocInfo = new SqlCommand(strSqlQueryForDocumentsInfo, connRN4);
                cmdQueryForDocInfo.CommandType = CommandType.Text;

                cmdQueryForDocInfo.Parameters.AddWithValue("@CaseId", CaseNameInMedBill);
                cmdQueryForDocInfo.Parameters.AddWithValue("@IndividualId", IndividualIdInMedBill);

                //if (connRN.State == ConnectionState.Closed) connRN.Open();
                if (connRN4.State != ConnectionState.Closed)
                {
                    connRN4.Close();
                    connRN4.Open();
                }
                else if (connRN4.State == ConnectionState.Closed) connRN4.Open();
                SqlDataReader rdrDocInfo = cmdQueryForDocInfo.ExecuteReader();
                if (rdrDocInfo.HasRows)
                {
                    rdrDocInfo.Read();

                    if (!rdrDocInfo.IsDBNull(0))
                    {
                        if (rdrDocInfo.GetBoolean(0))
                        {
                            chkMedBillNPFReceived.Checked = true;
                            chkMedBillNPFReceived.Enabled = false;
                            dtpMedBillNPF.Text = rdrDocInfo.GetDateTime(1).ToString("MM/dd/yyyy");
                            dtpMedBillNPF.Enabled = false;
                            btnViewNPF.Enabled = true;
                        }
                        else
                        {
                            chkMedBillNPFReceived.Checked = false;
                            chkMedBillNPFReceived.Enabled = false;
                            dtpMedBillNPF.Format = DateTimePickerFormat.Custom;
                            dtpMedBillNPF.CustomFormat = " ";
                            dtpMedBillNPF.Enabled = false;
                            btnViewNPF.Enabled = false;
                        }
                    }
                    if (!rdrDocInfo.IsDBNull(2))
                    {
                        if (rdrDocInfo.GetBoolean(2))
                        {
                            chkMedBill_IBReceived.Checked = true;
                            chkMedBill_IBReceived.Enabled = false;
                            dtpMedBill_IB.Text = rdrDocInfo.GetDateTime(3).ToString("MM/dd/yyyy");
                            dtpMedBill_IB.Enabled = false;
                            btnViewIB.Enabled = true;
                        }
                        else
                        {
                            chkMedBill_IBReceived.Checked = false;
                            chkMedBill_IBReceived.Enabled = false;
                            dtpMedBill_IB.Format = DateTimePickerFormat.Custom;
                            dtpMedBill_IB.CustomFormat = " ";
                            dtpMedBill_IB.Enabled = false;
                            btnViewIB.Enabled = false;
                        }
                    }
                    if (!rdrDocInfo.IsDBNull(4))
                    {
                        if (rdrDocInfo.GetBoolean(4))
                        {
                            chkMedBillPOPReceived.Checked = true;
                            chkMedBillPOPReceived.Enabled = false;
                            dtpMedBillPOP.Text = rdrDocInfo.GetDateTime(5).ToString("MM/dd/yyyy");
                            dtpMedBillPOP.Enabled = false;
                            btnViewPoP.Enabled = true;
                        }
                        else
                        {
                            chkMedBillPOPReceived.Checked = false;
                            chkMedBillPOPReceived.Enabled = false;
                            dtpMedBillPOP.Format = DateTimePickerFormat.Custom;
                            dtpMedBillPOP.CustomFormat = " ";
                            dtpMedBillPOP.Enabled = false;
                            btnViewPoP.Enabled = false;
                        }
                    }
                    if (!rdrDocInfo.IsDBNull(6))
                    {
                        if (rdrDocInfo.GetBoolean(6))
                        {
                            chkMedRecordReceived.Checked = true;
                            chkMedRecordReceived.Enabled = false;
                            dtpMedBillMedRecord.Text = rdrDocInfo.GetDateTime(7).ToString("MM/dd/yyyy");
                            dtpMedBillMedRecord.Enabled = false;
                            btnViewMedRecord.Enabled = true;
                        }
                        else
                        {
                            chkMedRecordReceived.Checked = false;
                            chkMedRecordReceived.Enabled = false;
                            dtpMedBillMedRecord.Format = DateTimePickerFormat.Custom;
                            dtpMedBillMedRecord.CustomFormat = " ";
                            dtpMedBillMedRecord.Enabled = false;
                            btnViewMedRecord.Enabled = false;
                        }
                    }

                    if (!rdrDocInfo.IsDBNull(8))
                    {
                        if (rdrDocInfo.GetBoolean(8))
                        {
                            chkOtherDocReceived.Checked = true;
                            chkOtherDocReceived.Enabled = false;
                            dtpMedBillOtherDoc.Text = rdrDocInfo.GetDateTime(9).ToString("MM/dd/yyyy");
                            dtpMedBillOtherDoc.Enabled = false;
                            btnViewOtherDoc.Enabled = true;
                        }
                        else
                        {
                            chkOtherDocReceived.Checked = false;
                            chkOtherDocReceived.Enabled = false;
                            dtpMedBillOtherDoc.Format = DateTimePickerFormat.Custom;
                            dtpMedBillOtherDoc.CustomFormat = " ";
                            dtpMedBillOtherDoc.Enabled = false;
                            btnViewOtherDoc.Enabled = false;
                        }
                    }

                    strCaseIdSelected = CaseNameInMedBill;
                    strContactIdSelected = IndividualIdInMedBill;
                }
                rdrDocInfo.Close();
                if (connRN4.State != ConnectionState.Closed) connRN4.Close();

                //String strSqlQueryForIllnessId = "select [dbo].[tbl_illness].[Illness_Id] from [dbo].[tbl_illness] where [dbo].[tbl_illness].[ICD_10_Id] = @ICD10Code";

                //SqlCommand cmdQueryForIllnessId = new SqlCommand(strSqlQueryForIllnessId, connRN);
                //cmdQueryForIllnessId.CommandType = CommandType.Text;

                //cmdQueryForIllnessId.Parameters.AddWithValue("@ICD10Code", Illness.ICD10Code);

                //connRN.Open();
                //Illness.IllnessId = cmdQueryForIllnessId.ExecuteScalar().ToString();
                //connRN.Close();


                String strSqlQueryForIncidentProgram = "select [dbo].[tbl_program].[ProgramName] from [dbo].[tbl_program] inner join [dbo].[tbl_incident] " +
                                                        "on [dbo].[tbl_program].[Program_id] = [dbo].[tbl_incident].[Program_id] " +
                                                        "where [dbo].[tbl_incident].[Individual_id] = @IndividualId and [dbo].[tbl_incident].[IncidentNo] = @IncidentNo";

                SqlCommand cmdQueryForIncidentProgram = new SqlCommand(strSqlQueryForIncidentProgram, connRN4);
                cmdQueryForIncidentProgram.CommandType = CommandType.Text;

                cmdQueryForIncidentProgram.Parameters.AddWithValue("@IndividualId", IndividualIdInMedBill);
                cmdQueryForIncidentProgram.Parameters.AddWithValue("@IncidentNo", txtMedBill_Incident.Text.Trim());

                //if (connRN.State == ConnectionState.Closed) connRN.Open();
                if (connRN4.State != ConnectionState.Closed)
                {
                    connRN4.Close();
                    connRN4.Open();
                }
                else if (connRN4.State == ConnectionState.Closed) connRN4.Open();
                //String IncidentProgramName = cmdQueryForIncidentProgram.ExecuteScalar().ToString();
                Object objIncidentProgramName = cmdQueryForIncidentProgram.ExecuteScalar();
                if (connRN4.State != ConnectionState.Closed) connRN4.Close();

                String IncidentProgramName = String.Empty;
                if (objIncidentProgramName != null) IncidentProgramName = objIncidentProgramName.ToString();
                else
                {
                    MessageBox.Show("No Program Name for the Incident No: " + txtMedBill_Incident.Text.Trim(), "Error", MessageBoxButtons.OK);
                    return;
                }

                if (IncidentProgramName != null) txtIncdProgram.Text = IncidentProgramName;

                if (txtIncdProgram.Text.Trim() != txtMemberProgram.Text.Trim())
                {
                    txtIncdProgram.BackColor = Color.Red;
                    txtMemberProgram.BackColor = Color.Red;
                }
                else if (txtIncdProgram.Text.Trim() == txtMemberProgram.Text.Trim())
                {
                    txtIncdProgram.BackColor = Color.White;
                    txtMemberProgram.BackColor = Color.FromKnownColor(KnownColor.Control);
                }


                ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                //String strSqlQueryForMedicalProvider = "select dbo.tbl_MedicalProvider.ID, dbo.tbl_MedicalProvider.Name, dbo.tbl_MedicalProvider.Type from dbo.tbl_MedicalProvider";

                //SqlCommand cmdQueryForMedicalProvider = new SqlCommand(strSqlQueryForMedicalProvider, connRN4);
                //cmdQueryForMedicalProvider.CommandType = CommandType.Text;

                ////if (connRN.State == ConnectionState.Closed) connRN.Open();
                //if (connRN4.State != ConnectionState.Closed)
                //{
                //    connRN4.Close();
                //    connRN4.Open();
                //}
                //else if (connRN4.State == ConnectionState.Closed) connRN4.Open();

                //SqlDataReader rdrMedicalProvider = cmdQueryForMedicalProvider.ExecuteReader();

                //lstMedicalProvider.Clear();
                //if (rdrMedicalProvider.HasRows)
                //{
                //    while (rdrMedicalProvider.Read())
                //    {
                //        MedicalProviderInfo info = new MedicalProviderInfo();

                //        if (!rdrMedicalProvider.IsDBNull(0)) info.ID = rdrMedicalProvider.GetString(0);
                //        if (!rdrMedicalProvider.IsDBNull(1)) info.Name = rdrMedicalProvider.GetString(1);
                //        if (!rdrMedicalProvider.IsDBNull(2)) info.Type = rdrMedicalProvider.GetString(2);

                //        lstMedicalProvider.Add(info);
                //    }
                //}

                //if (connRN4.State != ConnectionState.Closed) connRN4.Close();

                var srcMedicalProvider = new AutoCompleteStringCollection();

                for (int i = 0; i < lstMedicalProvider.Count; i++)
                {
                    srcMedicalProvider.Add(lstMedicalProvider[i].Name);
                }

                txtMedicalProvider.AutoCompleteMode = AutoCompleteMode.SuggestAppend;
                txtMedicalProvider.AutoCompleteSource = AutoCompleteSource.CustomSource;
                txtMedicalProvider.AutoCompleteCustomSource = srcMedicalProvider;

                lstPaymentMethod.Clear();
                String strSqlQueryForPaymentMethod = "select [dbo].[tbl_payment_method].[PaymentMethod_Id], [dbo].[tbl_payment_method].[PaymentMethod_Value] from [dbo].[tbl_payment_method] " +
                                                        "order by [dbo].[tbl_payment_method].[PaymentMethod_Value]";

                SqlCommand cmdQueryForPaymentMethod = new SqlCommand(strSqlQueryForPaymentMethod, connRN4);
                cmdQueryForPaymentMethod.CommandType = CommandType.Text;

                //if (connRN.State == ConnectionState.Closed) connRN.Open();
                if (connRN4.State != ConnectionState.Closed)
                {
                    connRN4.Close();
                    connRN4.Open();
                }
                else if (connRN4.State == ConnectionState.Closed) connRN4.Open();
                SqlDataReader rdrPaymentMethod = cmdQueryForPaymentMethod.ExecuteReader();
                if (rdrPaymentMethod.HasRows)
                {
                    while (rdrPaymentMethod.Read())
                    {
                        if (!rdrPaymentMethod.IsDBNull(1)) lstPaymentMethod.Add(new PaymentMethod { PaymentMethodId = rdrPaymentMethod.GetInt16(0), PaymentMethodValue = rdrPaymentMethod.GetString(1) });
                        else lstPaymentMethod.Add(new PaymentMethod { PaymentMethodId = rdrPaymentMethod.GetInt16(0), PaymentMethodValue = null });
                    }
                }
                rdrPaymentMethod.Close();
                if (connRN4.State != ConnectionState.Closed) connRN4.Close();

                // Retrieve credit card info
                lstCreditCardInfo.Clear();
                String strSqlQueryForCreditCardInfo = "select [dbo].[tbl_Credit_Card__c].[CreditCard_Id], [dbo].[tbl_Credit_Card__c].[Name] from [dbo].[tbl_Credit_Card__c]";

                SqlCommand cmdQueryForCreditCardInfo = new SqlCommand(strSqlQueryForCreditCardInfo, connRN4);
                cmdQueryForCreditCardInfo.CommandType = CommandType.Text;

                //if (connRN.State == ConnectionState.Closed) connRN.Open();
                if (connRN4.State != ConnectionState.Closed)
                {
                    connRN4.Close();
                    connRN4.Open();
                }
                else if (connRN4.State == ConnectionState.Closed) connRN4.Open();

                SqlDataReader rdrCreditCardInfo = cmdQueryForCreditCardInfo.ExecuteReader();
                if (rdrCreditCardInfo.HasRows)
                {
                    while (rdrCreditCardInfo.Read())
                    {
                        if (!rdrCreditCardInfo.IsDBNull(1))
                            lstCreditCardInfo.Add(new CreditCardInfo { CreditCardId = rdrCreditCardInfo.GetInt16(0), CreditCardNo = rdrCreditCardInfo.GetString(1) });
                        else
                            lstCreditCardInfo.Add(new CreditCardInfo { CreditCardId = rdrCreditCardInfo.GetInt16(0), CreditCardNo = null });
                    }
                }
                rdrCreditCardInfo.Close();
                if (connRN4.State != ConnectionState.Closed) connRN4.Close();

                String strSqlQueryForSettlement = "select [dbo].[tbl_settlement].[Name], [dbo].[tbl_settlement_type_code].[SettlementTypeValue], [dbo].[tbl_settlement].[Amount], " +
                                "[dbo].[tbl_settlement].[PersonalResponsibilityCredit], [dbo].[tbl_payment_method].[PaymentMethod_Value], " +
                                "[dbo].[tbl_settlement].[Approved], [dbo].[tbl_settlement].[ApprovedDate], " +
                                "[dbo].[tbl_settlement].[CheckNo], [dbo].[tbl_settlement].[CheckDate], [dbo].[tbl_settlement].[CheckReconciled], " +
                                "[dbo].[tbl_settlement].[ACH_Number], [dbo].[tbl_settlement].[ACH_Date], [dbo].[tbl_settlement].[ACH_Reconciled], " +
                                "[dbo].[tbl_Credit_Card__c].[Name], [dbo].[tbl_settlement].[CMMCreditCardPaidDate], [dbo].[tbl_settlement].[CC_Reconciled], " +
                                "[dbo].[tbl_settlement].[AllowedAmount], [dbo].[tbl_settlement].[IneligibleReason], " +
                                "[dbo].[tbl_settlement].[Notes] " +
                                "from [dbo].[tbl_settlement] inner join [dbo].[tbl_settlement_type_code] " +
                                "on [dbo].[tbl_settlement].[SettlementType] = [dbo].[tbl_settlement_type_code].[SettlementTypeCode] " +
                                "inner join [dbo].[tbl_payment_method] on [dbo].[tbl_settlement].[CMMPaymentMethod] = [dbo].[tbl_payment_method].[PaymentMethod_Id] " +
                                "inner join [dbo].[tbl_Credit_Card__c] on [dbo].[tbl_settlement].[CMMCreditCard] = [dbo].[tbl_Credit_Card__c].[CreditCard_Id]" +
                                "where [dbo].[tbl_settlement].[MedicalBillID] = @MedBillNo and " +
                                "[dbo].[tbl_settlement].[IsDeleted] = 0 " +
                                "order by [dbo].[tbl_settlement].[Name]";

                SqlCommand cmdQueryForSettlement = new SqlCommand(strSqlQueryForSettlement, connRN4);
                cmdQueryForSettlement.CommandType = CommandType.Text;

                cmdQueryForSettlement.Parameters.AddWithValue("@MedBillNo", MedBillNo);

                SqlDependency dependencySettlementInMedBill = new SqlDependency(cmdQueryForSettlement);
                dependencySettlementInMedBill.OnChange += new OnChangeEventHandler(OnSettlementsInMedBillEditChange);

                //if (connRN.State == ConnectionState.Closed) connRN.Open();
                if (connRN4.State != ConnectionState.Closed)
                {
                    connRN4.Close();
                    connRN4.Open();
                }
                else if (connRN4.State == ConnectionState.Closed) connRN4.Open();
                SqlDataReader rdrSettlement = cmdQueryForSettlement.ExecuteReader();
                gvSettlementsInMedBill.Rows.Clear();

                if (rdrSettlement.HasRows)
                {
                    while (rdrSettlement.Read())
                    {
                        DataGridViewRow row = new DataGridViewRow();
                        row.Cells.Add(new DataGridViewCheckBoxCell { Value = false });
                        if (!rdrSettlement.IsDBNull(0)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlement.GetString(0) });
                        if (!rdrSettlement.IsDBNull(1))
                        {
                            DataGridViewComboBoxCell comboCellSettlementType = new DataGridViewComboBoxCell();

                            for (int i = 0; i < lstSettlementType.Count; i++)
                            {
                                comboCellSettlementType.Items.Add(lstSettlementType[i].SettlementTypeValue);
                            }
                            for (int i = 0; i < comboCellSettlementType.Items.Count; i++)
                            {
                                if (rdrSettlement.GetString(1) == comboCellSettlementType.Items[i].ToString())
                                    comboCellSettlementType.Value = comboCellSettlementType.Items[i];
                            }

                            row.Cells.Add(comboCellSettlementType);
                        }
                        else
                        {
                            DataGridViewComboBoxCell comboCellSettlementType = new DataGridViewComboBoxCell();
                            for (int i = 0; i < lstSettlementType.Count; i++)
                            {
                                comboCellSettlementType.Items.Add(lstSettlementType[i].SettlementTypeValue);
                            }

                            for (int i = 0; i < comboCellSettlementType.Items.Count; i++)
                            {
                                if (rdrSettlement.GetString(1) == comboCellSettlementType.Items[i].ToString())
                                    comboCellSettlementType.Value = comboCellSettlementType.Items[i];
                            }

                            row.Cells.Add(comboCellSettlementType);
                        }

                        if (!rdrSettlement.IsDBNull(2)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlement.GetDecimal(2).ToString("C") });
                        else
                        {
                            Decimal Zero = 0;
                            row.Cells.Add(new DataGridViewTextBoxCell { Value = Zero.ToString("C") });
                        }


                        if (!rdrSettlement.IsDBNull(3)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlement.GetDecimal(3).ToString("C") });
                        else
                        {
                            Decimal Zero = 0;
                            row.Cells.Add(new DataGridViewTextBoxCell { Value = Zero.ToString("C") });
                        }

                        /////////////////////////////////////////////////////////////////////
                        if (!rdrSettlement.IsDBNull(4))
                        {
                            DataGridViewComboBoxCell comboCellPaymentMethod = new DataGridViewComboBoxCell();

                            for (int i = 0; i < lstPaymentMethod.Count; i++)
                            {
                                if (lstPaymentMethod[i].PaymentMethodValue != null) comboCellPaymentMethod.Items.Add(lstPaymentMethod[i].PaymentMethodValue);
                                else comboCellPaymentMethod.Items.Add(String.Empty);
                            }

                            for (int i = 0; i < comboCellPaymentMethod.Items.Count; i++)
                            {
                                if (rdrSettlement.GetString(4) == comboCellPaymentMethod.Items[i].ToString())
                                    comboCellPaymentMethod.Value = comboCellPaymentMethod.Items[i];
                            }

                            row.Cells.Add(comboCellPaymentMethod);
                        }
                        else
                        {
                            DataGridViewComboBoxCell comboCellPaymentMethod = new DataGridViewComboBoxCell();

                            for (int i = 0; i < lstPaymentMethod.Count; i++)
                            {
                                if (lstPaymentMethod[i].PaymentMethodValue != null) comboCellPaymentMethod.Items.Add(lstPaymentMethod[i].PaymentMethodValue);
                                else comboCellPaymentMethod.Items.Add(String.Empty);
                                //comboCellPaymentMethod.Items.Add(lstPaymentMethod[i].PaymentMethodValue);
                            }

                            for (int i = 0; i < comboCellPaymentMethod.Items.Count; i++)
                            {
                                if ((!rdrSettlement.IsDBNull(4)) && comboCellPaymentMethod.Items[i] != null)
                                {
                                    if (rdrSettlement.GetString(4) == comboCellPaymentMethod.Items[i].ToString())
                                        comboCellPaymentMethod.Value = comboCellPaymentMethod.Items[i];
                                }
                                else comboCellPaymentMethod.Value = null;
                            }

                            row.Cells.Add(comboCellPaymentMethod);

                        }

                        /////////////////////////////////////////////////////////////////////
                        if (!rdrSettlement.IsDBNull(5))
                        {

                            DataGridViewCheckBoxCell approvedCell = new DataGridViewCheckBoxCell();
                            approvedCell.Value = rdrSettlement.GetBoolean(5);
                            approvedCell.Style.Alignment = DataGridViewContentAlignment.MiddleCenter;
                            row.Cells.Add(approvedCell);

                            if (LoggedInUserRole == UserRole.RNStaff ||
                                LoggedInUserRole == UserRole.NPStaff ||
                                LoggedInUserRole == UserRole.FDStaff ||
                                LoggedInUserRole == UserRole.MSStaff)
                                approvedCell.ReadOnly = true;
                            else if (LoggedInUserRole == UserRole.RNManager ||
                                     LoggedInUserRole == UserRole.FDManager ||
                                     LoggedInUserRole == UserRole.NPManager ||
                                     LoggedInUserRole == UserRole.MSManager ||
                                     LoggedInUserRole == UserRole.Administrator ||
                                     LoggedInUserRole == UserRole.SuperAdmin ||
                                     LoggedInUserRole == UserRole.Executive)
                                approvedCell.ReadOnly = false;
                        }
                        else
                        {
                            DataGridViewCheckBoxCell approvedCell = new DataGridViewCheckBoxCell();
                            approvedCell.Value = false;
                            approvedCell.Style.Alignment = DataGridViewContentAlignment.MiddleCenter;
                            row.Cells.Add(approvedCell);
                            if (LoggedInUserRole == UserRole.RNStaff ||
                                LoggedInUserRole == UserRole.NPStaff ||
                                LoggedInUserRole == UserRole.FDStaff ||
                                LoggedInUserRole == UserRole.MSStaff)
                                approvedCell.ReadOnly = true;
                            else if (LoggedInUserRole == UserRole.RNManager ||
                                     LoggedInUserRole == UserRole.NPManager ||
                                     LoggedInUserRole == UserRole.FDManager ||
                                     LoggedInUserRole == UserRole.MSManager ||
                                     LoggedInUserRole == UserRole.Administrator ||
                                     LoggedInUserRole == UserRole.SuperAdmin ||
                                     LoggedInUserRole == UserRole.Executive)
                                approvedCell.ReadOnly = false;
                        }

                        if (!rdrSettlement.IsDBNull(6))
                        {
                            row.Cells.Add(new CalendarCell { Value = DateTime.Parse(rdrSettlement.GetDateTime(6).ToString("MM/dd/yyyy")) });
                            //row.Cells[7].ReadOnly = true;
                        }
                        else
                        {
                            row.Cells.Add(new CalendarCell { Value = null });
                            //row.Cells[7].ReadOnly = true;
                        }

                        // Payment information
                        if (!rdrSettlement.IsDBNull(4))
                        {
                            String strPaymentMethod = rdrSettlement.GetString(4);

                            switch (strPaymentMethod)
                            {
                                case "Check":
                                    if (!rdrSettlement.IsDBNull(7)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlement.GetString(7) });
                                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = null });
                                    row.Cells.Add(new DataGridViewTextBoxCell { Value = null });
                                    DataGridViewComboBoxCell comboCellCreditCardNoneForCheck = new DataGridViewComboBoxCell();
                                    for (int i = 0; i < lstCreditCardInfo.Count; i++)
                                    {
                                        if (lstCreditCardInfo[i].CreditCardNo != null) comboCellCreditCardNoneForCheck.Items.Add(lstCreditCardInfo[i].CreditCardNo);
                                        else comboCellCreditCardNoneForCheck.Items.Add(String.Empty);
                                    }
                                    row.Cells.Add(comboCellCreditCardNoneForCheck);
                                    if (!rdrSettlement.IsDBNull(8)) row.Cells.Add(new CalendarCell { Value = DateTime.Parse(rdrSettlement.GetDateTime(8).ToString("MM/dd/yyyy")) });
                                    if (!rdrSettlement.IsDBNull(9)) row.Cells.Add(new DataGridViewCheckBoxCell { Value = rdrSettlement.GetBoolean(9) });
                                    break;
                                case "ACH/Banking":
                                    row.Cells.Add(new DataGridViewTextBoxCell { Value = null });
                                    if (!rdrSettlement.IsDBNull(10)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlement.GetString(10) });
                                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = null });
                                    DataGridViewComboBoxCell comboCellCreditCardNoneForACH = new DataGridViewComboBoxCell();
                                    for (int i = 0; i < lstCreditCardInfo.Count; i++)
                                    {
                                        if (lstCreditCardInfo[i].CreditCardNo != null)
                                            comboCellCreditCardNoneForACH.Items.Add(lstCreditCardInfo[i].CreditCardNo);
                                        else comboCellCreditCardNoneForACH.Items.Add(String.Empty);
                                    }
                                    row.Cells.Add(comboCellCreditCardNoneForACH);
                                    if (!rdrSettlement.IsDBNull(11)) row.Cells.Add(new CalendarCell { Value = DateTime.Parse(rdrSettlement.GetDateTime(11).ToString("MM/dd/yyyy")) });
                                    if (!rdrSettlement.IsDBNull(12)) row.Cells.Add(new DataGridViewCheckBoxCell { Value = rdrSettlement.GetBoolean(12) });
                                    break;
                                case "Credit Card":
                                    row.Cells.Add(new DataGridViewTextBoxCell { Value = null });
                                    row.Cells.Add(new DataGridViewTextBoxCell { Value = null });
                                    if (!rdrSettlement.IsDBNull(13))
                                    {
                                        DataGridViewComboBoxCell comboCellCreditCard = new DataGridViewComboBoxCell();
                                        for (int i = 0; i < lstCreditCardInfo.Count; i++)
                                        {
                                            comboCellCreditCard.Items.Add(lstCreditCardInfo[i].CreditCardNo);
                                        }
                                        for (int i = 0; i < comboCellCreditCard.Items.Count; i++)
                                        {
                                            if (rdrSettlement.GetString(13) == comboCellCreditCard.Items[i].ToString())
                                                comboCellCreditCard.Value = comboCellCreditCard.Items[i];
                                        }
                                        row.Cells.Add(comboCellCreditCard);
                                    }
                                    else
                                    {
                                        DataGridViewComboBoxCell comboCellCreditCard = new DataGridViewComboBoxCell();
                                        for (int i = 0; i < lstCreditCardInfo.Count; i++)
                                        {
                                            comboCellCreditCard.Items.Add(lstCreditCardInfo[i].CreditCardNo);
                                        }
                                        row.Cells.Add(comboCellCreditCard);
                                    }
                                    if (!rdrSettlement.IsDBNull(14)) row.Cells.Add(new CalendarCell { Value = DateTime.Parse(rdrSettlement.GetDateTime(14).ToString("MM/dd/yyyy")) });
                                    if (!rdrSettlement.IsDBNull(15)) row.Cells.Add(new DataGridViewCheckBoxCell { Value = rdrSettlement.GetBoolean(15) });
                                    break;
                                default:
                                    row.Cells.Add(new DataGridViewTextBoxCell { Value = null });
                                    row.Cells.Add(new DataGridViewTextBoxCell { Value = null });
                                    DataGridViewComboBoxCell comboCellCreditCardNone = new DataGridViewComboBoxCell();
                                    for (int i = 0; i < lstCreditCardInfo.Count; i++)
                                    {
                                        if (lstCreditCardInfo[i].CreditCardNo != null) comboCellCreditCardNone.Items.Add(lstCreditCardInfo[i].CreditCardNo);
                                        else comboCellCreditCardNone.Items.Add(String.Empty);
                                    }
                                    row.Cells.Add(comboCellCreditCardNone);
                                    row.Cells.Add(new CalendarCell { Value = null });
                                    row.Cells.Add(new DataGridViewCheckBoxCell { Value = null });
                                    break;
                            }
                        }
                        else
                        {

                            DataGridViewTextBoxCell txtCheckNoCell = new DataGridViewTextBoxCell();
                            txtCheckNoCell.Value = null;
                            row.Cells.Add(txtCheckNoCell);
                            DataGridViewTextBoxCell txtACHNoCell = new DataGridViewTextBoxCell();
                            txtACHNoCell.Value = null;
                            row.Cells.Add(txtACHNoCell);
                            DataGridViewComboBoxCell comboCreditCardCell = new DataGridViewComboBoxCell();
                            for (int i = 0; i < lstCreditCardInfo.Count; i++)
                            {
                                if (lstCreditCardInfo[i].CreditCardNo != null) comboCreditCardCell.Items.Add(lstCreditCardInfo[i].CreditCardNo);
                                else comboCreditCardCell.Items.Add(String.Empty);
                            }
                            row.Cells.Add(comboCreditCardCell);
                            comboCreditCardCell.ReadOnly = true;
                            CalendarCell calPaymentDate = new CalendarCell();
                            calPaymentDate.Value = null;
                            row.Cells.Add(calPaymentDate);
                            DataGridViewCheckBoxCell chkReconciledCell = new DataGridViewCheckBoxCell();
                            chkReconciledCell.Value = false;
                            row.Cells.Add(chkReconciledCell);

                        }


                        if (!rdrSettlement.IsDBNull(16)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlement.GetDecimal(16).ToString("C") });
                        else row.Cells.Add(new DataGridViewTextBoxCell { Value = null });

                        if (!rdrSettlement.IsDBNull(17))
                        {
                            if (dicIneligibleReason.Count > 0)
                            {
                                DataGridViewComboBoxCell comboCellIneligibleReason = new DataGridViewComboBoxCell();
                                for (int i = 0; i < dicIneligibleReason.Count; i++)
                                {
                                    comboCellIneligibleReason.Items.Add(dicIneligibleReason[i]);
                                }
                                comboCellIneligibleReason.Value = comboCellIneligibleReason.Items[rdrSettlement.GetInt32(17)];
                                //comboIneligibleReason.Sorted = true;
                                row.Cells.Add(comboCellIneligibleReason);
                            }
                        }
                        else
                        {
                            if (dicIneligibleReason.Count > 0)
                            {
                                DataGridViewComboBoxCell comboCellIneligibleReason = new DataGridViewComboBoxCell();
                                for (int i = 0; i < dicIneligibleReason.Count; i++)
                                {
                                    comboCellIneligibleReason.Items.Add(dicIneligibleReason[i]);
                                }
                                comboCellIneligibleReason.Value = comboCellIneligibleReason.Items[0];
                                //comboIneligibleReason.Sorted = true;
                                row.Cells.Add(comboCellIneligibleReason);
                            }
                        }

                        if (!rdrSettlement.IsDBNull(18)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlement.GetString(18) });
                        else row.Cells.Add(new DataGridViewTextBoxCell { Value = null });

                        gvSettlementsInMedBill.Rows.Add(row);
                    }
                }
                rdrSettlement.Close();
                if (connRN4.State != ConnectionState.Closed) connRN4.Close();

                for (int i = 0; i < gvSettlementsInMedBill.Rows.Count; i++)
                {
                    gvSettlementsInMedBill["ApprovedDate", i].ReadOnly = true;
                }

                //if (txtIncdProgram.Text.Trim() != String.Empty)
                //{

                //    String IncidentProgram = txtIncdProgram.Text.Trim();
                //    Decimal PersonalResponsibilityAmount = 0;

                //    String strSqlQueryForPersonalResponsibilityAmount = "select [dbo].[tbl_program].[PersonalResponsibilityAmount] from [dbo].[tbl_program] " +
                //                                                        "where [dbo].[tbl_program].[ProgramName] = @ProgramName";

                //    SqlCommand cmdQueryForPersonalResponsibilityAmount = new SqlCommand(strSqlQueryForPersonalResponsibilityAmount, connRN);
                //    cmdQueryForPersonalResponsibilityAmount.CommandType = CommandType.Text;

                //    cmdQueryForPersonalResponsibilityAmount.Parameters.AddWithValue("@ProgramName", IncidentProgram);

                //    //if (connRN.State == ConnectionState.Closed) connRN.Open();
                //    if (connRN.State != ConnectionState.Closed)
                //    {
                //        connRN.Close();
                //        connRN.Open();
                //    }
                //    else if (connRN.State == ConnectionState.Closed) connRN.Open();
                //    SqlDataReader rdrPersonalResponsibilityAmount = cmdQueryForPersonalResponsibilityAmount.ExecuteReader();
                //    if (rdrPersonalResponsibilityAmount.HasRows)
                //    {

                //    }
                //    if (connRN.State != ConnectionState.Closed) connRN.Close();
                //}

                //foreach (IncidentProgramInfo incdProgram in lstIncidentProgramInfo)
                //{
                //    if (incdProgram.bPersonalResponsibilityProgram == true) PersonalResponsibilityAmount = incdProgram.PersonalResponsibilityAmount;
                //}

                //for (int i = 0; i < gvSettlementsInMedBill.Rows.Count; i++)
                //{
                //    if (gvSettlementsInMedBill["PersonalResponsibility", i]?.Value != null)
                //    {
                //        Decimal result = 0;
                //        if (Decimal.TryParse(gvSettlementsInMedBill["PersonalResponsibility", i]?.Value?.ToString(), NumberStyles.Currency, new CultureInfo("en-US"), out result))
                //        {
                //            PersonalResponsibilityAmount -= result;
                //        }
                //    }
                //}

                //txtPersonalResponsibility.Text = PersonalResponsibilityAmount.ToString("C");

                //if (PersonalResponsibilityAmount < 0) txtPersonalResponsibility.BackColor = Color.Yellow;

                for (int i = 0; i < gvSettlementsInMedBill.Rows.Count; i++)
                {
                    if (gvSettlementsInMedBill["PaymentMethod", i]?.Value?.ToString() == "Check")
                    {
                        gvSettlementsInMedBill.Rows[i].Cells["CheckNo"].ReadOnly = false;
                        gvSettlementsInMedBill.Rows[i].Cells["PaymentDate"].ReadOnly = false;
                        gvSettlementsInMedBill.Rows[i].Cells["Reconciled"].ReadOnly = false;
                        gvSettlementsInMedBill.Rows[i].Cells["ACHNo"].ReadOnly = true;
                        gvSettlementsInMedBill.Rows[i].Cells["CreditCard"].ReadOnly = true;
                    }

                    if (gvSettlementsInMedBill["PaymentMethod", i]?.Value?.ToString() == "ACH/Banking")
                    {
                        gvSettlementsInMedBill.Rows[i].Cells["ACHNo"].ReadOnly = false;
                        gvSettlementsInMedBill.Rows[i].Cells["PaymentDate"].ReadOnly = false;
                        gvSettlementsInMedBill.Rows[i].Cells["Reconciled"].ReadOnly = false;
                        gvSettlementsInMedBill.Rows[i].Cells["CheckNo"].ReadOnly = true;
                        gvSettlementsInMedBill.Rows[i].Cells["CreditCard"].ReadOnly = true;
                    }

                    if (gvSettlementsInMedBill["PaymentMethod", i]?.Value?.ToString() == "Credit Card")
                    {
                        gvSettlementsInMedBill.Rows[i].Cells["CreditCard"].ReadOnly = false;
                        gvSettlementsInMedBill.Rows[i].Cells["PaymentDate"].ReadOnly = false;
                        gvSettlementsInMedBill.Rows[i].Cells["Reconciled"].ReadOnly = false;
                        gvSettlementsInMedBill.Rows[i].Cells["CheckNo"].ReadOnly = true;
                        gvSettlementsInMedBill.Rows[i].Cells["ACHNo"].ReadOnly = true;
                    }
                    if (gvSettlementsInMedBill["PaymentMethod", i]?.Value?.ToString() == "None")
                    {
                        gvSettlementsInMedBill.Rows[i].Cells["CheckNo"].ReadOnly = true;
                        gvSettlementsInMedBill.Rows[i].Cells["ACHNo"].ReadOnly = true;
                        gvSettlementsInMedBill.Rows[i].Cells["CreditCard"].ReadOnly = true;
                        gvSettlementsInMedBill.Rows[i].Cells["PaymentDate"].ReadOnly = true;
                        gvSettlementsInMedBill.Rows[i].Cells["Reconciled"].ReadOnly = true;
                    }
                }

                for (int i = 0; i < gvSettlementsInMedBill.Rows.Count; i++)
                {
                    if (gvSettlementsInMedBill[2, i]?.Value?.ToString() == "Ineligible") gvSettlementsInMedBill.Rows[i].DefaultCellStyle.BackColor = Color.Salmon;
                    else
                    {
                        gvSettlementsInMedBill["IneligibleReason", i].Value = null;
                        gvSettlementsInMedBill["IneligibleReason", i].ReadOnly = true;
                    }
                }

                //Decimal SettlementTotal = 0;
                //Decimal Balance = 0;
                //Decimal BillAmount = Decimal.Parse(txtMedBillAmount.Text.Trim(), NumberStyles.Currency, new CultureInfo("en-US"));
                //for (int i = 0; i < gvSettlementsInMedBill.Rows.Count; i++)
                //{
                //    Decimal Settlement = Decimal.Parse(gvSettlementsInMedBill["SettlementAmount", i].Value.ToString(), NumberStyles.Currency, new CultureInfo("en-US"));
                //    SettlementTotal += Settlement;
                //}
                //if (SettlementTotal > BillAmount) MessageBox.Show("Settlement Total exceeds the Medical Bill Amount.", "Alert");
                //else
                //{
                //    Balance = BillAmount - SettlementTotal;
                //    txtBalance.Text = Balance.ToString("C");
                //}

                if (txtMedBillAmount.Text.Trim() != String.Empty)
                {
                    Decimal SettlementTotal = 0;
                    Decimal Balance = 0;
                    Decimal Result = 0;
                    Decimal BillAmount = 0;
                    if (Decimal.TryParse(txtMedBillAmount.Text.Trim(), NumberStyles.Currency, new CultureInfo("en-US"), out Result))
                    {
                        BillAmount = Result;

                        for (int i = 0; i < gvSettlementsInMedBill.Rows.Count; i++)
                        {
                            if (gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() != "PR Reimbursement" &&
                                gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() != "Medical Provider Refund")
                            {
                                Decimal Settlement = Decimal.Parse(gvSettlementsInMedBill["SettlementAmount", i]?.Value?.ToString(), NumberStyles.Currency, new CultureInfo("en-US"));
                                SettlementTotal += Settlement;
                            }
                        }
                        if (SettlementTotal > BillAmount) MessageBox.Show("Settlement Total exceeds the Medical Bill Amount.", "Alert");
                        else
                        {
                            Balance = BillAmount - SettlementTotal;
                            txtBalance.Text = Balance.ToString("C");
                        }
                    }
                }

                Decimal TotalSharedAmount = 0;
                for (int i = 0; i < gvSettlementsInMedBill.Rows.Count; i++)
                {
                    Decimal SharedAmount = 0;
                    Decimal MedicalProviderRefund = 0;
                    Decimal result = 0;

                    if (gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "CMM Provider Payment" ||
                        gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "CMM Member Reimbursement" ||
                        gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "PR Reimbursement")
                    {
                        if (Decimal.TryParse(gvSettlementsInMedBill["SettlementAmount", i].Value.ToString(), NumberStyles.Currency, new CultureInfo("en-US"), out result))
                        {
                            SharedAmount = result;
                            TotalSharedAmount += SharedAmount;
                            txtTotalSharedAmtMedBill.Text = TotalSharedAmount.ToString("C");
                        }
                    }
                    else if (gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "Medical Provider Refund")
                    {
                        if (Decimal.TryParse(gvSettlementsInMedBill["SettlementAmount", i]?.Value?.ToString(), NumberStyles.Currency, new CultureInfo("en-US"), out result))
                        {
                            MedicalProviderRefund = result;
                            TotalSharedAmount -= MedicalProviderRefund;
                            txtTotalSharedAmtMedBill.Text = TotalSharedAmount.ToString("C");
                        }
                    }
                }

                Decimal PersonResponsibilityAmt = PersonalResponsibilityAmountInMedBill;
                Decimal PersonalResponsibilityBalance = PersonalResponsibilityAmountInMedBill;
                Decimal TotalPersonalResponsibilityShared = 0;

                for (int i = 0; i < gvSettlementsInMedBill.Rows.Count; i++)
                {
                    Decimal PersonalResponsibilityShared = 0;
                    Decimal result = 0;

                    if (gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "Self Pay Discount" ||
                        gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "3rd Party Discount" ||
                        gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "Member Payment")
                    {
                        if (Decimal.TryParse(gvSettlementsInMedBill["PersonalResponsibility", i]?.Value?.ToString(), NumberStyles.Currency, new CultureInfo("en-US"), out result))
                        {
                            PersonalResponsibilityShared = result;
                            TotalPersonalResponsibilityShared += PersonalResponsibilityShared;
                            PersonalResponsibilityBalance -= TotalPersonalResponsibilityShared;
                        }
                    }
                }

                txtPersonalResponsibility.Text = PersonalResponsibilityBalance.ToString("C");


                // Populate Task GridView
                MedBillNoForTask = MedBillNo;

                String strSqlQueryForTaskInMedBill = "select [dbo].[tbl_task].[Subject], [dbo].[tbl_task].[DueDate], [dbo].[tbl_user].[User_Name], [dbo].[tbl_task_status_code].[TaskStatusValue], " +
                                                     "[dbo].[tbl_task].[id] " +
                                                     "from [dbo].[tbl_task] " +
                                                     "inner join [dbo].[tbl_user] on [dbo].[tbl_task].[AssignedTo] = [dbo].[tbl_user].[User_Id] " +
                                                     "inner join [dbo].[tbl_task_status_code] on [dbo].[tbl_task].[Status] = [dbo].[tbl_task_status_code].[TaskStatusCode] " +
                                                     "where [dbo].[tbl_task].[whatid] = @MedBillNo " +
                                                     "order by [dbo].[tbl_task].[CreateDate] desc";

                SqlCommand cmdQueryForTask = new SqlCommand(strSqlQueryForTaskInMedBill, connRN4);
                cmdQueryForTask.CommandType = CommandType.Text;

                cmdQueryForTask.Parameters.AddWithValue("@MedBillNo", MedBillNoForTask);

                SqlDependency dependencyTask = new SqlDependency(cmdQueryForTask);
                dependencyTask.OnChange += new OnChangeEventHandler(OnTaskInMedBillChange);

                if (connRN4.State != ConnectionState.Closed)
                {
                    connRN4.Close();
                    connRN4.Open();
                }
                else if (connRN4.State == ConnectionState.Closed) connRN4.Open();

                SqlDataReader rdrTaskForMedBill = cmdQueryForTask.ExecuteReader();
                gvMostRecentTasks.Rows.Clear();
                if (rdrTaskForMedBill.HasRows)
                {
                    while (rdrTaskForMedBill.Read())
                    {
                        DataGridViewRow row = new DataGridViewRow();
                        if (!rdrTaskForMedBill.IsDBNull(0)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrTaskForMedBill.GetString(0) });
                        else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                        if (!rdrTaskForMedBill.IsDBNull(1)) row.Cells.Add(new CalendarCell { Value = rdrTaskForMedBill.GetDateTime(1).ToString("MM/dd/yyyy") });
                        else row.Cells.Add(new CalendarCell { Value = String.Empty });
                        if (!rdrTaskForMedBill.IsDBNull(2)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrTaskForMedBill.GetString(2) });
                        else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                        if (!rdrTaskForMedBill.IsDBNull(3)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrTaskForMedBill.GetString(3) });
                        else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                        if (!rdrTaskForMedBill.IsDBNull(4)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrTaskForMedBill.GetInt32(4).ToString() });
                        else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });

                        gvMostRecentTasks.Rows.Add(row);
                    }
                }
                rdrTaskForMedBill.Close();

                if (connRN4.State == ConnectionState.Open) connRN4.Close();


                EnableMedicalBillForm();


                //btnAddNewSettlement.Enabled = true;
                ////btnEditSettlement.Enabled = true;
                //btnSaveSettlement.Enabled = true;
                //btnDeleteSettlement.Enabled = true;


            }

            //}
            //else
            //{
            //    MessageBox.Show("Medical Bill screen already open.");
            //}
        }

        private void ClearGVSettlementSafely()
        {
            gvSettlementsInMedBill.BeginInvoke(new RemoveAllRowsInSettlement(RemoveAllRowSettlement));
        }

        private void AddNewRowToGVSettlementSafely(DataGridViewRow row)
        {
            gvSettlementsInMedBill.BeginInvoke(new AddRowToGVSettlement(AddRowToSettlement), row);
        }

        private void AddRowToSettlement(DataGridViewRow row)
        {
            gvSettlementsInMedBill.Rows.Add(row);
        }

        private void RemoveAllRowSettlement()
        {
            gvSettlementsInMedBill.Rows.Clear();
        }

        private void RemoveRowSettlement(int i)
        {
            gvSettlementsInMedBill.Rows.RemoveAt(i);
        }

        /// <summary>
        /// Modify this method
        /// </summary>
        private void ClearMedBillInCaseSafely()
        {
            gvCasePageMedBills.BeginInvoke(new RemoveAllMedBillInCase(RemoveAllMedBills));
        }

        private void AddNewRowToMedBillInCaseSafely(DataGridViewRow row)
        {
            gvCasePageMedBills.BeginInvoke(new AddRowToMedBillInCase(AddRowToMedBill), row);
        }

        private void SetMedBillBalanceSafely(Decimal balance)
        {
            txtBalance.BeginInvoke(new SetBalaceMedBill(SetMedBillBalance), balance);
        }

        private void SetTotalSharedAmountSafely(Decimal total_shared_amount)
        {
            txtTotalSharedAmtMedBill.BeginInvoke(new SetTotalSharedAmount(SetTotalSharedAmt), total_shared_amount);
        }

        private void AddRowToMedBill(DataGridViewRow row)
        {
            gvCasePageMedBills.Rows.Add(row);
        }

        private void RemoveRowMedBill(int i)
        {
            gvCasePageMedBills.Rows.RemoveAt(i);
        }

        private void RemoveAllMedBills()
        {
            gvCasePageMedBills.Rows.Clear();
        }



        private void SetTabPageCMMManagerSafely(int nIndex)
        {
            tbCMMManager.BeginInvoke(new SetTabPages(SetTabPage), nIndex);
        }

        private void SetTabPage(int nIndex)
        {
            tbCMMManager.SelectedIndex = nIndex;
        }

        private void SetMedBillBalance(Decimal Balance)
        {
            txtBalance.Text = Balance.ToString("C");
        }

        private void SetTotalSharedAmt(Decimal SharedAmount)
        {
            txtTotalSharedAmtMedBill.Text = SharedAmount.ToString("C");
        }

        private void OnSettlementsInMedBillEditChange(object sender, SqlNotificationEventArgs e)
        {
            if (e.Type == SqlNotificationType.Change)
            {
                SqlDependency dependency = sender as SqlDependency;
                dependency.OnChange -= OnSettlementsInMedBillEditChange;

                UpdateGridViewSettlementsInMedBillEdit();
            }
        }

        private void UpdateGridViewSettlementsInMedBillEdit()
        {

            String MedBillNo = txtMedBillNo.Text.Trim();
            ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

            String strSqlQueryForSettlement = "select [dbo].[tbl_settlement].[Name], [dbo].[tbl_settlement_type_code].[SettlementTypeValue], [dbo].[tbl_settlement].[Amount], " +
                                  "[dbo].[tbl_settlement].[PersonalResponsibilityCredit], [dbo].[tbl_payment_method].[PaymentMethod_Value], " +
                                  "[dbo].[tbl_settlement].[Approved], [dbo].[tbl_settlement].[ApprovedDate], " +
                                  "[dbo].[tbl_settlement].[CheckNo], [dbo].[tbl_settlement].[CheckDate], [dbo].[tbl_settlement].[CheckReconciled], " +
                                  "[dbo].[tbl_settlement].[ACH_Number], [dbo].[tbl_settlement].[ACH_Date], [dbo].[tbl_settlement].[ACH_Reconciled], " +
                                  "[dbo].[tbl_Credit_Card__c].[Name], [dbo].[tbl_settlement].[CMMCreditCardPaidDate], [dbo].[tbl_settlement].[CC_Reconciled], " +
                                  "[dbo].[tbl_settlement].[AllowedAmount], [dbo].[tbl_settlement].[IneligibleReason], [dbo].[tbl_settlement].[Notes] " +
                                  "from [dbo].[tbl_settlement] inner join [dbo].[tbl_settlement_type_code] " +
                                  "on [dbo].[tbl_settlement].[SettlementType] = [dbo].[tbl_settlement_type_code].[SettlementTypeCode] " +
                                  "inner join [dbo].[tbl_payment_method] on [dbo].[tbl_settlement].[CMMPaymentMethod] = [dbo].[tbl_payment_method].[PaymentMethod_Id] " +
                                  "inner join [dbo].[tbl_Credit_Card__c] on [dbo].[tbl_settlement].[CMMCreditCard] = [dbo].[tbl_Credit_Card__c].[CreditCard_Id]" +
                                  "where [dbo].[tbl_settlement].[MedicalBillID] = @MedBillNo and [dbo].[tbl_settlement].[IsDeleted] = 0 " +
                                  "order by [dbo].[tbl_settlement].[Name]";

            SqlCommand cmdQueryForSettlement = new SqlCommand(strSqlQueryForSettlement, connRN4);
            cmdQueryForSettlement.CommandType = CommandType.Text;

            cmdQueryForSettlement.Parameters.AddWithValue("@MedBillNo", MedBillNo);

            SqlDependency dependencySettlementInMedBill = new SqlDependency(cmdQueryForSettlement);
            dependencySettlementInMedBill.OnChange += new OnChangeEventHandler(OnSettlementsInMedBillEditChange);

            if (connRN4.State != ConnectionState.Closed)
            {
                connRN4.Close();
                connRN4.Open();
            }
            else if (connRN4.State != ConnectionState.Open) connRN4.Open();
            SqlDataReader rdrSettlement = cmdQueryForSettlement.ExecuteReader();

            if (IsHandleCreated) ClearGVSettlementSafely();
            else gvSettlementsInMedBill.Rows.Clear();

            if (rdrSettlement.HasRows)
            {
                // has to put code to clear all rows in gvSettlementsInMedBill
                while (rdrSettlement.Read())
                {
                    DataGridViewRow row = new DataGridViewRow();
                    row.Cells.Add(new DataGridViewCheckBoxCell { Value = false });
                    if (!rdrSettlement.IsDBNull(0)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlement.GetString(0) });
                    if (!rdrSettlement.IsDBNull(1))
                    {
                        DataGridViewComboBoxCell comboCellSettlementType = new DataGridViewComboBoxCell();
                        for (int i = 0; i < lstSettlementType.Count; i++)
                        {
                            comboCellSettlementType.Items.Add(lstSettlementType[i].SettlementTypeValue);
                        }
                        for (int i = 0; i < comboCellSettlementType.Items.Count; i++)
                        {
                            if (rdrSettlement.GetString(1) == comboCellSettlementType.Items[i].ToString())
                                comboCellSettlementType.Value = comboCellSettlementType.Items[i];
                        }
                        row.Cells.Add(comboCellSettlementType);
                    }
                    else
                    {
                        DataGridViewComboBoxCell comboCellSettlementType = new DataGridViewComboBoxCell();
                        for (int i = 0; i < lstSettlementType.Count; i++)
                        {
                            comboCellSettlementType.Items.Add(lstSettlementType[i].SettlementTypeValue);
                        }

                        for (int i = 0; i < comboCellSettlementType.Items.Count; i++)
                        {
                            if (rdrSettlement.GetString(1) == comboCellSettlementType.Items[i].ToString())
                                comboCellSettlementType.Value = comboCellSettlementType.Items[i];
                        }

                        row.Cells.Add(comboCellSettlementType);
                    }

                    if (!rdrSettlement.IsDBNull(2)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlement.GetDecimal(2).ToString("C") });

                    else
                    {
                        Decimal Zero = 0;
                        row.Cells.Add(new DataGridViewTextBoxCell { Value = Zero.ToString("C") });
                    }


                    if (!rdrSettlement.IsDBNull(3)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlement.GetDecimal(3).ToString("C") });
                    else
                    {
                        Decimal Zero = 0;
                        row.Cells.Add(new DataGridViewTextBoxCell { Value = Zero.ToString("C") });
                    }

                    /////////////////////////////////////////////////////////////////////
                    if (!rdrSettlement.IsDBNull(4))
                    {
                        DataGridViewComboBoxCell comboCellPaymentMethod = new DataGridViewComboBoxCell();

                        for (int i = 0; i < lstPaymentMethod.Count; i++)
                        {
                            if (lstPaymentMethod[i].PaymentMethodValue != null) comboCellPaymentMethod.Items.Add(lstPaymentMethod[i].PaymentMethodValue);
                            else comboCellPaymentMethod.Items.Add(String.Empty);
                        }

                        for (int i = 0; i < comboCellPaymentMethod.Items.Count; i++)
                        {
                            if (rdrSettlement.GetString(4) == comboCellPaymentMethod.Items[i].ToString())
                                comboCellPaymentMethod.Value = comboCellPaymentMethod.Items[i];
                        }

                        row.Cells.Add(comboCellPaymentMethod);
                    }
                    else
                    {
                        DataGridViewComboBoxCell comboCellPaymentMethod = new DataGridViewComboBoxCell();

                        for (int i = 0; i < lstPaymentMethod.Count; i++)
                        {
                            if (lstPaymentMethod[i].PaymentMethodValue != null) comboCellPaymentMethod.Items.Add(lstPaymentMethod[i].PaymentMethodValue);
                            else comboCellPaymentMethod.Items.Add(String.Empty);
                        }

                        comboCellPaymentMethod.Value = null;

                        row.Cells.Add(comboCellPaymentMethod);

                    }


                    /////////////////////////////////////////////////////////////////////
                    if (!rdrSettlement.IsDBNull(5))
                    {

                        DataGridViewCheckBoxCell approvedCell = new DataGridViewCheckBoxCell();
                        approvedCell.Value = rdrSettlement.GetBoolean(5);
                        approvedCell.Style.Alignment = DataGridViewContentAlignment.MiddleCenter;
                        row.Cells.Add(approvedCell);

                        if (LoggedInUserRole == UserRole.RNStaff ||
                            LoggedInUserRole == UserRole.NPStaff ||
                            LoggedInUserRole == UserRole.FDStaff)
                            approvedCell.ReadOnly = true;
                        else if (LoggedInUserRole == UserRole.RNManager)
                            approvedCell.ReadOnly = false;
                    }
                    else
                    {
                        DataGridViewCheckBoxCell approvedCell = new DataGridViewCheckBoxCell();
                        approvedCell.Value = false;
                        approvedCell.Style.Alignment = DataGridViewContentAlignment.MiddleCenter;
                        row.Cells.Add(approvedCell);

                        if (LoggedInUserRole == UserRole.RNStaff ||
                            LoggedInUserRole == UserRole.NPStaff ||
                            LoggedInUserRole == UserRole.FDStaff)
                            approvedCell.ReadOnly = true;
                        else if (LoggedInUserRole == UserRole.RNManager)
                            approvedCell.ReadOnly = false;
                    }

                    if (!rdrSettlement.IsDBNull(6)) row.Cells.Add(new CalendarCell { Value = DateTime.Parse(rdrSettlement.GetDateTime(6).ToString("MM/dd/yyyy")) });
                    else row.Cells.Add(new CalendarCell { Value = null });

                    // Payment information
                    if (!rdrSettlement.IsDBNull(4))
                    {
                        String strPaymentMethod = rdrSettlement.GetString(4);

                        switch (strPaymentMethod)
                        {
                            case "Check":
                                if (!rdrSettlement.IsDBNull(7)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlement.GetString(7) });
                                else row.Cells.Add(new DataGridViewTextBoxCell { Value = null });
                                row.Cells.Add(new DataGridViewTextBoxCell { Value = null });
                                //row.Cells.Add(new DataGridViewTextBoxCell { Value = null });
                                DataGridViewComboBoxCell comboCellCreditCardNoneForCheck = new DataGridViewComboBoxCell();
                                for (int i = 0; i < lstCreditCardInfo.Count; i++)
                                {
                                    if (lstCreditCardInfo[i].CreditCardNo != null)
                                        comboCellCreditCardNoneForCheck.Items.Add(lstCreditCardInfo[i].CreditCardNo);
                                    else comboCellCreditCardNoneForCheck.Items.Add(String.Empty);
                                }
                                row.Cells.Add(comboCellCreditCardNoneForCheck);

                                if (!rdrSettlement.IsDBNull(8)) row.Cells.Add(new CalendarCell { Value = DateTime.Parse(rdrSettlement.GetDateTime(8).ToString("MM/dd/yyyy")) });
                                else row.Cells.Add(new CalendarCell { Value = String.Empty });
                                if (!rdrSettlement.IsDBNull(9)) row.Cells.Add(new DataGridViewCheckBoxCell { Value = rdrSettlement.GetBoolean(9) });
                                else row.Cells.Add(new DataGridViewCheckBoxCell { Value = null });
                                break;
                            case "ACH/Banking":
                                row.Cells.Add(new DataGridViewTextBoxCell { Value = null });
                                if (!rdrSettlement.IsDBNull(10)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlement.GetString(10) });
                                else row.Cells.Add(new DataGridViewTextBoxCell { Value = null });

                                DataGridViewComboBoxCell comboCellCreditCardNoneForACH = new DataGridViewComboBoxCell();
                                for (int i = 0; i < lstCreditCardInfo.Count; i++)
                                {
                                    if (lstCreditCardInfo[i].CreditCardNo != null)
                                        comboCellCreditCardNoneForACH.Items.Add(lstCreditCardInfo[i].CreditCardNo);
                                    else comboCellCreditCardNoneForACH.Items.Add(String.Empty);
                                }
                                row.Cells.Add(comboCellCreditCardNoneForACH);

                                //row.Cells.Add(new DataGridViewTextBoxCell { Value = null });
                                if (!rdrSettlement.IsDBNull(11)) row.Cells.Add(new CalendarCell { Value = DateTime.Parse(rdrSettlement.GetDateTime(11).ToString("MM/dd/yyyy")) });
                                else row.Cells.Add(new CalendarCell { Value = String.Empty });
                                if (!rdrSettlement.IsDBNull(12)) row.Cells.Add(new DataGridViewCheckBoxCell { Value = rdrSettlement.GetBoolean(12) });
                                else row.Cells.Add(new DataGridViewCheckBoxCell { Value = null });
                                break;
                            case "Credit Card":
                                row.Cells.Add(new DataGridViewTextBoxCell { Value = null });
                                row.Cells.Add(new DataGridViewTextBoxCell { Value = null });
                                if (!rdrSettlement.IsDBNull(13))
                                {
                                    DataGridViewComboBoxCell comboCellCreditCard = new DataGridViewComboBoxCell();
                                    for (int i = 0; i < lstCreditCardInfo.Count; i++)
                                    {
                                        if (lstCreditCardInfo[i].CreditCardNo != null) comboCellCreditCard.Items.Add(lstCreditCardInfo[i].CreditCardNo);
                                        else comboCellCreditCard.Items.Add(String.Empty);
                                    }
                                    for (int i = 0; i < comboCellCreditCard.Items.Count; i++)
                                    {
                                        if (rdrSettlement.GetString(13) == comboCellCreditCard.Items[i].ToString())
                                            comboCellCreditCard.Value = comboCellCreditCard.Items[i];
                                    }
                                    row.Cells.Add(comboCellCreditCard);
                                }
                                else
                                {
                                    DataGridViewComboBoxCell comboCellCreditCard = new DataGridViewComboBoxCell();
                                    for (int i = 0; i < lstCreditCardInfo.Count; i++)
                                    {
                                        if (lstCreditCardInfo[i].CreditCardNo != null) comboCellCreditCard.Items.Add(lstCreditCardInfo[i].CreditCardNo);
                                        else comboCellCreditCard.Items.Add(String.Empty);
                                    }
                                    row.Cells.Add(comboCellCreditCard);
                                }
                                if (!rdrSettlement.IsDBNull(14)) row.Cells.Add(new CalendarCell { Value = DateTime.Parse(rdrSettlement.GetDateTime(14).ToString("MM/dd/yyyy")) });
                                else row.Cells.Add(new CalendarCell { Value = String.Empty });
                                if (!rdrSettlement.IsDBNull(15)) row.Cells.Add(new DataGridViewCheckBoxCell { Value = rdrSettlement.GetBoolean(15) });
                                else row.Cells.Add(new DataGridViewCheckBoxCell { Value = null });
                                break;
                            default:
                                row.Cells.Add(new DataGridViewTextBoxCell { Value = null });
                                row.Cells.Add(new DataGridViewTextBoxCell { Value = null });
                                DataGridViewComboBoxCell comboCellCreditCardNone = new DataGridViewComboBoxCell();
                                for (int i = 0; i < lstCreditCardInfo.Count; i++)
                                {
                                    if (lstCreditCardInfo[i].CreditCardNo != null) comboCellCreditCardNone.Items.Add(lstCreditCardInfo[i].CreditCardNo);
                                    else comboCellCreditCardNone.Items.Add(String.Empty);
                                }
                                row.Cells.Add(comboCellCreditCardNone);
                                row.Cells.Add(new CalendarCell { Value = String.Empty });
                                row.Cells.Add(new DataGridViewCheckBoxCell { Value = null });
                                break;
                        }
                    }
                    else
                    {
                        DataGridViewTextBoxCell txtCheckNoCell = new DataGridViewTextBoxCell();
                        txtCheckNoCell.Value = null;
                        row.Cells.Add(txtCheckNoCell);
                        DataGridViewTextBoxCell txtACHNoCell = new DataGridViewTextBoxCell();
                        txtACHNoCell.Value = null;
                        row.Cells.Add(txtACHNoCell);
                        DataGridViewComboBoxCell comboCreditCardCell = new DataGridViewComboBoxCell();
                        for (int i = 0; i < lstCreditCardInfo.Count; i++)
                        {
                            if (lstCreditCardInfo[i].CreditCardNo != null) comboCreditCardCell.Items.Add(lstCreditCardInfo[i].CreditCardNo);
                            else comboCreditCardCell.Items.Add(String.Empty);
                        }
                        row.Cells.Add(comboCreditCardCell);
                        comboCreditCardCell.ReadOnly = true;
                        CalendarCell calPaymentDate = new CalendarCell();
                        calPaymentDate.Value = null;
                        row.Cells.Add(calPaymentDate);
                        DataGridViewCheckBoxCell chkReconciledCell = new DataGridViewCheckBoxCell();
                        chkReconciledCell.Value = false;
                        row.Cells.Add(chkReconciledCell);
                    }

                    if (!rdrSettlement.IsDBNull(16)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlement.GetDecimal(16).ToString("C") });
                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = null });

                    if (!rdrSettlement.IsDBNull(17))
                    {
                        if (dicIneligibleReason.Count > 0)
                        {
                            DataGridViewComboBoxCell comboCellIneligibleReason = new DataGridViewComboBoxCell();
                            for (int i = 0; i < dicIneligibleReason.Count; i++)
                            {
                                comboCellIneligibleReason.Items.Add(dicIneligibleReason[i]);
                            }
                            comboCellIneligibleReason.Value = comboCellIneligibleReason.Items[rdrSettlement.GetInt32(17)];
                            //comboIneligibleReason.Sorted = true;
                            row.Cells.Add(comboCellIneligibleReason);
                        }
                    }
                    else
                    {
                        if (dicIneligibleReason.Count > 0)
                        {
                            DataGridViewComboBoxCell comboCellIneligibleReason = new DataGridViewComboBoxCell();
                            for (int i = 0; i < dicIneligibleReason.Count; i++)
                            {
                                comboCellIneligibleReason.Items.Add(dicIneligibleReason[i]);
                            }
                            comboCellIneligibleReason.Value = comboCellIneligibleReason.Items[0];
                            //comboIneligibleReason.Sorted = true;
                            row.Cells.Add(comboCellIneligibleReason);
                        }
                    }


                    if (!rdrSettlement.IsDBNull(18)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlement.GetString(18) });
                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = null });

                    if (IsHandleCreated) AddNewRowToGVSettlementSafely(row);
                    else gvSettlementsInMedBill.Rows.Add(row);
                }
            }
            rdrSettlement.Close();
            if (connRN4.State != ConnectionState.Closed) connRN4.Close();

            //for (int i = 0; i < gvSettlementsInMedBill.Rows.Count; i++)
            //{
            //    if (gvSettlementsInMedBill["PaymentMethod", i]?.Value?.ToString() == "Check")
            //    {
            //        gvSettlementsInMedBill.Rows[i].Cells["CheckNo"].ReadOnly = false;
            //        gvSettlementsInMedBill.Rows[i].Cells["PaymentDate"].ReadOnly = false;
            //        gvSettlementsInMedBill.Rows[i].Cells["Reconciled"].ReadOnly = false;
            //        gvSettlementsInMedBill.Rows[i].Cells["ACHNo"].ReadOnly = true;
            //        gvSettlementsInMedBill.Rows[i].Cells["CreditCard"].ReadOnly = true;
            //    }

            //    if (gvSettlementsInMedBill["PaymentMethod", i]?.Value?.ToString() == "ACH/Banking")
            //    {
            //        gvSettlementsInMedBill.Rows[i].Cells["ACHNo"].ReadOnly = false;
            //        gvSettlementsInMedBill.Rows[i].Cells["PaymentDate"].ReadOnly = false;
            //        gvSettlementsInMedBill.Rows[i].Cells["Reconciled"].ReadOnly = false;
            //        gvSettlementsInMedBill.Rows[i].Cells["CheckNo"].ReadOnly = true;
            //        gvSettlementsInMedBill.Rows[i].Cells["CreditCard"].ReadOnly = true;
            //    }

            //    if (gvSettlementsInMedBill["PaymentMethod", i]?.Value?.ToString() == "Credit Card")
            //    {
            //        gvSettlementsInMedBill.Rows[i].Cells["CreditCard"].ReadOnly = false;
            //        gvSettlementsInMedBill.Rows[i].Cells["PaymentDate"].ReadOnly = false;
            //        gvSettlementsInMedBill.Rows[i].Cells["Reconciled"].ReadOnly = false;
            //        gvSettlementsInMedBill.Rows[i].Cells["CheckNo"].ReadOnly = true;
            //        gvSettlementsInMedBill.Rows[i].Cells["ACHNo"].ReadOnly = true;
            //    }
            //    if (gvSettlementsInMedBill["PaymentMethod", i]?.Value?.ToString() == String.Empty)
            //    {
            //        gvSettlementsInMedBill.Rows[i].Cells["CheckNo"].ReadOnly = true;
            //        gvSettlementsInMedBill.Rows[i].Cells["ACHNo"].ReadOnly = true;
            //        gvSettlementsInMedBill.Rows[i].Cells["CreditCard"].ReadOnly = true;
            //        gvSettlementsInMedBill.Rows[i].Cells["PaymentDate"].ReadOnly = true;
            //        gvSettlementsInMedBill.Rows[i].Cells["Reconciled"].ReadOnly = true;
            //    }
            //}

            Decimal SettlementTotal = 0;
            Decimal Balance = 0;
            Decimal BillAmount = Decimal.Parse(txtMedBillAmount.Text.Trim(), NumberStyles.Currency, new CultureInfo("en-US"));
            for (int i = 0; i < gvSettlementsInMedBill.Rows.Count; i++)
            {
                if (gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() != "PR Reimbursement" &&
                    gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() != "Medical Provider Refund")
                {
                    Decimal Settlement = Decimal.Parse(gvSettlementsInMedBill["SettlementAmount", i].Value.ToString(), NumberStyles.Currency, new CultureInfo("en-US"));
                    SettlementTotal += Settlement;
                }
            }
            if (SettlementTotal > BillAmount) MessageBox.Show("Settlement Total exceeds the Medical Bill Amount.", "Alert");
            else
            {
                Balance = BillAmount - SettlementTotal;
                SetMedBillBalanceSafely(Balance);

            }

            Decimal TotalSharedAmount = 0;
            for (int i = 0; i < gvSettlementsInMedBill.Rows.Count; i++)
            {
                Decimal SharedAmount = 0;
                Decimal MedicalProviderRefund = 0;
                Decimal result = 0;

                if (gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "CMM Provider Payment" ||
                    gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "CMM Member Reimbursement" ||
                    gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "PR Reimbursement")
                {
                    if (Decimal.TryParse(gvSettlementsInMedBill["SettlementAmount", i].Value.ToString(), NumberStyles.Currency, new CultureInfo("en-US"), out result))
                    {
                        SharedAmount = result;
                        TotalSharedAmount += SharedAmount;
                        //txtTotalSharedAmtMedBill.Text = TotalSharedAmount.ToString("C");
                        SetTotalSharedAmountSafely(TotalSharedAmount);
                    }
                }
                else if (gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "Medical Provider Refund")
                {
                    if (Decimal.TryParse(gvSettlementsInMedBill["SettlementAmount", i]?.Value?.ToString(), NumberStyles.Currency, new CultureInfo("en-US"), out result))
                    {
                        MedicalProviderRefund = result;
                        TotalSharedAmount -= MedicalProviderRefund;
                        //txtTotalSharedAmtMedBill.Text = TotalSharedAmount.ToString("C");
                        SetTotalSharedAmountSafely(TotalSharedAmount);
                    }
                }
            }

            for (int i = 0; i < gvSettlementsInMedBill.Rows.Count; i++)
            {
                if (gvSettlementsInMedBill[2, i]?.Value?.ToString() == "Ineligible") gvSettlementsInMedBill.Rows[i].DefaultCellStyle.BackColor = Color.Salmon;
                else
                {
                    gvSettlementsInMedBill["IneligibleReason", i].Value = null;
                    gvSettlementsInMedBill["IneligibleReason", i].ReadOnly = true;
                }
            }

            //btnAddNewSettlement.Enabled = true;
            ////btnEditSettlement.Enabled = true;
            //btnSaveSettlement.Enabled = true;
            //btnDeleteSettlement.Enabled = true;

            //tbCMMManager.TabPages.Insert(4, tbpgMedicalBill);
            //tbCMMManager.SelectedIndex = 4;
            //SetTabPageCMMManagerSafely(5);




            ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
            ///
            //String strSqlQueryForSettlement = "select [dbo].[tbl_settlement].[Name], [dbo].[tbl_settlement_type_code].[SettlementTypeValue], [dbo].[tbl_settlement].[Amount], " +
            //                      "[dbo].[tbl_settlement].[PersonalResponsibilityCredit], [dbo].[tbl_settlement].[Approved], [dbo].[tbl_settlement].[ApprovedDate], " +
            //                      "[dbo].[tbl_payment_method].[PaymentMethod_Value], " +
            //                      "[dbo].[tbl_settlement].[CheckNo], [dbo].[tbl_settlement].[CheckDate], [dbo].[tbl_settlement].[CheckReconciled], " +
            //                      "[dbo].[tbl_settlement].[ACH_Number], [dbo].[tbl_settlement].[ACH_Date], [dbo].[tbl_settlement].[ACH_Reconciled], " +
            //                      "[dbo].[tbl_Credit_Card__c].[Name], [dbo].[tbl_settlement].[CMMCreditCardPaidDate], [dbo].[tbl_settlement].[CC_Reconciled], " +
            //                      "[dbo].[tbl_settlement].[AllowedAmount], [dbo].[tbl_settlement].[Notes] " +
            //                      "from [dbo].[tbl_settlement] inner join [dbo].[tbl_settlement_type_code] " +
            //                      "on [dbo].[tbl_settlement].[SettlementType] = [dbo].[tbl_settlement_type_code].[SettlementTypeCode] " +
            //                      "inner join [dbo].[tbl_payment_method] on [dbo].[tbl_settlement].[CMMPaymentMethod] = [dbo].[tbl_payment_method].[PaymentMethod_Id] " +
            //                      "inner join [dbo].[tbl_Credit_Card__c] on [dbo].[tbl_settlement].[CMMCreditCard] = [dbo].[tbl_Credit_Card__c].[CreditCard_Id]" +
            //                      "where [dbo].[tbl_settlement].[MedicalBillID] = @MedBillNo and [dbo].[tbl_settlement].[IsDeleted] = 0 " +
            //                      "order by [dbo].[tbl_settlement].[Name]";

            //SqlCommand cmdQueryForSettlement = new SqlCommand(strSqlQueryForSettlement, connRN);
            //cmdQueryForSettlement.CommandType = CommandType.Text;

            //cmdQueryForSettlement.Parameters.AddWithValue("@MedBillNo", MedBillNo);

            ////SqlDependency dependencySettlementInMedBill = new SqlDependency(cmdQueryForSettlement);
            ////dependencySettlementInMedBill.OnChange += new OnChangeEventHandler(OnSettlementsInMedBillEditChange);

            //gvSettlementsInMedBill.Columns["SettlementAmount"].DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleRight;
            //gvSettlementsInMedBill.Columns["PersonalResponsibility"].DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleRight;
            //gvSettlementsInMedBill.Columns["AllowedAmount"].DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleRight;

            //connRN.Open();
            //SqlDataReader rdrSettlement = cmdQueryForSettlement.ExecuteReader();

            ////while (gvSettlementsInMedBill.Rows.Count > 0)
            ////{
            ////    gvSettlementsInMedBill.Rows.RemoveAt(0);
            ////}

            //gvSettlementsInMedBill.Rows.Clear();
            /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
            /////
            //if (rdrSettlement.HasRows)
            //{
            //    while (rdrSettlement.Read())
            //    {

            //        DataGridViewRow row = new DataGridViewRow();
            //        row.Cells.Add(new DataGridViewCheckBoxCell { Value = false });
            //        if (!rdrSettlement.IsDBNull(0)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlement.GetString(0) });
            //        if (!rdrSettlement.IsDBNull(1))
            //        {
            //            DataGridViewComboBoxCell comboCellSettlementType = new DataGridViewComboBoxCell();

            //            for (int i = 0; i < lstSettlementType.Count; i++)
            //            {
            //                comboCellSettlementType.Items.Add(lstSettlementType[i].SettlementTypeValue);
            //            }
            //            for (int i = 0; i < comboCellSettlementType.Items.Count; i++)
            //            {
            //                if (rdrSettlement.GetString(1) == comboCellSettlementType.Items[i].ToString())
            //                    comboCellSettlementType.Value = comboCellSettlementType.Items[i];
            //            }

            //            row.Cells.Add(comboCellSettlementType);
            //        }
            //        else
            //        {
            //            DataGridViewComboBoxCell comboCellSettlementType = new DataGridViewComboBoxCell();
            //            for (int i = 0; i < lstSettlementType.Count; i++)
            //            {
            //                comboCellSettlementType.Items.Add(lstSettlementType[i].SettlementTypeValue);
            //            }

            //            for (int i = 0; i < comboCellSettlementType.Items.Count; i++)
            //            {
            //                if (rdrSettlement.GetString(1) == comboCellSettlementType.Items[i].ToString())
            //                    comboCellSettlementType.Value = comboCellSettlementType.Items[i];
            //            }

            //            row.Cells.Add(comboCellSettlementType);
            //        }

            //        if (!rdrSettlement.IsDBNull(2)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlement.GetDecimal(2).ToString("C") });
            //        else
            //        {
            //            Decimal Zero = 0;
            //            row.Cells.Add(new DataGridViewTextBoxCell { Value = Zero.ToString("C") });
            //        }


            //        if (!rdrSettlement.IsDBNull(3)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlement.GetDecimal(3).ToString("C") });
            //        else
            //        {
            //            Decimal Zero = 0;
            //            row.Cells.Add(new DataGridViewTextBoxCell { Value = Zero.ToString("C") });
            //        }

            //        if (!rdrSettlement.IsDBNull(4))
            //        {

            //            DataGridViewCheckBoxCell approvedCell = new DataGridViewCheckBoxCell();
            //            approvedCell.Value = rdrSettlement.GetBoolean(4);
            //            approvedCell.Style.Alignment = DataGridViewContentAlignment.MiddleCenter;
            //            row.Cells.Add(approvedCell);
            //        }
            //        else row.Cells.Add(new DataGridViewCheckBoxCell { Value = null });

            //        if (!rdrSettlement.IsDBNull(5)) row.Cells.Add(new CalendarCell { Value = DateTime.Parse(rdrSettlement.GetDateTime(5).ToString("MM/dd/yyyy")) });
            //        else row.Cells.Add(new CalendarCell { Value = null });


            //        /////////////////////////////

            //        if (!rdrSettlement.IsDBNull(6))
            //        {
            //            DataGridViewComboBoxCell comboCellPaymentMethod = new DataGridViewComboBoxCell();

            //            for (int i = 0; i < lstPaymentMethod.Count; i++)
            //            {
            //                comboCellPaymentMethod.Items.Add(lstPaymentMethod[i].PaymentMethodValue);
            //            }

            //            for (int i = 0; i < comboCellPaymentMethod.Items.Count; i++)
            //            {
            //                if (rdrSettlement.GetString(6) == comboCellPaymentMethod.Items[i].ToString())
            //                    comboCellPaymentMethod.Value = comboCellPaymentMethod.Items[i];
            //            }

            //            row.Cells.Add(comboCellPaymentMethod);
            //        }
            //        else
            //        {
            //            DataGridViewComboBoxCell comboCellPaymentMethod = new DataGridViewComboBoxCell();

            //            for (int i = 0; i < lstPaymentMethod.Count; i++)
            //            {
            //                comboCellPaymentMethod.Items.Add(lstPaymentMethod[i].PaymentMethodValue);
            //            }

            //            for (int i = 0; i < comboCellPaymentMethod.Items.Count; i++)
            //            {
            //                if (rdrSettlement.GetString(6) == comboCellPaymentMethod.Items[i].ToString())
            //                    comboCellPaymentMethod.Value = comboCellPaymentMethod.Items[i];
            //            }

            //            row.Cells.Add(comboCellPaymentMethod);

            //        }

            //        if (!rdrSettlement.IsDBNull(7)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlement.GetString(7) });
            //        else row.Cells.Add(new DataGridViewTextBoxCell { Value = null });
            //        if (!rdrSettlement.IsDBNull(8)) row.Cells.Add(new CalendarCell { Value = DateTime.Parse(rdrSettlement.GetDateTime(8).ToString("MM/dd/yyyy")) });
            //        else row.Cells.Add(new CalendarCell { Value = null });
            //        if (!rdrSettlement.IsDBNull(9)) row.Cells.Add(new DataGridViewCheckBoxCell { Value = rdrSettlement.GetBoolean(9) });
            //        else row.Cells.Add(new DataGridViewCheckBoxCell { Value = null });
            //        if (!rdrSettlement.IsDBNull(10)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlement.GetString(10) });
            //        else row.Cells.Add(new DataGridViewTextBoxCell { Value = null });
            //        if (!rdrSettlement.IsDBNull(11)) row.Cells.Add(new CalendarCell { Value = DateTime.Parse(rdrSettlement.GetDateTime(11).ToString("MM/dd/yyyy")) });
            //        else row.Cells.Add(new CalendarCell { Value = null });
            //        if (!rdrSettlement.IsDBNull(12)) row.Cells.Add(new DataGridViewCheckBoxCell { Value = rdrSettlement.GetBoolean(12) });
            //        else row.Cells.Add(new DataGridViewCheckBoxCell { Value = null });

            //        if (!rdrSettlement.IsDBNull(13))
            //        {
            //            DataGridViewComboBoxCell comboCellCreditCard = new DataGridViewComboBoxCell();

            //            for (int i = 0; i < lstCreditCardInfo.Count; i++)
            //            {
            //                comboCellCreditCard.Items.Add(lstCreditCardInfo[i].CreditCardNo);
            //            }

            //            for (int i = 0; i < comboCellCreditCard.Items.Count; i++)
            //            {
            //                if (rdrSettlement.GetString(13) == comboCellCreditCard.Items[i].ToString())
            //                    comboCellCreditCard.Value = comboCellCreditCard.Items[i];
            //            }

            //            row.Cells.Add(comboCellCreditCard);
            //        }
            //        else
            //        {
            //            DataGridViewComboBoxCell comboCellCreditCard = new DataGridViewComboBoxCell();

            //            for (int i = 0; i < lstCreditCardInfo.Count; i++)
            //            {
            //                comboCellCreditCard.Items.Add(lstCreditCardInfo[i].CreditCardNo);
            //            }

            //            row.Cells.Add(comboCellCreditCard);
            //        }

            //        if (!rdrSettlement.IsDBNull(14)) row.Cells.Add(new CalendarCell { Value = DateTime.Parse(rdrSettlement.GetDateTime(14).ToString("MM/dd/yyyy")) });
            //        else row.Cells.Add(new CalendarCell { Value = null });
            //        if (!rdrSettlement.IsDBNull(15))
            //        {
            //            DataGridViewCheckBoxCell ccReconciledCell = new DataGridViewCheckBoxCell();
            //            ccReconciledCell.Value = rdrSettlement.GetBoolean(15);
            //            ccReconciledCell.Style.Alignment = DataGridViewContentAlignment.MiddleCenter;

            //            row.Cells.Add(ccReconciledCell);
            //        }
            //        else row.Cells.Add(new DataGridViewCheckBoxCell { Value = null });
            //        if (!rdrSettlement.IsDBNull(16)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlement.GetDecimal(16).ToString("C") });
            //        else row.Cells.Add(new DataGridViewTextBoxCell { Value = null });
            //        if (!rdrSettlement.IsDBNull(17)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlement.GetString(17) });
            //        else row.Cells.Add(new DataGridViewTextBoxCell { Value = null });


            //        gvSettlementsInMedBill.Rows.Add(row);
            //    }
            //}
            //connRN.Close();

            //for (int i = 0; i < gvSettlementsInMedBill.Rows.Count; i++)
            //{
            //    if (gvSettlementsInMedBill["PaymentMethod", i]?.Value?.ToString() == "Check")
            //    {
            //        gvSettlementsInMedBill.Rows[i].Cells["CheckNo"].ReadOnly = false;
            //        gvSettlementsInMedBill.Rows[i].Cells["CheckDate"].ReadOnly = false;
            //        gvSettlementsInMedBill.Rows[i].Cells["CheckReconciled"].ReadOnly = false;

            //        gvSettlementsInMedBill.Rows[i].Cells["ACHNo"].ReadOnly = true;
            //        gvSettlementsInMedBill.Rows[i].Cells["ACH_Date"].ReadOnly = true;
            //        gvSettlementsInMedBill.Rows[i].Cells["ACH_Reconciled"].ReadOnly = true;

            //        gvSettlementsInMedBill.Rows[i].Cells["CreditCard"].ReadOnly = true;
            //        gvSettlementsInMedBill.Rows[i].Cells["CMMCreditCardPaidDate"].ReadOnly = true;
            //        gvSettlementsInMedBill.Rows[i].Cells["CC_Reconciled"].ReadOnly = true;
            //    }

            //    if (gvSettlementsInMedBill["PaymentMethod", i]?.Value?.ToString() == "ACH/Banking")
            //    {
            //        gvSettlementsInMedBill.Rows[i].Cells["CheckNo"].ReadOnly = true;
            //        gvSettlementsInMedBill.Rows[i].Cells["CheckDate"].ReadOnly = true;
            //        gvSettlementsInMedBill.Rows[i].Cells["CheckReconciled"].ReadOnly = true;

            //        gvSettlementsInMedBill.Rows[i].Cells["ACHNo"].ReadOnly = false;
            //        gvSettlementsInMedBill.Rows[i].Cells["ACH_Date"].ReadOnly = false;
            //        gvSettlementsInMedBill.Rows[i].Cells["ACH_Reconciled"].ReadOnly = false;

            //        gvSettlementsInMedBill.Rows[i].Cells["CreditCard"].ReadOnly = true;
            //        gvSettlementsInMedBill.Rows[i].Cells["CMMCreditCardPaidDate"].ReadOnly = true;
            //        gvSettlementsInMedBill.Rows[i].Cells["CC_Reconciled"].ReadOnly = true;

            //    }

            //    if (gvSettlementsInMedBill["PaymentMethod", i]?.Value?.ToString() == "Credit Card")
            //    {
            //        gvSettlementsInMedBill.Rows[i].Cells["CheckNo"].ReadOnly = true;
            //        gvSettlementsInMedBill.Rows[i].Cells["CheckDate"].ReadOnly = true;
            //        gvSettlementsInMedBill.Rows[i].Cells["CheckReconciled"].ReadOnly = true;

            //        gvSettlementsInMedBill.Rows[i].Cells["ACHNo"].ReadOnly = true;
            //        gvSettlementsInMedBill.Rows[i].Cells["ACH_Date"].ReadOnly = true;
            //        gvSettlementsInMedBill.Rows[i].Cells["ACH_Reconciled"].ReadOnly = true;

            //        gvSettlementsInMedBill.Rows[i].Cells["CreditCard"].ReadOnly = false;
            //        gvSettlementsInMedBill.Rows[i].Cells["CMMCreditCardPaidDate"].ReadOnly = false;
            //        gvSettlementsInMedBill.Rows[i].Cells["CC_Reconciled"].ReadOnly = false;
            //    }
            //    if (gvSettlementsInMedBill["PaymentMethod", i]?.Value?.ToString() == "None")
            //    {
            //        gvSettlementsInMedBill.Rows[i].Cells["CheckNo"].ReadOnly = true;
            //        gvSettlementsInMedBill.Rows[i].Cells["CheckDate"].ReadOnly = true;
            //        gvSettlementsInMedBill.Rows[i].Cells["CheckReconciled"].ReadOnly = true;

            //        gvSettlementsInMedBill.Rows[i].Cells["ACHNo"].ReadOnly = true;
            //        gvSettlementsInMedBill.Rows[i].Cells["ACH_Date"].ReadOnly = true;
            //        gvSettlementsInMedBill.Rows[i].Cells["ACH_Reconciled"].ReadOnly = true;

            //        gvSettlementsInMedBill.Rows[i].Cells["CreditCard"].ReadOnly = true;
            //        gvSettlementsInMedBill.Rows[i].Cells["CMMCreditCardPaidDate"].ReadOnly = true;
            //        gvSettlementsInMedBill.Rows[i].Cells["CC_Reconciled"].ReadOnly = true;
            //    }
            //}

            //for (int i = 0; i < gvSettlementsInMedBill.Rows.Count; i++)
            //{
            //    if (gvSettlementsInMedBill[2, i]?.Value?.ToString() == "Ineligible") gvSettlementsInMedBill.Rows[i].DefaultCellStyle.BackColor = Color.Red;
            //}

            //btnAddNewSettlement.Enabled = true;
            //btnEditSettlement.Enabled = true;
            //btnSaveSettlement.Enabled = true;
            //btnDeleteSettlement.Enabled = true;

            //tbCMMManager.SelectedIndex = 4;
        }

        private void btnDeleteCase_Click(object sender, EventArgs e)
        {
            Boolean bSelected = false;

            for (int i = 0; i < gvCaseViewCaseHistory.Rows.Count; i++)
            {
                if ((Boolean)gvCaseViewCaseHistory[0, i]?.Value == true) bSelected = true;
            }

            if (!bSelected)
            {
                MessageBox.Show("You have to select at least one Case to delete.", "Alert");
                return;
            }


            DialogResult dlgResult = MessageBox.Show("Are you sure to delete these cases?", "Alert", MessageBoxButtons.YesNo);

            if (dlgResult == DialogResult.Yes)
            {
                List<CaseInfo> lstCaseInfoToDelete = new List<CaseInfo>();

                for (int i = 0; i < gvCaseViewCaseHistory.Rows.Count; i++)
                {
                    if ((Boolean)gvCaseViewCaseHistory[0, i].Value == true)
                    {
                        lstCaseInfoToDelete.Add(new CaseInfo { CaseName = gvCaseViewCaseHistory[1, i].Value.ToString(), IndividualId = txtCaseHistoryIndividualID.Text.Trim() });
                    }
                }

                Boolean bMedBillExist = false;
                if (lstCaseInfoToDelete.Count > 0)
                {
                    for (int i = 0; i < lstCaseInfoToDelete.Count; i++)
                    {
                        String strSqlQueryForMedBillForCase = "select [dbo].[tbl_medbill].[BillNo] from [dbo].[tbl_medbill] " +
                                                              "where [dbo].[tbl_medbill].[Case_Id] = @CaseName and [dbo].[tbl_medbill].[IsDeleted] = 0";

                        SqlCommand cmdQueryForMedBillForCase = new SqlCommand(strSqlQueryForMedBillForCase, connRN3);
                        cmdQueryForMedBillForCase.CommandType = CommandType.Text;

                        cmdQueryForMedBillForCase.Parameters.AddWithValue("@CaseName", lstCaseInfoToDelete[i].CaseName);

                        if (connRN3.State != ConnectionState.Closed)
                        {
                            connRN3.Close();
                            connRN3.Open();
                        }
                        else if (connRN3.State == ConnectionState.Closed) connRN3.Open();
                        Object objMedBillNo = cmdQueryForMedBillForCase.ExecuteScalar();
                        if (connRN3.State != ConnectionState.Closed) connRN3.Close();

                        if (objMedBillNo != null)
                        {
                            bMedBillExist = true;
                        }
                    }
                    if (bMedBillExist)
                    {
                        MessageBox.Show("Cannot delete the Case. Delete Medical Bills in the Case first.", "Alert");
                        return;
                    }
                }

                if (lstCaseInfoToDelete.Count > 0)
                {
                    try
                    {
                        Boolean bError = false;
                        if (connRN3.State != ConnectionState.Closed)
                        {
                            connRN3.Close();
                            connRN3.Open();
                        }
                        else if (connRN3.State == ConnectionState.Closed) connRN3.Open();

                        SqlTransaction transDelete = connRN3.BeginTransaction();

                        for (int i = 0; i < lstCaseInfoToDelete.Count; i++)
                        {
                            String strSqlDeleteCaseSelected = "update [dbo].[tbl_case] set [dbo].[tbl_case].[IsDeleted] = 1 " +
                                                              "where [dbo].[tbl_case].[Case_Name] = @CaseName and [dbo].[tbl_case].[Contact_ID] = @IndividualId";

                            SqlCommand cmdDeleteCaseSelected = new SqlCommand(strSqlDeleteCaseSelected, connRN3, transDelete);
                            cmdDeleteCaseSelected.CommandType = CommandType.Text;

                            cmdDeleteCaseSelected.Parameters.AddWithValue("@CaseName", lstCaseInfoToDelete[i].CaseName);
                            cmdDeleteCaseSelected.Parameters.AddWithValue("@IndividualId", lstCaseInfoToDelete[i].IndividualId);

                            //if (connRN.State == ConnectionState.Closed) connRN.Open();

                            int nRowDeleted = cmdDeleteCaseSelected.ExecuteNonQuery();
                            if (nRowDeleted == 0) bError = true;

                        }
                        transDelete.Commit();
                        //if (bError == true) MessageBox.Show("Some of cases have not been deleted.", "Error");
                    }
                    catch (SqlException ex)
                    {
                        MessageBox.Show(ex.Message, "Error");
                    }
                    finally
                    {
                        if (connRN3.State != ConnectionState.Closed) connRN3.Close();
                    }
                }
                //else MessageBox.Show("No case is selected");
            }
            else return;
        }

        private void btnDeleteSettlement_Click(object sender, EventArgs e)
        {
            //if (txtMedBill_Illness.Text.Trim() != String.Empty && txtMedBill_Incident.Text.Trim() != String.Empty)
            //{

            if (txtMedBill_Illness.Text.Trim() == String.Empty)
            {
                MessageBox.Show("Illness No is empty", "Error");
                return;
            }

            if (txtMedBill_Incident.Text.Trim() == String.Empty)
            {
                MessageBox.Show("Incident No is empty.", "Error");
                return;
            }

            List<String> lstSettlements = new List<String>();
            for (int i = 0; i < gvSettlementsInMedBill.Rows.Count; i++)
            {
                if ((Boolean)gvSettlementsInMedBill[0, i]?.Value == true) lstSettlements.Add(gvSettlementsInMedBill[1, i]?.Value?.ToString());
            }

            if (lstSettlements.Count == 0)
            {
                MessageBox.Show("You have not selected settlement to delete");
                return;
            }

            DialogResult dr = MessageBox.Show("Are you sure to delete selected settlements?", "Alert", MessageBoxButtons.YesNo);

            if (dr == DialogResult.Yes)     // delete settlement
            {
                String MedBillNo = txtMedBillNo.Text.Trim();
                int nSettlementToDelete = lstSettlements.Count;
                int nDeletedSettlements = 0;

                //foreach (String settlement in lstSettlements)
                for (int i = 0; i < gvSettlementsInMedBill.Rows.Count; i++)
                {
                    if ((Boolean)gvSettlementsInMedBill[0, i]?.Value == true)
                    {
                        String strSqlQueryForSettlement = "select [dbo].[tbl_settlement].[Name] from [dbo].[tbl_settlement] where [dbo].[tbl_settlement].[Name] = @SettlementNo";

                        SqlCommand cmdQueryForSettlement = new SqlCommand(strSqlQueryForSettlement, connRN5);
                        cmdQueryForSettlement.CommandType = CommandType.Text;

                        //cmdQueryForSettlement.Parameters.AddWithValue("@SettlementNo", settlement);
                        cmdQueryForSettlement.Parameters.AddWithValue("@SettlementNo", gvSettlementsInMedBill[1, i]?.Value?.ToString());

                        //if (connRN.State == ConnectionState.Closed) connRN.Open();
                        if (connRN5.State != ConnectionState.Closed)
                        {
                            connRN5.Close();
                            connRN5.Open();
                        }
                        else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                        //String Settlement = cmdQueryForSettlement.ExecuteScalar()?.ToString();
                        Object objSettlement = cmdQueryForSettlement.ExecuteScalar();

                        String Settlement = String.Empty;
                        if (objSettlement != null) Settlement = objSettlement.ToString();

                        if (connRN5.State != ConnectionState.Closed) connRN5.Close();
                        if (Settlement == String.Empty)
                        {
                            String strSettlementAmount = String.Empty;
                            if (gvSettlementsInMedBill["SettlementAmount", i]?.Value?.ToString() != String.Empty) strSettlementAmount = gvSettlementsInMedBill["SettlementAmount", i]?.Value?.ToString();
                            Decimal SettlementAmount = 0;
                            Decimal ResultSettlementAmount = 0;

                            if (strSettlementAmount != String.Empty)
                            {
                                if (Decimal.TryParse(strSettlementAmount, NumberStyles.Currency, new CultureInfo("en-US"), out ResultSettlementAmount))
                                    SettlementAmount = ResultSettlementAmount;

                                String strMedBillTotalSharedAmount = String.Empty;
                                Decimal MedBillTotalSharedAmount = 0;
                                Decimal ResultMedBillTotalSharedAmount = 0;
                                if (txtTotalSharedAmtMedBill.Text.Trim() != String.Empty)
                                {
                                    strMedBillTotalSharedAmount = txtTotalSharedAmtMedBill.Text.Trim();

                                    if (Decimal.TryParse(strMedBillTotalSharedAmount, NumberStyles.Currency, new CultureInfo("en-US"), out ResultMedBillTotalSharedAmount))
                                    {
                                        MedBillTotalSharedAmount = ResultMedBillTotalSharedAmount;
                                        MedBillTotalSharedAmount -= SettlementAmount;
                                        txtTotalSharedAmtMedBill.Text = MedBillTotalSharedAmount.ToString("C");

                                        gvSettlementsInMedBill.Rows.RemoveAt(i);
                                        nDeletedSettlements++;
                                    }
                                }
                            }


                            //for (int i = 0; i < gvSettlementsInMedBill.Rows.Count; i++)
                            //{
                            //    if (settlement == gvSettlementsInMedBill[1, i]?.Value?.ToString())
                            //    {
                            //        gvSettlementsInMedBill.Rows.RemoveAt(i);
                            //        nDeletedSettlements++;
                            //    }
                            //}
                        }
                        else
                        {
                            String strSqlQuerySettlementForApproved = "select [dbo].[tbl_settlement].[Approved] from [dbo].[tbl_settlement] where [dbo].[tbl_settlement].[Name] = @SettlementName";

                            SqlCommand cmdQuerySettlementForApproved = new SqlCommand(strSqlQuerySettlementForApproved, connRN5);
                            cmdQuerySettlementForApproved.CommandType = CommandType.Text;

                            cmdQuerySettlementForApproved.Parameters.AddWithValue("@SettlementName", Settlement);

                            if (connRN5.State != ConnectionState.Closed)
                            {
                                connRN5.Close();
                                connRN5.Open();
                            }
                            else if (connRN5.State == ConnectionState.Closed) connRN5.Open();

                            Boolean bApproved = false;
                            SqlDataReader rdrSettlementApproved = cmdQuerySettlementForApproved.ExecuteReader();
                            if (rdrSettlementApproved.HasRows)
                            {
                                rdrSettlementApproved.Read();

                                if (!rdrSettlementApproved.IsDBNull(0)) bApproved = rdrSettlementApproved.GetBoolean(0);
                            }
                            rdrSettlementApproved.Close();
                            if (connRN5.State != ConnectionState.Closed) connRN.Close();

                            if (bApproved == true &&
                                (LoggedInUserRole == UserRole.FDStaff || LoggedInUserRole == UserRole.NPStaff || LoggedInUserRole == UserRole.RNStaff))
                            {
                                MessageBox.Show("The Settlement is approved and cannot be deleted.", "Alert");
                                return;
                            }

                            if (bApproved == true &&
                                (LoggedInUserRole == UserRole.FDManager || LoggedInUserRole == UserRole.NPManager || LoggedInUserRole == UserRole.RNManager))
                            {
                                MessageBox.Show("The Settlement is approved and cannot be deleted.", "Alert");
                                return;
                            }

                            if (bApproved == false ||
                                (bApproved == true && LoggedInUserRole == UserRole.SuperAdmin))
                            {
                                string settlementToDelete = gvSettlementsInMedBill[1, i]?.Value?.ToString();

                                String strSqlUpdateSettlement = "update [dbo].[tbl_settlement] set [dbo].[tbl_settlement].[IsDeleted] = 1 " +
                                                                "where [dbo].[tbl_settlement].[Name] = @SettlementNo and " +
                                                                "[dbo].[tbl_settlement].[MedicalBillID] = @MedicalBillNo";

                                SqlCommand cmdUpdateSettlement = new SqlCommand(strSqlUpdateSettlement, connRN5);
                                cmdUpdateSettlement.CommandType = CommandType.Text;

                                cmdUpdateSettlement.Parameters.AddWithValue("@SettlementNo", settlementToDelete);
                                cmdUpdateSettlement.Parameters.AddWithValue("@MedicalBillNo", MedBillNo);

                                if (connRN5.State != ConnectionState.Closed)
                                {
                                    connRN5.Close();
                                    connRN5.Open();
                                }
                                else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                                int nSettlementDeleted = cmdUpdateSettlement.ExecuteNonQuery();
                                if (connRN5.State != ConnectionState.Closed) connRN5.Close();

                                if (nSettlementDeleted == 1) nDeletedSettlements++;

                                String strSettlementTypeValue = gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString();

                                if (strSettlementTypeValue == "CMM Member Reimbursement" ||
                                    strSettlementTypeValue == "CMM Provider Payment" ||
                                    strSettlementTypeValue == "PR Reimbursement")
                                {

                                    String SettlementAmount = String.Empty;
                                    if (gvSettlementsInMedBill["SettlementAmount", i]?.Value?.ToString() != null) SettlementAmount = gvSettlementsInMedBill["SettlementAmount", i]?.Value?.ToString();

                                    Decimal SettlementSharedAmount = 0;
                                    Decimal result = 0;

                                    if (SettlementAmount != String.Empty)
                                    {
                                        if (Decimal.TryParse(SettlementAmount, NumberStyles.Currency, new CultureInfo("en-US"), out result)) SettlementSharedAmount = result;
                                    }

                                    String strTotalSharedAmount = String.Empty;

                                    Decimal MedBillTotalSharedAmount = 0;
                                    Decimal ResultTotalShareAmountMedBill = 0;

                                    String strTotalSharedAmountMedBill = txtTotalSharedAmtMedBill.Text.Trim();
                                    if (strTotalSharedAmountMedBill != String.Empty)
                                    {
                                        if (Decimal.TryParse(strTotalSharedAmountMedBill, NumberStyles.Currency, new CultureInfo("en-US"), out ResultTotalShareAmountMedBill))
                                            MedBillTotalSharedAmount = ResultTotalShareAmountMedBill;
                                    }

                                    MedBillTotalSharedAmount -= SettlementSharedAmount;

                                    String strMedBillNoForTotalSharedAmount = txtMedBillNo.Text.Trim();

                                    String strSqlUpdateMedBillTotalSharedAmount = "update [dbo].[tbl_medbill] set [dbo].[tbl_medbill].[TotalSharedAmount] = @MedBillTotalSharedAmount " +
                                                                                  "where [dbo].[tbl_medbill].[BillNo] = @MedBillNo";

                                    SqlCommand cmdUpdateMedBillTotalSharedAmount = new SqlCommand(strSqlUpdateMedBillTotalSharedAmount, connRN5);
                                    cmdUpdateMedBillTotalSharedAmount.CommandType = CommandType.Text;

                                    cmdUpdateMedBillTotalSharedAmount.Parameters.AddWithValue("@MedBillTotalSharedAmount", MedBillTotalSharedAmount);
                                    cmdUpdateMedBillTotalSharedAmount.Parameters.AddWithValue("@MedBillNo", MedBillNo);

                                    if (connRN5.State != ConnectionState.Closed)
                                    {
                                        connRN5.Open();
                                        connRN5.Close();
                                    }
                                    else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                                    int nMedBillUpdated = cmdUpdateMedBillTotalSharedAmount.ExecuteNonQuery();
                                    if (connRN5.State != ConnectionState.Closed) connRN5.Close();

                                    Boolean bMedBillUpdated = false;
                                    if (nMedBillUpdated == 1)
                                    {
                                        bMedBillUpdated = true;
                                    }

                                    String strSqlQueryForSettlementTotalMedBill = "select [dbo].[tbl_medbill].[SettlementTotal] from [dbo].[tbl_medbill] where [dbo].[tbl_medbill].[BillNo] = @MedBillNo";

                                    SqlCommand cmdQueryForSettlementTotalMedBill = new SqlCommand(strSqlQueryForSettlementTotalMedBill, connRN5);
                                    cmdQueryForSettlementTotalMedBill.CommandType = CommandType.Text;

                                    cmdQueryForSettlementTotalMedBill.Parameters.AddWithValue("@MedBillNo", MedBillNo);

                                    if (connRN5.State != ConnectionState.Closed)
                                    {
                                        connRN5.Close();
                                        connRN5.Open();
                                    }
                                    else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                                    Object objSettlementTotalMedBill = cmdQueryForSettlementTotalMedBill.ExecuteScalar();
                                    if (connRN5.State != ConnectionState.Closed) connRN5.Close();

                                    Decimal SettlementTotalMedBill = 0;
                                    if (objSettlementTotalMedBill != null) SettlementTotalMedBill = Decimal.Parse(objSettlementTotalMedBill.ToString());

                                    SettlementTotalMedBill -= SettlementSharedAmount;

                                    String strSqlUpdateSettlementTotalMedBill = "update [dbo].[tbl_medbill] set [dbo].[tbl_medbill].[SettlementTotal] = @NewSettlementTotal " +
                                                                                "where [dbo].[tbl_medbill].[BillNo] = @MedBillNo";

                                    SqlCommand cmdUpdateSettlementTotalMedBill = new SqlCommand(strSqlUpdateSettlementTotalMedBill, connRN5);
                                    cmdUpdateSettlementTotalMedBill.CommandType = CommandType.Text;

                                    cmdUpdateSettlementTotalMedBill.Parameters.AddWithValue("@NewSettlementTotal", SettlementTotalMedBill);
                                    cmdUpdateSettlementTotalMedBill.Parameters.AddWithValue("@MedBillNo", MedBillNo);

                                    if (connRN5.State != ConnectionState.Closed)
                                    {
                                        connRN5.Close();
                                        connRN5.Open();
                                    }
                                    else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                                    int nMedBillSettlementTotalUpdated = cmdUpdateSettlementTotalMedBill.ExecuteNonQuery();
                                    if (connRN5.State != ConnectionState.Closed) connRN5.Close();

                                    Boolean bMedBillSettlementTotalUpdated = false;
                                    if (nMedBillSettlementTotalUpdated == 1) bMedBillSettlementTotalUpdated = true;

                                    String IncidentNo = txtMedBill_Incident.Text.Trim();
                                    String strSqlQueryForIncidentId = "select [dbo].[tbl_incident].[Incident_id] from [dbo].[tbl_incident] where [dbo].[tbl_incident].[IncidentNo] = @IncidentNo";

                                    SqlCommand cmdQueryForIncidentId = new SqlCommand(strSqlQueryForIncidentId, connRN5);
                                    cmdQueryForIncidentId.CommandType = CommandType.Text;

                                    cmdQueryForIncidentId.Parameters.AddWithValue("@IncidentNo", IncidentNo);
                                    if (connRN5.State != ConnectionState.Closed)
                                    {
                                        connRN5.Close();
                                        connRN5.Open();
                                    }
                                    else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                                    Object objIncidendId = cmdQueryForIncidentId.ExecuteScalar();
                                    if (connRN5.State != ConnectionState.Closed) connRN5.Close();

                                    int nIncidentId = 0;
                                    if (objIncidendId != null) nIncidentId = (int)objIncidendId;

                                    String strSqlQueryForSumTotalSharedAmountMedBill = "select sum([dbo].[tbl_medbill].[TotalSharedAmount]) from [dbo].[tbl_medbill] " +
                                                                                       "where [dbo].[tbl_medbill].[IsDeleted] = 0 and " +
                                                                                       "[dbo].[tbl_medbill].[Incident_Id] = @IncidentId";

                                    SqlCommand cmdQueryForSumTotalSharedAmountMedBill = new SqlCommand(strSqlQueryForSumTotalSharedAmountMedBill, connRN5);
                                    cmdQueryForSumTotalSharedAmountMedBill.CommandType = CommandType.Text;

                                    cmdQueryForSumTotalSharedAmountMedBill.Parameters.AddWithValue("@IncidentId", nIncidentId);

                                    if (connRN5.State != ConnectionState.Closed)
                                    {
                                        connRN5.Close();
                                        connRN5.Open();
                                    }
                                    else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                                    Object objSumTotalSharedAmountMedBill = cmdQueryForSumTotalSharedAmountMedBill.ExecuteScalar();
                                    if (connRN5.State != ConnectionState.Closed) connRN5.Close();

                                    Decimal SumTotalSharedAmountMedBill = 0;
                                    if (objSumTotalSharedAmountMedBill.ToString() != String.Empty) SumTotalSharedAmountMedBill = (Decimal)objSumTotalSharedAmountMedBill;
                                    //if (objSumTotalSharedAmountMedBill.ToString() != String.Empty)
                                    //{
                                    //    Decimal ResultSumTotalSharedAmountMedBill = 0;
                                    //    if (Decimal.TryParse(objSumTotalSharedAmountMedBill.ToString(), NumberStyles.Currency, new CultureInfo("en-US"), out ResultSumTotalSharedAmountMedBill))
                                    //        SumTotalSharedAmountMedBill = ResultSumTotalSharedAmountMedBill;
                                    //}

                                    String strSqlUpdateTotalSharedAmountIncident = "update [dbo].[tbl_incident] set [dbo].[tbl_incident].[TotalSharedAmount] = @TotalSharedAmount " +
                                                                                   "where [dbo].[tbl_incident].[Incident_id] = @IncidentId";

                                    SqlCommand cmdUpdateTotalSharedAmountIncident = new SqlCommand(strSqlUpdateTotalSharedAmountIncident, connRN5);
                                    cmdUpdateTotalSharedAmountIncident.CommandType = CommandType.Text;

                                    cmdUpdateTotalSharedAmountIncident.Parameters.AddWithValue("@TotalSharedAmount", SumTotalSharedAmountMedBill);
                                    cmdUpdateTotalSharedAmountIncident.Parameters.AddWithValue("@IncidentId", nIncidentId);

                                    if (connRN5.State != ConnectionState.Closed)
                                    {
                                        connRN5.Close();
                                        connRN5.Open();
                                    }
                                    else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                                    int nTotalSharedAmountIncidentUpdated = cmdUpdateTotalSharedAmountIncident.ExecuteNonQuery();
                                    if (connRN5.State != ConnectionState.Closed) connRN5.Close();

                                    Boolean bTotalSharedAmountIncidentUpdated = false;
                                    if (nTotalSharedAmountIncidentUpdated == 1) bTotalSharedAmountIncidentUpdated = true;

                                    String IllnessNo = txtMedBill_Illness.Text.Trim();
                                    String strSqlQueryForIllnessId = "select [dbo].[tbl_illness].[Illness_Id] from [dbo].[tbl_illness] where [dbo].[tbl_illness].[IllnessNo] = @IllnessNo";

                                    SqlCommand cmdQueryforIllnessId = new SqlCommand(strSqlQueryForIllnessId, connRN5);
                                    cmdQueryforIllnessId.CommandType = CommandType.Text;

                                    cmdQueryforIllnessId.Parameters.AddWithValue("@IllnessNo", IllnessNo);
                                    if (connRN5.State != ConnectionState.Closed)
                                    {
                                        connRN5.Close();
                                        connRN5.Open();
                                    }
                                    else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                                    Object objIllnessId = cmdQueryforIllnessId.ExecuteScalar();
                                    if (connRN5.State != ConnectionState.Closed) connRN5.Close();

                                    int nIllnessId = 0;
                                    if (objIllnessId != null) nIllnessId = (int)objIllnessId;

                                    String strSqlQueryForSumTotalSharedAmountIncident = "select sum([dbo].[tbl_incident].[TotalSharedAmount]) from [dbo].[tbl_incident] " +
                                                                                        "where [dbo].[tbl_incident].[IsDeleted] = 0 and " +
                                                                                        "[dbo].[tbl_incident].[Illness_id] = @IllnessId";

                                    SqlCommand cmdQueryForSumTotalSharedAmountIncident = new SqlCommand(strSqlQueryForSumTotalSharedAmountIncident, connRN5);
                                    cmdQueryForSumTotalSharedAmountIncident.CommandType = CommandType.Text;

                                    cmdQueryForSumTotalSharedAmountIncident.Parameters.AddWithValue("@IllnessId", nIllnessId);
                                    if (connRN5.State != ConnectionState.Closed)
                                    {
                                        connRN5.Close();
                                        connRN5.Open();
                                    }
                                    else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                                    Object objSumTotalSharedAmountIncident = cmdQueryForSumTotalSharedAmountIncident.ExecuteScalar();
                                    if (connRN5.State != ConnectionState.Closed) connRN5.Close();

                                    Decimal SumTotalSharedAmountIncident = 0;
                                    if (objSumTotalSharedAmountIncident.ToString() != String.Empty) SumTotalSharedAmountIncident = (Decimal)objSumTotalSharedAmountIncident;

                                    String strSqlUpdateTotalSharedAmountIllness = "update [dbo].[tbl_illness] set [dbo].[tbl_illness].[TotalSharedAmount] = @TotalSharedAmount " +
                                                                                  "where [dbo].[tbl_illness].[Illness_Id] = @IllnessId";

                                    SqlCommand cmdUpdateTotalSharedAmountIllness = new SqlCommand(strSqlUpdateTotalSharedAmountIllness, connRN5);
                                    cmdUpdateTotalSharedAmountIllness.CommandType = CommandType.Text;

                                    cmdUpdateTotalSharedAmountIllness.Parameters.AddWithValue("@TotalSharedAmount", SumTotalSharedAmountIncident);
                                    cmdUpdateTotalSharedAmountIllness.Parameters.AddWithValue("@IllnessId", nIllnessId);

                                    if (connRN5.State != ConnectionState.Closed)
                                    {
                                        connRN5.Close();
                                        connRN5.Open();
                                    }
                                    else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                                    int nTotalSharedAmountIllnessUpdated = cmdUpdateTotalSharedAmountIllness.ExecuteNonQuery();
                                    if (connRN5.State != ConnectionState.Closed) connRN5.Close();

                                    Boolean bTotalSharedAmountIllnessUpdated = false;
                                    if (nTotalSharedAmountIllnessUpdated == 1) bTotalSharedAmountIllnessUpdated = true;

                                    String IndividualId = txtIndividualIDMedBill.Text.Trim();
                                    string strSqlQueryForTotalSharedAmountForIndividual = "select sum([dbo].[tbl_illness].[TotalSharedAmount]) from [dbo].[tbl_illness] " +
                                                                                          "where [dbo].[tbl_illness].[Individual_Id] = @IndividualId";

                                    SqlCommand cmdQueryForTotalSharedAmountForIndividual = new SqlCommand(strSqlQueryForTotalSharedAmountForIndividual, connRN5);
                                    cmdQueryForTotalSharedAmountForIndividual.CommandType = CommandType.Text;

                                    cmdQueryForTotalSharedAmountForIndividual.Parameters.AddWithValue("@IndividualId", IndividualId);

                                    if (connRN5.State != ConnectionState.Closed)
                                    {
                                        connRN5.Close();
                                        connRN5.Open();
                                    }
                                    else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                                    Object objTotalSharedAmountIllness = cmdQueryForTotalSharedAmountForIndividual.ExecuteScalar();
                                    if (connRN5.State != ConnectionState.Closed) connRN5.Close();

                                    Decimal TotalSharedAmountIllness = 0;
                                    if (objTotalSharedAmountIllness != null) TotalSharedAmountIllness = (Decimal)objTotalSharedAmountIllness;

                                    String strSqlUpdateTotalSharedAmountForIndividual = "update [dbo].[contact] set [dbo].[contact].[c4g_Total_Shared_Amount__c] = @TotalSharedAmount " +
                                                                                        "where [dbo].[contact].[Individual_ID__c] = @IndividualId";

                                    SqlCommand cmdUpdateTotalSharedAmountForIndividual = new SqlCommand(strSqlUpdateTotalSharedAmountForIndividual, connSalesforce3);
                                    cmdUpdateTotalSharedAmountForIndividual.CommandType = CommandType.Text;

                                    cmdUpdateTotalSharedAmountForIndividual.Parameters.AddWithValue("@TotalSharedAmount", TotalSharedAmountIllness);
                                    cmdUpdateTotalSharedAmountForIndividual.Parameters.AddWithValue("@IndividualId", IndividualId);

                                    if (connSalesforce3.State != ConnectionState.Closed)
                                    {
                                        connSalesforce3.Close();
                                        connSalesforce3.Open();
                                    }
                                    else if (connSalesforce3.State == ConnectionState.Closed) connSalesforce3.Open();
                                    int nContactUpdatedForTotalSharedAmount = cmdUpdateTotalSharedAmountForIndividual.ExecuteNonQuery();
                                    if (connSalesforce3.State != ConnectionState.Closed) connSalesforce3.Close();

                                    txtTotalSharedAmount.Text = TotalSharedAmountIllness.ToString("C");
                                }

                                //String strIncidentTotalSharedAmount = txtTotalSharedAmtMedBill.Text.Trim();
                                //Decimal IncidentTotalSharedAmount = 0;
                                //Decimal result = 0;
                                //if (Decimal.TryParse(strIncidentTotalSharedAmount, NumberStyles.Currency, new CultureInfo("en-US"), out result))
                                //    IncidentTotalSharedAmount = result;

                                //int nIndexSharedToDelete = 0;

                                //for (int i = 0; i < gvSettlementsInMedBill.Rows.Count; i++)
                                //{
                                //    if (gvSettlementsInMedBill["SettlementName", i]?.Value?.ToString() == settlement) nIndexSharedToDelete = i;
                                //}

                                //if (gvSettlementsInMedBill["SettlementTypeValue", nIndexSharedToDelete]?.Value?.ToString() == "CMM Member Reimbursement" ||
                                //    gvSettlementsInMedBill["SettlementTypeValue", nIndexSharedToDelete]?.Value?.ToString() == "CMM Provider Payment" ||
                                //    gvSettlementsInMedBill["SettlementTypeValue", nIndexSharedToDelete]?.Value?.ToString() == "PR Reimbursement")
                                //{
                                //    Decimal resultSettlement = 0;
                                //    String SettlementAmount = gvSettlementsInMedBill["SettlementAmount", nIndexSharedToDelete]?.Value?.ToString();
                                //    if (Decimal.TryParse(SettlementAmount, NumberStyles.Currency, new CultureInfo("en-US"), out resultSettlement))
                                //        IncidentTotalSharedAmount -= resultSettlement;
                                //}

                                //if (connRN5.State != ConnectionState.Closed)
                                //{
                                //    connRN5.Close();
                                //    connRN5.Open();
                                //}
                                //else if (connRN5.State == ConnectionState.Closed) connRN5.Open();

                                //SqlCommand cmdUpdate = connRN5.CreateCommand();
                                //SqlTransaction transaction;

                                //transaction = connRN5.BeginTransaction(IsolationLevel.ReadCommitted);

                                //cmdUpdate.Connection = connRN5;
                                //cmdUpdate.Transaction = transaction;

                                //try
                                //{

                                //    String strSqlUpdateSettlement = "update [dbo].[tbl_settlement] set [dbo].[tbl_settlement].[IsDeleted] = 1 " +
                                //                                    "where [dbo].[tbl_settlement].[Name] = @SettlementNo and " +
                                //                                    "[dbo].[tbl_settlement].[MedicalBillID] = @MedicalBillNo";

                                //    cmdUpdate.CommandText = strSqlUpdateSettlement;
                                //    cmdUpdate.Parameters.AddWithValue("@SettlementNo", settlement);
                                //    cmdUpdate.Parameters.AddWithValue("@MedicalBillNo", MedBillNo);
                                //    cmdUpdate.ExecuteNonQuery();

                                //    String strSqlUpdateIncidentSettlementTotal = "update [dbo].[tbl_incident] set [dbo].[tbl_incident].[TotalSharedAmount] = @ " +
                                //                                                 "where [dbo].[tbl_incident].[IncidentNo] = @";


                                //    //SqlCommand cmdUpdateSettlement = new SqlCommand(strSqlUpdateSettlement, connRN5);
                                //    //cmdUpdateSettlement.CommandType = CommandType.Text;

                                //    //cmdUpdateSettlement.Parameters.AddWithValue("@SettlementNo", settlement);
                                //    //cmdUpdateSettlement.Parameters.AddWithValue("@MedicalBillNo", MedBillNo);



                                //    //if (connRN.State == ConnectionState.Closed) connRN.Open();

                                //    //int nRowAffected = cmdUpdateSettlement.ExecuteNonQuery();
                                //    //if (connRN5.State != ConnectionState.Closed) connRN5.Close();

                                //    //if (nRowAffected == 1) nDeletedSettlements++;
                                //}
                                //catch (Exception ex)
                                //{

                                //}
                            }
                        }
                    }
                }

                for (int i = 0; i < gvSettlementsInMedBill.Rows.Count; i++)
                {
                    if (gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() != "Ineligible")
                    {
                        gvSettlementsInMedBill["IneligibleReason", i].Value = null;
                        gvSettlementsInMedBill["IneligibleReason", i].ReadOnly = true;
                    }
                }

                if (nDeletedSettlements == nSettlementToDelete)
                {
                    MessageBox.Show("The settlements have been deleted.");
                }
                else MessageBox.Show("Some of settlements have not been deleted.");
            }
            else if (dr == DialogResult.No)     // do not delete settlement
            {
                return;
            }
            //}
        }

        private void btnEditCaseUnderProcess_Click(object sender, EventArgs e)
        {
            //if (tbCMMManager.TabPages.Contains(tbpgCreateCase))
            //{
            //    MessageBox.Show("The Case page is already opened.", "Alert", MessageBoxButtons.OK);
            //    return;
            //}
            //else
            //{
            if (gvProcessingCaseNo.Rows.Count > 0)
            {
                int nSelected = 0;
                int nRowSelected = 0;
                for (int i = 0; i < gvProcessingCaseNo.Rows.Count; i++)
                {
                    if ((Boolean)gvProcessingCaseNo["CaseSelected", i].Value == true)
                    {
                        nRowSelected = i;
                        nSelected++;
                    }
                }

                if (nSelected == 0)
                {
                    MessageBox.Show("No Case selected", "Alert", MessageBoxButtons.OK);
                    return;
                }
                else if (nSelected > 1)
                {
                    MessageBox.Show("More than one case selected", "Alert", MessageBoxButtons.OK);
                    return;
                }
                else if (nSelected == 1)
                {
                    /////////////////////////////////////////////////////////////////////////////////////////////////////////////
                    String strSqlQueryForCaseStatus = "select [dbo].[tbl_case_status_code].[CaseStatusValue] from [dbo].[tbl_case_status_code]";
                    SqlCommand cmdQueryForCaseStatus = new SqlCommand(strSqlQueryForCaseStatus, connRN2);
                    cmdQueryForCaseStatus.CommandType = CommandType.Text;

                    if (connRN2.State != ConnectionState.Closed)
                    {
                        connRN2.Close();
                        connRN2.Open();
                    }
                    else if (connRN2.State == ConnectionState.Closed) connRN2.Open();

                    SqlDataReader rdrCaseStatus = cmdQueryForCaseStatus.ExecuteReader();
                    cbCaseStatus.Items.Clear();
                    if (rdrCaseStatus.HasRows)
                    {
                        while (rdrCaseStatus.Read())
                        {
                            cbCaseStatus.Items.Add(rdrCaseStatus.GetString(0));
                        }
                    }
                    rdrCaseStatus.Close();
                    if (connRN2.State != ConnectionState.Closed) connRN2.Close();



                    String CaseIdForIndividual = gvProcessingCaseNo["CaseIdForIndividual", nRowSelected]?.Value?.ToString();
                    String IndividualIdForCase = txtIndividualID.Text.Trim();

                    String strSqlQueryForCase = "select [dbo].[tbl_case].[Case_Name], [dbo].[tbl_case].[Contact_ID], [dbo].[tbl_case].[CreateDate], [dbo].[tbl_case].[ModifiDate], " +
                                                "[dbo].[tbl_case].[CreateStaff], [dbo].[tbl_case].[ModifiStaff], [dbo].[tbl_case].[Case_status], " +
                                                "[dbo].[tbl_case].[NPF_Form], [dbo].[tbl_case].[NPF_Form_File_Name], [dbo].[tbl_case].[NPF_Form_Destination_File_Name], [dbo].[tbl_case].[NPF_Receiv_Date], " +
                                                "[dbo].[tbl_case].[IB_Form], [dbo].[tbl_case].[IB_Form_File_Name], [dbo].[tbl_case].[IB_Form_Destination_File_Name], [dbo].[tbl_case].[IB_Receiv_Date], " +
                                                "[dbo].[tbl_case].[POP_Form], [dbo].[tbl_case].[POP_Form_File_Name], [dbo].[tbl_case].[POP_Form_Destination_File_Name], [dbo].[tbl_case].[POP_Receiv_Date], " +
                                                "[dbo].[tbl_case].[MedRec_Form], [dbo].[tbl_case].[MedRec_Form_File_Name], [dbo].[tbl_case].[MedRec_Form_Destination_File_Name], [dbo].[tbl_case].[MedRec_Receiv_Date], " +
                                                "[dbo].[tbl_case].[Unknown_Form], [dbo].[tbl_case].[Unknown_Form_File_Name], [dbo].[tbl_case].[Unknown_Form_Destination_File_Name], [dbo].[tbl_case].[Unknown_Receiv_Date], " +
                                                "[dbo].[tbl_case].[Case_status], [dbo].[tbl_case].[Note] " +
                                                "from [dbo].[tbl_case] where [dbo].[tbl_case].[Case_Name] = @CaseName and [dbo].[tbl_case].[Contact_ID] = @IndividualID";

                    SqlCommand cmdQueryForCase = new SqlCommand(strSqlQueryForCase, connRN2);
                    cmdQueryForCase.CommandType = CommandType.Text;

                    cmdQueryForCase.Parameters.AddWithValue("@CaseName", CaseIdForIndividual);
                    cmdQueryForCase.Parameters.AddWithValue("@IndividualID", IndividualIdForCase);

                    if (connRN2.State != ConnectionState.Closed)
                    {
                        connRN2.Close();
                        connRN2.Open();
                    }
                    else if (connRN2.State == ConnectionState.Closed) connRN2.Open();

                    SqlDataReader rdrCaseForIndividual = cmdQueryForCase.ExecuteReader();
                    if (rdrCaseForIndividual.HasRows)
                    {
                        //tbCMMManager.TabPages.Insert(3, tbpgCaseView);
                        //tbCMMManager.TabPages.Insert(4, tbpgCreateCase);

                        rdrCaseForIndividual.Read();

                        txtCaseName.Text = rdrCaseForIndividual.GetString(0);
                        txtCaseIndividualID.Text = rdrCaseForIndividual.GetString(1);

                        // NPF Form
                        if (rdrCaseForIndividual.GetBoolean(7) == true) chkNPF_CaseCreationPage.Checked = true;
                        if (!rdrCaseForIndividual.IsDBNull(8)) txtNPFFormFilePath.Text = rdrCaseForIndividual.GetString(8);
                        if (!rdrCaseForIndividual.IsDBNull(9)) strNPFormFilePathDestination = rdrCaseForIndividual.GetString(9);
                        if (!rdrCaseForIndividual.IsDBNull(10))
                        {
                            dtpNPFReceivedDate.Checked = true;
                            dtpNPFReceivedDate.Value = rdrCaseForIndividual.GetDateTime(10);
                            dtpNPFReceivedDate.Text = rdrCaseForIndividual.GetDateTime(10).ToString("MM/dd/yyyy");
                        }
                        //txtNPFUploadDate.Text = rdrCaseForIndividual.GetDateTime(10).ToString("MM/dd/yyyy");

                        // IB Form
                        if (rdrCaseForIndividual.GetBoolean(11) == true) chkIB_CaseCreationPage.Checked = true;
                        if (!rdrCaseForIndividual.IsDBNull(12)) txtIBFilePath.Text = rdrCaseForIndividual.GetString(12);
                        if (!rdrCaseForIndividual.IsDBNull(13)) strIBFilePathDestination = rdrCaseForIndividual.GetString(13);
                        if (!rdrCaseForIndividual.IsDBNull(14))
                        {
                            dtpIBReceivedDate.Checked = true;
                            dtpIBReceivedDate.Value = rdrCaseForIndividual.GetDateTime(14);
                            dtpIBReceivedDate.Text = rdrCaseForIndividual.GetDateTime(14).ToString("MM/dd/yyyy");
                        }
                        //txtIBUploadDate.Text = rdrCaseForIndividual.GetDateTime(14).ToString("MM/dd/yyyy");

                        // POP Form
                        if (rdrCaseForIndividual.GetBoolean(15) == true) chkPoP_CaseCreationPage.Checked = true;
                        if (!rdrCaseForIndividual.IsDBNull(16)) txtPopFilePath.Text = rdrCaseForIndividual.GetString(16);
                        if (!rdrCaseForIndividual.IsDBNull(17)) strPopFilePathDestination = rdrCaseForIndividual.GetString(17);
                        if (!rdrCaseForIndividual.IsDBNull(18))
                        {
                            dtpPoPReceivedDate.Checked = true;
                            dtpPoPReceivedDate.Value = rdrCaseForIndividual.GetDateTime(18);
                            dtpPoPReceivedDate.Text = rdrCaseForIndividual.GetDateTime(18).ToString("MM/dd/yyyy");
                        }
                        //txtPoPUploadDate.Text = rdrCaseForIndividual.GetDateTime(18).ToString("MM/dd/yyyy");

                        // Med Rec Form
                        if (rdrCaseForIndividual.GetBoolean(19) == true) chkMedicalRecordCaseCreationPage.Checked = true;
                        if (!rdrCaseForIndividual.IsDBNull(20)) txtMedicalRecordFilePath.Text = rdrCaseForIndividual.GetString(20);
                        if (!rdrCaseForIndividual.IsDBNull(21)) strMedRecordFilePathDestination = rdrCaseForIndividual.GetString(21);
                        if (!rdrCaseForIndividual.IsDBNull(22))
                        {
                            dtpMRReceivedDate.Checked = true;
                            dtpMRReceivedDate.Value = rdrCaseForIndividual.GetDateTime(22);
                            dtpMRReceivedDate.Text = rdrCaseForIndividual.GetDateTime(22).ToString("MM/dd/yyyy");
                        }
                        //txtMRUploadDate.Text = rdrCaseForIndividual.GetDateTime(22).ToString("MM/dd/yyyy");

                        // Unknown Doc Form
                        if (rdrCaseForIndividual.GetBoolean(23) == true) chkOtherDocCaseCreationPage.Checked = true;
                        if (!rdrCaseForIndividual.IsDBNull(24)) txtOtherDocumentFilePath.Text = rdrCaseForIndividual.GetString(24);
                        if (!rdrCaseForIndividual.IsDBNull(25)) strUnknownDocFilePathDestination = rdrCaseForIndividual.GetString(25);
                        if (!rdrCaseForIndividual.IsDBNull(26))
                        {
                            dtpOtherDocReceivedDate.Checked = true;
                            dtpOtherDocReceivedDate.Value = rdrCaseForIndividual.GetDateTime(26);
                            dtpOtherDocReceivedDate.Text = rdrCaseForIndividual.GetDateTime(26).ToString("MM/dd/yyyy");
                        }
                        //txtOtherDocUploadDate.Text = rdrCaseForIndividual.GetDateTime(26).ToString("MM/dd/yyyy");

                        // Case status
                        //if (rdrCaseForIndividual.GetBoolean(27) == true) txtCaseStatus.Text = "Complete and Ready";
                        //else txtCaseStatus.Text = "Pending - Additional Documents required";

                        if (!rdrCaseForIndividual.IsDBNull(27))
                        {
                            switch (rdrCaseForIndividual.GetInt16(27))
                            {
                                case (int)CaseStatus.OnGoing:
                                    cbCaseStatus.SelectedIndex = (int)CaseStatus.OnGoing;
                                    break;
                                case (int)CaseStatus.Processing:
                                    cbCaseStatus.SelectedIndex = (int)CaseStatus.Processing;
                                    break;
                                case (int)CaseStatus.Closed:
                                    cbCaseStatus.SelectedIndex = (int)CaseStatus.Closed;
                                    break;
                            }
                        }

                        // Note
                        if (!rdrCaseForIndividual.IsDBNull(28)) txtNoteOnCase.Text = rdrCaseForIndividual.GetString(28);

                        // Individual Name
                        //tbCMMManager.TabPages.Insert(3, tbpgCaseView);
                        //tbCMMManager.TabPages.Insert(4, tbpgCreateCase);
                        //tbCMMManager.SelectedIndex = 4;
                    }
                    rdrCaseForIndividual.Close();
                    if (connRN2.State != ConnectionState.Closed) connRN2.Close();

                    String strSqlQueryForMedBillInCase = "select [dbo].[tbl_medbill].[BillNo], [dbo].[tbl_medbill_type].[MedBillTypeName], " +
                                        "[dbo].[tbl_medbill].[CreatedDate], [dbo].[tbl_CreateStaff].[Staff_Name], " +
                                        "[dbo].[tbl_medbill].[LastModifiedDate], [dbo].[tbl_ModifiStaff].[Staff_Name], " +
                                        "[dbo].[tbl_medbill].[BillAmount], [dbo].[tbl_medbill].[SettlementTotal], [dbo].[tbl_medbill].[TotalSharedAmount], [dbo].[tbl_medbill].[Balance] " +
                                        "from [dbo].[tbl_medbill] " +
                                        "inner join [dbo].[tbl_medbill_type] on [dbo].[tbl_medbill].[MedBillType_Id] = [dbo].[tbl_medbill_type].[MedBillTypeId] " +
                                        "inner join [dbo].[tbl_CreateStaff] on [dbo].[tbl_medbill].[CreatedById] = [dbo].[tbl_CreateStaff].[CreateStaff_Id] " +
                                        "inner join [dbo].[tbl_ModifiStaff] on [dbo].[tbl_medbill].[LastModifiedById] = [dbo].[tbl_ModifiStaff].[ModifiStaff_Id] " +
                                        "where [dbo].[tbl_medbill].[Case_Id] = @CaseName and " +
                                        "[dbo].[tbl_medbill].[Contact_Id] = @IndividualId and " +
                                        "[dbo].[tbl_medbill].[IsDeleted] = 0";



                    SqlCommand cmdQueryForMedBillsInCase = new SqlCommand(strSqlQueryForMedBillInCase, connRN2);
                    cmdQueryForMedBillsInCase.CommandType = CommandType.Text;

                    cmdQueryForMedBillsInCase.Parameters.AddWithValue("@CaseName", CaseIdForIndividual);
                    cmdQueryForMedBillsInCase.Parameters.AddWithValue("@IndividualId", IndividualIdForCase);

                    SqlDependency dependencyMedBillInCase = new SqlDependency(cmdQueryForMedBillsInCase);
                    dependencyMedBillInCase.OnChange += new OnChangeEventHandler(OnMedBillsInCaseChange);

                    if (connRN2.State != ConnectionState.Closed)
                    {
                        connRN2.Close();
                        connRN2.Open();
                    }
                    else if (connRN2.State == ConnectionState.Closed) connRN2.Open();

                    SqlDataReader rdrMedBillInCase = cmdQueryForMedBillsInCase.ExecuteReader();

                    gvCasePageMedBills.Rows.Clear();
                    if (rdrMedBillInCase.HasRows)
                    {
                        while (rdrMedBillInCase.Read())
                        {
                            DataGridViewRow row = new DataGridViewRow();

                            row.Cells.Add(new DataGridViewCheckBoxCell { Value = false });
                            row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillInCase.GetString(0) });
                            row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillInCase.GetString(1) });
                            row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillInCase.GetDateTime(2).ToString("MM/dd/yyyy") });
                            row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillInCase.GetString(3) });
                            row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillInCase.GetDateTime(4).ToString("MM/dd/yyyy") });
                            row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillInCase.GetString(5) });
                            row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillInCase.GetDecimal(6).ToString("C") });
                            row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillInCase.GetDecimal(7).ToString("C") });
                            row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillInCase.GetDecimal(8).ToString("C") });
                            row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrMedBillInCase.GetDecimal(9).ToString("C") });

                            gvCasePageMedBills.Rows.Add(row);
                        }
                    }
                    rdrMedBillInCase.Close();
                    if (connRN2.State != ConnectionState.Closed) connRN2.Close();

                    btnCaseCreationSaveUpper.Enabled = true;
                    //btnCaseCreationLowerSave.Enabled = true;

                    tbCMMManager.SelectedTab = tbpgCreateCase;
                }
            }
            //}
        }

        private void btnMedicalProviderInfo_Click(object sender, EventArgs e)
        {
            frmMedicalProviderInfo frmMedProviderInfo = new frmMedicalProviderInfo();

            frmMedProviderInfo.StartPosition = FormStartPosition.CenterParent;
            frmMedProviderInfo.ShowDialog();
        }

        private void frmCMMManager_Shown(object sender, EventArgs e)
        {
            //txtMedBillGuarantor.TextChanged += new EventHandler(txtMedBillGuarantor_TextChanged);
            //txtMedBill_Illness.TextChanged += new EventHandler(txtMedBill_Illness_TextChanged);
            //txtMedBill_Incident.TextChanged += new EventHandler(txtMedBill_Incident_TextChanged);
            //txtMedBillAmount.TextChanged += new EventHandler(txtMedBillAmount_TextChanged);
            //txtBalance.TextChanged += new EventHandler(txtBalance_TextChanged);
            //txtPrescriptionName.TextChanged += new EventHandler(txtPrescriptionName_TextChanged);
            //txtPrescriptionNo.TextChanged += new EventHandler(txtPrescriptionNo_TextChanged);
            //txtPrescriptionDescription.TextChanged += new EventHandler(txtPrescriptionDescription_TextChanged);
            //txtNumPhysicalTherapy.TextChanged += new EventHandler(txtNumPhysicalTherapy_TextChanged);
            //cbMedicalBillNote1.SelectedIndexChanged += new EventHandler(cbMedicalBillNote1_SelectedIndexChanged);
            //cbMedicalBillNote2.SelectedIndexChanged += new EventHandler(cbMedicalBillNote2_SelectedIndexChanged);
            //cbMedicalBillNote3.SelectedIndexChanged += new EventHandler(cbMedicalBillNote3_SelectedIndexChanged);
            //cbMedicalBillNote4.SelectedIndexChanged += new EventHandler(cbMedicalBillNote4_SelectedIndexChanged);
            //txtMedicalBillNote1.TextChanged += new EventHandler(txtMedicalBillNote1_TextChanged);
            //txtMedicalBillNote2.TextChanged += new EventHandler(txtMedicalBillNote2_TextChanged);
            //txtMedicalBillNote3.TextChanged += new EventHandler(txtMedicalBillNote3_TextChanged);
            //txtMedicalBillNote4.TextChanged += new EventHandler(txtMedicalBillNote4_TextChanged);


            //dtpBillDate.ValueChanged += new EventHandler(dtpBillDate_ValueChanged);
            //dtpDueDate.ValueChanged += new EventHandler(dtpDueDate_ValueChanged);
        }

        private void txtMedBillAmount_TextChanged(object sender, EventArgs e)
        {
            TextBox txtAmount = (TextBox)sender;

            txtBalance.Text = txtAmount.Text;
        }

        private void comboMedBillType_SelectedIndexChanged(object sender, EventArgs e)
        {
            ComboBox comboBox = (ComboBox)sender;

            if (comboBox.SelectedItem.ToString() == "Medical Bill")
            {
                lblPrescriptionName.Visible = false;
                lblPrescriptionDescription.Visible = false;
                lblPrescriptionNote.Visible = false;
                lblNumberOfMedication.Visible = false;

                txtPrescriptionName.Visible = false;
                txtPrescriptionDescription.Visible = false;
                txtPrescriptionNote.Visible = false;
                txtNumberOfMedication.Visible = false;

                lblNumberOfPhysicalTheraph.Visible = false;
                txtNumPhysicalTherapy.Visible = false;
                lblPhysicalTherapyRxNote.Visible = false;
                txtPhysicalTherapyRxNote.Visible = false;

                rbInpatient.Visible = true;
                rbOutpatient.Visible = true;

                lblMedBillNote.Visible = true;
                txtMedBillNote.Visible = true;

                lblPendingReason.Visible = true;
                comboPendingReason.Visible = true;

                lblIneligibleReason.Visible = true;
                comboIneligibleReason.Visible = true;

            }

            if (comboBox.SelectedItem.ToString() == "Prescription")
            {
                lblMedBillNote.Visible = false;
                txtMedBillNote.Visible = false;

                lblNumberOfPhysicalTheraph.Visible = false;
                txtNumPhysicalTherapy.Visible = false;

                lblPhysicalTherapyRxNote.Visible = false;
                txtPhysicalTherapyRxNote.Visible = false;

                lblPendingReason.Visible = true;
                comboPendingReason.Visible = true;

                lblIneligibleReason.Visible = true;
                comboIneligibleReason.Visible = true;

                rbInpatient.Visible = false;
                rbOutpatient.Visible = false;

                lblPrescriptionName.Visible = true;
                lblPrescriptionDescription.Visible = true;
                lblPrescriptionNote.Visible = true;
                lblNumberOfMedication.Visible = true;

                txtPrescriptionName.Visible = true;
                txtPrescriptionDescription.Visible = true;
                txtPrescriptionNote.Visible = true;
                txtNumberOfMedication.Visible = true;

            }

            if (comboBox.SelectedItem.ToString() == "Physical Therapy")
            {
                lblMedBillNote.Visible = false;
                txtMedBillNote.Visible = false;

                lblPrescriptionName.Visible = false;
                lblPrescriptionDescription.Visible = false;
                lblPrescriptionNote.Visible = false;
                lblNumberOfMedication.Visible = false;

                txtPrescriptionName.Visible = false;
                txtPrescriptionDescription.Visible = false;
                txtPrescriptionNote.Visible = false;
                txtNumberOfMedication.Visible = false;

                lblPendingReason.Visible = true;
                comboPendingReason.Visible = true;

                lblIneligibleReason.Visible = true;
                comboIneligibleReason.Visible = true;

                rbInpatient.Visible = false;
                rbOutpatient.Visible = false;

                lblNumberOfPhysicalTheraph.Visible = true;

                txtNumPhysicalTherapy.Visible = true;
                lblPhysicalTherapyRxNote.Visible = true;
                txtPhysicalTherapyRxNote.Visible = true;

            }

            if (comboBox.SelectedItem.ToString() == "Medical Record")
            {
                lblPrescriptionName.Visible = false;
                lblPrescriptionDescription.Visible = false;
                lblPrescriptionNote.Visible = false;
                lblNumberOfMedication.Visible = false;

                txtPrescriptionName.Visible = false;
                txtPrescriptionDescription.Visible = false;
                txtPrescriptionNote.Visible = false;
                txtNumberOfMedication.Visible = false;

                lblNumberOfPhysicalTheraph.Visible = false;
                txtNumPhysicalTherapy.Visible = false;
                lblPhysicalTherapyRxNote.Visible = false;
                txtPhysicalTherapyRxNote.Visible = false;

                rbInpatient.Visible = true;
                rbOutpatient.Visible = true;

                lblMedBillNote.Visible = true;
                txtMedBillNote.Visible = true;

                lblPendingReason.Visible = true;
                comboPendingReason.Visible = true;

                lblIneligibleReason.Visible = true;
                comboIneligibleReason.Visible = true;
            }

        }

        private void btnSearch_Click(object sender, EventArgs e)
        {
            if (gvIndividualSearched.Rows.Count > 0) gvIndividualSearched.DataSource = null;

            tbCMMManager.SelectedTab = tbpgSearchResult;

            String strTextSearched = txtSearch.Text.Trim();

            //String strSqlSearchContact = "select [dbo].[contact].[Individual_ID__C] as [Individual No.], " +
            //                 "concat([dbo].[contact].[LastName], ', ', [dbo].[contact].[FirstName], ' ', [dbo].[contact].[MiddleName]) as Name, " +
            //                 "[dbo].[membership].[Name] as Membership, [dbo].[contact].[Social_Security_Number__c] as [SSN], " +
            //                 "[dbo].[contact].[Legacy_Database_Individual_ID__C] as [CRM No.], " +
            //                 "[dbo].[contact].[c4g_Membership_Status__C] as [Membership Status], " +
            //                 "[dbo].[contact].[Membership_Ind_Start_Date__C] As [Membership Start Date], " +
            //                 "[dbo].[contact].[Membership_Cancelled_Date__C] As [Membership Cancel Date], " +
            //                 "[dbo].[contact].[BirthDate], [dbo].[contact].[cmm_Gender__C] as [Gender], " +
            //                 "[dbo].[contact].[Household_Role__C] as [House Type], " +
            //                 "[dbo].[program].[Name] as [Program Name], " +
            //                 "[dbo].[contact].[MailingStreet], [dbo].[contact].[MailingCity], [dbo].[contact].[MailingState], [dbo].[contact].[MailingPostalCode], " +
            //                 "[dbo].[contact].[OtherStreet], [dbo].[contact].[OtherCity], [dbo].[contact].[OtherState], [dbo].[contact].[OtherPostalCode], " +
            //                 "[dbo].[Church].[Name] as [Church Name], " +
            //                 "[dbo].[contact].[Email] " +
            //                 "from contact " +
            //                 "left join membership on contact.c4g_Membership__C = membership.ID " +
            //                 "left join account on contact.AccountID = account.ID " +
            //                 "left join program on contact.c4g_plan__c = program.ID " +
            //                 "left join Church on contact.c4g_Church__C = Church.ID " +
            //                 "where contact.LastName like '%' + @LastName + '%' or " +
            //                 "contact.FirstName like '%' + @FirstName + '%' or " +
            //                 "contact.MailingStreet like '%' + @MailingStreet + '%' or " +
            //                 "contact.Birthdate like '%' + @Birthdate + '%' or " +
            //                 "contact.Household_Role__C like '%' + @HouseholdRole + '%' or " +
            //                 "contact.Membership_Number__c like '%' + @MembershipID + '%' or " +
            //                 "contact.c4g_Membership_Status__C like '%' + @MembershipStatus + '%' or " +
            //                 "contact.Social_Security_Number__C like '%' + @SSN + '%' or " +
            //                 "contact.Individual_ID__C like '%' + @IndividualID + '%' or " +
            //                 "contact.Legacy_Database_Individual_ID__C like '%' + @LagacyIndividualID + '%'";


            String strSqlSearchContact = "select [dbo].[contact].[Individual_ID__C] as [Individual No.], " +
                 "concat([dbo].[contact].[LastName], ', ', [dbo].[contact].[FirstName], ' ', [dbo].[contact].[MiddleName]) as Name, " +
                 "[dbo].[membership].[Name] as Membership, " +
                 "[dbo].[contact].[c4g_Membership_Status__C] as [Membership Status], " +
                 "[dbo].[contact].[BirthDate], [dbo].[contact].[cmm_Gender__C] as [Gender], " +
                 "[dbo].[program].[Name] as [Program Name], " +
                 "[dbo].[contact].[MailingPostalCode] as [Zip Code] " +
                 "from contact " +
                 "left join membership on contact.c4g_Membership__C = membership.ID " +
                 "left join program on contact.c4g_plan__c = program.ID " +
                 "where contact.LastName like '%' + @LastName + '%' or " +
                 "contact.FirstName like '%' + @FirstName + '%' or " +
                 "contact.MailingStreet like '%' + @MailingStreet + '%' or " +
                 "contact.Birthdate like '%' + @Birthdate + '%' or " +
                 "contact.Household_Role__C like '%' + @HouseholdRole + '%' or " +
                 "contact.Membership_Number__c like '%' + @MembershipID + '%' or " +
                 "contact.c4g_Membership_Status__C like '%' + @MembershipStatus + '%' or " +
                 "contact.Social_Security_Number__C like '%' + @SSN + '%' or " +
                 "contact.Individual_ID__C like '%' + @IndividualID + '%' or " +
                 "contact.Legacy_Database_Individual_ID__C like '%' + @LagacyIndividualID + '%'";

            SqlCommand cmdQueryForIndividual = new SqlCommand(strSqlSearchContact, connSalesforce);
            cmdQueryForIndividual.CommandType = CommandType.Text;

            cmdQueryForIndividual.Parameters.AddWithValue("@LastName", strTextSearched);
            cmdQueryForIndividual.Parameters.AddWithValue("@FirstName", strTextSearched);
            cmdQueryForIndividual.Parameters.AddWithValue("@MailingStreet", strTextSearched);
            cmdQueryForIndividual.Parameters.AddWithValue("@Birthdate", strTextSearched);
            cmdQueryForIndividual.Parameters.AddWithValue("@HouseholdRole", strTextSearched);
            cmdQueryForIndividual.Parameters.AddWithValue("@MembershipID", strTextSearched);
            cmdQueryForIndividual.Parameters.AddWithValue("@MembershipStatus", strTextSearched);
            cmdQueryForIndividual.Parameters.AddWithValue("@SSN", strTextSearched);
            cmdQueryForIndividual.Parameters.AddWithValue("@IndividualID", strTextSearched);
            cmdQueryForIndividual.Parameters.AddWithValue("@LagacyIndividualID", strTextSearched);

            DataTable dtIndividual = new DataTable();
            SqlDataAdapter daIndividual = new SqlDataAdapter(cmdQueryForIndividual);
            daIndividual.Fill(dtIndividual);

            gvIndividualSearched.DataSource = null;
            gvIndividualSearched.DataSource = dtIndividual;

            string strSqlSearchForMedBill = "select [RN_DB].[dbo].[tbl_medbill].[BillNo] as [MedBill No], [RN_DB].[dbo].[tbl_medbill_type].[MedBillTypeName] as [MedBill Type], " +
                                            "[SalesForce].[dbo].[contact].[Name], " +
                                            "[RN_DB].[dbo].[tbl_medbill].[BillAmount] as [Bill Amount], [RN_DB].[dbo].[tbl_medbill].[Balance] as [Balance], " +
                                            "[RN_DB].[dbo].[tbl_medbill].[Case_Id] as [Case No], " +
                                            "[RN_DB].[dbo].[tbl_illness].[IllnessNo] as [Illness No], " +
                                            "[RN_DB].[dbo].[tbl_incident].[IncidentNo] as [Incident No], " +
                                            "[SalesForce].[dbo].[Account].[Name] as [Medical Provider Name] " +
                                            "from [RN_DB].[dbo].[tbl_medbill] " +
                                            "left join [RN_DB].[dbo].[tbl_medbill_type] on [RN_DB].[dbo].[tbl_medbill].[MedBillType_Id] = [RN_DB].[dbo].[tbl_medbill_type].[MedBillTypeId] " +
                                            "left join [SalesForce].[dbo].[contact] on [RN_DB].[dbo].[tbl_medbill].[Individual_Id] = [SalesForce].[dbo].[contact].[Individual_ID__c] " +
                                            "left join [RN_DB].[dbo].[tbl_illness] on [RN_DB].[dbo].[tbl_medbill].[Illness_Id] = [RN_DB].[dbo].[tbl_illness].[Illness_Id] " +
                                            "left join [RN_DB].[dbo].[tbl_incident] on [RN_DB].[dbo].[tbl_medbill].[Incident_Id] = [RN_DB].[dbo].[tbl_incident].[Incident_id] " +
                                            "left join [SalesForce].[dbo].[Account] on [RN_DB].[dbo].[tbl_medbill].[MedicalProvider_Id] = [SalesForce].[dbo].[Account].[Id] " +
                                            "where ([RN_DB].[dbo].[tbl_medbill].[BillNo] like '%' + @MedBillNo + '%' or " +
                                            "[RN_DB].[dbo].[tbl_medbill].[Individual_Id] like '%' + @IndividualId + '%' or " +
                                            "[SalesForce].[dbo].[contact].[Name] like '%' + @IndividualName + '%' or " +
                                            "[RN_DB].[dbo].[tbl_medbill].[Case_Id] like '%' + @CaseNo + '%' or " +
                                            "[RN_DB].[dbo].[tbl_illness].[IllnessNo] like '%' + @IllnessNo + '%' or " +
                                            "[RN_DB].[dbo].[tbl_incident].[IncidentNo] like '%' + @IncidentNo + '%' or " +
                                            "[SalesForce].[dbo].[Account].[Name] like '%' + @MedicalProviderName + '%') and " +
                                            "([RN_DB].[dbo].[tbl_medbill].[IsDeleted] = 0 or [RN_DB].[dbo].[tbl_medbill].[IsDeleted] IS NULL)";

            SqlCommand cmdQueryForMedbill = new SqlCommand(strSqlSearchForMedBill, connRN7);
            cmdQueryForMedbill.CommandType = CommandType.Text;

            cmdQueryForMedbill.Parameters.AddWithValue("@MedBillNo", strTextSearched);
            cmdQueryForMedbill.Parameters.AddWithValue("@IndividualId", strTextSearched);
            cmdQueryForMedbill.Parameters.AddWithValue("@IndividualName", strTextSearched);
            cmdQueryForMedbill.Parameters.AddWithValue("@CaseNo", strTextSearched);
            cmdQueryForMedbill.Parameters.AddWithValue("@IllnessNo", strTextSearched);
            cmdQueryForMedbill.Parameters.AddWithValue("@IncidentNo", strTextSearched);
            cmdQueryForMedbill.Parameters.AddWithValue("@MedicalProviderName", strTextSearched);

            DataTable dtMedBill = new DataTable();
            SqlDataAdapter daMedBill = new SqlDataAdapter(cmdQueryForMedbill);

            daMedBill.Fill(dtMedBill);

            gvMedBillSearched.DataSource = null;
            gvMedBillSearched.DataSource = dtMedBill;

            gvMedBillSearched.Columns[0].Width = 140;
            gvMedBillSearched.Columns[3].DefaultCellStyle.Format = "c";
            gvMedBillSearched.Columns[3].DefaultCellStyle.FormatProvider = CultureInfo.GetCultureInfo("en-US");
            gvMedBillSearched.Columns[3].DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleRight;

            gvMedBillSearched.Columns[4].DefaultCellStyle.Format = "c";
            gvMedBillSearched.Columns[4].DefaultCellStyle.FormatProvider = CultureInfo.GetCultureInfo("en-US");
            gvMedBillSearched.Columns[4].DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleRight;

            String strSqlSearchForSettlement = "select [RN_DB].[dbo].[tbl_settlement].[Name] as [Settlement No], [RN_DB].[dbo].[tbl_settlement].[MedicalBillID] as [Medical Bill No], " +
                                               "[SalesForce].[dbo].[contact].[Individual_ID__c] as [Individua Id], [SalesForce].[dbo].[contact].[Name] as [Individual Name], " +
                                               "[RN_DB].[dbo].[tbl_settlement_type_code].[SettlementTypeValue] as [Settlement Type], [RN_DB].[dbo].[tbl_settlement].[Amount] as [Settlement Amount], " +
                                               "[RN_DB].[dbo].[tbl_payment_method].[PaymentMethod_Value] as [Payment Method], " +
                                               "[RN_DB].[dbo].[tbl_settlement].[CheckNo] as [Check No], [RN_DB].[dbo].[tbl_settlement].[CheckDate] as [Check Date], " +
                                               "[RN_DB].[dbo].[tbl_settlement].[ACH_Number] as [ACH No], [RN_DB].[dbo].[tbl_settlement].[ACH_Date] as [ACH Date], " +
                                               "[RN_DB].[dbo].[tbl_Credit_Card__c].[Name] as [Credit Card No], [RN_DB].[dbo].[tbl_settlement].[CMMCreditCardPaidDate] as [Credit Card Paid Date], " +
                                               "[RN_DB].[dbo].[tbl_settlement].[Approved] " +
                                               "from [RN_DB].[dbo].[tbl_settlement] " +
                                               "left join [RN_DB].[dbo].[tbl_medbill] on [RN_DB].[dbo].[tbl_settlement].[MedicalBillID] = [RN_DB].[dbo].[tbl_medbill].[BillNo] " +
                                               "left join [SalesForce].[dbo].[contact] on [RN_DB].[dbo].[tbl_medbill].[Individual_Id] = [SalesForce].[dbo].[contact].[Individual_ID__c] " +
                                               "left join [RN_DB].[dbo].[tbl_settlement_type_code] on [RN_DB].[dbo].[tbl_settlement].[SettlementType] = [RN_DB].[dbo].[tbl_settlement_type_code].[SettlementTypeCode] " +
                                               "left join [RN_DB].[dbo].[tbl_payment_method] on [RN_DB].[dbo].[tbl_settlement].[CMMPaymentMethod] = [RN_DB].[dbo].[tbl_payment_method].[PaymentMethod_Id] " +
                                               "left join [RN_DB].[dbo].[tbl_Credit_Card__c] on [RN_DB].[dbo].[tbl_settlement].[CMMCreditCard] = [RN_DB].[dbo].[tbl_Credit_Card__c].[CreditCard_Id] " +
                                               "where ([RN_DB].[dbo].[tbl_settlement].[Name] like '%' + @SettlementNo + '%' or " +
                                               "[RN_DB].[dbo].[tbl_settlement].[MedicalBillID] like '%' + @MedicalBillNo + '%' or " +
                                               "[SalesForce].[dbo].[contact].[Individual_ID__c] like '%' + @IndividualId + '%' or " +
                                               "[SalesForce].[dbo].[contact].[Name] like '%' + @IndividualName + '%' or " +
                                               "[RN_DB].[dbo].[tbl_settlement_type_code].[SettlementTypeValue] like '%' + @SettlementType + '%' or" +
                                               "[RN_DB].[dbo].[tbl_payment_method].[PaymentMethod_Value] like '%' + @PaymentMethod + '%' or " +
                                               "[RN_DB].[dbo].[tbl_settlement].[CheckNo] like '%' + @CheckNo + '%' or " +
                                               "[RN_DB].[dbo].[tbl_settlement].[ACH_Number] like '%' + @ACH_Number + '%' or" +
                                               "[RN_DB].[dbo].[tbl_Credit_Card__c].[Name] like '%' + @CreditCardNo + '%' or " +
                                               "[RN_DB].[dbo].[tbl_settlement].[CMMCreditCardPaidDate] like '%' + @CreditCardPaidDate + '%') and " +
                                               "([RN_DB].[dbo].[tbl_settlement].[IsDeleted] = 0 or [RN_DB].[dbo].[tbl_settlement].[IsDeleted] IS NULL)";

            SqlCommand cmdSearchForSettlement = new SqlCommand(strSqlSearchForSettlement, connRN2);
            cmdSearchForSettlement.CommandType = CommandType.Text;

            cmdSearchForSettlement.Parameters.AddWithValue("@SettlementNo", strTextSearched);
            cmdSearchForSettlement.Parameters.AddWithValue("@MedicalBillNo", strTextSearched);
            cmdSearchForSettlement.Parameters.AddWithValue("@IndividualId", strTextSearched);
            cmdSearchForSettlement.Parameters.AddWithValue("@IndividualName", strTextSearched);
            cmdSearchForSettlement.Parameters.AddWithValue("@SettlementType", strTextSearched);
            cmdSearchForSettlement.Parameters.AddWithValue("@PaymentMethod", strTextSearched);
            cmdSearchForSettlement.Parameters.AddWithValue("@CheckNo", strTextSearched);
            cmdSearchForSettlement.Parameters.AddWithValue("@ACH_Number", strTextSearched);
            cmdSearchForSettlement.Parameters.AddWithValue("@CreditCardNo", strTextSearched);
            cmdSearchForSettlement.Parameters.AddWithValue("@CreditCardPaidDate", strTextSearched);

            DataTable dtSettlement = new DataTable();

            SqlDataAdapter daSettlement = new SqlDataAdapter(cmdSearchForSettlement);

            daSettlement.Fill(dtSettlement);

            gvSettlementSearched.DataSource = null;
            gvSettlementSearched.DataSource = dtSettlement;

            gvSettlementSearched.Columns[0].Width = 120;
            gvSettlementSearched.Columns[1].Width = 140;
            gvSettlementSearched.Columns[5].DefaultCellStyle.Format = "c";
            gvSettlementSearched.Columns[5].DefaultCellStyle.FormatProvider = new CultureInfo("en-US");
            gvSettlementSearched.Columns[5].DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleRight;


            //if (connRN2.State != ConnectionState.Closed)
            //{
            //    connRN2.Close();
            //    connRN2.Open();
            //}
            //else if (connRN2.State == ConnectionState.Closed) connRN2.Open();



            //if (connRN2.State != ConnectionState.Closed) connRN2.Close();

            //String strTextSearched = txtSearch.Text.Trim();

            //String strSqlSearchCase = "select [dbo].[tbl_case].[Case_Name], [dbo].[tbl_case].[Contact_ID], [dbo].[tbl_case].[Case_status], " +
            //                          "[dbo].[tbl_case].[CreateDate], [dbo].[tbl_case].[CreateStaff], " +
            //                          "[dbo].[tbl_case].[ModifiDate], [dbo].[tbl_case].[ModifiStaff], " +
            //                          "[dbo].[tbl_case].[NPF_Form], [dbo].[tbl_case].[NPF_Form_File_Name], [dbo].[tbl_case].[NPF_Receiv_Date], " +
            //                          "[dbo].[tbl_case].[IB_Form], [dbo].[tbl_case].[IB_Form_File_Name], [dbo].[tbl_case].[IB_Receiv_Date], " +
            //                          "[dbo].[tbl_case].[POP_Form], [dbo].[tbl_case].[POP_Form_File_Name], [dbo].[tbl_case].[POP_Receiv_Date], " +
            //                          "[dbo].[tbl_case].[MedRec_Form], [dbo].[tbl_case].[MedRec_Form_File_Name], [dbo].[tbl_case].[MedRec_Receiv_Date], " +
            //                          "[dbo].[tbl_case].[Unknown_Form], [dbo].[tbl_case].[Unknown_Form_File_Name], [dbo].[tbl_case].[Unknown_Receiv_Date], " +
            //                          "[dbo].[tbl_case].[AddBill_Form], [dbo].[tbl_case].[AddBill_Receiv_Date] " +
            //                          "from  [dbo].[tbl_case] " +
            //                          "where [dbo].[tbl_case].[ID] like '%' + @Id + '%' or " +
            //                          "[dbo].[tbl_case].[Case_Name] like '%' + @CaseName + '%' or " +
            //                          "[dbo].[tbl_case].[Contact_ID] like '%' + @ContactId + '%' or " +
            //                          "[dbp].[tbl_case].[Log_ID] like '%' + @LogID + '%'";

            //SqlCommand cmdQueryForCase = new SqlCommand(strSqlSearchCase, connRN);
            //cmdQueryForCase.CommandType = CommandType.Text;

            btnIndViewUpdateUpperRight.Enabled = false;
            //btnIndViewUpdateLowerRight.Enabled = false;
            btnCaseCreationSaveUpper.Enabled = false;
            //btnCaseCreationLowerSave.Enabled = false;
            btnMedBillCreatePgUpperSave.Enabled = false;
            //btnMedBillCreationPgLowerSave.Enabled = false;

        }

        private void gvIndividualSearched_CellDoubleClick(object sender, DataGridViewCellEventArgs e)
        {
            int nRowSelected = e.RowIndex;

            if (nRowSelected > -1)
            {

                InitializedIndividualBankInfo();
                InitializeIndividualInfo();
                InitializeCaseForm();
                InitializeMedBillForm();

                DisableCaseForm();
                DisableMedicalBillForm();
                // also clear case form and med bill form

                EnableIndividualView();
                EnableCaseView();
                EnableIllnessView();
                EnableIncidentView();
                EnableMedBillView();

                IndividualSearched = new IndividualInfo();
                IndividualForMedBill = new IndividualInfo();

                pdfBlueSheetViewer.src = "C:\\Program Files (x86)\\RN\\RNManager\\blank.pdf";

                IndividualSearched.strIndividualID = gvIndividualSearched["Individual No.", nRowSelected]?.Value?.ToString();
                IndividualForMedBill.strIndividualID = gvIndividualSearched["Individual No.", nRowSelected]?.Value?.ToString();

                String strSqlQueryForIndividualMemberInfo = "select [dbo].[contact].[Individual_ID__C], [dbo].[contact].[LastName], [dbo].[contact].[FirstName], [dbo].[contact].[MiddleName], " +
                                                      "[dbo].[membership].[Name], [dbo].[contact].[Social_Security_Number__c], [dbo].[contact].[Legacy_Database_Individual_ID__C], " +
                                                      "[dbo].[contact].[c4g_Membership_Status__C], [dbo].[contact].[Membership_Ind_Start_Date__C], [dbo].[contact].[Membership_Cancelled_Date__C], " +
                                                      "[dbo].[contact].[BirthDate], [dbo].[contact].[cmm_Gender__C], [dbo].[contact].[Household_Role__C], " +
                                                      "[dbo].[program].[Name], " +
                                                      "[dbo].[Account].[ShippingStreet], [dbo].[Account].[ShippingCity], [dbo].[Account].[ShippingState], [dbo].[Account].[ShippingPostalCode], " +
                                                      "[dbo].[Account].[BillingStreet], [dbo].[Account].[BillingCity], [dbo].[Account].[BillingState], [dbo].[Account].[BillingPostalCode], " +
                                                      "[dbo].[Church].[Name], [dbo].[contact].[Email], [dbo].[Account].[cmm_Email__c] " +
                                                      "from contact " +
                                                      "left join membership on contact.c4g_Membership__C = membership.ID " +
                                                      "left join program on contact.c4g_plan__c = program.ID " +
                                                      "left join Church on contact.c4g_Church__C = Church.ID " +
                                                      "left join [dbo].[Account] on [dbo].[contact].[AccountId] = [dbo].[Account].[Id] " +
                                                      "where [dbo].[contact].[Individual_ID__C] = @IndividualId";

                SqlCommand cmdQueryForIndividualMemberInfo = new SqlCommand(strSqlQueryForIndividualMemberInfo, connSalesforce2);
                cmdQueryForIndividualMemberInfo.CommandType = CommandType.Text;

                cmdQueryForIndividualMemberInfo.Parameters.AddWithValue("@IndividualId", IndividualSearched.strIndividualID);

                if (connSalesforce2.State != ConnectionState.Closed)
                {
                    connSalesforce2.Close();
                    connSalesforce2.Open();
                }
                else if (connSalesforce2.State == ConnectionState.Closed) connSalesforce2.Open();
                SqlDataReader rdrIndividualMemberInfo = cmdQueryForIndividualMemberInfo.ExecuteReader();
                if (rdrIndividualMemberInfo.HasRows)
                {
                    rdrIndividualMemberInfo.Read();
                    if (!rdrIndividualMemberInfo.IsDBNull(0))
                    {
                        IndividualSearched.strIndividualID = rdrIndividualMemberInfo.GetString(0);
                        IndividualForMedBill.strIndividualID = rdrIndividualMemberInfo.GetString(0);
                    }
                    if (!rdrIndividualMemberInfo.IsDBNull(1))
                    {
                        IndividualSearched.strLastName = rdrIndividualMemberInfo.GetString(1);
                        IndividualForMedBill.strLastName = rdrIndividualMemberInfo.GetString(1);
                    }
                    if (!rdrIndividualMemberInfo.IsDBNull(2))
                    {
                        IndividualSearched.strFirstName = rdrIndividualMemberInfo.GetString(2);
                        IndividualForMedBill.strFirstName = rdrIndividualMemberInfo.GetString(2);
                    }
                    if (!rdrIndividualMemberInfo.IsDBNull(3))
                    {
                        IndividualSearched.strMiddleName = rdrIndividualMemberInfo.GetString(3);
                        IndividualForMedBill.strMiddleName = rdrIndividualMemberInfo.GetString(3);
                    }
                    if (!rdrIndividualMemberInfo.IsDBNull(4))
                    {
                        IndividualSearched.strMembershipID = rdrIndividualMemberInfo.GetString(4);
                        IndividualForMedBill.strMembershipID = rdrIndividualMemberInfo.GetString(4);
                    }
                    if (!rdrIndividualMemberInfo.IsDBNull(5))
                    {
                        IndividualSearched.strSSN = rdrIndividualMemberInfo.GetString(5);
                        IndividualForMedBill.strSSN = rdrIndividualMemberInfo.GetString(5);
                    }
                    if (!rdrIndividualMemberInfo.IsDBNull(6))
                    {
                        IndividualSearched.strLegacyIndividualID = rdrIndividualMemberInfo.GetString(6);
                        IndividualForMedBill.strLegacyIndividualID = rdrIndividualMemberInfo.GetString(6);
                    }
                    if (!rdrIndividualMemberInfo.IsDBNull(7))
                    {
                        String strMembershipStatus = rdrIndividualMemberInfo.GetString(7).Trim();
                        switch (strMembershipStatus)
                        {
                            case "Pending":
                                IndividualSearched.membershipStatus = MembershipStatus.Pending;
                                IndividualForMedBill.membershipStatus = MembershipStatus.Pending;
                                break;
                            case "Applied":
                                IndividualSearched.membershipStatus = MembershipStatus.Applied;
                                IndividualForMedBill.membershipStatus = MembershipStatus.Applied;
                                break;
                            case "Active":
                                IndividualSearched.membershipStatus = MembershipStatus.Active;
                                IndividualForMedBill.membershipStatus = MembershipStatus.Active;
                                break;
                            case "Past Due":
                                IndividualSearched.membershipStatus = MembershipStatus.PastDue;
                                IndividualForMedBill.membershipStatus = MembershipStatus.PastDue;
                                break;
                            case "Inactive":
                                IndividualSearched.membershipStatus = MembershipStatus.Inactive;
                                IndividualForMedBill.membershipStatus = MembershipStatus.Inactive;
                                break;
                            case "Cancelled Req.":
                                IndividualSearched.membershipStatus = MembershipStatus.CancelledReq;
                                IndividualForMedBill.membershipStatus = MembershipStatus.CancelledReq;
                                break;
                            case "Cancelled by Member":
                                IndividualSearched.membershipStatus = MembershipStatus.CancelledByMember;
                                IndividualForMedBill.membershipStatus = MembershipStatus.CancelledByMember;
                                break;
                            case "Terminated by CMM":
                                IndividualSearched.membershipStatus = MembershipStatus.TerminatedByCMM;
                                IndividualForMedBill.membershipStatus = MembershipStatus.TerminatedByCMM;
                                break;
                            case "Hold":
                                IndividualSearched.membershipStatus = MembershipStatus.Hold;
                                IndividualForMedBill.membershipStatus = MembershipStatus.Hold;
                                break;
                            case "Incomplete":
                                IndividualSearched.membershipStatus = MembershipStatus.Incomplete;
                                IndividualForMedBill.membershipStatus = MembershipStatus.Incomplete;
                                break;
                            default:
                                break;
                        }
                    }
                    if (!rdrIndividualMemberInfo.IsDBNull(8))
                    {
                        IndividualSearched.dtMembershipIndStartDate = rdrIndividualMemberInfo.GetDateTime(8);
                        IndividualForMedBill.dtMembershipIndStartDate = rdrIndividualMemberInfo.GetDateTime(8);
                    }
                    if (!rdrIndividualMemberInfo.IsDBNull(9))
                    {
                        IndividualSearched.dtMembershipCancelledDate = rdrIndividualMemberInfo.GetDateTime(9);
                        IndividualForMedBill.dtMembershipCancelledDate = rdrIndividualMemberInfo.GetDateTime(9);
                    }
                    if (!rdrIndividualMemberInfo.IsDBNull(10))
                    {
                        IndividualSearched.dtBirthDate = rdrIndividualMemberInfo.GetDateTime(10);
                        IndividualForMedBill.dtBirthDate = rdrIndividualMemberInfo.GetDateTime(10);
                    }
                    if (!rdrIndividualMemberInfo.IsDBNull(11))
                    {
                        String IndividualGender = rdrIndividualMemberInfo.GetString(11);
                        switch (IndividualGender)
                        {
                            case "Male":
                                IndividualSearched.IndividualGender = Gender.Male;
                                IndividualForMedBill.IndividualGender = Gender.Male;
                                break;
                            case "Female":
                                IndividualSearched.IndividualGender = Gender.Female;
                                IndividualForMedBill.IndividualGender = Gender.Female;
                                break;
                        }
                    }
                    if (!rdrIndividualMemberInfo.IsDBNull(12))
                    {
                        String IndividualHouseholdRole = rdrIndividualMemberInfo.GetString(12);
                        switch(IndividualHouseholdRole)
                        {
                            case "Head of Household":
                                IndividualSearched.IndividualHouseholdRole = HouseholdRole.HeadOfHousehold;
                                IndividualForMedBill.IndividualHouseholdRole = HouseholdRole.HeadOfHousehold;
                                break;
                            case "Spouse":
                                IndividualSearched.IndividualHouseholdRole = HouseholdRole.Spouse;
                                IndividualForMedBill.IndividualHouseholdRole = HouseholdRole.Spouse;
                                break;
                            case "Child":
                                IndividualSearched.IndividualHouseholdRole = HouseholdRole.Child;
                                IndividualForMedBill.IndividualHouseholdRole = HouseholdRole.Child;
                                break;
                        }
                    }
                    if (!rdrIndividualMemberInfo.IsDBNull(13))
                    {
                        String IndividualProgramName = rdrIndividualMemberInfo.GetString(13);
                        switch(IndividualProgramName)
                        {
                            case "Gold Plus":
                                IndividualSearched.IndividualPlan = Plan.GoldPlus;
                                IndividualForMedBill.IndividualPlan = Plan.GoldPlus;
                                break;
                            case "Gold":
                                IndividualSearched.IndividualPlan = Plan.Gold;
                                IndividualForMedBill.IndividualPlan = Plan.Gold;
                                break;
                            case "Silver":
                                IndividualSearched.IndividualPlan = Plan.Silver;
                                IndividualForMedBill.IndividualPlan = Plan.Silver;
                                break;
                            case "Bronze":
                                IndividualSearched.IndividualPlan = Plan.Bronze;
                                IndividualForMedBill.IndividualPlan = Plan.Bronze;
                                break;
                            case "Gold Medi-I":
                                IndividualSearched.IndividualPlan = Plan.GoldMedi_I;
                                IndividualForMedBill.IndividualPlan = Plan.GoldMedi_I;
                                break;
                            case "Gold Medi-II":
                                IndividualSearched.IndividualPlan = Plan.GoldMedi_II;
                                IndividualForMedBill.IndividualPlan = Plan.GoldMedi_II;
                                break;
                        }
                    }
                    if (!rdrIndividualMemberInfo.IsDBNull(14))
                    {
                        IndividualSearched.strShippingStreetAddress = rdrIndividualMemberInfo.GetString(14);
                        IndividualForMedBill.strShippingStreetAddress = rdrIndividualMemberInfo.GetString(14);
                    }
                    if (!rdrIndividualMemberInfo.IsDBNull(15))
                    {
                        IndividualSearched.strShippingCity = rdrIndividualMemberInfo.GetString(15);
                        IndividualForMedBill.strShippingCity = rdrIndividualMemberInfo.GetString(15);
                    }
                    if (!rdrIndividualMemberInfo.IsDBNull(16))
                    {
                        IndividualSearched.strShippingState = rdrIndividualMemberInfo.GetString(16);
                        IndividualForMedBill.strShippingState = rdrIndividualMemberInfo.GetString(16);
                    }
                    if (!rdrIndividualMemberInfo.IsDBNull(17))
                    {
                        IndividualSearched.strShippingZip = rdrIndividualMemberInfo.GetString(17);
                        IndividualForMedBill.strShippingZip = rdrIndividualMemberInfo.GetString(17);
                    }
                    if (!rdrIndividualMemberInfo.IsDBNull(18))
                    {
                        IndividualSearched.strBillingStreetAddress = rdrIndividualMemberInfo.GetString(18);
                        IndividualForMedBill.strBillingStreetAddress = rdrIndividualMemberInfo.GetString(18);
                    }
                    if (!rdrIndividualMemberInfo.IsDBNull(19))
                    {
                        IndividualSearched.strBillingCity = rdrIndividualMemberInfo.GetString(19);
                        IndividualForMedBill.strBillingCity = rdrIndividualMemberInfo.GetString(19);
                    }
                    if (!rdrIndividualMemberInfo.IsDBNull(20))
                    {
                        IndividualSearched.strBillingState = rdrIndividualMemberInfo.GetString(20);
                        IndividualForMedBill.strBillingState = rdrIndividualMemberInfo.GetString(20);
                    }
                    if (!rdrIndividualMemberInfo.IsDBNull(21))
                    {
                        IndividualSearched.strBillingZip = rdrIndividualMemberInfo.GetString(21);
                        IndividualForMedBill.strBillingZip = rdrIndividualMemberInfo.GetString(21);
                    }
                    if (!rdrIndividualMemberInfo.IsDBNull(22))
                    {
                        IndividualSearched.strChurch = rdrIndividualMemberInfo.GetString(22);
                        IndividualForMedBill.strChurch = rdrIndividualMemberInfo.GetString(22);
                    }
                    if (!rdrIndividualMemberInfo.IsDBNull(23))
                    {
                        String strEmail = String.Empty;
                        strEmail = rdrIndividualMemberInfo.GetString(23);
                        if (strEmail != String.Empty)
                        {
                            IndividualSearched.strEmail = strEmail;
                            IndividualForMedBill.strEmail = strEmail;
                        }
                        else
                        {
                            IndividualSearched.strEmail = rdrIndividualMemberInfo.GetString(24);
                            IndividualForMedBill.strEmail = rdrIndividualMemberInfo.GetString(24);
                        }
                    }
                }
                rdrIndividualMemberInfo.Close();
                if (connSalesforce2.State != ConnectionState.Closed) connSalesforce2.Close();


                ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                //String IndividualName = gvIndividualSearched["Name", nRowSelected]?.Value?.ToString().Trim();
                //IndividualSearched.strLastName = IndividualName.Substring(0, IndividualName.IndexOf(','));
                //IndividualSearched.strFirstName = IndividualName.Substring(IndividualName.IndexOf(',') + 2);
                //if (IndividualSearched.strFirstName.IndexOf(' ') > 0) IndividualSearched.strFirstName = IndividualSearched.strFirstName.Substring(0, IndividualSearched.strFirstName.IndexOf(' '));
                //String TempIndividualName = IndividualName.Substring(IndividualName.IndexOf(' ') + 1);
                //IndividualSearched.strMiddleName = String.Empty;
                //if (TempIndividualName.IndexOf(' ') > 0)
                //{
                //    IndividualSearched.strMiddleName = TempIndividualName.Substring(TempIndividualName.IndexOf(' ') + 1);
                //}

                //String IndividualNameForMedBill = gvIndividualSearched["Name", nRowSelected]?.Value?.ToString().Trim();
                //IndividualForMedBill.strLastName = IndividualNameForMedBill.Substring(0, IndividualName.IndexOf(','));
                //IndividualForMedBill.strFirstName = IndividualNameForMedBill.Substring(IndividualName.IndexOf(',') + 2);
                //if (IndividualForMedBill.strFirstName.IndexOf(' ') > 0) IndividualForMedBill.strFirstName = IndividualForMedBill.strFirstName.Substring(0, IndividualForMedBill.strFirstName.IndexOf(' '));
                //String TempIndividualNameForMedBill = IndividualNameForMedBill.Substring(IndividualNameForMedBill.IndexOf(' ') + 1);
                //IndividualForMedBill.strMiddleName = String.Empty;
                //if (TempIndividualName.IndexOf(' ') > 0)
                //{
                //    IndividualForMedBill.strMiddleName = TempIndividualNameForMedBill.Substring(TempIndividualNameForMedBill.IndexOf(' ') + 1);
                //}


                //IndividualSearched.strMembershipID = gvIndividualSearched["Membership", nRowSelected]?.Value?.ToString();
                //IndividualSearched.strSSN = gvIndividualSearched["SSN", nRowSelected]?.Value?.ToString();
                //IndividualSearched.strLegacyIndividualID = gvIndividualSearched["CRM No.", nRowSelected]?.Value?.ToString();

                //IndividualForMedBill.strMembershipID = gvIndividualSearched["Membership", nRowSelected]?.Value?.ToString();
                //IndividualForMedBill.strSSN = gvIndividualSearched["SSN", nRowSelected]?.Value?.ToString();
                //IndividualForMedBill.strLegacyIndividualID = gvIndividualSearched["CRM No.", nRowSelected]?.Value?.ToString();

                //switch (gvIndividualSearched["Membership Status", nRowSelected].Value.ToString())
                //{
                //    case "Pending":
                //        IndividualSearched.membershipStatus = MembershipStatus.Pending;
                //        IndividualForMedBill.membershipStatus = MembershipStatus.Pending;
                //        break;
                //    case "Applied":
                //        IndividualSearched.membershipStatus = MembershipStatus.Applied;
                //        IndividualForMedBill.membershipStatus = MembershipStatus.Applied;
                //        break;
                //    case "Active":
                //        IndividualSearched.membershipStatus = MembershipStatus.Active;
                //        IndividualForMedBill.membershipStatus = MembershipStatus.Active;
                //        break;
                //    case "Past Due":
                //        IndividualSearched.membershipStatus = MembershipStatus.PastDue;
                //        IndividualForMedBill.membershipStatus = MembershipStatus.PastDue;
                //        break;
                //    case "Inactive":
                //        IndividualSearched.membershipStatus = MembershipStatus.Inactive;
                //        IndividualForMedBill.membershipStatus = MembershipStatus.Inactive;
                //        break;
                //    case "Cancelled Req.":
                //        IndividualSearched.membershipStatus = MembershipStatus.CancelledReq;
                //        IndividualForMedBill.membershipStatus = MembershipStatus.CancelledReq;
                //        break;
                //    case "Cancelled by Member":
                //        IndividualSearched.membershipStatus = MembershipStatus.CancelledByMember;
                //        IndividualForMedBill.membershipStatus = MembershipStatus.CancelledByMember;
                //        break;
                //    case "Terminated by CMM":
                //        IndividualSearched.membershipStatus = MembershipStatus.TerminatedByCMM;
                //        IndividualForMedBill.membershipStatus = MembershipStatus.TerminatedByCMM;
                //        break;
                //    case "Hold":
                //        IndividualSearched.membershipStatus = MembershipStatus.Hold;
                //        IndividualForMedBill.membershipStatus = MembershipStatus.Hold;
                //        break;
                //    case "Incomplete":
                //        IndividualSearched.membershipStatus = MembershipStatus.Incomplete;
                //        IndividualForMedBill.membershipStatus = MembershipStatus.Incomplete;
                //        break;
                //    default:
                //        break;
                //}

                //if (gvIndividualSearched["Membership Start Date", nRowSelected]?.Value?.ToString() != String.Empty)
                //{
                //    IndividualSearched.dtMembershipIndStartDate = DateTime.Parse(gvIndividualSearched["Membership Start Date", nRowSelected]?.Value?.ToString());
                //    IndividualForMedBill.dtMembershipIndStartDate = DateTime.Parse(gvIndividualSearched["Membership Start Date", nRowSelected]?.Value?.ToString());
                //}

                //if (gvIndividualSearched["Membership Cancel Date", nRowSelected]?.Value?.ToString() != String.Empty)
                //{
                //    IndividualSearched.dtMembershipCancelledDate = DateTime.Parse(gvIndividualSearched["Membership Cancel Date", nRowSelected]?.Value?.ToString());
                //    IndividualForMedBill.dtMembershipCancelledDate = DateTime.Parse(gvIndividualSearched["Membership Cancel Date", nRowSelected]?.Value?.ToString());
                //}

                //IndividualSearched.dtBirthDate = DateTime.Parse(gvIndividualSearched["BirthDate", nRowSelected]?.Value?.ToString());
                //IndividualForMedBill.dtBirthDate = DateTime.Parse(gvIndividualSearched["BirthDate", nRowSelected]?.Value?.ToString());

                //switch (gvIndividualSearched["Gender", nRowSelected]?.Value?.ToString())
                //{
                //    case "Male":
                //        IndividualSearched.IndividualGender = Gender.Male;
                //        IndividualForMedBill.IndividualGender = Gender.Male;
                //        break;
                //    case "Female":
                //        IndividualSearched.IndividualGender = Gender.Female;
                //        IndividualForMedBill.IndividualGender = Gender.Female;
                //        break;
                //}


                //switch (gvIndividualSearched["House Type", nRowSelected]?.Value?.ToString())
                //{
                //    case "Head of Household":
                //        IndividualSearched.IndividualHouseholdRole = HouseholdRole.HeadOfHousehold;
                //        IndividualForMedBill.IndividualHouseholdRole = HouseholdRole.HeadOfHousehold;
                //        break;
                //    case "Spouse":
                //        IndividualSearched.IndividualHouseholdRole = HouseholdRole.Spouse;
                //        IndividualForMedBill.IndividualHouseholdRole = HouseholdRole.Spouse;
                //        break;
                //    case "Child":
                //        IndividualSearched.IndividualHouseholdRole = HouseholdRole.Child;
                //        IndividualForMedBill.IndividualHouseholdRole = HouseholdRole.Child;
                //        break;
                //}

                //switch (gvIndividualSearched["Program Name", nRowSelected]?.Value?.ToString())
                //{
                //    case "Gold Plus":
                //        IndividualSearched.IndividualPlan = Plan.GoldPlus;
                //        IndividualForMedBill.IndividualPlan = Plan.GoldPlus;
                //        break;
                //    case "Gold":
                //        IndividualSearched.IndividualPlan = Plan.Gold;
                //        IndividualForMedBill.IndividualPlan = Plan.Gold;
                //        break;
                //    case "Silver":
                //        IndividualSearched.IndividualPlan = Plan.Silver;
                //        IndividualForMedBill.IndividualPlan = Plan.Silver;
                //        break;
                //    case "Bronze":
                //        IndividualSearched.IndividualPlan = Plan.Bronze;
                //        IndividualForMedBill.IndividualPlan = Plan.Bronze;
                //        break;
                //    case "Gold Medi-I":
                //        IndividualSearched.IndividualPlan = Plan.GoldMedi_I;
                //        IndividualForMedBill.IndividualPlan = Plan.GoldMedi_I;
                //        break;
                //    case "Gold Medi-II":
                //        IndividualSearched.IndividualPlan = Plan.GoldMedi_II;
                //        IndividualForMedBill.IndividualPlan = Plan.GoldMedi_II;
                //        break;
                //}


                ////IndividualSearched.strShippingStreetAddress = gvIndividualSearched["ShippingStreet", nRowSelected]?.Value?.ToString();
                ////IndividualSearched.strShippingCity = gvIndividualSearched["ShippingCity", nRowSelected]?.Value?.ToString();
                ////IndividualSearched.strShippingState = gvIndividualSearched["ShippingState", nRowSelected]?.Value?.ToString();
                ////IndividualSearched.strShippingZip = gvIndividualSearched["ShippingPostalCode", nRowSelected]?.Value?.ToString();

                //IndividualSearched.strShippingStreetAddress = gvIndividualSearched["MailingStreet", nRowSelected]?.Value?.ToString();
                //IndividualSearched.strShippingCity = gvIndividualSearched["MailingCity", nRowSelected]?.Value?.ToString();
                //IndividualSearched.strShippingState = gvIndividualSearched["MailingState", nRowSelected]?.Value?.ToString();
                //IndividualSearched.strShippingZip = gvIndividualSearched["MailingPostalCode", nRowSelected]?.Value?.ToString();

                //IndividualForMedBill.strShippingStreetAddress = gvIndividualSearched["MailingStreet", nRowSelected]?.Value?.ToString();
                //IndividualForMedBill.strShippingCity = gvIndividualSearched["MailingCity", nRowSelected]?.Value?.ToString();
                //IndividualForMedBill.strShippingState = gvIndividualSearched["MailingState", nRowSelected]?.Value?.ToString();
                //IndividualForMedBill.strShippingZip = gvIndividualSearched["MailingPostalCode", nRowSelected]?.Value?.ToString();


                ////IndividualSearched.strBillingStreetAddress = gvIndividualSearched["BillingStreet", nRowSelected]?.Value?.ToString();
                ////IndividualSearched.strBillingCity = gvIndividualSearched["BillingCity", nRowSelected]?.Value?.ToString();
                ////IndividualSearched.strBillingState = gvIndividualSearched["BillingState", nRowSelected]?.Value?.ToString();
                ////IndividualSearched.strBillingZip = gvIndividualSearched["BillingPostalCode", nRowSelected]?.Value?.ToString();

                //IndividualSearched.strBillingStreetAddress = gvIndividualSearched["OtherStreet", nRowSelected]?.Value?.ToString();
                //IndividualSearched.strBillingCity = gvIndividualSearched["OtherCity", nRowSelected]?.Value?.ToString();
                //IndividualSearched.strBillingState = gvIndividualSearched["OtherState", nRowSelected]?.Value?.ToString();
                //IndividualSearched.strBillingZip = gvIndividualSearched["OtherPostalCode", nRowSelected]?.Value?.ToString();

                //IndividualForMedBill.strBillingStreetAddress = gvIndividualSearched["OtherStreet", nRowSelected]?.Value?.ToString();
                //IndividualForMedBill.strBillingCity = gvIndividualSearched["OtherCity", nRowSelected]?.Value?.ToString();
                //IndividualForMedBill.strBillingState = gvIndividualSearched["OtherState", nRowSelected]?.Value?.ToString();
                //IndividualForMedBill.strBillingZip = gvIndividualSearched["OtherPostalCode", nRowSelected]?.Value?.ToString();

                //IndividualSearched.strChurch = gvIndividualSearched["Church Name", nRowSelected]?.Value?.ToString();
                //IndividualSearched.strEmail = gvIndividualSearched["Email", nRowSelected]?.Value?.ToString();

                //IndividualForMedBill.strChurch = gvIndividualSearched["Church Name", nRowSelected]?.Value?.ToString();
                //IndividualForMedBill.strEmail = gvIndividualSearched["Email", nRowSelected]?.Value?.ToString();


                //IndividualSearched.dtBirthDate = DateTime.Parse(gvIndividualSearched["BIRTHDATE", nRowSelected].Value.ToString());
                //if (gvIndividualSearched["cmm_GENDER__C", nRowSelected].Value.ToString() == "Male") IndividualSearched.IndividualGender = Gender.Male;
                //else if (gvIndividualSearched["cmm_GENDER__C", nRowSelected].Value.ToString() == "Female") IndividualSearched.IndividualGender = Gender.Female;
                //if (gvIndividualSearched["HOUSEHOLD_ROLE__C", nRowSelected].Value.ToString() == "Head of Household")
                //    IndividualSearched.IndividualHouseholdRole = HouseholdRole.HeadOfHousehold;
                //else if (gvIndividualSearched["HOUSEHOLD_ROLE__C", nRowSelected].Value.ToString() == "Spouse") IndividualSearched.IndividualHouseholdRole = HouseholdRole.Spouse;
                //else if (gvIndividualSearched["HOUSEHOLD_ROLE__C", nRowSelected].Value.ToString() == "Child") IndividualSearched.IndividualHouseholdRole = HouseholdRole.Child;

                //IndividualSearched.strSSN = gvIndividualSearched["SOCIAL_SECURITY_NUMBER__C", nRowSelected].Value.ToString();

                //IndividualSearched.strBillingStreetAddress = gvIndividualSearched["BillingStreet", nRowSelected].Value.ToString();
                //IndividualSearched.strBillingCity = gvIndividualSearched["BillingCity", nRowSelected].Value.ToString();
                //IndividualSearched.strBillingState = gvIndividualSearched["BillingState", nRowSelected].Value.ToString();
                //IndividualSearched.strBillingZip = gvIndividualSearched["BillingPostalCode", nRowSelected].Value.ToString();
                //IndividualSearched.strShippingStreetAddress = gvIndividualSearched["ShippingStreet", nRowSelected].Value.ToString();
                //IndividualSearched.strShippingCity = gvIndividualSearched["ShippingCity", nRowSelected].Value.ToString();
                //IndividualSearched.strShippingState = gvIndividualSearched["ShippingState", nRowSelected].Value.ToString();
                //IndividualSearched.strShippingZip = gvIndividualSearched["ShippingPostalCode", nRowSelected].Value.ToString();

                //IndividualSearched.strEmail = gvIndividualSearched["Email", nRowSelected].Value.ToString();

                //if (gvIndividualSearched["ProgramName", nRowSelected].Value.ToString() == "Gold Medi-I") IndividualSearched.IndividualPlan = Plan.GoldMedi_I;
                //else if (gvIndividualSearched["ProgramName", nRowSelected].Value.ToString() == "Gold Medi-II") IndividualSearched.IndividualPlan = Plan.GoldMedi_II;
                //else if (gvIndividualSearched["ProgramName", nRowSelected].Value.ToString() == "Gold Plus") IndividualSearched.IndividualPlan = Plan.GoldPlus;
                //else if (gvIndividualSearched["ProgramName", nRowSelected].Value.ToString() == "Gold") IndividualSearched.IndividualPlan = Plan.Gold;
                //else if (gvIndividualSearched["ProgramName", nRowSelected].Value.ToString() == "Silver") IndividualSearched.IndividualPlan = Plan.Silver;
                //else if (gvIndividualSearched["ProgramName", nRowSelected].Value.ToString() == "Bronze") IndividualSearched.IndividualPlan = Plan.Bronze;

                //IndividualSearched.dtMembershipIndStartDate = DateTime.Parse(gvIndividualSearched["MembershipStartDate", nRowSelected].Value.ToString());
                //if (gvIndividualSearched["MembershipCancelDate", nRowSelected].Value.ToString() != String.Empty)
                //{
                //    IndividualSearched.dtMembershipCancelledDate = DateTime.Parse(gvIndividualSearched["MembershipCancelDate", nRowSelected].Value.ToString());
                //}
                //else IndividualSearched.dtMembershipCancelledDate = null;

                //IndividualSearched.strChurch = gvIndividualSearched["ChurchName", nRowSelected].Value.ToString();



                //DialogResult = DialogResult.OK;
                //return;

                //tbCMMManager.TabPages.Insert(2, tbpgIndividual);
                //tbCMMManager.SelectedIndex = 2;

                // Populate IndividualSearched - 05/9/19


                txtMembershipID.Text = IndividualSearched.strMembershipID;
                txtIndividualID.Text = IndividualSearched.strIndividualID;
                txtCRM_ID.Text = IndividualSearched.strLegacyIndividualID;

                txtFirstName.Text = IndividualSearched.strFirstName;
                txtMiddleName.Text = IndividualSearched.strMiddleName;
                txtLastName.Text = IndividualSearched.strLastName;
                dtpBirthDate.Text = IndividualSearched.dtBirthDate.Value.ToString("MM/dd/yyyy");

                if (IndividualSearched.IndividualGender == Gender.Male) cbGender.SelectedIndex = 0;
                else if (IndividualSearched.IndividualGender == Gender.Female) cbGender.SelectedIndex = 1;

                txtStreetAddress1.Text = IndividualSearched.strShippingStreetAddress;
                txtZip1.Text = IndividualSearched.strShippingZip;
                txtCity1.Text = IndividualSearched.strShippingCity;
                txtState1.Text = IndividualSearched.strShippingState;

                txtStreetAddress2.Text = IndividualSearched.strBillingStreetAddress;
                txtZip2.Text = IndividualSearched.strBillingZip;
                txtCity2.Text = IndividualSearched.strBillingCity;
                txtState2.Text = IndividualSearched.strBillingState;
                txtEmail.Text = IndividualSearched.strEmail;

                List<String> lstCommunicationMethod = new List<String>();

                String strSqlQueryForCommunicationMethods = "select [dbo].[CommunicationMethod].[CommunicationMethod] from [dbo].[CommunicationMethod]";

                SqlCommand cmdQueryForCommunicationMethod = new SqlCommand(strSqlQueryForCommunicationMethods, connSalesforce);
                cmdQueryForCommunicationMethod.CommandType = CommandType.Text;

                if (connSalesforce.State != ConnectionState.Closed)
                {
                    connSalesforce.Close();
                    connSalesforce.Open();
                }
                else if (connSalesforce.State == ConnectionState.Closed) connSalesforce.Open();

                SqlDataReader rdrCommunicationMethods = cmdQueryForCommunicationMethod.ExecuteReader();

                if (rdrCommunicationMethods.HasRows)
                {
                    while (rdrCommunicationMethods.Read())
                    {
                        lstCommunicationMethod.Add(rdrCommunicationMethods.GetString(0));
                    }
                }
                rdrCommunicationMethods.Close();
                if (connSalesforce.State == ConnectionState.Open) connSalesforce.Close();

                cbPreferredCommunication.Items.Clear();

                foreach (String commMethod in lstCommunicationMethod)
                {
                    cbPreferredCommunication.Items.Add(commMethod);
                }

                List<String> lstReimbursementMethod = new List<string>();

                String strSqlQueryForReimbursementMethod = "select [dbo].[ReimbursementMethod].[ReimbursementMethodValue] from [dbo].[ReimbursementMethod]";

                SqlCommand cmdQueryForReimbursementMethod = new SqlCommand(strSqlQueryForReimbursementMethod, connSalesforce);
                cmdQueryForReimbursementMethod.CommandType = CommandType.Text;

                if (connSalesforce.State != ConnectionState.Closed)
                {
                    connSalesforce.Close();
                    connSalesforce.Open();
                }
                else if (connSalesforce.State == ConnectionState.Closed) connSalesforce.Open();

                SqlDataReader rdrReimbursementMethod = cmdQueryForReimbursementMethod.ExecuteReader();

                if (rdrReimbursementMethod.HasRows)
                {
                    while (rdrReimbursementMethod.Read())
                    {
                        lstReimbursementMethod.Add(rdrReimbursementMethod.GetString(0));
                    }
                }
                rdrReimbursementMethod.Close();
                if (connSalesforce.State == ConnectionState.Open) connSalesforce.Close();

                cbReimbursementMethod.Items.Clear();

                foreach (String reimbursementMethod in lstReimbursementMethod)
                {
                    cbReimbursementMethod.Items.Add(reimbursementMethod);
                }

                Boolean bBankNameInContact = false;
                Boolean bBankRoutingNoInContact = false;
                Boolean bBankAccountNoInContact = false;
                Boolean bBankAccountHolderInContact = false;

                String strSqlQueryForIndividualInfo = "select [dbo].[contact].[PreferredLanguage__c], [dbo].[contact].[PreferredCommunicationMethod__c], " +
                                                      "[dbo].[contact].[Phone], [dbo].[contact].[HomePhone], " +
                                                      "[dbo].[contact].[PowerOfAttorney__c], [dbo].[contact].[Relationship_POA__c], " +
                                                      "[dbo].[contact].[ReimbursementMethod__c], " +
                                                      "[dbo].[contact].[BankName__c], [dbo].[contact].[RoutingNumber__c], [dbo].[contact].[AccountNumber__c], [dbo].[contact].[AccountHolder__c], " +
                                                      "[dbo].[contact].[Social_Security_Number__c] " +
                                                      "from [dbo].[contact] " +
                                                      "where [dbo].[contact].[Individual_ID__c] = @IndividualId";

                SqlCommand cmdQueryForIndividualInfo = new SqlCommand(strSqlQueryForIndividualInfo, connSalesforce);
                cmdQueryForIndividualInfo.CommandType = CommandType.Text;

                cmdQueryForIndividualInfo.Parameters.AddWithValue("@IndividualId", IndividualSearched.strIndividualID);

                if (connSalesforce.State != ConnectionState.Closed)
                {
                    connSalesforce.Close();
                    connSalesforce.Open();
                }
                else if (connSalesforce.State == ConnectionState.Closed) connSalesforce.Open();

                SqlDataReader rdrIndividualInfo = cmdQueryForIndividualInfo.ExecuteReader();
                if (rdrIndividualInfo.HasRows)
                {
                    if (rdrIndividualInfo.Read())
                    {
                        if (!rdrIndividualInfo.IsDBNull(0))
                        {
                            String PreferredLanguage = rdrIndividualInfo.GetString(0).Trim().ToUpper();
                            if (PreferredLanguage == "KOREAN") rbKorean.Checked = true;
                            else if (PreferredLanguage == "ENGLISH") rbEnglish.Checked = true;
                        }
                        //{
                        //    if (rdrIndividualInfo.GetInt16(0) == 0)  // Preferred language is Korean
                        //    {
                        //        rbKorean.Checked = true;
                        //    }
                        //    else if (rdrIndividualInfo.GetInt16(0) == 1) // Preferred language is English
                        //    {
                        //        rbEnglish.Checked = true;
                        //    }
                        //}

                        if (!rdrIndividualInfo.IsDBNull(1))
                        {
                            //cbPreferredCommunication.SelectedIndex = rdrIndividualInfo.GetInt16(1);
                            cbPreferredCommunication.SelectedItem = rdrIndividualInfo.GetString(1).Trim();
                        }

                        if (!rdrIndividualInfo.IsDBNull(2)) txtCellPhone1.Text = rdrIndividualInfo.GetString(2).Trim();
                        if (!rdrIndividualInfo.IsDBNull(3)) txtBusinessPhone.Text = rdrIndividualInfo.GetString(3).Trim();

                        if (!rdrIndividualInfo.IsDBNull(4)) txtPowerOfAttorney.Text = rdrIndividualInfo.GetString(4).Trim();
                        if (!rdrIndividualInfo.IsDBNull(5)) txtRelationship.Text = rdrIndividualInfo.GetString(5).Trim();

                        if (!rdrIndividualInfo.IsDBNull(6)) cbReimbursementMethod.SelectedItem = rdrIndividualInfo.GetString(6);

                        if (!rdrIndividualInfo.IsDBNull(7))
                        {
                            IndividualBankInfo.BankName = rdrIndividualInfo.GetString(7);
                            bBankNameInContact = true;
                        }
                        if (!rdrIndividualInfo.IsDBNull(8))
                        {
                            IndividualBankInfo.BankRoutingNumber = rdrIndividualInfo.GetString(8);
                            bBankRoutingNoInContact = true;
                        }
                        if (!rdrIndividualInfo.IsDBNull(9))
                        {
                            IndividualBankInfo.AccountNumber = rdrIndividualInfo.GetString(9);
                            bBankAccountNoInContact = true;
                        }
                        if (!rdrIndividualInfo.IsDBNull(10))
                        {
                            IndividualBankInfo.AccountHolder = rdrIndividualInfo.GetString(10);
                            bBankAccountHolderInContact = true;
                        }

                        if (cbReimbursementMethod.SelectedItem != null)
                        {
                            if (cbReimbursementMethod.SelectedItem.ToString() == "ACH/Banking")
                            {
                                //if (!rdrIndividualInfo.IsDBNull(7)) txtBankName.Text = rdrIndividualInfo.GetString(7);
                                //if (!rdrIndividualInfo.IsDBNull(8)) txtBankRoutingNo.Text = rdrIndividualInfo.GetString(8);
                                //if (!rdrIndividualInfo.IsDBNull(9)) txtAccountNo.Text = rdrIndividualInfo.GetString(9);
                                //if (!rdrIndividualInfo.IsDBNull(10)) txtAccountHolder.Text = rdrIndividualInfo.GetString(10);
                                txtBankName.ReadOnly = false;
                                if (!rdrIndividualInfo.IsDBNull(7)) txtBankName.Text = IndividualBankInfo.BankName;
                                txtBankRoutingNo.ReadOnly = false;
                                if (!rdrIndividualInfo.IsDBNull(8)) txtBankRoutingNo.Text = IndividualBankInfo.BankRoutingNumber;
                                txtAccountNo.ReadOnly = false;
                                if (!rdrIndividualInfo.IsDBNull(9)) txtAccountNo.Text = IndividualBankInfo.AccountNumber;
                                txtAccountHolder.ReadOnly = false;
                                if (!rdrIndividualInfo.IsDBNull(10)) txtAccountHolder.Text = IndividualBankInfo.AccountHolder;
                            }
                        }
                        else
                        {
                            txtBankName.ReadOnly = true;
                            txtBankRoutingNo.ReadOnly = true;
                            txtAccountNo.ReadOnly = true;
                            txtAccountHolder.ReadOnly = true;

                            txtBankName.Text = String.Empty;
                            txtBankRoutingNo.Text = String.Empty;
                            txtAccountNo.Text = String.Empty;
                            txtAccountHolder.Text = String.Empty;
                        }

                        if (!rdrIndividualInfo.IsDBNull(11))
                        {
                            txtIndividualSSN.Text = rdrIndividualInfo.GetString(11).Trim();
                            IndividualSearched.strSSN = txtIndividualSSN.Text;
                        }
                    }
                }
                rdrIndividualInfo.Close();
                if (connSalesforce.State == ConnectionState.Open) connSalesforce.Close();

                if (bBankNameInContact == false ||
                    bBankRoutingNoInContact == false ||
                    bBankAccountNoInContact == false ||
                    bBankAccountHolderInContact == false)
                {
                    String strSqlQueryForBankInfoInMembership = "select [dbo].[membership].[Pay_BankName__c], [dbo].[membership].[Pay_RoutingNumber__c], " +
                                                                "[dbo].[membership].[Pay_AccountNumber__c], [dbo].[membership].[Pay_AccountHolder__c] " +
                                                                "from [dbo].[membership] " +
                                                                "inner join [dbo].[contact] on [dbo].[membership].[Id] = [dbo].[contact].[c4g_Membership__c] " +
                                                                "where [dbo].[contact].[Individual_ID__c] = @IndividualId";

                    SqlCommand cmdQueryForBankInfoMembership = new SqlCommand(strSqlQueryForBankInfoInMembership, connSalesforce2);
                    cmdQueryForBankInfoMembership.CommandType = CommandType.Text;

                    cmdQueryForBankInfoMembership.Parameters.AddWithValue("@IndividualId", IndividualSearched.strIndividualID);

                    if (connSalesforce2.State != ConnectionState.Closed)
                    {
                        connSalesforce2.Close();
                        connSalesforce2.Open();
                    }
                    else if (connSalesforce2.State == ConnectionState.Closed) connSalesforce2.Open();
                    SqlDataReader rdrBankInfoMembership = cmdQueryForBankInfoMembership.ExecuteReader();
                    if (rdrBankInfoMembership.HasRows)
                    {
                        rdrBankInfoMembership.Read();
                        if (!rdrBankInfoMembership.IsDBNull(0)) IndividualBankInfo.BankName = rdrBankInfoMembership.GetString(0);
                        if (!rdrBankInfoMembership.IsDBNull(1)) IndividualBankInfo.BankRoutingNumber = rdrBankInfoMembership.GetString(1);
                        if (!rdrBankInfoMembership.IsDBNull(2)) IndividualBankInfo.AccountNumber = rdrBankInfoMembership.GetString(2);
                        if (!rdrBankInfoMembership.IsDBNull(3)) IndividualBankInfo.AccountHolder = rdrBankInfoMembership.GetString(3);
                    }
                    if (connSalesforce2.State != ConnectionState.Closed) connSalesforce2.Close();
                }

                txtIndChurchName.Text = IndividualSearched.strChurch;

                var srcChurch = new AutoCompleteStringCollection();

                foreach (ChurchInfo info in lstChurchInfo)
                {
                    srcChurch.Add(info.Name);
                }

                txtIndChurchName.AutoCompleteMode = AutoCompleteMode.SuggestAppend;
                txtIndChurchName.AutoCompleteSource = AutoCompleteSource.CustomSource;
                txtIndChurchName.AutoCompleteCustomSource = srcChurch;

                if (IndividualSearched.IndividualPlan == Plan.GoldPlus) txtProgram.Text = "Gold Plus";
                else if (IndividualSearched.IndividualPlan == Plan.GoldMedi_I) txtProgram.Text = "Gold Medi-I";
                else if (IndividualSearched.IndividualPlan == Plan.GoldMedi_II) txtProgram.Text = "Gold Medi-II";
                else txtProgram.Text = IndividualSearched.IndividualPlan.ToString();

                //switch (IndividualSearched.IndividualPlan)
                //{
                //    case Plan.GoldPlus:
                //        txtMemberProgram.Text = "Gold Plus";
                //        break;
                //    case Plan.Gold:
                //        txtMemberProgram.Text = "Gold";
                //        break;
                //    case Plan.Silver:
                //        txtMemberProgram.Text = "Silver";
                //        break;
                //    case Plan.Bronze:
                //        txtMemberProgram.Text = "Bronze";
                //        break;
                //    case Plan.GoldMedi_I:
                //        txtMemberProgram.Text = "Gold Medi-I";
                //        break;
                //    case Plan.GoldMedi_II:
                //        txtMemberProgram.Text = "Gold Medi-II";
                //        break;
                //}


                txtMembershipStartDate.Text = IndividualSearched.dtMembershipIndStartDate.Value.ToString("MM/dd/yyyy");

                // Calculate Aniv Date
                String IndividualIdForAnivDate = IndividualSearched.strIndividualID;
                String strSqlQueryForLatestProgramChangeDate = "select max([dbo].[ContactHistory].[CreatedDate]) from [dbo].[ContactHistory] " +
                                                               "inner join [dbo].[contact] on [dbo].[ContactHistory].[ContactId] = [dbo].[contact].[Id] " +
                                                               "where [dbo].[ContactHistory].[Field] = 'c4g_Plan__c' and " +
                                                               "[dbo].[contact].[Individual_ID__c] = @IndividualId";

                SqlCommand cmdQueryForLatestProgramChangeDate = new SqlCommand(strSqlQueryForLatestProgramChangeDate, connSalesforce);
                cmdQueryForLatestProgramChangeDate.CommandType = CommandType.Text;

                cmdQueryForLatestProgramChangeDate.Parameters.AddWithValue("@IndividualId", IndividualIdForAnivDate);

                if (connSalesforce.State != ConnectionState.Closed)
                {
                    connSalesforce.Close();
                    connSalesforce.Open();
                }
                else if (connSalesforce.State == ConnectionState.Closed) connSalesforce.Open();
                Object objLatestProgramChangeDate = cmdQueryForLatestProgramChangeDate.ExecuteScalar();
                if (connSalesforce.State == ConnectionState.Open) connSalesforce.Close();

                DateTime? LatestProgramChangeDate = null;
                if (objLatestProgramChangeDate.ToString() != String.Empty) LatestProgramChangeDate = DateTime.Parse(objLatestProgramChangeDate.ToString());

                DateTime? MembershipStartDate = null;
                if (LatestProgramChangeDate == null)
                {
                    String strSqlQueryForMembershipStartDate = "select [dbo].[contact].[Membership_IND_Start_date__c] from [dbo].[contact] where [dbo].[contact].[Individual_ID__c] = @IndividualId";

                    SqlCommand cmdQueryForMembershipStartDate = new SqlCommand(strSqlQueryForMembershipStartDate, connSalesforce);
                    cmdQueryForMembershipStartDate.CommandType = CommandType.Text;

                    cmdQueryForMembershipStartDate.Parameters.AddWithValue("@IndividualId", IndividualIdForAnivDate);

                    if (connSalesforce.State != ConnectionState.Closed)
                    {
                        connSalesforce.Close();
                        connSalesforce.Open();
                    }
                    else if (connSalesforce.State == ConnectionState.Closed) connSalesforce.Open();
                    Object objMembershipStartDate = cmdQueryForMembershipStartDate.ExecuteScalar();
                    if (connSalesforce.State == ConnectionState.Open) connSalesforce.Close();

                    if (objMembershipStartDate != null) MembershipStartDate = DateTime.Parse(objMembershipStartDate.ToString());

                    txtAnivDate.Text = MembershipStartDate.Value.ToString("MM/dd/yyyy");
                }
                else
                {
                    if (MembershipStartDate >= LatestProgramChangeDate) txtAnivDate.Text = MembershipStartDate.Value.ToString("MM/dd/yyyy");
                    else txtAnivDate.Text = LatestProgramChangeDate.Value.ToString("MM/dd/yyyy");
                }


                if (IndividualSearched.dtMembershipCancelledDate != null)
                {
                    txtMembershipCancelledDate.Text = IndividualSearched.dtMembershipCancelledDate.Value.ToString("MM/dd/yyyy");
                }
                else txtMembershipCancelledDate.Text = String.Empty;
                txtIndMemberShipStatus.Text = IndividualSearched.membershipStatus.ToString();

                IndividualIdIndividualPage = txtIndividualID.Text.Trim();

                String strSqlQueryForCaseInfo = "select distinct([dbo].[tbl_medbill].[Case_Id]), [dbo].[tbl_medbill].[Contact_Id], [dbo].[tbl_medbill].[BillStatus] " +
                                                "from [dbo].[tbl_medbill] " +
                                                "where [dbo].[tbl_medbill].[Contact_Id] = @IndividualId and " +
                                                "([dbo].[tbl_medbill].[IsDeleted] = 0 or [dbo].[tbl_medbill].[IsDeleted] IS NULL) and " +
                                                "([dbo].[tbl_medbill].[BillStatus] = @BillStatusCode0 or " +
                                                "[dbo].[tbl_medbill].[BillStatus] = @BillStatusCode1 or " +
                                                "[dbo].[tbl_medbill].[BillStatus] = @BillStatusCode2 or " +
                                                "[dbo].[tbl_medbill].[BillStatus] = @BillStatusCode3 or " +
                                                "[dbo].[tbl_medbill].[BillStatus] = @BillStatusCode4)";

                SqlCommand cmdQueryForCaseInfo = new SqlCommand(strSqlQueryForCaseInfo, connRN);
                cmdQueryForCaseInfo.CommandType = CommandType.Text;

                cmdQueryForCaseInfo.Parameters.AddWithValue("@IndividualId", IndividualIdIndividualPage);
                cmdQueryForCaseInfo.Parameters.AddWithValue("@BillStatusCode0", 0);     // Pending
                cmdQueryForCaseInfo.Parameters.AddWithValue("@BillStatusCode1", 1);     // CMM Pending Payment  
                cmdQueryForCaseInfo.Parameters.AddWithValue("@BillStatusCode2", 2);     // Closed
                cmdQueryForCaseInfo.Parameters.AddWithValue("@BillStatusCode3", 3);     // Ineligible
                cmdQueryForCaseInfo.Parameters.AddWithValue("@BillStatusCode4", 4);     // Partially Ineligible
                                                                                        //cmdQueryForCaseInfo.Parameters.AddWithValue("@BillStatusCode5", 5);    

                //if (connRN.State == ConnectionState.Closed) connRN.Open();
                if (connRN.State != ConnectionState.Closed)
                {
                    connRN.Close();
                    connRN.Open();
                }
                else if (connRN.State == ConnectionState.Closed) connRN.Open();
                SqlDataReader rdrCaseInfo = cmdQueryForCaseInfo.ExecuteReader();

                lstCaseInfo.Clear();
                if (rdrCaseInfo.HasRows)
                {
                    while (rdrCaseInfo.Read())
                    {
                        lstCaseInfo.Add(new CaseInfo { CaseName = rdrCaseInfo.GetString(0), IndividualId = rdrCaseInfo.GetString(1) });
                    }
                }
                rdrCaseInfo.Close();
                if (connRN.State != ConnectionState.Closed) connRN.Close();
                /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                ///
                //IndividualSearched.strIndividualID = gvIndividualSearched["Individual No.", nRowSelected]?.Value?.ToString();
                String IndividualIdSelected = IndividualSearched.strIndividualID;

                String strSqlQueryForIndividualSharedAmountInfo = "select [dbo].[contact].[c4g_Total_Shared_Amount__c], [dbo].[contact].[c4g_Incidents_Total_Amount__c], " +
                                                                  "[dbo].[contact].[Total_10K_Share_Amount__c], [dbo].[contact].[c4g_Well_Being_Care_Shared__c] " +
                                                                  "from [dbo].[contact] " +
                                                                  "where [dbo].[contact].[Individual_ID__c] = @IndividualId";

                SqlCommand cmdQueryForIndividualSharedAmountInfo = new SqlCommand(strSqlQueryForIndividualSharedAmountInfo, connSalesforce);
                cmdQueryForIndividualSharedAmountInfo.CommandType = CommandType.Text;

                cmdQueryForIndividualSharedAmountInfo.Parameters.AddWithValue("@IndividualId", IndividualIdSelected);

                if (connSalesforce.State != ConnectionState.Closed)
                {
                    connSalesforce.Close();
                    connSalesforce.Open();
                }
                else if (connSalesforce.State == ConnectionState.Closed) connSalesforce.Open();
                SqlDataReader rdrIndividualSharedAmountInfo = cmdQueryForIndividualSharedAmountInfo.ExecuteReader();
                if (rdrIndividualSharedAmountInfo.HasRows)
                {
                    rdrIndividualSharedAmountInfo.Read();
                    if (!rdrIndividualSharedAmountInfo.IsDBNull(0)) txtTotalSharedAmount.Text = rdrIndividualSharedAmountInfo.GetDouble(0).ToString("C");
                    if (!rdrIndividualSharedAmountInfo.IsDBNull(1)) txtTotalMedBillAmount.Text = rdrIndividualSharedAmountInfo.GetDouble(1).ToString("C");
                    if (!rdrIndividualSharedAmountInfo.IsDBNull(2)) txtOver10KAmount.Text = rdrIndividualSharedAmountInfo.GetDouble(2).ToString("C");
                    if (!rdrIndividualSharedAmountInfo.IsDBNull(3)) txtWellBeingAmt.Text = rdrIndividualSharedAmountInfo.GetDouble(3).ToString("C");
                }
                rdrIndividualSharedAmountInfo.Close();
                if (connSalesforce.State != ConnectionState.Closed) connSalesforce.Close();


                ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                //String strSqlQueryForIndividualTotalSharedAmount = "select [dbo].[contact].[c4g_Total_Shared_Amount__c] from [dbo].[contact] where [dbo].[contact].[Individual_ID__c] = @IndividualId";

                //SqlCommand cmdQueryForIndividualTotalSharedAmount = new SqlCommand(strSqlQueryForIndividualTotalSharedAmount, connSalesforce);
                //cmdQueryForIndividualTotalSharedAmount.CommandType = CommandType.Text;

                //cmdQueryForIndividualTotalSharedAmount.Parameters.AddWithValue("@IndividualId", IndividualIdSelected);

                //if (connSalesforce.State != ConnectionState.Closed)
                //{
                //    connSalesforce.Close();
                //    connSalesforce.Open();
                //}
                //else if (connSalesforce.State == ConnectionState.Closed) connSalesforce.Open();
                //Object objIndividualTotalSharedAmount = cmdQueryForIndividualTotalSharedAmount.ExecuteScalar();
                //if (connSalesforce.State == ConnectionState.Open) connSalesforce.Close();

                //Decimal IndividualTotalSharedAmount = 0;
                //txtTotalSharedAmount.Text = String.Empty;
                //if (objIndividualTotalSharedAmount != null)
                //{
                //    if (objIndividualTotalSharedAmount.ToString() != String.Empty)
                //    {
                //        IndividualTotalSharedAmount = Decimal.Parse(objIndividualTotalSharedAmount.ToString());
                //        txtTotalSharedAmount.Text = IndividualTotalSharedAmount.ToString("C");
                //    }
                //}

                //String strSqlQueryForIndividualMedBillTotalAmount = "select [dbo].[contact].[c4g_Incidents_Total_Amount__c] from [dbo].[contact] where [dbo].[contact].[Individual_ID__c] = @IndividualId";

                //SqlCommand cmdQueryForIndividualMedBillTotalAmount = new SqlCommand(strSqlQueryForIndividualMedBillTotalAmount, connSalesforce);
                //cmdQueryForIndividualMedBillTotalAmount.CommandType = CommandType.Text;

                //cmdQueryForIndividualMedBillTotalAmount.Parameters.AddWithValue("@IndividualId", IndividualIdSelected);

                //if (connSalesforce.State != ConnectionState.Closed)
                //{
                //    connSalesforce.Close();
                //    connSalesforce.Open();
                //}
                //else if (connSalesforce.State == ConnectionState.Closed) connSalesforce.Open();
                //Object objIndividualMedBillTotalAmount = cmdQueryForIndividualMedBillTotalAmount.ExecuteScalar();
                //if (connSalesforce.State == ConnectionState.Open) connSalesforce.Close();

                //Decimal IndividualMedBillTotalAmount = 0;
                //txtTotalMedBillAmount.Text = String.Empty;
                //if (objIndividualMedBillTotalAmount != null)
                //{
                //    if (objIndividualMedBillTotalAmount.ToString() != String.Empty)
                //    {
                //        IndividualMedBillTotalAmount = Decimal.Parse(objIndividualMedBillTotalAmount.ToString());
                //        txtTotalMedBillAmount.Text = IndividualMedBillTotalAmount.ToString("C");
                //    }
                //}

                /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

                //if (lstCaseInfo.Count > 0)
                //{

                //String strSqlQueryForCasesForIndividualID = "select distinct([dbo].[tbl_case].[Case_Name]), [dbo].[tbl_case].[CreateDate], [dbo].[tbl_CreateStaff].[Staff_Name], " +
                //                                            "[dbo].[tbl_case].[NPF_Form], [dbo].[tbl_case].[NPF_Receiv_Date], [dbo].[tbl_case].[IB_Form], [dbo].[tbl_case].[IB_Receiv_Date], " +
                //                                            "[dbo].[tbl_case].[POP_Form], [dbo].[tbl_case].[POP_Receiv_Date], [dbo].[tbl_case].[MedRec_Form], [dbo].[tbl_case].[MedRec_Receiv_Date], " +
                //                                            "[dbo].[tbl_case].[Unknown_Form], [dbo].[tbl_case].[Unknown_Receiv_Date] " +
                //                                            "from [dbo].[tbl_case] " +
                //                                            "inner join [dbo].[tbl_medbill] on [dbo].[tbl_case].[Case_Name] = [dbo].[tbl_medbill].[Case_Id] " +
                //                                            "inner join [dbo].[tbl_CreateStaff] on [dbo].[tbl_case].[CreateStaff] = [dbo].[tbl_CreateStaff].[CreateStaff_Id] " +
                //                                            "where [dbo].[tbl_case].[Contact_ID] = @IndividualID and " +
                //                                            "[dbo].[tbl_case].[IsDeleted] = 0 and " +
                //                                            "([dbo].[tbl_medbill].[BillStatus] = 0 or [dbo].[tbl_medbill].[BillStatus] = 1 or [dbo].[tbl_medbill].[BillStatus] = 4) " +
                //                                            "order by [dbo].[tbl_case].[Case_Name]";

                String strSqlQueryForCasesForIndividualID = "select [dbo].[tbl_case].[Case_Name], [dbo].[tbl_case_status_code].[CaseStatusValue], [dbo].[tbl_case].[CreateDate], " +
                                                            "[dbo].[tbl_CreateStaff].[Staff_Name], " +
                                                            "[dbo].[tbl_case].[NPF_Form], [dbo].[tbl_case].[NPF_Receiv_Date], [dbo].[tbl_case].[IB_Form], [dbo].[tbl_case].[IB_Receiv_Date], " +
                                                            "[dbo].[tbl_case].[POP_Form], [dbo].[tbl_case].[POP_Receiv_Date], [dbo].[tbl_case].[MedRec_Form], [dbo].[tbl_case].[MedRec_Receiv_Date], " +
                                                            "[dbo].[tbl_case].[Unknown_Form], [dbo].[tbl_case].[Unknown_Receiv_Date] " +
                                                            "from [dbo].[tbl_case] " +
                                                            "inner join [dbo].[tbl_case_status_code] on [dbo].[tbl_case].[Case_status] = [dbo].[tbl_case_status_code].[CaseStatusCode] " +
                                                            "inner join [dbo].[tbl_CreateStaff] on [dbo].[tbl_case].[CreateStaff] = [dbo].[tbl_CreateStaff].[CreateStaff_Id] " +
                                                            "where [dbo].[tbl_case].[Contact_ID] = @IndividualID and " +
                                                            "[dbo].[tbl_case].[IsDeleted] = 0 and " +
                                                            "([dbo].[tbl_case].[Case_Status] = 0 or [dbo].[tbl_case].[Case_Status] = 1) " +
                                                            "order by [dbo].[tbl_case].[ID]";


                SqlCommand cmdQueryForCasesIndividualPage = new SqlCommand(strSqlQueryForCasesForIndividualID, connRN);
                cmdQueryForCasesIndividualPage.CommandType = CommandType.Text;
                cmdQueryForCasesIndividualPage.Parameters.AddWithValue("@IndividualID", IndividualIdIndividualPage);
                //cmdQueryForCasesIndividualPage.Parameters.AddWithValue("@IndividualID", lstCaseInfo[0].IndividualId);

                cmdQueryForCasesIndividualPage.Notification = null;

                SqlDependency dependencyCaseForIndividual = new SqlDependency(cmdQueryForCasesIndividualPage);
                dependencyCaseForIndividual.OnChange += new OnChangeEventHandler(OnCaseForIndividualChange);

                if (connRN.State != ConnectionState.Closed)
                {
                    connRN.Close();
                    connRN.Open();
                }
                else if (connRN.State == ConnectionState.Closed) connRN.Open();
                SqlDataReader rdrCasesForIndividual = cmdQueryForCasesIndividualPage.ExecuteReader();

                //gvProcessingCaseNo.Rows.Clear();
                gvProcessingCaseNo.Rows.Clear();

                if (rdrCasesForIndividual.HasRows)
                {
                    while (rdrCasesForIndividual.Read())
                    {
                        //for (int i = 0; i < lstCaseInfo.Count; i++)
                        //{
                        //if ((!rdrCasesForIndividual.IsDBNull(0)) &&
                        //    (rdrCasesForIndividual.GetString(0) == lstCaseInfo[i].CaseName))
                        //{

                        DataGridViewRow row = new DataGridViewRow();

                        row.Cells.Add(new DataGridViewCheckBoxCell { Value = false });

                        if (!rdrCasesForIndividual.IsDBNull(0)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrCasesForIndividual.GetString(0) });
                        else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });

                        if (!rdrCasesForIndividual.IsDBNull(1)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrCasesForIndividual.GetString(1) });
                        else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });

                        if (!rdrCasesForIndividual.IsDBNull(2)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrCasesForIndividual.GetDateTime(2).ToString("MM/dd/yyyy") });
                        else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });

                        if (!rdrCasesForIndividual.IsDBNull(3)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrCasesForIndividual.GetString(3) });
                        else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });

                        if (!rdrCasesForIndividual.IsDBNull(4)) row.Cells.Add(new DataGridViewCheckBoxCell { Value = rdrCasesForIndividual.GetBoolean(4) });
                        else row.Cells.Add(new DataGridViewTextBoxCell { Value = false });

                        if (!rdrCasesForIndividual.IsDBNull(5)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrCasesForIndividual.GetDateTime(5).ToString("MM/dd/yyyy") });
                        else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });

                        if (!rdrCasesForIndividual.IsDBNull(6)) row.Cells.Add(new DataGridViewCheckBoxCell { Value = rdrCasesForIndividual.GetBoolean(6) });
                        else row.Cells.Add(new DataGridViewTextBoxCell { Value = false });

                        if (!rdrCasesForIndividual.IsDBNull(7)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrCasesForIndividual.GetDateTime(7).ToString("MM/dd/yyyy") });
                        else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });

                        if (!rdrCasesForIndividual.IsDBNull(8)) row.Cells.Add(new DataGridViewCheckBoxCell { Value = rdrCasesForIndividual.GetBoolean(8) });
                        else row.Cells.Add(new DataGridViewTextBoxCell { Value = false });

                        if (!rdrCasesForIndividual.IsDBNull(9)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrCasesForIndividual.GetDateTime(9).ToString("MM/dd/yyyy") });
                        else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });

                        if (!rdrCasesForIndividual.IsDBNull(10)) row.Cells.Add(new DataGridViewCheckBoxCell { Value = rdrCasesForIndividual.GetBoolean(10) });
                        else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });

                        if (!rdrCasesForIndividual.IsDBNull(11)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrCasesForIndividual.GetDateTime(11).ToString("MM/dd/yyyy") });
                        else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });

                        if (!rdrCasesForIndividual.IsDBNull(12)) row.Cells.Add(new DataGridViewCheckBoxCell { Value = rdrCasesForIndividual.GetBoolean(12) });
                        else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });

                        if (!rdrCasesForIndividual.IsDBNull(13)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrCasesForIndividual.GetDateTime(13).ToString("MM/dd/yyyy") });
                        else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });

                        gvProcessingCaseNo.Rows.Add(row);
                        //}
                        //}
                    }
                }
                rdrCasesForIndividual.Close();
                if (connRN.State != ConnectionState.Closed) connRN.Close();

                gvProcessingCaseNo.Enabled = true;
                gvProcessingCaseNo.Controls[0].Enabled = true;
                gvProcessingCaseNo.Controls[1].Enabled = true;

                //}

                ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                // Case History Page

                strIndividualId = IndividualSearched.strIndividualID.Trim();

                txtCaseHistoryIndividualID.Text = strIndividualId;

                txtCaseHistoryIndividualName.Text = txtLastName.Text + ", " + txtFirstName.Text + " " + txtMiddleName.Text;

                String strSqlQueryForCreateStaff = "select dbo.tbl_CreateStaff.CreateStaff_Id, dbo.tbl_CreateStaff.Staff_Name from dbo.tbl_CreateStaff";

                SqlCommand cmdQueryForCreateStaff = new SqlCommand(strSqlQueryForCreateStaff, connRN);
                cmdQueryForCreateStaff.CommandType = CommandType.Text;

                //if (connRN.State == ConnectionState.Closed) connRN.Open();
                if (connRN.State != ConnectionState.Closed)
                {
                    connRN.Close();
                    connRN.Open();
                }
                else if (connRN.State == ConnectionState.Closed) connRN.Open();
                SqlDataReader rdrCreateStaff = cmdQueryForCreateStaff.ExecuteReader();

                lstCreateStaff.Clear();
                if (rdrCreateStaff.HasRows)
                {
                    while (rdrCreateStaff.Read())
                    {
                        lstCreateStaff.Add(new StaffInfo { StaffId = rdrCreateStaff.GetInt16(0), StaffName = rdrCreateStaff.GetString(1) });
                    }
                }
                rdrCreateStaff.Close();
                if (connRN.State != ConnectionState.Closed) connRN.Close();

                String strSqlQueryForModifiStaff = "select dbo.tbl_ModifiStaff.ModifiStaff_Id, dbo.tbl_ModifiStaff.Staff_Name from dbo.tbl_ModifiStaff";

                SqlCommand cmdQueryForModifiStaff = new SqlCommand(strSqlQueryForModifiStaff, connRN);
                cmdQueryForModifiStaff.CommandType = CommandType.Text;

                //if (connRN.State == ConnectionState.Closed) connRN.Open();
                if (connRN.State != ConnectionState.Closed)
                {
                    connRN.Close();
                    connRN.Open();
                }
                else if (connRN.State == ConnectionState.Closed) connRN.Open();
                SqlDataReader rdrModifiStaff = cmdQueryForModifiStaff.ExecuteReader();

                lstModifiStaff.Clear();
                if (rdrModifiStaff.HasRows)
                {
                    while (rdrModifiStaff.Read())
                    {
                        lstModifiStaff.Add(new StaffInfo { StaffId = rdrModifiStaff.GetInt16(0), StaffName = rdrModifiStaff.GetString(1) });
                    }
                }
                rdrModifiStaff.Close();
                if (connRN.State != ConnectionState.Closed) connRN.Close();

                //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                String strSqlQueryForCases = "select dbo.tbl_case.Case_Name, dbo.tbl_case.CreateDate, dbo.tbl_case.CreateStaff, " +
                                             "dbo.tbl_case.ModifiDate, dbo.tbl_case.ModifiStaff " +
                                             "from dbo.tbl_case where individual_id = @IndividualId and " +
                                             "[dbo].[tbl_case].[IsDeleted] = 0 " +
                                             "order by [dbo].[tbl_case].[ID]";

                SqlCommand cmdQueryForCases = new SqlCommand(strSqlQueryForCases, connRN);
                cmdQueryForCases.CommandType = CommandType.Text;

                cmdQueryForCases.Parameters.AddWithValue("@IndividualId", strIndividualId);

                SqlDependency dependencyCase = new SqlDependency(cmdQueryForCases);
                dependencyCase.OnChange += new OnChangeEventHandler(OnCaseChange);


                //if (connRN.State == ConnectionState.Closed) connRN.Open();
                if (connRN.State != ConnectionState.Closed)
                {
                    connRN.Close();
                    connRN.Open();
                }
                else if (connRN.State == ConnectionState.Closed) connRN.Open();
                SqlDataReader reader = cmdQueryForCases.ExecuteReader();
                gvCaseViewCaseHistory.Rows.Clear();
                if (reader.HasRows)
                {
                    while (reader.Read())
                    {
                        DataGridViewRow row = new DataGridViewRow();

                        row.Cells.Add(new DataGridViewCheckBoxCell { Value = false });
                        row.Cells.Add(new DataGridViewTextBoxCell { Value = reader.GetString(0) });     // Case ID

                        // Create Date
                        if (!reader.IsDBNull(1)) row.Cells.Add(new DataGridViewTextBoxCell { Value = reader.GetDateTime(1).ToString("MM/dd/yyyy") });

                        // Create Staff
                        if (!reader.IsDBNull(2))
                        {
                            for (int i = 0; i < lstCreateStaff.Count; i++)
                            {
                                if (reader.GetInt16(2) == lstCreateStaff[i].StaffId)
                                    row.Cells.Add(new DataGridViewTextBoxCell { Value = lstCreateStaff[i].StaffName });
                            }
                        }

                        // Modifi Date
                        if (!reader.IsDBNull(3)) row.Cells.Add(new DataGridViewTextBoxCell { Value = reader.GetDateTime(3).ToString("MM/dd/yyyy") });

                        // Modifi Staff
                        if (!reader.IsDBNull(4))
                        {
                            for (int i = 0; i < lstModifiStaff.Count; i++)
                            {
                                if (reader.GetInt16(4) == lstModifiStaff[i].StaffId)
                                    row.Cells.Add(new DataGridViewTextBoxCell { Value = lstModifiStaff[i].StaffName });
                            }
                        }
                        gvCaseViewCaseHistory.Rows.Add(row);
                    }
                }
                if (connRN.State != ConnectionState.Closed) connRN.Close();

                gvCaseViewCaseHistory.Enabled = true;
                gvCaseViewCaseHistory.Controls[0].Enabled = true;
                gvCaseViewCaseHistory.Controls[1].Enabled = true;

                txtIllnessViewMEMB.Text = IndividualSearched.strMembershipID;
                txtIllnessViewIndId.Text = IndividualSearched.strIndividualID;
                DateTime IndividualStartDate = IndividualSearched.dtMembershipIndStartDate.Value;
                String IndividualId = IndividualSearched.strIndividualID;

                //lstLimitedSharingId.Clear();

                //String strSqlQueryForLimitedSharingSelection = "select [dbo].[tbl_illness].[LimitedSharingId] from [dbo].[tbl_illness] where [dbo].[tbl_illness].[Individual_Id] = @IndividualId";

                //SqlCommand cmdQueryForLimitedSharingSelection = new SqlCommand(strSqlQueryForLimitedSharingSelection, connRN);
                //cmdQueryForLimitedSharingSelection.CommandType = CommandType.Text;

                //cmdQueryForLimitedSharingSelection.Parameters.AddWithValue("@IndividualId", IndividualId);

                //if (connRN.State != ConnectionState.Closed)
                //{
                //    connRN.Close();
                //    connRN.Open();
                //}
                //else if (connRN.State == ConnectionState.Closed) connRN.Open();
                //SqlDataReader rdrLimitedSharingSelection = cmdQueryForLimitedSharingSelection.ExecuteReader();

                //if (rdrLimitedSharingSelection.HasRows)
                //{
                //    while(rdrLimitedSharingSelection.Read())
                //    {
                //        if (!rdrLimitedSharingSelection.IsDBNull(0)) lstLimitedSharingId.Add(rdrLimitedSharingSelection.GetInt16(0));
                //    }
                //}
                //if (connRN.State != ConnectionState.Closed) connRN.Close();


                //int nLimitedSharingSelection = 0;
                //if (objLimitedSharingSelection != null) nLimitedSharingSelection = Int16.Parse(objLimitedSharingSelection.ToString());

                //if (lstLimitedSharingId[0] == 0)

                String strSqlQueryForIndividualStartDate = "select [dbo].[contact].[Membership_IND_Start_date__c] from [dbo].[contact] " +
                                               "where [dbo].[contact].[individual_id__c] = @IndividualId";

                SqlCommand cmdQueryForIndividualStartDate = new SqlCommand(strSqlQueryForIndividualStartDate, connSalesforce);
                cmdQueryForIndividualStartDate.CommandType = CommandType.Text;

                cmdQueryForIndividualStartDate.Parameters.AddWithValue("@IndividualId", IndividualId);

                if (connSalesforce.State != ConnectionState.Closed)
                {
                    connSalesforce.Close();
                    connSalesforce.Open();
                }
                else if (connSalesforce.State == ConnectionState.Closed) connSalesforce.Open();
                Object objIndividualStartDate = cmdQueryForIndividualStartDate.ExecuteScalar();
                if (connSalesforce.State == ConnectionState.Open) connSalesforce.Close();

                DateTime dtResultIndividualStartDate;
                DateTime? dtIndividualStartDate = null;

                if (objIndividualStartDate != null)
                {
                    if (DateTime.TryParse(objIndividualStartDate.ToString(), out dtResultIndividualStartDate)) dtIndividualStartDate = dtResultIndividualStartDate;
                }
                else
                {
                    MessageBox.Show("Invalid datetime value", "Error", MessageBoxButtons.OK);
                    return;
                }

                int NumberOfYears = DateTime.Today.Year - dtIndividualStartDate.Value.Year;
                if (dtIndividualStartDate.Value.AddYears(NumberOfYears) > DateTime.Today) NumberOfYears--;

                LimitedSharingYear = NumberOfYears;
                if (LimitedSharingYear > 4) LimitedSharingYear = 4;

                gvIllnessList.Rows.Clear();

                //String strSqlQueryForIllnessForIndividualId = "select [dbo].[tbl_illness].[IllnessNo] as [Illness No], [dbo].[tbl_illness].[Case_Id] as [Case No], " +
                //                                              "[dbo].[tbl_illness].[ICD_10_Id] as [ICD 10 Code], " +
                //                                              "[dbo].[tbl_illness].[CreateDate] as [Create Date], [dbo].[tbl_CreateStaff].[Staff_Name] as [Created By]," +
                //                                              "[dbo].[tbl_illness].[ModifiDate] as [Last Modification Date], [dbo].[tbl_ModifiStaff].[Staff_Name] as [Last Modified By], " +
                //                                              "[dbo].[tbl_illness].[Date_of_Diagnosis] as [Diagnosis Date], " +
                //                                              "[dbo].[tbl_illness].[TotalSharedAmount] as [Total Shared Amount], " +
                //                                              "[dbo].[tbl_illness].[LimitedSharingId] as [Limited Sharing Amount], " +
                //                                              "[dbo].[tbl_illness].[Introduction], [dbo].[tbl_illness].[Body], [dbo].[tbl_illness].[Conclusion] " +
                //                                              "from [dbo].[tbl_illness] " +
                //                                              "inner join [dbo].[tbl_CreateStaff] on [dbo].[tbl_illness].[CreateStaff] = [dbo].[tbl_CreateStaff].[CreateStaff_Id] " +
                //                                              "inner join [dbo].[tbl_ModifiStaff] on [dbo].[tbl_illness].[ModifiStaff] = [dbo].[tbl_ModifiStaff].[ModifiStaff_Id] " +
                //                                              "where [dbo].[tbl_illness].[Individual_Id] = @IndividualId and [dbo].[tbl_illness].[IsDeleted] = 0 " +
                //                                              "order by [dbo].[tbl_illness].[IllnessNo]";

                String strSqlQueryForIllnessForIndividualId = "select [dbo].[tbl_illness].[IllnessNo], [dbo].[tbl_illness].[Case_Id], " +
                                              "[dbo].[tbl_illness].[ICD_10_Id], " +
                                              "[dbo].[tbl_illness].[CreateDate], [dbo].[tbl_CreateStaff].[Staff_Name]," +
                                              "[dbo].[tbl_illness].[ModifiDate], [dbo].[tbl_ModifiStaff].[Staff_Name], " +
                                              "[dbo].[tbl_illness].[Date_of_Diagnosis], " +
                                              "[dbo].[tbl_illness].[TotalSharedAmount], " +
                                              "[dbo].[tbl_illness].[LimitedSharingId], " +
                                              "[dbo].[tbl_illness].[Introduction], [dbo].[tbl_illness].[Body], [dbo].[tbl_illness].[Conclusion] " +
                                              "from [dbo].[tbl_illness] " +
                                              "inner join [dbo].[tbl_CreateStaff] on [dbo].[tbl_illness].[CreateStaff] = [dbo].[tbl_CreateStaff].[CreateStaff_Id] " +
                                              "inner join [dbo].[tbl_ModifiStaff] on [dbo].[tbl_illness].[ModifiStaff] = [dbo].[tbl_ModifiStaff].[ModifiStaff_Id] " +
                                              "where [dbo].[tbl_illness].[Individual_Id] = @IndividualId and [dbo].[tbl_illness].[IsDeleted] = 0 " +
                                              "order by [dbo].[tbl_illness].[IllnessNo]";

                SqlCommand cmdQueryForIllnesForIndividualId = new SqlCommand(strSqlQueryForIllnessForIndividualId, connRN);
                cmdQueryForIllnesForIndividualId.CommandType = CommandType.Text;

                cmdQueryForIllnesForIndividualId.Parameters.AddWithValue("@IndividualId", IndividualId);

                SqlDependency dependencyIllness = new SqlDependency(cmdQueryForIllnesForIndividualId);
                dependencyIllness.OnChange += new OnChangeEventHandler(OnIllnessChange);

                if (connRN.State != ConnectionState.Closed)
                {
                    connRN.Close();
                    connRN.Open();
                }
                else if (connRN.State == ConnectionState.Closed) connRN.Open();

                gvIllnessList.Rows.Clear();

                SqlDataReader rdrIllnessForIndividual = cmdQueryForIllnesForIndividualId.ExecuteReader();
                if (rdrIllnessForIndividual.HasRows)
                {
                    while (rdrIllnessForIndividual.Read())
                    {
                        DataGridViewRow row = new DataGridViewRow();

                        if (!rdrIllnessForIndividual.IsDBNull(0)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrIllnessForIndividual.GetString(0) });
                        if (!rdrIllnessForIndividual.IsDBNull(1)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrIllnessForIndividual.GetString(1) });
                        if (!rdrIllnessForIndividual.IsDBNull(2)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrIllnessForIndividual.GetString(2) });
                        else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                        if (!rdrIllnessForIndividual.IsDBNull(3)) row.Cells.Add(new CalendarCell { Value = rdrIllnessForIndividual.GetDateTime(3).ToString("MM/dd/yyyy") });
                        else row.Cells.Add(new CalendarCell { Value = String.Empty });
                        if (!rdrIllnessForIndividual.IsDBNull(4)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrIllnessForIndividual.GetString(4) });
                        else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                        if (!rdrIllnessForIndividual.IsDBNull(5)) row.Cells.Add(new CalendarCell { Value = rdrIllnessForIndividual.GetDateTime(5).ToString("MM/dd/yyyy") });
                        else row.Cells.Add(new CalendarCell { Value = String.Empty });
                        if (!rdrIllnessForIndividual.IsDBNull(6)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrIllnessForIndividual.GetString(6) });
                        else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                        if (!rdrIllnessForIndividual.IsDBNull(7)) row.Cells.Add(new CalendarCell { Value = rdrIllnessForIndividual.GetDateTime(7).ToString("MM/dd/yyyy") });
                        else row.Cells.Add(new CalendarCell { Value = String.Empty });
                        if (!rdrIllnessForIndividual.IsDBNull(8))
                        {
                            DataGridViewTextBoxCell cellTotalSharedAmount = new DataGridViewTextBoxCell();
                            cellTotalSharedAmount.Value = rdrIllnessForIndividual.GetDecimal(8).ToString("C");
                            cellTotalSharedAmount.Style.Alignment = DataGridViewContentAlignment.MiddleRight;
                            row.Cells.Add(cellTotalSharedAmount);
                        }
                        else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                        if (!rdrIllnessForIndividual.IsDBNull(9))
                        {
                            switch (rdrIllnessForIndividual.GetInt16(9))
                            {
                                case 0:
                                    DataGridViewTextBoxCell cellLimitedSharing = new DataGridViewTextBoxCell();
                                    cellLimitedSharing.Value = "N/A";
                                    cellLimitedSharing.Style.Alignment = DataGridViewContentAlignment.MiddleRight;
                                    row.Cells.Add(cellLimitedSharing);
                                    break;
                                case 1:
                                    DataGridViewTextBoxCell cellLimitedSharing1 = new DataGridViewTextBoxCell();
                                    cellLimitedSharing1.Value = dicLimitedSharing1[LimitedSharingYear].ToString("C");
                                    cellLimitedSharing1.Style.Alignment = DataGridViewContentAlignment.MiddleRight;
                                    row.Cells.Add(cellLimitedSharing1);
                                    break;
                                case 2:
                                    DataGridViewTextBoxCell cellLimitedSharing2 = new DataGridViewTextBoxCell();
                                    cellLimitedSharing2.Value = dicLimitedSharing2[LimitedSharingYear].ToString("C");
                                    cellLimitedSharing2.Style.Alignment = DataGridViewContentAlignment.MiddleRight;
                                    row.Cells.Add(cellLimitedSharing2);
                                    break;
                            }
                        }
                        if (!rdrIllnessForIndividual.IsDBNull(10)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrIllnessForIndividual.GetString(10) });
                        else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                        if (!rdrIllnessForIndividual.IsDBNull(11)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrIllnessForIndividual.GetString(11) });
                        else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                        if (!rdrIllnessForIndividual.IsDBNull(12)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrIllnessForIndividual.GetString(12) });
                        else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });

                        gvIllnessList.Rows.Add(row);
                    }
                }
                rdrIllnessForIndividual.Close();
                if (connRN.State != ConnectionState.Closed) connRN.Close();

                gvIllnessList.Enabled = true;
                gvIllnessList.Controls[0].Enabled = true;
                gvIllnessList.Controls[1].Enabled = true;


                //txtIllnessViewMEMB.Text = IndividualSearched.strMembershipID;
                //txtIllnessViewIndId.Text = IndividualSearched.strIndividualID;
                //DateTime IndividualStartDate = IndividualSearched.dtMembershipIndStartDate.Value;
                //String IndividualId = IndividualSearched.strIndividualID;

                txtIncidentViewMEMB.Text = IndividualSearched.strMembershipID;
                txtIncidentViewIndId.Text = IndividualSearched.strIndividualID;

                String strSqlQueryForIncidentForIndividual = "select [dbo].[tbl_incident].[IncidentNo], [dbo].[tbl_incident].[Case_id], [dbo].[tbl_illness].[IllnessNo], " +
                                                             "[dbo].[tbl_incident].[CreateDate], [dbo].[tbl_CreateStaff].[Staff_Name], " +
                                                             "[dbo].[tbl_incident].[ModifiDate], [dbo].[tbl_ModifiStaff].[Staff_Name], " +
                                                             "[dbo].[tbl_incident].[TotalSharedAmount], [dbo].[tbl_incident_status_code].[IncidentStatusValue], " +
                                                             "[dbo].[tbl_incident].[Review_Request], [dbo].[tbl_program].[ProgramName], " +
                                                             "[dbo].[tbl_incident].[IncidentNote], [dbo].[tbl_incident].[Eligibility] " +
                                                             "from [dbo].[tbl_incident] " +
                                                             "inner join [dbo].[tbl_illness] on [dbo].[tbl_incident].[Illness_id] = [dbo].[tbl_illness].[Illness_Id] " +
                                                             "inner join [dbo].[tbl_CreateStaff] on [dbo].[tbl_incident].[CreateStaff] = [dbo].[tbl_CreateStaff].[CreateStaff_Id] " +
                                                             "inner join [dbo].[tbl_ModifiStaff] on [dbo].[tbl_incident].[ModifiStaff] = [dbo].[tbl_ModifiStaff].[ModifiStaff_Id] " +
                                                             "inner join [dbo].[tbl_incident_status_code] on [dbo].[tbl_incident].[Incident_Status] = [dbo].[tbl_incident_status_code].[IncidentStatusCode] " +
                                                             "inner join [dbo].[tbl_program] on [dbo].[tbl_incident].[Program_id] = [dbo].[tbl_program].[Program_Id] " +
                                                             "where [dbo].[tbl_incident].[Individual_id] = @IndividualId and " +
                                                             "[dbo].[tbl_incident].[IsDeleted] = 0 " +
                                                             "order by [dbo].[tbl_incident].[IncidentNo]";

                SqlCommand cmdQueryForIncidentForIndividual = new SqlCommand(strSqlQueryForIncidentForIndividual, connRN);
                cmdQueryForIncidentForIndividual.CommandType = CommandType.Text;

                cmdQueryForIncidentForIndividual.Parameters.AddWithValue("@IndividualId", IndividualId);

                SqlDependency dependencyIncident = new SqlDependency(cmdQueryForIncidentForIndividual);
                dependencyIncident.OnChange += new OnChangeEventHandler(OnIncidentChange);

                if (connRN.State != ConnectionState.Closed)
                {
                    connRN.Close();
                    connRN.Open();
                }
                else if (connRN.State == ConnectionState.Closed) connRN.Open();

                gvIncidentList.Rows.Clear();
                SqlDataReader rdrIncidentForIndividual = cmdQueryForIncidentForIndividual.ExecuteReader();
                if (rdrIncidentForIndividual.HasRows)
                {
                    while (rdrIncidentForIndividual.Read())
                    {
                        DataGridViewRow row = new DataGridViewRow();

                        if (!rdrIncidentForIndividual.IsDBNull(0)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrIncidentForIndividual.GetString(0) });
                        if (!rdrIncidentForIndividual.IsDBNull(1)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrIncidentForIndividual.GetString(1) });
                        if (!rdrIncidentForIndividual.IsDBNull(2)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrIncidentForIndividual.GetString(2) });
                        if (!rdrIncidentForIndividual.IsDBNull(3)) row.Cells.Add(new CalendarCell { Value = rdrIncidentForIndividual.GetDateTime(3).ToString("MM/dd/yyyy") });
                        if (!rdrIncidentForIndividual.IsDBNull(4)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrIncidentForIndividual.GetString(4) });
                        if (!rdrIncidentForIndividual.IsDBNull(5)) row.Cells.Add(new CalendarCell { Value = rdrIncidentForIndividual.GetDateTime(5).ToString("MM/dd/yyyy") });
                        if (!rdrIncidentForIndividual.IsDBNull(6)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrIncidentForIndividual.GetString(6) });
                        if (!rdrIncidentForIndividual.IsDBNull(7)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrIncidentForIndividual.GetDecimal(7).ToString("C") });
                        else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                        if (!rdrIncidentForIndividual.IsDBNull(8)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrIncidentForIndividual.GetString(8) });
                        else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                        if (!rdrIncidentForIndividual.IsDBNull(9)) row.Cells.Add(new DataGridViewCheckBoxCell { Value = rdrIncidentForIndividual.GetBoolean(9) });
                        if (!rdrIncidentForIndividual.IsDBNull(10)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrIncidentForIndividual.GetString(10) });
                        else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                        if (!rdrIncidentForIndividual.IsDBNull(11)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrIncidentForIndividual.GetString(11) });
                        else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                        if (!rdrIncidentForIndividual.IsDBNull(12)) row.Cells.Add(new DataGridViewCheckBoxCell { Value = rdrIncidentForIndividual.GetBoolean(12) });

                        gvIncidentList.Rows.Add(row);
                    }
                }
                rdrIncidentForIndividual.Close();
                if (connRN.State != ConnectionState.Closed) connRN.Close();

                gvIncidentList.Enabled = true;
                gvIncidentList.Controls[0].Enabled = true;
                gvIncidentList.Controls[1].Enabled = true;

                txtMedBillViewMEMB.Text = IndividualSearched.strMembershipID;
                txtMedBillViewIndId.Text = IndividualSearched.strIndividualID;

                List<MedicalBillInfoForList> lstMedicalBillInfoForList = new List<MedicalBillInfoForList>();

                String strSqlQueryForMedBillsForIndividual = "select [dbo].[tbl_medbill].[BillNo], [dbo].[tbl_medbill_type].[MedBillTypeName], " +
                                                             "[dbo].[tbl_medbill_status_code].[BillStatusValue], [dbo].[tbl_medbill].[BillClosed], " +
                                                             "[dbo].[tbl_medbill].[CreatedDate], [dbo].[tbl_CreateStaff].[Staff_Name], " +
                                                             "[dbo].[tbl_medbill].[LastModifiedDate], [dbo].[tbl_ModifiStaff].[Staff_Name], " +
                                                             "[dbo].[tbl_medbill].[Case_Id], [dbo].[tbl_illness].[IllnessNo], [dbo].[tbl_illness].[ICD_10_Id], [dbo].[tbl_incident].[IncidentNo], " +
                                                             "[dbo].[tbl_medbill].[BillAmount], [dbo].[tbl_medbill].[Balance], " +
                                                             "[dbo].[tbl_medbill].[SettlementTotal], [dbo].[tbl_medbill].[TotalSharedAmount], " +
                                                             "[dbo].[tbl_medbill].[BillDate], [dbo].[tbl_medbill].[DueDate], " +
                                                             "[dbo].[tbl_medbill].[Guarantor], [dbo].[tbl_medbill].[MedicalProvider_Id], " +
                                                             "[dbo].[tbl_pending_reason].[name], [dbo].[tbl_ineligible_reason].[name], " +
                                                             "[dbo].[tbl_medbill].[PrescriptionDrugName], [dbo].[tbl_medbill].[PrescriptionNo], [dbo].[tbl_medbill].[PrescriptionDescription], " +
                                                             "[dbo].[tbl_medbill].[TotalNumberOfPhysicalTherapy], [dbo].[tbl_medbill].[Note], " +
                                                             "[dbo].[tbl_medbill].[PersonalResponsibilityCredit], " +
                                                             "[dbo].[tbl_medbill].[WellBeingCare], [dbo].[tbl_medbill].[WellBeingCareTotal], " +
                                                             "[dbo].[tbl_medbill].[ProviderPhoneNumber], [dbo].[tbl_medbill].[Account_At_Provider], [dbo].[tbl_medbill].[ProviderContactPerson], " +
                                                             "[dbo].[tbl_medbill].[ProposalLetterSentDate], [dbo].[tbl_medbill].[HIPPASentDate], [dbo].[tbl_medbill].[MedicalRecordDate], " +
                                                             "[dbo].[tbl_pending_reason].[name], [dbo].[tbl_ineligible_reason].[name] " +
                                                             "from [dbo].[tbl_medbill] " +
                                                             "inner join [dbo].[tbl_medbill_type] on [dbo].[tbl_medbill].[MedBillType_Id] = [dbo].[tbl_medbill_type].[MedBillTypeId] " +
                                                             "inner join [dbo].[tbl_medbill_status_code] on [dbo].[tbl_medbill].[BillStatus] = [dbo].[tbl_medbill_status_code].[BillStatusCode] " +
                                                             "inner join [dbo].[tbl_CreateStaff] on [dbo].[tbl_medbill].[CreatedById] = [dbo].[tbl_CreateStaff].[CreateStaff_Id] " +
                                                             "inner join [dbo].[tbl_ModifiStaff] on [dbo].[tbl_medbill].[LastModifiedById] = [dbo].[tbl_ModifiStaff].[ModifiStaff_Id] " +
                                                             "inner join [dbo].[tbl_illness] on [dbo].[tbl_medbill].[Illness_Id] = [dbo].[tbl_illness].[Illness_Id] " +
                                                             "inner join [dbo].[tbl_incident] on [dbo].[tbl_medbill].[Incident_Id] = [dbo].[tbl_incident].[Incident_id] " +
                                                             //"inner join [dbo].[tbl_patient_type] on [dbo].[tbl_medbill].[PatientTypeId] = [dbo].[tbl_patient_type].[PatientTypeNo] " +
                                                             "inner join [dbo].[tbl_pending_reason] on [dbo].[tbl_medbill].[PendingReason] = [dbo].[tbl_pending_reason].[ID] " +
                                                             "inner join [dbo].[tbl_ineligible_reason] on [dbo].[tbl_medbill].[IneligibleReason] = [dbo].[tbl_ineligible_reason].[id] " +
                                                             "where [dbo].[tbl_medbill].[Individual_Id] = @IndividualId and " +
                                                             "([dbo].[tbl_medbill].[IsDeleted] = 0 or [dbo].[tbl_medbill].[IsDeleted] IS NULL)";

                SqlCommand cmdQueryForMedBillsForIndividual = new SqlCommand(strSqlQueryForMedBillsForIndividual, connRN);
                cmdQueryForMedBillsForIndividual.CommandType = CommandType.Text;

                cmdQueryForMedBillsForIndividual.Parameters.AddWithValue("@IndividualId", IndividualId);

                SqlDependency dependencyMedicalBill = new SqlDependency(cmdQueryForMedBillsForIndividual);
                dependencyMedicalBill.OnChange += new OnChangeEventHandler(OnMedicalBillListChange);

                if (connRN.State != ConnectionState.Closed)
                {
                    connRN.Close();
                    connRN.Open();
                }
                else if (connRN.State == ConnectionState.Closed) connRN.Open();

                SqlDataReader rdrMedBillsForIndividual = cmdQueryForMedBillsForIndividual.ExecuteReader();

                if (rdrMedBillsForIndividual.HasRows)
                {
                    while (rdrMedBillsForIndividual.Read())
                    {
                        MedicalBillInfoForList medbill_info = new MedicalBillInfoForList();

                        if (!rdrMedBillsForIndividual.IsDBNull(0)) medbill_info.MedBillNo = rdrMedBillsForIndividual.GetString(0);
                        if (!rdrMedBillsForIndividual.IsDBNull(1)) medbill_info.MedBillTypeName = rdrMedBillsForIndividual.GetString(1);
                        if (!rdrMedBillsForIndividual.IsDBNull(2)) medbill_info.MedBillStatus = rdrMedBillsForIndividual.GetString(2);
                        if (!rdrMedBillsForIndividual.IsDBNull(3)) medbill_info.bBillClosed = rdrMedBillsForIndividual.GetBoolean(3);
                        if (!rdrMedBillsForIndividual.IsDBNull(4)) medbill_info.CreateDate = rdrMedBillsForIndividual.GetDateTime(4);
                        if (!rdrMedBillsForIndividual.IsDBNull(5)) medbill_info.CreateStaffName = rdrMedBillsForIndividual.GetString(5);
                        if (!rdrMedBillsForIndividual.IsDBNull(6)) medbill_info.LastModifiDate = rdrMedBillsForIndividual.GetDateTime(6);
                        if (!rdrMedBillsForIndividual.IsDBNull(7)) medbill_info.ModifiStaffName = rdrMedBillsForIndividual.GetString(7);
                        if (!rdrMedBillsForIndividual.IsDBNull(8)) medbill_info.CaseId = rdrMedBillsForIndividual.GetString(8);
                        if (!rdrMedBillsForIndividual.IsDBNull(9)) medbill_info.IllnessNo = rdrMedBillsForIndividual.GetString(9);
                        if (!rdrMedBillsForIndividual.IsDBNull(10)) medbill_info.ICD_10_Id = rdrMedBillsForIndividual.GetString(10);
                        if (!rdrMedBillsForIndividual.IsDBNull(11)) medbill_info.IncidentNo = rdrMedBillsForIndividual.GetString(11);
                        if (!rdrMedBillsForIndividual.IsDBNull(12)) medbill_info.BillAmount = rdrMedBillsForIndividual.GetDecimal(12);
                        if (!rdrMedBillsForIndividual.IsDBNull(13)) medbill_info.Balance = rdrMedBillsForIndividual.GetDecimal(13);
                        if (!rdrMedBillsForIndividual.IsDBNull(14)) medbill_info.SettlementTotal = rdrMedBillsForIndividual.GetDecimal(14);
                        if (!rdrMedBillsForIndividual.IsDBNull(15)) medbill_info.TotalSharedAmount = rdrMedBillsForIndividual.GetDecimal(15);
                        if (!rdrMedBillsForIndividual.IsDBNull(16)) medbill_info.BillDate = rdrMedBillsForIndividual.GetDateTime(16);
                        if (!rdrMedBillsForIndividual.IsDBNull(17)) medbill_info.ReceivedDate = rdrMedBillsForIndividual.GetDateTime(17);
                        if (!rdrMedBillsForIndividual.IsDBNull(18)) medbill_info.Guarantor = rdrMedBillsForIndividual.GetString(18);
                        if (!rdrMedBillsForIndividual.IsDBNull(19)) medbill_info.MedicalProviderId = rdrMedBillsForIndividual.GetString(19);
                        //if (!rdrMedBillsForIndividual.IsDBNull(20)) medbill_info.PatientTypeName = rdrMedBillsForIndividual.GetString(20);
                        if (!rdrMedBillsForIndividual.IsDBNull(20)) medbill_info.PendingReason = rdrMedBillsForIndividual.GetString(20);
                        if (!rdrMedBillsForIndividual.IsDBNull(21)) medbill_info.IneligibleReason = rdrMedBillsForIndividual.GetString(21);
                        if (!rdrMedBillsForIndividual.IsDBNull(22)) medbill_info.PrescriptionDrugName = rdrMedBillsForIndividual.GetString(22);
                        if (!rdrMedBillsForIndividual.IsDBNull(23)) medbill_info.PrescriptionNo = rdrMedBillsForIndividual.GetString(23);
                        if (!rdrMedBillsForIndividual.IsDBNull(24)) medbill_info.PrescriptionDescription = rdrMedBillsForIndividual.GetString(24);
                        if (!rdrMedBillsForIndividual.IsDBNull(25)) medbill_info.TotalNumberOfPhysicalTherapy = rdrMedBillsForIndividual.GetInt16(25);
                        if (!rdrMedBillsForIndividual.IsDBNull(26)) medbill_info.Note = rdrMedBillsForIndividual.GetString(26);
                        if (!rdrMedBillsForIndividual.IsDBNull(27)) medbill_info.PersonalResponsibilityCredit = rdrMedBillsForIndividual.GetDecimal(27);
                        if (!rdrMedBillsForIndividual.IsDBNull(28)) medbill_info.WellBeingCare = rdrMedBillsForIndividual.GetBoolean(28);
                        if (!rdrMedBillsForIndividual.IsDBNull(29)) medbill_info.WellBeingCareTotal = rdrMedBillsForIndividual.GetDecimal(29);
                        if (!rdrMedBillsForIndividual.IsDBNull(30)) medbill_info.ProviderPhoneNumber = rdrMedBillsForIndividual.GetString(30);
                        if (!rdrMedBillsForIndividual.IsDBNull(31)) medbill_info.AccountNoAtProvider = rdrMedBillsForIndividual.GetString(31);
                        if (!rdrMedBillsForIndividual.IsDBNull(32)) medbill_info.ProviderContactPerson = rdrMedBillsForIndividual.GetString(32);
                        if (!rdrMedBillsForIndividual.IsDBNull(33)) medbill_info.ProposalLetterSentDate = rdrMedBillsForIndividual.GetDateTime(33);
                        if (!rdrMedBillsForIndividual.IsDBNull(34)) medbill_info.HIPPASentDate = rdrMedBillsForIndividual.GetDateTime(34);
                        if (!rdrMedBillsForIndividual.IsDBNull(35)) medbill_info.MedicalRecordDate = rdrMedBillsForIndividual.GetDateTime(35);
                        if (!rdrMedBillsForIndividual.IsDBNull(36)) medbill_info.PendingReason = rdrMedBillsForIndividual.GetString(36);
                        if (!rdrMedBillsForIndividual.IsDBNull(37)) medbill_info.IneligibleReason = rdrMedBillsForIndividual.GetString(37);

                        lstMedicalBillInfoForList.Add(medbill_info);
                    }
                }

                rdrMedBillsForIndividual.Close();
                if (connRN.State != ConnectionState.Closed) connRN.Close();

                foreach (MedicalBillInfoForList MedBillInfo in lstMedicalBillInfoForList)
                {
                    String strSqlQueryForMedicalProviderName = "select [dbo].[account].[Name] from [dbo].[account] where [dbo].[account].[Id] = @MedicalProviderId";

                    SqlCommand cmdQueryForMedicalProviderName = new SqlCommand(strSqlQueryForMedicalProviderName, connSalesforce2);
                    cmdQueryForMedicalProviderName.CommandType = CommandType.Text;

                    cmdQueryForMedicalProviderName.Parameters.AddWithValue("@MedicalProviderId", MedBillInfo.MedicalProviderId);

                    if (connSalesforce2.State != ConnectionState.Closed)
                    {
                        connSalesforce2.Close();
                        connSalesforce2.Open();
                    }
                    else if (connSalesforce2.State == ConnectionState.Closed) connSalesforce2.Open();
                    Object objMedicalProviderName = cmdQueryForMedicalProviderName.ExecuteScalar();
                    if (connSalesforce2.State == ConnectionState.Open) connSalesforce2.Close();

                    if (objMedicalProviderName != null) MedBillInfo.MedicalProviderName = objMedicalProviderName.ToString();
                }

                gvMedBillList.Rows.Clear();
                foreach (MedicalBillInfoForList medbill_info in lstMedicalBillInfoForList)
                {
                    DataGridViewRow row = new DataGridViewRow();
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = medbill_info.MedBillNo });
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = medbill_info.MedBillTypeName });
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = medbill_info.MedBillStatus });
                    row.Cells.Add(new DataGridViewCheckBoxCell { Value = medbill_info.bBillClosed });
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = medbill_info.CreateDate.Value.ToString("MM/dd/yyyy") });
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = medbill_info.CreateStaffName });
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = medbill_info.LastModifiDate.Value.ToString("MM/dd/yyyy") });
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = medbill_info.ModifiStaffName });
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = medbill_info.CaseId });
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = medbill_info.IllnessNo });
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = medbill_info.ICD_10_Id });
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = medbill_info.IncidentNo });
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = medbill_info.BillAmount.ToString("C") });
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = medbill_info.Balance.ToString("C") });
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = medbill_info.SettlementTotal.ToString("C") });
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = medbill_info.TotalSharedAmount.ToString("C") });
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = medbill_info.BillDate.Value.ToString("MM/dd/yyyy") });
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = medbill_info.ReceivedDate.Value.ToString("MM/dd/yyyy") });
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = medbill_info.Guarantor });
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = medbill_info.MedicalProviderName });
                    //row.Cells.Add(new DataGridViewTextBoxCell { Value = medbill_info.PatientTypeName });
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = medbill_info.PendingReason });
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = medbill_info.IneligibleReason });
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = medbill_info.PrescriptionDrugName });
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = medbill_info.PrescriptionNo });
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = medbill_info.PrescriptionDescription });
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = medbill_info.TotalNumberOfPhysicalTherapy });
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = medbill_info.Note });
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = medbill_info.PersonalResponsibilityCredit.ToString("C") });
                    row.Cells.Add(new DataGridViewCheckBoxCell { Value = medbill_info.WellBeingCare });
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = medbill_info.WellBeingCareTotal.ToString("C") });
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = medbill_info.ProviderPhoneNumber });
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = medbill_info.AccountNoAtProvider });
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = medbill_info.ProviderContactPerson });
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = medbill_info.ProposalLetterSentDate.Value.ToString("MM/dd/yyyy") });
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = medbill_info.HIPPASentDate.Value.ToString("MM/dd/yyyy") });
                    row.Cells.Add(new DataGridViewTextBoxCell { Value = medbill_info.MedicalRecordDate.Value.ToString("MM/dd/yyyy") });

                    gvMedBillList.Rows.Add(row);

                }

                gvMedBillList.Enabled = true;
                gvMedBillList.Controls[0].Enabled = true;
                gvMedBillList.Controls[1].Enabled = true;

                btnIndViewUpdateUpperRight.Enabled = true;
                //btnIndViewUpdateLowerRight.Enabled = true;

                tbCMMManager.SelectedTab = tbpgIndividual;

                PrevTabPage = TabPage.None;
                CurrentTabPage = TabPage.DashBoard;
            }
        }

        private void btnDeleteMedBill_Click(object sender, EventArgs e)
        {

            // put code to check the med bill has settlement in it

            DialogResult dlgResult = MessageBox.Show("Are you sure to delete selected Med Bills.", "Warning", MessageBoxButtons.YesNo);

            if (dlgResult == DialogResult.Yes)
            {
                Boolean bError = false;
                int nRowSelected = 0;

                for (int i = 0; i < gvCasePageMedBills.Rows.Count; i++)
                {
                    DataGridViewCheckBoxCell chkMedBillCell = gvCasePageMedBills["MedBillSelected", i] as DataGridViewCheckBoxCell;

                    if ((Boolean)chkMedBillCell.Value == true)
                    {
                        nRowSelected++;
                        String MedBillToDelete = gvCasePageMedBills["MedBillNo", i].Value as String;

                        //String strSqlDeleteMedBill = "delete from [dbo].[tbl_medbill] where [dbo].[tbl_medbill].[BillNo] = @MedBillNo";
                        String strSqlDeleteMedBill = "update [dbo].[tbl_medbill] set [dbo].[tbl_medbill].[IsDeleted] = 1 where [dbo].[tbl_medbill].[BillNo] = @MedBillNo";

                        SqlCommand cmdDeleteMedBill = new SqlCommand(strSqlDeleteMedBill, connRN4);
                        cmdDeleteMedBill.CommandType = CommandType.Text;

                        cmdDeleteMedBill.Parameters.AddWithValue("@MedBillNo", MedBillToDelete);

                        //if (connRN.State == ConnectionState.Closed) connRN.Open();
                        if (connRN4.State != ConnectionState.Closed)
                        {
                            connRN4.Close();
                            connRN4.Open();
                        }
                        else if (connRN4.State == ConnectionState.Closed) connRN4.Open();
                        int nRowDeleted = cmdDeleteMedBill.ExecuteNonQuery();
                        if (connRN4.State != ConnectionState.Closed) connRN4.Close();

                        if (nRowDeleted == 0)
                        {
                            bError = true;
                        }
                    }
                }

                if ((bError == true) && (nRowSelected > 0))
                {
                    MessageBox.Show("Some of selected Medical Bills have not deleted.", "Error");
                    return;
                }
                if ((bError == false) && (nRowSelected > 0))
                {
                    MessageBox.Show("Medical Bills have been deleted.", "Information");
                    return;
                }
            }
            else return;
        }

        private void btnCaseCreationLowerSave_Click(object sender, EventArgs e)
        {
            Cursor.Current = Cursors.WaitCursor;

            String CaseName = txtCaseName.Text.Trim();
            String IndividualId = txtCaseIndividualID.Text.Trim();

            String strSqlQueryForCaseName = "select [dbo].[tbl_case].[Case_Name] from [dbo].[tbl_case] " +
                                            "where [dbo].[tbl_case].[Case_Name] = @CaseName and [dbo].[tbl_case].[Contact_ID] = @IndividualId";

            SqlCommand cmdQueryForCaseName = new SqlCommand(strSqlQueryForCaseName, connRN4);
            cmdQueryForCaseName.CommandText = strSqlQueryForCaseName;
            cmdQueryForCaseName.CommandType = CommandType.Text;

            cmdQueryForCaseName.Parameters.AddWithValue("@CaseName", CaseName);
            cmdQueryForCaseName.Parameters.AddWithValue("@IndividualId", IndividualId);

            if (connRN4.State != ConnectionState.Closed)
            {
                connRN4.Close();
                connRN4.Open();
            }
            else if (connRN4.State == ConnectionState.Closed) connRN4.Open();
            Object objCaseName = cmdQueryForCaseName.ExecuteScalar();
            if (connRN4.State != ConnectionState.Closed) connRN4.Close();

            if (objCaseName == null)
            {
                frmSaveNewCase frmSaveNewCase = new frmSaveNewCase();
                frmSaveNewCase.StartPosition = FormStartPosition.CenterParent;

                DialogResult dlgResult = frmSaveNewCase.ShowDialog();

                if (dlgResult == DialogResult.Yes)
                {

                    String strCaseId = String.Empty;
                    String strIndividualID = String.Empty;
                    String strNPFormFilePath = String.Empty;
                    String strNPFUploadDate = String.Empty;
                    String strIBFilePath = String.Empty;
                    String strIBUploadDate = String.Empty;
                    String strPopFilePath = String.Empty;
                    String strPopUploadDate = String.Empty;
                    String strMedicalRecordFilePath = String.Empty;
                    String strMedicalRecordUploadDate = String.Empty;
                    String strUnknownDocumentFilePath = String.Empty;
                    String strUnknownDocUploadDate = String.Empty;
                    String strLogID = String.Empty;

                    CasedInfoDetailed caseDetail = new CasedInfoDetailed();

                    caseDetail.CaseId = String.Empty;
                    caseDetail.ContactId = String.Empty;
                    caseDetail.Individual_Id = String.Empty;
                    caseDetail.CreateDate = DateTime.Today;
                    caseDetail.ModificationDate = DateTime.Today;
                    caseDetail.CreateStaff = nLoggedUserId;
                    caseDetail.ModifyingStaff = nLoggedUserId;
                    switch (cbCaseStatus.SelectedIndex)
                    {
                        case (int)CaseStatus.OnGoing:
                            caseDetail.Status = CaseStatus.OnGoing;
                            break;
                        case (int)CaseStatus.Processing:
                            caseDetail.Status = CaseStatus.Processing;
                            break;
                        case (int)CaseStatus.Closed:
                            caseDetail.Status = CaseStatus.Closed;
                            break;
                    }
                    caseDetail.Individual_Id = String.Empty;
                    caseDetail.NPF_Form = 0;
                    caseDetail.NPF_Form_File_Name = String.Empty;
                    caseDetail.NPF_Form_Destination_File_Name = String.Empty;

                    caseDetail.IB_Form = 0;
                    caseDetail.IB_Form_File_Name = String.Empty;
                    caseDetail.IB_Form_Destination_File_Name = String.Empty;

                    caseDetail.POP_Form = 0;
                    caseDetail.POP_Form_File_Name = String.Empty;
                    caseDetail.POP_Form_Destionation_File_Name = String.Empty;

                    caseDetail.MedicalRecord_Form = 0;
                    caseDetail.MedRec_Form_File_Name = String.Empty;
                    caseDetail.MedRec_Form_Destination_File_Name = String.Empty;

                    caseDetail.Unknown_Form = 0;
                    caseDetail.Unknown_Form_File_Name = String.Empty;
                    caseDetail.Unknown_Form_Destination_File_Name = String.Empty;

                    caseDetail.Note = String.Empty;
                    caseDetail.Log_Id = String.Empty;
                    caseDetail.AddBill_Form = false;

                    caseDetail.Remove_Log = String.Empty;

                    if (txtCaseName.Text.Trim() != String.Empty) caseDetail.CaseId = txtCaseName.Text.Trim();
                    if (txtCaseIndividualID.Text.Trim() != String.Empty) caseDetail.ContactId = txtCaseIndividualID.Text.Trim();
                    if (txtCaseIndividualID.Text.Trim() != String.Empty) caseDetail.Individual_Id = txtCaseIndividualID.Text.Trim();
                    if (chkNPF_CaseCreationPage.Checked)
                    {
                        caseDetail.NPF_Form = 1;
                        if (txtNPFFormFilePath.Text.Trim() != String.Empty) caseDetail.NPF_Form_File_Name = txtNPFFormFilePath.Text.Trim();
                        //if (txtNPFUploadDate.Text.Trim() != String.Empty)
                        //{
                        //    DateTime result;
                        //    if (DateTime.TryParse(txtNPFUploadDate.Text.Trim(), out result)) caseDetail.NPF_ReceivedDate = result;
                        //    else MessageBox.Show("Invalid DateTime value", "Error");
                        //}
                        caseDetail.NPF_ReceivedDate = dtpNPFReceivedDate.Value;
                        caseDetail.NPF_Form_Destination_File_Name = strNPFormFilePathDestination;
                    }
                    if (chkIB_CaseCreationPage.Checked)
                    {
                        caseDetail.IB_Form = 1;
                        if (txtIBFilePath.Text.Trim() != String.Empty) caseDetail.IB_Form_File_Name = txtIBFilePath.Text.Trim();
                        //if (txtIBUploadDate.Text.Trim() != String.Empty)
                        //{
                        //    DateTime result;
                        //    if (DateTime.TryParse(txtIBUploadDate.Text.Trim(), out result)) caseDetail.IB_ReceivedDate = result;
                        //    else MessageBox.Show("Invalid DateTime value", "Error");
                        //}
                        caseDetail.IB_ReceivedDate = dtpIBReceivedDate.Value;
                        caseDetail.IB_Form_Destination_File_Name = strIBFilePathDestination;
                    }
                    if (chkPoP_CaseCreationPage.Checked)
                    {
                        caseDetail.POP_Form = 1;
                        if (txtPopFilePath.Text.Trim() != String.Empty) caseDetail.POP_Form_File_Name = txtPopFilePath.Text.Trim();
                        //if (txtPoPUploadDate.Text.Trim() != String.Empty)
                        //{
                        //    DateTime result;
                        //    if (DateTime.TryParse(txtPoPUploadDate.Text.Trim(), out result)) caseDetail.POP_ReceivedDate = result;
                        //    else MessageBox.Show("Invalid DateTime value", "Error");
                        //}
                        caseDetail.POP_ReceivedDate = dtpPoPReceivedDate.Value;
                        caseDetail.POP_Form_Destionation_File_Name = strPopFilePathDestination;
                    }
                    if (chkMedicalRecordCaseCreationPage.Checked)
                    {
                        caseDetail.MedicalRecord_Form = 1;
                        if (txtMedicalRecordFilePath.Text.Trim() != String.Empty) caseDetail.MedRec_Form_File_Name = txtMedicalRecordFilePath.Text.Trim();
                        //if (txtMRUploadDate.Text.Trim() != String.Empty)
                        //{
                        //    DateTime result;
                        //    if (DateTime.TryParse(txtMRUploadDate.Text.Trim(), out result)) caseDetail.MedRec_ReceivedDate = result;
                        //    else MessageBox.Show("Invalid DateTime value", "Error");
                        //}
                        caseDetail.MedRec_ReceivedDate = dtpMRReceivedDate.Value;
                        caseDetail.MedRec_Form_Destination_File_Name = strMedRecordFilePathDestination;
                    }
                    if (chkOtherDocCaseCreationPage.Checked)
                    {
                        caseDetail.Unknown_Form = 1;
                        if (txtOtherDocumentFilePath.Text.Trim() != String.Empty) caseDetail.Unknown_Form_File_Name = txtOtherDocumentFilePath.Text.Trim();
                        //if (txtOtherDocUploadDate.Text.Trim() != String.Empty)      //caseDetail.Unknown_ReceivedDate = DateTime.Parse(txtOtherDocUploadDate.Text.Trim());
                        //{
                        //    DateTime result;
                        //    if (DateTime.TryParse(txtOtherDocUploadDate.Text.Trim(), out result)) caseDetail.Unknown_ReceivedDate = result;
                        //    else MessageBox.Show("Invalid DateTime value", "Error");
                        //}
                        caseDetail.Unknown_ReceivedDate = dtpOtherDocReceivedDate.Value;
                        caseDetail.Unknown_Form_Destination_File_Name = strUnknownDocFilePathDestination;
                    }

                    caseDetail.Log_Id = "Log: " + txtCaseName.Text;
                    caseDetail.AddBill_Form = false;
                    caseDetail.AddBill_Received_Date = null;
                    caseDetail.Remove_Log = String.Empty;

                    String strSqlCreateCase = "insert into tbl_case (IsDeleted, Case_Name, Contact_ID, CreateDate, ModifiDate, CreateStaff, ModifiStaff, Case_status, " +
                                               "NPF_Form, NPF_Form_File_Name, NPF_Form_Destination_File_Name, NPF_Receiv_Date, " +
                                               "IB_Form, IB_Form_File_Name, IB_Form_Destination_File_Name, IB_Receiv_Date, " +
                                               "POP_Form, POP_Form_File_Name, POP_Form_Destination_File_Name, POP_Receiv_Date, " +
                                               "MedRec_Form, MedRec_Form_File_Name, MedRec_Form_Destination_File_Name, MedRec_Receiv_Date, " +
                                               "Unknown_Form, Unknown_Form_File_Name, Unknown_Form_Destination_File_Name, Unknown_Receiv_Date, " +
                                               "Note, Log_ID, AddBill_Form, AddBill_receiv_Date, Remove_log, individual_id) " +
                                               "Values (@IsDeleted, @CaseId, @ContactId, @CreateDate, @ModifiDate, @CreateStaff, @ModifiStaff, @CaseStatus, " +
                                               "@NPF_Form, @NPF_Form_File_Name, @NPF_Form_Destination_File_Name, @NPF_Receive_Date, " +
                                               "@IB_Form, @IB_Form_File_Name, @IB_Form_Destination_File_Name, @IB_Receive_Date, " +
                                               "@POP_Form, @POP_Form_File_Name, @POP_Form_Destination_File_Name, @POP_Receive_Date, " +
                                               "@MedRecord_Form, @MedRecord_Form_File_Name, @MedRecord_Form_Destination_File_name, @MedRecord_Receive_Date, " +
                                               "@Unknown_Form, @Unknown_Form_File_Name, @Unknown_Form_Destination_File_Name, @Unknown_Receive_Date, " +
                                               "@Note, @Log_Id, @AddBill_Form, @AddBill_ReceiveDate, @Remove_Log, @Individual_Id)";

                    SqlCommand cmdInsertNewCase = new SqlCommand(strSqlCreateCase, connRN4);
                    cmdInsertNewCase.CommandType = CommandType.Text;

                    cmdInsertNewCase.Parameters.AddWithValue("@IsDeleted", 0);
                    cmdInsertNewCase.Parameters.AddWithValue("@CaseId", caseDetail.CaseId);
                    cmdInsertNewCase.Parameters.AddWithValue("@ContactId", caseDetail.ContactId);
                    cmdInsertNewCase.Parameters.AddWithValue("@CreateDate", caseDetail.CreateDate);
                    cmdInsertNewCase.Parameters.AddWithValue("@ModifiDate", caseDetail.ModificationDate);
                    cmdInsertNewCase.Parameters.AddWithValue("@CreateStaff", caseDetail.CreateStaff);
                    cmdInsertNewCase.Parameters.AddWithValue("@ModifiStaff", caseDetail.ModifyingStaff);
                    cmdInsertNewCase.Parameters.AddWithValue("@CaseStatus", caseDetail.Status);

                    cmdInsertNewCase.Parameters.AddWithValue("@NPF_Form", caseDetail.NPF_Form);
                    cmdInsertNewCase.Parameters.AddWithValue("@NPF_Form_File_Name", caseDetail.NPF_Form_File_Name);
                    cmdInsertNewCase.Parameters.AddWithValue("@NPF_Form_Destination_File_Name", caseDetail.NPF_Form_Destination_File_Name);
                    if (caseDetail.NPF_ReceivedDate != null) cmdInsertNewCase.Parameters.AddWithValue("@NPF_Receive_Date", caseDetail.NPF_ReceivedDate);
                    else cmdInsertNewCase.Parameters.AddWithValue("@NPF_Receive_Date", DBNull.Value);

                    cmdInsertNewCase.Parameters.AddWithValue("@IB_Form", caseDetail.IB_Form);
                    cmdInsertNewCase.Parameters.AddWithValue("@IB_Form_File_Name", caseDetail.IB_Form_File_Name);
                    cmdInsertNewCase.Parameters.AddWithValue("@IB_Form_Destination_File_Name", caseDetail.IB_Form_Destination_File_Name);
                    if (caseDetail.IB_ReceivedDate != null) cmdInsertNewCase.Parameters.AddWithValue("@IB_Receive_Date", caseDetail.IB_ReceivedDate);
                    else cmdInsertNewCase.Parameters.AddWithValue("@IB_Receive_Date", DBNull.Value);

                    cmdInsertNewCase.Parameters.AddWithValue("@POP_Form", caseDetail.POP_Form);
                    cmdInsertNewCase.Parameters.AddWithValue("@POP_Form_File_Name", caseDetail.POP_Form_File_Name);
                    cmdInsertNewCase.Parameters.AddWithValue("@POP_Form_Destination_File_Name", caseDetail.POP_Form_Destionation_File_Name);
                    if (caseDetail.POP_ReceivedDate != null) cmdInsertNewCase.Parameters.AddWithValue("@POP_Receive_Date", caseDetail.POP_ReceivedDate);
                    else cmdInsertNewCase.Parameters.AddWithValue("@POP_Receive_Date", DBNull.Value);

                    cmdInsertNewCase.Parameters.AddWithValue("@MedRecord_Form", caseDetail.MedicalRecord_Form);
                    cmdInsertNewCase.Parameters.AddWithValue("@MedRecord_Form_File_Name", caseDetail.MedRec_Form_File_Name);
                    cmdInsertNewCase.Parameters.AddWithValue("@MedRecord_Form_Destination_File_Name", caseDetail.MedRec_Form_Destination_File_Name);
                    if (caseDetail.MedRec_ReceivedDate != null) cmdInsertNewCase.Parameters.AddWithValue("@MedRecord_Receive_Date", caseDetail.MedRec_ReceivedDate);
                    else cmdInsertNewCase.Parameters.AddWithValue("@MedRecord_Receive_Date", DBNull.Value);

                    cmdInsertNewCase.Parameters.AddWithValue("@Unknown_Form", caseDetail.Unknown_Form);
                    cmdInsertNewCase.Parameters.AddWithValue("@Unknown_Form_File_Name", caseDetail.Unknown_Form_File_Name);
                    cmdInsertNewCase.Parameters.AddWithValue("@Unknown_Form_Destination_File_Name", caseDetail.Unknown_Form_Destination_File_Name);
                    if (caseDetail.Unknown_ReceivedDate != null) cmdInsertNewCase.Parameters.AddWithValue("@Unknown_Receive_Date", caseDetail.Unknown_ReceivedDate);
                    else cmdInsertNewCase.Parameters.AddWithValue("@Unknown_Receive_Date", DBNull.Value);

                    cmdInsertNewCase.Parameters.AddWithValue("@Note", caseDetail.Note);
                    cmdInsertNewCase.Parameters.AddWithValue("@Log_Id", caseDetail.Log_Id);
                    cmdInsertNewCase.Parameters.AddWithValue("@AddBill_Form", caseDetail.AddBill_Form);
                    if (caseDetail.AddBill_Received_Date != null) cmdInsertNewCase.Parameters.AddWithValue("@AddBill_ReceiveDate", caseDetail.AddBill_Received_Date);
                    else cmdInsertNewCase.Parameters.AddWithValue("@AddBill_ReceiveDate", DBNull.Value);
                    if (caseDetail.Remove_Log == String.Empty) cmdInsertNewCase.Parameters.AddWithValue("@Remove_Log", DBNull.Value);
                    cmdInsertNewCase.Parameters.AddWithValue("@Individual_Id", caseDetail.Individual_Id);

                    if (connRN4.State != ConnectionState.Closed)
                    {
                        connRN4.Close();
                        connRN4.Open();
                    }
                    else if (connRN4.State == ConnectionState.Closed) connRN4.Open();
                    int nResult = cmdInsertNewCase.ExecuteNonQuery();

                    if (connRN4.State != ConnectionState.Closed) connRN4.Close();

                    if (nResult == 1)
                    {
                        MessageBox.Show("The case has been saved.", "Information");

                        caseDetail.CaseId = txtCaseName.Text.Trim();
                        strCaseIdSelected = caseDetail.CaseId;
                        strContactIdSelected = caseDetail.ContactId;

                        btnNewMedBill_Case.Enabled = true;
                        btnEditMedBill.Enabled = true;
                        btnDeleteMedBill.Enabled = true;
                    }

                    return;
                }
                else if (dlgResult == DialogResult.Cancel)
                {
                    return;
                }
            }
            else if (objCaseName != null)    // Edit and update case
            {
                frmSaveChangeOnCase frmDlgSaveChange = new frmSaveChangeOnCase();

                frmDlgSaveChange.StartPosition = FormStartPosition.CenterParent;
                DialogResult dlgResult = frmDlgSaveChange.ShowDialog();

                if (dlgResult == DialogResult.Yes)
                {
                    CasedInfoDetailed caseDetail = new CasedInfoDetailed();

                    caseDetail.CaseId = txtCaseName.Text.Trim();
                    caseDetail.ContactId = String.Empty;
                    caseDetail.Individual_Id = String.Empty;
                    caseDetail.CreateDate = DateTime.Today;
                    caseDetail.ModifyingStaff = nLoggedUserId;
                    switch (cbCaseStatus.SelectedIndex)
                    {
                        case (int)CaseStatus.OnGoing:
                            caseDetail.Status = CaseStatus.OnGoing;
                            break;
                        case (int)CaseStatus.Processing:
                            caseDetail.Status = CaseStatus.Processing;
                            break;
                        case (int)CaseStatus.Closed:
                            caseDetail.Status = CaseStatus.Closed;
                            break;
                    }
                    caseDetail.Individual_Id = String.Empty;
                    caseDetail.NPF_Form = 0;
                    caseDetail.NPF_Form_File_Name = String.Empty;
                    caseDetail.NPF_Form_Destination_File_Name = String.Empty;
                    caseDetail.IB_Form = 0;
                    caseDetail.IB_Form_File_Name = String.Empty;
                    caseDetail.IB_Form_Destination_File_Name = String.Empty;
                    caseDetail.POP_Form = 0;
                    caseDetail.POP_Form_File_Name = String.Empty;
                    caseDetail.POP_Form_Destionation_File_Name = String.Empty;
                    caseDetail.MedicalRecord_Form = 0;
                    caseDetail.MedRec_Form_File_Name = String.Empty;
                    caseDetail.MedRec_Form_Destination_File_Name = String.Empty;
                    caseDetail.Unknown_Form = 0;
                    caseDetail.Unknown_Form_File_Name = String.Empty;
                    caseDetail.Unknown_Form_Destination_File_Name = String.Empty;
                    caseDetail.Note = String.Empty;
                    caseDetail.Log_Id = String.Empty;
                    caseDetail.AddBill_Form = false;
                    caseDetail.Remove_Log = String.Empty;

                    if (txtCaseName.Text.Trim() != String.Empty) caseDetail.CaseId = txtCaseName.Text.Trim();
                    if (txtCaseIndividualID.Text.Trim() != String.Empty) caseDetail.ContactId = txtCaseIndividualID.Text.Trim();
                    if (txtCaseIndividualID.Text.Trim() != String.Empty) caseDetail.Individual_Id = txtCaseIndividualID.Text.Trim();

                    if (chkNPF_CaseCreationPage.Checked)
                    {
                        caseDetail.NPF_Form = 1;
                        if (txtNPFFormFilePath.Text.Trim() != String.Empty) caseDetail.NPF_Form_File_Name = txtNPFFormFilePath.Text.Trim();
                        //if (txtNPFUploadDate.Text.Trim() != String.Empty)
                        //{
                        //    DateTime result;
                        //    if (DateTime.TryParse(txtNPFUploadDate.Text.Trim(), out result)) caseDetail.NPF_ReceivedDate = result;
                        //    else MessageBox.Show("Invalid DateTime value", "Error");
                        //}
                        caseDetail.NPF_ReceivedDate = dtpNPFReceivedDate.Value;
                        caseDetail.NPF_Form_Destination_File_Name = strNPFormFilePathDestination;
                    }
                    if (chkIB_CaseCreationPage.Checked)
                    {
                        caseDetail.IB_Form = 1;
                        if (txtIBFilePath.Text.Trim() != String.Empty) caseDetail.IB_Form_File_Name = txtIBFilePath.Text.Trim();
                        //if (txtIBUploadDate.Text.Trim() != String.Empty)
                        //{
                        //    DateTime result;
                        //    if (DateTime.TryParse(txtIBUploadDate.Text.Trim(), out result)) caseDetail.IB_ReceivedDate = result;
                        //    else MessageBox.Show("Invalid DateTime value", "Error");
                        //}
                        caseDetail.IB_ReceivedDate = dtpIBReceivedDate.Value;
                        caseDetail.IB_Form_Destination_File_Name = strIBFilePathDestination;
                    }
                    if (chkPoP_CaseCreationPage.Checked)
                    {
                        caseDetail.POP_Form = 1;
                        if (txtPopFilePath.Text.Trim() != String.Empty) caseDetail.POP_Form_File_Name = txtPopFilePath.Text.Trim();
                        //if (txtPoPUploadDate.Text.Trim() != String.Empty)
                        //{
                        //    DateTime result;
                        //    if (DateTime.TryParse(txtPoPUploadDate.Text.Trim(), out result)) caseDetail.POP_ReceivedDate = result;
                        //    else MessageBox.Show("Invalid DateTime value", "Error");
                        //}
                        caseDetail.POP_ReceivedDate = dtpPoPReceivedDate.Value;
                        caseDetail.POP_Form_Destionation_File_Name = strPopFilePathDestination;
                    }
                    if (chkMedicalRecordCaseCreationPage.Checked)
                    {
                        caseDetail.MedicalRecord_Form = 1;
                        if (txtMedicalRecordFilePath.Text.Trim() != String.Empty) caseDetail.MedRec_Form_File_Name = txtMedicalRecordFilePath.Text.Trim();
                        //if (txtMRUploadDate.Text.Trim() != String.Empty)
                        //{
                        //    DateTime result;
                        //    if (DateTime.TryParse(txtMRUploadDate.Text.Trim(), out result)) caseDetail.MedRec_ReceivedDate = result;
                        //    else MessageBox.Show("Invalid DateTime value", "Error");
                        //}
                        caseDetail.MedRec_ReceivedDate = dtpMRReceivedDate.Value;
                        caseDetail.MedRec_Form_Destination_File_Name = strMedRecordFilePathDestination;
                    }
                    if (chkOtherDocCaseCreationPage.Checked)
                    {
                        caseDetail.Unknown_Form = 1;
                        if (txtOtherDocumentFilePath.Text.Trim() != String.Empty) caseDetail.Unknown_Form_File_Name = txtOtherDocumentFilePath.Text.Trim();
                        //if (txtOtherDocUploadDate.Text.Trim() != String.Empty)
                        //{
                        //    DateTime result;
                        //    if (DateTime.TryParse(txtOtherDocUploadDate.Text.Trim(), out result)) caseDetail.Unknown_ReceivedDate = result;
                        //    else MessageBox.Show("Invalid DateTime value", "Error");
                        //}
                        caseDetail.Unknown_ReceivedDate = dtpOtherDocReceivedDate.Value;
                        caseDetail.Unknown_Form_Destination_File_Name = strUnknownDocFilePathDestination;
                    }

                    caseDetail.Note = txtNoteOnCase.Text.Trim();
                    caseDetail.Log_Id = "Log: " + txtCaseName.Text;
                    caseDetail.AddBill_Form = true;
                    caseDetail.AddBill_Received_Date = DateTime.Today;
                    caseDetail.Remove_Log = String.Empty;

                    String strSqlUpdateCase = "Update [dbo].[tbl_case] set [dbo].[tbl_case].[ModifiDate] = @ModifiDate, [dbo].[tbl_case].[ModifiStaff] = @ModifiStaff, " +
                                              "[dbo].[tbl_case].[NPF_Form] = @NPF_Form, [dbo].[tbl_case].[NPF_Form_File_Name] = @NPF_Form_File_Name, " +
                                              "[dbo].[tbl_case].[NPF_Form_Destination_File_Name] = @NPF_Form_Destination_File_Name, [dbo].[tbl_case].[NPF_Receiv_Date] = @NPF_Receiv_Date, " +
                                              "[dbo].[tbl_case].[IB_Form] = @IB_Form, [dbo].[tbl_case].[IB_Form_File_Name] = @IB_Form_File_Name, " +
                                              "[dbo].[tbl_case].[IB_Form_Destination_File_Name] = @IB_Form_Destination_File_Name, [dbo].[tbl_case].[IB_Receiv_Date] = @IB_Receiv_Date, " +
                                              "[dbo].[tbl_case].[POP_Form] = @POP_Form, [dbo].[tbl_case].[POP_Form_File_Name] = @POP_Form_File_Name, " +
                                              "[dbo].[tbl_case].[POP_Form_Destination_File_Name] = @POP_Form_Destination_File_Name, [dbo].[tbl_case].[POP_Receiv_Date] = @POP_Receiv_Date, " +
                                              "[dbo].[tbl_case].[MedRec_Form] = @MedRec_Form, [dbo].[tbl_case].[MedRec_Form_File_Name] = @MedRec_Form_File_Name, " +
                                              "[dbo].[tbl_case].[MedRec_Form_Destination_File_Name] = @MedRec_Form_Destination_File_Name, [dbo].[tbl_case].[MedRec_Receiv_Date] = @MedRec_Receiv_Date, " +
                                              "[dbo].[tbl_case].[Unknown_Form] = @Unknown_Form, [dbo].[tbl_case].[Unknown_Form_File_Name] = @Unknown_Form_File_Name, " +
                                              "[dbo].[tbl_case].[Unknown_Form_Destination_File_Name] = @Unknown_Form_Destination_File_Name, [dbo].[tbl_case].[Unknown_Receiv_Date] = @Unknown_Receiv_Date, " +
                                              "[dbo].[tbl_case].[Note] = @CaseNote, [dbo].[tbl_case].[Log_ID] = @Log_Id, [dbo].[tbl_case].[AddBill_Form] = @AddBill_Form, " +
                                              "[dbo].[tbl_case].[AddBill_Receiv_Date] = @AddBill_Receiv_Date, [dbo].[tbl_case].[Remove_Log] = @Remove_Log, " +
                                              "[dbo].[tbl_case].[Case_status] = @CaseStatus " +
                                              "where [dbo].[tbl_case].[Case_Name] = @Case_Id";

                    SqlCommand cmdUpdateCase = new SqlCommand(strSqlUpdateCase, connRN4);
                    cmdUpdateCase.CommandType = CommandType.Text;

                    cmdUpdateCase.Parameters.AddWithValue("@ModifiDate", caseDetail.ModificationDate);
                    cmdUpdateCase.Parameters.AddWithValue("@ModifiStaff", caseDetail.ModifyingStaff);
                    cmdUpdateCase.Parameters.AddWithValue("@NPF_Form", caseDetail.NPF_Form);
                    cmdUpdateCase.Parameters.AddWithValue("@NPF_Form_File_Name", caseDetail.NPF_Form_File_Name);
                    cmdUpdateCase.Parameters.AddWithValue("@NPF_Form_Destination_File_Name", caseDetail.NPF_Form_Destination_File_Name);
                    if (caseDetail.NPF_ReceivedDate != null) cmdUpdateCase.Parameters.AddWithValue("@NPF_Receiv_Date", caseDetail.NPF_ReceivedDate);
                    else cmdUpdateCase.Parameters.AddWithValue("@NPF_Receiv_Date", DBNull.Value);

                    cmdUpdateCase.Parameters.AddWithValue("@IB_Form", caseDetail.IB_Form);
                    cmdUpdateCase.Parameters.AddWithValue("@IB_Form_File_Name", caseDetail.IB_Form_File_Name);
                    cmdUpdateCase.Parameters.AddWithValue("@IB_Form_Destination_File_Name", caseDetail.IB_Form_Destination_File_Name);
                    if (caseDetail.IB_ReceivedDate != null) cmdUpdateCase.Parameters.AddWithValue("@IB_Receiv_Date", caseDetail.IB_ReceivedDate);
                    else cmdUpdateCase.Parameters.AddWithValue("@IB_Receiv_Date", DBNull.Value);

                    cmdUpdateCase.Parameters.AddWithValue("@POP_Form", caseDetail.POP_Form);
                    cmdUpdateCase.Parameters.AddWithValue("@POP_Form_File_Name", caseDetail.POP_Form_File_Name);
                    cmdUpdateCase.Parameters.AddWithValue("@POP_Form_Destination_File_Name", caseDetail.POP_Form_Destionation_File_Name);
                    if (caseDetail.POP_ReceivedDate != null) cmdUpdateCase.Parameters.AddWithValue("@POP_Receiv_Date", caseDetail.POP_ReceivedDate);
                    else cmdUpdateCase.Parameters.AddWithValue("@POP_Receiv_Date", DBNull.Value);

                    cmdUpdateCase.Parameters.AddWithValue("@MedRec_Form", caseDetail.MedicalRecord_Form);
                    cmdUpdateCase.Parameters.AddWithValue("@MedRec_Form_File_Name", caseDetail.MedRec_Form_File_Name);
                    cmdUpdateCase.Parameters.AddWithValue("@MedRec_Form_Destination_File_Name", caseDetail.MedRec_Form_Destination_File_Name);
                    if (caseDetail.MedRec_ReceivedDate != null) cmdUpdateCase.Parameters.AddWithValue("@MedRec_Receiv_Date", caseDetail.MedRec_ReceivedDate);
                    else cmdUpdateCase.Parameters.AddWithValue("@MedRec_Receiv_Date", DBNull.Value);

                    cmdUpdateCase.Parameters.AddWithValue("@Unknown_Form", caseDetail.Unknown_Form);
                    cmdUpdateCase.Parameters.AddWithValue("@Unknown_Form_File_Name", caseDetail.Unknown_Form_File_Name);
                    cmdUpdateCase.Parameters.AddWithValue("@Unknown_Form_Destination_File_Name", caseDetail.Unknown_Form_Destination_File_Name);
                    if (caseDetail.Unknown_ReceivedDate != null) cmdUpdateCase.Parameters.AddWithValue("@Unknown_Receiv_Date", caseDetail.Unknown_ReceivedDate);
                    else cmdUpdateCase.Parameters.AddWithValue("@Unknown_Receiv_Date", DBNull.Value);

                    cmdUpdateCase.Parameters.AddWithValue("@CaseNote", caseDetail.Note);
                    cmdUpdateCase.Parameters.AddWithValue("@Log_Id", caseDetail.Log_Id);
                    cmdUpdateCase.Parameters.AddWithValue("@AddBill_Form", caseDetail.AddBill_Form);
                    if (caseDetail.AddBill_Received_Date != null) cmdUpdateCase.Parameters.AddWithValue("@AddBill_Receiv_Date", caseDetail.AddBill_Received_Date);
                    else cmdUpdateCase.Parameters.AddWithValue("@AddBill_Receiv_Date", DBNull.Value);

                    cmdUpdateCase.Parameters.AddWithValue("@Remove_Log", caseDetail.Remove_Log);
                    cmdUpdateCase.Parameters.AddWithValue("@CaseStatus", caseDetail.Status);

                    cmdUpdateCase.Parameters.AddWithValue("@Case_Id", caseDetail.CaseId);

                    if (connRN4.State != ConnectionState.Closed)
                    {
                        connRN4.Close();
                        connRN4.Open();
                    }
                    else if (connRN4.State == ConnectionState.Closed) connRN4.Open();
                    int nRowAffected = cmdUpdateCase.ExecuteNonQuery();
                    if (connRN4.State != ConnectionState.Closed) connRN4.Close();

                    if (nRowAffected == 1)
                    {
                        MessageBox.Show("The change has been saved.", "Information");

                        btnNewMedBill_Case.Enabled = true;
                        btnEditMedBill.Enabled = true;
                        btnDeleteMedBill.Enabled = true;
                    }
                    else if (nRowAffected == 0) MessageBox.Show("Update failed", "Error");
                }
                else
                {
                    return;
                }
            }

            Cursor.Current = Cursors.Default;
        }

        private void btnCaseCreationLowerCancel_Click(object sender, EventArgs e)
        {
            DialogResult dlgClose = MessageBox.Show("Do you want to close Case page?", "Alert", MessageBoxButtons.YesNo);

            if (dlgClose == DialogResult.Yes)
            {
                DialogResult dlgResult = MessageBox.Show("Do you want save the change?", "Alert", MessageBoxButtons.YesNo);

                if (dlgResult == DialogResult.Yes)
                {
                    String CaseName = txtCaseName.Text.Trim();
                    String IndividualId = txtCaseIndividualID.Text.Trim();

                    String strSqlQueryForCaseName = "select [dbo].[tbl_case].[Case_Name] from [dbo].[tbl_case] " +
                                                    "where [dbo].[tbl_case].[Case_Name] = @CaseName and [dbo].[tbl_case].[Contact_ID] = @IndividualId";

                    SqlCommand cmdQueryForCaseName = new SqlCommand(strSqlQueryForCaseName, connRN);
                    cmdQueryForCaseName.CommandText = strSqlQueryForCaseName;
                    cmdQueryForCaseName.CommandType = CommandType.Text;

                    cmdQueryForCaseName.Parameters.AddWithValue("@CaseName", CaseName);
                    cmdQueryForCaseName.Parameters.AddWithValue("@IndividualId", IndividualId);

                    //if (connRN.State == ConnectionState.Closed) connRN.Open();
                    if (connRN.State != ConnectionState.Closed)
                    {
                        connRN.Close();
                        connRN.Open();
                    }
                    else if (connRN.State == ConnectionState.Closed) connRN.Open();
                    Object objCaseName = cmdQueryForCaseName.ExecuteScalar();
                    if (connRN.State != ConnectionState.Closed) connRN.Close();

                    if (objCaseName == null)
                    {
                        //frmSaveNewCase frmSaveNewCase = new frmSaveNewCase();

                        //DialogResult dlgResult = frmSaveNewCase.ShowDialog();

                        //if (dlgResult == DialogResult.Yes)
                        //{

                        String strCaseId = String.Empty;
                        String strIndividualID = String.Empty;
                        String strNPFormFilePath = String.Empty;
                        String strNPFUploadDate = String.Empty;
                        String strIBFilePath = String.Empty;
                        String strIBUploadDate = String.Empty;
                        String strPopFilePath = String.Empty;
                        String strPopUploadDate = String.Empty;
                        String strMedicalRecordFilePath = String.Empty;
                        String strMedicalRecordUploadDate = String.Empty;
                        String strUnknownDocumentFilePath = String.Empty;
                        String strUnknownDocUploadDate = String.Empty;
                        String strLogID = String.Empty;

                        CasedInfoDetailed caseDetail = new CasedInfoDetailed();

                        caseDetail.CaseId = String.Empty;
                        caseDetail.ContactId = String.Empty;
                        caseDetail.Individual_Id = String.Empty;
                        caseDetail.CreateDate = DateTime.Today;
                        caseDetail.ModificationDate = DateTime.Today;
                        caseDetail.CreateStaff = nLoggedUserId;
                        caseDetail.ModifyingStaff = nLoggedUserId;
                        switch (cbCaseStatus.SelectedIndex)
                        {
                            case (int)CaseStatus.OnGoing:
                                caseDetail.Status = CaseStatus.OnGoing;
                                break;
                            case (int)CaseStatus.Processing:
                                caseDetail.Status = CaseStatus.Processing;
                                break;
                            case (int)CaseStatus.Closed:
                                caseDetail.Status = CaseStatus.Closed;
                                break;
                        }
                        caseDetail.Individual_Id = String.Empty;
                        caseDetail.NPF_Form = 0;
                        caseDetail.NPF_Form_File_Name = String.Empty;
                        caseDetail.NPF_Form_Destination_File_Name = String.Empty;

                        caseDetail.IB_Form = 0;
                        caseDetail.IB_Form_File_Name = String.Empty;
                        caseDetail.IB_Form_Destination_File_Name = String.Empty;

                        caseDetail.POP_Form = 0;
                        caseDetail.POP_Form_File_Name = String.Empty;
                        caseDetail.POP_Form_Destionation_File_Name = String.Empty;

                        caseDetail.MedicalRecord_Form = 0;
                        caseDetail.MedRec_Form_File_Name = String.Empty;
                        caseDetail.MedRec_Form_Destination_File_Name = String.Empty;

                        caseDetail.Unknown_Form = 0;
                        caseDetail.Unknown_Form_File_Name = String.Empty;
                        caseDetail.Unknown_Form_Destination_File_Name = String.Empty;

                        caseDetail.Note = String.Empty;
                        caseDetail.Log_Id = String.Empty;
                        caseDetail.AddBill_Form = false;

                        caseDetail.Remove_Log = String.Empty;

                        if (txtCaseName.Text.Trim() != String.Empty) caseDetail.CaseId = txtCaseName.Text.Trim();
                        if (txtCaseIndividualID.Text.Trim() != String.Empty) caseDetail.ContactId = txtCaseIndividualID.Text.Trim();
                        if (txtCaseIndividualID.Text.Trim() != String.Empty) caseDetail.Individual_Id = txtCaseIndividualID.Text.Trim();
                        if (chkNPF_CaseCreationPage.Checked)
                        {
                            caseDetail.NPF_Form = 1;
                            if (txtNPFFormFilePath.Text.Trim() != String.Empty) caseDetail.NPF_Form_File_Name = txtNPFFormFilePath.Text.Trim();
                            //if (txtNPFUploadDate.Text.Trim() != String.Empty)
                            //{
                            //    DateTime result;
                            //    if (DateTime.TryParse(txtNPFUploadDate.Text.Trim(), out result)) caseDetail.NPF_ReceivedDate = result;
                            //    else MessageBox.Show("Invalid DateTime value", "Error");
                            //}
                            caseDetail.NPF_ReceivedDate = dtpNPFReceivedDate.Value;
                            caseDetail.NPF_Form_Destination_File_Name = strNPFormFilePathDestination;
                        }
                        if (chkIB_CaseCreationPage.Checked)
                        {
                            caseDetail.IB_Form = 1;
                            if (txtIBFilePath.Text.Trim() != String.Empty) caseDetail.IB_Form_File_Name = txtIBFilePath.Text.Trim();
                            //if (txtIBUploadDate.Text.Trim() != String.Empty)
                            //{
                            //    DateTime result;
                            //    if (DateTime.TryParse(txtIBUploadDate.Text.Trim(), out result)) caseDetail.IB_ReceivedDate = result;
                            //    else MessageBox.Show("Invalid DateTime value", "Error");
                            //}
                            caseDetail.IB_ReceivedDate = dtpIBReceivedDate.Value;
                            caseDetail.IB_Form_Destination_File_Name = strIBFilePathDestination;
                        }
                        if (chkPoP_CaseCreationPage.Checked)
                        {
                            caseDetail.POP_Form = 1;
                            if (txtPopFilePath.Text.Trim() != String.Empty) caseDetail.POP_Form_File_Name = txtPopFilePath.Text.Trim();
                            //if (txtPoPUploadDate.Text.Trim() != String.Empty)
                            //{
                            //    DateTime result;
                            //    if (DateTime.TryParse(txtPoPUploadDate.Text.Trim(), out result)) caseDetail.POP_ReceivedDate = result;
                            //    else MessageBox.Show("Invalid DateTime value", "Error");
                            //}
                            caseDetail.POP_ReceivedDate = dtpPoPReceivedDate.Value;
                            caseDetail.POP_Form_Destionation_File_Name = strPopFilePathDestination;
                        }
                        if (chkMedicalRecordCaseCreationPage.Checked)
                        {
                            caseDetail.MedicalRecord_Form = 1;
                            if (txtMedicalRecordFilePath.Text.Trim() != String.Empty) caseDetail.MedRec_Form_File_Name = txtMedicalRecordFilePath.Text.Trim();
                            //if (txtMRUploadDate.Text.Trim() != String.Empty)
                            //{
                            //    DateTime result;
                            //    if (DateTime.TryParse(txtMRUploadDate.Text.Trim(), out result)) caseDetail.MedRec_ReceivedDate = result;
                            //    else MessageBox.Show("Invalid DateTime value", "Error");
                            //}
                            caseDetail.MedRec_ReceivedDate = dtpMRReceivedDate.Value;
                            caseDetail.MedRec_Form_Destination_File_Name = strMedRecordFilePathDestination;
                        }
                        if (chkOtherDocCaseCreationPage.Checked)
                        {
                            caseDetail.Unknown_Form = 1;
                            if (txtOtherDocumentFilePath.Text.Trim() != String.Empty) caseDetail.Unknown_Form_File_Name = txtOtherDocumentFilePath.Text.Trim();
                            //if (txtOtherDocUploadDate.Text.Trim() != String.Empty)      //caseDetail.Unknown_ReceivedDate = DateTime.Parse(txtOtherDocUploadDate.Text.Trim());
                            //{
                            //    DateTime result;
                            //    if (DateTime.TryParse(txtOtherDocUploadDate.Text.Trim(), out result)) caseDetail.Unknown_ReceivedDate = result;
                            //    else MessageBox.Show("Invalid DateTime value", "Error");
                            //}
                            caseDetail.Unknown_ReceivedDate = dtpOtherDocReceivedDate.Value;
                            caseDetail.Unknown_Form_Destination_File_Name = strUnknownDocFilePathDestination;
                        }

                        caseDetail.Log_Id = "Log: " + txtCaseName.Text;
                        caseDetail.AddBill_Form = false;
                        caseDetail.AddBill_Received_Date = null;
                        caseDetail.Remove_Log = String.Empty;

                        String strSqlCreateCase = "insert into tbl_case (IsDeleted, Case_Name, Contact_ID, CreateDate, ModifiDate, CreateStaff, ModifiStaff, Case_status, " +
                                                    "NPF_Form, NPF_Form_File_Name, NPF_Form_Destination_File_Name, NPF_Receiv_Date, " +
                                                    "IB_Form, IB_Form_File_Name, IB_Form_Destination_File_Name, IB_Receiv_Date, " +
                                                    "POP_Form, POP_Form_File_Name, POP_Form_Destination_File_Name, POP_Receiv_Date, " +
                                                    "MedRec_Form, MedRec_Form_File_Name, MedRec_Form_Destination_File_Name, MedRec_Receiv_Date, " +
                                                    "Unknown_Form, Unknown_Form_File_Name, Unknown_Form_Destination_File_Name, Unknown_Receiv_Date, " +
                                                    "Note, Log_ID, AddBill_Form, AddBill_receiv_Date, Remove_log, individual_id) " +
                                                    "Values (@IsDeleted, @CaseId, @ContactId, @CreateDate, @ModifiDate, @CreateStaff, @ModifiStaff, @CaseStatus, " +
                                                    "@NPF_Form, @NPF_Form_File_Name, @NPF_Form_Destination_File_Name, @NPF_Receive_Date, " +
                                                    "@IB_Form, @IB_Form_File_Name, @IB_Form_Destination_File_Name, @IB_Receive_Date, " +
                                                    "@POP_Form, @POP_Form_File_Name, @POP_Form_Destination_File_Name, @POP_Receive_Date, " +
                                                    "@MedRecord_Form, @MedRecord_Form_File_Name, @MedRecord_Form_Destination_File_name, @MedRecord_Receive_Date, " +
                                                    "@Unknown_Form, @Unknown_Form_File_Name, @Unknown_Form_Destination_File_Name, @Unknown_Receive_Date, " +
                                                    "@Note, @Log_Id, @AddBill_Form, @AddBill_ReceiveDate, @Remove_Log, @Individual_Id)";

                        SqlCommand cmdInsertNewCase = new SqlCommand(strSqlCreateCase, connRN);
                        cmdInsertNewCase.CommandType = CommandType.Text;

                        cmdInsertNewCase.Parameters.AddWithValue("@IsDeleted", 0);
                        cmdInsertNewCase.Parameters.AddWithValue("@CaseId", caseDetail.CaseId);
                        cmdInsertNewCase.Parameters.AddWithValue("@ContactId", caseDetail.ContactId);
                        cmdInsertNewCase.Parameters.AddWithValue("@CreateDate", caseDetail.CreateDate);
                        cmdInsertNewCase.Parameters.AddWithValue("@ModifiDate", caseDetail.ModificationDate);
                        cmdInsertNewCase.Parameters.AddWithValue("@CreateStaff", caseDetail.CreateStaff);
                        cmdInsertNewCase.Parameters.AddWithValue("@ModifiStaff", caseDetail.ModifyingStaff);
                        cmdInsertNewCase.Parameters.AddWithValue("@CaseStatus", caseDetail.Status);

                        cmdInsertNewCase.Parameters.AddWithValue("@NPF_Form", caseDetail.NPF_Form);
                        cmdInsertNewCase.Parameters.AddWithValue("@NPF_Form_File_Name", caseDetail.NPF_Form_File_Name);
                        cmdInsertNewCase.Parameters.AddWithValue("@NPF_Form_Destination_File_Name", caseDetail.NPF_Form_Destination_File_Name);
                        if (caseDetail.NPF_ReceivedDate != null) cmdInsertNewCase.Parameters.AddWithValue("@NPF_Receive_Date", caseDetail.NPF_ReceivedDate);
                        else cmdInsertNewCase.Parameters.AddWithValue("@NPF_Receive_Date", DBNull.Value);

                        cmdInsertNewCase.Parameters.AddWithValue("@IB_Form", caseDetail.IB_Form);
                        cmdInsertNewCase.Parameters.AddWithValue("@IB_Form_File_Name", caseDetail.IB_Form_File_Name);
                        cmdInsertNewCase.Parameters.AddWithValue("@IB_Form_Destination_File_Name", caseDetail.IB_Form_Destination_File_Name);
                        if (caseDetail.IB_ReceivedDate != null) cmdInsertNewCase.Parameters.AddWithValue("@IB_Receive_Date", caseDetail.IB_ReceivedDate);
                        else cmdInsertNewCase.Parameters.AddWithValue("@IB_Receive_Date", DBNull.Value);

                        cmdInsertNewCase.Parameters.AddWithValue("@POP_Form", caseDetail.POP_Form);
                        cmdInsertNewCase.Parameters.AddWithValue("@POP_Form_File_Name", caseDetail.POP_Form_File_Name);
                        cmdInsertNewCase.Parameters.AddWithValue("@POP_Form_Destination_File_Name", caseDetail.POP_Form_Destionation_File_Name);
                        if (caseDetail.POP_ReceivedDate != null) cmdInsertNewCase.Parameters.AddWithValue("@POP_Receive_Date", caseDetail.POP_ReceivedDate);
                        else cmdInsertNewCase.Parameters.AddWithValue("@POP_Receive_Date", DBNull.Value);

                        cmdInsertNewCase.Parameters.AddWithValue("@MedRecord_Form", caseDetail.MedicalRecord_Form);
                        cmdInsertNewCase.Parameters.AddWithValue("@MedRecord_Form_File_Name", caseDetail.MedRec_Form_File_Name);
                        cmdInsertNewCase.Parameters.AddWithValue("@MedRecord_Form_Destination_File_Name", caseDetail.MedRec_Form_Destination_File_Name);
                        if (caseDetail.MedRec_ReceivedDate != null) cmdInsertNewCase.Parameters.AddWithValue("@MedRecord_Receive_Date", caseDetail.MedRec_ReceivedDate);
                        else cmdInsertNewCase.Parameters.AddWithValue("@MedRecord_Receive_Date", DBNull.Value);

                        cmdInsertNewCase.Parameters.AddWithValue("@Unknown_Form", caseDetail.Unknown_Form);
                        cmdInsertNewCase.Parameters.AddWithValue("@Unknown_Form_File_Name", caseDetail.Unknown_Form_File_Name);
                        cmdInsertNewCase.Parameters.AddWithValue("@Unknown_Form_Destination_File_Name", caseDetail.Unknown_Form_Destination_File_Name);
                        if (caseDetail.Unknown_ReceivedDate != null) cmdInsertNewCase.Parameters.AddWithValue("@Unknown_Receive_Date", caseDetail.Unknown_ReceivedDate);
                        else cmdInsertNewCase.Parameters.AddWithValue("@Unknown_Receive_Date", DBNull.Value);

                        cmdInsertNewCase.Parameters.AddWithValue("@Note", caseDetail.Note);
                        cmdInsertNewCase.Parameters.AddWithValue("@Log_Id", caseDetail.Log_Id);
                        cmdInsertNewCase.Parameters.AddWithValue("@AddBill_Form", caseDetail.AddBill_Form);
                        if (caseDetail.AddBill_Received_Date != null) cmdInsertNewCase.Parameters.AddWithValue("@AddBill_ReceiveDate", caseDetail.AddBill_Received_Date);
                        else cmdInsertNewCase.Parameters.AddWithValue("@AddBill_ReceiveDate", DBNull.Value);
                        if (caseDetail.Remove_Log == String.Empty) cmdInsertNewCase.Parameters.AddWithValue("@Remove_Log", DBNull.Value);
                        cmdInsertNewCase.Parameters.AddWithValue("@Individual_Id", caseDetail.Individual_Id);

                        //if (connRN.State == ConnectionState.Closed) connRN.Open();
                        if (connRN.State != ConnectionState.Closed)
                        {
                            connRN.Close();
                            connRN.Open();
                        }
                        else if (connRN.State == ConnectionState.Closed) connRN.Open();
                        int nResult = cmdInsertNewCase.ExecuteNonQuery();
                        if (nResult == 1)
                        {
                            MessageBox.Show("The case has been saved.", "Information");

                            caseDetail.CaseId = txtCaseName.Text.Trim();
                            strCaseIdSelected = caseDetail.CaseId;
                            strContactIdSelected = caseDetail.ContactId;

                            btnNewMedBill_Case.Enabled = true;
                            btnEditMedBill.Enabled = true;
                            btnDeleteMedBill.Enabled = true;
                        }
                        if (connRN.State != ConnectionState.Closed) connRN.Close();
                    }
                    else if (objCaseName != null)    // Edit and update case
                    {
                        //frmSaveChangeOnCase frmDlgSaveChange = new frmSaveChangeOnCase();

                        //DialogResult dlgResult = frmDlgSaveChange.ShowDialog();

                        ////if (frmDlgSaveChange.DialogResult == DialogResult.Yes)
                        //if (dlgResult == DialogResult.Yes)
                        //{
                        CasedInfoDetailed caseDetail = new CasedInfoDetailed();

                        caseDetail.CaseId = txtCaseName.Text.Trim();
                        caseDetail.ContactId = String.Empty;
                        caseDetail.Individual_Id = String.Empty;
                        caseDetail.CreateDate = DateTime.Today;
                        //caseDetail.ModificationDate = DateTime.Today;
                        //caseDetail.CreateStaff = 8;     // WonJik
                        //caseDetail.ModifyingStaff = 8;  // WonJik
                        //caseDetail.CreateStaff = nLoggedUserId;
                        caseDetail.ModifyingStaff = nLoggedUserId;
                        switch (cbCaseStatus.SelectedIndex)
                        {
                            case (int)CaseStatus.OnGoing:
                                caseDetail.Status = CaseStatus.OnGoing;
                                break;
                            case (int)CaseStatus.Processing:
                                caseDetail.Status = CaseStatus.Processing;
                                break;
                            case (int)CaseStatus.Closed:
                                caseDetail.Status = CaseStatus.Closed;
                                break;
                        }
                        caseDetail.Individual_Id = String.Empty;
                        caseDetail.NPF_Form = 0;
                        caseDetail.NPF_Form_File_Name = String.Empty;
                        caseDetail.NPF_Form_Destination_File_Name = String.Empty;
                        //caseDetail.NPF_ReceivedDate = DateTime.Today;
                        caseDetail.IB_Form = 0;
                        caseDetail.IB_Form_File_Name = String.Empty;
                        caseDetail.IB_Form_Destination_File_Name = String.Empty;
                        //caseDetail.IB_ReceivedDate = DateTime.Today;
                        caseDetail.POP_Form = 0;
                        caseDetail.POP_Form_File_Name = String.Empty;
                        caseDetail.POP_Form_Destionation_File_Name = String.Empty;
                        //caseDetail.POP_ReceivedDate = DateTime.Today;
                        caseDetail.MedicalRecord_Form = 0;
                        caseDetail.MedRec_Form_File_Name = String.Empty;
                        caseDetail.MedRec_Form_Destination_File_Name = String.Empty;
                        //caseDetail.MedRec_ReceivedDate = DateTime.Today;
                        caseDetail.Unknown_Form = 0;
                        caseDetail.Unknown_Form_File_Name = String.Empty;
                        caseDetail.Unknown_Form_Destination_File_Name = String.Empty;
                        //caseDetail.Unknown_ReceivedDate = DateTime.Today;
                        caseDetail.Note = String.Empty;
                        caseDetail.Log_Id = String.Empty;
                        caseDetail.AddBill_Form = false;
                        //caseDetail.AddBill_Received_Date = DateTime.Today;
                        caseDetail.Remove_Log = String.Empty;

                        if (txtCaseName.Text.Trim() != String.Empty) caseDetail.CaseId = txtCaseName.Text.Trim();
                        if (txtCaseIndividualID.Text.Trim() != String.Empty) caseDetail.ContactId = txtCaseIndividualID.Text.Trim();
                        if (txtCaseIndividualID.Text.Trim() != String.Empty) caseDetail.Individual_Id = txtCaseIndividualID.Text.Trim();

                        if (chkNPF_CaseCreationPage.Checked)
                        {
                            caseDetail.NPF_Form = 1;
                            if (txtNPFFormFilePath.Text.Trim() != String.Empty) caseDetail.NPF_Form_File_Name = txtNPFFormFilePath.Text.Trim();
                            //if (txtNPFUploadDate.Text.Trim() != String.Empty)
                            //{
                            //    DateTime result;
                            //    if (DateTime.TryParse(txtNPFUploadDate.Text.Trim(), out result)) caseDetail.NPF_ReceivedDate = result;
                            //    else MessageBox.Show("Invalid DateTime value", "Error");
                            //}
                            caseDetail.NPF_ReceivedDate = dtpNPFReceivedDate.Value;
                            caseDetail.NPF_Form_Destination_File_Name = strNPFormFilePathDestination;
                        }
                        if (chkIB_CaseCreationPage.Checked)
                        {
                            caseDetail.IB_Form = 1;
                            if (txtIBFilePath.Text.Trim() != String.Empty) caseDetail.IB_Form_File_Name = txtIBFilePath.Text.Trim();
                            //if (txtIBUploadDate.Text.Trim() != String.Empty)
                            //{
                            //    DateTime result;
                            //    if (DateTime.TryParse(txtIBUploadDate.Text.Trim(), out result)) caseDetail.IB_ReceivedDate = result;
                            //    else MessageBox.Show("Invalid DateTime value", "Error");
                            //}
                            caseDetail.IB_ReceivedDate = dtpIBReceivedDate.Value;
                            caseDetail.IB_Form_Destination_File_Name = strIBFilePathDestination;
                        }
                        if (chkPoP_CaseCreationPage.Checked)
                        {
                            caseDetail.POP_Form = 1;
                            if (txtPopFilePath.Text.Trim() != String.Empty) caseDetail.POP_Form_File_Name = txtPopFilePath.Text.Trim();
                            //if (txtPoPUploadDate.Text.Trim() != String.Empty)
                            //{
                            //    DateTime result;
                            //    if (DateTime.TryParse(txtPoPUploadDate.Text.Trim(), out result)) caseDetail.POP_ReceivedDate = result;
                            //    else MessageBox.Show("Invalid DateTime value", "Error");
                            //}
                            caseDetail.POP_ReceivedDate = dtpPoPReceivedDate.Value;
                            caseDetail.POP_Form_Destionation_File_Name = strPopFilePathDestination;
                        }
                        if (chkMedicalRecordCaseCreationPage.Checked)
                        {
                            caseDetail.MedicalRecord_Form = 1;
                            if (txtMedicalRecordFilePath.Text.Trim() != String.Empty) caseDetail.MedRec_Form_File_Name = txtMedicalRecordFilePath.Text.Trim();
                            //if (txtMRUploadDate.Text.Trim() != String.Empty)
                            //{
                            //    DateTime result;
                            //    if (DateTime.TryParse(txtMRUploadDate.Text.Trim(), out result)) caseDetail.MedRec_ReceivedDate = result;
                            //    else MessageBox.Show("Invalid DateTime value", "Error");
                            //}
                            caseDetail.MedRec_ReceivedDate = dtpMRReceivedDate.Value;
                            caseDetail.MedRec_Form_Destination_File_Name = strMedRecordFilePathDestination;
                        }
                        if (chkOtherDocCaseCreationPage.Checked)
                        {
                            caseDetail.Unknown_Form = 1;
                            if (txtOtherDocumentFilePath.Text.Trim() != String.Empty) caseDetail.Unknown_Form_File_Name = txtOtherDocumentFilePath.Text.Trim();
                            //if (txtOtherDocUploadDate.Text.Trim() != String.Empty)      //caseDetail.Unknown_ReceivedDate = DateTime.Parse(txtOtherDocUploadDate.Text.Trim());
                            //{
                            //    DateTime result;
                            //    if (DateTime.TryParse(txtOtherDocUploadDate.Text.Trim(), out result)) caseDetail.Unknown_ReceivedDate = result;
                            //    else MessageBox.Show("Invalid DateTime value", "Error");
                            //}
                            caseDetail.Unknown_ReceivedDate = dtpOtherDocReceivedDate.Value;
                            caseDetail.Unknown_Form_Destination_File_Name = strUnknownDocFilePathDestination;
                        }

                        caseDetail.Note = txtNoteOnCase.Text.Trim();
                        caseDetail.Log_Id = "Log: " + txtCaseName.Text;
                        caseDetail.AddBill_Form = true;
                        caseDetail.AddBill_Received_Date = DateTime.Today;
                        caseDetail.Remove_Log = String.Empty;

                        String strSqlUpdateCase = "Update [dbo].[tbl_case] set [dbo].[tbl_case].[ModifiDate] = @ModifiDate, [dbo].[tbl_case].[ModifiStaff] = @ModifiStaff, " +
                                                    "[dbo].[tbl_case].[NPF_Form] = @NPF_Form, [dbo].[tbl_case].[NPF_Form_File_Name] = @NPF_Form_File_Name, " +
                                                    "[dbo].[tbl_case].[NPF_Form_Destination_File_Name] = @NPF_Form_Destination_File_Name, [dbo].[tbl_case].[NPF_Receiv_Date] = @NPF_Receiv_Date, " +
                                                    "[dbo].[tbl_case].[IB_Form] = @IB_Form, [dbo].[tbl_case].[IB_Form_File_Name] = @IB_Form_File_Name, " +
                                                    "[dbo].[tbl_case].[IB_Form_Destination_File_Name] = @IB_Form_Destination_File_Name, [dbo].[tbl_case].[IB_Receiv_Date] = @IB_Receiv_Date, " +
                                                    "[dbo].[tbl_case].[POP_Form] = @POP_Form, [dbo].[tbl_case].[POP_Form_File_Name] = @POP_Form_File_Name, " +
                                                    "[dbo].[tbl_case].[POP_Form_Destination_File_Name] = @POP_Form_Destination_File_Name, [dbo].[tbl_case].[POP_Receiv_Date] = @POP_Receiv_Date, " +
                                                    "[dbo].[tbl_case].[MedRec_Form] = @MedRec_Form, [dbo].[tbl_case].[MedRec_Form_File_Name] = @MedRec_Form_File_Name, " +
                                                    "[dbo].[tbl_case].[MedRec_Form_Destination_File_Name] = @MedRec_Form_Destination_File_Name, [dbo].[tbl_case].[MedRec_Receiv_Date] = @MedRec_Receiv_Date, " +
                                                    "[dbo].[tbl_case].[Unknown_Form] = @Unknown_Form, [dbo].[tbl_case].[Unknown_Form_File_Name] = @Unknown_Form_File_Name, " +
                                                    "[dbo].[tbl_case].[Unknown_Form_Destination_File_Name] = @Unknown_Form_Destination_File_Name, [dbo].[tbl_case].[Unknown_Receiv_Date] = @Unknown_Receiv_Date, " +
                                                    "[dbo].[tbl_case].[Note] = @CaseNote, [dbo].[tbl_case].[Log_ID] = @Log_Id, [dbo].[tbl_case].[AddBill_Form] = @AddBill_Form, " +
                                                    "[dbo].[tbl_case].[AddBill_Receiv_Date] = @AddBill_Receiv_Date, [dbo].[tbl_case].[Remove_Log] = @Remove_Log " +
                                                    "where [dbo].[tbl_case].[Case_Name] = @Case_Id";

                        SqlCommand cmdUpdateCase = new SqlCommand(strSqlUpdateCase, connRN);
                        cmdUpdateCase.CommandType = CommandType.Text;

                        cmdUpdateCase.Parameters.AddWithValue("@ModifiDate", caseDetail.ModificationDate);
                        cmdUpdateCase.Parameters.AddWithValue("@ModifiStaff", caseDetail.ModifyingStaff);
                        cmdUpdateCase.Parameters.AddWithValue("@NPF_Form", caseDetail.NPF_Form);
                        cmdUpdateCase.Parameters.AddWithValue("@NPF_Form_File_Name", caseDetail.NPF_Form_File_Name);
                        cmdUpdateCase.Parameters.AddWithValue("@NPF_Form_Destination_File_Name", caseDetail.NPF_Form_Destination_File_Name);
                        if (caseDetail.NPF_ReceivedDate != null) cmdUpdateCase.Parameters.AddWithValue("@NPF_Receiv_Date", caseDetail.NPF_ReceivedDate);
                        else cmdUpdateCase.Parameters.AddWithValue("@NPF_Receiv_Date", DBNull.Value);

                        cmdUpdateCase.Parameters.AddWithValue("@IB_Form", caseDetail.IB_Form);
                        cmdUpdateCase.Parameters.AddWithValue("@IB_Form_File_Name", caseDetail.IB_Form_File_Name);
                        cmdUpdateCase.Parameters.AddWithValue("@IB_Form_Destination_File_Name", caseDetail.IB_Form_Destination_File_Name);
                        if (caseDetail.IB_ReceivedDate != null) cmdUpdateCase.Parameters.AddWithValue("@IB_Receiv_Date", caseDetail.IB_ReceivedDate);
                        else cmdUpdateCase.Parameters.AddWithValue("@IB_Receiv_Date", DBNull.Value);

                        cmdUpdateCase.Parameters.AddWithValue("@POP_Form", caseDetail.POP_Form);
                        cmdUpdateCase.Parameters.AddWithValue("@POP_Form_File_Name", caseDetail.POP_Form_File_Name);
                        cmdUpdateCase.Parameters.AddWithValue("@POP_Form_Destination_File_Name", caseDetail.POP_Form_Destionation_File_Name);
                        if (caseDetail.POP_ReceivedDate != null) cmdUpdateCase.Parameters.AddWithValue("@POP_Receiv_Date", caseDetail.POP_ReceivedDate);
                        else cmdUpdateCase.Parameters.AddWithValue("@POP_Receiv_Date", DBNull.Value);

                        cmdUpdateCase.Parameters.AddWithValue("@MedRec_Form", caseDetail.MedicalRecord_Form);
                        cmdUpdateCase.Parameters.AddWithValue("@MedRec_Form_File_Name", caseDetail.MedRec_Form_File_Name);
                        cmdUpdateCase.Parameters.AddWithValue("@MedRec_Form_Destination_File_Name", caseDetail.MedRec_Form_Destination_File_Name);
                        if (caseDetail.MedRec_ReceivedDate != null) cmdUpdateCase.Parameters.AddWithValue("@MedRec_Receiv_Date", caseDetail.MedRec_ReceivedDate);
                        else cmdUpdateCase.Parameters.AddWithValue("@MedRec_Receiv_Date", DBNull.Value);

                        cmdUpdateCase.Parameters.AddWithValue("@Unknown_Form", caseDetail.Unknown_Form);
                        cmdUpdateCase.Parameters.AddWithValue("@Unknown_Form_File_Name", caseDetail.Unknown_Form_File_Name);
                        cmdUpdateCase.Parameters.AddWithValue("@Unknown_Form_Destination_File_Name", caseDetail.Unknown_Form_Destination_File_Name);
                        if (caseDetail.Unknown_ReceivedDate != null) cmdUpdateCase.Parameters.AddWithValue("@Unknown_Receiv_Date", caseDetail.Unknown_ReceivedDate);
                        else cmdUpdateCase.Parameters.AddWithValue("@Unknown_Receiv_Date", DBNull.Value);

                        cmdUpdateCase.Parameters.AddWithValue("@CaseNote", caseDetail.Note);
                        cmdUpdateCase.Parameters.AddWithValue("@Log_Id", caseDetail.Log_Id);
                        cmdUpdateCase.Parameters.AddWithValue("@AddBill_Form", caseDetail.AddBill_Form);
                        if (caseDetail.AddBill_Received_Date != null) cmdUpdateCase.Parameters.AddWithValue("@AddBill_Receiv_Date", caseDetail.AddBill_Received_Date);
                        else cmdUpdateCase.Parameters.AddWithValue("@AddBill_Receiv_Date", DBNull.Value);

                        cmdUpdateCase.Parameters.AddWithValue("@Remove_Log", caseDetail.Remove_Log);

                        cmdUpdateCase.Parameters.AddWithValue("@Case_Id", caseDetail.CaseId);

                        //if (connRN.State == ConnectionState.Closed) connRN.Open();
                        if (connRN.State != ConnectionState.Closed)
                        {
                            connRN.Close();
                            connRN.Open();
                        }
                        else if (connRN.State == ConnectionState.Closed) connRN.Open();
                        int nRowAffected = cmdUpdateCase.ExecuteNonQuery();
                        if (connRN.State != ConnectionState.Closed) connRN.Close();

                        if (nRowAffected == 1)
                        {
                            MessageBox.Show("The change has been saved.", "Information");

                            btnNewMedBill_Case.Enabled = true;
                            btnEditMedBill.Enabled = true;
                            btnDeleteMedBill.Enabled = true;
                        }
                        else if (nRowAffected == 0) MessageBox.Show("The change has not been saved.", "Error");

                    }

                    tbCMMManager.TabPages.Remove(tbpgCreateCase);
                    tbCMMManager.SelectedTab = tbCMMManager.TabPages["tbpgCaseView"];
                    return;
                }
                else if (dlgResult == DialogResult.No)
                {
                    tbCMMManager.TabPages.Remove(tbpgCreateCase);
                    tbCMMManager.SelectedTab = tbCMMManager.TabPages["tbpgCaseView"];
                    return;
                }
            }
            else return;
            //else if (dlgResult == DialogResult.Cancel)
            //{
            //    return;
            //}
        }

        private void btnMedBillCreationPgLowerSave_Click(object sender, EventArgs e)
        {


            Cursor.Current = Cursors.WaitCursor;

            if (txtMedBill_Illness.Text.Trim() == String.Empty)
            {
                MessageBox.Show("Please select an Illness.", "Alert", MessageBoxButtons.OK);
                return;
            }
            if (txtMedBill_Incident.Text.Trim() == String.Empty)
            {
                MessageBox.Show("Please select an Incident.", "Alert", MessageBoxButtons.OK);
                return;
            }
            if (txtMedBillAmount.Text.Trim() == String.Empty)
            {
                MessageBox.Show("Please enter Medical Bill Amount.", "Alert", MessageBoxButtons.OK);
                return;
            }
            if (txtMedicalProvider.Text.Trim() == String.Empty)
            {
                MessageBox.Show("Please select a Medical Provider.", "Alert", MessageBoxButtons.OK);
                return;
            }

            frmSaveNewMedBill frmSaveMedBill = new frmSaveNewMedBill();

            frmSaveMedBill.StartPosition = FormStartPosition.CenterParent;
            DialogResult dlgResult = frmSaveMedBill.ShowDialog();

            if (dlgResult == DialogResult.Yes)
            {
                String strMedBillNo = txtMedBillNo.Text.Trim();

                String strSqlQueryForMedBill = "select [dbo].[tbl_medbill].[BillNo] from [dbo].[tbl_medbill] where [dbo].[tbl_medbill].[BillNo] = @MedBillNo";

                SqlCommand cmdQueryForMedBill = new SqlCommand(strSqlQueryForMedBill, connRN5);
                cmdQueryForMedBill.Parameters.AddWithValue("@MedBillNo", strMedBillNo);

                if (connRN5.State != ConnectionState.Closed)
                {
                    connRN5.Close();
                    connRN5.Open();
                }
                else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                Object ResultMedBillNo = cmdQueryForMedBill.ExecuteScalar();
                if (connRN5.State != ConnectionState.Closed) connRN5.Close();

                if (ResultMedBillNo == null)
                {
                    String strIndividualId = String.Empty;
                    String strCaseId = String.Empty;
                    String strBillStatus = String.Empty;
                    String strIllnessId = String.Empty;
                    String strIncidentId = String.Empty;

                    String strNewMedBillNo = String.Empty;
                    String strMedProvider = String.Empty;
                    String strPrescriptionName = String.Empty;
                    String strPrescriptionNo = String.Empty;
                    String strPrescriptionDescription = String.Empty;

                    if (txtIndividualIDMedBill.Text.Trim() != String.Empty) strIndividualId = txtIndividualIDMedBill.Text.Trim();
                    if (txtMedBill_CaseNo.Text.Trim() != String.Empty) strCaseId = txtMedBill_CaseNo.Text.Trim();

                    if (txtMedBill_Illness.Text.Trim() != String.Empty)
                    {
                        String IllnessNo = txtMedBill_Illness.Text.Trim();

                        String strSqlQueryForIllnessId = "select [dbo].[tbl_illness].[Illness_Id] from [dbo].[tbl_illness] where [dbo].[tbl_illness].[IllnessNo] = @IllnessNo";

                        SqlCommand cmdQueryForIllnessId = new SqlCommand(strSqlQueryForIllnessId, connRN5);
                        cmdQueryForIllnessId.CommandType = CommandType.Text;

                        cmdQueryForIllnessId.Parameters.AddWithValue("@IllnessNo", IllnessNo);

                        if (connRN5.State != ConnectionState.Closed)
                        {
                            connRN5.Close();
                            connRN5.Open();
                        }
                        else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                        Object objIllnessId = cmdQueryForIllnessId.ExecuteScalar();
                        if (connRN5.State != ConnectionState.Closed) connRN5.Close();

                        if (objIllnessId != null) strIllnessId = objIllnessId.ToString();
                        else
                        {
                            MessageBox.Show("No Illness Id for given Illness No", "Error");
                            return;
                        }
                    }

                    if (txtMedBill_Incident.Text.Trim() != String.Empty)
                    {
                        String IncidentNo = txtMedBill_Incident.Text.Trim();

                        String strSqlQueryForIncidentId = "select [dbo].[tbl_incident].[Incident_id] from [dbo].[tbl_incident] where [dbo].[tbl_incident].[IncidentNo] = @IncidentNo";

                        SqlCommand cmdQueryForIncidentId = new SqlCommand(strSqlQueryForIncidentId, connRN5);
                        cmdQueryForIncidentId.CommandType = CommandType.Text;

                        cmdQueryForIncidentId.Parameters.AddWithValue("@IncidentNo", IncidentNo);

                        if (connRN5.State != ConnectionState.Closed)
                        {
                            connRN5.Close();
                            connRN5.Open();
                        }
                        else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                        Object objIncidentId = cmdQueryForIncidentId.ExecuteScalar();
                        if (connRN5.State != ConnectionState.Closed) connRN5.Close();

                        if (objIncidentId != null) strIncidentId = objIncidentId.ToString();
                        else
                        {
                            MessageBox.Show("No Incident Id for given Incident No", "Error");
                            return;
                        }
                    }


                    if (txtMedBillNo.Text.Trim() != String.Empty) strNewMedBillNo = txtMedBillNo.Text.Trim();

                    String MedicalProvider = String.Empty;

                    if (txtMedicalProvider.Text.Trim() != String.Empty)
                    {
                        MedicalProvider = txtMedicalProvider.Text.Trim();
                    }
                    else
                    {
                        MessageBox.Show("Please enter the name of medical provider.", "Error");
                        return;
                    }

                    String PrescriptionName = String.Empty;

                    if (txtPrescriptionName.Text.Trim() != String.Empty)
                    {
                        PrescriptionName = txtPrescriptionName.Text.Trim();
                    }

                    String PrescriptionNo = String.Empty;

                    if (txtNumberOfMedication.Text.Trim() != String.Empty)
                    {
                        PrescriptionNo = txtNumberOfMedication.Text.Trim();
                    }

                    String PrescriptionDescription = String.Empty;

                    if (txtPrescriptionDescription.Text.Trim() != String.Empty)
                    {
                        PrescriptionDescription = txtPrescriptionDescription.Text.Trim();
                    }


                    int nPatientType = 0;   // default outpatient

                    if (rbOutpatient.Checked) nPatientType = 0;
                    else if (rbInpatient.Checked) nPatientType = 1;

                    String strNote = String.Empty;

                    if (comboMedBillType.SelectedItem.ToString() == "Medical Bill")
                    {
                        strNote = txtMedBillNote.Text.Trim();
                    }
                    else if (comboMedBillType.SelectedItem.ToString() == "Prescription")
                    {
                        strNote = txtPrescriptionNote.Text.Trim();
                    }
                    else if (comboMedBillType.SelectedItem.ToString() == "Physical Therapy")
                    {
                        strNote = txtPhysicalTherapyRxNote.Text.Trim();
                    }

                    String strSqlInsertNewMedBill = "insert into dbo.tbl_medbill (IsDeleted, BillNo, MedBillType_Id, BillStatus, BillClosed, CreatedDate, CreatedById, " +
                                                    "LastModifiedDate, LastModifiedById, " +
                                                    "LastActivityDate, LastViewedDate, LastReferencedDate, Case_Id, Incident_Id, Illness_Id, BillAmount, SettlementTotal, " +
                                                    "Balance, BillDate, TotalSharedAmount, Individual_Id, Contact_Id, MedicalProvider_Id, PendingReason, " +
                                                    "Account_At_Provider, ProviderPhoneNumber, ProviderContactPerson, " +
                                                    "ProposalLetterSentDate, HIPPASentDate, MedicalRecordDate, " +
                                                    "IneligibleReason, PersonalResponsibilityCredit, " +
                                                    "WellBeingCareTotal, WellBeingCare, DueDate, TotalNumberOfPhysicalTherapy, " +
                                                    "PrescriptionDrugName, PrescriptionNo, PrescriptionDescription, " +
                                                    "PatientTypeId, Note) " +
                                                    "values (@IsDeleted, @BillNo, @MedBillType_Id, @MedBillStatus, @MedBillClosed, @CreatedDate, @CreateById, " +
                                                    "@LastModifiedDate, @LastModifiedById, " +
                                                    "@LastActivityDate, @LastViewedDate, @LastReferencedDate, @Case_Id, @Incident_Id, @Illness_Id, @BillAmount, @SettlementTotal, " +
                                                    "@Balance, @BillDate, @TotalSharedAmount, @Individual_Id, @Contact_Id, @MedicalProvider_Id, @PendingReason, " +
                                                    "@Account_At_Provider, @ProviderPhoneNo, @ProviderContactPerson, " +
                                                    "@ProposalLetterSentDate, @HIPPASentDate, @MedicalRecordDate, " +
                                                    "@IneligibleReason, @PersonalResponsibilityCredit, " +
                                                    "@WellBeingCareTotal, @WellBeingCare, @DueDate, @TotalNumberOfPhysicalTherapy, " +
                                                    "@PrescriptionDrugName, @PrescriptionNo, @PrescriptionDescription, " +
                                                    "@PatientTypeId, @Note)";

                    SqlCommand cmdInsertNewMedBill = new SqlCommand(strSqlInsertNewMedBill, connRN5);
                    cmdInsertNewMedBill.CommandType = CommandType.Text;

                    cmdInsertNewMedBill.Parameters.AddWithValue("@IsDeleted", 0);
                    cmdInsertNewMedBill.Parameters.AddWithValue("@BillNo", strNewMedBillNo);
                    cmdInsertNewMedBill.Parameters.AddWithValue("@MedBillType_Id", comboMedBillType.SelectedIndex + 1);
                    cmdInsertNewMedBill.Parameters.AddWithValue("@MedBillStatus", comboMedBillStatus.SelectedIndex);
                    if (cbMedBillClosed.SelectedIndex == 0) cmdInsertNewMedBill.Parameters.AddWithValue("@MedBillClosed", 0);
                    else if (cbMedBillClosed.SelectedIndex == 1) cmdInsertNewMedBill.Parameters.AddWithValue("@MedBillClosed", 1);
                    cmdInsertNewMedBill.Parameters.AddWithValue("@CreatedDate", DateTime.Today);
                    cmdInsertNewMedBill.Parameters.AddWithValue("@CreateById", nLoggedUserId);
                    cmdInsertNewMedBill.Parameters.AddWithValue("@LastModifiedDate", DateTime.Today);
                    cmdInsertNewMedBill.Parameters.AddWithValue("@LastModifiedById", nLoggedUserId);
                    cmdInsertNewMedBill.Parameters.AddWithValue("@LastActivityDate", DateTime.Today);
                    cmdInsertNewMedBill.Parameters.AddWithValue("@LastViewedDate", DateTime.Today);
                    cmdInsertNewMedBill.Parameters.AddWithValue("@LastReferencedDate", DateTime.Today);
                    cmdInsertNewMedBill.Parameters.AddWithValue("@Case_Id", strCaseId);
                    cmdInsertNewMedBill.Parameters.AddWithValue("@Incident_Id", strIncidentId);
                    cmdInsertNewMedBill.Parameters.AddWithValue("@Illness_Id", strIllnessId);

                    Decimal BillAmountResult = 0;
                    Decimal BillAmount = 0;

                    if (Decimal.TryParse(txtMedBillAmount.Text.Trim(), NumberStyles.Currency, new CultureInfo("en-US"), out BillAmountResult))
                    {
                        BillAmount = BillAmountResult;
                        cmdInsertNewMedBill.Parameters.AddWithValue("@BillAmount", BillAmount);
                    }
                    else
                    {
                        MessageBox.Show("Bill Amount is invalid.", "Error");
                        return;
                    }

                    cmdInsertNewMedBill.Parameters.AddWithValue("@SettlementTotal", 0);

                    Decimal BalanceResult = 0;
                    Decimal Balance = 0;

                    if (Decimal.TryParse(txtBalance.Text.Trim(), NumberStyles.Currency, new CultureInfo("en-US"), out BalanceResult))
                    {
                        Balance = BalanceResult;
                        cmdInsertNewMedBill.Parameters.AddWithValue("@Balance", Balance);
                    }
                    else
                    {
                        MessageBox.Show("Balance is invalid.", "Error");
                        return;
                    }

                    cmdInsertNewMedBill.Parameters.AddWithValue("@BillDate", dtpBillDate.Value);

                    Decimal TotalSharedAmount = 0;
                    for (int i = 0; i < gvSettlementsInMedBill.Rows.Count; i++)
                    {
                        if ((gvSettlementsInMedBill["SettlementTypeValue", i].Value.ToString() == "CMM Provider Payment") ||
                            (gvSettlementsInMedBill["SettlementTypeValue", i].Value.ToString() == "CMM Member Reimbursement") ||
                            (gvSettlementsInMedBill["SettlementTypeValue", i].Value.ToString() == "PR Reimbursement"))
                            TotalSharedAmount += Decimal.Parse(gvSettlementsInMedBill["SettlementAmount", i]?.Value?.ToString(), NumberStyles.Currency, new CultureInfo("en-US"));
                        if (gvSettlementsInMedBill["SettlementTypeValue", i].Value.ToString() == "Medical Provider Refund")
                            TotalSharedAmount -= Decimal.Parse(gvSettlementsInMedBill["SettlementAmount", i]?.Value?.ToString(), NumberStyles.Currency, new CultureInfo("en-US"));
                    }

                    cmdInsertNewMedBill.Parameters.AddWithValue("@TotalSharedAmount", TotalSharedAmount);
                    cmdInsertNewMedBill.Parameters.AddWithValue("@Individual_Id", strIndividualId);
                    cmdInsertNewMedBill.Parameters.AddWithValue("@Contact_Id", strIndividualId);

                    Boolean bMedicalProvider = false;
                    foreach (MedicalProviderInfo info in lstMedicalProvider)
                    {
                        if (info.Name.Trim() == txtMedicalProvider.Text.Trim())
                        {
                            cmdInsertNewMedBill.Parameters.AddWithValue("@MedicalProvider_Id", info.ID);
                            bMedicalProvider = true;
                            break;
                        }
                    }
                    if (!bMedicalProvider)
                    {
                        MessageBox.Show("Medical Provider name is invalid.", "Error");
                        return;
                    }

                    cmdInsertNewMedBill.Parameters.AddWithValue("@Account_At_Provider", txtMedBillAccountNoAtProvider.Text.Trim());
                    cmdInsertNewMedBill.Parameters.AddWithValue("@ProviderPhoneNo", txtMedProviderPhoneNo.Text.Trim());
                    cmdInsertNewMedBill.Parameters.AddWithValue("@ProviderContactPerson", txtProviderContactPerson.Text.Trim());
                    cmdInsertNewMedBill.Parameters.AddWithValue("@ProposalLetterSentDate", dtpProposalLetterSentDate.Value);
                    cmdInsertNewMedBill.Parameters.AddWithValue("@HIPPASentDate", dtpHippaSentDate.Value);
                    cmdInsertNewMedBill.Parameters.AddWithValue("@MedicalRecordDate", dtpMedicalRecordDate.Value);
                    cmdInsertNewMedBill.Parameters.AddWithValue("@PersonalResponsibilityCredit", 500);
                    cmdInsertNewMedBill.Parameters.AddWithValue("@WellBeingCareTotal", 0);
                    cmdInsertNewMedBill.Parameters.AddWithValue("@WellBeingCare", 0);
                    cmdInsertNewMedBill.Parameters.AddWithValue("@DueDate", dtpDueDate.Value);

                    if (comboMedBillType.SelectedIndex == 0)        // Medical Bill Type : Medical Bill
                    {
                        cmdInsertNewMedBill.Parameters.AddWithValue("@PrescriptionDrugName", String.Empty);
                        cmdInsertNewMedBill.Parameters.AddWithValue("@PrescriptionNo", String.Empty);
                        cmdInsertNewMedBill.Parameters.AddWithValue("@PrescriptionDescription", String.Empty);

                        cmdInsertNewMedBill.Parameters.AddWithValue("@TotalNumberOfPhysicalTherapy", 0);

                        cmdInsertNewMedBill.Parameters.AddWithValue("@PatientTypeId", nPatientType);
                        if (comboPendingReason.SelectedIndex == -1) cmdInsertNewMedBill.Parameters.AddWithValue("@PendingReason", 0);
                        else cmdInsertNewMedBill.Parameters.AddWithValue("@PendingReason", comboPendingReason.SelectedIndex);
                        if (comboIneligibleReason.SelectedIndex == -1) cmdInsertNewMedBill.Parameters.AddWithValue("@IneligibleReason", 0);
                        else cmdInsertNewMedBill.Parameters.AddWithValue("@IneligibleReason", comboIneligibleReason.SelectedIndex);

                        cmdInsertNewMedBill.Parameters.AddWithValue("@Note", strNote);
                    }
                    else if (comboMedBillType.SelectedIndex == 1)   // Medical Bill Type : Prescription
                    {
                        cmdInsertNewMedBill.Parameters.AddWithValue("@PatientTypeId", DBNull.Value);
                        cmdInsertNewMedBill.Parameters.AddWithValue("@PendingReason", 0);
                        cmdInsertNewMedBill.Parameters.AddWithValue("@IneligibleReason", 0);

                        cmdInsertNewMedBill.Parameters.AddWithValue("@TotalNumberOfPhysicalTherapy", 0);

                        cmdInsertNewMedBill.Parameters.AddWithValue("@PrescriptionDrugName", txtPrescriptionName.Text.Trim());
                        cmdInsertNewMedBill.Parameters.AddWithValue("@PrescriptionNo", txtNumberOfMedication.Text.Trim());
                        cmdInsertNewMedBill.Parameters.AddWithValue("@PrescriptionDescription", txtPrescriptionDescription.Text.Trim());
                        cmdInsertNewMedBill.Parameters.AddWithValue("@Note", strNote);
                    }
                    else if (comboMedBillType.SelectedIndex == 2)   // Medical Bill Type : Physical Therapy
                    {
                        cmdInsertNewMedBill.Parameters.AddWithValue("@PrescriptionDrugName", String.Empty);
                        cmdInsertNewMedBill.Parameters.AddWithValue("@PrescriptionNo", String.Empty);
                        cmdInsertNewMedBill.Parameters.AddWithValue("@PrescriptionDescription", String.Empty);

                        cmdInsertNewMedBill.Parameters.AddWithValue("@PatientTypeId", DBNull.Value);
                        cmdInsertNewMedBill.Parameters.AddWithValue("@PendingReason", 0);
                        cmdInsertNewMedBill.Parameters.AddWithValue("@IneligibleReason", 0);

                        int nNumberOfPhysicalTherapy = 0;
                        short result = 0;
                        if (Int16.TryParse(txtNumPhysicalTherapy.Text.Trim(), out result))
                        {
                            nNumberOfPhysicalTherapy = result;
                            cmdInsertNewMedBill.Parameters.AddWithValue("@TotalNumberOfPhysicalTherapy", nNumberOfPhysicalTherapy);
                        }
                        else
                        {
                            MessageBox.Show("Please enter a positive integer in the Number of Physical Therapy Text Box.", "Alert");
                            return;
                        }

                        cmdInsertNewMedBill.Parameters.AddWithValue("@Note", strNote);
                    }

                    if (connRN5.State != ConnectionState.Closed)
                    {
                        connRN5.Close();
                        connRN5.Open();
                    }
                    else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                    int nRowInserted = cmdInsertNewMedBill.ExecuteNonQuery();
                    if (connRN5.State != ConnectionState.Closed) connRN5.Close();

                    if (nRowInserted == 1)
                    {

                        // handle Well Being Care case
                        Boolean bWellBeingCare = true;
                        Boolean bWellBeingCareEligible = true;

                        String strSqlQueryForICD10CodeForWellBeingCare = "select [dbo].[tbl_medbill].[BillNo], [dbo].[tbl_illness].[ICD_10_Id] from [dbo].[tbl_medbill] " +
                                                                         "inner join [dbo].[tbl_illness] on [dbo].[tbl_medbill].[Illness_Id] = [dbo].[tbl_illness].[Illness_Id] " +
                                                                         "where [dbo].[tbl_medbill].[BillNo] = @MedBillNo and " +
                                                                         "[dbo].[tbl_medbill].[Individual_Id] = @IndividualId";

                        SqlCommand cmdQueryForICD10CodeForWellBeingCare = new SqlCommand(strSqlQueryForICD10CodeForWellBeingCare, connRN5);
                        cmdQueryForICD10CodeForWellBeingCare.CommandType = CommandType.Text;

                        cmdQueryForICD10CodeForWellBeingCare.Parameters.AddWithValue("@MedBillNo", strNewMedBillNo);
                        cmdQueryForICD10CodeForWellBeingCare.Parameters.AddWithValue("@IndividualId", strIndividualId);

                        String ICD10Code = String.Empty;

                        if (connRN5.State != ConnectionState.Closed)
                        {
                            connRN5.Close();
                            connRN5.Open();
                        }
                        else if (connRN5.State == ConnectionState.Closed) connRN5.Open();

                        SqlDataReader rdrICD10CodeForWellBeingCare = cmdQueryForICD10CodeForWellBeingCare.ExecuteReader();
                        if (rdrICD10CodeForWellBeingCare.HasRows)
                        {
                            rdrICD10CodeForWellBeingCare.Read();
                            if (!rdrICD10CodeForWellBeingCare.IsDBNull(1)) ICD10Code = rdrICD10CodeForWellBeingCare.GetString(1);
                        }
                        rdrICD10CodeForWellBeingCare.Close();
                        if (connRN5.State == ConnectionState.Open) connRN5.Close();

                        if (ICD10Code != "Z00.00" && ICD10Code != "Z00.012") bWellBeingCare = false;

                        if (ICD10Code == "Z00.00" || ICD10Code == "Z00.012")
                        {

                            String strSqlQueryForProgramForIndividual = "select [dbo].[contact].[Individual_ID__c], [dbo].[program].[Name] from [dbo].[contact] " +
                                                                        "inner join [dbo].[program] on [dbo].[contact].[c4g_Plan__c] = [dbo].[program].[ID] " +
                                                                        "where [dbo].[contact].[Individual_ID__c] = @IndividualId";

                            SqlCommand cmdQueryForProgramForIndividual = new SqlCommand(strSqlQueryForProgramForIndividual, connSalesforce);
                            cmdQueryForProgramForIndividual.CommandType = CommandType.Text;

                            cmdQueryForProgramForIndividual.Parameters.AddWithValue("@IndividualId", strIndividualId);

                            if (connSalesforce.State != ConnectionState.Closed)
                            {
                                connSalesforce.Close();
                                connSalesforce.Open();
                            }
                            else if (connSalesforce.State == ConnectionState.Closed) connSalesforce.Open();

                            String ProgramName = String.Empty;

                            SqlDataReader rdrProgramForIndividual = cmdQueryForProgramForIndividual.ExecuteReader();
                            if (rdrProgramForIndividual.HasRows)
                            {
                                rdrProgramForIndividual.Read();
                                if (!rdrProgramForIndividual.IsDBNull(1)) ProgramName = rdrProgramForIndividual.GetString(1);
                            }
                            rdrProgramForIndividual.Close();
                            if (connSalesforce.State == ConnectionState.Open) connSalesforce.Close();

                            if (ProgramName == "Gold Plus" || ProgramName == "Gold Medi-I" || ProgramName == "Gold Medi-II")
                            {
                                String strSqlQueryForIndividualStartDate = "select [dbo].[contact].[Membership_IND_Start_date__c] from [dbo].[contact] " +
                                                                           "where [dbo].[contact].[Individual_ID__c] = @IndividualId";

                                SqlCommand cmdQueryForIndividualStartDate = new SqlCommand(strSqlQueryForIndividualStartDate, connSalesforce);
                                cmdQueryForIndividualStartDate.CommandType = CommandType.Text;

                                cmdQueryForIndividualStartDate.Parameters.AddWithValue("@IndividualId", strIndividualId);

                                if (connSalesforce.State != ConnectionState.Closed)
                                {
                                    connSalesforce.Close();
                                    connSalesforce.Open();
                                }
                                else if (connSalesforce.State == ConnectionState.Closed) connSalesforce.Open();

                                Object objMembershipIndStartDate = cmdQueryForIndividualStartDate.ExecuteScalar();

                                if (connSalesforce.State == ConnectionState.Open) connSalesforce.Close();

                                DateTime MembershipIndStartDate = new DateTime();
                                if (objMembershipIndStartDate != null)
                                {
                                    MembershipIndStartDate = DateTime.Parse(objMembershipIndStartDate.ToString());
                                }

                                if (dtpBillDate.Value > MembershipIndStartDate.AddMonths(6))
                                {
                                    //String strSqlQueryForAnivDateForIndividualId = "select [dbo].[contact].[Aniv_Date], [dbo].[contact].[Membership_IND_Start_date__c] from [dbo].[contact] " +
                                    //                                               "where [dbo].[contact].[Individual_ID__c] = @IndividualId";

                                    //SqlCommand cmdQueryForAnivDateForIndividualId = new SqlCommand(strSqlQueryForAnivDateForIndividualId, connSalesforce);
                                    //cmdQueryForAnivDateForIndividualId.CommandType = CommandType.Text;

                                    //cmdQueryForAnivDateForIndividualId.Parameters.AddWithValue("@IndividualId", strIndividualId);

                                    //if (connSalesforce.State != ConnectionState.Closed)
                                    //{
                                    //    connSalesforce.Close();
                                    //    connSalesforce.Open();
                                    //}
                                    //else if (connSalesforce.State == ConnectionState.Closed) connSalesforce.Open();

                                    //DateTime? AnivDate = null;
                                    //DateTime? StartDate = null;

                                    //SqlDataReader rdrAnivDate = cmdQueryForAnivDateForIndividualId.ExecuteReader();
                                    //if (rdrAnivDate.HasRows)
                                    //{
                                    //    rdrAnivDate.Read();
                                    //    if (!rdrAnivDate.IsDBNull(0)) AnivDate = rdrAnivDate.GetDateTime(0);
                                    //    if (!rdrAnivDate.IsDBNull(1)) StartDate = rdrAnivDate.GetDateTime(1);
                                    //}
                                    //rdrAnivDate.Close();
                                    //if (connSalesforce.State == ConnectionState.Open) connSalesforce.Close();

                                    DateTime IndividualAnivDate = DateTime.Parse(txtAnivDate.Text);
                                    //if (AnivDate != null) IndividualAnivDate = AnivDate.Value;
                                    //else IndividualAnivDate = StartDate.Value;

                                    int nAnivYear = dtpBillDate.Value.Year;

                                    DateTime IndividualThisAnivDate = new DateTime(nAnivYear, IndividualAnivDate.Month, 1);
                                    DateTime IndividualLastAnivDate = new DateTime(nAnivYear - 1, IndividualAnivDate.Month, 1);

                                    String strSqlQueryForWellBeingIncidentsPerAnivYear = "select count([dbo].[tbl_incident].[IncidentNo]) from [dbo].[tbl_incident] " +
                                                                                         "inner join [dbo].[tbl_illness] on [dbo].[tbl_incident].[Illness_id] = [dbo].[tbl_illness].[Illness_Id] " +
                                                                                         "inner join [dbo].[tbl_medbill] on [dbo].[tbl_incident].[Incident_id] = [dbo].[tbl_medbill].[Incident_Id] " +
                                                                                         "where [dbo].[tbl_medbill].[Individual_Id] = @IndividualId and " +
                                                                                         "([dbo].[tbl_illness].[ICD_10_Id] = 'Z00.00' or [dbo].[tbl_illness].[ICD_10_Id] = 'Z00.012') and " +
                                                                                         "[dbo].[tbl_medbill].[BillDate] >= @LastAnivDate and " +
                                                                                         "[dbo].[tbl_medbill].[BillDate] < @ThisAnivDate";

                                    SqlCommand cmdQueryForWellBeingIncidentsPerAnivYear = new SqlCommand(strSqlQueryForWellBeingIncidentsPerAnivYear, connRN5);
                                    cmdQueryForWellBeingIncidentsPerAnivYear.CommandType = CommandType.Text;

                                    cmdQueryForWellBeingIncidentsPerAnivYear.Parameters.AddWithValue("@IndividualId", strIndividualId);
                                    cmdQueryForWellBeingIncidentsPerAnivYear.Parameters.AddWithValue("@LastAnivDate", IndividualLastAnivDate);
                                    cmdQueryForWellBeingIncidentsPerAnivYear.Parameters.AddWithValue("@ThisAnivDate", IndividualThisAnivDate);

                                    if (connRN5.State != ConnectionState.Closed)
                                    {
                                        connRN5.Close();
                                        connRN5.Open();
                                    }
                                    else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                                    Object objIncidentCount = cmdQueryForWellBeingIncidentsPerAnivYear.ExecuteScalar();
                                    if (connRN5.State == ConnectionState.Open) connRN5.Close();

                                    int nIncidentCount = Int32.Parse(objIncidentCount.ToString());

                                    if (nIncidentCount == 1)
                                    {
                                        String strSqlQueryForWellBeingIncidentId = "select [dbo].[tbl_incident].[Incident_id] from [dbo].[tbl_incident] " +
                                                                                   "inner join [dbo].[tbl_illness] on [dbo].[tbl_incident].[Illness_id] = [dbo].[tbl_illness].[Illness_Id] " +
                                                                                   "inner join [dbo].[tbl_medbill] on [dbo].[tbl_incident].[Incident_id] = [dbo].[tbl_medbill].[Incident_Id] " +
                                                                                   "where [dbo].[tbl_medbill].[Individual_Id] = @IndividualId and " +
                                                                                   "([dbo].[tbl_illness].[ICD_10_Id] = 'Z00.00' or [dbo].[tbl_illness].[ICD_10_Id] = 'Z00.012') and " +
                                                                                   "[dbo].[tbl_medbill].[BillDate] >= @LastAnivDate and " +
                                                                                   "[dbo].[tbl_medbill].[BillDate] < @ThisAnivDate";

                                        SqlCommand cmdQueryForWellBeingIncidentId = new SqlCommand(strSqlQueryForWellBeingIncidentId, connRN5);
                                        cmdQueryForWellBeingIncidentId.CommandType = CommandType.Text;

                                        cmdQueryForWellBeingIncidentId.Parameters.AddWithValue("@IndividualId", strIndividualId);
                                        cmdQueryForWellBeingIncidentId.Parameters.AddWithValue("@LastAnivDate", IndividualLastAnivDate);
                                        cmdQueryForWellBeingIncidentId.Parameters.AddWithValue("@ThisAnivDate", IndividualThisAnivDate);

                                        if (connRN5.State != ConnectionState.Closed)
                                        {
                                            connRN5.Close();
                                            connRN5.Open();
                                        }
                                        else if (connRN5.State == ConnectionState.Closed) connRN5.Open();

                                        Object objWellBeingIncidentId = cmdQueryForWellBeingIncidentId.ExecuteScalar();
                                        if (connRN5.State == ConnectionState.Open) connRN5.Close();

                                        if (objWellBeingIncidentId != null)
                                        {
                                            int nWellBeingIncidentId = Int32.Parse(objWellBeingIncidentId.ToString());

                                            String strSqlQueryForWellBeingTotalForIncident = "select sum([dbo].[tbl_medbill].[TotalSharedAmount]) from [dbo].[tbl_medbill] " +
                                                                                             "where [dbo].[tbl_medbill].[Incident_Id] = @IncidentId";

                                            SqlCommand cmdQueryForWellBeingTotalForIncident = new SqlCommand(strSqlQueryForWellBeingTotalForIncident, connRN5);
                                            cmdQueryForWellBeingTotalForIncident.CommandType = CommandType.Text;

                                            cmdQueryForWellBeingTotalForIncident.Parameters.AddWithValue("@IncidentId", nWellBeingIncidentId);

                                            if (connRN5.State != ConnectionState.Closed)
                                            {
                                                connRN5.Close();
                                                connRN5.Open();
                                            }
                                            else if (connRN5.State == ConnectionState.Closed) connRN5.Open();

                                            Object objWellBeingTotalForIncident = cmdQueryForWellBeingTotalForIncident.ExecuteScalar();
                                            if (connRN5.State == ConnectionState.Open) connRN5.Close();

                                            Decimal WellBeingTotalForIncident = Decimal.Parse(objWellBeingTotalForIncident.ToString());

                                            if (WellBeingTotalForIncident > 500)
                                            {
                                                // Set the well being care med bill ineligible strNewMedBillNo
                                                String strSqlUpdateMedBillWellBeingCareIneligible = "update [dbo].[tbl_medbill] set [dbo].[medbill].[BillStatus] = 3, " +
                                                                                                    "[dbo].[tbl_medbill].[WellBeingCare] = 0 " +
                                                                                                    "where [dbo].[tbl_medbill].[BillNo] = @WellBeingCareMedBill";

                                                SqlCommand cmdUpdateMedBillWellBeingCareIneligible = new SqlCommand(strSqlUpdateMedBillWellBeingCareIneligible, connRN5);
                                                cmdUpdateMedBillWellBeingCareIneligible.CommandType = CommandType.Text;

                                                cmdUpdateMedBillWellBeingCareIneligible.Parameters.AddWithValue("@WellBeingCareMedBill", strNewMedBillNo);

                                                if (connRN5.State != ConnectionState.Closed)
                                                {
                                                    connRN5.Close();
                                                    connRN5.Open();
                                                }
                                                else if (connRN5.State == ConnectionState.Closed) connRN5.Open();

                                                int nWellBeingMedBillUpdated = cmdUpdateMedBillWellBeingCareIneligible.ExecuteNonQuery();

                                                if (connRN5.State == ConnectionState.Open) connRN5.Close();

                                                if (nWellBeingMedBillUpdated == 0)
                                                {
                                                    MessageBox.Show("The well being med bill is not updated.", "Error");
                                                    return;
                                                }
                                            }
                                            else
                                            {
                                                // set the well being care med bill eligible
                                                String strSqlUpdateMedBillWellBeingCareEligible = "update [dbo].[tbl_medbill] set [dbo].[tbl_medbill].[BillStatus] = 2, " +
                                                                                                  "[dbo].[tbl_medbill].[WellBeingCare] = 1 " +
                                                                                                  "where [dbo].[tbl_medbill].[BillNo] = @WellBeingCareMedBill";

                                                SqlCommand cmdUpdateMedBillWellBeingCareEligible = new SqlCommand(strSqlUpdateMedBillWellBeingCareEligible, connRN5);
                                                cmdUpdateMedBillWellBeingCareEligible.CommandType = CommandType.Text;

                                                cmdUpdateMedBillWellBeingCareEligible.Parameters.AddWithValue("@WellBeingCareMedBill", strNewMedBillNo);

                                                if (connRN5.State != ConnectionState.Closed)
                                                {
                                                    connRN5.Close();
                                                    connRN5.Open();
                                                }
                                                else if (connRN5.State == ConnectionState.Closed) connRN5.Open();

                                                int nWellBeingMedBillUpdated = cmdUpdateMedBillWellBeingCareEligible.ExecuteNonQuery();

                                                if (connRN5.State == ConnectionState.Open) connRN5.Close();

                                                if (nWellBeingMedBillUpdated == 0)
                                                {
                                                    MessageBox.Show("The well being med bill is not updated.", "Error");
                                                    return;
                                                }
                                            }
                                        }
                                    }
                                    else if (nIncidentCount > 1)
                                    {
                                        // Ineligible for Well Being Care
                                        String strSqlUpdateMedBillWellBeingCareIneligible = "update [dbo].[tbl_medbill] set [dbo].[tbl_medbill].[BillStatus] = 3, " +
                                                                                            "[dbo].[tbl_medbill].[WellBeingCare] = 0 " +
                                                                                            "where [dbo].[tbl_medbill].[BillNo] = @WellBeingCareMedBill";

                                        SqlCommand cmdUpdateMedBillWellBeingCareIneligible = new SqlCommand(strSqlUpdateMedBillWellBeingCareIneligible, connRN5);
                                        cmdUpdateMedBillWellBeingCareIneligible.CommandType = CommandType.Text;

                                        cmdUpdateMedBillWellBeingCareIneligible.Parameters.AddWithValue("@WellBeingCareMedBill", strNewMedBillNo);

                                        if (connRN5.State != ConnectionState.Closed)
                                        {
                                            connRN5.Close();
                                            connRN5.Open();
                                        }
                                        else if (connRN5.State == ConnectionState.Closed) connRN5.Open();

                                        int nWellBeingMedBillUpdated = cmdUpdateMedBillWellBeingCareIneligible.ExecuteNonQuery();
                                        if (connRN5.State == ConnectionState.Open) connRN5.Close();

                                        if (nWellBeingMedBillUpdated == 0)
                                        {
                                            MessageBox.Show("The well being med bill is not updated.", "Error");
                                            return;
                                        }
                                    }
                                }
                            }
                        }

                        if (gvSettlementsInMedBill.Rows.Count > 0)
                        {
                            for (int i = 0; i < gvSettlementsInMedBill.Rows.Count; i++)
                            {

                                if (gvSettlementsInMedBill["SettlementTypeValue", i]?.Value == null)
                                {
                                    MessageBox.Show("You have to select a Settlement Type.", "Alert");
                                    return;
                                }

                                Decimal result, SettlementAmount;
                                if (Decimal.TryParse(gvSettlementsInMedBill["SettlementAmount", i]?.Value?.ToString(), NumberStyles.Currency, new CultureInfo("en-US"), out result)) SettlementAmount = result;
                                else
                                {
                                    MessageBox.Show("You have to enter decimal value in Settlement Amount field in Settlement " + gvSettlementsInMedBill[1, i]?.Value?.ToString(), "Alert");
                                    return;
                                }

                                result = 0;
                                Decimal PersonalResponsibilityAmount = 0;

                                if ((gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "Self Pay Discount") ||
                                    (gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "3rd Party Discount") ||
                                    (gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "Member Payment"))
                                {
                                    //if (gvSettlementsInMedBill["PersonalResponsibility", i]?.Value?.ToString() != String.Empty)
                                    if (gvSettlementsInMedBill["PersonalResponsibility", i]?.Value != null)
                                    {
                                        if (Decimal.TryParse(gvSettlementsInMedBill["PersonalResponsibility", i]?.Value?.ToString(), NumberStyles.Currency, new CultureInfo("en-US"), out result)) PersonalResponsibilityAmount = result;
                                        else
                                        {
                                            MessageBox.Show("Invalid Personal Responsibility.", "Error");
                                            return;
                                        }
                                    }
                                }

                                result = 0;
                                Decimal AllowedAmount = 0;
                                if (gvSettlementsInMedBill["AllowedAmount", i]?.Value?.ToString() != null)
                                {
                                    if (Decimal.TryParse(gvSettlementsInMedBill["AllowedAmount", i]?.Value?.ToString(), NumberStyles.Currency, new CultureInfo("en-US"), out result)) AllowedAmount = result;
                                    else
                                    {
                                        MessageBox.Show("You have to enter decimal value in Allowed Amount field in Settlement " + gvSettlementsInMedBill[1, i]?.Value?.ToString(), "Alert");
                                        return;
                                    }
                                }
                            }

                            ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

                            Decimal MedBillAmount = Decimal.Parse(txtMedBillAmount.Text.Trim(), NumberStyles.Currency, new CultureInfo("en-US"));
                            Decimal SettlementAmountTotal = 0;

                            for (int i = 0; i < gvSettlementsInMedBill.Rows.Count; i++)
                            {
                                Decimal result = 0;
                                Decimal SettlementAmount = 0;
                                if (gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "Self Pay Discount" ||
                                    gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "3rd Party Discount" ||
                                    gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "Member Payment" ||
                                    gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "CMM Provider Payment" ||
                                    gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "CMM Discount" ||
                                    gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "CMM Member Reimbursement" ||
                                    gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "Ineligible")
                                {
                                    if (Decimal.TryParse(gvSettlementsInMedBill["SettlementAmount", i]?.Value?.ToString(), NumberStyles.Currency, new CultureInfo("en-US"), out result))
                                    {
                                        SettlementAmount = result;
                                        SettlementAmountTotal += SettlementAmount;
                                        if (SettlementAmountTotal > MedBillAmount)
                                        {
                                            MessageBox.Show("The total of settlement amount exceeds medical bill amount.");
                                            return;
                                        }
                                    }
                                }
                            }

                            /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                            Boolean bError = false;

                            for (int i = 0; i < gvSettlementsInMedBill.Rows.Count; i++)
                            {
                                String SettlementName = gvSettlementsInMedBill["SettlementName", i].Value.ToString();

                                // Check whether or not the settlement is already in data base
                                String strSqlQueryForSettlementName = "select [dbo].[tbl_settlement].[Name] from [dbo].[tbl_settlement] where [dbo].[tbl_settlement].[Name] = @Settlement";

                                SqlCommand cmdQueryForSettlementName = new SqlCommand(strSqlQueryForSettlementName, connRN5);
                                cmdQueryForSettlementName.CommandType = CommandType.Text;

                                cmdQueryForSettlementName.Parameters.AddWithValue("@Settlement", SettlementName);

                                if (connRN5.State != ConnectionState.Closed)
                                {
                                    connRN5.Close();
                                    connRN5.Open();
                                }
                                else if (connRN5.State != ConnectionState.Open) connRN5.Open();
                                /////////////////////////////////////////////////////////////////////

                                Object objResultSettlementName = cmdQueryForSettlementName.ExecuteScalar();
                                if (connRN5.State != ConnectionState.Closed) connRN5.Close();

                                if (objResultSettlementName == null)   // new settlement: save the settlement by using insert sql statement
                                {

                                    String strSqlCreateNewSettlement = "insert into [dbo].[tbl_settlement] (IsDeleted, Name, CreateDate, CreateByID, LastModifiedDate, LastModifiedByID, SystemModifiedStamp, " +
                                                                        "LastActivityDate, LastViewedDate, MedicalBillID, " +
                                                                        "SettlementType, Amount, PersonalResponsibilityCredit, CMMPaymentMethod, " +
                                                                        "CheckNo, CheckDate, CheckReconciled, ACH_Number, ACH_Date, ACH_Reconciled, CMMCreditCard, CMMCreditCardPaidDate, CC_Reconciled, " +
                                                                        "AllowedAmount, Notes, Approved, ApprovedDate, IneligibleReason) " +
                                                                        "values (0, @SettlementName, @CreateDate, @CreateByID, @LastModifiedDate, @LastModifiedByID, @SystemModifiedStamp, " +
                                                                        "@LastActivityDate, @LastViewedDate, @MedBillID, " +
                                                                        "@SettlementType, @SettlementAmount, @PersonalResponsibilityCredit, @CMMPaymentMethod, " +
                                                                        "@CheckNo, @CheckDate, @IsCheckReconciled, @ACH_Number, @ACH_Date, @IsACH_Reconciled, @CMMCreditCard, @CMMCreditCardPaidDate, @IsCC_Reconciled, " +
                                                                        "@AllowedAmount, @Notes, @IsApproved, @ApprovedDate, @IneligibleReason)";

                                    SqlCommand cmdInsertNewSettlement = new SqlCommand(strSqlCreateNewSettlement, connRN5);
                                    cmdInsertNewSettlement.CommandType = CommandType.Text;

                                    String NewSettlementName = gvSettlementsInMedBill["SettlementName", i].Value.ToString();
                                    String NewSettlementType = String.Empty;
                                    if (gvSettlementsInMedBill["SettlementTypeValue", i].Value != null) NewSettlementType = gvSettlementsInMedBill["SettlementTypeValue", i].Value.ToString();
                                    int nNewSettlementType = 0;
                                    for (int j = 0; j < lstSettlementType.Count; j++)
                                    {
                                        if (NewSettlementType == lstSettlementType[j].SettlementTypeValue) nNewSettlementType = lstSettlementType[j].SettlementTypeCode;
                                    }
                                    Decimal result = 0;
                                    Decimal SettlementAmount = 0;
                                    if (Decimal.TryParse(gvSettlementsInMedBill["SettlementAmount", i]?.Value?.ToString(), NumberStyles.Currency, new CultureInfo("en-US"), out result))
                                    {
                                        SettlementAmount = result;
                                        cmdInsertNewSettlement.Parameters.AddWithValue("@SettlementAmount", SettlementAmount);
                                    }

                                    result = 0;
                                    Decimal PersonalResponsibilityAmount = 0;
                                    if (Decimal.TryParse(gvSettlementsInMedBill["PersonalResponsibility", i]?.Value?.ToString(), NumberStyles.Currency, new CultureInfo("en-US"), out result)) PersonalResponsibilityAmount = result;
                                    cmdInsertNewSettlement.Parameters.AddWithValue("@PersonalResponsibilityCredit", PersonalResponsibilityAmount);

                                    int NewIsApproved = 0;
                                    if (gvSettlementsInMedBill["Approved", i]?.Value != null)
                                    {
                                        if ((Boolean)gvSettlementsInMedBill["Approved", i]?.Value == true) NewIsApproved = 1;
                                    }

                                    //    if (DateTime.TryParse(gvSettlementsInMedBill["ApprovedDate", i]?.Value.ToString(), out resultApprovedDate))
                                    //        NewApprovedDate = resultApprovedDate;

                                    DateTime? NewApprovedDate = null;
                                    if (gvSettlementsInMedBill["ApprovedDate", i]?.Value != null)
                                    {
                                        //NewApprovedDate = DateTime.Parse(gvSettlementsInMedBill["ApprovedDate", i].Value.ToString());
                                        DateTime resultApprovedDate;
                                        if (DateTime.TryParse(gvSettlementsInMedBill["ApprovedDate", i]?.Value?.ToString(), out resultApprovedDate))
                                            NewApprovedDate = resultApprovedDate;
                                    }

                                    String NewCMMPaymentMethod = String.Empty;
                                    if (gvSettlementsInMedBill["PaymentMethod", i]?.Value != null) NewCMMPaymentMethod = gvSettlementsInMedBill["PaymentMethod", i].Value.ToString();
                                    int nNewCMMPaymentMethod = 0;
                                    for (int j = 0; j < lstPaymentMethod.Count; j++)
                                    {
                                        if (NewCMMPaymentMethod == lstPaymentMethod[j].PaymentMethodValue) nNewCMMPaymentMethod = lstPaymentMethod[j].PaymentMethodId;
                                    }

                                    String NewCheckNo = String.Empty;
                                    DateTime? NewCheckDate = null;
                                    int NewCheckReconciled = 0;
                                    if (gvSettlementsInMedBill["PaymentMethod", i]?.Value?.ToString() == "Check")
                                    {
                                        if (gvSettlementsInMedBill["CheckNo", i].Value != null) NewCheckNo = gvSettlementsInMedBill["CheckNo", i].Value.ToString();
                                        if (gvSettlementsInMedBill["PaymentDate", i].Value != null) NewCheckDate = DateTime.Parse(gvSettlementsInMedBill["PaymentDate", i].Value.ToString());
                                        if (gvSettlementsInMedBill["Reconciled", i].Value != null) NewCheckReconciled = 1;
                                    }

                                    String NewACH_Number = String.Empty;
                                    DateTime? NewACH_Date = null;
                                    int NewACH_Reconciled = 0;
                                    if (gvSettlementsInMedBill["PaymentMethod", i]?.Value?.ToString() == "ACH/Banking")
                                    {
                                        if (gvSettlementsInMedBill["ACHNo", i].Value != null) NewACH_Number = gvSettlementsInMedBill["ACHNo", i].Value.ToString();
                                        if (gvSettlementsInMedBill["PaymentDate", i].Value != null) NewACH_Date = DateTime.Parse(gvSettlementsInMedBill["PaymentDate", i].Value.ToString());
                                        if (gvSettlementsInMedBill["Reconciled", i].Value != null) NewACH_Reconciled = 1;
                                    }

                                    int nCMMCreditCard = 0;
                                    DateTime? NewCreditCardPaidDate = null;
                                    int NewIsCCReconciled = 0;

                                    if (gvSettlementsInMedBill["PaymentMethod", i]?.Value?.ToString() == "Credit Card")
                                    {
                                        String CreditCard = gvSettlementsInMedBill[13, i]?.Value?.ToString();
                                        for (int j = 0; j < lstCreditCardInfo.Count; j++)
                                        {
                                            if (CreditCard == lstCreditCardInfo[j].CreditCardNo)
                                            {
                                                nCMMCreditCard = lstCreditCardInfo[j].CreditCardId;
                                            }
                                        }
                                        if (gvSettlementsInMedBill["PaymentDate", i].Value != null)
                                            NewCreditCardPaidDate = DateTime.Parse(gvSettlementsInMedBill["PaymentDate", i].Value.ToString());
                                        if (gvSettlementsInMedBill["Reconciled", i].Value != null) NewIsCCReconciled = 1;
                                    }

                                    Decimal NewAllowedAmount = 0;
                                    if (gvSettlementsInMedBill["AllowedAmount", i].Value != null) NewAllowedAmount = Decimal.Parse(gvSettlementsInMedBill["AllowedAmount", i].Value.ToString());
                                    String NewNote = String.Empty;
                                    if (gvSettlementsInMedBill["Note", i].Value != null) NewNote = gvSettlementsInMedBill["Note", i].Value.ToString();

                                    cmdInsertNewSettlement.Parameters.AddWithValue("@SettlementName", NewSettlementName);
                                    cmdInsertNewSettlement.Parameters.AddWithValue("@CreateDate", DateTime.Today);
                                    cmdInsertNewSettlement.Parameters.AddWithValue("@CreateByID", nLoggedUserId);
                                    cmdInsertNewSettlement.Parameters.AddWithValue("@LastModifiedDate", DateTime.Today);
                                    cmdInsertNewSettlement.Parameters.AddWithValue("@LastModifiedByID", nLoggedUserId);
                                    cmdInsertNewSettlement.Parameters.AddWithValue("@SystemModifiedStamp", DateTime.Today);
                                    cmdInsertNewSettlement.Parameters.AddWithValue("@LastActivityDate", DateTime.Today);
                                    cmdInsertNewSettlement.Parameters.AddWithValue("@LastViewedDate", DateTime.Today);
                                    cmdInsertNewSettlement.Parameters.AddWithValue("@MedBillID", txtMedBillNo.Text.Trim());
                                    cmdInsertNewSettlement.Parameters.AddWithValue("@SettlementType", nNewSettlementType);

                                    cmdInsertNewSettlement.Parameters.AddWithValue("@IsApproved", NewIsApproved);

                                    if (NewApprovedDate != null) cmdInsertNewSettlement.Parameters.AddWithValue("@ApprovedDate", NewApprovedDate);
                                    else cmdInsertNewSettlement.Parameters.AddWithValue("@ApprovedDate", DBNull.Value);

                                    cmdInsertNewSettlement.Parameters.AddWithValue("@CMMPaymentMethod", nNewCMMPaymentMethod);

                                    if (NewCheckNo != String.Empty) cmdInsertNewSettlement.Parameters.AddWithValue("@CheckNo", NewCheckNo);
                                    else cmdInsertNewSettlement.Parameters.AddWithValue("@CheckNo", DBNull.Value);

                                    if (NewCheckDate != null) cmdInsertNewSettlement.Parameters.AddWithValue("@CheckDate", NewCheckDate);
                                    else cmdInsertNewSettlement.Parameters.AddWithValue("@CheckDate", DBNull.Value);

                                    cmdInsertNewSettlement.Parameters.AddWithValue("@IsCheckReconciled", NewCheckReconciled);

                                    if (NewACH_Number != null) cmdInsertNewSettlement.Parameters.AddWithValue("@ACH_Number", NewACH_Number);
                                    else cmdInsertNewSettlement.Parameters.AddWithValue("@ACH_Number", DBNull.Value);

                                    if (NewACH_Date != null) cmdInsertNewSettlement.Parameters.AddWithValue("@ACH_Date", NewACH_Date);
                                    else cmdInsertNewSettlement.Parameters.AddWithValue("@ACH_Date", DBNull.Value);

                                    cmdInsertNewSettlement.Parameters.AddWithValue("@IsACH_Reconciled", NewACH_Reconciled);
                                    cmdInsertNewSettlement.Parameters.AddWithValue("@CMMCreditCard", nCMMCreditCard);

                                    if (NewCreditCardPaidDate != null) cmdInsertNewSettlement.Parameters.AddWithValue("@CMMCreditCardPaidDate", NewCreditCardPaidDate);
                                    else cmdInsertNewSettlement.Parameters.AddWithValue("@CMMCreditCardPaidDate", DBNull.Value);

                                    cmdInsertNewSettlement.Parameters.AddWithValue("@IsCC_Reconciled", NewIsCCReconciled);
                                    cmdInsertNewSettlement.Parameters.AddWithValue("@AllowedAmount", NewAllowedAmount);

                                    if (NewNote != null) cmdInsertNewSettlement.Parameters.AddWithValue("@Notes", NewNote);
                                    else cmdInsertNewSettlement.Parameters.AddWithValue("@Notes", DBNull.Value);

                                    int nIneligibleReason = 0;
                                    for (int j = 0; j < dicIneligibleReason.Count; j++)
                                    {
                                        if (gvSettlementsInMedBill["IneligibleReason", i]?.Value?.ToString() == dicIneligibleReason[j]) nIneligibleReason = j;
                                    }
                                    cmdInsertNewSettlement.Parameters.AddWithValue("@IneligibleReason", nIneligibleReason);

                                    if (connRN5.State != ConnectionState.Closed)
                                    {
                                        connRN5.Close();
                                        connRN5.Open();
                                    }
                                    else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                                    int nSettlementInserted = cmdInsertNewSettlement.ExecuteNonQuery();
                                    if (connRN5.State != ConnectionState.Closed) connRN5.Close();

                                    if (nSettlementInserted == 0) bError = true;

                                }
                                else  // the settlement with the name exist, update the settlement
                                {
                                    String UpdateSettlementName = objResultSettlementName.ToString();
                                    String UpdateMedBill = txtMedBillNo.Text.Trim();

                                    String strSqlUpdateSettlement = "update [dbo].[tbl_settlement] set [dbo].[tbl_settlement].[LastModifiedDate] = @LastModifiedDate, " +
                                                                    "[dbo].[tbl_settlement].[LastModifiedByID] = @LastModifiedByID, " +
                                                                    "[dbo].[tbl_settlement].[LastActivityDate] = @LastActivityDate, " +
                                                                    "[dbo].[tbl_settlement].[SettlementType] = @SettlementType, " +
                                                                    "[dbo].[tbl_settlement].[Amount] = @SettlementAmount, " +
                                                                    "[dbo].[tbl_settlement].[PersonalResponsibilityCredit] = @PersonalResponsibilityCredit, " +
                                                                    "[dbo].[tbl_settlement].[Approved] = @IsApproved, " +
                                                                    "[dbo].[tbl_settlement].[ApprovedDate] = @ApprovedDate, " +
                                                                    "[dbo].[tbl_settlement].[CMMPaymentMethod] = @CMMPaymentMethod, " +
                                                                    "[dbo].[tbl_settlement].[CheckNo] = @CheckNo, " +
                                                                    "[dbo].[tbl_settlement].[CheckDate] = @CheckDate, " +
                                                                    "[dbo].[tbl_settlement].[CheckReconciled] = @CheckReconciled, " +
                                                                    "[dbo].[tbl_settlement].[ACH_Number] = @ACH_Number, " +
                                                                    "[dbo].[tbl_settlement].[ACH_Date] = @ACH_Date, " +
                                                                    "[dbo].[tbl_settlement].[ACH_Reconciled] = @ACH_Reconciled, " +
                                                                    "[dbo].[tbl_settlement].[CMMCreditCard] = @CMMCreditCard, " +
                                                                    "[dbo].[tbl_settlement].[CMMCreditCardPaidDate] = @CMMCreditCardPaidDate, " +
                                                                    "[dbo].[tbl_settlement].[CC_Reconciled] = @CC_Reconciled, " +
                                                                    "[dbo].[tbl_settlement].[AllowedAmount] = @AllowedAmount, " +
                                                                    "[dbo].[tbl_settlement].[Notes] = @Note, " +
                                                                    "[dbo].[tbl_settlement].[IneligibleReason] = @IneligibleReason " +
                                                                    "where [dbo].[tbl_settlement].[Name] = @SettlementName and [dbo].[tbl_settlement].[MedicalBillID] = @MedBillName";

                                    int nSettlementType = 0;
                                    String strSettlementType = String.Empty;
                                    if (gvSettlementsInMedBill["SettlementTypeValue", i].Value != null) strSettlementType = gvSettlementsInMedBill["SettlementTypeValue", i].Value.ToString();
                                    for (int j = 0; j < lstSettlementType.Count; j++)
                                    {
                                        if (strSettlementType == lstSettlementType[j].SettlementTypeValue) nSettlementType = lstSettlementType[j].SettlementTypeCode;
                                    }

                                    Decimal SettlementAmount = 0;
                                    if (gvSettlementsInMedBill["SettlementAmount", i].Value != null)
                                    {
                                        SettlementAmount = Decimal.Parse(gvSettlementsInMedBill["SettlementAmount", i].Value.ToString(), NumberStyles.Currency);
                                    }

                                    Decimal PersonalResponsibilityAmt = 0;
                                    if (gvSettlementsInMedBill["PersonalResponsibility", i].Value != null)
                                    {
                                        PersonalResponsibilityAmt = Decimal.Parse(gvSettlementsInMedBill["PersonalResponsibility", i].Value.ToString(), NumberStyles.Currency);
                                    }

                                    // Payment method
                                    int nPaymentMethod = 0;
                                    String PaymentMethod = String.Empty;
                                    if (gvSettlementsInMedBill["PaymentMethod", i].Value != null)
                                        PaymentMethod = gvSettlementsInMedBill["PaymentMethod", i].Value.ToString();
                                    for (int j = 0; j < lstPaymentMethod.Count; j++)
                                    {
                                        if (PaymentMethod == lstPaymentMethod[j].PaymentMethodValue) nPaymentMethod = lstPaymentMethod[j].PaymentMethodId;
                                    }

                                    // Approved or not
                                    int nApproved = 0;
                                    if (gvSettlementsInMedBill["Approved", i].Value != null)
                                    {
                                        if ((Boolean)gvSettlementsInMedBill["Approved", i].Value) nApproved = 1;
                                    }

                                    //    if (DateTime.TryParse(gvSettlementsInMedBill["ApprovedDate", i]?.Value.ToString(), out resultApprovedDate))
                                    //        NewApprovedDate = resultApprovedDate;


                                    DateTime? ApprovedDate = null;
                                    if (gvSettlementsInMedBill["ApprovedDate", i]?.Value != null)
                                    {
                                        //ApprovedDate = DateTime.Parse(gvSettlementsInMedBill["ApprovedDate", i].Value.ToString());
                                        DateTime resultApprovedDate;

                                        if (DateTime.TryParse(gvSettlementsInMedBill["ApprovedDate", i]?.Value?.ToString(), out resultApprovedDate))
                                            ApprovedDate = resultApprovedDate;
                                    }


                                    String CheckNo = String.Empty;
                                    DateTime? CheckIssueDate = null;
                                    int nCheckReconciled = 0;

                                    String ACH_No = String.Empty;
                                    DateTime? ACH_Date = null;
                                    int nACHReconciled = 0;

                                    String CreditCard = String.Empty;
                                    int nCreditCard = 0;
                                    DateTime? CreditCardPaidDate = null;
                                    int nCCReconciled = 0;

                                    switch (PaymentMethod)
                                    {
                                        case "Check":
                                            if (gvSettlementsInMedBill["CheckNo", i].Value != null) CheckNo = gvSettlementsInMedBill["CheckNo", i].Value.ToString();
                                            if (gvSettlementsInMedBill["PaymentDate", i].Value != null)
                                            {
                                                if (gvSettlementsInMedBill["PaymentDate", i].Value.ToString() != String.Empty) CheckIssueDate = DateTime.Parse(gvSettlementsInMedBill["PaymentDate", i].Value.ToString());
                                            }
                                            Boolean bCheckReconciledResult = false;
                                            if (gvSettlementsInMedBill["Reconciled", i].Value != null)
                                            {
                                                if (Boolean.TryParse(gvSettlementsInMedBill["Reconciled", i].Value.ToString(), out bCheckReconciledResult))
                                                {
                                                    if (bCheckReconciledResult) nCheckReconciled = 1;
                                                }
                                            }
                                            break;
                                        case "ACH/Banking":
                                            if (gvSettlementsInMedBill["ACHNo", i].Value != null) ACH_No = gvSettlementsInMedBill["ACHNo", i].Value.ToString();
                                            if (gvSettlementsInMedBill["PaymentDate", i].Value != null)
                                            {
                                                if (gvSettlementsInMedBill["PaymentDate", i].Value.ToString() != String.Empty) ACH_Date = DateTime.Parse(gvSettlementsInMedBill["PaymentDate", i].Value.ToString());
                                            }
                                            Boolean bACHReconciledResult = false;
                                            if (gvSettlementsInMedBill["Reconciled", i].Value != null)
                                            {
                                                if (Boolean.TryParse(gvSettlementsInMedBill["Reconciled", i].Value.ToString(), out bACHReconciledResult))
                                                {
                                                    if (bACHReconciledResult) nACHReconciled = 1;
                                                }
                                            }
                                            break;
                                        case "Credit Card":
                                            if (gvSettlementsInMedBill["CreditCard", i].Value != null) CreditCard = gvSettlementsInMedBill["CreditCard", i].Value.ToString();
                                            for (int j = 0; j < lstCreditCardInfo.Count; j++)
                                            {
                                                if (CreditCard == lstCreditCardInfo[j].CreditCardNo) nCreditCard = lstCreditCardInfo[j].CreditCardId;
                                            }
                                            if (gvSettlementsInMedBill["PaymentDate", i].Value != null)
                                            {
                                                if (gvSettlementsInMedBill["PaymentDate", i].Value.ToString() != String.Empty)
                                                    CreditCardPaidDate = DateTime.Parse(gvSettlementsInMedBill["PaymentDate", i].Value.ToString());
                                            }
                                            Boolean bCCReconciledResult = false;
                                            if (gvSettlementsInMedBill[15, i].Value != null)
                                            {
                                                if (Boolean.TryParse(gvSettlementsInMedBill["Reconciled", i].Value.ToString(), out bCCReconciledResult))
                                                {
                                                    if (bCCReconciledResult) nCCReconciled = 1;
                                                }
                                            }
                                            break;
                                    }

                                    // Allowed Amount
                                    Decimal AllowedAmount = 0;
                                    if (gvSettlementsInMedBill["AllowedAmount", i].Value != null)
                                    {
                                        AllowedAmount = Decimal.Parse(gvSettlementsInMedBill["AllowedAmount", i].Value.ToString(), NumberStyles.Currency);
                                    }

                                    // Note
                                    String Note = String.Empty;
                                    if (gvSettlementsInMedBill["Note", i].Value != null) Note = gvSettlementsInMedBill["Note", i].Value.ToString();



                                    SqlCommand cmdUpdateSettlement = new SqlCommand(strSqlUpdateSettlement, connRN5);
                                    cmdUpdateSettlement.CommandType = CommandType.Text;

                                    cmdUpdateSettlement.Parameters.AddWithValue("@LastModifiedDate", DateTime.Today);
                                    cmdUpdateSettlement.Parameters.AddWithValue("@LastModifiedByID", nLoggedUserId);
                                    cmdUpdateSettlement.Parameters.AddWithValue("@LastActivityDate", DateTime.Today);
                                    cmdUpdateSettlement.Parameters.AddWithValue("@SettlementType", nSettlementType);


                                    cmdUpdateSettlement.Parameters.AddWithValue("@SettlementAmount", SettlementAmount);
                                    cmdUpdateSettlement.Parameters.AddWithValue("@PersonalResponsibilityCredit", PersonalResponsibilityAmt);

                                    cmdUpdateSettlement.Parameters.AddWithValue("@IsApproved", nApproved);
                                    if (ApprovedDate != null) cmdUpdateSettlement.Parameters.AddWithValue("@ApprovedDate", ApprovedDate);
                                    else cmdUpdateSettlement.Parameters.AddWithValue("@ApprovedDate", DBNull.Value);

                                    cmdUpdateSettlement.Parameters.AddWithValue("@CMMPaymentMethod", nPaymentMethod);

                                    if (CheckNo != String.Empty) cmdUpdateSettlement.Parameters.AddWithValue("@CheckNo", CheckNo);
                                    else cmdUpdateSettlement.Parameters.AddWithValue("@CheckNo", DBNull.Value);

                                    if (CheckIssueDate != null) cmdUpdateSettlement.Parameters.AddWithValue("@CheckDate", CheckIssueDate);
                                    else cmdUpdateSettlement.Parameters.AddWithValue("@CheckDate", DBNull.Value);

                                    cmdUpdateSettlement.Parameters.AddWithValue("@CheckReconciled", nCheckReconciled);

                                    if (ACH_No != String.Empty) cmdUpdateSettlement.Parameters.AddWithValue("@ACH_Number", ACH_No);
                                    else cmdUpdateSettlement.Parameters.AddWithValue("@ACH_Number", DBNull.Value);

                                    if (ACH_Date != null) cmdUpdateSettlement.Parameters.AddWithValue("@ACH_Date", ACH_Date);
                                    else cmdUpdateSettlement.Parameters.AddWithValue("@ACH_Date", DBNull.Value);

                                    cmdUpdateSettlement.Parameters.AddWithValue("@ACH_Reconciled", nACHReconciled);
                                    cmdUpdateSettlement.Parameters.AddWithValue("@CMMCreditCard", nCreditCard);

                                    if (CreditCardPaidDate != null) cmdUpdateSettlement.Parameters.AddWithValue("@CMMCreditCardPaidDate", CreditCardPaidDate);
                                    else cmdUpdateSettlement.Parameters.AddWithValue("@CMMCreditCardPaidDate", DBNull.Value);
                                    cmdUpdateSettlement.Parameters.AddWithValue("@CC_Reconciled", nCCReconciled);
                                    cmdUpdateSettlement.Parameters.AddWithValue("@AllowedAmount", AllowedAmount);
                                    if (Note != String.Empty) cmdUpdateSettlement.Parameters.AddWithValue("@Note", Note);
                                    else cmdUpdateSettlement.Parameters.AddWithValue("@Note", DBNull.Value);

                                    cmdUpdateSettlement.Parameters.AddWithValue("@SettlementName", UpdateSettlementName);
                                    cmdUpdateSettlement.Parameters.AddWithValue("@MedBillName", UpdateMedBill);

                                    int nIneligibleReason = 0;
                                    for (int j = 0; j < dicIneligibleReason.Count; j++)
                                    {
                                        if (gvSettlementsInMedBill["IneligibleReason", i]?.Value?.ToString() == dicIneligibleReason[j]) nIneligibleReason = j;
                                    }
                                    cmdUpdateSettlement.Parameters.AddWithValue("@IneligibleReason", nIneligibleReason);

                                    if (connRN5.State != ConnectionState.Closed)
                                    {
                                        connRN5.Close();
                                        connRN5.Open();
                                    }
                                    else if (connRN5.State == ConnectionState.Closed) connRN5.Open();

                                    int nSettlmentsUpdated = cmdUpdateSettlement.ExecuteNonQuery();
                                    if (connRN5.State != ConnectionState.Closed) connRN5.Close();

                                    if (nSettlmentsUpdated == 0) bError = true;
                                }
                            }

                            ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

                            for (int i = 0; i < gvSettlementsInMedBill.Rows.Count; i++)
                            {
                                if (gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() != "Ineligible")
                                {
                                    gvSettlementsInMedBill["IneligibleReason", i].Value = null;
                                    gvSettlementsInMedBill["IneligibleReason", i].ReadOnly = true;
                                }
                            }

                            if (bError == false)
                            {
                                MessageBox.Show("Settlements have been saved.", "Info");
                            }
                            else if (bError == true)
                            {
                                MessageBox.Show("Some of settlments have not been saved.", "Error");
                                //return;
                            }
                        }
                        // prepare settlement gv
                        //MedBillNo

                        String strSqlQueryForSettlement = "select [dbo].[tbl_settlement].[Name], [dbo].[tbl_settlement_type_code].[SettlementTypeValue], [dbo].[tbl_settlement].[Amount], " +
                                  "[dbo].[tbl_settlement].[PersonalResponsibilityCredit], [dbo].[tbl_payment_method].[PaymentMethod_Value], " +
                                  "[dbo].[tbl_settlement].[Approved], [dbo].[tbl_settlement].[ApprovedDate], " +
                                  "[dbo].[tbl_settlement].[CheckNo], [dbo].[tbl_settlement].[CheckDate], [dbo].[tbl_settlement].[CheckReconciled], " +
                                  "[dbo].[tbl_settlement].[ACH_Number], [dbo].[tbl_settlement].[ACH_Date], [dbo].[tbl_settlement].[ACH_Reconciled], " +
                                  "[dbo].[tbl_Credit_Card__c].[Name], [dbo].[tbl_settlement].[CMMCreditCardPaidDate], [dbo].[tbl_settlement].[CC_Reconciled], " +
                                  "[dbo].[tbl_settlement].[AllowedAmount], [dbo].[tbl_settlement].[IneligibleReason], " +
                                  "[dbo].[tbl_settlement].[Notes] " +
                                  "from [dbo].[tbl_settlement] inner join [dbo].[tbl_settlement_type_code] " +
                                  "on [dbo].[tbl_settlement].[SettlementType] = [dbo].[tbl_settlement_type_code].[SettlementTypeCode] " +
                                  "inner join [dbo].[tbl_payment_method] on [dbo].[tbl_settlement].[CMMPaymentMethod] = [dbo].[tbl_payment_method].[PaymentMethod_Id] " +
                                  "inner join [dbo].[tbl_Credit_Card__c] on [dbo].[tbl_settlement].[CMMCreditCard] = [dbo].[tbl_Credit_Card__c].[CreditCard_Id]" +
                                  "where [dbo].[tbl_settlement].[MedicalBillID] = @MedBillNo and " +
                                  "[dbo].[tbl_settlement].[IsDeleted] = 0 " +
                                  "order by [dbo].[tbl_settlement].[Name]";

                        SqlCommand cmdQueryForSettlement = new SqlCommand(strSqlQueryForSettlement, connRN5);
                        cmdQueryForSettlement.CommandType = CommandType.Text;

                        cmdQueryForSettlement.Parameters.AddWithValue("@MedBillNo", strNewMedBillNo);

                        SqlDependency dependencySettlementInMedBill = new SqlDependency(cmdQueryForSettlement);
                        dependencySettlementInMedBill.OnChange += new OnChangeEventHandler(OnSettlementsInMedBillEditChange);

                        if (connRN5.State != ConnectionState.Closed)
                        {
                            connRN5.Close();
                            connRN5.Open();
                        }
                        else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                        SqlDataReader rdrSettlement = cmdQueryForSettlement.ExecuteReader();
                        gvSettlementsInMedBill.Rows.Clear();
                        if (rdrSettlement.HasRows)
                        {
                            while (rdrSettlement.Read())
                            {
                                DataGridViewRow row = new DataGridViewRow();
                                row.Cells.Add(new DataGridViewCheckBoxCell { Value = false });
                                if (!rdrSettlement.IsDBNull(0)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlement.GetString(0) });
                                if (!rdrSettlement.IsDBNull(1))
                                {
                                    DataGridViewComboBoxCell comboCellSettlementType = new DataGridViewComboBoxCell();

                                    for (int i = 0; i < lstSettlementType.Count; i++)
                                    {
                                        comboCellSettlementType.Items.Add(lstSettlementType[i].SettlementTypeValue);
                                    }
                                    for (int i = 0; i < comboCellSettlementType.Items.Count; i++)
                                    {
                                        if (rdrSettlement.GetString(1) == comboCellSettlementType.Items[i].ToString())
                                            comboCellSettlementType.Value = comboCellSettlementType.Items[i];
                                    }

                                    row.Cells.Add(comboCellSettlementType);
                                }
                                else
                                {
                                    DataGridViewComboBoxCell comboCellSettlementType = new DataGridViewComboBoxCell();
                                    for (int i = 0; i < lstSettlementType.Count; i++)
                                    {
                                        comboCellSettlementType.Items.Add(lstSettlementType[i].SettlementTypeValue);
                                    }

                                    for (int i = 0; i < comboCellSettlementType.Items.Count; i++)
                                    {
                                        if (rdrSettlement.GetString(1) == comboCellSettlementType.Items[i].ToString())
                                            comboCellSettlementType.Value = comboCellSettlementType.Items[i];
                                    }

                                    row.Cells.Add(comboCellSettlementType);
                                }

                                if (!rdrSettlement.IsDBNull(2)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlement.GetDecimal(2).ToString("C") });
                                else
                                {
                                    Decimal Zero = 0;
                                    row.Cells.Add(new DataGridViewTextBoxCell { Value = Zero.ToString("C") });
                                }


                                if (!rdrSettlement.IsDBNull(3)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlement.GetDecimal(3).ToString("C") });
                                else
                                {
                                    Decimal Zero = 0;
                                    row.Cells.Add(new DataGridViewTextBoxCell { Value = Zero.ToString("C") });
                                }

                                if (!rdrSettlement.IsDBNull(4))
                                {
                                    DataGridViewComboBoxCell comboCellPaymentMethod = new DataGridViewComboBoxCell();

                                    for (int i = 0; i < lstPaymentMethod.Count; i++)
                                    {
                                        if (lstPaymentMethod[i].PaymentMethodValue != null) comboCellPaymentMethod.Items.Add(lstPaymentMethod[i].PaymentMethodValue);
                                        else comboCellPaymentMethod.Items.Add(String.Empty);
                                    }

                                    for (int i = 0; i < comboCellPaymentMethod.Items.Count; i++)
                                    {
                                        if (rdrSettlement.GetString(4) == comboCellPaymentMethod.Items[i].ToString())
                                            comboCellPaymentMethod.Value = comboCellPaymentMethod.Items[i];
                                    }

                                    row.Cells.Add(comboCellPaymentMethod);
                                }
                                else
                                {
                                    DataGridViewComboBoxCell comboCellPaymentMethod = new DataGridViewComboBoxCell();

                                    for (int i = 0; i < lstPaymentMethod.Count; i++)
                                    {
                                        if (lstPaymentMethod[i].PaymentMethodValue != null) comboCellPaymentMethod.Items.Add(lstPaymentMethod[i].PaymentMethodValue);
                                        else comboCellPaymentMethod.Items.Add(String.Empty);
                                    }

                                    for (int i = 0; i < comboCellPaymentMethod.Items.Count; i++)
                                    {
                                        if ((!rdrSettlement.IsDBNull(4)) && comboCellPaymentMethod.Items[i] != null)
                                        {
                                            if (rdrSettlement.GetString(4) == comboCellPaymentMethod.Items[i].ToString())
                                                comboCellPaymentMethod.Value = comboCellPaymentMethod.Items[i];
                                        }
                                        else comboCellPaymentMethod.Value = null;
                                    }

                                    row.Cells.Add(comboCellPaymentMethod);

                                }

                                if (!rdrSettlement.IsDBNull(5))
                                {

                                    DataGridViewCheckBoxCell approvedCell = new DataGridViewCheckBoxCell();
                                    approvedCell.Value = rdrSettlement.GetBoolean(5);
                                    approvedCell.Style.Alignment = DataGridViewContentAlignment.MiddleCenter;
                                    row.Cells.Add(approvedCell);
                                }
                                else
                                {
                                    DataGridViewCheckBoxCell approvedCell = new DataGridViewCheckBoxCell();
                                    approvedCell.Value = false;
                                    approvedCell.Style.Alignment = DataGridViewContentAlignment.MiddleCenter;
                                    row.Cells.Add(approvedCell);
                                }

                                if (!rdrSettlement.IsDBNull(6)) row.Cells.Add(new CalendarCell { Value = DateTime.Parse(rdrSettlement.GetDateTime(6).ToString("MM/dd/yyyy")) });
                                else row.Cells.Add(new CalendarCell { Value = null });

                                // Payment information
                                if (!rdrSettlement.IsDBNull(4))
                                {
                                    String strPaymentMethod = rdrSettlement.GetString(4);

                                    switch (strPaymentMethod)
                                    {
                                        case "Check":
                                            if (!rdrSettlement.IsDBNull(7)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlement.GetString(7) });
                                            else row.Cells.Add(new DataGridViewTextBoxCell { Value = null });
                                            row.Cells.Add(new DataGridViewTextBoxCell { Value = null });
                                            DataGridViewComboBoxCell comboCellCreditCardNoneForCheck = new DataGridViewComboBoxCell();
                                            for (int i = 0; i < lstCreditCardInfo.Count; i++)
                                            {
                                                if (lstCreditCardInfo[i].CreditCardNo != null) comboCellCreditCardNoneForCheck.Items.Add(lstCreditCardInfo[i].CreditCardNo);
                                                else comboCellCreditCardNoneForCheck.Items.Add(String.Empty);
                                            }
                                            row.Cells.Add(comboCellCreditCardNoneForCheck);
                                            if (!rdrSettlement.IsDBNull(8)) row.Cells.Add(new CalendarCell { Value = DateTime.Parse(rdrSettlement.GetDateTime(8).ToString("MM/dd/yyyy")) });
                                            else row.Cells.Add(new CalendarCell { Value = String.Empty });
                                            if (!rdrSettlement.IsDBNull(9)) row.Cells.Add(new DataGridViewCheckBoxCell { Value = rdrSettlement.GetBoolean(9) });
                                            else row.Cells.Add(new DataGridViewCheckBoxCell { Value = false });
                                            break;
                                        case "ACH/Banking":
                                            row.Cells.Add(new DataGridViewTextBoxCell { Value = null });
                                            if (!rdrSettlement.IsDBNull(10)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlement.GetString(10) });
                                            else row.Cells.Add(new DataGridViewTextBoxCell { Value = null });
                                            DataGridViewComboBoxCell comboCellCreditCardNoneForACH = new DataGridViewComboBoxCell();
                                            for (int i = 0; i < lstCreditCardInfo.Count; i++)
                                            {
                                                if (lstCreditCardInfo[i].CreditCardNo != null)
                                                    comboCellCreditCardNoneForACH.Items.Add(lstCreditCardInfo[i].CreditCardNo);
                                                else comboCellCreditCardNoneForACH.Items.Add(String.Empty);
                                            }
                                            row.Cells.Add(comboCellCreditCardNoneForACH);
                                            if (!rdrSettlement.IsDBNull(11)) row.Cells.Add(new CalendarCell { Value = DateTime.Parse(rdrSettlement.GetDateTime(11).ToString("MM/dd/yyyy")) });
                                            else row.Cells.Add(new CalendarCell { Value = String.Empty });
                                            if (!rdrSettlement.IsDBNull(12)) row.Cells.Add(new DataGridViewCheckBoxCell { Value = rdrSettlement.GetBoolean(12) });
                                            else row.Cells.Add(new DataGridViewCheckBoxCell { Value = false });
                                            break;
                                        case "Credit Card":
                                            row.Cells.Add(new DataGridViewTextBoxCell { Value = null });
                                            row.Cells.Add(new DataGridViewTextBoxCell { Value = null });
                                            DataGridViewComboBoxCell comboCellCreditCard = new DataGridViewComboBoxCell();
                                            if (!rdrSettlement.IsDBNull(13))
                                            {
                                                for (int i = 0; i < lstCreditCardInfo.Count; i++)
                                                {
                                                    if (lstCreditCardInfo[i].CreditCardNo != null) comboCellCreditCard.Items.Add(lstCreditCardInfo[i].CreditCardNo);
                                                    else comboCellCreditCard.Items.Add(String.Empty);
                                                }
                                                for (int i = 0; i < comboCellCreditCard.Items.Count; i++)
                                                {
                                                    if (rdrSettlement.GetString(13) == comboCellCreditCard.Items[i].ToString())
                                                        comboCellCreditCard.Value = comboCellCreditCard.Items[i];
                                                }
                                            }
                                            else
                                            {
                                                for (int i = 0; i < lstCreditCardInfo.Count; i++)
                                                {
                                                    if (lstCreditCardInfo[i].CreditCardNo != null) comboCellCreditCard.Items.Add(lstCreditCardInfo[i].CreditCardNo);
                                                    else comboCellCreditCard.Items.Add(String.Empty);
                                                }
                                                comboCellCreditCard.Value = String.Empty;
                                            }
                                            row.Cells.Add(comboCellCreditCard);
                                            if (!rdrSettlement.IsDBNull(14)) row.Cells.Add(new CalendarCell { Value = DateTime.Parse(rdrSettlement.GetDateTime(14).ToString("MM/dd/yyyy")) });
                                            else row.Cells.Add(new CalendarCell { Value = String.Empty });
                                            if (!rdrSettlement.IsDBNull(15)) row.Cells.Add(new DataGridViewCheckBoxCell { Value = rdrSettlement.GetBoolean(15) });
                                            else row.Cells.Add(new DataGridViewCheckBoxCell { Value = false });
                                            break;
                                        default:
                                            row.Cells.Add(new DataGridViewTextBoxCell { Value = null });
                                            row.Cells.Add(new DataGridViewTextBoxCell { Value = null });
                                            DataGridViewComboBoxCell comboCellCreditCardNone = new DataGridViewComboBoxCell();
                                            for (int i = 0; i < lstCreditCardInfo.Count; i++)
                                            {
                                                if (lstCreditCardInfo[i].CreditCardNo != null) comboCellCreditCardNone.Items.Add(lstCreditCardInfo[i].CreditCardNo);
                                                else comboCellCreditCardNone.Items.Add(String.Empty);
                                            }
                                            row.Cells.Add(comboCellCreditCardNone);
                                            row.Cells.Add(new CalendarCell { Value = null });
                                            row.Cells.Add(new DataGridViewCheckBoxCell { Value = null });
                                            break;
                                    }
                                }
                                else
                                {

                                    DataGridViewTextBoxCell txtCheckNoCell = new DataGridViewTextBoxCell();
                                    txtCheckNoCell.Value = null;
                                    row.Cells.Add(txtCheckNoCell);
                                    DataGridViewTextBoxCell txtACHNoCell = new DataGridViewTextBoxCell();
                                    txtACHNoCell.Value = null;
                                    row.Cells.Add(txtACHNoCell);
                                    DataGridViewComboBoxCell comboCreditCardCell = new DataGridViewComboBoxCell();
                                    for (int i = 0; i < lstCreditCardInfo.Count; i++)
                                    {
                                        if (lstCreditCardInfo[i].CreditCardNo != null) comboCreditCardCell.Items.Add(lstCreditCardInfo[i].CreditCardNo);
                                        else comboCreditCardCell.Items.Add(String.Empty);
                                    }
                                    row.Cells.Add(comboCreditCardCell);
                                    comboCreditCardCell.ReadOnly = true;
                                    CalendarCell calPaymentDate = new CalendarCell();
                                    calPaymentDate.Value = null;
                                    row.Cells.Add(calPaymentDate);
                                    DataGridViewCheckBoxCell chkReconciledCell = new DataGridViewCheckBoxCell();
                                    chkReconciledCell.Value = false;
                                    row.Cells.Add(chkReconciledCell);
                                }

                                if (!rdrSettlement.IsDBNull(16)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlement.GetDecimal(16).ToString("C") });
                                else row.Cells.Add(new DataGridViewTextBoxCell { Value = null });

                                if (!rdrSettlement.IsDBNull(17))
                                {
                                    if (dicIneligibleReason.Count > 0)
                                    {
                                        DataGridViewComboBoxCell comboCellIneligibleReason = new DataGridViewComboBoxCell();
                                        for (int i = 0; i < dicIneligibleReason.Count; i++)
                                        {
                                            comboCellIneligibleReason.Items.Add(dicIneligibleReason[i]);
                                        }
                                        comboCellIneligibleReason.Value = comboCellIneligibleReason.Items[rdrSettlement.GetInt32(17)];
                                        //comboIneligibleReason.Sorted = true;
                                        row.Cells.Add(comboCellIneligibleReason);
                                    }
                                }
                                else
                                {
                                    if (dicIneligibleReason.Count > 0)
                                    {
                                        DataGridViewComboBoxCell comboCellIneligibleReason = new DataGridViewComboBoxCell();
                                        for (int i = 0; i < dicIneligibleReason.Count; i++)
                                        {
                                            comboCellIneligibleReason.Items.Add(dicIneligibleReason[i]);
                                        }
                                        comboCellIneligibleReason.Value = comboCellIneligibleReason.Items[0];
                                        //comboIneligibleReason.Sorted = true;
                                        row.Cells.Add(comboCellIneligibleReason);
                                    }
                                }

                                if (!rdrSettlement.IsDBNull(18)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlement.GetString(18) });
                                else row.Cells.Add(new DataGridViewTextBoxCell { Value = null });

                                gvSettlementsInMedBill.Rows.Add(row);
                            }
                        }
                        rdrSettlement.Close();
                        if (connRN5.State != ConnectionState.Closed) connRN5.Close();

                        String strIllnessIdForIncidentSharedTotal = String.Empty;

                        if (txtMedBill_Illness.Text.Trim() != String.Empty)
                        {
                            String IllnessNo = txtMedBill_Illness.Text.Trim();

                            String strSqlQueryForIllnessId = "select [dbo].[tbl_illness].[Illness_Id] from [dbo].[tbl_illness] where [dbo].[tbl_illness].[IllnessNo] = @IllnessNo";

                            SqlCommand cmdQueryForIllnessId = new SqlCommand(strSqlQueryForIllnessId, connRN5);
                            cmdQueryForIllnessId.CommandType = CommandType.Text;

                            cmdQueryForIllnessId.Parameters.AddWithValue("@IllnessNo", txtMedBill_Illness.Text.Trim());

                            if (connRN5.State != ConnectionState.Closed)
                            {
                                connRN5.Close();
                                connRN5.Open();
                            }
                            else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                            Object objIllnessId = cmdQueryForIllnessId.ExecuteScalar();
                            if (connRN5.State != ConnectionState.Closed) connRN5.Close();

                            if (objIllnessId != null) strIllnessIdForIncidentSharedTotal = objIllnessId.ToString();
                            else
                            {
                                MessageBox.Show("No Illness Id for given Illness No", "Error");
                                return;
                            }
                        }

                        String strIncidentIdForIncidentSharedTotal = String.Empty;

                        if (txtMedBill_Incident.Text.Trim() != String.Empty)
                        {
                            String IncidentNo = txtMedBill_Incident.Text.Trim();

                            String strSqlQueryForIncidentId = "select [dbo].[tbl_incident].[Incident_id] from [dbo].[tbl_incident] where [dbo].[tbl_incident].[IncidentNo] = @IncidentNo";

                            SqlCommand cmdQueryForIncidentId = new SqlCommand(strSqlQueryForIncidentId, connRN5);
                            cmdQueryForIncidentId.CommandType = CommandType.Text;

                            cmdQueryForIncidentId.Parameters.AddWithValue("@IncidentNo", txtMedBill_Incident.Text.Trim());

                            if (connRN5.State != ConnectionState.Closed)
                            {
                                connRN5.Close();
                                connRN5.Open();
                            }
                            else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                            Object objIncidentId = cmdQueryForIncidentId.ExecuteScalar();
                            if (connRN5.State != ConnectionState.Closed) connRN5.Close();

                            if (objIncidentId != null) strIncidentIdForIncidentSharedTotal = objIncidentId.ToString();
                            else
                            {
                                MessageBox.Show("No Incident Id for given Incident No", "Error");
                                return;
                            }
                        }

                        // Calculate the Total Shared Amount in Medical Bill
                        String strSqlQueryForTotalSharedAmountSettlementInMedBill = "select sum([dbo].[tbl_settlement].[Amount]) from [dbo].[tbl_settlement] " +
                                                                                    "inner join [dbo].[tbl_settlement_type_code] " +
                                                                                    "on [dbo].[tbl_settlement].[SettlementType] = [dbo].[tbl_settlement_type_code].[SettlementTypeCode] " +
                                                                                    "where [dbo].[tbl_settlement].[MedicalBillID] = @MedBillId and " +
                                                                                    "[dbo].[tbl_settlement].[IsDeleted] = 0 and " +
                                                                                    "([dbo].[tbl_settlement_type_code].[SettlementTypeValue] = 'CMM Member Reimbursement' or " +
                                                                                    "[dbo].[tbl_settlement_type_code].[SettlementTypeValue] = 'CMM Provider Payment' or " +
                                                                                    "[dbo].[tbl_settlement_type_code].[SettlementTypeValue] = 'PR Reimbursement')";

                        SqlCommand cmdQueryForTotalSharedAmountInSettlemetsInMedBill = new SqlCommand(strSqlQueryForTotalSharedAmountSettlementInMedBill, connRN5);
                        cmdQueryForTotalSharedAmountInSettlemetsInMedBill.CommandType = CommandType.Text;

                        cmdQueryForTotalSharedAmountInSettlemetsInMedBill.Parameters.AddWithValue("@MedBillId", txtMedBillNo.Text.Trim());

                        if (connRN5.State != ConnectionState.Closed)
                        {
                            connRN5.Close();
                            connRN5.Open();
                        }
                        else if (connRN5.State == ConnectionState.Closed) connRN5.Open();

                        Object objTotalSharedAmountSettlementInMedBill = cmdQueryForTotalSharedAmountInSettlemetsInMedBill.ExecuteScalar();
                        if (connRN5.State != ConnectionState.Closed) connRN5.Close();

                        Decimal TotalSharedAmountSettlement = 0;
                        if (objTotalSharedAmountSettlementInMedBill.ToString() != String.Empty)
                        {
                            TotalSharedAmountSettlement = Decimal.Parse(objTotalSharedAmountSettlementInMedBill.ToString());
                        }

                        String strSqlQueryForMedicalProviderRefund = "select sum([dbo].[tbl_settlement].[Amount]) from [dbo].[tbl_settlement] " +
                                                                     "inner join [dbo].[tbl_settlement_type_code] " +
                                                                     "on [dbo].[tbl_settlement].[SettlementType] = [dbo].[tbl_settlement_type_code].[SettlementTypeCode] " +
                                                                     "where [dbo].[tbl_settlement].[MedicalBillID] = @MedBillId and " +
                                                                     "[dbo].[tbl_settlement].[IsDeleted] = 0 and " +
                                                                     "[dbo].[tbl_settlement_type_code].[SettlementTypeValue] = 'Medical Provider Refund'";

                        SqlCommand cmdQueryForMedicalProviderRefund = new SqlCommand(strSqlQueryForMedicalProviderRefund, connRN5);
                        cmdQueryForMedicalProviderRefund.CommandType = CommandType.Text;

                        cmdQueryForMedicalProviderRefund.Parameters.AddWithValue("@MedBillId", txtMedBillNo.Text.Trim());

                        if (connRN5.State != ConnectionState.Closed)
                        {
                            connRN5.Close();
                            connRN5.Open();
                        }
                        else if (connRN5.State == ConnectionState.Closed) connRN5.Open();

                        Object objMedicalProviderRefund = cmdQueryForMedicalProviderRefund.ExecuteScalar();

                        Decimal MedicalProviderRefund = 0;
                        if (objMedicalProviderRefund.ToString() != String.Empty) MedicalProviderRefund = Decimal.Parse(objMedicalProviderRefund.ToString());

                        TotalSharedAmountSettlement -= MedicalProviderRefund;

                        String strSqlUpdateMedBillForTotalSharedAmount = "update [dbo].[tbl_medbill] set [dbo].[tbl_medbill].[TotalSharedAmount] = @TotalSharedAmount " +
                                                 "where [dbo].[tbl_medbill].[BillNo] = @MedBillNo and " +
                                                 "[dbo].[tbl_medbill].[IsDeleted] = 0 and " +
                                                 "[dbo].[tbl_medbill].[Illness_Id] = @IllnessId and " +
                                                 "[dbo].[tbl_medbill].[Incident_Id] = @IncidentId and " +
                                                 "[dbo].[tbl_medbill].[Individual_Id] = @IndividualId";

                        SqlCommand cmdUpdateMedBillForTotalSharedAmount = new SqlCommand(strSqlUpdateMedBillForTotalSharedAmount, connRN5);
                        cmdUpdateMedBillForTotalSharedAmount.CommandType = CommandType.Text;

                        cmdUpdateMedBillForTotalSharedAmount.Parameters.AddWithValue("@TotalSharedAmount", TotalSharedAmountSettlement);
                        cmdUpdateMedBillForTotalSharedAmount.Parameters.AddWithValue("@MedBillNo", txtMedBillNo.Text.Trim());
                        cmdUpdateMedBillForTotalSharedAmount.Parameters.AddWithValue("@IllnessId", Int32.Parse(strIllnessIdForIncidentSharedTotal));
                        cmdUpdateMedBillForTotalSharedAmount.Parameters.AddWithValue("@IncidentId", Int32.Parse(strIncidentIdForIncidentSharedTotal));
                        cmdUpdateMedBillForTotalSharedAmount.Parameters.AddWithValue("@IndividualId", txtIndividualIDMedBill.Text.Trim());

                        if (connRN5.State != ConnectionState.Closed)
                        {
                            connRN5.Close();
                            connRN5.Open();
                        }
                        else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                        int nMedBillUpdated = cmdUpdateMedBillForTotalSharedAmount.ExecuteNonQuery();
                        if (connRN5.State != ConnectionState.Closed) connRN5.Close();

                        if (nMedBillUpdated == 0)
                        {
                            MessageBox.Show("The Medical Bill has not been updated with Total Shared Amount.", "Error");
                            return;
                        }

                        if (strIllnessIdForIncidentSharedTotal != String.Empty &&
                            strIncidentIdForIncidentSharedTotal != String.Empty)
                        {

                            String strSqlQueryForIncidentTotalSharedAmount = "select sum([dbo].[tbl_medbill].[TotalSharedAmount]) from [dbo].[tbl_medbill] " +
                                                 "where [dbo].[tbl_medbill].[IsDeleted] = 0 and " +
                                                 "[dbo].[tbl_medbill].[Illness_Id] = @IllnessId and " +
                                                 "[dbo].[tbl_medbill].[Incident_Id] = @IncidentId and " +
                                                 "[dbo].[tbl_medbill].[Individual_Id] = @IndividualId";

                            SqlCommand cmdQueryForIncidentTotalSharedAmount = new SqlCommand(strSqlQueryForIncidentTotalSharedAmount, connRN5);
                            cmdQueryForIncidentTotalSharedAmount.CommandType = CommandType.Text;

                            cmdQueryForIncidentTotalSharedAmount.Parameters.AddWithValue("@IllnessId", Int32.Parse(strIllnessIdForIncidentSharedTotal));
                            cmdQueryForIncidentTotalSharedAmount.Parameters.AddWithValue("@IncidentId", Int32.Parse(strIncidentIdForIncidentSharedTotal));
                            cmdQueryForIncidentTotalSharedAmount.Parameters.AddWithValue("@IndividualId", txtIndividualIDMedBill.Text.Trim());

                            if (connRN5.State != ConnectionState.Closed)
                            {
                                connRN5.Close();
                                connRN5.Open();
                            }
                            else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                            Object objIncidentTotalSharedAmount = cmdQueryForIncidentTotalSharedAmount.ExecuteScalar();
                            if (connRN5.State != ConnectionState.Closed) connRN5.Close();

                            Decimal IncidentTotalSharedAmount = 0;
                            if (objIncidentTotalSharedAmount.ToString() != String.Empty)
                            {
                                IncidentTotalSharedAmount = Decimal.Parse(objIncidentTotalSharedAmount.ToString());
                            }
                            else
                            {
                                MessageBox.Show("No Incident Total Shared Amount", "Error");
                                return;
                            }

                            String strUpdateIncidentSharedTotal = "update [dbo].[tbl_incident] set [dbo].[tbl_incident].[TotalSharedAmount] = @TotalSharedAmount " +
                                      "where [dbo].[tbl_incident].[IsDeleted] = 0 and " +
                                      "[dbo].[tbl_incident].[Incident_id] = @IncidentId and" +
                                      "[dbo].[tbl_incident].[Illness_id] = @IllnessId and " +
                                      "[dbo].[tbl_incident].[Individual_id] = @IndividualId";

                            SqlCommand cmdUpdateIncidentSharedTotal = new SqlCommand(strUpdateIncidentSharedTotal, connRN5);
                            cmdUpdateIncidentSharedTotal.CommandType = CommandType.Text;

                            cmdUpdateIncidentSharedTotal.Parameters.AddWithValue("@TotalSharedAmount", IncidentTotalSharedAmount);
                            cmdUpdateIncidentSharedTotal.Parameters.AddWithValue("@IncidentId", Int32.Parse(strIncidentIdForIncidentSharedTotal));
                            cmdUpdateIncidentSharedTotal.Parameters.AddWithValue("@IllnessId", Int32.Parse(strIllnessIdForIncidentSharedTotal));
                            cmdUpdateIncidentSharedTotal.Parameters.AddWithValue("@IndividualId", txtIndividualIDMedBill.Text.Trim());

                            if (connRN5.State != ConnectionState.Closed)
                            {
                                connRN5.Close();
                                connRN5.Open();
                            }
                            else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                            int nIncidentUpdated = cmdUpdateIncidentSharedTotal.ExecuteNonQuery();
                            if (connRN5.State != ConnectionState.Closed) connRN5.Close();

                            if (nIncidentUpdated == 1)
                            {
                                String strSqlQueryForIllnessTotalSharedAmount = "select sum([dbo].[tbl_incident].[TotalSharedAmount]) from [dbo].[tbl_incident] " +
                                               "where [dbo].[tbl_incident].[IsDeleted] = 0 and " +
                                               "[dbo].[tbl_incident].[Illness_id] = @IllnessId and " +
                                               "[dbo].[tbl_incident].[Individual_id] = @IndividualId";


                                SqlCommand cmdQueryForIllnessTotalSharedAmount = new SqlCommand(strSqlQueryForIllnessTotalSharedAmount, connRN5);
                                cmdQueryForIllnessTotalSharedAmount.CommandType = CommandType.Text;

                                cmdQueryForIllnessTotalSharedAmount.Parameters.AddWithValue("@IllnessId", Int32.Parse(strIllnessIdForIncidentSharedTotal));
                                cmdQueryForIllnessTotalSharedAmount.Parameters.AddWithValue("@IndividualId", txtIndividualIDMedBill.Text.Trim());

                                if (connRN5.State != ConnectionState.Closed)
                                {
                                    connRN5.Close();
                                    connRN5.Open();
                                }
                                else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                                Object objIllnessTotalSharedAmount = cmdQueryForIllnessTotalSharedAmount.ExecuteScalar();
                                if (connRN5.State != ConnectionState.Closed) connRN5.Close();

                                Decimal IllnessTotalSharedAmount = 0;
                                if (objIllnessTotalSharedAmount.ToString() != String.Empty) IllnessTotalSharedAmount = Decimal.Parse(objIllnessTotalSharedAmount.ToString());

                                String strSqlUpdateIllnessSharedTotal = "update [dbo].[tbl_illness] set [dbo].[tbl_illness].[TotalSharedAmount] = @TotalSharedAmount " +
                                        "where [dbo].[tbl_illness].[IsDeleted] = 0 and " +
                                        "[dbo].[tbl_illness].[Illness_Id] = @IllnessId and " +
                                        "[dbo].[tbl_illness].[Individual_Id] = @IndividualId";

                                SqlCommand cmdUpdateIllnessSharedTotal = new SqlCommand(strSqlUpdateIllnessSharedTotal, connRN5);
                                cmdUpdateIllnessSharedTotal.CommandType = CommandType.Text;

                                cmdUpdateIllnessSharedTotal.Parameters.AddWithValue("@TotalSharedAmount", IllnessTotalSharedAmount);
                                cmdUpdateIllnessSharedTotal.Parameters.AddWithValue("@IllnessId", Int32.Parse(strIllnessIdForIncidentSharedTotal));
                                cmdUpdateIllnessSharedTotal.Parameters.AddWithValue("@IndividualId", txtIndividualIDMedBill.Text.Trim());

                                if (connRN5.State != ConnectionState.Closed)
                                {
                                    connRN5.Close();
                                    connRN5.Open();
                                }
                                else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                                int nIllnessUpdated = cmdUpdateIllnessSharedTotal.ExecuteNonQuery();
                                if (connRN5.State != ConnectionState.Closed) connRN5.Close();

                                if (nIllnessUpdated == 1)
                                {
                                    String strSqlQueryForIndividualTotalSharedAmount = "select sum([dbo].[tbl_illness].[TotalSharedAmount]) from [dbo].[tbl_illness] " +
                                                   "where [dbo].[tbl_illness].[IsDeleted] = 0 and " +
                                                   "[dbo].[tbl_illness].[Individual_Id] = @IndividualId";

                                    SqlCommand cmdQueryForIndividualTotalSharedAmount = new SqlCommand(strSqlQueryForIndividualTotalSharedAmount, connRN5);
                                    cmdQueryForIndividualTotalSharedAmount.CommandType = CommandType.Text;

                                    cmdQueryForIndividualTotalSharedAmount.Parameters.AddWithValue("@IndividualId", txtIndividualIDMedBill.Text.Trim());

                                    if (connRN5.State != ConnectionState.Closed)
                                    {
                                        connRN5.Close();
                                        connRN5.Open();
                                    }
                                    else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                                    Object objIndividualTotalSharedAmount = cmdQueryForIndividualTotalSharedAmount.ExecuteScalar();
                                    if (connRN5.State != ConnectionState.Closed) connRN5.Close();

                                    Decimal IndividualTotalSharedAmount = 0;
                                    if (objIndividualTotalSharedAmount.ToString() != String.Empty) IndividualTotalSharedAmount = Decimal.Parse(objIndividualTotalSharedAmount.ToString());


                                    String strSqlUpdateIndividualTotalSharedAmount = "update [dbo].[contact] set [dbo].[contact].[TotalSharedAmount] = @IndividualTotalSharedAmount " +
                                                                                     "where [dbo].[contact].[IsDeleted] = 0 and " +
                                                                                     "[dbo].[contact].[Individual_ID__c] = @IndividualId";

                                    SqlCommand cmdUpdateIndividualTotalSharedAmount = new SqlCommand(strSqlUpdateIndividualTotalSharedAmount, connSalesforce);
                                    cmdUpdateIndividualTotalSharedAmount.CommandType = CommandType.Text;

                                    cmdUpdateIndividualTotalSharedAmount.Parameters.AddWithValue("@IndividualTotalSharedAmount", IndividualTotalSharedAmount);
                                    cmdUpdateIndividualTotalSharedAmount.Parameters.AddWithValue("@IndividualId", txtIndividualIDMedBill.Text.Trim());

                                    if (connSalesforce.State == ConnectionState.Open)
                                    {
                                        connSalesforce.Close();
                                        connSalesforce.Open();
                                    }
                                    else if (connSalesforce.State == ConnectionState.Closed) connSalesforce.Open();

                                    int nIndividualUpdated = cmdUpdateIndividualTotalSharedAmount.ExecuteNonQuery();
                                    if (connSalesforce.State == ConnectionState.Open) connSalesforce.Close();

                                    if (nIndividualUpdated == 1) txtTotalSharedAmount.Text = IndividualTotalSharedAmount.ToString("C");

                                    if (nIndividualUpdated != 1)
                                    {
                                        MessageBox.Show("Individual Total Shared Amount has not been updated.", "Error");
                                        return;
                                    }
                                }
                                else
                                {
                                    MessageBox.Show("Illness total Shared Amount has not been updated.", "Error");
                                    return;
                                }
                            }
                            else
                            {
                                MessageBox.Show("Incident Total Shared Amount has not been updated.", "Error");
                                return;
                            }
                        }

                        String strSqlQueryForTotalMedBillAmountForIndividualId = "select sum([dbo].[tbl_medbill].[BillAmount]) from [dbo].[tbl_medbill] " +
                                                                                 "where [dbo].[tbl_medbill].[Individual_Id] = @IndividualId and " +
                                                                                 "[dbo].[tbl_medbill].[IsDeleted] = 0";

                        SqlCommand cmdQueryForTotalMedBillAmountForIndividualId = new SqlCommand(strSqlQueryForTotalMedBillAmountForIndividualId, connRN5);
                        cmdQueryForTotalMedBillAmountForIndividualId.CommandType = CommandType.Text;

                        cmdQueryForTotalMedBillAmountForIndividualId.Parameters.AddWithValue("@IndividualId", txtIndividualIDMedBill.Text.Trim());

                        if (connRN5.State != ConnectionState.Closed)
                        {
                            connRN5.Close();
                            connRN5.Open();
                        }
                        else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                        Object objTotalMedBillAmountForIndividualId = cmdQueryForTotalMedBillAmountForIndividualId.ExecuteScalar();
                        if (connRN5.State != ConnectionState.Closed) connRN5.Close();

                        Decimal TotalMedBillAmountForIndividualId = 0;
                        if (objTotalMedBillAmountForIndividualId != null) TotalMedBillAmountForIndividualId = Decimal.Parse(objTotalMedBillAmountForIndividualId.ToString());

                        String strSqlUpdateIndividualTotalMedBillAmount = "update [dbo].[contact] set [dbo].[contact].[MedicalBillAmountTotal] = @MedBillTotalForIndividual " +
                                                                          "where [dbo].[contact].[Individual_ID__c] = @IndividualId";

                        SqlCommand cmdUpdateIndividualTotalMedBillAmount = new SqlCommand(strSqlUpdateIndividualTotalMedBillAmount, connSalesforce);
                        cmdUpdateIndividualTotalMedBillAmount.CommandType = CommandType.Text;

                        cmdUpdateIndividualTotalMedBillAmount.Parameters.AddWithValue("@MedBillTotalForIndividual", TotalMedBillAmountForIndividualId);
                        cmdUpdateIndividualTotalMedBillAmount.Parameters.AddWithValue("@IndividualId", txtIndividualIDMedBill.Text.Trim());

                        if (connSalesforce.State == ConnectionState.Open)
                        {
                            connSalesforce.Close();
                            connSalesforce.Open();
                        }
                        else if (connSalesforce.State == ConnectionState.Closed) connSalesforce.Open();

                        int nIndividualTotalMedBillUpdated = cmdUpdateIndividualTotalMedBillAmount.ExecuteNonQuery();

                        if (connSalesforce.State == ConnectionState.Open) connSalesforce.Close();

                        if (nIndividualTotalMedBillUpdated == 1) txtTotalMedBillAmount.Text = TotalMedBillAmountForIndividualId.ToString("C");

                        if (nIndividualTotalMedBillUpdated != 1)
                        {
                            MessageBox.Show("The individual Medical Bill Amount Total has not been updated.", "Error");
                            return;
                        }
                    }
                    else if (nRowInserted == 0)
                    {
                        MessageBox.Show("The Medical Bill has not been saved.", "Error");
                        return;
                    }

                    bIsModified = false;

                }
                else if (ResultMedBillNo.ToString() == strMedBillNo)
                {
                    String strIndividualId = String.Empty;
                    String strCaseId = String.Empty;
                    String strBillStatus = String.Empty;
                    String strIllnessId = String.Empty;
                    String strIncidentId = String.Empty;

                    String MedBillNo = txtMedBillNo.Text.Trim();
                    String IndividualId = txtIndividualIDMedBill.Text.Trim();
                    strIndividualId = IndividualId;

                    if (txtMedBill_Illness.Text.Trim() != String.Empty)
                    {
                        String IllnessNo = txtMedBill_Illness.Text.Trim();

                        String strSqlQueryForIllnessId = "select [dbo].[tbl_illness].[Illness_Id] from [dbo].[tbl_illness] where [dbo].[tbl_illness].[IllnessNo] = @IllnessNo";

                        SqlCommand cmdQueryForIllnessId = new SqlCommand(strSqlQueryForIllnessId, connRN5);
                        cmdQueryForIllnessId.CommandType = CommandType.Text;

                        cmdQueryForIllnessId.Parameters.AddWithValue("@IllnessNo", IllnessNo);

                        if (connRN5.State != ConnectionState.Closed)
                        {
                            connRN5.Close();
                            connRN5.Open();
                        }
                        else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                        Object objIllnessId = cmdQueryForIllnessId.ExecuteScalar();
                        if (connRN5.State != ConnectionState.Closed) connRN5.Close();

                        if (objIllnessId != null) strIllnessId = objIllnessId.ToString();
                        else
                        {
                            MessageBox.Show("No Illness Id for given Illness No", "Error");
                            return;
                        }
                    }

                    if (txtMedBill_Incident.Text.Trim() != String.Empty)
                    {
                        String IncidentNo = txtMedBill_Incident.Text.Trim();

                        String strSqlQueryForIncidentId = "select [dbo].[tbl_incident].[Incident_id] from [dbo].[tbl_incident] where [dbo].[tbl_incident].[IncidentNo] = @IncidentNo";

                        SqlCommand cmdQueryForIncidentId = new SqlCommand(strSqlQueryForIncidentId, connRN5);
                        cmdQueryForIncidentId.CommandType = CommandType.Text;

                        cmdQueryForIncidentId.Parameters.AddWithValue("@IncidentNo", IncidentNo);

                        if (connRN5.State != ConnectionState.Closed)
                        {
                            connRN5.Close();
                            connRN5.Open();
                        }
                        else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                        Object objIncidentId = cmdQueryForIncidentId.ExecuteScalar();
                        if (connRN5.State != ConnectionState.Closed) connRN5.Close();

                        if (objIncidentId != null) strIncidentId = objIncidentId.ToString();
                        else
                        {
                            MessageBox.Show("No Incident Id for given Incident No", "Error");
                            return;
                        }
                    }

                    // Get medical provider id
                    String strSqlQueryForMedicalProviderId = "select [dbo].[account].[Id] from [dbo].[account] where [dbo].[account].[Name] = @MedicalProviderName";

                    SqlCommand cmdQueryForMedicalProviderId = new SqlCommand(strSqlQueryForMedicalProviderId, connSalesforce2);
                    cmdQueryForMedicalProviderId.CommandType = CommandType.Text;

                    cmdQueryForMedicalProviderId.Parameters.AddWithValue("@MedicalProviderName", txtMedicalProvider.Text.Trim());

                    if (connSalesforce2.State != ConnectionState.Closed)
                    {
                        connSalesforce2.Close();
                        connSalesforce2.Open();
                    }
                    else if (connSalesforce2.State == ConnectionState.Closed) connSalesforce2.Open();
                    Object objMedicalProviderId = cmdQueryForMedicalProviderId.ExecuteScalar();
                    if (connSalesforce2.State != ConnectionState.Closed) connSalesforce2.Close();

                    String MedicalProviderId = String.Empty;
                    if (objMedicalProviderId != null) MedicalProviderId = objMedicalProviderId.ToString();
                    else
                    {
                        MessageBox.Show("No Medical Provider Id for Medical Provider name: " + txtMedicalProvider.Text.Trim(), "Error", MessageBoxButtons.OK);
                        return;
                    }

                    int nPatientType = 0;   // default outpatient

                    if (rbOutpatient.Checked) nPatientType = 0;
                    else if (rbInpatient.Checked) nPatientType = 1;

                    String strNote = String.Empty;

                    if (comboMedBillType.SelectedItem.ToString() == "Medical Bill")
                    {
                        strNote = txtMedBillNote.Text.Trim();
                    }
                    else if (comboMedBillType.SelectedItem.ToString() == "Prescription")
                    {
                        strNote = txtPrescriptionNote.Text.Trim();
                    }
                    else if (comboMedBillType.SelectedItem.ToString() == "Physical Therapy")
                    {
                        strNote = txtPhysicalTherapyRxNote.Text.Trim();
                    }

                    // Update the Medical Bill
                    String strSqlUpdateMedBill = "update [dbo].[tbl_medbill] set [dbo].[tbl_medbill].[LastModifiedDate] = @NewLastModifiedDate, " +
                                                 "[dbo].[tbl_medbill].[LastModifiedById] = @NewLastModifiedById, " +
                                                 "[dbo].[tbl_medbill].[Case_Id] = @NewCaseId, [dbo].[tbl_medbill].[Incident_Id] = @NewIncidentId, " +
                                                 "[dbo].[tbl_medbill].[Illness_Id] = @NewIllnessId, " +
                                                 "[dbo].[tbl_medbill].[BillAmount] = @NewBillAmount, [dbo].[tbl_medbill].[MedBillType_Id] = @NewMedBillType_Id, " +
                                                 "[dbo].[tbl_medbill].[BillStatus] = @NewMedBillStatus, " +
                                                 "[dbo].[tbl_medbill].[BillClosed] = @NewMedBillClosed, " +
                                                 "[dbo].[tbl_medbill].[SettlementTotal] = @NewSettlementTotal, [dbo].[tbl_medbill].[Balance] = @NewBalance, " +
                                                 "[dbo].[tbl_medbill].[BillDate] = @NewBillDate, [dbo].[tbl_medbill].[DueDate] = @NewDueDate, [dbo].[tbl_medbill].[TotalSharedAmount] = @NewTotalSharedAmount, " +
                                                 "[dbo].[tbl_medbill].[Guarantor] = @NewGuarantor, " +
                                                 "[dbo].[tbl_medbill].[MedicalProvider_Id] = @NewMedicalProviderId, " +
                                                 "[dbo].[tbl_medbill].[Account_At_Provider] = @NewAccountAtProvider, " +
                                                 "[dbo].[tbl_medbill].[ProviderPhoneNumber] = @NewProviderPhoneNo, " +
                                                 "[dbo].[tbl_medbill].[ProviderContactPerson] = @NewProviderContactPerson, " +
                                                 "[dbo].[tbl_medbill].[ProposalLetterSentDate] = @NewProposalLetterSentDate, " +
                                                 "[dbo].[tbl_medbill].[HIPPASentDate] = @NewHIPPASentDate, " +
                                                 "[dbo].[tbl_medbill].[MedicalRecordDate] = @NewMedicalRecordDate, " +
                                                 "[dbo].[tbl_medbill].[PrescriptionDrugName] = @NewPrescriptionDrugName, [dbo].[tbl_medbill].[PrescriptionNo] = @NewPrescriptionNo, " +
                                                 "[dbo].[tbl_medbill].[PrescriptionDescription] = @NewPrescriptionDescription, " +
                                                 "[dbo].[tbl_medbill].[TotalNumberOfPhysicalTherapy] = @NewTotalNumberOfPhysicalTherapy, " +
                                                 "[dbo].[tbl_medbill].[PatientTypeId] = @NewPatientTypeId, " +
                                                 "[dbo].[tbl_medbill].[Note] = @Note, " +
                                                 "[dbo].[tbl_medbill].[WellBeingCareTotal] = @NewWellBeingCareTotal, [dbo].[tbl_medbill].[WellBeingCare] = @NewWellBeingCare, " +
                                                 "[dbo].[tbl_medbill].[IneligibleReason] = @NewIneligibleReason, [dbo].[tbl_medbill].[PendingReason] = @NewPendingReason " +
                                                 "where [dbo].[tbl_medbill].[BillNo] = @MedBillNo and [dbo].[tbl_medbill].[Contact_Id] = @IndividualId";

                    SqlCommand cmdUpdateMedBill = new SqlCommand(strSqlUpdateMedBill, connRN5);
                    cmdUpdateMedBill.CommandType = CommandType.Text;

                    cmdUpdateMedBill.Parameters.AddWithValue("@NewLastModifiedDate", DateTime.Today.ToString("MM/dd/yyyy"));
                    cmdUpdateMedBill.Parameters.AddWithValue("@NewLastModifiedById", nLoggedUserId);
                    cmdUpdateMedBill.Parameters.AddWithValue("@NewCaseId", txtMedBill_CaseNo.Text.Trim());
                    cmdUpdateMedBill.Parameters.AddWithValue("@NewIncidentId", strIncidentId);
                    cmdUpdateMedBill.Parameters.AddWithValue("@NewIllnessId", strIllnessId);
                    Decimal BillAmount = 0;
                    Decimal BillAmountResult = 0;

                    if (Decimal.TryParse(txtMedBillAmount.Text.Trim(), NumberStyles.Currency, new CultureInfo("en-US"), out BillAmountResult))
                    {
                        BillAmount = BillAmountResult;
                        cmdUpdateMedBill.Parameters.AddWithValue("@NewBillAmount", BillAmount);
                    }
                    else
                    {
                        MessageBox.Show("Bill Amount is invalid.", "Error");
                        return;
                    }
                    cmdUpdateMedBill.Parameters.AddWithValue("@NewMedBillType_Id", comboMedBillType.SelectedIndex + 1);
                    cmdUpdateMedBill.Parameters.AddWithValue("@NewMedBillStatus", comboMedBillStatus.SelectedIndex);
                    if (cbMedBillClosed.SelectedIndex == 0) cmdUpdateMedBill.Parameters.AddWithValue("@NewMedBillClosed", 0);
                    else if (cbMedBillClosed.SelectedIndex == 1) cmdUpdateMedBill.Parameters.AddWithValue("@NewMedBillClosed", 1);
                    cmdUpdateMedBill.Parameters.AddWithValue("@NewSettlementTotal", 0);
                    cmdUpdateMedBill.Parameters.AddWithValue("@NewBalance", 0);
                    cmdUpdateMedBill.Parameters.AddWithValue("@NewBillDate", dtpBillDate.Value);
                    cmdUpdateMedBill.Parameters.AddWithValue("@NewDueDate", dtpDueDate.Value);
                    cmdUpdateMedBill.Parameters.AddWithValue("@NewTotalSharedAmount", 0);
                    cmdUpdateMedBill.Parameters.AddWithValue("@NewGuarantor", txtMedBillGuarantor.Text.Trim());
                    cmdUpdateMedBill.Parameters.AddWithValue("@NewMedicalProviderId", MedicalProviderId);
                    cmdUpdateMedBill.Parameters.AddWithValue("@NewAccountAtProvider", txtMedBillAccountNoAtProvider.Text.Trim());
                    cmdUpdateMedBill.Parameters.AddWithValue("@NewProviderPhoneNo", txtMedProviderPhoneNo.Text.Trim());
                    cmdUpdateMedBill.Parameters.AddWithValue("@NewProviderContactPerson", txtProviderContactPerson.Text.Trim());
                    cmdUpdateMedBill.Parameters.AddWithValue("@NewProposalLetterSentDate", dtpProposalLetterSentDate.Value);
                    cmdUpdateMedBill.Parameters.AddWithValue("@NewHIPPASentDate", dtpHippaSentDate.Value);
                    cmdUpdateMedBill.Parameters.AddWithValue("@NewMedicalRecordDate", dtpMedicalRecordDate.Value);

                    if (comboMedBillType.SelectedIndex == 0)        // Medical Bill Type - Medical Bill
                    {
                        cmdUpdateMedBill.Parameters.AddWithValue("@NewPrescriptionDrugName", String.Empty);
                        cmdUpdateMedBill.Parameters.AddWithValue("@NewPrescriptionNo", String.Empty);
                        cmdUpdateMedBill.Parameters.AddWithValue("@NewPrescriptionDescription", String.Empty);

                        cmdUpdateMedBill.Parameters.AddWithValue("@NewTotalNumberOfPhysicalTherapy", DBNull.Value);

                        cmdUpdateMedBill.Parameters.AddWithValue("@NewPatientTypeId", nPatientType);
                        if (comboPendingReason.SelectedIndex == -1) cmdUpdateMedBill.Parameters.AddWithValue("@NewPendingReason", 0);
                        else cmdUpdateMedBill.Parameters.AddWithValue("@NewPendingReason", comboPendingReason.SelectedIndex);
                        if (comboIneligibleReason.SelectedIndex == -1) cmdUpdateMedBill.Parameters.AddWithValue("@NewIneligibleReason", 0);
                        else cmdUpdateMedBill.Parameters.AddWithValue("@NewIneligibleReason", comboIneligibleReason.SelectedIndex);

                        cmdUpdateMedBill.Parameters.AddWithValue("@Note", strNote);

                    }
                    if (comboMedBillType.SelectedIndex == 1)        // Medical Bill Type - Prescription
                    {
                        cmdUpdateMedBill.Parameters.AddWithValue("@NewPatientTypeId", DBNull.Value);
                        cmdUpdateMedBill.Parameters.AddWithValue("@NewPendingReason", 0);
                        cmdUpdateMedBill.Parameters.AddWithValue("@NewIneligibleReason", 0);

                        cmdUpdateMedBill.Parameters.AddWithValue("@NewTotalNumberOfPhysicalTherapy", 0);

                        cmdUpdateMedBill.Parameters.AddWithValue("@NewPrescriptionDrugName", txtPrescriptionName.Text.Trim());
                        cmdUpdateMedBill.Parameters.AddWithValue("@NewPrescriptionNo", txtNumberOfMedication.Text.Trim());
                        cmdUpdateMedBill.Parameters.AddWithValue("@NewPrescriptionDescription", txtPrescriptionDescription.Text.Trim());

                        cmdUpdateMedBill.Parameters.AddWithValue("@Note", strNote);
                    }
                    if (comboMedBillType.SelectedIndex == 2)        // Medical Bill Type - Physical Therapy
                    {
                        cmdUpdateMedBill.Parameters.AddWithValue("@NewPrescriptionDrugName", String.Empty);
                        cmdUpdateMedBill.Parameters.AddWithValue("@NewPrescriptionNo", String.Empty);
                        cmdUpdateMedBill.Parameters.AddWithValue("@NewPrescriptionDescription", String.Empty);

                        cmdUpdateMedBill.Parameters.AddWithValue("@NewPatientTypeId", DBNull.Value);
                        cmdUpdateMedBill.Parameters.AddWithValue("@NewPendingReason", 0);
                        cmdUpdateMedBill.Parameters.AddWithValue("@NewIneligibleReason", 0);

                        int nNumberOfPhysicalTherapy = 0;
                        short NumPhysicalTherapyResult = 0;
                        if (Int16.TryParse(txtNumPhysicalTherapy.Text.Trim(), out NumPhysicalTherapyResult))
                        {
                            nNumberOfPhysicalTherapy = NumPhysicalTherapyResult;
                            cmdUpdateMedBill.Parameters.AddWithValue("@NewTotalNumberOfPhysicalTherapy", nNumberOfPhysicalTherapy);
                        }
                        else
                        {
                            MessageBox.Show("Please enter a positive integer in Number of Physical Therapy Text Box.", "Error");
                            return;
                        }

                        cmdUpdateMedBill.Parameters.AddWithValue("@Note", strNote);
                    }


                    cmdUpdateMedBill.Parameters.AddWithValue("@NewWellBeingCareTotal", 0);
                    cmdUpdateMedBill.Parameters.AddWithValue("@NewWellBeingCare", 0);
                    cmdUpdateMedBill.Parameters.AddWithValue("@MedBillNo", MedBillNo);
                    cmdUpdateMedBill.Parameters.AddWithValue("@IndividualId", IndividualId);

                    if (connRN5.State != ConnectionState.Closed)
                    {
                        connRN5.Close();
                        connRN5.Open();
                    }
                    else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                    int nAffectedRow = cmdUpdateMedBill.ExecuteNonQuery();
                    if (connRN5.State != ConnectionState.Closed) connRN5.Close();

                    if (nAffectedRow == 1)
                    {
                        // handle Well Being Care case
                        String strNewMedBillNo = String.Empty;

                        if (txtMedBillNo.Text.Trim() != String.Empty) strNewMedBillNo = txtMedBillNo.Text.Trim();

                        Boolean bWellBeingCare = true;
                        Boolean bWellBeingCareEligible = true;

                        String strSqlQueryForICD10CodeForWellBeingCare = "select [dbo].[tbl_medbill].[BillNo], [dbo].[tbl_illness].[ICD_10_Id] from [dbo].[tbl_medbill] " +
                                                                         "inner join [dbo].[tbl_illness] on [dbo].[tbl_medbill].[Illness_Id] = [dbo].[tbl_illness].[Illness_Id] " +
                                                                         "where [dbo].[tbl_medbill].[BillNo] = @MedBillNo and " +
                                                                         "[dbo].[tbl_medbill].[Individual_Id] = @IndividualId";

                        SqlCommand cmdQueryForICD10CodeForWellBeingCare = new SqlCommand(strSqlQueryForICD10CodeForWellBeingCare, connRN5);
                        cmdQueryForICD10CodeForWellBeingCare.CommandType = CommandType.Text;

                        cmdQueryForICD10CodeForWellBeingCare.Parameters.AddWithValue("@MedBillNo", strNewMedBillNo);
                        cmdQueryForICD10CodeForWellBeingCare.Parameters.AddWithValue("@IndividualId", strIndividualId);

                        String ICD10Code = String.Empty;

                        if (connRN5.State != ConnectionState.Closed)
                        {
                            connRN5.Close();
                            connRN5.Open();
                        }
                        else if (connRN5.State == ConnectionState.Closed) connRN5.Open();

                        SqlDataReader rdrICD10CodeForWellBeingCare = cmdQueryForICD10CodeForWellBeingCare.ExecuteReader();
                        if (rdrICD10CodeForWellBeingCare.HasRows)
                        {
                            rdrICD10CodeForWellBeingCare.Read();
                            if (!rdrICD10CodeForWellBeingCare.IsDBNull(1)) ICD10Code = rdrICD10CodeForWellBeingCare.GetString(1);
                        }
                        rdrICD10CodeForWellBeingCare.Close();
                        if (connRN5.State == ConnectionState.Open) connRN5.Close();

                        if (ICD10Code != "Z00.00" && ICD10Code != "Z00.012") bWellBeingCare = false;

                        if (ICD10Code == "Z00.00" || ICD10Code == "Z00.012")
                        {

                            String strSqlQueryForProgramForIndividual = "select [dbo].[contact].[Individual_ID__c], [dbo].[program].[Name] from [dbo].[contact] " +
                                                                        "inner join [dbo].[program] on [dbo].[contact].[c4g_Plan__c] = [dbo].[program].[ID] " +
                                                                        "where [dbo].[contact].[Individual_ID__c] = @IndividualId";

                            SqlCommand cmdQueryForProgramForIndividual = new SqlCommand(strSqlQueryForProgramForIndividual, connSalesforce);
                            cmdQueryForProgramForIndividual.CommandType = CommandType.Text;

                            cmdQueryForProgramForIndividual.Parameters.AddWithValue("@IndividualId", strIndividualId);

                            if (connSalesforce.State != ConnectionState.Closed)
                            {
                                connSalesforce.Close();
                                connSalesforce.Open();
                            }
                            else if (connSalesforce.State == ConnectionState.Closed) connSalesforce.Open();

                            String ProgramName = String.Empty;

                            SqlDataReader rdrProgramForIndividual = cmdQueryForProgramForIndividual.ExecuteReader();
                            if (rdrProgramForIndividual.HasRows)
                            {
                                rdrProgramForIndividual.Read();
                                if (!rdrProgramForIndividual.IsDBNull(1)) ProgramName = rdrProgramForIndividual.GetString(1);
                            }
                            rdrProgramForIndividual.Close();
                            if (connSalesforce.State == ConnectionState.Open) connSalesforce.Close();

                            if (ProgramName == "Gold Plus" || ProgramName == "Gold Medi-I" || ProgramName == "Gold Medi-II")
                            {
                                String strSqlQueryForIndividualStartDate = "select [dbo].[contact].[Membership_IND_Start_date__c] from [dbo].[contact] " +
                                                                           "where [dbo].[contact].[Individual_ID__c] = @IndividualId";

                                SqlCommand cmdQueryForIndividualStartDate = new SqlCommand(strSqlQueryForIndividualStartDate, connSalesforce);
                                cmdQueryForIndividualStartDate.CommandType = CommandType.Text;

                                cmdQueryForIndividualStartDate.Parameters.AddWithValue("@IndividualId", strIndividualId);

                                if (connSalesforce.State != ConnectionState.Closed)
                                {
                                    connSalesforce.Close();
                                    connSalesforce.Open();
                                }
                                else if (connSalesforce.State == ConnectionState.Closed) connSalesforce.Open();

                                Object objMembershipIndStartDate = cmdQueryForIndividualStartDate.ExecuteScalar();

                                if (connSalesforce.State == ConnectionState.Open) connSalesforce.Close();

                                DateTime MembershipIndStartDate = new DateTime();
                                if (objMembershipIndStartDate != null)
                                {
                                    MembershipIndStartDate = DateTime.Parse(objMembershipIndStartDate.ToString());
                                }

                                if (dtpBillDate.Value > MembershipIndStartDate.AddMonths(6))
                                {
                                    //String strSqlQueryForAnivDateForIndividualId = "select [dbo].[contact].[Aniv_Date], [dbo].[contact].[Membership_IND_Start_date__c] from [dbo].[contact] " +
                                    //                                               "where [dbo].[contact].[Individual_ID__c] = @IndividualId";

                                    //SqlCommand cmdQueryForAnivDateForIndividualId = new SqlCommand(strSqlQueryForAnivDateForIndividualId, connSalesforce);
                                    //cmdQueryForAnivDateForIndividualId.CommandType = CommandType.Text;

                                    //cmdQueryForAnivDateForIndividualId.Parameters.AddWithValue("@IndividualId", strIndividualId);

                                    //if (connSalesforce.State != ConnectionState.Closed)
                                    //{
                                    //    connSalesforce.Close();
                                    //    connSalesforce.Open();
                                    //}
                                    //else if (connSalesforce.State == ConnectionState.Closed) connSalesforce.Open();

                                    //DateTime? AnivDate = null;
                                    //DateTime? StartDate = null;

                                    //SqlDataReader rdrAnivDate = cmdQueryForAnivDateForIndividualId.ExecuteReader();
                                    //if (rdrAnivDate.HasRows)
                                    //{
                                    //    rdrAnivDate.Read();
                                    //    if (!rdrAnivDate.IsDBNull(0)) AnivDate = rdrAnivDate.GetDateTime(0);
                                    //    if (!rdrAnivDate.IsDBNull(1)) StartDate = rdrAnivDate.GetDateTime(1);
                                    //}
                                    //rdrAnivDate.Close();
                                    //if (connSalesforce.State == ConnectionState.Open) connSalesforce.Close();

                                    DateTime IndividualAnivDate = DateTime.Parse(txtAnivDate.Text);
                                    //if (AnivDate != null) IndividualAnivDate = AnivDate.Value;
                                    //else IndividualAnivDate = StartDate.Value;

                                    int nAnivYear = dtpBillDate.Value.Year;

                                    DateTime IndividualThisAnivDate = new DateTime(nAnivYear, IndividualAnivDate.Month, 1);
                                    DateTime IndividualLastAnivDate = new DateTime(nAnivYear - 1, IndividualAnivDate.Month, 1);

                                    String strSqlQueryForWellBeingIncidentsPerAnivYear = "select count([dbo].[tbl_incident].[IncidentNo]) from [dbo].[tbl_incident] " +
                                                                                         "inner join [dbo].[tbl_illness] on [dbo].[tbl_incident].[Illness_id] = [dbo].[tbl_illness].[Illness_Id] " +
                                                                                         "inner join [dbo].[tbl_medbill] on [dbo].[tbl_incident].[Incident_id] = [dbo].[tbl_medbill].[Incident_Id] " +
                                                                                         "where [dbo].[tbl_medbill].[Individual_Id] = @IndividualId and " +
                                                                                         "([dbo].[tbl_illness].[ICD_10_Id] = 'Z00.00' or [dbo].[tbl_illness].[ICD_10_Id] = 'Z00.012') and " +
                                                                                         "[dbo].[tbl_medbill].[BillDate] >= @LastAnivDate and " +
                                                                                         "[dbo].[tbl_medbill].[BillDate] < @ThisAnivDate";

                                    SqlCommand cmdQueryForWellBeingIncidentsPerAnivYear = new SqlCommand(strSqlQueryForWellBeingIncidentsPerAnivYear, connRN5);
                                    cmdQueryForWellBeingIncidentsPerAnivYear.CommandType = CommandType.Text;

                                    cmdQueryForWellBeingIncidentsPerAnivYear.Parameters.AddWithValue("@IndividualId", strIndividualId);
                                    cmdQueryForWellBeingIncidentsPerAnivYear.Parameters.AddWithValue("@LastAnivDate", IndividualLastAnivDate);
                                    cmdQueryForWellBeingIncidentsPerAnivYear.Parameters.AddWithValue("@ThisAnivDate", IndividualThisAnivDate);

                                    if (connRN5.State != ConnectionState.Closed)
                                    {
                                        connRN5.Close();
                                        connRN5.Open();
                                    }
                                    else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                                    Object objIncidentCount = cmdQueryForWellBeingIncidentsPerAnivYear.ExecuteScalar();
                                    if (connRN5.State == ConnectionState.Open) connRN5.Close();

                                    int nIncidentCount = Int32.Parse(objIncidentCount.ToString());

                                    if (nIncidentCount == 1)
                                    {
                                        String strSqlQueryForWellBeingIncidentId = "select [dbo].[tbl_incident].[Incident_id] from [dbo].[tbl_incident] " +
                                                                                   "inner join [dbo].[tbl_illness] on [dbo].[tbl_incident].[Illness_id] = [dbo].[tbl_illness].[Illness_Id] " +
                                                                                   "inner join [dbo].[tbl_medbill] on [dbo].[tbl_incident].[Incident_id] = [dbo].[tbl_medbill].[Incident_Id] " +
                                                                                   "where [dbo].[tbl_medbill].[Individual_Id] = @IndividualId and " +
                                                                                   "([dbo].[tbl_illness].[ICD_10_Id] = 'Z00.00' or [dbo].[tbl_illness].[ICD_10_Id] = 'Z00.012') and " +
                                                                                   "[dbo].[tbl_medbill].[BillDate] >= @LastAnivDate and " +
                                                                                   "[dbo].[tbl_medbill].[BillDate] < @ThisAnivDate";

                                        SqlCommand cmdQueryForWellBeingIncidentId = new SqlCommand(strSqlQueryForWellBeingIncidentId, connRN5);
                                        cmdQueryForWellBeingIncidentId.CommandType = CommandType.Text;

                                        cmdQueryForWellBeingIncidentId.Parameters.AddWithValue("@IndividualId", strIndividualId);
                                        cmdQueryForWellBeingIncidentId.Parameters.AddWithValue("@LastAnivDate", IndividualLastAnivDate);
                                        cmdQueryForWellBeingIncidentId.Parameters.AddWithValue("@ThisAnivDate", IndividualThisAnivDate);

                                        if (connRN5.State != ConnectionState.Closed)
                                        {
                                            connRN5.Close();
                                            connRN5.Open();
                                        }
                                        else if (connRN5.State == ConnectionState.Closed) connRN5.Open();

                                        Object objWellBeingIncidentId = cmdQueryForWellBeingIncidentId.ExecuteScalar();
                                        if (connRN5.State == ConnectionState.Open) connRN5.Close();

                                        if (objWellBeingIncidentId != null)
                                        {
                                            int nWellBeingIncidentId = Int32.Parse(objWellBeingIncidentId.ToString());

                                            String strSqlQueryForWellBeingTotalForIncident = "select sum([dbo].[tbl_medbill].[TotalSharedAmount]) from [dbo].[tbl_medbill] " +
                                                                                             "where [dbo].[tbl_medbill].[Incident_Id] = @IncidentId";

                                            SqlCommand cmdQueryForWellBeingTotalForIncident = new SqlCommand(strSqlQueryForWellBeingTotalForIncident, connRN5);
                                            cmdQueryForWellBeingTotalForIncident.CommandType = CommandType.Text;

                                            cmdQueryForWellBeingTotalForIncident.Parameters.AddWithValue("@IncidentId", nWellBeingIncidentId);

                                            if (connRN5.State != ConnectionState.Closed)
                                            {
                                                connRN5.Close();
                                                connRN5.Open();
                                            }
                                            else if (connRN5.State == ConnectionState.Closed) connRN5.Open();

                                            Object objWellBeingTotalForIncident = cmdQueryForWellBeingTotalForIncident.ExecuteScalar();
                                            if (connRN5.State == ConnectionState.Open) connRN5.Close();

                                            Decimal WellBeingTotalForIncident = Decimal.Parse(objWellBeingTotalForIncident.ToString());

                                            if (WellBeingTotalForIncident > 500)
                                            {
                                                // Set the well being care med bill ineligible strNewMedBillNo
                                                String strSqlUpdateMedBillWellBeingCareIneligible = "update [dbo].[tbl_medbill] set [dbo].[medbill].[BillStatus] = 3, " +
                                                                                                    "[dbo].[tbl_medbill].[WellBeingCare] = 0 " +
                                                                                                    "where [dbo].[tbl_medbill].[BillNo] = @WellBeingCareMedBill";

                                                SqlCommand cmdUpdateMedBillWellBeingCareIneligible = new SqlCommand(strSqlUpdateMedBillWellBeingCareIneligible, connRN5);
                                                cmdUpdateMedBillWellBeingCareIneligible.CommandType = CommandType.Text;

                                                cmdUpdateMedBillWellBeingCareIneligible.Parameters.AddWithValue("@WellBeingCareMedBill", strNewMedBillNo);

                                                if (connRN5.State != ConnectionState.Closed)
                                                {
                                                    connRN5.Close();
                                                    connRN5.Open();
                                                }
                                                else if (connRN5.State == ConnectionState.Closed) connRN5.Open();

                                                int nWellBeingMedBillUpdated = cmdUpdateMedBillWellBeingCareIneligible.ExecuteNonQuery();

                                                if (connRN5.State == ConnectionState.Open) connRN5.Close();

                                                if (nWellBeingMedBillUpdated == 0)
                                                {
                                                    MessageBox.Show("The well being med bill is not updated.", "Error");
                                                    return;
                                                }
                                            }
                                            else
                                            {
                                                // set the well being care med bill eligible
                                                String strSqlUpdateMedBillWellBeingCareEligible = "update [dbo].[tbl_medbill] set [dbo].[tbl_medbill].[BillStatus] = 2, " +
                                                                                                  "[dbo].[tbl_medbill].[WellBeingCare] = 1 " +
                                                                                                  "where [dbo].[tbl_medbill].[BillNo] = @WellBeingCareMedBill";

                                                SqlCommand cmdUpdateMedBillWellBeingCareEligible = new SqlCommand(strSqlUpdateMedBillWellBeingCareEligible, connRN5);
                                                cmdUpdateMedBillWellBeingCareEligible.CommandType = CommandType.Text;

                                                cmdUpdateMedBillWellBeingCareEligible.Parameters.AddWithValue("@WellBeingCareMedBill", strNewMedBillNo);

                                                if (connRN5.State != ConnectionState.Closed)
                                                {
                                                    connRN5.Close();
                                                    connRN5.Open();
                                                }
                                                else if (connRN5.State == ConnectionState.Closed) connRN5.Open();

                                                int nWellBeingMedBillUpdated = cmdUpdateMedBillWellBeingCareEligible.ExecuteNonQuery();

                                                if (connRN5.State == ConnectionState.Open) connRN5.Close();

                                                if (nWellBeingMedBillUpdated == 0)
                                                {
                                                    MessageBox.Show("The well being med bill is not updated.", "Error");
                                                    return;
                                                }
                                            }
                                        }
                                    }
                                    else if (nIncidentCount > 1)
                                    {
                                        // Ineligible for Well Being Care
                                        String strSqlUpdateMedBillWellBeingCareIneligible = "update [dbo].[tbl_medbill] set [dbo].[tbl_medbill].[BillStatus] = 3, " +
                                                                                            "[dbo].[tbl_medbill].[WellBeingCare] = 0 " +
                                                                                            "where [dbo].[tbl_medbill].[BillNo] = @WellBeingCareMedBill";

                                        SqlCommand cmdUpdateMedBillWellBeingCareIneligible = new SqlCommand(strSqlUpdateMedBillWellBeingCareIneligible, connRN5);
                                        cmdUpdateMedBillWellBeingCareIneligible.CommandType = CommandType.Text;

                                        cmdUpdateMedBillWellBeingCareIneligible.Parameters.AddWithValue("@WellBeingCareMedBill", strNewMedBillNo);

                                        if (connRN5.State != ConnectionState.Closed)
                                        {
                                            connRN5.Close();
                                            connRN5.Open();
                                        }
                                        else if (connRN5.State == ConnectionState.Closed) connRN5.Open();

                                        int nWellBeingMedBillUpdated = cmdUpdateMedBillWellBeingCareIneligible.ExecuteNonQuery();
                                        if (connRN5.State == ConnectionState.Open) connRN5.Close();

                                        if (nWellBeingMedBillUpdated == 0)
                                        {
                                            MessageBox.Show("The well being med bill is not updated.", "Error");
                                            return;
                                        }
                                    }
                                }
                            }
                        }

                        ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                        if (gvSettlementsInMedBill.Rows.Count > 0)
                        {
                            for (int i = 0; i < gvSettlementsInMedBill.Rows.Count; i++)
                            {
                                if (gvSettlementsInMedBill["SettlementTypeValue", i]?.Value == null)
                                {
                                    MessageBox.Show("You have to select a Settlement Type.", "Alert");
                                    return;
                                }

                                Decimal result, SettlementAmount;
                                if (Decimal.TryParse(gvSettlementsInMedBill["SettlementAmount", i]?.Value?.ToString(), NumberStyles.Currency, new CultureInfo("en-US"), out result)) SettlementAmount = result;
                                else
                                {
                                    MessageBox.Show("You have to enter decimal value in Settlement Amount field in Settlement " + gvSettlementsInMedBill[1, i]?.Value?.ToString(), "Alert");
                                    return;
                                }

                                result = 0;
                                Decimal PersonalResponsibilityAmount = 0;

                                if ((gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "Self Pay Discount") ||
                                    (gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "3rd Party Discount") ||
                                    (gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "Member Payment"))
                                {
                                    if (gvSettlementsInMedBill["PersonalResponsibility", i]?.Value != null)
                                    {
                                        if (Decimal.TryParse(gvSettlementsInMedBill["PersonalResponsibility", i]?.Value?.ToString(), NumberStyles.Currency, new CultureInfo("en-US"), out result)) PersonalResponsibilityAmount = result;
                                        else
                                        {
                                            MessageBox.Show("Invalid Personal Responsibility.", "Error");
                                            return;
                                        }
                                    }
                                }

                                result = 0;
                                Decimal AllowedAmount = 0;
                                if (gvSettlementsInMedBill["AllowedAmount", i]?.Value?.ToString() != null)
                                {
                                    if (Decimal.TryParse(gvSettlementsInMedBill["AllowedAmount", i]?.Value?.ToString(), NumberStyles.Currency, new CultureInfo("en-US"), out result)) AllowedAmount = result;
                                    else
                                    {
                                        MessageBox.Show("You have to enter decimal value in Allowed Amount field in Settlement " + gvSettlementsInMedBill[1, i]?.Value?.ToString(), "Alert");
                                        return;
                                    }
                                }
                            }

                            ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

                            Decimal MedBillAmount = Decimal.Parse(txtMedBillAmount.Text.Trim(), NumberStyles.Currency, new CultureInfo("en-US"));
                            Decimal SettlementAmountTotal = 0;

                            for (int i = 0; i < gvSettlementsInMedBill.Rows.Count; i++)
                            {
                                Decimal result = 0;
                                Decimal SettlementAmount = 0;
                                if (gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "Self Pay Discount" ||
                                    gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "3rd Party Discount" ||
                                    gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "Member Payment" ||
                                    gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "CMM Provider Payment" ||
                                    gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "CMM Discount" ||
                                    gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "CMM Member Reimbursement" ||
                                    gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "Ineligible")
                                {
                                    if (Decimal.TryParse(gvSettlementsInMedBill["SettlementAmount", i]?.Value?.ToString(), NumberStyles.Currency, new CultureInfo("en-US"), out result))
                                    {
                                        SettlementAmount = result;
                                        SettlementAmountTotal += SettlementAmount;
                                        if (SettlementAmountTotal > MedBillAmount)
                                        {
                                            MessageBox.Show("The total of settlement amount exceeds medical bill amount.");
                                            return;
                                        }
                                    }
                                }
                            }

                            /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                            Boolean bError = false;

                            String strSqlQueryForSettlementType = "select [dbo].[tbl_settlement_type_code].[SettlementTypeCode], [dbo].[tbl_settlement_type_code].[SettlementTypeValue] " +
                                        "from [dbo].[tbl_settlement_type_code]";

                            SqlCommand cmdQueryForSettlementType = new SqlCommand(strSqlQueryForSettlementType, connRN5);
                            cmdQueryForSettlementType.CommandType = CommandType.Text;

                            if (connRN5.State != ConnectionState.Closed)
                            {
                                connRN5.Close();
                                connRN5.Open();
                            }
                            else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                            SqlDataReader rdrSettlementType = cmdQueryForSettlementType.ExecuteReader();
                            lstSettlementType.Clear();
                            if (rdrSettlementType.HasRows)
                            {
                                while (rdrSettlementType.Read())
                                {
                                    if (rdrSettlementType.GetInt16(0) > 0)
                                        lstSettlementType.Add(new SettlementTypeInfo { SettlementTypeCode = rdrSettlementType.GetInt16(0), SettlementTypeValue = rdrSettlementType.GetString(1) });
                                }
                            }
                            rdrSettlementType.Close();
                            if (connRN5.State != ConnectionState.Closed) connRN5.Close();

                            for (int i = 0; i < gvSettlementsInMedBill.Rows.Count; i++)
                            {
                                String SettlementName = gvSettlementsInMedBill["SettlementName", i].Value.ToString();

                                // Check whether or not the settlement is already in data base
                                String strSqlQueryForSettlementName = "select [dbo].[tbl_settlement].[Name] from [dbo].[tbl_settlement] where [dbo].[tbl_settlement].[Name] = @Settlement";

                                SqlCommand cmdQueryForSettlementName = new SqlCommand(strSqlQueryForSettlementName, connRN5);
                                cmdQueryForSettlementName.CommandType = CommandType.Text;

                                cmdQueryForSettlementName.Parameters.AddWithValue("@Settlement", SettlementName);

                                if (connRN5.State != ConnectionState.Closed)
                                {
                                    connRN5.Close();
                                    connRN5.Open();
                                }
                                else if (connRN5.State == ConnectionState.Closed) connRN5.Open();

                                Object objResultSettlementName = cmdQueryForSettlementName.ExecuteScalar();
                                if (connRN5.State != ConnectionState.Closed) connRN5.Close();

                                if (objResultSettlementName == null)   // new settlement: save the settlement by using insert sql statement
                                {

                                    String strSqlCreateNewSettlement = "insert into [dbo].[tbl_settlement] (IsDeleted, Name, CreateDate, CreateByID, LastModifiedDate, LastModifiedByID, SystemModifiedStamp, " +
                                                                        "LastActivityDate, LastViewedDate, MedicalBillID, " +
                                                                        "SettlementType, Amount, PersonalResponsibilityCredit, CMMPaymentMethod, " +
                                                                        "CheckNo, CheckDate, CheckReconciled, ACH_Number, ACH_Date, ACH_Reconciled, CMMCreditCard, CMMCreditCardPaidDate, CC_Reconciled, " +
                                                                        "AllowedAmount, Notes, Approved, ApprovedDate, IneligibleReason) " +
                                                                        "values (0, @SettlementName, @CreateDate, @CreateByID, @LastModifiedDate, @LastModifiedByID, @SystemModifiedStamp, " +
                                                                        "@LastActivityDate, @LastViewedDate, @MedBillID, " +
                                                                        "@SettlementType, @SettlementAmount, @PersonalResponsibilityCredit, @CMMPaymentMethod, " +
                                                                        "@CheckNo, @CheckDate, @IsCheckReconciled, @ACH_Number, @ACH_Date, @IsACH_Reconciled, @CMMCreditCard, @CMMCreditCardPaidDate, @IsCC_Reconciled, " +
                                                                        "@AllowedAmount, @Notes, @IsApproved, @ApprovedDate, @IneligibleReason)";

                                    SqlCommand cmdInsertNewSettlement = new SqlCommand(strSqlCreateNewSettlement, connRN5);
                                    cmdInsertNewSettlement.CommandType = CommandType.Text;

                                    String NewSettlementName = gvSettlementsInMedBill["SettlementName", i].Value.ToString();
                                    String NewSettlementType = String.Empty;
                                    if (gvSettlementsInMedBill["SettlementTypeValue", i].Value != null) NewSettlementType = gvSettlementsInMedBill["SettlementTypeValue", i].Value.ToString();
                                    int nNewSettlementType = 0;
                                    for (int j = 0; j < lstSettlementType.Count; j++)
                                    {
                                        if (NewSettlementType == lstSettlementType[j].SettlementTypeValue) nNewSettlementType = lstSettlementType[j].SettlementTypeCode;
                                    }
                                    Decimal result = 0;
                                    Decimal SettlementAmount = 0;
                                    if (Decimal.TryParse(gvSettlementsInMedBill["SettlementAmount", i]?.Value?.ToString(), NumberStyles.Currency, new CultureInfo("en-US"), out result))
                                    {
                                        SettlementAmount = result;
                                        cmdInsertNewSettlement.Parameters.AddWithValue("@SettlementAmount", SettlementAmount);
                                    }

                                    result = 0;
                                    Decimal PersonalResponsibilityAmount = 0;
                                    if (Decimal.TryParse(gvSettlementsInMedBill["PersonalResponsibility", i]?.Value?.ToString(), NumberStyles.Currency, new CultureInfo("en-US"), out result)) PersonalResponsibilityAmount = result;
                                    cmdInsertNewSettlement.Parameters.AddWithValue("@PersonalResponsibilityCredit", PersonalResponsibilityAmount);

                                    int NewIsApproved = 0;
                                    if (gvSettlementsInMedBill["Approved", i]?.Value != null)
                                    {
                                        if ((Boolean)gvSettlementsInMedBill["Approved", i]?.Value == true) NewIsApproved = 1;
                                    }

                                    //    if (DateTime.TryParse(gvSettlementsInMedBill["ApprovedDate", i]?.Value.ToString(), out resultApprovedDate))
                                    //        NewApprovedDate = resultApprovedDate;


                                    DateTime? NewApprovedDate = null;
                                    if (gvSettlementsInMedBill["ApprovedDate", i]?.Value != null)
                                    {
                                        DateTime resultApprovedDate;
                                        if (DateTime.TryParse(gvSettlementsInMedBill["ApprovedDate", i]?.Value.ToString(), out resultApprovedDate))
                                            NewApprovedDate = resultApprovedDate;

                                        //NewApprovedDate = DateTime.Parse(gvSettlementsInMedBill["ApprovedDate", i].Value.ToString());
                                    }

                                    String NewCMMPaymentMethod = String.Empty;
                                    if (gvSettlementsInMedBill["PaymentMethod", i]?.Value != null) NewCMMPaymentMethod = gvSettlementsInMedBill["PaymentMethod", i].Value.ToString();
                                    int nNewCMMPaymentMethod = 0;
                                    for (int j = 0; j < lstPaymentMethod.Count; j++)
                                    {
                                        if (NewCMMPaymentMethod == lstPaymentMethod[j].PaymentMethodValue) nNewCMMPaymentMethod = lstPaymentMethod[j].PaymentMethodId;
                                    }

                                    String NewCheckNo = String.Empty;
                                    DateTime? NewCheckDate = null;
                                    int NewCheckReconciled = 0;
                                    if (gvSettlementsInMedBill["PaymentMethod", i]?.Value?.ToString() == "Check")
                                    {
                                        if (gvSettlementsInMedBill["CheckNo", i].Value != null) NewCheckNo = gvSettlementsInMedBill["CheckNo", i].Value.ToString();
                                        if (gvSettlementsInMedBill["PaymentDate", i].Value != null) NewCheckDate = DateTime.Parse(gvSettlementsInMedBill["PaymentDate", i].Value.ToString());
                                        if (gvSettlementsInMedBill["Reconciled", i].Value != null) NewCheckReconciled = 1;
                                    }

                                    String NewACH_Number = String.Empty;
                                    DateTime? NewACH_Date = null;
                                    int NewACH_Reconciled = 0;
                                    if (gvSettlementsInMedBill["PaymentMethod", i]?.Value?.ToString() == "ACH/Banking")
                                    {
                                        if (gvSettlementsInMedBill["ACHNo", i].Value != null) NewACH_Number = gvSettlementsInMedBill["ACHNo", i].Value.ToString();
                                        if (gvSettlementsInMedBill["PaymentDate", i].Value != null) NewACH_Date = DateTime.Parse(gvSettlementsInMedBill["PaymentDate", i].Value.ToString());
                                        if (gvSettlementsInMedBill["Reconciled", i].Value != null) NewACH_Reconciled = 1;
                                    }

                                    int nCMMCreditCard = 0;
                                    DateTime? NewCreditCardPaidDate = null;
                                    int NewIsCCReconciled = 0;

                                    if (gvSettlementsInMedBill["PaymentMethod", i]?.Value?.ToString() == "Credit Card")
                                    {
                                        String CreditCard = gvSettlementsInMedBill[13, i]?.Value?.ToString();
                                        for (int j = 0; j < lstCreditCardInfo.Count; j++)
                                        {
                                            if (CreditCard == lstCreditCardInfo[j].CreditCardNo)
                                            {
                                                nCMMCreditCard = lstCreditCardInfo[j].CreditCardId;
                                            }
                                        }
                                        if (gvSettlementsInMedBill["PaymentDate", i].Value != null)
                                            NewCreditCardPaidDate = DateTime.Parse(gvSettlementsInMedBill["PaymentDate", i].Value.ToString());
                                        if (gvSettlementsInMedBill["Reconciled", i].Value != null) NewIsCCReconciled = 1;
                                    }

                                    Decimal NewAllowedAmount = 0;
                                    if (gvSettlementsInMedBill["AllowedAmount", i].Value != null) NewAllowedAmount = Decimal.Parse(gvSettlementsInMedBill["AllowedAmount", i].Value.ToString());
                                    String NewNote = String.Empty;
                                    if (gvSettlementsInMedBill["Note", i].Value != null) NewNote = gvSettlementsInMedBill["Note", i].Value.ToString();


                                    cmdInsertNewSettlement.Parameters.AddWithValue("@SettlementName", NewSettlementName);
                                    cmdInsertNewSettlement.Parameters.AddWithValue("@CreateDate", DateTime.Today);
                                    cmdInsertNewSettlement.Parameters.AddWithValue("@CreateByID", nLoggedUserId);
                                    cmdInsertNewSettlement.Parameters.AddWithValue("@LastModifiedDate", DateTime.Today);
                                    cmdInsertNewSettlement.Parameters.AddWithValue("@LastModifiedByID", nLoggedUserId);
                                    cmdInsertNewSettlement.Parameters.AddWithValue("@SystemModifiedStamp", DateTime.Today);
                                    cmdInsertNewSettlement.Parameters.AddWithValue("@LastActivityDate", DateTime.Today);
                                    cmdInsertNewSettlement.Parameters.AddWithValue("@LastViewedDate", DateTime.Today);
                                    cmdInsertNewSettlement.Parameters.AddWithValue("@MedBillID", txtMedBillNo.Text.Trim());
                                    cmdInsertNewSettlement.Parameters.AddWithValue("@SettlementType", nNewSettlementType);

                                    cmdInsertNewSettlement.Parameters.AddWithValue("@IsApproved", NewIsApproved);

                                    if (NewApprovedDate != null) cmdInsertNewSettlement.Parameters.AddWithValue("@ApprovedDate", NewApprovedDate);
                                    else cmdInsertNewSettlement.Parameters.AddWithValue("@ApprovedDate", DBNull.Value);

                                    cmdInsertNewSettlement.Parameters.AddWithValue("@CMMPaymentMethod", nNewCMMPaymentMethod);

                                    if (NewCheckNo != String.Empty) cmdInsertNewSettlement.Parameters.AddWithValue("@CheckNo", NewCheckNo);
                                    else cmdInsertNewSettlement.Parameters.AddWithValue("@CheckNo", DBNull.Value);

                                    if (NewCheckDate != null) cmdInsertNewSettlement.Parameters.AddWithValue("@CheckDate", NewCheckDate);
                                    else cmdInsertNewSettlement.Parameters.AddWithValue("@CheckDate", DBNull.Value);

                                    cmdInsertNewSettlement.Parameters.AddWithValue("@IsCheckReconciled", NewCheckReconciled);

                                    if (NewACH_Number != null) cmdInsertNewSettlement.Parameters.AddWithValue("@ACH_Number", NewACH_Number);
                                    else cmdInsertNewSettlement.Parameters.AddWithValue("@ACH_Number", DBNull.Value);

                                    if (NewACH_Date != null) cmdInsertNewSettlement.Parameters.AddWithValue("@ACH_Date", NewACH_Date);
                                    else cmdInsertNewSettlement.Parameters.AddWithValue("@ACH_Date", DBNull.Value);

                                    cmdInsertNewSettlement.Parameters.AddWithValue("@IsACH_Reconciled", NewACH_Reconciled);
                                    cmdInsertNewSettlement.Parameters.AddWithValue("@CMMCreditCard", nCMMCreditCard);

                                    if (NewCreditCardPaidDate != null) cmdInsertNewSettlement.Parameters.AddWithValue("@CMMCreditCardPaidDate", NewCreditCardPaidDate);
                                    else cmdInsertNewSettlement.Parameters.AddWithValue("@CMMCreditCardPaidDate", DBNull.Value);

                                    cmdInsertNewSettlement.Parameters.AddWithValue("@IsCC_Reconciled", NewIsCCReconciled);
                                    cmdInsertNewSettlement.Parameters.AddWithValue("@AllowedAmount", NewAllowedAmount);

                                    if (NewNote != null) cmdInsertNewSettlement.Parameters.AddWithValue("@Notes", NewNote);
                                    else cmdInsertNewSettlement.Parameters.AddWithValue("@Notes", DBNull.Value);

                                    int nIneligibleReason = 0;
                                    for (int j = 0; j < dicIneligibleReason.Count; j++)
                                    {
                                        if (gvSettlementsInMedBill["IneligibleReason", i]?.Value?.ToString() == dicIneligibleReason[j]) nIneligibleReason = j;
                                    }
                                    cmdInsertNewSettlement.Parameters.AddWithValue("@IneligibleReason", nIneligibleReason);

                                    if (connRN5.State != ConnectionState.Closed)
                                    {
                                        connRN5.Close();
                                        connRN5.Open();
                                    }
                                    else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                                    int nSettlementInserted = cmdInsertNewSettlement.ExecuteNonQuery();
                                    if (connRN5.State != ConnectionState.Closed) connRN5.Close();

                                    if (nSettlementInserted == 0) bError = true;

                                }
                                else  // the settlement with the name exist, update the settlement
                                {
                                    String UpdateSettlementName = objResultSettlementName.ToString();
                                    String UpdateMedBill = txtMedBillNo.Text.Trim();

                                    String strSqlUpdateSettlement = "update [dbo].[tbl_settlement] set [dbo].[tbl_settlement].[LastModifiedDate] = @LastModifiedDate, " +
                                                                    "[dbo].[tbl_settlement].[LastModifiedByID] = @LastModifiedByID, " +
                                                                    "[dbo].[tbl_settlement].[LastActivityDate] = @LastActivityDate, " +
                                                                    "[dbo].[tbl_settlement].[SettlementType] = @SettlementType, " +
                                                                    "[dbo].[tbl_settlement].[Amount] = @SettlementAmount, " +
                                                                    "[dbo].[tbl_settlement].[PersonalResponsibilityCredit] = @PersonalResponsibilityCredit, " +
                                                                    "[dbo].[tbl_settlement].[Approved] = @IsApproved, " +
                                                                    "[dbo].[tbl_settlement].[ApprovedDate] = @ApprovedDate, " +
                                                                    "[dbo].[tbl_settlement].[CMMPaymentMethod] = @CMMPaymentMethod, " +
                                                                    "[dbo].[tbl_settlement].[CheckNo] = @CheckNo, " +
                                                                    "[dbo].[tbl_settlement].[CheckDate] = @CheckDate, " +
                                                                    "[dbo].[tbl_settlement].[CheckReconciled] = @CheckReconciled, " +
                                                                    "[dbo].[tbl_settlement].[ACH_Number] = @ACH_Number, " +
                                                                    "[dbo].[tbl_settlement].[ACH_Date] = @ACH_Date, " +
                                                                    "[dbo].[tbl_settlement].[ACH_Reconciled] = @ACH_Reconciled, " +
                                                                    "[dbo].[tbl_settlement].[CMMCreditCard] = @CMMCreditCard, " +
                                                                    "[dbo].[tbl_settlement].[CMMCreditCardPaidDate] = @CMMCreditCardPaidDate, " +
                                                                    "[dbo].[tbl_settlement].[CC_Reconciled] = @CC_Reconciled, " +
                                                                    "[dbo].[tbl_settlement].[AllowedAmount] = @AllowedAmount, " +
                                                                    "[dbo].[tbl_settlement].[Notes] = @Note, " +
                                                                    "[dbo].[tbl_settlement].[IneligibleReason] = @IneligibleReason " +
                                                                    "where [dbo].[tbl_settlement].[Name] = @SettlementName and [dbo].[tbl_settlement].[MedicalBillID] = @MedBillName";

                                    int nSettlementType = 0;
                                    String strSettlementType = String.Empty;
                                    if (gvSettlementsInMedBill["SettlementTypeValue", i].Value != null) strSettlementType = gvSettlementsInMedBill["SettlementTypeValue", i].Value.ToString();
                                    for (int j = 0; j < lstSettlementType.Count; j++)
                                    {
                                        if (strSettlementType == lstSettlementType[j].SettlementTypeValue) nSettlementType = lstSettlementType[j].SettlementTypeCode;
                                    }

                                    Decimal SettlementAmount = 0;
                                    if (gvSettlementsInMedBill["SettlementAmount", i].Value != null)
                                    {
                                        SettlementAmount = Decimal.Parse(gvSettlementsInMedBill["SettlementAmount", i].Value.ToString(), NumberStyles.Currency);
                                    }

                                    Decimal PersonalResponsibilityAmt = 0;
                                    if (gvSettlementsInMedBill["PersonalResponsibility", i].Value != null)
                                    {
                                        PersonalResponsibilityAmt = Decimal.Parse(gvSettlementsInMedBill["PersonalResponsibility", i].Value.ToString(), NumberStyles.Currency);
                                    }

                                    // Payment method
                                    int nPaymentMethod = 0;
                                    String PaymentMethod = String.Empty;
                                    if (gvSettlementsInMedBill["PaymentMethod", i].Value != null)
                                        PaymentMethod = gvSettlementsInMedBill["PaymentMethod", i].Value.ToString();
                                    for (int j = 0; j < lstPaymentMethod.Count; j++)
                                    {
                                        if (PaymentMethod == lstPaymentMethod[j].PaymentMethodValue) nPaymentMethod = lstPaymentMethod[j].PaymentMethodId;
                                    }

                                    // Approved or not
                                    int nApproved = 0;
                                    if (gvSettlementsInMedBill["Approved", i].Value != null)
                                    {
                                        if ((Boolean)gvSettlementsInMedBill["Approved", i].Value) nApproved = 1;
                                    }

                                    //    if (DateTime.TryParse(gvSettlementsInMedBill["ApprovedDate", i]?.Value.ToString(), out resultApprovedDate))
                                    //        NewApprovedDate = resultApprovedDate;


                                    DateTime? ApprovedDate = null;
                                    if (gvSettlementsInMedBill["ApprovedDate", i]?.Value != null)
                                    {
                                        DateTime resultApprovedDate;
                                        if (DateTime.TryParse(gvSettlementsInMedBill["ApprovedDate", i]?.Value?.ToString(), out resultApprovedDate))
                                            ApprovedDate = resultApprovedDate;
                                            //ApprovedDate = DateTime.Parse(gvSettlementsInMedBill["ApprovedDate", i].Value.ToString());
                                    }


                                    String CheckNo = String.Empty;
                                    DateTime? CheckIssueDate = null;
                                    int nCheckReconciled = 0;

                                    String ACH_No = String.Empty;
                                    DateTime? ACH_Date = null;
                                    int nACHReconciled = 0;

                                    String CreditCard = String.Empty;
                                    int nCreditCard = 0;
                                    DateTime? CreditCardPaidDate = null;
                                    int nCCReconciled = 0;

                                    switch (PaymentMethod)
                                    {
                                        case "Check":
                                            if (gvSettlementsInMedBill["CheckNo", i].Value != null) CheckNo = gvSettlementsInMedBill["CheckNo", i].Value.ToString();
                                            if (gvSettlementsInMedBill["PaymentDate", i].Value != null)
                                            {
                                                if (gvSettlementsInMedBill["PaymentDate", i].Value.ToString() != String.Empty) CheckIssueDate = DateTime.Parse(gvSettlementsInMedBill["PaymentDate", i].Value.ToString());
                                            }
                                            Boolean bCheckReconciledResult = false;
                                            if (gvSettlementsInMedBill["Reconciled", i].Value != null)
                                            {
                                                if (Boolean.TryParse(gvSettlementsInMedBill["Reconciled", i].Value.ToString(), out bCheckReconciledResult))
                                                {
                                                    if (bCheckReconciledResult) nCheckReconciled = 1;
                                                }
                                            }
                                            break;
                                        case "ACH/Banking":
                                            if (gvSettlementsInMedBill["ACHNo", i].Value != null) ACH_No = gvSettlementsInMedBill["ACHNo", i].Value.ToString();
                                            if (gvSettlementsInMedBill["PaymentDate", i].Value != null)
                                            {
                                                if (gvSettlementsInMedBill["PaymentDate", i].Value.ToString() != String.Empty) ACH_Date = DateTime.Parse(gvSettlementsInMedBill["PaymentDate", i].Value.ToString());
                                            }
                                            Boolean bACHReconciledResult = false;
                                            if (gvSettlementsInMedBill["Reconciled", i].Value != null)
                                            {
                                                if (Boolean.TryParse(gvSettlementsInMedBill["Reconciled", i].Value.ToString(), out bACHReconciledResult))
                                                {
                                                    if (bACHReconciledResult) nACHReconciled = 1;
                                                }
                                            }
                                            break;
                                        case "Credit Card":
                                            if (gvSettlementsInMedBill["CreditCard", i].Value != null) CreditCard = gvSettlementsInMedBill["CreditCard", i].Value.ToString();
                                            for (int j = 0; j < lstCreditCardInfo.Count; j++)
                                            {
                                                if (CreditCard == lstCreditCardInfo[j].CreditCardNo) nCreditCard = lstCreditCardInfo[j].CreditCardId;
                                            }
                                            if (gvSettlementsInMedBill["PaymentDate", i].Value != null)
                                            {
                                                if (gvSettlementsInMedBill["PaymentDate", i].Value.ToString() != String.Empty)
                                                    CreditCardPaidDate = DateTime.Parse(gvSettlementsInMedBill["PaymentDate", i].Value.ToString());
                                            }
                                            Boolean bCCReconciledResult = false;
                                            if (gvSettlementsInMedBill[15, i].Value != null)
                                            {
                                                if (Boolean.TryParse(gvSettlementsInMedBill["Reconciled", i].Value.ToString(), out bCCReconciledResult))
                                                {
                                                    if (bCCReconciledResult) nCCReconciled = 1;
                                                }
                                            }
                                            break;
                                    }

                                    // Allowed Amount
                                    Decimal AllowedAmount = 0;
                                    if (gvSettlementsInMedBill["AllowedAmount", i].Value != null)
                                    {
                                        AllowedAmount = Decimal.Parse(gvSettlementsInMedBill["AllowedAmount", i].Value.ToString(), NumberStyles.Currency);
                                    }

                                    // Note
                                    String Note = String.Empty;
                                    if (gvSettlementsInMedBill["Note", i].Value != null) Note = gvSettlementsInMedBill["Note", i].Value.ToString();



                                    SqlCommand cmdUpdateSettlement = new SqlCommand(strSqlUpdateSettlement, connRN5);
                                    cmdUpdateSettlement.CommandType = CommandType.Text;

                                    cmdUpdateSettlement.Parameters.AddWithValue("@LastModifiedDate", DateTime.Today);
                                    cmdUpdateSettlement.Parameters.AddWithValue("@LastModifiedByID", nLoggedUserId);
                                    cmdUpdateSettlement.Parameters.AddWithValue("@LastActivityDate", DateTime.Today);
                                    cmdUpdateSettlement.Parameters.AddWithValue("@SettlementType", nSettlementType);


                                    cmdUpdateSettlement.Parameters.AddWithValue("@SettlementAmount", SettlementAmount);
                                    cmdUpdateSettlement.Parameters.AddWithValue("@PersonalResponsibilityCredit", PersonalResponsibilityAmt);

                                    cmdUpdateSettlement.Parameters.AddWithValue("@IsApproved", nApproved);
                                    if (ApprovedDate != null) cmdUpdateSettlement.Parameters.AddWithValue("@ApprovedDate", ApprovedDate);
                                    else cmdUpdateSettlement.Parameters.AddWithValue("@ApprovedDate", DBNull.Value);

                                    cmdUpdateSettlement.Parameters.AddWithValue("@CMMPaymentMethod", nPaymentMethod);

                                    if (CheckNo != String.Empty) cmdUpdateSettlement.Parameters.AddWithValue("@CheckNo", CheckNo);
                                    else cmdUpdateSettlement.Parameters.AddWithValue("@CheckNo", DBNull.Value);

                                    if (CheckIssueDate != null) cmdUpdateSettlement.Parameters.AddWithValue("@CheckDate", CheckIssueDate);
                                    else cmdUpdateSettlement.Parameters.AddWithValue("@CheckDate", DBNull.Value);

                                    cmdUpdateSettlement.Parameters.AddWithValue("@CheckReconciled", nCheckReconciled);

                                    if (ACH_No != String.Empty) cmdUpdateSettlement.Parameters.AddWithValue("@ACH_Number", ACH_No);
                                    else cmdUpdateSettlement.Parameters.AddWithValue("@ACH_Number", DBNull.Value);

                                    if (ACH_Date != null) cmdUpdateSettlement.Parameters.AddWithValue("@ACH_Date", ACH_Date);
                                    else cmdUpdateSettlement.Parameters.AddWithValue("@ACH_Date", DBNull.Value);

                                    cmdUpdateSettlement.Parameters.AddWithValue("@ACH_Reconciled", nACHReconciled);
                                    cmdUpdateSettlement.Parameters.AddWithValue("@CMMCreditCard", nCreditCard);

                                    if (CreditCardPaidDate != null) cmdUpdateSettlement.Parameters.AddWithValue("@CMMCreditCardPaidDate", CreditCardPaidDate);
                                    else cmdUpdateSettlement.Parameters.AddWithValue("@CMMCreditCardPaidDate", DBNull.Value);
                                    cmdUpdateSettlement.Parameters.AddWithValue("@CC_Reconciled", nCCReconciled);
                                    cmdUpdateSettlement.Parameters.AddWithValue("@AllowedAmount", AllowedAmount);
                                    if (Note != String.Empty) cmdUpdateSettlement.Parameters.AddWithValue("@Note", Note);
                                    else cmdUpdateSettlement.Parameters.AddWithValue("@Note", DBNull.Value);

                                    cmdUpdateSettlement.Parameters.AddWithValue("@SettlementName", UpdateSettlementName);
                                    cmdUpdateSettlement.Parameters.AddWithValue("@MedBillName", UpdateMedBill);

                                    int nIneligibleReason = 0;
                                    for (int j = 0; j < dicIneligibleReason.Count; j++)
                                    {
                                        if (gvSettlementsInMedBill["IneligibleReason", i]?.Value?.ToString() == dicIneligibleReason[j]) nIneligibleReason = j;
                                    }
                                    cmdUpdateSettlement.Parameters.AddWithValue("@IneligibleReason", nIneligibleReason);

                                    if (connRN5.State != ConnectionState.Closed)
                                    {
                                        connRN5.Close();
                                        connRN5.Open();
                                    }
                                    else if (connRN5.State == ConnectionState.Closed) connRN5.Open();

                                    int nRowUpdated = cmdUpdateSettlement.ExecuteNonQuery();
                                    if (connRN5.State != ConnectionState.Closed) connRN5.Close();

                                    if (nRowUpdated == 0) bError = true;
                                }
                            }

                            ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

                            for (int i = 0; i < gvSettlementsInMedBill.Rows.Count; i++)
                            {
                                if (gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() != "Ineligible")
                                {
                                    gvSettlementsInMedBill["IneligibleReason", i].Value = null;
                                    gvSettlementsInMedBill["IneligibleReason", i].ReadOnly = true;
                                }
                            }

                            if (bError == false)
                            {
                                MessageBox.Show("Settlements have been saved.", "Info");
                            }
                            else if (bError == true)
                            {
                                MessageBox.Show("Some of settlments have not been saved.", "Error");
                                //return;
                            }
                        }

                        MessageBox.Show("The Medical Bill has been updated.", "Information");

                        if (cbMedBillClosed.SelectedIndex == 1)
                        {
                            String CaseNo = txtMedBill_CaseNo.Text.Trim();

                            String strSqlQueryForMedBillsInCase = "select [dbo].[tbl_medbill].[BillClosed], [dbo].[tbl_medbill].[BillNo] from [dbo].[tbl_medbill] " +
                                                                  "where [dbo].[tbl_medbill].[Individual_Id] = @IndividualId and " +
                                                                  "[dbo].[tbl_medbill].[Case_Id] = @CaseId";

                            SqlCommand cmdQueryForMedBillsInCase = new SqlCommand(strSqlQueryForMedBillsInCase, connRN5);
                            cmdQueryForMedBillsInCase.CommandType = CommandType.Text;

                            cmdQueryForMedBillsInCase.Parameters.AddWithValue("@IndividualId", IndividualId);
                            cmdQueryForMedBillsInCase.Parameters.AddWithValue("@CaseId", CaseNo);

                            if (connRN5.State != ConnectionState.Closed)
                            {
                                connRN5.Close();
                                connRN5.Open();
                            }
                            else if (connRN5.State == ConnectionState.Closed) connRN5.Open();

                            SqlDataReader rdrMedBillsInCase = cmdQueryForMedBillsInCase.ExecuteReader();

                            Boolean bBillClosed = true;
                            if (rdrMedBillsInCase.HasRows)
                            {
                                while (rdrMedBillsInCase.Read())
                                {
                                    if (!rdrMedBillsInCase.IsDBNull(0))
                                    {
                                        if (rdrMedBillsInCase.GetBoolean(0) == false) bBillClosed = false;
                                    }
                                    else bBillClosed = false;
                                }
                            }
                            rdrMedBillsInCase.Close();
                            if (connRN5.State != ConnectionState.Closed) connRN5.Close();

                            if (bBillClosed == true)
                            {
                                String strSetCaseToClosed = "update [dbo].[tbl_case] set [dbo].[tbl_case].[Case_status] = 2 " +
                                                            "where [dbo].[tbl_case].[Case_Name] = @CaseNo and " +
                                                            "[dbo].[tbl_case].[individual_id] = @IndividualId";

                                SqlCommand cmdSetCaseToClosed = new SqlCommand(strSetCaseToClosed, connRN5);
                                cmdSetCaseToClosed.CommandType = CommandType.Text;

                                cmdSetCaseToClosed.Parameters.AddWithValue("@CaseNo", CaseNo);
                                cmdSetCaseToClosed.Parameters.AddWithValue("@IndividualId", IndividualId);

                                if (connRN5.State != ConnectionState.Closed)
                                {
                                    connRN5.Close();
                                    connRN5.Open();
                                }
                                else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                                int nCaseClosed = cmdSetCaseToClosed.ExecuteNonQuery();
                                if (connRN5.State != ConnectionState.Closed) connRN5.Close();

                                if (nCaseClosed == 1)
                                {
                                    MessageBox.Show("The case has been closed.", "Information");
                                    cbCaseStatus.SelectedIndex = 2;
                                    cbCaseStatus.Enabled = true;
                                }
                            }
                        }
                        //////////////////////////////////////////////////////////////////////////////////////////////////////////////////

                        String strSqlQueryForTotalSharedAmountInMedBill = "select sum([dbo].[tbl_settlement].[Amount]) from [dbo].[tbl_settlement] " +
                                                  "inner join [dbo].[tbl_settlement_type_code] on " +
                                                  "[dbo].[tbl_settlement].[SettlementType] = [dbo].[tbl_settlement_type_code].[SettlementTypeCode] " +
                                                  "where [dbo].[tbl_settlement].[MedicalBillID] = @MedBillNo and " +
                                                  "[dbo].[tbl_settlement].[IsDeleted] = 0 and " +
                                                  "([dbo].[tbl_settlement_type_code].[SettlementTypeValue] = 'CMM Provider Payment' or " +
                                                  "[dbo].[tbl_settlement_type_code].[SettlementTypeValue] = 'CMM Member Reimbursement' or " +
                                                  "[dbo].[tbl_settlement_type_code].[SettlementTypeValue] = 'PR Reimbursement')";

                        SqlCommand cmdQueryForTotalSharedAmountInMedBill = new SqlCommand(strSqlQueryForTotalSharedAmountInMedBill, connRN5);
                        cmdQueryForTotalSharedAmountInMedBill.CommandType = CommandType.Text;

                        cmdQueryForTotalSharedAmountInMedBill.Parameters.AddWithValue("@MedBillNo", strMedBillNo);

                        if (connRN5.State != ConnectionState.Closed)
                        {
                            connRN5.Close();
                            connRN5.Open();
                        }
                        else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                        Object objTotalSharedAmountInMedBill = cmdQueryForTotalSharedAmountInMedBill.ExecuteScalar();
                        if (connRN5.State != ConnectionState.Closed) connRN5.Close();

                        Decimal TotalSharedAmountInMedBill = 0;
                        if (objTotalSharedAmountInMedBill.ToString() != String.Empty) TotalSharedAmountInMedBill = Decimal.Parse(objTotalSharedAmountInMedBill.ToString());

                        String strSqlQueryForMedicalProviderRefund = "select sum([dbo].[tbl_settlement].[Amount]) from [dbo].[tbl_settlement] " +
                                                                     "inner join [dbo].[tbl_settlement_type_code] on " +
                                                                     "[dbo].[tbl_settlement].[SettlementType] = [dbo].[tbl_settlement_type_code].[SettlementTypeCode] " +
                                                                     "where [dbo].[tbl_settlement].[MedicalBillID] = @MedBillNo and " +
                                                                     "[dbo].[tbl_settlement].[IsDeleted] = 0 and " +
                                                                     "[dbo].[tbl_settlement_type_code].[SettlementTypeValue] = 'Medical Provider Refund'";

                        SqlCommand cmdQueryForMedicalProviderRefund = new SqlCommand(strSqlQueryForMedicalProviderRefund, connRN5);
                        cmdQueryForMedicalProviderRefund.CommandType = CommandType.Text;

                        cmdQueryForMedicalProviderRefund.Parameters.AddWithValue("@MedBillNo", strMedBillNo);

                        if (connRN5.State != ConnectionState.Closed)
                        {
                            connRN5.Close();
                            connRN5.Open();
                        }
                        else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                        Object objTotalMedicalProviderRefund = cmdQueryForMedicalProviderRefund.ExecuteScalar();
                        if (connRN5.State != ConnectionState.Closed) connRN5.Close();

                        Decimal TotalMedicalProviderRefund = 0;
                        if (objTotalMedicalProviderRefund.ToString() != String.Empty) TotalMedicalProviderRefund = Decimal.Parse(objTotalMedicalProviderRefund.ToString());

                        TotalSharedAmountInMedBill -= TotalMedicalProviderRefund;

                        String strSqlUpdateMedBillWithTotalSharedAmount = "update [dbo].[tbl_medbill] set [dbo].[tbl_medbill].[TotalSharedAmount] = @TotalSharedAmount " +
                                                  "where [dbo].[tbl_medbill].[BillNo] = @MedBillNo and " +
                                                  "[dbo].[tbl_medbill].[IsDeleted] = 0 and " +
                                                  "[dbo].[tbl_medbill].[Illness_Id] = @IllnessId and " +
                                                  "[dbo].[tbl_medbill].[Incident_Id] = @IncidentId and " +
                                                  "[dbo].[tbl_medbill].[Individual_Id] = @IndividualId";


                        SqlCommand cmdUpdateMedBillWithTotalSharedAmount = new SqlCommand(strSqlUpdateMedBillWithTotalSharedAmount, connRN5);
                        cmdUpdateMedBillWithTotalSharedAmount.CommandType = CommandType.Text;

                        cmdUpdateMedBillWithTotalSharedAmount.Parameters.AddWithValue("@TotalSharedAmount", TotalSharedAmountInMedBill);
                        cmdUpdateMedBillWithTotalSharedAmount.Parameters.AddWithValue("@MedBillNo", strMedBillNo);
                        cmdUpdateMedBillWithTotalSharedAmount.Parameters.AddWithValue("@IllnessId", Int32.Parse(strIllnessId));
                        cmdUpdateMedBillWithTotalSharedAmount.Parameters.AddWithValue("@IncidentId", Int32.Parse(strIncidentId));
                        cmdUpdateMedBillWithTotalSharedAmount.Parameters.AddWithValue("@IndividualId", txtIndividualIDMedBill.Text.Trim());

                        if (connRN5.State != ConnectionState.Closed)
                        {
                            connRN5.Close();
                            connRN5.Open();
                        }
                        else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                        int nMedBillUpdated = cmdUpdateMedBillWithTotalSharedAmount.ExecuteNonQuery();
                        if (connRN5.State != ConnectionState.Closed) connRN5.Close();

                        if (nMedBillUpdated == 0)
                        {
                            MessageBox.Show("The Medical Bill has not been updated with Total Shared Amount.", "Error");
                            return;
                        }

                        String strSqlQueryForIncidentTotalSharedAmount = "select sum([dbo].[tbl_medbill].[TotalSharedAmount]) from [dbo].[tbl_medbill] " +
                                                 "where [dbo].[tbl_medbill].[IsDeleted] = 0 and " +
                                                 "[dbo].[tbl_medbill].[Illness_Id] = @IllnessId and " +
                                                 "[dbo].[tbl_medbill].[Incident_Id] = @IncidentId and " +
                                                 "[dbo].[tbl_medbill].[Individual_Id] = @IndividualId";

                        SqlCommand cmdQueryForIncidentTotalSharedAmount = new SqlCommand(strSqlQueryForIncidentTotalSharedAmount, connRN5);
                        cmdQueryForIncidentTotalSharedAmount.CommandType = CommandType.Text;

                        cmdQueryForIncidentTotalSharedAmount.Parameters.AddWithValue("@IllnessId", Int32.Parse(strIllnessId));
                        cmdQueryForIncidentTotalSharedAmount.Parameters.AddWithValue("@IncidentId", Int32.Parse(strIncidentId));
                        cmdQueryForIncidentTotalSharedAmount.Parameters.AddWithValue("@IndividualId", txtIndividualIDMedBill.Text.Trim());

                        if (connRN5.State != ConnectionState.Closed)
                        {
                            connRN5.Close();
                            connRN5.Open();
                        }
                        else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                        Object objIncidentTotalSharedAmount = cmdQueryForIncidentTotalSharedAmount.ExecuteScalar();
                        if (connRN5.State != ConnectionState.Closed) connRN5.Close();

                        Decimal IncidentTotalSharedAmount = 0;
                        if (objIncidentTotalSharedAmount.ToString() != String.Empty) IncidentTotalSharedAmount = Decimal.Parse(objIncidentTotalSharedAmount.ToString());
                        else
                        {
                            MessageBox.Show("No Incident Total Shared Amount", "Error");
                            return;
                        }

                        String strSqlUpdateIncidentSharedTotalAmount = "update [dbo].[tbl_incident] set [dbo].[tbl_incident].[TotalSharedAmount] = @TotalSharedAmount," +
                                                                       "[dbo].[tbl_incident].[ModifiStaff] = @ModifiStaff " +
                                                                       "where [dbo].[tbl_incident].[IsDeleted] = 0 and " +
                                                                       "[dbo].[tbl_incident].[Illness_id] = @IllnessId and " +
                                                                       "[dbo].[tbl_incident].[Incident_id] = @IncidentId and " +
                                                                       "[dbo].[tbl_incident].[Individual_id] = @IndividualId";

                        SqlCommand cmdUpdateIncidentSharedTotal = new SqlCommand(strSqlUpdateIncidentSharedTotalAmount, connRN5);
                        cmdUpdateIncidentSharedTotal.CommandType = CommandType.Text;

                        cmdUpdateIncidentSharedTotal.Parameters.AddWithValue("@TotalSharedAmount", IncidentTotalSharedAmount);
                        cmdUpdateIncidentSharedTotal.Parameters.AddWithValue("@ModifiStaff", nLoggedUserId);
                        cmdUpdateIncidentSharedTotal.Parameters.AddWithValue("@IllnessId", Int32.Parse(strIllnessId));
                        cmdUpdateIncidentSharedTotal.Parameters.AddWithValue("@IncidentId", Int32.Parse(strIncidentId));
                        cmdUpdateIncidentSharedTotal.Parameters.AddWithValue("@IndividualId", txtIndividualIDMedBill.Text.Trim());

                        if (connRN5.State != ConnectionState.Closed)
                        {
                            connRN5.Close();
                            connRN5.Open();
                        }
                        else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                        int nIncidentUpdated = cmdUpdateIncidentSharedTotal.ExecuteNonQuery(); // incident id is null in incident_history table
                        if (connRN5.State != ConnectionState.Closed) connRN5.Close();

                        if (nIncidentUpdated == 3)
                        {
                            String strSqlQueryForIllnessTotalSharedAmount = "select sum([dbo].[tbl_incident].[TotalSharedAmount]) from [dbo].[tbl_incident] " +
                                                "where [dbo].[tbl_incident].[IsDeleted] = 0 and " +
                                                "[dbo].[tbl_incident].[Illness_id] = @IllnessId and " +
                                                "[dbo].[tbl_incident].[Individual_id] = @IndividualId";

                            SqlCommand cmdQueryForIllnessTotalSharedAmount = new SqlCommand(strSqlQueryForIllnessTotalSharedAmount, connRN5);
                            cmdQueryForIllnessTotalSharedAmount.CommandType = CommandType.Text;

                            cmdQueryForIllnessTotalSharedAmount.Parameters.AddWithValue("@IllnessId", Int32.Parse(strIllnessId));
                            cmdQueryForIllnessTotalSharedAmount.Parameters.AddWithValue("@IndividualId", txtIndividualIDMedBill.Text.Trim());

                            if (connRN5.State != ConnectionState.Closed)
                            {
                                connRN5.Close();
                                connRN5.Open();
                            }
                            else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                            Object objIllnessTotalSharedAmount = cmdQueryForIllnessTotalSharedAmount.ExecuteScalar();
                            if (connRN5.State != ConnectionState.Closed) connRN5.Close();

                            Decimal IllnessTotalSharedAmount = 0;
                            if (objIllnessTotalSharedAmount.ToString() != String.Empty) IllnessTotalSharedAmount = Decimal.Parse(objIllnessTotalSharedAmount.ToString());

                            String strSqlUpdateIllnessSharedTotal = "update [dbo].[tbl_illness] set [dbo].[tbl_illness].[TotalSharedAmount] = @TotalSharedAmount " +
                                        "where [dbo].[tbl_illness].[IsDeleted] = 0 and " +
                                        "[dbo].[tbl_illness].[Illness_Id] = @IllnessId and " +
                                        "[dbo].[tbl_illness].[Individual_Id] = @IndividualId";

                            SqlCommand cmdUpdateIllnessSharedTotal = new SqlCommand(strSqlUpdateIllnessSharedTotal, connRN5);
                            cmdUpdateIllnessSharedTotal.CommandType = CommandType.Text;

                            cmdUpdateIllnessSharedTotal.Parameters.AddWithValue("@TotalSharedAmount", IllnessTotalSharedAmount);
                            cmdUpdateIllnessSharedTotal.Parameters.AddWithValue("@IllnessId", Int32.Parse(strIllnessId));
                            cmdUpdateIllnessSharedTotal.Parameters.AddWithValue("@IndividualId", txtIndividualIDMedBill.Text.Trim());

                            if (connRN5.State != ConnectionState.Closed)
                            {
                                connRN5.Close();
                                connRN5.Open();
                            }
                            else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                            int nIllnessUpdated = cmdUpdateIllnessSharedTotal.ExecuteNonQuery();
                            if (connRN5.State != ConnectionState.Closed) connRN5.Close();

                            if (nIllnessUpdated == 1)
                            {

                                String strSqlQueryForIndividualTotalSharedAmount = "select sum([dbo].[tbl_illness].[TotalSharedAmount]) from [dbo].[tbl_illness] " +
                                                    "where [dbo].[tbl_illness].[IsDeleted] = 0 and " +
                                                    "[dbo].[tbl_illness].[Individual_Id] = @IndividualId";

                                SqlCommand cmdQueryForIndividualTotalSharedAmount = new SqlCommand(strSqlQueryForIndividualTotalSharedAmount, connRN5);
                                cmdQueryForIndividualTotalSharedAmount.CommandType = CommandType.Text;
                                cmdQueryForIndividualTotalSharedAmount.Parameters.AddWithValue("@IndividualId", txtIndividualIDMedBill.Text.Trim());

                                if (connRN5.State != ConnectionState.Closed)
                                {
                                    connRN5.Close();
                                    connRN5.Open();
                                }
                                else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                                Object objIndividualTotalSharedAmount = cmdQueryForIndividualTotalSharedAmount.ExecuteScalar();
                                if (connRN5.State != ConnectionState.Closed) connRN5.Close();

                                Decimal IndividualTotalSharedAmount = 0;
                                if (objIndividualTotalSharedAmount.ToString() != String.Empty) IndividualTotalSharedAmount = Decimal.Parse(objIndividualTotalSharedAmount.ToString());

                                String strSqlUpdateIndividualTotalSharedAmount = "update [dbo].[contact] set [dbo].[contact].[TotalSharedAmount] = @IndividualTotalSharedAmount " +
                                                                                 "where [dbo].[contact].[IsDeleted] = 0 and " +
                                                                                 "[dbo].[contact].[Individual_ID__c] = @IndividualId";

                                SqlCommand cmdUpdateIndividualTotalSharedAmount = new SqlCommand(strSqlUpdateIndividualTotalSharedAmount, connSalesforce);
                                cmdUpdateIndividualTotalSharedAmount.CommandType = CommandType.Text;

                                cmdUpdateIndividualTotalSharedAmount.Parameters.AddWithValue("@IndividualTotalSharedAmount", IndividualTotalSharedAmount);
                                cmdUpdateIndividualTotalSharedAmount.Parameters.AddWithValue("@IndividualId", txtIndividualIDMedBill.Text.Trim());

                                if (connSalesforce.State == ConnectionState.Open)
                                {
                                    connSalesforce.Close();
                                    connSalesforce.Open();
                                }
                                else if (connSalesforce.State == ConnectionState.Closed) connSalesforce.Open();
                                int nIndividualUpdated = cmdUpdateIndividualTotalSharedAmount.ExecuteNonQuery();
                                if (connSalesforce.State == ConnectionState.Open) connSalesforce.Close();

                                if (nIndividualUpdated == 1) txtTotalSharedAmount.Text = IndividualTotalSharedAmount.ToString("C");

                                if (nIndividualUpdated != 1)
                                {
                                    MessageBox.Show("Individual Total Shared Amount has not been updated.", "Error");
                                    return;
                                }
                            }
                            else
                            {
                                MessageBox.Show("Illness Total Shared Amount has not been updated.", "Error");
                                return;
                            }
                        }
                        else
                        {
                            MessageBox.Show("Incident Total Shared Amount has not been updated.", "Error");
                            return;
                        }

                        String strSqlQueryForTotalMedBillAmountForIndividualId = "select sum([dbo].[tbl_medbill].[BillAmount]) from [dbo].[tbl_medbill] " +
                                                         "where [dbo].[tbl_medbill].[Individual_Id] = @IndividualId and " +
                                                         "[dbo].[tbl_medbill].[IsDeleted] = 0";

                        SqlCommand cmdQueryForTotalMedBillAmountForIndividualId = new SqlCommand(strSqlQueryForTotalMedBillAmountForIndividualId, connRN5);
                        cmdQueryForTotalMedBillAmountForIndividualId.CommandType = CommandType.Text;

                        cmdQueryForTotalMedBillAmountForIndividualId.Parameters.AddWithValue("@IndividualId", txtIndividualIDMedBill.Text.Trim());

                        if (connRN5.State != ConnectionState.Closed)
                        {
                            connRN5.Close();
                            connRN5.Open();
                        }
                        else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                        Object objTotalMedBillAmountForIndividualId = cmdQueryForTotalMedBillAmountForIndividualId.ExecuteScalar();
                        if (connRN5.State != ConnectionState.Closed) connRN5.Close();

                        Decimal TotalMedBillAmountForIndividualId = 0;
                        if (objTotalMedBillAmountForIndividualId != null) TotalMedBillAmountForIndividualId = Decimal.Parse(objTotalMedBillAmountForIndividualId.ToString());

                        String strSqlUpdateIndividualTotalMedBillAmount = "update [dbo].[contact] set [dbo].[contact].[MedicalBillAmountTotal] = @MedBillTotalForIndividual " +
                                                                          "where [dbo].[contact].[Individual_ID__c] = @IndividualId";

                        SqlCommand cmdUpdateIndividualTotalMedBillAmount = new SqlCommand(strSqlUpdateIndividualTotalMedBillAmount, connSalesforce);
                        cmdUpdateIndividualTotalMedBillAmount.CommandType = CommandType.Text;

                        cmdUpdateIndividualTotalMedBillAmount.Parameters.AddWithValue("@MedBillTotalForIndividual", TotalMedBillAmountForIndividualId);
                        cmdUpdateIndividualTotalMedBillAmount.Parameters.AddWithValue("@IndividualId", txtIndividualIDMedBill.Text.Trim());

                        if (connSalesforce.State == ConnectionState.Open)
                        {
                            connSalesforce.Close();
                            connSalesforce.Open();
                        }
                        else if (connSalesforce.State == ConnectionState.Closed) connSalesforce.Open();

                        int nIndividualTotalMedBillUpdated = cmdUpdateIndividualTotalMedBillAmount.ExecuteNonQuery();

                        if (connSalesforce.State == ConnectionState.Open) connSalesforce.Close();

                        if (nIndividualTotalMedBillUpdated == 1) txtTotalMedBillAmount.Text = TotalMedBillAmountForIndividualId.ToString("C");



                        //////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                        return;
                    }
                    else if (nAffectedRow == 0)
                    {
                        MessageBox.Show("The Medical Bill has not been updated.", "Error");
                        return;
                    }

                    bIsModified = false;
                }
            }
            else if (dlgResult == DialogResult.No)
            {
                return;
            }

            Cursor.Current = Cursors.Default;





            /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

            //frmSaveNewMedBill frmSaveMedBill = new frmSaveNewMedBill();

            //frmSaveMedBill.StartPosition = FormStartPosition.CenterParent;
            //DialogResult dlgResult = frmSaveMedBill.ShowDialog();

            //if (dlgResult == DialogResult.Yes)
            //{
            //    String strMedBillNo = txtMedBillNo.Text.Trim();

            //    String strSqlQueryForMedBill = "select [dbo].[tbl_medbill].[BillNo] from [dbo].[tbl_medbill] where [dbo].[tbl_medbill].[BillNo] = @MedBillNo";

            //    SqlCommand cmdQueryForMedBill = new SqlCommand(strSqlQueryForMedBill, connRN);
            //    cmdQueryForMedBill.Parameters.AddWithValue("@MedBillNo", strMedBillNo);

            //    //if (connRN.State == ConnectionState.Closed) connRN.Open();
            //    if (connRN.State != ConnectionState.Closed)
            //    {
            //        connRN.Close();
            //        connRN.Open();
            //    }
            //    else if (connRN.State == ConnectionState.Closed) connRN.Open();
            //    Object ResultMedBillNo = cmdQueryForMedBill.ExecuteScalar();
            //    if (connRN.State != ConnectionState.Closed) connRN.Close();

            //    if (ResultMedBillNo == null)
            //    {
            //        String strIndividualId = String.Empty;
            //        String strCaseId = String.Empty;
            //        String strBillStatus = String.Empty;
            //        String strIllnessId = String.Empty;
            //        String strIncidentId = String.Empty;

            //        String strNewMedBillNo = String.Empty;
            //        String strMedProvider = String.Empty;
            //        String strPrescriptionName = String.Empty;
            //        String strPrescriptionNo = String.Empty;
            //        String strPrescriptionDescription = String.Empty;

            //        if (txtIndividualIDMedBill.Text.Trim() != String.Empty) strIndividualId = txtIndividualIDMedBill.Text.Trim();
            //        if (txtMedBill_CaseNo.Text.Trim() != String.Empty) strCaseId = txtMedBill_CaseNo.Text.Trim();
            //        //if (txtMedicalBillStatus.Text.Trim() != String.Empty) strBillStatus = txtMedicalBillStatus.Text.Trim();

            //        //if (txtMedBill_Illness.Text.Trim() != String.Empty) strIllnessId = Illness.IllnessNo;
            //        //if (txtMedBill_Incident.Text.Trim() != String.Empty) strIncidentId = txtMedBill_Incident.Text.Trim();

            //        if (txtMedBillNo.Text.Trim() != String.Empty) strNewMedBillNo = txtMedBillNo.Text.Trim();

            //        if (txtMedBill_Illness.Text.Trim() != String.Empty)
            //        {
            //            String IllnessNo = txtMedBill_Illness.Text.Trim();

            //            String strSqlQueryForIllnessId = "select [dbo].[tbl_illness].[Illness_Id] from [dbo].[tbl_illness] where [dbo].[tbl_illness].[IllnessNo] = @IllnessNo";

            //            SqlCommand cmdQueryForIllnessId = new SqlCommand(strSqlQueryForIllnessId, connRN);
            //            cmdQueryForIllnessId.CommandType = CommandType.Text;

            //            cmdQueryForIllnessId.Parameters.AddWithValue("@IllnessNo", IllnessNo);

            //            if (connRN.State != ConnectionState.Closed)
            //            {
            //                connRN.Close();
            //                connRN.Open();
            //            }
            //            else if (connRN.State == ConnectionState.Closed) connRN.Open();
            //            Object objIllnessId = cmdQueryForIllnessId.ExecuteScalar();
            //            if (connRN.State != ConnectionState.Closed) connRN.Close();

            //            if (objIllnessId != null) strIllnessId = objIllnessId.ToString();
            //            else
            //            {
            //                MessageBox.Show("No Illness Id for given Illness No", "Error");
            //                return;
            //            }
            //        }

            //        if (txtMedBill_Incident.Text.Trim() != String.Empty)
            //        {
            //            String IncidentNo = txtMedBill_Incident.Text.Trim();

            //            String strSqlQueryForIncidentId = "select [dbo].[tbl_incident].[Incident_id] from [dbo].[tbl_incident] where [dbo].[tbl_incident].[IncidentNo] = @IncidentNo";

            //            SqlCommand cmdQueryForIncidentId = new SqlCommand(strSqlQueryForIncidentId, connRN);
            //            cmdQueryForIncidentId.CommandType = CommandType.Text;

            //            cmdQueryForIncidentId.Parameters.AddWithValue("@IncidentNo", IncidentNo);

            //            if (connRN.State != ConnectionState.Closed)
            //            {
            //                connRN.Close();
            //                connRN.Open();
            //            }
            //            else if (connRN.State == ConnectionState.Closed) connRN.Open();
            //            Object objIncidentId = cmdQueryForIncidentId.ExecuteScalar();
            //            if (connRN.State != ConnectionState.Closed) connRN.Close();

            //            if (objIncidentId != null) strIncidentId = objIncidentId.ToString();
            //            else
            //            {
            //                MessageBox.Show("No Incident Id for given Incident No", "Error");
            //                return;
            //            }
            //        }


            //        String MedicalProvider = String.Empty;

            //        if (txtMedicalProvider.Text.Trim() != String.Empty)
            //        {
            //            MedicalProvider = txtMedicalProvider.Text.Trim();
            //        }
            //        else
            //        {
            //            MessageBox.Show("Please enter the name of medical provider.", "Error");
            //            return;
            //        }

            //        String PrescriptionName = String.Empty;

            //        if (txtPrescriptionName.Text.Trim() != String.Empty)
            //        {
            //            PrescriptionName = txtPrescriptionName.Text.Trim();
            //        }

            //        String PrescriptionNo = String.Empty;

            //        if (txtNumberOfMedication.Text.Trim() != String.Empty)
            //        {
            //            PrescriptionNo = txtNumberOfMedication.Text.Trim();
            //        }

            //        String PrescriptionDescription = String.Empty;

            //        if (txtPrescriptionDescription.Text.Trim() != String.Empty)
            //        {
            //            PrescriptionDescription = txtPrescriptionDescription.Text.Trim();
            //        }


            //        int nPatientType = 0;   // default outpatient

            //        if (rbOutpatient.Checked) nPatientType = 0;
            //        else if (rbInpatient.Checked) nPatientType = 1;

            //        //int nSelectedMedNote = cbMedicalBillNote1.SelectedIndex;

            //        String strNote = String.Empty;

            //        if (comboMedBillType.SelectedItem.ToString() == "Medical Bill")
            //        {
            //            strNote = txtMedBillNote.Text.Trim();
            //        }
            //        else if (comboMedBillType.SelectedItem.ToString() == "Prescription")
            //        {
            //            strNote = txtPrescriptionNote.Text.Trim();
            //        }
            //        else if (comboMedBillType.SelectedItem.ToString() == "Physical Therapy")
            //        {
            //            strNote = txtPhysicalTherapyRxNote.Text.Trim();
            //        }



            //        String strSqlInsertNewMedBill = "insert into dbo.tbl_medbill (IsDeleted, BillNo, MedBillType_Id, BillStatus, CreatedDate, CreatedById, LastModifiedDate, LastModifiedById, " +
            //                                        "LastActivityDate, LastViewedDate, LastReferencedDate, Case_Id, Incident_Id, Illness_Id, BillAmount, SettlementTotal, " +
            //                                        "Balance, BillDate, TotalSharedAmount, Individual_Id, Contact_Id, MedicalProvider_Id, PendingReason, " +
            //                                        "Account_At_Provider, ProviderPhoneNumber, ProviderContactPerson, " +
            //                                        "ProposalLetterSentDate, HIPPASentDate, MedicalRecordDate, " +
            //                                        "BillStatus, ProofOfPaymentReceivedDate, IneligibleReason, OriginalPrescription, PersonalResponsibilityCredit, " +
            //                                        "WellBeingCareTotal, WellBeingCare, DueDate, TotalNumberOfPhysicalTherapy, " +
            //                                        "PrescriptionDrugName, PrescriptionNo, PrescriptionDescription, " +
            //                                        "PatientTypeId, Note) " +
            //                                        "values (@IsDeleted, @BillNo, @MedBillType_Id, @MedBillStatus, @CreatedDate, @CreateById, @LastModifiedDate, @LastModifiedById, " +
            //                                        "@LastActivityDate, @LastViewedDate, @LastReferencedDate, @Case_Id, @Incident_Id, @Illness_Id, @BillAmount, @SettlementTotal, " +
            //                                        "@Balance, @BillDate, @TotalSharedAmount, @Individual_Id, @Contact_Id, @MedicalProvider_Id, @PendingReason, " +
            //                                        "@Account_At_Provider, @ProviderPhoneNo, @ProviderContactPerson, " +
            //                                        "@ProposalLetterSentDate, @HIPPASentDate, @MedicalRecordDate, " +
            //                                        "@BillStatus, @ProofOfPaymentReceivedDate, @IneligibleReason, @OriginalPrescription, @PersonalResponsibilityCredit, " +
            //                                        "@WellBeingCareTotal, @WellBeingCare, @DueDate, @TotalNumberOfPhysicalTherapy, " +
            //                                        "@PrescriptionDrugName, @PrescriptionNo, @PrescriptionDescription, " +
            //                                        "@PatientTypeId, @Note)";

            //        SqlCommand cmdInsertNewMedBill = new SqlCommand(strSqlInsertNewMedBill, connRN);
            //        cmdInsertNewMedBill.CommandType = CommandType.Text;

            //        cmdInsertNewMedBill.Parameters.AddWithValue("@IsDeleted", 0);
            //        cmdInsertNewMedBill.Parameters.AddWithValue("@BillNo", strNewMedBillNo);
            //        cmdInsertNewMedBill.Parameters.AddWithValue("@MedBillType_Id", comboMedBillType.SelectedIndex + 1);
            //        cmdInsertNewMedBill.Parameters.AddWithValue("@MedBillStatus", comboMedBillStatus.SelectedIndex);
            //        cmdInsertNewMedBill.Parameters.AddWithValue("@CreatedDate", DateTime.Today);
            //        cmdInsertNewMedBill.Parameters.AddWithValue("@CreateById", nLoggedUserId);
            //        cmdInsertNewMedBill.Parameters.AddWithValue("@LastModifiedDate", DateTime.Today);
            //        cmdInsertNewMedBill.Parameters.AddWithValue("@LastModifiedById", nLoggedUserId);
            //        cmdInsertNewMedBill.Parameters.AddWithValue("@LastActivityDate", DateTime.Today);
            //        cmdInsertNewMedBill.Parameters.AddWithValue("@LastViewedDate", DateTime.Today);
            //        cmdInsertNewMedBill.Parameters.AddWithValue("@LastReferencedDate", DateTime.Today);
            //        cmdInsertNewMedBill.Parameters.AddWithValue("@Case_Id", strCaseId);
            //        cmdInsertNewMedBill.Parameters.AddWithValue("@Incident_Id", strIncidentId);
            //        cmdInsertNewMedBill.Parameters.AddWithValue("@Illness_Id", strIllnessId);


            //        Decimal BillAmountResult = 0;
            //        Decimal BillAmount = 0;

            //        if (Decimal.TryParse(txtMedBillAmount.Text.Trim(), NumberStyles.Currency, new CultureInfo("en-US"), out BillAmountResult))
            //        {
            //            BillAmount = BillAmountResult;
            //            cmdInsertNewMedBill.Parameters.AddWithValue("@BillAmount", BillAmount);
            //        }
            //        else
            //        {
            //            MessageBox.Show("Bill Amount is invalid.", "Error");
            //            return;
            //        }

            //        cmdInsertNewMedBill.Parameters.AddWithValue("@SettlementTotal", 0);

            //        Decimal BalanceResult = 0;
            //        Decimal Balance = 0;

            //        if (Decimal.TryParse(txtBalance.Text.Trim(), NumberStyles.Currency, new CultureInfo("en-US"), out BalanceResult))
            //        {
            //            Balance = BalanceResult;
            //            cmdInsertNewMedBill.Parameters.AddWithValue("@Balance", Balance);
            //        }
            //        else
            //        {
            //            MessageBox.Show("Balance is invalid.", "Error");
            //            return;
            //        }

            //        cmdInsertNewMedBill.Parameters.AddWithValue("@BillDate", dtpBillDate.Value);

            //        Decimal TotalSharedAmount = 0;
            //        for (int i = 0; i < gvSettlementsInMedBill.Rows.Count; i++)
            //        {
            //            if ((gvSettlementsInMedBill["SettlementType", i].Value.ToString() == "CMM Provider Payment") ||
            //                (gvSettlementsInMedBill["SettlementType", i].Value.ToString() == "CMM Member Reimbursement"))
            //                TotalSharedAmount += Decimal.Parse(gvSettlementsInMedBill["SettlementType", i].Value.ToString(), NumberStyles.Currency, new CultureInfo("en-US"));
            //            if (gvSettlementsInMedBill["SettlementType", i].Value.ToString() == "Medical Provider Refund")
            //                TotalSharedAmount -= Decimal.Parse(gvSettlementsInMedBill["SettlementType", i].Value.ToString(), NumberStyles.Currency, new CultureInfo("en-US"));
            //        }

            //        cmdInsertNewMedBill.Parameters.AddWithValue("@TotalSharedAmount", TotalSharedAmount);
            //        cmdInsertNewMedBill.Parameters.AddWithValue("@Individual_Id", strIndividualId);
            //        cmdInsertNewMedBill.Parameters.AddWithValue("@Contact_Id", strIndividualId);
            //        foreach (MedicalProviderInfo info in lstMedicalProvider)
            //        {
            //            if (info.Name == txtMedicalProvider.Text.Trim())
            //            {
            //                cmdInsertNewMedBill.Parameters.AddWithValue("@MedicalProvider_Id", info.ID);
            //                break;
            //            }
            //        }

            //        cmdInsertNewMedBill.Parameters.AddWithValue("@Account_At_Provider", txtMedBillAccountNoAtProvider.Text.Trim());
            //        cmdInsertNewMedBill.Parameters.AddWithValue("@ProviderPhoneNo", txtMedProviderPhoneNo.Text.Trim());
            //        cmdInsertNewMedBill.Parameters.AddWithValue("@ProviderContactPerson", txtProviderContactPerson.Text.Trim());
            //        cmdInsertNewMedBill.Parameters.AddWithValue("@ProposalLetterSentDate", dtpProposalLetterSentDate.Value);
            //        cmdInsertNewMedBill.Parameters.AddWithValue("@HIPPASentDate", dtpHippaSentDate.Value);
            //        cmdInsertNewMedBill.Parameters.AddWithValue("@MedicalRecordDate", dtpMedicalRecordDate.Value);
            //        cmdInsertNewMedBill.Parameters.AddWithValue("@BillStatus", comboMedBillStatus.SelectedIndex);
            //        cmdInsertNewMedBill.Parameters.AddWithValue("@ProofOfPaymentReceivedDate", DateTime.Today);
            //        cmdInsertNewMedBill.Parameters.AddWithValue("@OriginalPrescription", DBNull.Value);
            //        cmdInsertNewMedBill.Parameters.AddWithValue("@PersonalResponsibilityCredit", 500);
            //        cmdInsertNewMedBill.Parameters.AddWithValue("@WellBeingCareTotal", 0);
            //        cmdInsertNewMedBill.Parameters.AddWithValue("@WellBeingCare", 0);
            //        //cmdInsertNewMedBill.Parameters.AddWithValue("@Memo", DBNull.Value);
            //        cmdInsertNewMedBill.Parameters.AddWithValue("@DueDate", DateTime.Today);

            //        if (comboMedBillType.SelectedIndex == 0)        // Medical Bill Type : Medical Bill
            //        {
            //            cmdInsertNewMedBill.Parameters.AddWithValue("@PrescriptionDrugName", DBNull.Value);
            //            cmdInsertNewMedBill.Parameters.AddWithValue("@PrescriptionNo", DBNull.Value);
            //            cmdInsertNewMedBill.Parameters.AddWithValue("@PrescriptionDescription", DBNull.Value);

            //            cmdInsertNewMedBill.Parameters.AddWithValue("@TotalNumberOfPhysicalTherapy", DBNull.Value);

            //            cmdInsertNewMedBill.Parameters.AddWithValue("@PatientTypeId", nPatientType);
            //            cmdInsertNewMedBill.Parameters.AddWithValue("@PendingReason", comboPendingReason.SelectedIndex);
            //            cmdInsertNewMedBill.Parameters.AddWithValue("@IneligibleReason", comboIneligibleReason.SelectedIndex);

            //            cmdInsertNewMedBill.Parameters.AddWithValue("@Note", strNote);
            //        }
            //        else if (comboMedBillType.SelectedIndex == 1)   // Medical Bill Type : Prescription
            //        {
            //            cmdInsertNewMedBill.Parameters.AddWithValue("@PatientTypeId", DBNull.Value);
            //            cmdInsertNewMedBill.Parameters.AddWithValue("@PendingReason", DBNull.Value);
            //            cmdInsertNewMedBill.Parameters.AddWithValue("@IneligibleReason", DBNull.Value);

            //            cmdInsertNewMedBill.Parameters.AddWithValue("@TotalNumberOfPhysicalTherapy", DBNull.Value);

            //            cmdInsertNewMedBill.Parameters.AddWithValue("@PrescriptionDrugName", txtPrescriptionName.Text.Trim());
            //            cmdInsertNewMedBill.Parameters.AddWithValue("@PrescriptionNo", txtNumberOfMedication.Text.Trim());
            //            cmdInsertNewMedBill.Parameters.AddWithValue("@PrescriptionDescription", txtPrescriptionDescription.Text.Trim());
            //            cmdInsertNewMedBill.Parameters.AddWithValue("@Note", strNote);
            //        }
            //        else if (comboMedBillType.SelectedIndex == 2)   // Medical Bill Type : Physical Therapy
            //        {
            //            cmdInsertNewMedBill.Parameters.AddWithValue("@PrescriptionDrugName", DBNull.Value);
            //            cmdInsertNewMedBill.Parameters.AddWithValue("@PrescriptionNo", DBNull.Value);
            //            cmdInsertNewMedBill.Parameters.AddWithValue("@PrescriptionDescription", DBNull.Value);

            //            cmdInsertNewMedBill.Parameters.AddWithValue("@PatientTypeId", DBNull.Value);
            //            cmdInsertNewMedBill.Parameters.AddWithValue("@PendingReason", DBNull.Value);
            //            cmdInsertNewMedBill.Parameters.AddWithValue("@IneligibleReason", DBNull.Value);

            //            int nNumberOfPhysicalTherapy = 0;
            //            short result = 0;
            //            if (Int16.TryParse(txtNumPhysicalTherapy.Text.Trim(), out result))
            //            {
            //                nNumberOfPhysicalTherapy = result;
            //                cmdInsertNewMedBill.Parameters.AddWithValue("@TotalNumberOfPhysicalTherapy", nNumberOfPhysicalTherapy);
            //            }
            //            else
            //            {
            //                MessageBox.Show("Please enter a positive integer in the Number of Physical Therapy Text Box.", "Alert");
            //                return;
            //            }

            //            cmdInsertNewMedBill.Parameters.AddWithValue("@Note", strNote);
            //        }

            //        //if (connRN.State == ConnectionState.Closed) connRN.Open();
            //        if (connRN.State != ConnectionState.Closed)
            //        {
            //            connRN.Close();
            //            connRN.Open();
            //        }
            //        else if (connRN.State == ConnectionState.Closed) connRN.Open();
            //        int nRowInserted = cmdInsertNewMedBill.ExecuteNonQuery();
            //        if (connRN.State != ConnectionState.Closed) connRN.Close();

            //        if (nRowInserted == 1)
            //        {
            //            MessageBox.Show("The Medical Bill has been saved.", "Information");
            //            //btnAddNewSettlement.Enabled = true;
            //            return;

            //        }
            //        else if (nRowInserted == 0)
            //        {
            //            MessageBox.Show("The Medical Bill has not been saved.", "Error");
            //            return;
            //        }

            //        bIsModified = false;

            //    }
            //    else if (ResultMedBillNo.ToString() == strMedBillNo)
            //    {
            //        // update the med bill

            //        if (txtIndividualIDMedBill.Text.Trim() == String.Empty)
            //        {
            //            MessageBox.Show("There is no illness code.", "Alert");
            //            return;
            //        }

            //        if (txtMedBill_Incident.Text.Trim() == String.Empty)
            //        {
            //            MessageBox.Show("There is no incident id.", "Alert");
            //            return;
            //        }

            //        String MedBillNo = txtMedBillNo.Text.Trim();
            //        String IndividualId = txtIndividualIDMedBill.Text.Trim();

            //        String strIllnessId = String.Empty;
            //        String strIncidentId = String.Empty;

            //        if (txtMedBill_Illness.Text.Trim() != String.Empty)
            //        {
            //            String IllnessNo = txtMedBill_Illness.Text.Trim();

            //            String strSqlQueryForIllnessId = "select [dbo].[tbl_illness].[Illness_Id] from [dbo].[tbl_illness] where [dbo].[tbl_illness].[IllnessNo] = @IllnessNo";

            //            SqlCommand cmdQueryForIllnessId = new SqlCommand(strSqlQueryForIllnessId, connRN);
            //            cmdQueryForIllnessId.CommandType = CommandType.Text;

            //            cmdQueryForIllnessId.Parameters.AddWithValue("@IllnessNo", IllnessNo);

            //            if (connRN.State != ConnectionState.Closed)
            //            {
            //                connRN.Close();
            //                connRN.Open();
            //            }
            //            else if (connRN.State == ConnectionState.Closed) connRN.Open();
            //            Object objIllnessId = cmdQueryForIllnessId.ExecuteScalar();
            //            if (connRN.State != ConnectionState.Closed) connRN.Close();

            //            if (objIllnessId != null) strIllnessId = objIllnessId.ToString();
            //            else
            //            {
            //                MessageBox.Show("No Illness Id for given Illness No", "Error");
            //                return;
            //            }
            //        }

            //        if (txtMedBill_Incident.Text.Trim() != String.Empty)
            //        {
            //            String IncidentNo = txtMedBill_Incident.Text.Trim();

            //            String strSqlQueryForIncidentId = "select [dbo].[tbl_incident].[Incident_id] from [dbo].[tbl_incident] where [dbo].[tbl_incident].[IncidentNo] = @IncidentNo";

            //            SqlCommand cmdQueryForIncidentId = new SqlCommand(strSqlQueryForIncidentId, connRN);
            //            cmdQueryForIncidentId.CommandType = CommandType.Text;

            //            cmdQueryForIncidentId.Parameters.AddWithValue("@IncidentNo", IncidentNo);

            //            if (connRN.State != ConnectionState.Closed)
            //            {
            //                connRN.Close();
            //                connRN.Open();
            //            }
            //            else if (connRN.State == ConnectionState.Closed) connRN.Open();
            //            Object objIncidentId = cmdQueryForIncidentId.ExecuteScalar();
            //            if (connRN.State != ConnectionState.Closed) connRN.Close();

            //            if (objIncidentId != null) strIncidentId = objIncidentId.ToString();
            //            else
            //            {
            //                MessageBox.Show("No Incident Id for given Incident No", "Error");
            //                return;
            //            }
            //        }

            //        // Get illness id for ICD 10 Code
            //        //String strSqlQueryForIllnessId = "select [dbo].[tbl_illness].[Illness_Id] from [dbo].[tbl_illness] " +
            //        //                                    "where [dbo].[tbl_illness].[Individual_Id] = @IndividualId and [dbo].[tbl_illness].[ICD_10_Id] = @ICD10Code";

            //        //SqlCommand cmdQueryForIllnessId = new SqlCommand(strSqlQueryForIllnessId, connRN);
            //        //cmdQueryForIllnessId.CommandType = CommandType.Text;

            //        //cmdQueryForIllnessId.Parameters.AddWithValue("@IndividualId", IndividualId);
            //        //cmdQueryForIllnessId.Parameters.AddWithValue("@ICD10Code", txtMedBill_Illness.Text.Trim());

            //        ////if (connRN.State == ConnectionState.Closed) connRN.Open();
            //        //if (connRN.State != ConnectionState.Closed)
            //        //{
            //        //    connRN.Close();
            //        //    connRN.Open();
            //        //}
            //        //else if (connRN.State == ConnectionState.Closed) connRN.Open();
            //        ////int nIllnessId = Int32.Parse(cmdQueryForIllnessId.ExecuteScalar().ToString());
            //        //Object objIllnessId = cmdQueryForIllnessId.ExecuteScalar();
            //        //if (connRN.State != ConnectionState.Closed) connRN.Close();

            //        //int nResult;
            //        //int? nIllnessId = null;
            //        //if (objIllnessId != null)
            //        //{
            //        //    if (Int32.TryParse(objIllnessId.ToString(), NumberStyles.Integer, new CultureInfo("en-US"), out nResult)) nIllnessId = nResult;
            //        //}

            //        // Get medical provider id
            //        String strSqlQueryForMedicalProviderId = "select [dbo].[tbl_MedicalProvider].[ID] from [dbo].[tbl_MedicalProvider] where [dbo].[tbl_MedicalProvider].[Name] = @MedicalProviderName";

            //        SqlCommand cmdQueryForMedicalProviderId = new SqlCommand(strSqlQueryForMedicalProviderId, connRN);
            //        cmdQueryForMedicalProviderId.CommandType = CommandType.Text;

            //        cmdQueryForMedicalProviderId.Parameters.AddWithValue("@MedicalProviderName", txtMedicalProvider.Text.Trim());

            //        //if (connRN.State == ConnectionState.Closed) connRN.Open();
            //        if (connRN.State != ConnectionState.Closed)
            //        {
            //            connRN.Close();
            //            connRN.Open();
            //        }
            //        else if (connRN.State == ConnectionState.Closed) connRN.Open();
            //        //String MedicalProviderId = cmdQueryForMedicalProviderId.ExecuteScalar().ToString();
            //        Object objMedicalProviderId = cmdQueryForMedicalProviderId.ExecuteScalar();
            //        if (connRN.State != ConnectionState.Closed) connRN.Close();

            //        String MedicalProviderId = String.Empty;

            //        if (objMedicalProviderId != null) MedicalProviderId = objMedicalProviderId.ToString();

            //        int nPatientType = 0;   // default outpatient

            //        if (rbOutpatient.Checked) nPatientType = 0;
            //        else if (rbInpatient.Checked) nPatientType = 1;

            //        String strNote = String.Empty;

            //        if (comboMedBillType.SelectedItem.ToString() == "Medical Bill")
            //        {
            //            strNote = txtMedBillNote.Text.Trim();
            //        }
            //        else if (comboMedBillType.SelectedItem.ToString() == "Prescription")
            //        {
            //            strNote = txtPrescriptionNote.Text.Trim();
            //        }
            //        else if (comboMedBillType.SelectedItem.ToString() == "Physical Therapy")
            //        {
            //            strNote = txtPhysicalTherapyRxNote.Text.Trim();
            //        }

            //        // Update the Medical Bill
            //        String strSqlUpdateMedBill = "update [dbo].[tbl_medbill] set [dbo].[tbl_medbill].[LastModifiedDate] = @NewLastModifiedDate, " +
            //                                     "[dbo].[tbl_medbill].[LastModifiedById] = @NewLastModifiedById, " +
            //                                         "[dbo].[tbl_medbill].[Case_Id] = @NewCaseId, [dbo].[tbl_medbill].[Incident_Id] = @NewIncidentId, " +
            //                                         "[dbo].[tbl_medbill].[Illness_Id] = @NewIllnessId, " +
            //                                         "[dbo].[tbl_medbill].[BillAmount] = @NewBillAmount, [dbo].[tbl_medbill].[MedBillType_Id] = @NewMedBillType_Id, " +
            //                                         "[dbo].[tbl_medbill].[BillStatus] = @NewMedBillStatus, " +
            //                                         "[dbo].[tbl_medbill].[SettlementTotal] = @NewSettlementTotal, [dbo].[tbl_medbill].[Balance] = @NewBalance, " +
            //                                         "[dbo].[tbl_medbill].[BillDate] = @NewBillDate, [dbo].[tbl_medbill].[DueDate] = @NewDueDate, [dbo].[tbl_medbill].[TotalSharedAmount] = @NewTotalSharedAmount, " +
            //                                         "[dbo].[tbl_medbill].[Guarantor] = @NewGuarantor, " +
            //                                         "[dbo].[tbl_medbill].[MedicalProvider_Id] = @NewMedicalProviderId, " +
            //                                         "[dbo].[tbl_medbill].[Account_At_Provider] = @NewAccountAtProvider, " +
            //                                         "[dbo].[tbl_medbill].[ProviderPhoneNumber] = @NewProviderPhoneNo, " +
            //                                         "[dbo].[tbl_medbill].[ProviderContactPerson] = @NewProviderContactPerson, " +
            //                                         "[dbo].[tbl_medbill].[ProposalLetterSentDate] = @NewProposalLetterSentDate, " +
            //                                         "[dbo].[tbl_medbill].[HIPPASentDate] = @NewHIPPASentDate, " +
            //                                         "[dbo].[tbl_medbill].[MedicalRecordDate] = @NewMedicalRecordDate, " +
            //                                         "[dbo].[tbl_medbill].[PrescriptionDrugName] = @NewPrescriptionDrugName, [dbo].[tbl_medbill].[PrescriptionNo] = @NewPrescriptionNo, " +
            //                                         "[dbo].[tbl_medbill].[PrescriptionDescription] = @NewPrescriptionDescription, " +
            //                                         "[dbo].[tbl_medbill].[TotalNumberOfPhysicalTherapy] = @NewTotalNumberOfPhysicalTherapy, " +
            //                                         "[dbo].[tbl_medbill].[PatientTypeId] = @NewPatientTypeId, " +
            //                                         "[dbo].[tbl_medbill].[Note] = @Note, " +
            //                                         "[dbo].[tbl_medbill].[WellBeingCareTotal] = @NewWellBeingCareTotal, [dbo].[tbl_medbill].[WellBeingCare] = @NewWellBeingCare, " +
            //                                         "[dbo].[tbl_medbill].[IneligibleReason] = @NewIneligibleReason, [dbo].[tbl_medbill].[PendingReason] = @NewPendingReason, " +
            //                                         "[dbo].[tbl_medbill].[OriginalPrescription] = @NewOriginalPrescription " +
            //                                         "where [dbo].[tbl_medbill].[BillNo] = @MedBillNo and [dbo].[tbl_medbill].[Contact_Id] = @IndividualId";

            //        SqlCommand cmdUpdateMedBill = new SqlCommand(strSqlUpdateMedBill, connRN);
            //        cmdUpdateMedBill.CommandType = CommandType.Text;

            //        cmdUpdateMedBill.Parameters.AddWithValue("@NewLastModifiedDate", DateTime.Today.ToString("MM/dd/yyyy"));
            //        cmdUpdateMedBill.Parameters.AddWithValue("@NewLastModifiedById", nLoggedUserId);
            //        cmdUpdateMedBill.Parameters.AddWithValue("@NewCaseId", txtMedBill_CaseNo.Text.Trim());
            //        cmdUpdateMedBill.Parameters.AddWithValue("@NewIncidentId", strIncidentId);
            //        cmdUpdateMedBill.Parameters.AddWithValue("@NewIllnessId", strIllnessId);
            //        Decimal BillAmount = 0;
            //        Decimal BillAmountResult = 0;

            //        if (Decimal.TryParse(txtMedBillAmount.Text.Trim(), NumberStyles.Currency, new CultureInfo("en-US"), out BillAmountResult))
            //        {
            //            BillAmount = BillAmountResult;
            //            cmdUpdateMedBill.Parameters.AddWithValue("@NewBillAmount", BillAmount);
            //        }
            //        else
            //        {
            //            MessageBox.Show("Bill Amount is invalid.", "Error");
            //            return;
            //        }
            //        cmdUpdateMedBill.Parameters.AddWithValue("@NewMedBillType_Id", comboMedBillType.SelectedIndex + 1);
            //        cmdUpdateMedBill.Parameters.AddWithValue("@NewMedBillStatus", comboMedBillStatus.SelectedIndex);
            //        cmdUpdateMedBill.Parameters.AddWithValue("@NewSettlementTotal", 0);
            //        cmdUpdateMedBill.Parameters.AddWithValue("@NewBalance", 0);
            //        cmdUpdateMedBill.Parameters.AddWithValue("@NewBillDate", dtpBillDate.Value);
            //        cmdUpdateMedBill.Parameters.AddWithValue("@NewDueDate", dtpDueDate.Value);
            //        cmdUpdateMedBill.Parameters.AddWithValue("@NewTotalSharedAmount", 0);
            //        cmdUpdateMedBill.Parameters.AddWithValue("@NewGuarantor", txtMedBillGuarantor.Text.Trim());
            //        cmdUpdateMedBill.Parameters.AddWithValue("@NewMedicalProviderId", MedicalProviderId);
            //        cmdUpdateMedBill.Parameters.AddWithValue("@NewAccountAtProvider", txtMedBillAccountNoAtProvider.Text.Trim());
            //        cmdUpdateMedBill.Parameters.AddWithValue("@NewProviderPhoneNo", txtMedProviderPhoneNo.Text.Trim());
            //        cmdUpdateMedBill.Parameters.AddWithValue("@NewProviderContactPerson", txtProviderContactPerson.Text.Trim());
            //        cmdUpdateMedBill.Parameters.AddWithValue("@NewProposalLetterSentDate", dtpProposalLetterSentDate.Value);
            //        cmdUpdateMedBill.Parameters.AddWithValue("@NewHIPPASentDate", dtpHippaSentDate.Value);
            //        cmdUpdateMedBill.Parameters.AddWithValue("@NewMedicalRecordDate", dtpMedicalRecordDate.Value);

            //        if (comboMedBillType.SelectedIndex == 0)        // Medical Bill Type - Medical Bill
            //        {
            //            cmdUpdateMedBill.Parameters.AddWithValue("@NewPrescriptionDrugName", DBNull.Value);
            //            cmdUpdateMedBill.Parameters.AddWithValue("@NewPrescriptionNo", DBNull.Value);
            //            cmdUpdateMedBill.Parameters.AddWithValue("@NewPrescriptionDescription", DBNull.Value);

            //            cmdUpdateMedBill.Parameters.AddWithValue("@NewTotalNumberOfPhysicalTherapy", DBNull.Value);

            //            cmdUpdateMedBill.Parameters.AddWithValue("@NewPatientTypeId", nPatientType);
            //            cmdUpdateMedBill.Parameters.AddWithValue("@NewPendingReason", comboPendingReason.SelectedIndex);
            //            cmdUpdateMedBill.Parameters.AddWithValue("@NewIneligibleReason", comboIneligibleReason.SelectedIndex);

            //            cmdUpdateMedBill.Parameters.AddWithValue("@Note", strNote);

            //        }
            //        if (comboMedBillType.SelectedIndex == 1)        // Medical Bill Type - Prescription
            //        {
            //            cmdUpdateMedBill.Parameters.AddWithValue("@NewPatientTypeId", DBNull.Value);
            //            cmdUpdateMedBill.Parameters.AddWithValue("@NewPendingReason", DBNull.Value);
            //            cmdUpdateMedBill.Parameters.AddWithValue("@NewIneligibleReason", DBNull.Value);

            //            cmdUpdateMedBill.Parameters.AddWithValue("@NewTotalNumberOfPhysicalTherapy", DBNull.Value);

            //            cmdUpdateMedBill.Parameters.AddWithValue("@NewPrescriptionDrugName", txtPrescriptionName.Text.Trim());
            //            cmdUpdateMedBill.Parameters.AddWithValue("@NewPrescriptionNo", txtNumberOfMedication.Text.Trim());
            //            cmdUpdateMedBill.Parameters.AddWithValue("@NewPrescriptionDescription", txtPrescriptionDescription.Text.Trim());

            //            cmdUpdateMedBill.Parameters.AddWithValue("@Note", strNote);
            //        }
            //        if (comboMedBillType.SelectedIndex == 2)        // Medical Bill Type - Physical Therapy
            //        {
            //            cmdUpdateMedBill.Parameters.AddWithValue("@NewPrescriptionDrugName", DBNull.Value);
            //            cmdUpdateMedBill.Parameters.AddWithValue("@NewPrescriptionNo", DBNull.Value);
            //            cmdUpdateMedBill.Parameters.AddWithValue("@NewPrescriptionDescription", DBNull.Value);

            //            cmdUpdateMedBill.Parameters.AddWithValue("@NewPatientTypeId", DBNull.Value);
            //            cmdUpdateMedBill.Parameters.AddWithValue("@NewPendingReason", DBNull.Value);
            //            cmdUpdateMedBill.Parameters.AddWithValue("@NewIneligibleReason", DBNull.Value);

            //            int nNumberOfPhysicalTherapy = 0;
            //            short NumPhysicalTherapyResult = 0;
            //            if (Int16.TryParse(txtNumPhysicalTherapy.Text.Trim(), out NumPhysicalTherapyResult))
            //            {
            //                nNumberOfPhysicalTherapy = NumPhysicalTherapyResult;
            //                cmdUpdateMedBill.Parameters.AddWithValue("@NewTotalNumberOfPhysicalTherapy", nNumberOfPhysicalTherapy);
            //            }
            //            else
            //            {
            //                MessageBox.Show("Please enter a positive integer in Number of Physical Therapy Text Box.", "Error");
            //                return;
            //            }

            //            cmdUpdateMedBill.Parameters.AddWithValue("@Note", strNote);
            //        }


            //        cmdUpdateMedBill.Parameters.AddWithValue("@NewWellBeingCareTotal", 0);
            //        cmdUpdateMedBill.Parameters.AddWithValue("@NewWellBeingCare", 0);
            //        cmdUpdateMedBill.Parameters.AddWithValue("@NewOriginalPrescription", String.Empty);
            //        cmdUpdateMedBill.Parameters.AddWithValue("@MedBillNo", MedBillNo);
            //        cmdUpdateMedBill.Parameters.AddWithValue("@IndividualId", IndividualId);

            //        //if (connRN.State == ConnectionState.Closed) connRN.Open();
            //        if (connRN.State != ConnectionState.Closed)
            //        {
            //            connRN.Close();
            //            connRN.Open();
            //        }
            //        else if (connRN.State == ConnectionState.Closed) connRN.Open();
            //        int nAffectedRow = cmdUpdateMedBill.ExecuteNonQuery();
            //        if (connRN.State != ConnectionState.Closed) connRN.Close();

            //        if (nAffectedRow == 1)
            //        {
            //            MessageBox.Show("The Medical Bill has been updated.", "Information");
            //            return;
            //        }
            //        else if (nAffectedRow == 0)
            //        {
            //            MessageBox.Show("The Medical Bill has not been updated.", "Error");
            //            return;
            //        }

            //        bIsModified = false;
            //    }
            //}
            //else if (dlgResult == DialogResult.No)
            //{
            //    //tbCMMManager.TabPages.Remove(tbpgMedicalBill);
            //    //tbCMMManager.SelectedTab = tbCMMManager.TabPages["tbpgCreateCase"];
            //    return;
            //}
        }

        private void btnMedBillCreationPgLowerCancel_Click(object sender, EventArgs e)
        {
            DialogResult dlgClose = MessageBox.Show("Do you want to close Medical Bill page?", "Alert", MessageBoxButtons.YesNo);

            if (dlgClose == DialogResult.Yes)
            {
                DialogResult dlgResult = MessageBox.Show("Do you want save the change?", "Alert", MessageBoxButtons.YesNo);

                if (dlgResult == DialogResult.Yes)
                {
                    String strMedBillNo = txtMedBillNo.Text.Trim();

                    String strSqlQueryForMedBill = "select [dbo].[tbl_medbill].[BillNo] from [dbo].[tbl_medbill] where [dbo].[tbl_medbill].[BillNo] = @MedBillNo";

                    SqlCommand cmdQueryForMedBill = new SqlCommand(strSqlQueryForMedBill, connRN);
                    cmdQueryForMedBill.Parameters.AddWithValue("@MedBillNo", strMedBillNo);

                    //if (connRN.State == ConnectionState.Closed) connRN.Open();
                    if (connRN.State != ConnectionState.Closed)
                    {
                        connRN.Close();
                        connRN.Open();
                    }
                    else if (connRN.State == ConnectionState.Closed) connRN.Open();
                    Object ResultMedBillNo = cmdQueryForMedBill.ExecuteScalar();
                    if (connRN.State != ConnectionState.Closed) connRN.Close();

                    if (ResultMedBillNo == null)
                    {
                        String strIndividualId = String.Empty;
                        String strCaseId = String.Empty;
                        String strBillStatus = String.Empty;
                        String strIllnessId = String.Empty;
                        String strIncidentId = String.Empty;

                        String strNewMedBillNo = String.Empty;
                        String strMedProvider = String.Empty;
                        String strPrescriptionName = String.Empty;
                        String strPrescriptionNo = String.Empty;
                        String strPrescriptionDescription = String.Empty;

                        if (txtIndividualIDMedBill.Text.Trim() != String.Empty) strIndividualId = txtIndividualIDMedBill.Text.Trim();
                        if (txtMedBill_CaseNo.Text.Trim() != String.Empty) strCaseId = txtMedBill_CaseNo.Text.Trim();
                        //if (txtMedicalBillStatus.Text.Trim() != String.Empty) strBillStatus = txtMedicalBillStatus.Text.Trim();

                        //if (txtMedBill_Illness.Text.Trim() != String.Empty) strIllnessId = Illness.IllnessNo;
                        //if (txtMedBill_Incident.Text.Trim() != String.Empty) strIncidentId = txtMedBill_Incident.Text.Trim();

                        if (txtMedBill_Illness.Text.Trim() != String.Empty)
                        {
                            String IllnessNo = txtMedBill_Illness.Text.Trim();

                            String strSqlQueryForIllnessId = "select [dbo].[tbl_illness].[Illness_Id] from [dbo].[tbl_illness] where [dbo].[tbl_illness].[IllnessNo] = @IllnessNo";

                            SqlCommand cmdQueryForIllnessId = new SqlCommand(strSqlQueryForIllnessId, connRN);
                            cmdQueryForIllnessId.CommandType = CommandType.Text;

                            cmdQueryForIllnessId.Parameters.AddWithValue("@IllnessNo", IllnessNo);

                            if (connRN.State != ConnectionState.Closed)
                            {
                                connRN.Close();
                                connRN.Open();
                            }
                            else if (connRN.State == ConnectionState.Closed) connRN.Open();
                            Object objIllnessId = cmdQueryForIllnessId.ExecuteScalar();
                            if (connRN.State != ConnectionState.Closed) connRN.Close();

                            if (objIllnessId != null) strIllnessId = objIllnessId.ToString();
                            else
                            {
                                MessageBox.Show("No Illness Id for given Illness No", "Error");
                                return;
                            }
                        }

                        if (txtMedBill_Incident.Text.Trim() != String.Empty)
                        {
                            String IncidentNo = txtMedBill_Incident.Text.Trim();

                            String strSqlQueryForIncidentId = "select [dbo].[tbl_incident].[Incident_id] from [dbo].[tbl_incident] where [dbo].[tbl_incident].[IncidentNo] = @IncidentNo";

                            SqlCommand cmdQueryForIncidentId = new SqlCommand(strSqlQueryForIncidentId, connRN);
                            cmdQueryForIncidentId.CommandType = CommandType.Text;

                            cmdQueryForIncidentId.Parameters.AddWithValue("@IncidentNo", IncidentNo);

                            if (connRN.State != ConnectionState.Closed)
                            {
                                connRN.Close();
                                connRN.Open();
                            }
                            else if (connRN.State == ConnectionState.Closed) connRN.Open();
                            Object objIncidentId = cmdQueryForIncidentId.ExecuteScalar();
                            if (connRN.State != ConnectionState.Closed) connRN.Close();

                            if (objIncidentId != null) strIncidentId = objIncidentId.ToString();
                            else
                            {
                                MessageBox.Show("No Incident Id for given Incident No", "Error");
                                return;
                            }
                        }


                        if (txtMedBillNo.Text.Trim() != String.Empty) strNewMedBillNo = txtMedBillNo.Text.Trim();

                        String MedicalProvider = String.Empty;

                        if (txtMedicalProvider.Text.Trim() != String.Empty)
                        {
                            MedicalProvider = txtMedicalProvider.Text.Trim();
                        }

                        String PrescriptionName = String.Empty;

                        if (txtPrescriptionName.Text.Trim() != String.Empty)
                        {
                            PrescriptionName = txtPrescriptionName.Text.Trim();
                        }

                        String PrescriptionNo = String.Empty;

                        if (txtNumberOfMedication.Text.Trim() != String.Empty)
                        {
                            PrescriptionNo = txtNumberOfMedication.Text.Trim();
                        }

                        String PrescriptionDescription = String.Empty;

                        if (txtPrescriptionDescription.Text.Trim() != String.Empty)
                        {
                            PrescriptionDescription = txtPrescriptionDescription.Text.Trim();
                        }


                        int nPatientType = 0;   // default outpatient

                        if (rbOutpatient.Checked) nPatientType = 0;
                        else if (rbInpatient.Checked) nPatientType = 1;

                        //int nSelectedMedNote = cbMedicalBillNote1.SelectedIndex;

                        String strNote = String.Empty;

                        if (comboMedBillType.SelectedItem.ToString() == "Medical Bill")
                        {
                            strNote = txtMedBillNote.Text.Trim();
                        }
                        else if (comboMedBillType.SelectedItem.ToString() == "Prescription")
                        {
                            strNote = txtPrescriptionNote.Text.Trim();
                        }
                        else if (comboMedBillType.SelectedItem.ToString() == "Physical Therapy")
                        {
                            strNote = txtPhysicalTherapyRxNote.Text.Trim();
                        }



                        String strSqlInsertNewMedBill = "insert into dbo.tbl_medbill (BillNo, MedBillType_Id, CreatedDate, CreatedById, LastModifiedDate, LastModifiedById, " +
                                                        "LastActivityDate, LastViewedDate, LastReferencedDate, Case_Id, Incident_Id, Illness_Id, BillAmount, SettlementTotal, " +
                                                        "Balance, BillDate, TotalSharedAmount, Individual_Id, Contact_Id, MedicalProvider_Id, PendingReason, " +
                                                        "Account_At_Provider, ProviderPhoneNumber, ProviderContactPerson, " +
                                                        "ProposalLetterSentDate, HIPPASentDate, MedicalRecordDate, " +
                                                        "BillStatus, ProofOfPaymentReceivedDate, IneligibleReason, OriginalPrescription, PersonalResponsibilityCredit, " +
                                                        "WellBeingCareTotal, WellBeingCare, DueDate, TotalNumberOfPhysicalTherapy, " +
                                                        "PrescriptionDrugName, PrescriptionNo, PrescriptionDescription, " +
                                                        "PatientTypeId, Note) " +
                                                        "values (@BillNo, @MedBillType_Id, @CreatedDate, @CreateById, @LastModifiedDate, @LastModifiedById, " +
                                                        "@LastActivityDate, @LastViewedDate, @LastReferencedDate, @Case_Id, @Incident_Id, @Illness_Id, @BillAmount, @SettlementTotal, " +
                                                        "@Balance, @BillDate, @TotalSharedAmount, @Individual_Id, @Contact_Id, @MedicalProvider_Id, @PendingReason, " +
                                                        "@Account_At_Provider, @ProviderPhoneNo, @ProviderContactPerson, " +
                                                        "@ProposalLetterSentDate, @HIPPASentDate, @MedicalRecordDate, " +
                                                        "@BillStatus, @ProofOfPaymentReceivedDate, @IneligibleReason, @OriginalPrescription, @PersonalResponsibilityCredit, " +
                                                        "@WellBeingCareTotal, @WellBeingCare, @DueDate, @TotalNumberOfPhysicalTherapy, " +
                                                        "@PrescriptionDrugName, @PrescriptionNo, @PrescriptionDescription, " +
                                                        "@PatientTypeId, @Note)";

                        SqlCommand cmdInsertNewMedBill = new SqlCommand(strSqlInsertNewMedBill, connRN);
                        cmdInsertNewMedBill.CommandType = CommandType.Text;

                        cmdInsertNewMedBill.Parameters.AddWithValue("@BillNo", strNewMedBillNo);
                        cmdInsertNewMedBill.Parameters.AddWithValue("@MedBillType_Id", comboMedBillType.SelectedIndex + 1);
                        cmdInsertNewMedBill.Parameters.AddWithValue("@CreatedDate", DateTime.Today);
                        cmdInsertNewMedBill.Parameters.AddWithValue("@CreateById", nLoggedUserId);
                        cmdInsertNewMedBill.Parameters.AddWithValue("@LastModifiedDate", DateTime.Today);
                        cmdInsertNewMedBill.Parameters.AddWithValue("@LastModifiedById", nLoggedUserId);
                        cmdInsertNewMedBill.Parameters.AddWithValue("@LastActivityDate", DateTime.Today);
                        cmdInsertNewMedBill.Parameters.AddWithValue("@LastViewedDate", DateTime.Today);
                        cmdInsertNewMedBill.Parameters.AddWithValue("@LastReferencedDate", DateTime.Today);
                        cmdInsertNewMedBill.Parameters.AddWithValue("@Case_Id", strCaseId);
                        cmdInsertNewMedBill.Parameters.AddWithValue("@Incident_Id", strIncidentId);
                        cmdInsertNewMedBill.Parameters.AddWithValue("@Illness_Id", strIllnessId);
                        Decimal dBillAmount = 0;

                        if (!Decimal.TryParse(txtMedBillAmount.Text.Trim(), NumberStyles.Currency, new CultureInfo("en-US"), out dBillAmount))
                        {
                            MessageBox.Show("Bill Amount should be currency value.", "Error");
                            return;
                        }
                        else
                        {
                            cmdInsertNewMedBill.Parameters.AddWithValue("@BillAmount", Decimal.Parse(txtMedBillAmount.Text.Trim(), NumberStyles.Currency, new CultureInfo("en-US")));
                        }
                        cmdInsertNewMedBill.Parameters.AddWithValue("@SettlementTotal", 0);

                        Decimal dBalance = 0;
                        if (!Decimal.TryParse(txtMedBillAmount.Text.Trim(), NumberStyles.Currency, new CultureInfo("en-US"), out dBalance))
                        {
                            MessageBox.Show("Balance should be currency value.", "Error");
                        }
                        else
                        {
                            cmdInsertNewMedBill.Parameters.AddWithValue("@Balance", Decimal.Parse(txtBalance.Text.Trim(), NumberStyles.Currency, new CultureInfo("en-US")));
                        }

                        cmdInsertNewMedBill.Parameters.AddWithValue("@BillDate", dtpBillDate.Value);

                        Decimal TotalSharedAmount = 0;
                        for (int i = 0; i < gvSettlementsInMedBill.Rows.Count; i++)
                        {
                            if ((gvSettlementsInMedBill["SettlementType", i].Value.ToString() == "CMM Provider Payment") ||
                                (gvSettlementsInMedBill["SettlementType", i].Value.ToString() == "CMM Member Reimbursement"))
                                TotalSharedAmount += Decimal.Parse(gvSettlementsInMedBill["SettlementType", i].Value.ToString(), NumberStyles.Currency, new CultureInfo("en-US"));
                            if (gvSettlementsInMedBill["SettlementType", i].Value.ToString() == "Medical Provider Refund")
                                TotalSharedAmount -= Decimal.Parse(gvSettlementsInMedBill["SettlementType", i].Value.ToString(), NumberStyles.Currency, new CultureInfo("en-US"));
                        }

                        cmdInsertNewMedBill.Parameters.AddWithValue("@TotalSharedAmount", TotalSharedAmount);
                        cmdInsertNewMedBill.Parameters.AddWithValue("@Individual_Id", strIndividualId);
                        cmdInsertNewMedBill.Parameters.AddWithValue("@Contact_Id", strIndividualId);
                        foreach (MedicalProviderInfo info in lstMedicalProvider)
                        {
                            if (info.Name == txtMedicalProvider.Text.Trim())
                            {
                                cmdInsertNewMedBill.Parameters.AddWithValue("@MedicalProvider_Id", info.ID);
                                break;
                            }
                        }

                        cmdInsertNewMedBill.Parameters.AddWithValue("@Account_At_Provider", txtMedBillAccountNoAtProvider.Text.Trim());
                        cmdInsertNewMedBill.Parameters.AddWithValue("@ProviderPhoneNo", txtMedProviderPhoneNo.Text.Trim());
                        cmdInsertNewMedBill.Parameters.AddWithValue("@ProviderContactPerson", txtProviderContactPerson.Text.Trim());
                        cmdInsertNewMedBill.Parameters.AddWithValue("@ProposalLetterSentDate", dtpProposalLetterSentDate.Value);
                        cmdInsertNewMedBill.Parameters.AddWithValue("@HIPPASentDate", dtpHippaSentDate.Value);
                        cmdInsertNewMedBill.Parameters.AddWithValue("@MedicalRecordDate", dtpMedicalRecordDate.Value);
                        cmdInsertNewMedBill.Parameters.AddWithValue("@BillStatus", comboMedBillStatus.SelectedIndex);
                        cmdInsertNewMedBill.Parameters.AddWithValue("@ProofOfPaymentReceivedDate", DateTime.Today);
                        cmdInsertNewMedBill.Parameters.AddWithValue("@OriginalPrescription", DBNull.Value);
                        cmdInsertNewMedBill.Parameters.AddWithValue("@PersonalResponsibilityCredit", 500);
                        cmdInsertNewMedBill.Parameters.AddWithValue("@WellBeingCareTotal", 0);
                        cmdInsertNewMedBill.Parameters.AddWithValue("@WellBeingCare", 0);
                        //cmdInsertNewMedBill.Parameters.AddWithValue("@Memo", DBNull.Value);
                        cmdInsertNewMedBill.Parameters.AddWithValue("@DueDate", DateTime.Today);

                        if (comboMedBillType.SelectedIndex == 0)        // Medical Bill Type : Medical Bill
                        {
                            cmdInsertNewMedBill.Parameters.AddWithValue("@PrescriptionDrugName", String.Empty);
                            cmdInsertNewMedBill.Parameters.AddWithValue("@PrescriptionNo", String.Empty);
                            cmdInsertNewMedBill.Parameters.AddWithValue("@PrescriptionDescription", String.Empty);

                            cmdInsertNewMedBill.Parameters.AddWithValue("@TotalNumberOfPhysicalTherapy", 0);

                            cmdInsertNewMedBill.Parameters.AddWithValue("@PatientTypeId", nPatientType);
                            if (comboPendingReason.SelectedIndex == -1) cmdInsertNewMedBill.Parameters.AddWithValue("@PendingReason", 0);
                            else cmdInsertNewMedBill.Parameters.AddWithValue("@PendingReason", comboPendingReason.SelectedIndex);
                            if (comboIneligibleReason.SelectedIndex == -1) cmdInsertNewMedBill.Parameters.AddWithValue("@IneligibleReason", 0);
                            else cmdInsertNewMedBill.Parameters.AddWithValue("@IneligibleReason", comboIneligibleReason.SelectedIndex);

                            cmdInsertNewMedBill.Parameters.AddWithValue("@Note", strNote);
                        }
                        else if (comboMedBillType.SelectedIndex == 1)   // Medical Bill Type : Prescription
                        {
                            cmdInsertNewMedBill.Parameters.AddWithValue("@PatientTypeId", DBNull.Value);
                            cmdInsertNewMedBill.Parameters.AddWithValue("@PendingReason", 0);
                            cmdInsertNewMedBill.Parameters.AddWithValue("@IneligibleReason", 0);

                            cmdInsertNewMedBill.Parameters.AddWithValue("@TotalNumberOfPhysicalTherapy", 0);

                            cmdInsertNewMedBill.Parameters.AddWithValue("@PrescriptionDrugName", txtPrescriptionName.Text.Trim());
                            cmdInsertNewMedBill.Parameters.AddWithValue("@PrescriptionNo", txtNumberOfMedication.Text.Trim());
                            cmdInsertNewMedBill.Parameters.AddWithValue("@PrescriptionDescription", txtPrescriptionDescription.Text.Trim());
                            cmdInsertNewMedBill.Parameters.AddWithValue("@Note", strNote);
                        }
                        else if (comboMedBillType.SelectedIndex == 2)   // Medical Bill Type : Physical Therapy
                        {
                            cmdInsertNewMedBill.Parameters.AddWithValue("@PrescriptionDrugName", String.Empty);
                            cmdInsertNewMedBill.Parameters.AddWithValue("@PrescriptionNo", String.Empty);
                            cmdInsertNewMedBill.Parameters.AddWithValue("@PrescriptionDescription", String.Empty);

                            cmdInsertNewMedBill.Parameters.AddWithValue("@PatientTypeId", DBNull.Value);
                            cmdInsertNewMedBill.Parameters.AddWithValue("@PendingReason", 0);
                            cmdInsertNewMedBill.Parameters.AddWithValue("@IneligibleReason", 0);

                            int nNumberOfPhysicalTherapy = 0;
                            short result = 0;
                            if (Int16.TryParse(txtNumPhysicalTherapy.Text.Trim(), out result))
                            {
                                nNumberOfPhysicalTherapy = result;
                                cmdInsertNewMedBill.Parameters.AddWithValue("@TotalNumberOfPhysicalTherapy", nNumberOfPhysicalTherapy);
                            }
                            else MessageBox.Show("Please enter a positive integer in Number of Physical Therapy Text Box.", "Alert");

                            cmdInsertNewMedBill.Parameters.AddWithValue("@Note", strNote);
                        }

                        //if (connRN.State == ConnectionState.Closed) connRN.Open();
                        if (connRN.State != ConnectionState.Closed)
                        {
                            connRN.Close();
                            connRN.Open();
                        }
                        else if (connRN.State == ConnectionState.Closed) connRN.Open();
                        int nRowInserted = cmdInsertNewMedBill.ExecuteNonQuery();
                        if (connRN.State != ConnectionState.Closed) connRN.Close();

                        if (nRowInserted == 1)
                        {
                            MessageBox.Show("The Medical Bill has been saved.", "Information");
                        }
                        else if (nRowInserted == 0)
                        {
                            MessageBox.Show("The Medical Bill has not been saved.", "Error");
                        }

                        bIsModified = false;

                        tbCMMManager.TabPages.Remove(tbpgMedicalBill);
                        tbCMMManager.SelectedTab = tbCMMManager.TabPages["tbpgCreateCase"];

                    }
                    else if (ResultMedBillNo.ToString() == strMedBillNo)
                    {
                        // update the med bill

                        String MedBillNo = txtMedBillNo.Text.Trim();
                        String IndividualId = txtIndividualIDMedBill.Text.Trim();

                        String strIllnessId = String.Empty;
                        String strIncidentId = String.Empty;

                        if (txtMedBill_Illness.Text.Trim() != String.Empty)
                        {
                            String IllnessNo = txtMedBill_Illness.Text.Trim();

                            String strSqlQueryForIllnessId = "select [dbo].[tbl_illness].[Illness_Id] from [dbo].[tbl_illness] where [dbo].[tbl_illness].[IllnessNo] = @IllnessNo";

                            SqlCommand cmdQueryForIllnessId = new SqlCommand(strSqlQueryForIllnessId, connRN);
                            cmdQueryForIllnessId.CommandType = CommandType.Text;

                            cmdQueryForIllnessId.Parameters.AddWithValue("@IllnessNo", IllnessNo);

                            if (connRN.State != ConnectionState.Closed)
                            {
                                connRN.Close();
                                connRN.Open();
                            }
                            else if (connRN.State == ConnectionState.Closed) connRN.Open();
                            Object objIllnessId = cmdQueryForIllnessId.ExecuteScalar();
                            if (connRN.State != ConnectionState.Closed) connRN.Close();

                            if (objIllnessId != null) strIllnessId = objIllnessId.ToString();
                            else
                            {
                                MessageBox.Show("No Illness Id for given Illness No", "Error");
                                return;
                            }
                        }

                        if (txtMedBill_Incident.Text.Trim() != String.Empty)
                        {
                            String IncidentNo = txtMedBill_Incident.Text.Trim();

                            String strSqlQueryForIncidentId = "select [dbo].[tbl_incident].[Incident_id] from [dbo].[tbl_incident] where [dbo].[tbl_incident].[IncidentNo] = @IncidentNo";

                            SqlCommand cmdQueryForIncidentId = new SqlCommand(strSqlQueryForIncidentId, connRN);
                            cmdQueryForIncidentId.CommandType = CommandType.Text;

                            cmdQueryForIncidentId.Parameters.AddWithValue("@IncidentNo", IncidentNo);

                            if (connRN.State != ConnectionState.Closed)
                            {
                                connRN.Close();
                                connRN.Open();
                            }
                            else if (connRN.State == ConnectionState.Closed) connRN.Open();
                            Object objIncidentId = cmdQueryForIncidentId.ExecuteScalar();
                            if (connRN.State != ConnectionState.Closed) connRN.Close();

                            if (objIncidentId != null) strIncidentId = objIncidentId.ToString();
                            else
                            {
                                MessageBox.Show("No Incident Id for given Incident No", "Error");
                                return;
                            }
                        }


                        // Get illness id for ICD 10 Code
                        //String strSqlQueryForIllnessId = "select [dbo].[tbl_illness].[Illness_Id] from [dbo].[tbl_illness] " +
                        //                                    "where [dbo].[tbl_illness].[Individual_Id] = @IndividualId and [dbo].[tbl_illness].[ICD_10_Id] = @ICD10Code";

                        //SqlCommand cmdQueryForIllnessId = new SqlCommand(strSqlQueryForIllnessId, connRN);
                        //cmdQueryForIllnessId.CommandType = CommandType.Text;

                        //cmdQueryForIllnessId.Parameters.AddWithValue("@IndividualId", IndividualId);
                        //cmdQueryForIllnessId.Parameters.AddWithValue("@ICD10Code", txtMedBill_Illness.Text.Trim());

                        ////if (connRN.State == ConnectionState.Closed) connRN.Open();
                        //if (connRN.State != ConnectionState.Closed)
                        //{
                        //    connRN.Close();
                        //    connRN.Open();
                        //}
                        //else if (connRN.State == ConnectionState.Closed) connRN.Open();
                        ////int nIllnessId = Int32.Parse(cmdQueryForIllnessId.ExecuteScalar().ToString());
                        //Object objIllnessId = cmdQueryForIllnessId.ExecuteScalar();
                        //if (connRN.State != ConnectionState.Closed) connRN.Close();

                        //int? nIllnessId = null;

                        //if (objIllnessId != null)
                        //{
                        //    int IllnessIdResult = 0;
                        //    if (Int32.TryParse(objIllnessId.ToString(), NumberStyles.Integer, new CultureInfo("en-US"), out IllnessIdResult)) nIllnessId = IllnessIdResult;
                        //}

                        // Get medical provider id
                        //String strSqlQueryForMedicalProviderId = "select [dbo].[tbl_MedicalProvider].[ID] from [dbo].[tbl_MedicalProvider] where [dbo].[tbl_MedicalProvider].[Name] = @MedicalProviderName";
                        String strSqlQueryForMedicalProviderId = "select [dbo].[account].[ID] from [dbo].[account] where [dbo].[account].[Name] = @MedicalProviderName";


                        SqlCommand cmdQueryForMedicalProviderId = new SqlCommand(strSqlQueryForMedicalProviderId, connSalesforce3);
                        cmdQueryForMedicalProviderId.CommandType = CommandType.Text;

                        cmdQueryForMedicalProviderId.Parameters.AddWithValue("@MedicalProviderName", txtMedicalProvider.Text.Trim());

                        //if (connRN.State == ConnectionState.Closed) connRN.Open();
                        if (connSalesforce3.State != ConnectionState.Closed)
                        {
                            connSalesforce3.Close();
                            connSalesforce3.Open();
                        }
                        else if (connSalesforce3.State == ConnectionState.Closed) connSalesforce3.Open();
                        //String MedicalProviderId = cmdQueryForMedicalProviderId.ExecuteScalar().ToString();
                        Object objMedicalProviderId = cmdQueryForMedicalProviderId.ExecuteScalar();
                        if (connSalesforce3.State != ConnectionState.Closed) connSalesforce3.Close();

                        String MedicalProviderId = String.Empty;

                        if (objMedicalProviderId != null) MedicalProviderId = objMedicalProviderId.ToString();

                        int nPatientType = 0;   // default is outpatient

                        if (rbOutpatient.Checked) nPatientType = 0;
                        else if (rbInpatient.Checked) nPatientType = 1;

                        String strNote = String.Empty;

                        if (comboMedBillType.SelectedItem.ToString() == "Medical Bill")
                        {
                            strNote = txtMedBillNote.Text.Trim();
                        }
                        else if (comboMedBillType.SelectedItem.ToString() == "Prescription")
                        {
                            strNote = txtPrescriptionNote.Text.Trim();
                        }
                        else if (comboMedBillType.SelectedItem.ToString() == "Physical Therapy")
                        {
                            strNote = txtPhysicalTherapyRxNote.Text.Trim();
                        }

                        // Update the Medical Bill
                        String strSqlUpdateMedBill = "update [dbo].[tbl_medbill] set [dbo].[tbl_medbill].[LastModifiedDate] = @NewLastModifiedDate, [dbo].[tbl_medbill].[LastModifiedById] = @NewLastModifiedById, " +
                                                         "[dbo].[tbl_medbill].[Case_Id] = @NewCaseId, [dbo].[tbl_medbill].[Incident_Id] = @NewIncidentId, [dbo].[tbl_medbill].[Illness_Id] = @NewIllnessId, " +
                                                         "[dbo].[tbl_medbill].[BillAmount] = @NewBillAmount, [dbo].[tbl_medbill].[MedBillType_Id] = @NewMedBillType_Id, " +
                                                         "[dbo].[tbl_medbill].[SettlementTotal] = @NewSettlementTotal, [dbo].[tbl_medbill].[Balance] = @NewBalance, " +
                                                         "[dbo].[tbl_medbill].[BillDate] = @NewBillDate, [dbo].[tbl_medbill].[DueDate] = @NewDueDate, [dbo].[tbl_medbill].[TotalSharedAmount] = @NewTotalSharedAmount, " +
                                                         "[dbo].[tbl_medbill].[Guarantor] = @NewGuarantor, " +
                                                         "[dbo].[tbl_medbill].[MedicalProvider_Id] = @NewMedicalProviderId, " +
                                                         "[dbo].[tbl_medbill].[Account_At_Provider] = @NewAccountAtProvider, " +
                                                         "[dbo].[tbl_medbill].[ProviderPhoneNumber] = @NewProviderPhoneNo, " +
                                                         "[dbo].[tbl_medbill].[ProviderContactPerson] = @NewProviderContactPerson, " +
                                                         "[dbo].[tbl_medbill].[ProposalLetterSentDate] = @NewProposalLetterSentDate, " +
                                                         "[dbo].[tbl_medbill].[HIPPASentDate] = @NewHIPPASentDate, " +
                                                         "[dbo].[tbl_medbill].[MedicalRecordDate] = @NewMedicalRecordDate, " +
                                                         "[dbo].[tbl_medbill].[PrescriptionDrugName] = @NewPrescriptionDrugName, [dbo].[tbl_medbill].[PrescriptionNo] = @NewPrescriptionNo, " +
                                                         "[dbo].[tbl_medbill].[PrescriptionDescription] = @NewPrescriptionDescription, " +
                                                         "[dbo].[tbl_medbill].[TotalNumberOfPhysicalTherapy] = @NewTotalNumberOfPhysicalTherapy, " +
                                                         "[dbo].[tbl_medbill].[PatientTypeId] = @NewPatientTypeId, " +
                                                         "[dbo].[tbl_medbill].[Note] = @Note, " +
                                                         "[dbo].[tbl_medbill].[WellBeingCareTotal] = @NewWellBeingCareTotal, [dbo].[tbl_medbill].[WellBeingCare] = @NewWellBeingCare, " +
                                                         "[dbo].[tbl_medbill].[IneligibleReason] = @NewIneligibleReason, [dbo].[tbl_medbill].[PendingReason] = @NewPendingReason, " +
                                                         "[dbo].[tbl_medbill].[OriginalPrescription] = @NewOriginalPrescription " +
                                                         "where [dbo].[tbl_medbill].[BillNo] = @MedBillNo and [dbo].[tbl_medbill].[Contact_Id] = @IndividualId";

                        SqlCommand cmdUpdateMedBill = new SqlCommand(strSqlUpdateMedBill, connRN);
                        cmdUpdateMedBill.CommandType = CommandType.Text;

                        cmdUpdateMedBill.Parameters.AddWithValue("@NewLastModifiedDate", DateTime.Today.ToString("MM/dd/yyyy"));
                        cmdUpdateMedBill.Parameters.AddWithValue("@NewLastModifiedById", nLoggedUserId);
                        cmdUpdateMedBill.Parameters.AddWithValue("@NewCaseId", txtMedBill_CaseNo.Text.Trim());
                        cmdUpdateMedBill.Parameters.AddWithValue("@NewIncidentId", strIncidentId);
                        cmdUpdateMedBill.Parameters.AddWithValue("@NewIllnessId", strIllnessId);
                        cmdUpdateMedBill.Parameters.AddWithValue("@NewBillAmount", Decimal.Parse(txtMedBillAmount.Text.Substring(1).Trim()));
                        cmdUpdateMedBill.Parameters.AddWithValue("@NewMedBillType_Id", comboMedBillType.SelectedIndex + 1);
                        cmdUpdateMedBill.Parameters.AddWithValue("@NewSettlementTotal", 0);
                        cmdUpdateMedBill.Parameters.AddWithValue("@NewBalance", 0);
                        cmdUpdateMedBill.Parameters.AddWithValue("@NewBillDate", dtpBillDate.Value);
                        cmdUpdateMedBill.Parameters.AddWithValue("@NewDueDate", dtpDueDate.Value);
                        cmdUpdateMedBill.Parameters.AddWithValue("@NewTotalSharedAmount", 0);
                        cmdUpdateMedBill.Parameters.AddWithValue("@NewGuarantor", txtMedBillGuarantor.Text.Trim());
                        cmdUpdateMedBill.Parameters.AddWithValue("@NewMedicalProviderId", MedicalProviderId);
                        cmdUpdateMedBill.Parameters.AddWithValue("@NewAccountAtProvider", txtMedBillAccountNoAtProvider.Text.Trim());
                        cmdUpdateMedBill.Parameters.AddWithValue("@NewProviderPhoneNo", txtMedProviderPhoneNo.Text.Trim());
                        cmdUpdateMedBill.Parameters.AddWithValue("@NewProviderContactPerson", txtProviderContactPerson.Text.Trim());
                        cmdUpdateMedBill.Parameters.AddWithValue("@NewProposalLetterSentDate", dtpProposalLetterSentDate.Value);
                        cmdUpdateMedBill.Parameters.AddWithValue("@NewHIPPASentDate", dtpHippaSentDate.Value);
                        cmdUpdateMedBill.Parameters.AddWithValue("@NewMedicalRecordDate", dtpMedicalRecordDate.Value);

                        if (comboMedBillType.SelectedIndex == 0)        // Medical Bill Type - Medical Bill
                        {
                            cmdUpdateMedBill.Parameters.AddWithValue("@NewPrescriptionDrugName", String.Empty);
                            cmdUpdateMedBill.Parameters.AddWithValue("@NewPrescriptionNo", String.Empty);
                            cmdUpdateMedBill.Parameters.AddWithValue("@NewPrescriptionDescription", String.Empty);

                            cmdUpdateMedBill.Parameters.AddWithValue("@NewTotalNumberOfPhysicalTherapy", 0);

                            cmdUpdateMedBill.Parameters.AddWithValue("@NewPatientTypeId", nPatientType);
                            if (comboPendingReason.SelectedIndex == -1) cmdUpdateMedBill.Parameters.AddWithValue("@NewPendingReason", 0);
                            else cmdUpdateMedBill.Parameters.AddWithValue("@NewPendingReason", comboPendingReason.SelectedIndex);
                            if (comboIneligibleReason.SelectedIndex == -1) cmdUpdateMedBill.Parameters.AddWithValue("@NewIneligibleReason", 0);
                            else cmdUpdateMedBill.Parameters.AddWithValue("@NewIneligibleReason", comboIneligibleReason.SelectedIndex);

                            cmdUpdateMedBill.Parameters.AddWithValue("@Note", strNote);

                        }
                        if (comboMedBillType.SelectedIndex == 1)        // Medical Bill Type - Prescription
                        {
                            cmdUpdateMedBill.Parameters.AddWithValue("@NewPatientTypeId", DBNull.Value);
                            cmdUpdateMedBill.Parameters.AddWithValue("@NewPendingReason", 0);
                            cmdUpdateMedBill.Parameters.AddWithValue("@NewIneligibleReason", 0);

                            cmdUpdateMedBill.Parameters.AddWithValue("@NewTotalNumberOfPhysicalTherapy", 0);

                            cmdUpdateMedBill.Parameters.AddWithValue("@NewPrescriptionDrugName", txtPrescriptionName.Text.Trim());
                            cmdUpdateMedBill.Parameters.AddWithValue("@NewPrescriptionNo", txtNumberOfMedication.Text.Trim());
                            cmdUpdateMedBill.Parameters.AddWithValue("@NewPrescriptionDescription", txtPrescriptionDescription.Text.Trim());

                            cmdUpdateMedBill.Parameters.AddWithValue("@Note", strNote);
                        }
                        if (comboMedBillType.SelectedIndex == 2)        // Medical Bill Type - Physical Therapy
                        {
                            cmdUpdateMedBill.Parameters.AddWithValue("@NewPrescriptionDrugName", String.Empty);
                            cmdUpdateMedBill.Parameters.AddWithValue("@NewPrescriptionNo", String.Empty);
                            cmdUpdateMedBill.Parameters.AddWithValue("@NewPrescriptionDescription", String.Empty);

                            cmdUpdateMedBill.Parameters.AddWithValue("@NewPatientTypeId", DBNull.Value);
                            cmdUpdateMedBill.Parameters.AddWithValue("@NewPendingReason", 0);
                            cmdUpdateMedBill.Parameters.AddWithValue("@NewIneligibleReason", 0);

                            int nNumberOfPhysicalTherapy = 0;
                            short result = 0;
                            if (Int16.TryParse(txtNumPhysicalTherapy.Text.Trim(), out result))
                            {
                                nNumberOfPhysicalTherapy = result;
                                cmdUpdateMedBill.Parameters.AddWithValue("@NewTotalNumberOfPhysicalTherapy", nNumberOfPhysicalTherapy);
                            }
                            else MessageBox.Show("Please enter a positive integer in Number of Physical Therapy Text Box.", "Alert");

                            cmdUpdateMedBill.Parameters.AddWithValue("@Note", strNote);
                        }


                        cmdUpdateMedBill.Parameters.AddWithValue("@NewWellBeingCareTotal", 0);
                        cmdUpdateMedBill.Parameters.AddWithValue("@NewWellBeingCare", 0);
                        cmdUpdateMedBill.Parameters.AddWithValue("@NewOriginalPrescription", String.Empty);
                        cmdUpdateMedBill.Parameters.AddWithValue("@MedBillNo", MedBillNo);
                        cmdUpdateMedBill.Parameters.AddWithValue("@IndividualId", IndividualId);

                        //if (connRN.State == ConnectionState.Closed) connRN.Open();
                        if (connRN.State != ConnectionState.Closed)
                        {
                            connRN.Close();
                            connRN.Open();
                        }
                        else if (connRN.State == ConnectionState.Closed) connRN.Open();
                        int nAffectedRow = cmdUpdateMedBill.ExecuteNonQuery();
                        if (connRN.State != ConnectionState.Closed) connRN.Close();

                        if (nAffectedRow == 1)
                        {
                            MessageBox.Show("The Medical Bill has been updated.", "Information");
                        }
                        else if (nAffectedRow == 0)
                        {
                            MessageBox.Show("The Medical Bill has not been updated.", "Error");
                        }

                        bIsModified = false;

                        tbCMMManager.TabPages.Remove(tbpgMedicalBill);
                        tbCMMManager.SelectedIndex = 4;

                    }
                }
                else if (dlgResult == DialogResult.No)
                {
                    tbCMMManager.TabPages.Remove(tbpgMedicalBill);
                    tbCMMManager.SelectedTab = tbCMMManager.TabPages["tbpgCreateCase"];
                    return;
                }
            }
            else
            {
                return;
            }

        }

        private void btnIndViewUpdateUpperRight_Click(object sender, EventArgs e)
        {
            Cursor.Current = Cursors.WaitCursor;

            String IndividualIdForUpdate = txtIndividualID.Text.Trim();

            //int nPreferredLanguage = 0;
            String PreferredLanguage = String.Empty;

            if (rbKorean.Checked) PreferredLanguage = "Korean";
            else if (rbEnglish.Checked) PreferredLanguage = "English";
            //else
            //{
            //    MessageBox.Show("Please selected the preferred language.", "Error");
            //    return;
            //}

            String PreferredCommMethod = String.Empty;
            if (cbPreferredCommunication.SelectedItem != null) PreferredCommMethod = cbPreferredCommunication.SelectedItem.ToString();
            //else
            //{
            //    MessageBox.Show("Please select the preferred communication method.", "Error");
            //    return;
            //}

            String ReimbursementMethod = String.Empty;
            if (cbReimbursementMethod.SelectedItem != null) ReimbursementMethod = cbReimbursementMethod.SelectedItem.ToString();
            //else
            //{
            //    MessageBox.Show("Please select the reimbursement method.", "Error");
            //    return;
            //}

            String strSqlUpdateIndividualInfo = "update [dbo].[contact] set [dbo].[contact].[PreferredLanguage__c] = @PreferredLanguage, " +
                                                "[dbo].[contact].[PreferredCommunicationMethod__c] = @PreferredCommMethod, " +
                                                "[dbo].[contact].[FirstName] = @FirstName, " +
                                                "[dbo].[contact].[MiddleName] = @MiddleName, " +
                                                "[dbo].[contact].[LastName] = @LastName, " +
                                                "[dbo].[contact].[Birthdate] = @BirthDate, " +
                                                "[dbo].[contact].[CMM_Gender__c] = @Gender, " +
                                                "[dbo].[contact].[Social_Security_Number__c] = @SSN, " +
                                                "[dbo].[contact].[MailingStreet] = @ShippingStreet, " +
                                                "[dbo].[contact].[MailingCity] = @ShippingCity, " +
                                                "[dbo].[contact].[MailingState] = @ShippingState, " +
                                                "[dbo].[contact].[MailingPostalCode] = @ShippingZipCode, " +
                                                "[dbo].[contact].[OtherStreet] = @BillingStreet, " +
                                                "[dbo].[contact].[OtherCity] = @BillingCity, " +
                                                "[dbo].[contact].[OtherState] = @BillingState, " +
                                                "[dbo].[contact].[OtherPostalCode] = @BillingZipCode, " +
                                                "[dbo].[contact].[Email] = @Email, " +
                                                "[dbo].[contact].[Phone] = @Phone, " +
                                                "[dbo].[contact].[HomePhone] = @HomePhone, " +
                                                "[dbo].[contact].[PowerOfAttorney__c] = @PowerOfAttorney, " +
                                                "[dbo].[contact].[Relationship_POA__c] = @Relationship, " +
                                                "[dbo].[contact].[ReimbursementMethod__c] = @ReimbursementMethod, " +
                                                "[dbo].[contact].[BankName__c] = @BankName, " +
                                                "[dbo].[contact].[RoutingNumber__c] = @BankRoutingNumber, " +
                                                "[dbo].[contact].[AccountNumber__c] = @AccountNumber, " +
                                                "[dbo].[contact].[AccountHolder__c] = @AccountHolder, " +
                                                "[dbo].[contact].[c4g_Church__c] = @ChurchId " +
                                                "where [dbo].[contact].[Individual_ID__c] = @IndividualId";

            SqlCommand cmdUpdateIndividualInfo = new SqlCommand(strSqlUpdateIndividualInfo, connSalesforce);
            cmdUpdateIndividualInfo.CommandType = CommandType.Text;

            if (PreferredLanguage != String.Empty) cmdUpdateIndividualInfo.Parameters.AddWithValue("@PreferredLanguage", PreferredLanguage);
            else cmdUpdateIndividualInfo.Parameters.AddWithValue("@PreferredLanguage", DBNull.Value);
            if (PreferredCommMethod != String.Empty) cmdUpdateIndividualInfo.Parameters.AddWithValue("@PreferredCommMethod", PreferredCommMethod);
            else cmdUpdateIndividualInfo.Parameters.AddWithValue("@PreferredCommMethod", DBNull.Value);
            cmdUpdateIndividualInfo.Parameters.AddWithValue("@FirstName", txtFirstName.Text.Trim());
            cmdUpdateIndividualInfo.Parameters.AddWithValue("@MiddleName", txtMiddleName.Text.Trim());
            cmdUpdateIndividualInfo.Parameters.AddWithValue("@LastName", txtLastName.Text.Trim());
            cmdUpdateIndividualInfo.Parameters.AddWithValue("@BirthDate", dtpBirthDate.Value);
            cmdUpdateIndividualInfo.Parameters.AddWithValue("@Gender", cbGender.SelectedIndex);
            cmdUpdateIndividualInfo.Parameters.AddWithValue("@SSN", txtIndividualSSN.Text.Trim());
            cmdUpdateIndividualInfo.Parameters.AddWithValue("@ShippingStreet", txtStreetAddress1.Text.Trim());
            cmdUpdateIndividualInfo.Parameters.AddWithValue("@ShippingCity", txtCity1.Text.Trim());
            cmdUpdateIndividualInfo.Parameters.AddWithValue("@ShippingState", txtState1.Text.Trim());
            cmdUpdateIndividualInfo.Parameters.AddWithValue("@ShippingZipCode", txtZip1.Text.Trim());
            cmdUpdateIndividualInfo.Parameters.AddWithValue("@BillingStreet", txtStreetAddress2.Text.Trim());
            cmdUpdateIndividualInfo.Parameters.AddWithValue("@BillingCity", txtCity2.Text.Trim());
            cmdUpdateIndividualInfo.Parameters.AddWithValue("@BillingState", txtState2.Text.Trim());
            cmdUpdateIndividualInfo.Parameters.AddWithValue("@BillingZipCode", txtZip2.Text.Trim());
            cmdUpdateIndividualInfo.Parameters.AddWithValue("@Email", txtEmail.Text.Trim());
            cmdUpdateIndividualInfo.Parameters.AddWithValue("@Phone", txtCellPhone1.Text.Trim());
            cmdUpdateIndividualInfo.Parameters.AddWithValue("@HomePhone", txtBusinessPhone.Text.Trim());
            cmdUpdateIndividualInfo.Parameters.AddWithValue("@PowerOfAttorney", txtPowerOfAttorney.Text.Trim());
            cmdUpdateIndividualInfo.Parameters.AddWithValue("@Relationship", txtRelationship.Text.Trim());
            if (ReimbursementMethod != String.Empty) cmdUpdateIndividualInfo.Parameters.AddWithValue("@ReimbursementMethod", ReimbursementMethod);
            else cmdUpdateIndividualInfo.Parameters.AddWithValue("@ReimbursementMethod", DBNull.Value);
            cmdUpdateIndividualInfo.Parameters.AddWithValue("@BankName", txtBankName.Text.Trim());
            cmdUpdateIndividualInfo.Parameters.AddWithValue("@BankRoutingNumber", txtBankRoutingNo.Text.Trim());
            cmdUpdateIndividualInfo.Parameters.AddWithValue("@AccountNumber", txtAccountNo.Text.Trim());
            cmdUpdateIndividualInfo.Parameters.AddWithValue("@AccountHolder", txtAccountHolder.Text.Trim());

            if (txtIndChurchName.Text.Trim() != String.Empty)
            {
                Boolean bInChurchList = false;
                foreach (ChurchInfo info in lstChurchInfo)
                {
                    if (info.Name.Trim() == txtIndChurchName.Text.Trim())
                    {
                        cmdUpdateIndividualInfo.Parameters.AddWithValue("@ChurchId", info.ID);
                        bInChurchList = true;
                        break;
                    }
                }
                if (!bInChurchList)
                {
                    MessageBox.Show("The church name is not in the list.", "Error");
                    //cmdUpdateIndividualInfo.Parameters.AddWithValue("@ChurchId", DBNull.Value);
                    return;
                }
            }
            else
            {
                cmdUpdateIndividualInfo.Parameters.AddWithValue("@ChurchId", DBNull.Value);
            }

            cmdUpdateIndividualInfo.Parameters.AddWithValue("@IndividualId", IndividualIdForUpdate);

            if (connSalesforce.State == ConnectionState.Open)
            {
                connSalesforce.Close();
                connSalesforce.Open();
            }
            else if (connSalesforce.State == ConnectionState.Closed) connSalesforce.Open();

            int nRowAffected = cmdUpdateIndividualInfo.ExecuteNonQuery();
            if (connSalesforce.State == ConnectionState.Open) connSalesforce.Close();

            if (nRowAffected == 1)
            {
                MessageBox.Show("The individual information has been updated.", "Information");
                return;
            }
            else
            {
                MessageBox.Show("The individual information has not been updated.", "Error");
                return;
            }
            //Cursor.Current = Cursors.Default;
        }



        private void btnIndViewCancelUpperRight_Click(object sender, EventArgs e)
        {
            DialogResult dlgResult = MessageBox.Show("Do you want to close Individual Page?", "Alert", MessageBoxButtons.YesNo);

            if (dlgResult == DialogResult.Yes)
            {

                // This if statement should be commented out
                //if (tbCMMManager.Contains(tbpgCaseView))
                //{
                //    MessageBox.Show("Case View page is open. Close Case View page first.", "Alert");
                //    return;
                //}
                /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

                //if (tbCMMManager.Contains(tbpgMedicalBill))
                //{
                //    DialogResult dlgSaveMedBill = MessageBox.Show("Do you want to save the Medical Bill?", "Alert", MessageBoxButtons.YesNo);

                //    if (dlgSaveMedBill == DialogResult.Yes)
                //    {
                //        SaveMedBill();
                //        tbCMMManager.TabPages.Remove(tbpgMedicalBill);
                //        SaveCase();
                //        tbCMMManager.TabPages.Remove(tbpgCreateCase);
                //        tbCMMManager.TabPages.Remove(tbpgCaseView);
                //    }
                //    else if (dlgSaveMedBill == DialogResult.No)
                //    {
                //        tbCMMManager.TabPages.Remove(tbpgMedicalBill);
                //        DialogResult dlgSaveCase = MessageBox.Show("Do you want to save the Case?", "Alert", MessageBoxButtons.YesNo);
                //        if (dlgSaveCase == DialogResult.Yes)
                //        {
                //            SaveCase();
                //            tbCMMManager.TabPages.Remove(tbpgCreateCase);
                //            tbCMMManager.TabPages.Remove(tbpgCaseView);
                //        }
                //        else if (dlgSaveCase == DialogResult.No)
                //        {
                //            tbCMMManager.TabPages.Remove(tbpgCreateCase);
                //            tbCMMManager.TabPages.Remove(tbpgCaseView);

                //            DialogResult dlgSaveIndividual = MessageBox.Show("Do you want to update individual information?", "Alert", MessageBoxButtons.YesNo);
                //            if (dlgSaveIndividual == DialogResult.Yes)
                //            {
                //                UpdateIndividualInfo();
                //                tbCMMManager.TabPages.Remove(tbpgIndividual);
                //            }
                //            else if (dlgSaveIndividual == DialogResult.No)
                //            {
                //                tbCMMManager.TabPages.Remove(tbpgIndividual);
                //            }
                //        }
                //    }
                //}
                //else if (tbCMMManager.Contains(tbpgCreateCase))
                //{
                //    DialogResult dlgSaveCase = MessageBox.Show("Do you want to save the Case?", "Alert", MessageBoxButtons.YesNo);

                //    if (dlgSaveCase == DialogResult.Yes)
                //    {
                //        SaveCase();
                //        tbCMMManager.TabPages.Remove(tbpgCreateCase);
                //        tbCMMManager.TabPages.Remove(tbpgCaseView);

                //        DialogResult dlgSaveIndividualInfo = MessageBox.Show("Do you want to update the Individual Information?", "Alert", MessageBoxButtons.YesNo);
                //        if (dlgSaveIndividualInfo == DialogResult.Yes)
                //        {
                //            UpdateIndividualInfo();
                //            tbCMMManager.TabPages.Remove(tbpgIndividual);
                //        }
                //        else if (dlgSaveIndividualInfo == DialogResult.No)
                //        {
                //            tbCMMManager.TabPages.Remove(tbpgIndividual);
                //        }

                //    }
                //    else if (dlgSaveCase == DialogResult.No)
                //    {
                //        tbCMMManager.TabPages.Remove(tbpgCreateCase);
                //        tbCMMManager.TabPages.Remove(tbpgCaseView);

                //        DialogResult dlgSaveIndividualInfo = MessageBox.Show("Do you want to update the Individual Information?", "Alert", MessageBoxButtons.YesNo);
                //        if (dlgSaveIndividualInfo == DialogResult.Yes)
                //        {
                //            UpdateIndividualInfo();
                //            tbCMMManager.TabPages.Remove(tbpgIndividual);
                //        }
                //        else if (dlgSaveIndividualInfo == DialogResult.No)
                //        {
                //            tbCMMManager.TabPages.Remove(tbpgIndividual);
                //        }
                //    }
                //}

                DialogResult dlgSaveResult = MessageBox.Show("Do you want to update the Individual Information?", "Alert", MessageBoxButtons.YesNo);

                if (dlgSaveResult == DialogResult.Yes)
                {
                    // Save individual info
                    String IndividualIdForUpdate = txtIndividualID.Text.Trim();

                    int nPreferredLanguage = 0;

                    if (rbKorean.Checked) nPreferredLanguage = 0;
                    else if (rbEnglish.Checked) nPreferredLanguage = 1;

                    String strSqlUpdateIndividualInfo = "update [dbo].[contact] set [dbo].[contact].[PreferredLanguage] = @PreferredLanguage, " +
                                                        "[dbo].[contact].[PreferredCommunicationMethod] = @PreferredCommMethod, " +
                                                        "[dbo].[contact].[FirstName] = @FirstName, " +
                                                        "[dbo].[contact].[MiddleName] = @MiddleName, " +
                                                        "[dbo].[contact].[LastName] = @LastName, " +
                                                        "[dbo].[contact].[Birthdate] = @BirthDate, " +
                                                        "[dbo].[contact].[CMM_Gender__c] = @Gender, " +
                                                        "[dbo].[contact].[Social_Security_Number__c] = @SSN, " +
                                                        "[dbo].[contact].[MailingStreet] = @ShippingStreet, " +
                                                        "[dbo].[contact].[MailingCity] = @ShippingCity, " +
                                                        "[dbo].[contact].[MailingState] = @ShippingState, " +
                                                        "[dbo].[contact].[MailingPostalCode] = @ShippingZipCode, " +
                                                        "[dbo].[contact].[OtherStreet] = @BillingStreet, " +
                                                        "[dbo].[contact].[OtherCity] = @BillingCity, " +
                                                        "[dbo].[contact].[OtherState] = @BillingState, " +
                                                        "[dbo].[contact].[OtherPostalCode] = @BillingZipCode, " +
                                                        "[dbo].[contact].[Email] = @Email, " +
                                                        "[dbo].[contact].[Phone] = @Phone, " +
                                                        "[dbo].[contact].[HomePhone] = @HomePhone, " +
                                                        "[dbo].[contact].[PowerOfAttorney] = @PowerOfAttorney, " +
                                                        "[dbo].[contact].[Relationship] = @Relationship, " +
                                                        "[dbo].[contact].[ReimbursementMethod] = @ReimbursementMethod, " +
                                                        "[dbo].[contact].[c4g_Church__c] = @ChurchId " +
                                                        "where [dbo].[contact].[Individual_ID__c] = @IndividualId";

                    SqlCommand cmdUpdateIndividualInfo = new SqlCommand(strSqlUpdateIndividualInfo, connSalesforce);
                    cmdUpdateIndividualInfo.CommandType = CommandType.Text;

                    cmdUpdateIndividualInfo.Parameters.AddWithValue("@PreferredLanguage", nPreferredLanguage);
                    cmdUpdateIndividualInfo.Parameters.AddWithValue("@PreferredCommMethod", cbPreferredCommunication.SelectedIndex);
                    cmdUpdateIndividualInfo.Parameters.AddWithValue("@FirstName", txtFirstName.Text.Trim());
                    cmdUpdateIndividualInfo.Parameters.AddWithValue("@MiddleName", txtMiddleName.Text.Trim());
                    cmdUpdateIndividualInfo.Parameters.AddWithValue("@LastName", txtLastName.Text.Trim());
                    cmdUpdateIndividualInfo.Parameters.AddWithValue("@BirthDate", dtpBirthDate.Value);
                    cmdUpdateIndividualInfo.Parameters.AddWithValue("@Gender", cbGender.SelectedIndex);
                    cmdUpdateIndividualInfo.Parameters.AddWithValue("@SSN", txtIndividualSSN.Text.Trim());
                    cmdUpdateIndividualInfo.Parameters.AddWithValue("@ShippingStreet", txtStreetAddress1.Text.Trim());
                    cmdUpdateIndividualInfo.Parameters.AddWithValue("@ShippingCity", txtCity1.Text.Trim());
                    cmdUpdateIndividualInfo.Parameters.AddWithValue("@ShippingState", txtState1.Text.Trim());
                    cmdUpdateIndividualInfo.Parameters.AddWithValue("@ShippingZipCode", txtZip1.Text.Trim());
                    cmdUpdateIndividualInfo.Parameters.AddWithValue("@BillingStreet", txtStreetAddress2.Text.Trim());
                    cmdUpdateIndividualInfo.Parameters.AddWithValue("@BillingCity", txtCity2.Text.Trim());
                    cmdUpdateIndividualInfo.Parameters.AddWithValue("@BillingState", txtState2.Text.Trim());
                    cmdUpdateIndividualInfo.Parameters.AddWithValue("@BillingZipCode", txtZip2.Text.Trim());
                    cmdUpdateIndividualInfo.Parameters.AddWithValue("@Email", txtEmail.Text.Trim());
                    cmdUpdateIndividualInfo.Parameters.AddWithValue("@Phone", txtCellPhone1.Text.Trim());
                    cmdUpdateIndividualInfo.Parameters.AddWithValue("@HomePhone", txtBusinessPhone.Text.Trim());
                    cmdUpdateIndividualInfo.Parameters.AddWithValue("@PowerOfAttorney", txtPowerOfAttorney.Text.Trim());
                    cmdUpdateIndividualInfo.Parameters.AddWithValue("@Relationship", txtRelationship.Text.Trim());
                    cmdUpdateIndividualInfo.Parameters.AddWithValue("@ReimbursementMethod", cbReimbursementMethod.SelectedIndex);

                    if (txtIndChurchName.Text.Trim() != String.Empty)
                    {
                        foreach (ChurchInfo info in lstChurchInfo)
                        {
                            if (info.Name.Trim() == txtIndChurchName.Text.Trim())
                            {
                                cmdUpdateIndividualInfo.Parameters.AddWithValue("@ChurchId", info.ID);
                                break;
                            }
                        }
                    }
                    else cmdUpdateIndividualInfo.Parameters.AddWithValue("@ChurchId", DBNull.Value);

                    cmdUpdateIndividualInfo.Parameters.AddWithValue("@IndividualId", IndividualIdForUpdate);

                    if (connSalesforce.State == ConnectionState.Open)
                    {
                        connSalesforce.Close();
                        connSalesforce.Open();
                    }
                    else if (connSalesforce.State == ConnectionState.Closed) connSalesforce.Open();

                    int nRowAffected = cmdUpdateIndividualInfo.ExecuteNonQuery();
                    if (connSalesforce.State == ConnectionState.Open) connSalesforce.Close();

                    if (nRowAffected == 1)
                    {
                        MessageBox.Show("The individual information has been updated.", "Information");
                    }
                    else if (nRowAffected == 0)
                    {
                        MessageBox.Show("The individual information has not been updated.", "Error");
                    }

                    if (tbCMMManager.Contains(tbpgMedicalBill)) tbCMMManager.TabPages.Remove(tbpgMedicalBill);
                    if (tbCMMManager.Contains(tbpgCreateCase)) tbCMMManager.TabPages.Remove(tbpgCreateCase);
                    if (tbCMMManager.Contains(tbpgCaseView)) tbCMMManager.TabPages.Remove(tbpgCaseView);
                    if (tbCMMManager.Contains(tbpgIndividual)) tbCMMManager.TabPages.Remove(tbpgIndividual);
                    tbCMMManager.SelectedIndex = 1;
                }
                else
                {
                    if (tbCMMManager.Contains(tbpgMedicalBill)) tbCMMManager.TabPages.Remove(tbpgMedicalBill);
                    if (tbCMMManager.Contains(tbpgCreateCase)) tbCMMManager.TabPages.Remove(tbpgCreateCase);
                    if (tbCMMManager.Contains(tbpgCaseView)) tbCMMManager.TabPages.Remove(tbpgCaseView);
                    if (tbCMMManager.Contains(tbpgIndividual)) tbCMMManager.TabPages.Remove(tbpgIndividual);
                    tbCMMManager.SelectedIndex = 1;
                    return;
                }
            }
            else return;
        }

        //private void SaveMedBill()
        //{

        //}

        //private void SaveCase()
        //{

        //}

        //private void UpdateIndividualInfo()
        //{

        //}

        private void btnIndViewCancelLowerRight_Click(object sender, EventArgs e)
        {
            DialogResult dlgResult = MessageBox.Show("Do you want to close Individual Page?", "Alert", MessageBoxButtons.YesNo);

            if (dlgResult == DialogResult.Yes)
            {
                if (tbCMMManager.Contains(tbpgCaseView))
                {
                    MessageBox.Show("Case View page is open. Close Case View page first.", "Alert");
                    return;
                }

                DialogResult dlgSaveResult = MessageBox.Show("Do you want to update the Individual Information?", "Alert", MessageBoxButtons.YesNo);

                if (dlgSaveResult == DialogResult.Yes)
                {
                    // Save individual info
                    String IndividualIdForUpdate = txtIndividualID.Text.Trim();

                    int nPreferredLanguage = 0;

                    if (rbKorean.Checked) nPreferredLanguage = 0;
                    else if (rbEnglish.Checked) nPreferredLanguage = 1;

                    String strSqlUpdateIndividualInfo = "update [dbo].[contact] set [dbo].[contact].[PreferredLanguage] = @PreferredLanguage, " +
                                                        "[dbo].[contact].[PreferredCommunicationMethod] = @PreferredCommMethod, " +
                                                        "[dbo].[contact].[FirstName] = @FirstName, " +
                                                        "[dbo].[contact].[MiddleName] = @MiddleName, " +
                                                        "[dbo].[contact].[LastName] = @LastName, " +
                                                        "[dbo].[contact].[Birthdate] = @BirthDate, " +
                                                        "[dbo].[contact].[CMM_Gender__c] = @Gender, " +
                                                        "[dbo].[contact].[Social_Security_Number__c] = @SSN, " +
                                                        "[dbo].[contact].[MailingStreet] = @ShippingStreet, " +
                                                        "[dbo].[contact].[MailingCity] = @ShippingCity, " +
                                                        "[dbo].[contact].[MailingState] = @ShippingState, " +
                                                        "[dbo].[contact].[MailingPostalCode] = @ShippingZipCode, " +
                                                        "[dbo].[contact].[OtherStreet] = @BillingStreet, " +
                                                        "[dbo].[contact].[OtherCity] = @BillingCity, " +
                                                        "[dbo].[contact].[OtherState] = @BillingState, " +
                                                        "[dbo].[contact].[OtherPostalCode] = @BillingZipCode, " +
                                                        "[dbo].[contact].[Email] = @Email, " +
                                                        "[dbo].[contact].[Phone] = @Phone, " +
                                                        "[dbo].[contact].[HomePhone] = @HomePhone, " +
                                                        "[dbo].[contact].[PowerOfAttorney] = @PowerOfAttorney, " +
                                                        "[dbo].[contact].[Relationship] = @Relationship, " +
                                                        "[dbo].[contact].[ReimbursementMethod] = @ReimbursementMethod, " +
                                                        "[dbo].[contact].[c4g_Church__c] = @ChurchId " +
                                                        "where [dbo].[contact].[Individual_ID__c] = @IndividualId";

                    SqlCommand cmdUpdateIndividualInfo = new SqlCommand(strSqlUpdateIndividualInfo, connSalesforce);
                    cmdUpdateIndividualInfo.CommandType = CommandType.Text;

                    cmdUpdateIndividualInfo.Parameters.AddWithValue("@PreferredLanguage", nPreferredLanguage);
                    cmdUpdateIndividualInfo.Parameters.AddWithValue("@PreferredCommMethod", cbPreferredCommunication.SelectedIndex);
                    cmdUpdateIndividualInfo.Parameters.AddWithValue("@FirstName", txtFirstName.Text.Trim());
                    cmdUpdateIndividualInfo.Parameters.AddWithValue("@MiddleName", txtMiddleName.Text.Trim());
                    cmdUpdateIndividualInfo.Parameters.AddWithValue("@LastName", txtLastName.Text.Trim());
                    cmdUpdateIndividualInfo.Parameters.AddWithValue("@BirthDate", dtpBirthDate.Value);
                    cmdUpdateIndividualInfo.Parameters.AddWithValue("@Gender", cbGender.SelectedIndex);
                    cmdUpdateIndividualInfo.Parameters.AddWithValue("@SSN", txtIndividualSSN.Text.Trim());
                    cmdUpdateIndividualInfo.Parameters.AddWithValue("@ShippingStreet", txtStreetAddress1.Text.Trim());
                    cmdUpdateIndividualInfo.Parameters.AddWithValue("@ShippingCity", txtCity1.Text.Trim());
                    cmdUpdateIndividualInfo.Parameters.AddWithValue("@ShippingState", txtState1.Text.Trim());
                    cmdUpdateIndividualInfo.Parameters.AddWithValue("@ShippingZipCode", txtZip1.Text.Trim());
                    cmdUpdateIndividualInfo.Parameters.AddWithValue("@BillingStreet", txtStreetAddress2.Text.Trim());
                    cmdUpdateIndividualInfo.Parameters.AddWithValue("@BillingCity", txtCity2.Text.Trim());
                    cmdUpdateIndividualInfo.Parameters.AddWithValue("@BillingState", txtState2.Text.Trim());
                    cmdUpdateIndividualInfo.Parameters.AddWithValue("@BillingZipCode", txtZip2.Text.Trim());
                    cmdUpdateIndividualInfo.Parameters.AddWithValue("@Email", txtEmail.Text.Trim());
                    cmdUpdateIndividualInfo.Parameters.AddWithValue("@Phone", txtCellPhone1.Text.Trim());
                    cmdUpdateIndividualInfo.Parameters.AddWithValue("@HomePhone", txtBusinessPhone.Text.Trim());
                    cmdUpdateIndividualInfo.Parameters.AddWithValue("@PowerOfAttorney", txtPowerOfAttorney.Text.Trim());
                    cmdUpdateIndividualInfo.Parameters.AddWithValue("@Relationship", txtRelationship.Text.Trim());
                    cmdUpdateIndividualInfo.Parameters.AddWithValue("@ReimbursementMethod", cbReimbursementMethod.SelectedIndex);

                    if (txtIndChurchName.Text.Trim() != String.Empty)
                    {
                        foreach (ChurchInfo info in lstChurchInfo)
                        {
                            if (info.Name.Trim() == txtIndChurchName.Text.Trim())
                            {
                                cmdUpdateIndividualInfo.Parameters.AddWithValue("@ChurchId", info.ID);
                                break;
                            }
                        }
                    }
                    else cmdUpdateIndividualInfo.Parameters.AddWithValue("@ChurchId", DBNull.Value);

                    cmdUpdateIndividualInfo.Parameters.AddWithValue("@IndividualId", IndividualIdForUpdate);

                    if (connSalesforce.State == ConnectionState.Open)
                    {
                        connSalesforce.Close();
                        connSalesforce.Open();
                    }
                    else if (connSalesforce.State == ConnectionState.Closed) connSalesforce.Open();

                    int nRowAffected = cmdUpdateIndividualInfo.ExecuteNonQuery();
                    if (connSalesforce.State == ConnectionState.Open) connSalesforce.Close();

                    if (nRowAffected == 1)
                    {
                        MessageBox.Show("The individual information has been updated.", "Information");
                    }
                    else if (nRowAffected == 0)
                    {
                        MessageBox.Show("The individual information has not been updated.", "Error");
                    }
                }
                tbCMMManager.TabPages.Remove(tbpgIndividual);
                tbCMMManager.SelectedIndex = 1;
            }
            else return;
        }

        private void btnCloseCaseView_Click(object sender, EventArgs e)
        {
            //if (tbCMMManager.Contains(tbpgCreateCase))
            //{
            //    MessageBox.Show("Case Page is open. Close Case Page first.", "Alert");
            //    return;
            //}

            DialogResult dlgResult = MessageBox.Show("Do you want to close Case View?", "Alert", MessageBoxButtons.YesNo);

            if (dlgResult == DialogResult.Yes)
            {
                if (tbCMMManager.Contains(tbpgMedicalBill)) tbCMMManager.TabPages.Remove(tbpgMedicalBill);
                if (tbCMMManager.Contains(tbpgCreateCase)) tbCMMManager.TabPages.Remove(tbpgCreateCase);
                if (tbCMMManager.Contains(tbpgCaseView)) tbCMMManager.TabPages.Remove(tbpgCaseView);
                tbCMMManager.SelectedIndex = 2;
                return;
            }
            else return;

        }

        //private void btnCaseViewIndividual_Click(object sender, EventArgs e)
        //{
        //    if (tbCMMManager.TabPages.Contains(tbpgCaseView))
        //    {
        //        MessageBox.Show("Case View Page is already open. Close Case View page first.", "Alert");
        //        return;
        //    }
        //    else
        //    {
        //        tbCMMManager.TabPages.Insert(3, tbpgCaseView);
        //        tbCMMManager.SelectedIndex = 3;
        //    }
        //}

        private void btnIndViewUpdateLowerRight_Click(object sender, EventArgs e)
        {
            Cursor.Current = Cursors.WaitCursor;

            String IndividualIdForUpdate = txtIndividualID.Text.Trim();

            int nPreferredLanguage = 0;

            if (rbKorean.Checked) nPreferredLanguage = 0;
            else if (rbEnglish.Checked) nPreferredLanguage = 1;

            String strSqlUpdateIndividualInfo = "update [dbo].[contact] set [dbo].[contact].[PreferredLanguage] = @PreferredLanguage, " +
                                                "[dbo].[contact].[PreferredCommunicationMethod] = @PreferredCommMethod, " +
                                                "[dbo].[contact].[FirstName] = @FirstName, " +
                                                "[dbo].[contact].[MiddleName] = @MiddleName, " +
                                                "[dbo].[contact].[LastName] = @LastName, " +
                                                "[dbo].[contact].[Birthdate] = @BirthDate, " +
                                                "[dbo].[contact].[CMM_Gender__c] = @Gender, " +
                                                "[dbo].[contact].[Social_Security_Number__c] = @SSN, " +
                                                "[dbo].[contact].[MailingStreet] = @ShippingStreet, " +
                                                "[dbo].[contact].[MailingCity] = @ShippingCity, " +
                                                "[dbo].[contact].[MailingState] = @ShippingState, " +
                                                "[dbo].[contact].[MailingPostalCode] = @ShippingZipCode, " +
                                                "[dbo].[contact].[OtherStreet] = @BillingStreet, " +
                                                "[dbo].[contact].[OtherCity] = @BillingCity, " +
                                                "[dbo].[contact].[OtherState] = @BillingState, " +
                                                "[dbo].[contact].[OtherPostalCode] = @BillingZipCode, " +
                                                "[dbo].[contact].[Email] = @Email, " +
                                                "[dbo].[contact].[Phone] = @Phone, " +
                                                "[dbo].[contact].[HomePhone] = @HomePhone, " +
                                                "[dbo].[contact].[PowerOfAttorney] = @PowerOfAttorney, " +
                                                "[dbo].[contact].[Relationship] = @Relationship, " +
                                                "[dbo].[contact].[ReimbursementMethod] = @ReimbursementMethod, " +
                                                "[dbo].[contact].[c4g_Church__c] = @ChurchId " +
                                                "where [dbo].[contact].[Individual_ID__c] = @IndividualId";

            SqlCommand cmdUpdateIndividualInfo = new SqlCommand(strSqlUpdateIndividualInfo, connSalesforce);
            cmdUpdateIndividualInfo.CommandType = CommandType.Text;

            cmdUpdateIndividualInfo.Parameters.AddWithValue("@PreferredLanguage", nPreferredLanguage);
            cmdUpdateIndividualInfo.Parameters.AddWithValue("@PreferredCommMethod", cbPreferredCommunication.SelectedIndex);
            cmdUpdateIndividualInfo.Parameters.AddWithValue("@FirstName", txtFirstName.Text.Trim());
            cmdUpdateIndividualInfo.Parameters.AddWithValue("@MiddleName", txtMiddleName.Text.Trim());
            cmdUpdateIndividualInfo.Parameters.AddWithValue("@LastName", txtLastName.Text.Trim());
            cmdUpdateIndividualInfo.Parameters.AddWithValue("@BirthDate", dtpBirthDate.Value);
            cmdUpdateIndividualInfo.Parameters.AddWithValue("@Gender", cbGender.SelectedIndex);
            cmdUpdateIndividualInfo.Parameters.AddWithValue("@SSN", txtIndividualSSN.Text.Trim());
            cmdUpdateIndividualInfo.Parameters.AddWithValue("@ShippingStreet", txtStreetAddress1.Text.Trim());
            cmdUpdateIndividualInfo.Parameters.AddWithValue("@ShippingCity", txtCity1.Text.Trim());
            cmdUpdateIndividualInfo.Parameters.AddWithValue("@ShippingState", txtState1.Text.Trim());
            cmdUpdateIndividualInfo.Parameters.AddWithValue("@ShippingZipCode", txtZip1.Text.Trim());
            cmdUpdateIndividualInfo.Parameters.AddWithValue("@BillingStreet", txtStreetAddress2.Text.Trim());
            cmdUpdateIndividualInfo.Parameters.AddWithValue("@BillingCity", txtCity2.Text.Trim());
            cmdUpdateIndividualInfo.Parameters.AddWithValue("@BillingState", txtState2.Text.Trim());
            cmdUpdateIndividualInfo.Parameters.AddWithValue("@BillingZipCode", txtZip2.Text.Trim());
            cmdUpdateIndividualInfo.Parameters.AddWithValue("@Email", txtEmail.Text.Trim());
            cmdUpdateIndividualInfo.Parameters.AddWithValue("@Phone", txtCellPhone1.Text.Trim());
            cmdUpdateIndividualInfo.Parameters.AddWithValue("@HomePhone", txtBusinessPhone.Text.Trim());
            cmdUpdateIndividualInfo.Parameters.AddWithValue("@PowerOfAttorney", txtPowerOfAttorney.Text.Trim());
            cmdUpdateIndividualInfo.Parameters.AddWithValue("@Relationship", txtRelationship.Text.Trim());
            cmdUpdateIndividualInfo.Parameters.AddWithValue("@ReimbursementMethod", cbReimbursementMethod.SelectedIndex);

            if (txtIndChurchName.Text.Trim() != String.Empty)
            {
                Boolean bInChurchList = false;
                foreach (ChurchInfo info in lstChurchInfo)
                {
                    if (info.Name.Trim() == txtIndChurchName.Text.Trim())
                    {
                        cmdUpdateIndividualInfo.Parameters.AddWithValue("@ChurchId", info.ID);
                        bInChurchList = true;
                        break;
                    }
                }
                if (!bInChurchList)
                {
                    MessageBox.Show("The church name is not in the list.", "Error");
                    //cmdUpdateIndividualInfo.Parameters.AddWithValue("@ChurchId", DBNull.Value);
                    return;
                }
            }
            else
            {
                cmdUpdateIndividualInfo.Parameters.AddWithValue("@ChurchId", DBNull.Value);
            }

            cmdUpdateIndividualInfo.Parameters.AddWithValue("@IndividualId", IndividualIdForUpdate);

            if (connSalesforce.State == ConnectionState.Open)
            {
                connSalesforce.Close();
                connSalesforce.Open();
            }
            else if (connSalesforce.State == ConnectionState.Closed) connSalesforce.Open();

            int nRowAffected = cmdUpdateIndividualInfo.ExecuteNonQuery();
            if (connSalesforce.State == ConnectionState.Open) connSalesforce.Close();

            if (nRowAffected == 1)
            {
                MessageBox.Show("The individual information has been updated.", "Information");
                return;
            }
            else
            {
                MessageBox.Show("The individual information has not been updated.", "Error");
                return;
            }

            Cursor.Current = Cursors.Default;
        }

        private void chkNPF_CaseCreationPage_CheckedChanged(object sender, EventArgs e)
        {
            CheckBox chk = sender as CheckBox;

            //if (chk.Checked) btnBrowseNPF.Enabled = true;
            //else btnBrowseNPF.Enabled = false;
        }

        private void chkIB_CaseCreationPage_CheckedChanged(object sender, EventArgs e)
        {
            CheckBox chk = sender as CheckBox;

            //if (chk.Checked) btnBrowseIB.Enabled = true;
            //else btnBrowseIB.Enabled = false;
        }

        private void chkPoP_CaseCreationPage_CheckedChanged(object sender, EventArgs e)
        {
            CheckBox chk = sender as CheckBox;

            //if (chk.Checked) btnBrowsePoP.Enabled = true;
            //else btnBrowsePoP.Enabled = false;
        }

        private void chkMedicalRecordCaseCreationPage_CheckedChanged(object sender, EventArgs e)
        {
            CheckBox chk = sender as CheckBox;

            //if (chk.Checked) btnBrowseMR.Enabled = true;
            //else btnBrowseMR.Enabled = false;
        }

        private void chkOtherDocCaseCreationPage_CheckedChanged(object sender, EventArgs e)
        {
            CheckBox chk = sender as CheckBox;

            //if (chk.Checked) btnBrowseUnknownDoc.Enabled = true;
            //else btnBrowseUnknownDoc.Enabled = false;
        }

        private void comboMedBillStatus_SelectedIndexChanged(object sender, EventArgs e)
        {
            ComboBox medbill_status = sender as ComboBox;

            if (medbill_status.SelectedIndex == (int)MedBillStatus.Pending ||
                medbill_status.SelectedIndex == (int)MedBillStatus.CMMPendingPayment)
            {
                cbMedBillClosed.SelectedIndex = 0;
                cbMedBillClosed.Enabled = false;
            }
            else
            {
                cbMedBillClosed.SelectedIndex = 1;
                cbMedBillClosed.Enabled = true;
            }
        }

        private void tbpgIndividual_Click(object sender, EventArgs e)
        {

        }

        private void tbpgMedBillView_Click(object sender, EventArgs e)
        {

        }

        private void gvIllnessList_CellDoubleClick(object sender, DataGridViewCellEventArgs e)
        {
            if (e.RowIndex <= -1) return;

            DataGridView gvIllness = (DataGridView)sender;

            String IndividualId = txtIllnessViewIndId.Text.Trim();
            String IllnessNo = gvIllness["Illness_IllnessNo", e.RowIndex]?.Value?.ToString();

            frmIllnessCreationPage frm = new frmIllnessCreationPage();
            frm.mode = IllnessMode.Edit;
            frm.nLoggedInUserId = nLoggedUserId;
            frm.strIndividualNo = IndividualId;
            frm.IllnessNo = IllnessNo;

            frm.ShowDialog();
        }

        private void gvIncidentList_CellDoubleClick(object sender, DataGridViewCellEventArgs e)
        {
            if (e.RowIndex <= -1) return;

            DataGridView gvIncident = (DataGridView)sender;

            String IllnessId = String.Empty;
            String IllnessNo = gvIncident["Incident_IllnessNo", e.RowIndex]?.Value?.ToString();
            String IncidentId = String.Empty;
            String IncidentNo = gvIncident["Incident_IncidentNo", e.RowIndex]?.Value?.ToString();
            String CaseId = gvIncident["Incident_CaseId", e.RowIndex]?.Value?.ToString();
            String IndividualId = txtIncidentViewIndId.Text.Trim();

            String strSqlQueryForIllnessId = "select [dbo].[tbl_illness].[Illness_Id] from [dbo].[tbl_illness] where [dbo].[tbl_illness].[IllnessNo] = @IllnessNo";

            SqlCommand cmdQueryForIllnessId = new SqlCommand(strSqlQueryForIllnessId, connRN);
            cmdQueryForIllnessId.CommandType = CommandType.Text;

            cmdQueryForIllnessId.Parameters.AddWithValue("@IllnessNo", IllnessNo);
            if (connRN.State != ConnectionState.Closed)
            {
                connRN.Close();
                connRN.Open();
            }
            else if (connRN.State == ConnectionState.Closed) connRN.Open();
            Object objIllnessId = cmdQueryForIllnessId.ExecuteScalar();
            if (connRN.State == ConnectionState.Open) connRN.Close();
            IllnessId = objIllnessId?.ToString();

            String strSqlQueryForIncidentId = "select [dbo].[tbl_incident].[Incident_id] from [dbo].[tbl_incident] where [dbo].[tbl_incident].[IncidentNo] = @IncidentNo";

            SqlCommand cmdQueryForIncidentId = new SqlCommand(strSqlQueryForIncidentId, connRN);
            cmdQueryForIncidentId.CommandType = CommandType.Text;

            cmdQueryForIncidentId.Parameters.AddWithValue("@IncidentNo", IncidentNo);

            if (connRN.State != ConnectionState.Closed)
            {
                connRN.Close();
                connRN.Open();
            }
            else if (connRN.State == ConnectionState.Closed) connRN.Open();
            Object objIncidentId = cmdQueryForIncidentId.ExecuteScalar();
            if (connRN.State == ConnectionState.Open) connRN.Close();
            IncidentId = objIncidentId?.ToString();

            frmIncidentCreationPage frmIncident = new frmIncidentCreationPage();

            frmIncident.strIllnessId = IllnessId;
            frmIncident.strIncidentId = IncidentId;
            frmIncident.strIncidentNo = IncidentNo;
            frmIncident.strCaseId = CaseId;
            frmIncident.strIndividualId = IndividualId;
            frmIncident.mode = frmIncidentCreationPage.IncidentMode.Edit;

            frmIncident.ShowDialog();

        }

        private void gvMedBillList_CellDoubleClick(object sender, DataGridViewCellEventArgs e)
        {
            if (e.RowIndex <= -1) return;

            if (gvMedBillList.Rows.Count > 0)
            {
                InitializeMedBillTabOnNewMedBill();

                comboPendingReason.Items.Clear();
                if (dicPendingReason.Count > 0)
                {
                    for (int i = 0; i < dicPendingReason.Count; i++)
                    {
                        comboPendingReason.Items.Add(dicPendingReason[i]);
                    }
                    comboPendingReason.SelectedIndex = 0;
                }
                //comboPendingReason.Sorted = true;

                comboIneligibleReason.Items.Clear();
                if (dicIneligibleReason.Count > 0)
                {
                    for (int i = 0; i < dicIneligibleReason.Count; i++)
                    {
                        comboIneligibleReason.Items.Add(dicIneligibleReason[i]);
                    }
                    comboIneligibleReason.SelectedIndex = 0;
                }
                //comboIneligibleReason.Sorted = true;

                DataGridView gvMedBill = (DataGridView)sender;

                String CaseId = gvMedBill[8, e.RowIndex]?.Value?.ToString();
                String MedBillNo = gvMedBill[0, e.RowIndex]?.Value?.ToString();

                Boolean bMedBillInUse = false;

                String strSqlQueryForMedBillInUse = "select [dbo].[tbl_MedBillInUse].[BillNo], [dbo].[tbl_MedBillInUse].[EditingStaff] from [dbo].[tbl_MedBillInUse] " +
                    "where [dbo].[tbl_MedBillInUse].[BillNo] = @MedBillInUse";

                SqlCommand cmdQueryForMedBillInUse = new SqlCommand(strSqlQueryForMedBillInUse, connRN4);
                cmdQueryForMedBillInUse.CommandType = CommandType.Text;

                cmdQueryForMedBillInUse.Parameters.AddWithValue("@MedBillInUse", MedBillNo);

                if (connRN4.State != ConnectionState.Closed)
                {
                    connRN4.Close();
                    connRN4.Open();
                }
                else if (connRN4.State == ConnectionState.Closed) connRN4.Open();
                SqlDataReader rdrMedBillInUse = cmdQueryForMedBillInUse.ExecuteReader();
                if (rdrMedBillInUse.HasRows)
                {
                    rdrMedBillInUse.Read();
                    if (MedBillNo == rdrMedBillInUse.GetString(0).Trim() &&
                        nLoggedUserId != rdrMedBillInUse.GetInt16(1))
                    {
                        MessageBox.Show("The Medical Bill: " + MedBillNo + " is in use.", "Alert");
                        rdrMedBillInUse.Close();
                        if (connRN4.State != ConnectionState.Closed) connRN4.Close();
                        bMedBillInUse = true;
                        //return;
                    }
                }
                else
                {
                    rdrMedBillInUse.Close();
                    if (connRN4.State != ConnectionState.Closed) connRN.Close();

                    String strSqlInsertMedBillInUse = "insert into [dbo].[tbl_MedBillInUse] (BillNo, EditingStaff) values (@MedBillNo, @ModifyingStaff)";

                    SqlCommand cmdInsertMedBillInUse = new SqlCommand(strSqlInsertMedBillInUse, connRN4);
                    cmdInsertMedBillInUse.CommandType = CommandType.Text;

                    cmdInsertMedBillInUse.Parameters.AddWithValue("@MedBillNo", MedBillNo);
                    cmdInsertMedBillInUse.Parameters.AddWithValue("@ModifyingStaff", nLoggedUserId);

                    if (connRN4.State != ConnectionState.Closed)
                    {
                        connRN4.Close();
                        connRN4.Open();
                    }
                    else if (connRN4.State == ConnectionState.Closed) connRN4.Open();
                    int nMedBillInUseInserted = cmdInsertMedBillInUse.ExecuteNonQuery();
                    if (nMedBillInUseInserted != 1)
                    {
                        MessageBox.Show("Medical Bill in use: " + MedBillNo + " has not been inserted.", "Error");
                        if (connRN4.State != ConnectionState.Closed) connRN4.Close();
                        return;
                    }
                    if (connRN4.State != ConnectionState.Closed) connRN4.Close();
                }


                //PrevViewToMedicalBill = ViewPrevToMedBill.MedBillView;

                

                //String strCaseNameSelected = String.Empty;

                //String strSqlQueryForIndividualId = "select [dbo].[tbl_medbill].[Individual_Id] from [dbo].[tbl_medbill] where [dbo].[tbl_medbill].[BillNo] = @MedBillNo";

                //SqlCommand cmdQueryForIndividualId = new SqlCommand(strSqlQueryForIndividualId, connRN3);
                //cmdQueryForIndividualId.CommandType = CommandType.Text;

                //cmdQueryForIndividualId.Parameters.AddWithValue("@MedBillNo", MedBillNo);

                //if (connRN3.State != ConnectionState.Closed)
                //{
                //    connRN3.Close();
                //    connRN3.Open();
                //}
                //else if (connRN3.State == ConnectionState.Closed) connRN3.Open();
                //Object objIndividualId = cmdQueryForIndividualId.ExecuteScalar();
                //if (connRN3.State != ConnectionState.Closed) connRN3.Close();

                //String IndividualIdForIndividualInfo = objIndividualId?.ToString();

                //String strSqlQueryForIndividualInfo = "select [dbo].[contact].[LastName], [dbo].[contact].[FirstName], [dbo].[contact].[MiddleName], [dbo].[contact].[Birthdate], " +
                //                                      "[dbo].[contact].[Social_Security_Number__c], ";

                //String strPatientLastName = IndividualForMedBill.strLastName;
                //String strPatientFirstName = IndividualForMedBill.strFirstName;
                //String strPatientMiddleName = IndividualForMedBill.strMiddleName;
                //String strDateOfBirth = IndividualForMedBill.dtBirthDate.Value.ToString("MM/dd/yyyy");
                //String strSSN = IndividualForMedBill.strSSN;
                //String strStreetAddr = IndividualForMedBill.strShippingStreetAddress;
                //String strCity = IndividualForMedBill.strShippingCity;
                //String strState = IndividualForMedBill.strShippingState;
                //String strZip = IndividualForMedBill.strShippingZip;

                String strPatientLastName = IndividualForMedBill.strLastName;
                String strPatientFirstName = IndividualForMedBill.strFirstName;
                String strPatientMiddleName = IndividualForMedBill.strMiddleName;
                String strDateOfBirth = IndividualForMedBill.dtBirthDate.Value.ToString("MM/dd/yyyy");
                String strSSN = IndividualForMedBill.strSSN;
                String strStreetAddr = IndividualForMedBill.strShippingStreetAddress;
                String strCity = IndividualForMedBill.strShippingCity;
                String strState = IndividualForMedBill.strShippingState;
                String strZip = IndividualForMedBill.strShippingZip;

                InitializeMedBillTabOnNewMedBill();

                //nRowSelected = gvProcessingCaseNo.CurrentCell.RowIndex;
                String IndividualId = txtMedBillViewIndId.Text.Trim();

                txtIndividualIDMedBill.Text = IndividualId;

                if (strPatientMiddleName != String.Empty) txtPatientNameMedBill.Text = strPatientLastName + ", " + strPatientFirstName + " " + strPatientMiddleName;
                else txtPatientNameMedBill.Text = strPatientLastName + ", " + strPatientFirstName;

                txtMedBillDOB.Text = strDateOfBirth;
                txtMedBillSSN.Text = strSSN;
                txtMedBillAddress.Text = strStreetAddr + ", " + strCity + ", " + strState + " " + strZip;

                // put code for individual plan
                //Plan? IndividualPlan = null;

                String strSqlQueryForIndividualPlan = "select [dbo].[program].[Name] from [dbo].[contact] " +
                                                      "inner join [dbo].[program] on [dbo].[contact].[c4g_Plan__c] = [dbo].[program].[ID] " +
                                                      "where [dbo].[contact].[Individual_ID__c] = @IndividualId";

                SqlCommand cmdQueryForIndividualPlan = new SqlCommand(strSqlQueryForIndividualPlan, connSalesforce2);
                cmdQueryForIndividualPlan.CommandType = CommandType.Text;

                cmdQueryForIndividualPlan.Parameters.AddWithValue("@IndividualId", IndividualId);

                if (connSalesforce2.State != ConnectionState.Closed)
                {
                    connSalesforce2.Close();
                    connSalesforce2.Open();
                }
                else if (connSalesforce2.State == ConnectionState.Closed) connSalesforce2.Open();
                Object objIndividualPlan = cmdQueryForIndividualPlan.ExecuteScalar();
                if (connSalesforce2.State != ConnectionState.Closed) connSalesforce2.Close();

                txtMemberProgram.Text = objIndividualPlan?.ToString();

                String strSqlQueryForCaseStatus = "select [dbo].[tbl_case_status_code].[CaseStatusValue] from [dbo].[tbl_case_status_code]";
                SqlCommand cmdQueryForCaseStatus = new SqlCommand(strSqlQueryForCaseStatus, connRN4);
                cmdQueryForCaseStatus.CommandType = CommandType.Text;

                if (connRN4.State != ConnectionState.Closed)
                {
                    connRN4.Close();
                    connRN4.Open();
                }
                else if (connRN4.State == ConnectionState.Closed) connRN4.Open();

                SqlDataReader rdrCaseStatus = cmdQueryForCaseStatus.ExecuteReader();
                cbCaseStatus.Items.Clear();
                if (rdrCaseStatus.HasRows)
                {
                    while (rdrCaseStatus.Read())
                    {
                        cbCaseStatus.Items.Add(rdrCaseStatus.GetString(0));
                    }
                }
                rdrCaseStatus.Close();
                if (connRN4.State != ConnectionState.Closed) connRN4.Close();



                String strSqlQueryForDocumentsInfo = "select [dbo].[tbl_case].[NPF_Form], [dbo].[tbl_case].[NPF_Receiv_Date], " +
                                         "[dbo].[tbl_case].[IB_Form], [dbo].[tbl_case].[IB_Receiv_Date], " +
                                         "[dbo].[tbl_case].[POP_Form], [dbo].[tbl_case].[POP_Receiv_Date], " +
                                         "[dbo].[tbl_case].[MedRec_Form], [dbo].[tbl_case].[MedRec_Receiv_Date], " +
                                         "[dbo].[tbl_case].[Unknown_Form], [dbo].[tbl_case].[Unknown_Receiv_Date] " +
                                         "from [dbo].[tbl_case] " +
                                         "where [dbo].[tbl_case].[Case_Name] = @CaseId and " +
                                         "[dbo].[tbl_case].[Contact_ID] = @IndividualId and " +
                                         "[dbo].[tbl_case].[IsDeleted] = 0";

                SqlCommand cmdQueryForDocInfo = new SqlCommand(strSqlQueryForDocumentsInfo, connRN4);
                cmdQueryForDocInfo.CommandType = CommandType.Text;

                cmdQueryForDocInfo.Parameters.AddWithValue("@CaseId", CaseId);
                cmdQueryForDocInfo.Parameters.AddWithValue("@IndividualId", IndividualId);

                //if (connRN.State == ConnectionState.Closed) connRN.Open();
                if (connRN4.State != ConnectionState.Closed)
                {
                    connRN4.Close();
                    connRN4.Open();
                }
                else if (connRN4.State == ConnectionState.Closed) connRN4.Open();
                SqlDataReader rdrDocInfo = cmdQueryForDocInfo.ExecuteReader();
                if (rdrDocInfo.HasRows)
                {
                    rdrDocInfo.Read();

                    if (!rdrDocInfo.IsDBNull(0))
                    {
                        if (rdrDocInfo.GetBoolean(0))
                        {
                            chkMedBillNPFReceived.Checked = true;
                            chkMedBillNPFReceived.Enabled = false;
                            dtpMedBillNPF.Text = rdrDocInfo.GetDateTime(1).ToString("MM/dd/yyyy");
                            dtpMedBillNPF.Enabled = false;
                            btnViewNPF.Enabled = true;
                        }
                        else
                        {
                            chkMedBillNPFReceived.Checked = false;
                            chkMedBillNPFReceived.Enabled = false;
                            dtpMedBillNPF.Format = DateTimePickerFormat.Custom;
                            dtpMedBillNPF.CustomFormat = " ";
                            dtpMedBillNPF.Enabled = false;
                            btnViewNPF.Enabled = false;
                        }
                    }
                    if (!rdrDocInfo.IsDBNull(2))
                    {
                        if (rdrDocInfo.GetBoolean(2))
                        {
                            chkMedBill_IBReceived.Checked = true;
                            chkMedBill_IBReceived.Enabled = false;
                            dtpMedBill_IB.Text = rdrDocInfo.GetDateTime(3).ToString("MM/dd/yyyy");
                            dtpMedBill_IB.Enabled = false;
                            btnViewIB.Enabled = true;
                        }
                        else
                        {
                            chkMedBill_IBReceived.Checked = false;
                            chkMedBill_IBReceived.Enabled = false;
                            dtpMedBill_IB.Format = DateTimePickerFormat.Custom;
                            dtpMedBill_IB.CustomFormat = " ";
                            dtpMedBill_IB.Enabled = false;
                            btnViewIB.Enabled = false;
                        }
                    }
                    if (!rdrDocInfo.IsDBNull(4))
                    {
                        if (rdrDocInfo.GetBoolean(4))
                        {
                            chkMedBillPOPReceived.Checked = true;
                            chkMedBillPOPReceived.Enabled = false;
                            dtpMedBillPOP.Text = rdrDocInfo.GetDateTime(5).ToString("MM/dd/yyyy");
                            dtpMedBillPOP.Enabled = false;
                            btnViewPoP.Enabled = true;
                        }
                        else
                        {
                            chkMedBillPOPReceived.Checked = false;
                            chkMedBillPOPReceived.Enabled = false;
                            dtpMedBillPOP.Format = DateTimePickerFormat.Custom;
                            dtpMedBillPOP.CustomFormat = " ";
                            dtpMedBillPOP.Enabled = false;
                            btnViewPoP.Enabled = false;
                        }
                    }
                    if (!rdrDocInfo.IsDBNull(6))
                    {
                        if (rdrDocInfo.GetBoolean(6))
                        {
                            chkMedRecordReceived.Checked = true;
                            chkMedRecordReceived.Enabled = false;
                            dtpMedBillMedRecord.Text = rdrDocInfo.GetDateTime(7).ToString("MM/dd/yyyy");
                            dtpMedBillMedRecord.Enabled = false;
                            btnViewMedRecord.Enabled = true;
                        }
                        else
                        {
                            chkMedRecordReceived.Checked = false;
                            chkMedRecordReceived.Enabled = false;
                            dtpMedBillMedRecord.Format = DateTimePickerFormat.Custom;
                            dtpMedBillMedRecord.CustomFormat = " ";
                            dtpMedBillMedRecord.Enabled = false;
                            btnViewMedRecord.Enabled = false;
                        }
                    }

                    if (!rdrDocInfo.IsDBNull(8))
                    {
                        if (rdrDocInfo.GetBoolean(8))
                        {
                            chkOtherDocReceived.Checked = true;
                            chkOtherDocReceived.Enabled = false;
                            dtpMedBillOtherDoc.Text = rdrDocInfo.GetDateTime(9).ToString("MM/dd/yyyy");
                            dtpMedBillOtherDoc.Enabled = false;
                            btnViewOtherDoc.Enabled = true;
                        }
                        else
                        {
                            chkOtherDocReceived.Checked = false;
                            chkOtherDocReceived.Enabled = false;
                            dtpMedBillOtherDoc.Format = DateTimePickerFormat.Custom;
                            dtpMedBillOtherDoc.CustomFormat = " ";
                            dtpMedBillOtherDoc.Enabled = false;
                            btnViewOtherDoc.Enabled = false;
                        }
                    }

                    //strCaseIdSelected = CaseNameInMedBill;
                    //strContactIdSelected = IndividualIdInMedBill;

                    strCaseIdSelected = CaseId;
                    strContactIdSelected = IndividualId;

                }
                rdrDocInfo.Close();
                if (connRN4.State != ConnectionState.Closed) connRN4.Close();

                //String CaseId = gvMedBill["MedBill_CaseId", e.RowIndex]?.Value?.ToString();

                //String strSqlQueryForMedBillEdit = "select [dbo].[tbl_medbill].[Case_Id], [dbo].[tbl_illness].[IllnessNo], [dbo].[tbl_incident].[IncidentNo], [dbo].[tbl_program].[ProgramName], " +
                //               "[dbo].[tbl_medbill].[BillNo], [dbo].[tbl_medbill].[MedBillType_Id], [dbo].[tbl_medbill].[BillStatus], [dbo].[tbl_medbill].[BillClosed], " +
                //               "[dbo].[tbl_medbill].[BillAmount], [dbo].[tbl_MedicalProvider].[Name], " +
                //               "[dbo].[tbl_medbill].[PrescriptionDrugName], [dbo].[tbl_medbill].[PrescriptionNo], [dbo].[tbl_medbill].[PrescriptionDescription], " +
                //               "[dbo].[tbl_medbill].[TotalNumberOfPhysicalTherapy], [dbo].[tbl_medbill].[PatientTypeId], " +
                //               "[dbo].[tbl_medbill].[BillDate], [dbo].[tbl_medbill].[DueDate], " +
                //               "[dbo].[tbl_medbill].[Account_At_Provider], [dbo].[tbl_medbill].[ProviderContactPerson], " +
                //               "[dbo].[tbl_medbill].[Note], " +
                //               "[dbo].[tbl_illness].[ICD_10_Id], " +
                //               "[dbo].[tbl_medbill].[PendingReason], [dbo].[tbl_medbill].[IneligibleReason], " +
                //               "[dbo].[tbl_medbill].[Account_At_Provider], [dbo].[tbl_medbill].[ProviderPhoneNumber], [dbo].[tbl_medbill].[ProviderContactPerson], " +
                //               "[dbo].[tbl_medbill].[ProposalLetterSentDate], [dbo].[tbl_medbill].[HIPPASentDate], [dbo].[tbl_medbill].[MedicalRecordDate], " +
                //               "[dbo].[tbl_medbill].[Illness_Id], [dbo].[tbl_medbill].[Incident_Id] " +
                //               "from [dbo].[tbl_medbill] " +
                //               "inner join [dbo].[tbl_illness] on [dbo].[tbl_medbill].[Illness_Id] = [dbo].[tbl_illness].[Illness_Id] " +
                //               "inner join [dbo].[tbl_incident] on [dbo].[tbl_medbill].[Incident_Id] = [dbo].[tbl_incident].[Incident_id] " +
                //               "inner join [dbo].[tbl_program] on [dbo].[tbl_incident].[Program_id] = [dbo].[tbl_program].[Program_Id] " +
                //               "inner join [dbo].[tbl_MedicalProvider] on [dbo].[tbl_medbill].[MedicalProvider_Id] = [dbo].[tbl_MedicalProvider].[ID] " +
                //               "where [dbo].[tbl_medbill].[BillNo] = @MedBillNo and " +
                //               "[dbo].[tbl_medbill].[Case_Id] = @CaseName and " +
                //               "[dbo].[tbl_medbill].[Contact_Id] = @IndividualId and" +
                //               "[dbo].[tbl_medbill].[IsDeleted] = 0";
                ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////




                ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                String strSqlQueryForMedBillEdit = "select [dbo].[tbl_medbill].[Case_Id], [dbo].[tbl_illness].[IllnessNo], [dbo].[tbl_incident].[IncidentNo], [dbo].[tbl_program].[ProgramName], " +
                                                   "[dbo].[tbl_medbill].[BillNo], [dbo].[tbl_medbill].[MedBillType_Id], [dbo].[tbl_medbill].[BillStatus], [dbo].[tbl_medbill].[BillClosed], " +
                                                   "[dbo].[tbl_medbill].[BillAmount], [dbo].[tbl_medbill].[MedicalProvider_Id], " +
                                                   "[dbo].[tbl_medbill].[PrescriptionDrugName], [dbo].[tbl_medbill].[PrescriptionNo], [dbo].[tbl_medbill].[PrescriptionDescription], " +
                                                   "[dbo].[tbl_medbill].[TotalNumberOfPhysicalTherapy], [dbo].[tbl_medbill].[PatientTypeId], " +
                                                   "[dbo].[tbl_medbill].[BillDate], [dbo].[tbl_medbill].[DueDate], " +
                                                   "[dbo].[tbl_medbill].[Account_At_Provider], [dbo].[tbl_medbill].[ProviderContactPerson], [dbo].[tbl_medbill].[ProviderPhoneNumber], " +
                                                   "[dbo].[tbl_medbill].[Note], " +
                                                   "[dbo].[tbl_illness].[ICD_10_Id], " +
                                                   "[dbo].[tbl_medbill].[PendingReason], [dbo].[tbl_medbill].[IneligibleReason], " +
                                                   "[dbo].[tbl_medbill].[ProposalLetterSentDate], [dbo].[tbl_medbill].[HIPPASentDate], [dbo].[tbl_medbill].[MedicalRecordDate], " +
                                                   "[dbo].[tbl_medbill].[Illness_Id], [dbo].[tbl_medbill].[Incident_Id], " +
                                                   "[dbo].[tbl_medbill].[NPF_Form], [dbo].[tbl_medbill].[NPF_SourceFileName], [dbo].[tbl_medbill].[NPF_DestinationFileName], " +
                                                   "[dbo].[tbl_medbill].[IB_Form], [dbo].[tbl_medbill].[IB_SourceFileName], [dbo].[tbl_medbill].[IB_DestinationFileName], " +
                                                   "[dbo].[tbl_medbill].[POP_Form], [dbo].[tbl_medbill].[POP_SourceFileName], [dbo].[tbl_medbill].[POP_DestinationFileName], " +
                                                   "[dbo].[tbl_medbill].[MedRec_Form], [dbo].[tbl_medbill].[MedRec_SourceFileName], [dbo].[tbl_medbill].[MedRec_DestinationFileName], " +
                                                   "[dbo].[tbl_medbill].[Unknown_Form], [dbo].[tbl_medbill].[Unknown_SourceFileName], [dbo].[tbl_medbill].[Unknown_DestinationFileName] " +
                                                   "from [dbo].[tbl_medbill] " +
                                                   "inner join [dbo].[tbl_illness] on [dbo].[tbl_medbill].[Illness_Id] = [dbo].[tbl_illness].[Illness_Id] " +
                                                   "inner join [dbo].[tbl_incident] on [dbo].[tbl_medbill].[Incident_Id] = [dbo].[tbl_incident].[Incident_id] " +
                                                   "inner join [dbo].[tbl_program] on [dbo].[tbl_incident].[Program_id] = [dbo].[tbl_program].[Program_Id] " +
                                                   "where [dbo].[tbl_medbill].[BillNo] = @MedBillNo and " +
                                                   "[dbo].[tbl_medbill].[Case_Id] = @CaseName and " +
                                                   "[dbo].[tbl_medbill].[Contact_Id] = @IndividualId and" +
                                                   "([dbo].[tbl_medbill].[IsDeleted] = 0 or [dbo].[tbl_medbill].[IsDeleted] IS NULL)";

                SqlCommand cmdQueryForMedBillEdit = new SqlCommand(strSqlQueryForMedBillEdit, connRN4);
                cmdQueryForMedBillEdit.CommandType = CommandType.Text;

                cmdQueryForMedBillEdit.Parameters.AddWithValue("@MedBillNo", MedBillNo);
                cmdQueryForMedBillEdit.Parameters.AddWithValue("@CaseName", CaseId);
                cmdQueryForMedBillEdit.Parameters.AddWithValue("@IndividualId", IndividualId);

                //if (connRN.State == ConnectionState.Closed) connRN.Open();
                if (connRN4.State != ConnectionState.Closed)
                {
                    connRN4.Close();
                    connRN4.Open();
                }
                else if (connRN4.State == ConnectionState.Closed) connRN4.Open();

                SqlDataReader rdrMedBillEdit = cmdQueryForMedBillEdit.ExecuteReader();

                MedicalBillInfoForList MedBillForEdit = new MedicalBillInfoForList();

                if (rdrMedBillEdit.HasRows)
                {
                    rdrMedBillEdit.Read();
                    if (!rdrMedBillEdit.IsDBNull(0)) MedBillForEdit.CaseId = rdrMedBillEdit.GetString(0).Trim();
                    if (!rdrMedBillEdit.IsDBNull(1)) MedBillForEdit.IllnessNo = rdrMedBillEdit.GetString(1).Trim();
                    if (!rdrMedBillEdit.IsDBNull(2)) MedBillForEdit.IncidentNo = rdrMedBillEdit.GetString(2).Trim();
                    if (!rdrMedBillEdit.IsDBNull(3)) MedBillForEdit.ProgramName = rdrMedBillEdit.GetString(3).Trim();
                    if (!rdrMedBillEdit.IsDBNull(4)) MedBillForEdit.MedBillNo = rdrMedBillEdit.GetString(4).Trim();
                    if (!rdrMedBillEdit.IsDBNull(5)) MedBillForEdit.MedBillTypeId = rdrMedBillEdit.GetInt16(5);
                    if (!rdrMedBillEdit.IsDBNull(6)) MedBillForEdit.MedBillStatusId = rdrMedBillEdit.GetInt16(6);
                    if (!rdrMedBillEdit.IsDBNull(7)) MedBillForEdit.bBillClosed = rdrMedBillEdit.GetBoolean(7);
                    if (!rdrMedBillEdit.IsDBNull(8)) MedBillForEdit.BillAmount = rdrMedBillEdit.GetDecimal(8);
                    if (!rdrMedBillEdit.IsDBNull(9)) MedBillForEdit.MedicalProviderId = rdrMedBillEdit.GetString(9);
                    if (!rdrMedBillEdit.IsDBNull(10)) MedBillForEdit.PrescriptionDrugName = rdrMedBillEdit.GetString(10);
                    if (!rdrMedBillEdit.IsDBNull(11)) MedBillForEdit.PrescriptionNo = rdrMedBillEdit.GetString(11);
                    if (!rdrMedBillEdit.IsDBNull(12)) MedBillForEdit.PrescriptionDescription = rdrMedBillEdit.GetString(12);
                    if (!rdrMedBillEdit.IsDBNull(13)) MedBillForEdit.TotalNumberOfPhysicalTherapy = rdrMedBillEdit.GetInt16(13);
                    if (!rdrMedBillEdit.IsDBNull(14)) MedBillForEdit.nPatientTypeId = rdrMedBillEdit.GetInt16(14);
                    if (!rdrMedBillEdit.IsDBNull(15)) MedBillForEdit.BillDate = rdrMedBillEdit.GetDateTime(15);
                    if (!rdrMedBillEdit.IsDBNull(16)) MedBillForEdit.ReceivedDate = rdrMedBillEdit.GetDateTime(16);
                    if (!rdrMedBillEdit.IsDBNull(17)) MedBillForEdit.AccountNoAtProvider = rdrMedBillEdit.GetString(17);
                    if (!rdrMedBillEdit.IsDBNull(18)) MedBillForEdit.ProviderContactPerson = rdrMedBillEdit.GetString(18);
                    if (!rdrMedBillEdit.IsDBNull(19)) MedBillForEdit.ProviderPhoneNumber = rdrMedBillEdit.GetString(19);
                    if (!rdrMedBillEdit.IsDBNull(20)) MedBillForEdit.Note = rdrMedBillEdit.GetString(20);
                    if (!rdrMedBillEdit.IsDBNull(21)) MedBillForEdit.ICD_10_Id = rdrMedBillEdit.GetString(21);
                    if (!rdrMedBillEdit.IsDBNull(22)) MedBillForEdit.nPendingReasonIndex = rdrMedBillEdit.GetInt32(22);
                    if (!rdrMedBillEdit.IsDBNull(23)) MedBillForEdit.nIneligibleReasonIndex = rdrMedBillEdit.GetInt32(23);
                    if (!rdrMedBillEdit.IsDBNull(24)) MedBillForEdit.ProposalLetterSentDate = rdrMedBillEdit.GetDateTime(24);
                    if (!rdrMedBillEdit.IsDBNull(25)) MedBillForEdit.HIPPASentDate = rdrMedBillEdit.GetDateTime(25);
                    if (!rdrMedBillEdit.IsDBNull(26)) MedBillForEdit.MedicalRecordDate = rdrMedBillEdit.GetDateTime(26);
                    if (!rdrMedBillEdit.IsDBNull(27)) MedBillForEdit.IllnessId = Int32.Parse(rdrMedBillEdit.GetString(27).Trim());
                    if (!rdrMedBillEdit.IsDBNull(28)) MedBillForEdit.IncidentId = Int32.Parse(rdrMedBillEdit.GetString(28).Trim());
                    if (!rdrMedBillEdit.IsDBNull(29)) MedBillForEdit.NPF_Form = rdrMedBillEdit.GetBoolean(29);
                    //if (!rdrMedBillEdit.IsDBNull(30)) MedBillForEdit.NPFormFileNameMedBill = rdrMedBillEdit.GetString(30);
                    if (!rdrMedBillEdit.IsDBNull(30)) MedBillForEdit.NPFSourceFilePathMedBill = rdrMedBillEdit.GetString(30);
                    if (!rdrMedBillEdit.IsDBNull(31)) MedBillForEdit.NPFDestinationFilePathMedbill = rdrMedBillEdit.GetString(31);
                    if (!rdrMedBillEdit.IsDBNull(32)) MedBillForEdit.IB_Form = rdrMedBillEdit.GetBoolean(32);
                    //if (!rdrMedBillEdit.IsDBNull(34)) MedBillForEdit.IBFileNameMedBill = rdrMedBillEdit.GetString(34);
                    if (!rdrMedBillEdit.IsDBNull(33)) MedBillForEdit.IBSourceFilePathMedBill = rdrMedBillEdit.GetString(33);
                    if (!rdrMedBillEdit.IsDBNull(34)) MedBillForEdit.IBDestinationFilePathMedBill = rdrMedBillEdit.GetString(34);
                    if (!rdrMedBillEdit.IsDBNull(35)) MedBillForEdit.PoP_Form = rdrMedBillEdit.GetBoolean(35);
                    //if (!rdrMedBillEdit.IsDBNull(38)) MedBillForEdit.PoPFileNameMedBill = rdrMedBillEdit.GetString(38);
                    if (!rdrMedBillEdit.IsDBNull(36)) MedBillForEdit.PoPSourceFilePathMedBill = rdrMedBillEdit.GetString(36);
                    if (!rdrMedBillEdit.IsDBNull(37)) MedBillForEdit.PoPDestinationFilePathMedBill = rdrMedBillEdit.GetString(37);
                    if (!rdrMedBillEdit.IsDBNull(38)) MedBillForEdit.MedRec_Form = rdrMedBillEdit.GetBoolean(38);
                    //if (!rdrMedBillEdit.IsDBNull(42)) MedBillForEdit.MedRecFileNameMedBill = rdrMedBillEdit.GetString(42);
                    if (!rdrMedBillEdit.IsDBNull(39)) MedBillForEdit.MedRecSourceFilePathMedBill = rdrMedBillEdit.GetString(39);
                    if (!rdrMedBillEdit.IsDBNull(40)) MedBillForEdit.MedRecDestiantionFilePathMedbill = rdrMedBillEdit.GetString(40);
                    if (!rdrMedBillEdit.IsDBNull(41)) MedBillForEdit.OtherDoc_Form = rdrMedBillEdit.GetBoolean(41);
                    //if (!rdrMedBillEdit.IsDBNull(46)) MedBillForEdit.OtherDocFileNameMedBill = rdrMedBillEdit.GetString(46);
                    if (!rdrMedBillEdit.IsDBNull(42)) MedBillForEdit.OtherDocSourceFilePathMedBill = rdrMedBillEdit.GetString(42);
                    if (!rdrMedBillEdit.IsDBNull(43)) MedBillForEdit.OtherDocDestinationFilePathMedBill = rdrMedBillEdit.GetString(43);

                }

                String strSqlQueryForMedicalProviderName = "select [dbo].[account].[Name] from [dbo].[account] where [dbo].[account].[Id] = @MedicalProviderId";

                SqlCommand cmdQueryForMedicalProviderName = new SqlCommand(strSqlQueryForMedicalProviderName, connSalesforce2);
                cmdQueryForMedicalProviderName.CommandType = CommandType.Text;

                cmdQueryForMedicalProviderName.Parameters.AddWithValue("@MedicalProviderId", MedBillForEdit.MedicalProviderId);

                if (connSalesforce2.State != ConnectionState.Closed)
                {
                    connSalesforce2.Close();
                    connSalesforce2.Open();
                }
                else if (connSalesforce2.State == ConnectionState.Closed) connSalesforce2.Open();
                Object objMedicalProviderName = cmdQueryForMedicalProviderName.ExecuteScalar();
                if (connSalesforce2.State == ConnectionState.Open) connSalesforce2.Close();

                if (objMedicalProviderName != null) MedBillForEdit.MedicalProviderName = objMedicalProviderName.ToString();

                //////////////////////////////////////////////////////////////////////////////////
                txtMedBill_CaseNo.Text = MedBillForEdit.CaseId;
                Illness.IllnessNo = MedBillForEdit.IllnessNo;
                txtMedBill_Illness.Text = MedBillForEdit.IllnessNo;
                Incident.IncidentNo = MedBillForEdit.IncidentNo;
                txtMedBill_Incident.Text = MedBillForEdit.IncidentNo;
                txtIncdProgram.Text = MedBillForEdit.ProgramName;

                chkNPFMedBill.Checked = MedBillForEdit.NPF_Form;
                chkIBMedBill.Checked = MedBillForEdit.IB_Form;
                chkPoPMedBill.Checked = MedBillForEdit.PoP_Form;
                chkMedRecMedBill.Checked = MedBillForEdit.MedRec_Form;
                chkOtherDocMedBill.Checked = MedBillForEdit.OtherDoc_Form;

                MedBillForEdit.NPFormFileNameMedBill = Path.GetFileName(MedBillForEdit.NPFSourceFilePathMedBill);
                MedBillForEdit.IBFileNameMedBill = Path.GetFileName(MedBillForEdit.IBSourceFilePathMedBill);
                MedBillForEdit.PoPFileNameMedBill = Path.GetFileName(MedBillForEdit.PoPSourceFilePathMedBill);
                MedBillForEdit.MedRecFileNameMedBill = Path.GetFileName(MedBillForEdit.MedRecSourceFilePathMedBill);
                MedBillForEdit.OtherDocFileNameMedBill = Path.GetFileName(MedBillForEdit.OtherDocSourceFilePathMedBill);

                strNPFormFileNameMedBill = MedBillForEdit.NPFormFileNameMedBill;
                strNPFSourceFilePathMedBill = MedBillForEdit.NPFSourceFilePathMedBill;
                strNPFDestinationFilePathMedBill = MedBillForEdit.NPFDestinationFilePathMedbill;

                strIBFileNameMedBill = MedBillForEdit.IBFileNameMedBill;
                strIBSourceFilePathMedBill = MedBillForEdit.IBSourceFilePathMedBill;
                strIBDestinationFilePathMedBill = MedBillForEdit.IBDestinationFilePathMedBill;

                strPoPFileNameMedBill = MedBillForEdit.PoPFileNameMedBill;
                strPoPSourceFilePathMedBill = MedBillForEdit.PoPSourceFilePathMedBill;
                strPoPDestinationFilePathMedBill = MedBillForEdit.PoPDestinationFilePathMedBill;

                strMedRecFileNameMedBill = MedBillForEdit.MedRecFileNameMedBill;
                strMedRecSourceFilePathMedBill = MedBillForEdit.MedRecSourceFilePathMedBill;
                strMedRecDestinationFilePathMedBill = MedBillForEdit.MedRecDestiantionFilePathMedbill;

                strOtherDocFileNameMedBill = MedBillForEdit.OtherDocFileNameMedBill;
                strOtherDocSourceFilePathMedBill = MedBillForEdit.OtherDocSourceFilePathMedBill;
                strOtherDocDestinationFilePathMedBill = MedBillForEdit.OtherDocDestinationFilePathMedBill;


                txtNPFMedBillFileName.Text = MedBillForEdit.NPFormFileNameMedBill;
                txtIBMedBillFileName.Text = MedBillForEdit.IBFileNameMedBill;
                txtPoPMedBillFileName.Text = MedBillForEdit.PoPFileNameMedBill;
                txtMedRecMedBillFileName.Text = MedBillForEdit.MedRecFileNameMedBill;
                txtOtherDocMedBillFileName.Text = MedBillForEdit.OtherDocFileNameMedBill;


                txtMedBillNo.Text = MedBillForEdit.MedBillNo;
                if (MedBillForEdit.MedBillTypeId != -1)
                {
                    comboMedBillType.Items.Clear();
                    for (int i = 1; i <= dicMedBillTypes.Count; i++)
                    {
                        comboMedBillType.Items.Add(dicMedBillTypes[i]);
                    }
                    comboMedBillType.SelectedIndex = MedBillForEdit.MedBillTypeId - 1;
                }
                if (MedBillForEdit.MedBillStatusId != -1)
                {
                    if (dicMedBillStatus.Count > 0)
                    {
                        comboMedBillStatus.Items.Clear();
                        for (int i = 0; i < dicMedBillStatus.Count; i++)
                        {
                            comboMedBillStatus.Items.Add(dicMedBillStatus[i]);
                        }
                        comboMedBillStatus.SelectedIndex = MedBillForEdit.MedBillStatusId;
                    }
                }

                if (MedBillForEdit.bBillClosed) cbMedBillClosed.SelectedIndex = 1;
                else cbMedBillClosed.SelectedIndex = 0;

                comboMedBillStatus.SelectedIndex = MedBillForEdit.MedBillStatusId;
                txtMedBillAmount.Text = MedBillForEdit.BillAmount.ToString("C");
                txtBalance.Text = MedBillForEdit.Balance.ToString("C");
                txtMedicalProvider.Text = MedBillForEdit.MedicalProviderName.Trim();

                txtNumberOfMedication.Text = MedBillForEdit.PrescriptionNo;
                txtPrescriptionName.Text = MedBillForEdit.PrescriptionDrugName.Trim();
                txtPrescriptionDescription.Text = MedBillForEdit.PrescriptionDescription;

                txtNumPhysicalTherapy.Text = MedBillForEdit.TotalNumberOfPhysicalTherapy.ToString();
                if (MedBillForEdit.nPatientTypeId == 0) rbOutpatient.Checked = true;
                else if (MedBillForEdit.nPatientTypeId == 1) rbInpatient.Checked = true;

                comboPendingReason.SelectedIndex = MedBillForEdit.nPendingReasonIndex;
                comboIneligibleReason.SelectedIndex = MedBillForEdit.nIneligibleReasonIndex;

                if (MedBillForEdit.BillDate.Value != null)
                {
                    dtpBillDate.Checked = true;
                    dtpBillDate.Text = MedBillForEdit.BillDate.Value.ToString("MM/dd/yyyy");
                }
                else
                {
                    dtpBillDate.Format = DateTimePickerFormat.Custom;
                    dtpBillDate.CustomFormat = " ";
                }

                if (MedBillForEdit.ReceivedDate.Value != null)
                {
                    dtpDueDate.Checked = true;
                    dtpDueDate.Text = MedBillForEdit.ReceivedDate.Value.ToString("MM/dd/yyyy");
                }
                else
                {
                    dtpDueDate.Format = DateTimePickerFormat.Custom;
                    dtpDueDate.Text = " ";
                }

                txtMedBillAccountNoAtProvider.Text = MedBillForEdit.AccountNoAtProvider;
                txtProviderContactPerson.Text = MedBillForEdit.ProviderContactPerson;
                txtMedProviderPhoneNo.Text = MedBillForEdit.ProviderPhoneNumber;

                if (MedBillForEdit.Note != String.Empty)
                {
                    if (comboMedBillType.SelectedIndex == 0 || comboMedBillType.SelectedIndex == 3) txtMedBillNote.Text = MedBillForEdit.Note;
                    if (comboMedBillType.SelectedIndex == 1) txtPrescriptionNote.Text = MedBillForEdit.Note;
                    if (comboMedBillType.SelectedIndex == 2) txtPhysicalTherapyRxNote.Text = MedBillForEdit.Note;
                }

                if (MedBillForEdit.ICD_10_Id != String.Empty) txtMedBill_ICD10Code.Text = MedBillForEdit.ICD_10_Id;
                //if ((comboMedBillType.SelectedIndex == 0) && (MedBillForEdit.nPendingReasonIndex != -1)) comboPendingReason.SelectedIndex = MedBillForEdit.nPendingReasonIndex;
                if (MedBillForEdit.nPendingReasonIndex != -1) comboPendingReason.SelectedIndex = MedBillForEdit.nPendingReasonIndex;
                //if ((comboMedBillType.SelectedIndex == 0) && (MedBillForEdit.nIneligibleReasonIndex != -1)) comboIneligibleReason.SelectedIndex = MedBillForEdit.nIneligibleReasonIndex;
                if (MedBillForEdit.nIneligibleReasonIndex != -1) comboIneligibleReason.SelectedIndex = MedBillForEdit.nIneligibleReasonIndex;

                if (comboMedBillType.SelectedIndex == 0 || comboMedBillType.SelectedIndex == 3)
                {
                    txtPrescriptionName.Text = String.Empty;
                    txtPrescriptionDescription.Text = String.Empty;
                    txtPrescriptionNote.Text = String.Empty;
                    txtNumberOfMedication.Text = String.Empty;

                    txtNumPhysicalTherapy.Text = String.Empty;
                    txtPhysicalTherapyRxNote.Text = String.Empty;
                }
                else if (comboMedBillType.SelectedIndex == 1)       // Medical Bill Type - Prescription
                {
                    txtNumPhysicalTherapy.Text = String.Empty;
                    txtPhysicalTherapyRxNote.Text = String.Empty;

                    rbInpatient.Checked = false;
                    rbOutpatient.Checked = false;

                    //comboPendingReason.SelectedIndex = 0;
                    //comboIneligibleReason.SelectedIndex = 0;

                    txtMedBillNote.Text = String.Empty;
                }
                else if (comboMedBillType.SelectedIndex == 2)       // Medical Bill Type - Physical Therapy
                {
                    txtPrescriptionName.Text = String.Empty;
                    txtPrescriptionDescription.Text = String.Empty;
                    txtPrescriptionNote.Text = String.Empty;
                    txtNumberOfMedication.Text = String.Empty;

                    rbInpatient.Checked = false;
                    rbOutpatient.Checked = false;

                    //comboPendingReason.SelectedIndex = 0;
                    //comboIneligibleReason.SelectedIndex = 0;

                    txtMedBillNote.Text = String.Empty;
                }

                if (MedBillForEdit.ProposalLetterSentDate != null)
                {
                    dtpProposalLetterSentDate.Checked = true;
                    dtpProposalLetterSentDate.Value = MedBillForEdit.ProposalLetterSentDate.Value;
                    dtpProposalLetterSentDate.Format = DateTimePickerFormat.Short;
                }
                if (MedBillForEdit.HIPPASentDate != null)
                {
                    dtpHippaSentDate.Checked = true;
                    dtpHippaSentDate.Value = MedBillForEdit.HIPPASentDate.Value;
                    dtpHippaSentDate.Format = DateTimePickerFormat.Short;
                }
                if (MedBillForEdit.MedicalRecordDate != null)
                {
                    dtpMedicalRecordDate.Checked = true;
                    dtpMedicalRecordDate.Value = MedBillForEdit.MedicalRecordDate.Value;
                    dtpMedicalRecordDate.Format = DateTimePickerFormat.Short;
                }

                if (MedBillForEdit.IllnessId != -1) Illness.IllnessId = MedBillForEdit.IllnessId.ToString();
                else Illness.IllnessId = String.Empty;
                if (MedBillForEdit.IncidentId != -1) Incident.IncidentId = MedBillForEdit.IncidentId.ToString();
                else Incident.IncidentId = String.Empty;

                /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                String ICD10Code = txtMedBill_ICD10Code.Text.Trim();

                String strSqlQueryForDiseaseName = "select [dbo].[ICD10 Code].[Name] from [dbo].[ICD10 Code] where [dbo].[ICD10 Code].[ICD10_CODE__C] = @ICD10Code";

                SqlCommand cmdQueryForDiseaseName = new SqlCommand(strSqlQueryForDiseaseName, connSalesforce);
                cmdQueryForDiseaseName.CommandType = CommandType.Text;

                cmdQueryForDiseaseName.Parameters.AddWithValue("@ICD10Code", ICD10Code);

                if (connSalesforce.State != ConnectionState.Closed)
                {
                    connSalesforce.Close();
                    connSalesforce.Open();
                }
                else if (connSalesforce.State == ConnectionState.Closed) connSalesforce.Open();

                Object objDiseaseName = cmdQueryForDiseaseName.ExecuteScalar();
                txtMedBillDiseaseName.Text = objDiseaseName?.ToString();
                if (connSalesforce.State == ConnectionState.Open) connSalesforce.Close();

                var srcMedicalProvider = new AutoCompleteStringCollection();

                for (int i = 0; i < lstMedicalProvider.Count; i++)
                {
                    srcMedicalProvider.Add(lstMedicalProvider[i].Name);
                }

                txtMedicalProvider.AutoCompleteMode = AutoCompleteMode.SuggestAppend;
                txtMedicalProvider.AutoCompleteSource = AutoCompleteSource.CustomSource;
                txtMedicalProvider.AutoCompleteCustomSource = srcMedicalProvider;

                /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                // Settlement

                lstPaymentMethod.Clear();
                String strSqlQueryForPaymentMethod = "select [dbo].[tbl_payment_method].[PaymentMethod_Id], [dbo].[tbl_payment_method].[PaymentMethod_Value] from [dbo].[tbl_payment_method] " +
                                                     "order by [dbo].[tbl_payment_method].[PaymentMethod_Value]";

                SqlCommand cmdQueryForPaymentMethod = new SqlCommand(strSqlQueryForPaymentMethod, connRN4);
                cmdQueryForPaymentMethod.CommandType = CommandType.Text;

                //if (connRN.State == ConnectionState.Closed) connRN.Open();
                if (connRN4.State != ConnectionState.Closed)
                {
                    connRN4.Close();
                    connRN4.Open();
                }
                else if (connRN4.State == ConnectionState.Closed) connRN4.Open();
                SqlDataReader rdrPaymentMethod = cmdQueryForPaymentMethod.ExecuteReader();
                if (rdrPaymentMethod.HasRows)
                {
                    while (rdrPaymentMethod.Read())
                    {
                        if (!rdrPaymentMethod.IsDBNull(1)) lstPaymentMethod.Add(new PaymentMethod { PaymentMethodId = rdrPaymentMethod.GetInt16(0), PaymentMethodValue = rdrPaymentMethod.GetString(1) });
                        else lstPaymentMethod.Add(new PaymentMethod { PaymentMethodId = rdrPaymentMethod.GetInt16(0), PaymentMethodValue = null });
                    }
                }
                rdrPaymentMethod.Close();
                if (connRN4.State != ConnectionState.Closed) connRN4.Close();

                // Retrieve credit card info
                lstCreditCardInfo.Clear();
                String strSqlQueryForCreditCardInfo = "select [dbo].[tbl_Credit_Card__c].[CreditCard_Id], [dbo].[tbl_Credit_Card__c].[Name] from [dbo].[tbl_Credit_Card__c]";

                SqlCommand cmdQueryForCreditCardInfo = new SqlCommand(strSqlQueryForCreditCardInfo, connRN4);
                cmdQueryForCreditCardInfo.CommandType = CommandType.Text;

                if (connRN4.State != ConnectionState.Closed)
                {
                    connRN4.Close();
                    connRN4.Open();
                }
                else if (connRN4.State == ConnectionState.Closed) connRN4.Open();

                SqlDataReader rdrCreditCardInfo = cmdQueryForCreditCardInfo.ExecuteReader();
                if (rdrCreditCardInfo.HasRows)
                {
                    while (rdrCreditCardInfo.Read())
                    {
                        if (!rdrCreditCardInfo.IsDBNull(1))
                            lstCreditCardInfo.Add(new CreditCardInfo { CreditCardId = rdrCreditCardInfo.GetInt16(0), CreditCardNo = rdrCreditCardInfo.GetString(1) });
                        else
                            lstCreditCardInfo.Add(new CreditCardInfo { CreditCardId = rdrCreditCardInfo.GetInt16(0), CreditCardNo = null });
                    }
                }
                rdrCreditCardInfo.Close();
                if (connRN4.State != ConnectionState.Closed) connRN4.Close();

                ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                String IncidentNo = txtMedBill_Incident.Text.Trim();
                String IndividualIdMedBill = txtCaseIndividualID.Text.Trim();

                String strSqlQueryForIncident = "select [dbo].[tbl_incident].[Program_id], [dbo].[tbl_program].[ProgramName], [dbo].[tbl_incident].[IsDeleted] " +
                                "from [dbo].[tbl_incident] " +
                                "inner join [dbo].[tbl_program] on [dbo].[tbl_incident].[Program_id] = [dbo].[tbl_program].[Program_Id] " +
                                "where [dbo].[tbl_incident].[Individual_id] = @IndividualId and " +
                                "[dbo].[tbl_incident].[IncidentNo] = @IncidentNo " +
                                "order by [dbo].[tbl_incident].[Program_id]";

                SqlCommand cmdQueryForIncident = new SqlCommand(strSqlQueryForIncident, connRN4);
                cmdQueryForIncident.CommandType = CommandType.Text;

                cmdQueryForIncident.Parameters.AddWithValue("@IndividualId", IndividualIdMedBill);
                cmdQueryForIncident.Parameters.AddWithValue("@IncidentNo", IncidentNo);

                if (connRN4.State != ConnectionState.Closed)
                {
                    connRN4.Close();
                    connRN4.Open();
                }
                else if (connRN4.State == ConnectionState.Closed) connRN4.Open();

                SqlDataReader rdrIncident = cmdQueryForIncident.ExecuteReader();
                lstIncidentProgramInfo.Clear();
                if (rdrIncident.HasRows)
                {
                    while (rdrIncident.Read())
                    {
                        if (!rdrIncident.IsDBNull(0) && !rdrIncident.IsDBNull(1))
                        {
                            IncidentProgramInfo incidentProgram = new IncidentProgramInfo(rdrIncident.GetBoolean(2), rdrIncident.GetInt16(0), rdrIncident.GetString(1).Trim());
                            lstIncidentProgramInfo.Add(incidentProgram);
                        }
                    }
                }
                rdrIncident.Close();
                if (connRN4.State == ConnectionState.Open) connRN4.Close();

                //String strSqlQueryForIncidentChange = "select [dbo].[tbl_incident_history].[Program_id], [dbo].[tbl_program].[ProgramName], [dbo].[tbl_incident_history].[IsDeleted] " +
                //                        "from [dbo].[tbl_incident_history] " +
                //                        "inner join [dbo].[tbl_program] on [dbo].[tbl_incident_history].[Program_id] = [dbo].[tbl_program].[Program_Id] " +
                //                        "where ([dbo].[tbl_incident_history].[Operation] = 2 or " +
                //                        "[dbo].[tbl_incident_history].[Operation] = 3 or " +
                //                        "[dbo].[tbl_incident_history].[Operation] = 4) and " +
                //                        "[dbo].[tbl_incident_history].[Individual_id] = @IndividualId and" +
                //                        "[dbo].[tbl_incident_history].[IncidentNo] = @IncidentNo " +
                //                        "order by [dbo].[tbl_incident_history].[Program_id]";

                //SqlCommand cmdQueryForIncidentChange = new SqlCommand(strSqlQueryForIncidentChange, connRN4);
                //cmdQueryForIncidentChange.CommandType = CommandType.Text;

                //cmdQueryForIncidentChange.Parameters.AddWithValue("@IndividualId", IndividualIdMedBill);
                //cmdQueryForIncidentChange.Parameters.AddWithValue("@IncidentNo", IncidentNo);

                //if (connRN4.State != ConnectionState.Closed)
                //{
                //    connRN4.Close();
                //    connRN4.Open();
                //}
                //else if (connRN4.State == ConnectionState.Closed) connRN4.Open();
                //SqlDataReader rdrIncidentChange = cmdQueryForIncidentChange.ExecuteReader();
                ////lstIncidentProgramInfo.Clear();
                //if (rdrIncidentChange.HasRows)
                //{
                //    while (rdrIncidentChange.Read())
                //    {
                //        if (!rdrIncidentChange.IsDBNull(0) && !rdrIncidentChange.IsDBNull(1))
                //        {
                //            IncidentProgramInfo incidentProgram = new IncidentProgramInfo(rdrIncidentChange.GetBoolean(2), rdrIncidentChange.GetInt16(0), rdrIncidentChange.GetString(1).Trim());
                //            lstIncidentProgramInfo.Add(incidentProgram);
                //        }
                //    }
                //}
                //rdrIncidentChange.Close();
                //if (connRN4.State == ConnectionState.Open) connRN4.Close();

                //foreach (IncidentProgramInfo incdInfo in lstIncidentProgramInfo)
                //{
                //    if (incdInfo.bIsDeleted == true)
                //    {
                //        MessageBox.Show("The Incident has been deleted. Personal Responsibility cannot be calculated.", "Error");
                //        lstIncidentProgramInfo.Clear();
                //    }
                //}

                //Boolean bBronze = false;
                //Boolean bSilver = false;
                //Boolean bGold = false;
                //Boolean bGoldPlus = false;
                //Boolean bGoldMed1 = false;
                //Boolean bGoldMed2 = false;

                //if (lstIncidentProgramInfo.Count > 0)
                //{
                //    foreach (IncidentProgramInfo incidentInfo in lstIncidentProgramInfo)
                //    {
                //        if ((incidentInfo.IncidentProgramId == 3) &&
                //            (incidentInfo.bIsDeleted == false))
                //        {
                //            incidentInfo.bPersonalResponsibilityProgram = true;
                //            bBronze = true;
                //            break;
                //        }
                //    }

                //    foreach (IncidentProgramInfo incidentInfo in lstIncidentProgramInfo)
                //    {
                //        if ((incidentInfo.IncidentProgramId == 2) &&
                //            (bBronze == false) &&
                //            (incidentInfo.bIsDeleted == false))
                //        {
                //            incidentInfo.bPersonalResponsibilityProgram = true;
                //            bSilver = true;
                //            break;
                //        }
                //    }

                //    foreach (IncidentProgramInfo incidentInfo in lstIncidentProgramInfo)
                //    {
                //        if ((incidentInfo.IncidentProgramId == 1) &&
                //            (bBronze == false) &&
                //            (bSilver == false) &&
                //            (incidentInfo.bIsDeleted == false))
                //        {
                //            incidentInfo.bPersonalResponsibilityProgram = true;
                //            break;
                //        }
                //    }

                //    foreach (IncidentProgramInfo incidentInfo in lstIncidentProgramInfo)
                //    {
                //        if ((incidentInfo.IncidentProgramId == 0) &&
                //            (bBronze == false) &&
                //            (bSilver == false) &&
                //            (bGold == false) &&
                //            (incidentInfo.bIsDeleted == false))
                //        {
                //            incidentInfo.bPersonalResponsibilityProgram = true;
                //            break;
                //        }
                //    }

                //    foreach (IncidentProgramInfo incidentInfo in lstIncidentProgramInfo)
                //    {
                //        if ((incidentInfo.IncidentProgramId == 4) &&
                //            (bBronze == false) &&
                //            (bSilver == false) &&
                //            (bGold == false) &&
                //            (bGoldPlus == false) &&
                //            (incidentInfo.bIsDeleted == false))
                //        {
                //            incidentInfo.bPersonalResponsibilityProgram = true;
                //            break;
                //        }
                //    }

                //    foreach (IncidentProgramInfo incidentInfo in lstIncidentProgramInfo)
                //    {
                //        if ((incidentInfo.IncidentProgramId == 5) &&
                //            (bBronze == false) &&
                //            (bSilver == false) &&
                //            (bGold == false) &&
                //            (bGoldPlus == false) &&
                //            (bGoldMed1 == false) &&
                //            (incidentInfo.bIsDeleted == false))
                //        {
                //            incidentInfo.bPersonalResponsibilityProgram = true;
                //            break;
                //        }
                //    }
                //}

                //foreach (IncidentProgramInfo incidentInfo in lstIncidentProgramInfo)
                //{
                //    if (incidentInfo.bPersonalResponsibilityProgram == true)
                //        PersonalResponsibilityAmountInMedBill = incidentInfo.PersonalResponsibilityAmount;
                //}

                /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                String strSqlQueryForSettlement = "select [dbo].[tbl_settlement].[Name], [dbo].[tbl_settlement_type_code].[SettlementTypeValue], [dbo].[tbl_settlement].[Amount], " +
                                                  "[dbo].[tbl_settlement].[PersonalResponsibilityCredit], [dbo].[tbl_payment_method].[PaymentMethod_Value], " +
                                                  "[dbo].[tbl_settlement].[Approved], [dbo].[tbl_settlement].[ApprovedDate], " +
                                                  "[dbo].[tbl_settlement].[CheckNo], [dbo].[tbl_settlement].[CheckDate], [dbo].[tbl_settlement].[CheckReconciled], " +
                                                  "[dbo].[tbl_settlement].[ACH_Number], [dbo].[tbl_settlement].[ACH_Date], [dbo].[tbl_settlement].[ACH_Reconciled], " +
                                                  "[dbo].[tbl_Credit_Card__c].[Name], [dbo].[tbl_settlement].[CMMCreditCardPaidDate], [dbo].[tbl_settlement].[CC_Reconciled], " +
                                                  "[dbo].[tbl_settlement].[AllowedAmount], [dbo].[tbl_settlement].[IneligibleReason], " +
                                                  "[dbo].[tbl_settlement].[Notes] " +
                                                  "from [dbo].[tbl_settlement] inner join [dbo].[tbl_settlement_type_code] " +
                                                  "on [dbo].[tbl_settlement].[SettlementType] = [dbo].[tbl_settlement_type_code].[SettlementTypeCode] " +
                                                  "inner join [dbo].[tbl_payment_method] on [dbo].[tbl_settlement].[CMMPaymentMethod] = [dbo].[tbl_payment_method].[PaymentMethod_Id] " +
                                                  "inner join [dbo].[tbl_Credit_Card__c] on [dbo].[tbl_settlement].[CMMCreditCard] = [dbo].[tbl_Credit_Card__c].[CreditCard_Id]" +
                                                  "where [dbo].[tbl_settlement].[MedicalBillID] = @MedBillNo and " +
                                                  "[dbo].[tbl_settlement].[IsDeleted] = 0 " +
                                                  "order by [dbo].[tbl_settlement].[Name]";

                SqlCommand cmdQueryForSettlement = new SqlCommand(strSqlQueryForSettlement, connRN4);
                cmdQueryForSettlement.CommandType = CommandType.Text;

                cmdQueryForSettlement.Parameters.AddWithValue("@MedBillNo", MedBillNo);

                SqlDependency dependencySettlementInMedBill = new SqlDependency(cmdQueryForSettlement);
                dependencySettlementInMedBill.OnChange += new OnChangeEventHandler(OnSettlementsInMedBillEditChange);

                //if (connRN.State == ConnectionState.Closed) connRN.Open();
                if (connRN4.State != ConnectionState.Closed)
                {
                    connRN4.Close();
                    connRN4.Open();
                }
                else if (connRN4.State == ConnectionState.Closed) connRN4.Open();
                SqlDataReader rdrSettlement = cmdQueryForSettlement.ExecuteReader();
                gvSettlementsInMedBill.Rows.Clear();
                if (rdrSettlement.HasRows)
                {
                    while (rdrSettlement.Read())
                    {
                        DataGridViewRow row = new DataGridViewRow();
                        row.Cells.Add(new DataGridViewCheckBoxCell { Value = false });
                        if (!rdrSettlement.IsDBNull(0)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlement.GetString(0) });
                        if (!rdrSettlement.IsDBNull(1))
                        {
                            DataGridViewComboBoxCell comboCellSettlementType = new DataGridViewComboBoxCell();

                            for (int i = 0; i < lstSettlementType.Count; i++)
                            {
                                comboCellSettlementType.Items.Add(lstSettlementType[i].SettlementTypeValue);
                            }
                            for (int i = 0; i < comboCellSettlementType.Items.Count; i++)
                            {
                                if (rdrSettlement.GetString(1) == comboCellSettlementType.Items[i].ToString())
                                    comboCellSettlementType.Value = comboCellSettlementType.Items[i];
                            }

                            row.Cells.Add(comboCellSettlementType);
                        }
                        else
                        {
                            DataGridViewComboBoxCell comboCellSettlementType = new DataGridViewComboBoxCell();
                            for (int i = 0; i < lstSettlementType.Count; i++)
                            {
                                comboCellSettlementType.Items.Add(lstSettlementType[i].SettlementTypeValue);
                            }

                            for (int i = 0; i < comboCellSettlementType.Items.Count; i++)
                            {
                                if (rdrSettlement.GetString(1) == comboCellSettlementType.Items[i].ToString())
                                    comboCellSettlementType.Value = comboCellSettlementType.Items[i];
                            }

                            row.Cells.Add(comboCellSettlementType);
                        }

                        if (!rdrSettlement.IsDBNull(2)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlement.GetDecimal(2).ToString("C") });
                        else
                        {
                            Decimal Zero = 0;
                            row.Cells.Add(new DataGridViewTextBoxCell { Value = Zero.ToString("C") });
                        }


                        if (!rdrSettlement.IsDBNull(3)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlement.GetDecimal(3).ToString("C") });
                        else
                        {
                            Decimal Zero = 0;
                            row.Cells.Add(new DataGridViewTextBoxCell { Value = Zero.ToString("C") });
                        }

                        /////////////////////////////////////////////////////////////////////
                        if (!rdrSettlement.IsDBNull(4))
                        {
                            DataGridViewComboBoxCell comboCellPaymentMethod = new DataGridViewComboBoxCell();

                            for (int i = 0; i < lstPaymentMethod.Count; i++)
                            {
                                if (lstPaymentMethod[i].PaymentMethodValue != null) comboCellPaymentMethod.Items.Add(lstPaymentMethod[i].PaymentMethodValue);
                                else comboCellPaymentMethod.Items.Add(String.Empty);
                            }

                            for (int i = 0; i < comboCellPaymentMethod.Items.Count; i++)
                            {
                                if (rdrSettlement.GetString(4) == comboCellPaymentMethod.Items[i].ToString())
                                    comboCellPaymentMethod.Value = comboCellPaymentMethod.Items[i];
                            }

                            row.Cells.Add(comboCellPaymentMethod);
                        }
                        else
                        {
                            DataGridViewComboBoxCell comboCellPaymentMethod = new DataGridViewComboBoxCell();

                            for (int i = 0; i < lstPaymentMethod.Count; i++)
                            {
                                if (lstPaymentMethod[i].PaymentMethodValue != null) comboCellPaymentMethod.Items.Add(lstPaymentMethod[i].PaymentMethodValue);
                                else comboCellPaymentMethod.Items.Add(String.Empty);
                                //comboCellPaymentMethod.Items.Add(lstPaymentMethod[i].PaymentMethodValue);
                            }

                            for (int i = 0; i < comboCellPaymentMethod.Items.Count; i++)
                            {
                                if ((!rdrSettlement.IsDBNull(4)) && comboCellPaymentMethod.Items[i] != null)
                                {
                                    if (rdrSettlement.GetString(4) == comboCellPaymentMethod.Items[i].ToString())
                                        comboCellPaymentMethod.Value = comboCellPaymentMethod.Items[i];
                                }
                                else comboCellPaymentMethod.Value = null;
                            }

                            row.Cells.Add(comboCellPaymentMethod);

                        }

                        /////////////////////////////////////////////////////////////////////
                        ///
                        if (!rdrSettlement.IsDBNull(5))
                        {
                            DataGridViewCheckBoxCell approvedCell = new DataGridViewCheckBoxCell();
                            approvedCell.Value = rdrSettlement.GetBoolean(5);
                            approvedCell.Style.Alignment = DataGridViewContentAlignment.MiddleCenter;
                            row.Cells.Add(approvedCell);
                            if (LoggedInUserRole == UserRole.RNStaff ||
                                LoggedInUserRole == UserRole.NPStaff ||
                                LoggedInUserRole == UserRole.FDStaff ||
                                LoggedInUserRole == UserRole.MSStaff)
                                row.Cells[6].ReadOnly = true;
                            else if (LoggedInUserRole == UserRole.RNManager ||
                                     LoggedInUserRole == UserRole.NPManager ||
                                     LoggedInUserRole == UserRole.FDManager ||
                                     LoggedInUserRole == UserRole.MSManager ||
                                     LoggedInUserRole == UserRole.Administrator ||
                                     LoggedInUserRole == UserRole.SuperAdmin ||
                                     LoggedInUserRole == UserRole.Executive)
                                row.Cells[6].ReadOnly = false;
                        }
                        else
                        {
                            DataGridViewCheckBoxCell approvedCell = new DataGridViewCheckBoxCell();
                            approvedCell.Value = false;
                            approvedCell.Style.Alignment = DataGridViewContentAlignment.MiddleCenter;
                            row.Cells.Add(approvedCell);
                            if (LoggedInUserRole == UserRole.RNStaff ||
                                LoggedInUserRole == UserRole.NPStaff ||
                                LoggedInUserRole == UserRole.FDStaff ||
                                LoggedInUserRole == UserRole.MSStaff)
                                row.Cells[6].ReadOnly = true;
                            else if (LoggedInUserRole == UserRole.RNManager ||
                                     LoggedInUserRole == UserRole.NPManager ||
                                     LoggedInUserRole == UserRole.FDManager ||
                                     LoggedInUserRole == UserRole.MSManager ||
                                     LoggedInUserRole == UserRole.Administrator ||
                                     LoggedInUserRole == UserRole.SuperAdmin ||
                                     LoggedInUserRole == UserRole.Executive)
                                row.Cells[6].ReadOnly = false;
                        }

                        if (!rdrSettlement.IsDBNull(6))
                        {
                            row.Cells.Add(new CalendarCell { Value = DateTime.Parse(rdrSettlement.GetDateTime(6).ToString("MM/dd/yyyy")) });
                            row.Cells[7].ReadOnly = true;
                        }
                        else
                        {
                            row.Cells.Add(new CalendarCell { Value = null });
                            row.Cells[7].ReadOnly = true;
                        }

                        // Payment information
                        if (!rdrSettlement.IsDBNull(4))
                        {
                            String strPaymentMethod = rdrSettlement.GetString(4);

                            switch (strPaymentMethod)
                            {
                                case "Check":
                                    if (!rdrSettlement.IsDBNull(7)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlement.GetString(7) });
                                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = null });
                                    row.Cells.Add(new DataGridViewTextBoxCell { Value = null });
                                    DataGridViewComboBoxCell comboCellCreditCardNoneForCheck = new DataGridViewComboBoxCell();
                                    for (int i = 0; i < lstCreditCardInfo.Count; i++)
                                    {
                                        if (lstCreditCardInfo[i].CreditCardNo != null) comboCellCreditCardNoneForCheck.Items.Add(lstCreditCardInfo[i].CreditCardNo);
                                        else comboCellCreditCardNoneForCheck.Items.Add(String.Empty);
                                    }
                                    row.Cells.Add(comboCellCreditCardNoneForCheck);
                                    if (!rdrSettlement.IsDBNull(8))
                                    {
                                        row.Cells.Add(new CalendarCell { Value = DateTime.Parse(rdrSettlement.GetDateTime(8).ToString("MM/dd/yyyy")) });
                                    }
                                    else
                                    {
                                        row.Cells.Add(new CalendarCell { Value = String.Empty });
                                    }
                                    if (!rdrSettlement.IsDBNull(9))
                                    {
                                        row.Cells.Add(new DataGridViewCheckBoxCell { Value = rdrSettlement.GetBoolean(9) });
                                    }
                                    else
                                    {
                                        row.Cells.Add(new DataGridViewCheckBoxCell { Value = null });
                                    }
                                    break;
                                case "ACH/Banking":
                                    row.Cells.Add(new DataGridViewTextBoxCell { Value = null });
                                    if (!rdrSettlement.IsDBNull(10)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlement.GetString(10) });
                                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = null });
                                    DataGridViewComboBoxCell comboCellCreditCardNoneForACH = new DataGridViewComboBoxCell();
                                    for (int i = 0; i < lstCreditCardInfo.Count; i++)
                                    {
                                        if (lstCreditCardInfo[i].CreditCardNo != null)
                                            comboCellCreditCardNoneForACH.Items.Add(lstCreditCardInfo[i].CreditCardNo);
                                        else comboCellCreditCardNoneForACH.Items.Add(String.Empty);
                                    }
                                    row.Cells.Add(comboCellCreditCardNoneForACH);
                                    if (!rdrSettlement.IsDBNull(11))
                                    {
                                        row.Cells.Add(new CalendarCell { Value = DateTime.Parse(rdrSettlement.GetDateTime(11).ToString("MM/dd/yyyy")) });
                                    }
                                    else
                                    {
                                        row.Cells.Add(new CalendarCell { Value = String.Empty });
                                    }
                                    if (!rdrSettlement.IsDBNull(12))
                                    {
                                        row.Cells.Add(new DataGridViewCheckBoxCell { Value = rdrSettlement.GetBoolean(12) });
                                    }
                                    else
                                    {
                                        row.Cells.Add(new DataGridViewCheckBoxCell { Value = null });
                                    }
                                    break;
                                case "Credit Card":
                                    row.Cells.Add(new DataGridViewTextBoxCell { Value = null });
                                    row.Cells.Add(new DataGridViewTextBoxCell { Value = null });
                                    DataGridViewComboBoxCell comboCellCreditCard = new DataGridViewComboBoxCell();
                                    if (!rdrSettlement.IsDBNull(13))
                                    {
                                        for (int i = 0; i < lstCreditCardInfo.Count; i++)
                                        {
                                            if (lstCreditCardInfo[i].CreditCardNo != null) comboCellCreditCard.Items.Add(lstCreditCardInfo[i].CreditCardNo);
                                            else comboCellCreditCard.Items.Add(String.Empty);
                                        }
                                        for (int i = 0; i < comboCellCreditCard.Items.Count; i++)
                                        {
                                            if (rdrSettlement.GetString(13) == comboCellCreditCard.Items[i].ToString())
                                                comboCellCreditCard.Value = comboCellCreditCard.Items[i];
                                        }
                                    }
                                    else
                                    {
                                        //DataGridViewComboBoxCell comboCellCreditCard = new DataGridViewComboBoxCell();
                                        for (int i = 0; i < lstCreditCardInfo.Count; i++)
                                        {
                                            if (lstCreditCardInfo[i].CreditCardNo != null) comboCellCreditCard.Items.Add(lstCreditCardInfo[i].CreditCardNo);
                                            else comboCellCreditCard.Items.Add(String.Empty);
                                        }
                                        comboCellCreditCard.Value = String.Empty;
                                        //row.Cells.Add(comboCellCreditCard);
                                    }
                                    row.Cells.Add(comboCellCreditCard);
                                    if (!rdrSettlement.IsDBNull(14)) row.Cells.Add(new CalendarCell { Value = DateTime.Parse(rdrSettlement.GetDateTime(14).ToString("MM/dd/yyyy")) });
                                    else row.Cells.Add(new CalendarCell { Value = String.Empty });
                                    if (!rdrSettlement.IsDBNull(15)) row.Cells.Add(new DataGridViewCheckBoxCell { Value = rdrSettlement.GetBoolean(15) });
                                    else row.Cells.Add(new DataGridViewCheckBoxCell { Value = false });
                                    break;
                                default:
                                    row.Cells.Add(new DataGridViewTextBoxCell { Value = null });
                                    row.Cells.Add(new DataGridViewTextBoxCell { Value = null });
                                    DataGridViewComboBoxCell comboCellCreditCardNone = new DataGridViewComboBoxCell();
                                    for (int i = 0; i < lstCreditCardInfo.Count; i++)
                                    {
                                        if (lstCreditCardInfo[i].CreditCardNo != null) comboCellCreditCardNone.Items.Add(lstCreditCardInfo[i].CreditCardNo);
                                        else comboCellCreditCardNone.Items.Add(String.Empty);
                                    }
                                    row.Cells.Add(comboCellCreditCardNone);
                                    row.Cells.Add(new CalendarCell { Value = null });
                                    row.Cells.Add(new DataGridViewCheckBoxCell { Value = null });
                                    break;
                            }
                        }
                        else
                        {

                            DataGridViewTextBoxCell txtCheckNoCell = new DataGridViewTextBoxCell();
                            txtCheckNoCell.Value = null;
                            row.Cells.Add(txtCheckNoCell);
                            DataGridViewTextBoxCell txtACHNoCell = new DataGridViewTextBoxCell();
                            txtACHNoCell.Value = null;
                            row.Cells.Add(txtACHNoCell);
                            DataGridViewComboBoxCell comboCreditCardCell = new DataGridViewComboBoxCell();
                            for (int i = 0; i < lstCreditCardInfo.Count; i++)
                            {
                                if (lstCreditCardInfo[i].CreditCardNo != null) comboCreditCardCell.Items.Add(lstCreditCardInfo[i].CreditCardNo);
                                else comboCreditCardCell.Items.Add(String.Empty);
                            }
                            row.Cells.Add(comboCreditCardCell);
                            comboCreditCardCell.ReadOnly = true;
                            CalendarCell calPaymentDate = new CalendarCell();
                            calPaymentDate.Value = null;
                            row.Cells.Add(calPaymentDate);
                            DataGridViewCheckBoxCell chkReconciledCell = new DataGridViewCheckBoxCell();
                            chkReconciledCell.Value = false;
                            row.Cells.Add(chkReconciledCell);

                        }


                        if (!rdrSettlement.IsDBNull(16)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlement.GetDecimal(16).ToString("C") });
                        else row.Cells.Add(new DataGridViewTextBoxCell { Value = null });

                        if (!rdrSettlement.IsDBNull(17))
                        {
                            if (dicIneligibleReason.Count > 0)
                            {
                                DataGridViewComboBoxCell comboCellIneligibleReason = new DataGridViewComboBoxCell();
                                for (int i = 0; i < dicIneligibleReason.Count; i++)
                                {
                                    comboCellIneligibleReason.Items.Add(dicIneligibleReason[i]);
                                }
                                comboCellIneligibleReason.Value = comboCellIneligibleReason.Items[rdrSettlement.GetInt32(17)];
                                //comboIneligibleReason.Sorted = true;
                                row.Cells.Add(comboCellIneligibleReason);
                            }
                        }
                        else
                        {
                            if (dicIneligibleReason.Count > 0)
                            {
                                DataGridViewComboBoxCell comboCellIneligibleReason = new DataGridViewComboBoxCell();
                                for (int i = 0; i < dicIneligibleReason.Count; i++)
                                {
                                    comboCellIneligibleReason.Items.Add(dicIneligibleReason[i]);
                                }
                                comboCellIneligibleReason.Value = comboCellIneligibleReason.Items[0];
                                //comboIneligibleReason.Sorted = true;
                                row.Cells.Add(comboCellIneligibleReason);
                            }
                        }

                        if (!rdrSettlement.IsDBNull(18)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlement.GetString(18) });
                        else row.Cells.Add(new DataGridViewTextBoxCell { Value = null });

                        gvSettlementsInMedBill.Rows.Add(row);
                        //AddNewRowToGVSettlementSafely(row);
                    }
                }
                rdrSettlement.Close();
                if (connRN4.State != ConnectionState.Closed) connRN4.Close();

                for (int i = 0; i < gvSettlementsInMedBill.Rows.Count; i++)
                {
                    if (gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "3rd Party Discount" ||
                        gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "Member Payment" ||
                        gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "CMM Discount" ||
                        gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "Ineligible" ||
                        gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "Medical Provider Refund" ||
                        gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "Member Discount")
                    {
                        gvSettlementsInMedBill["Approved", i].Value = false;
                        gvSettlementsInMedBill["Approved", i].ReadOnly = true;
                    }

                    gvSettlementsInMedBill["ApprovedDate", i].ReadOnly = true;
                }

                ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                ///

                for (int i = 0; i < gvSettlementsInMedBill.Rows.Count; i++)
                {
                    if (gvSettlementsInMedBill["PaymentMethod", i]?.Value?.ToString() == "Check")
                    {
                        gvSettlementsInMedBill.Rows[i].Cells["CheckNo"].ReadOnly = false;
                        gvSettlementsInMedBill.Rows[i].Cells["PaymentDate"].ReadOnly = false;
                        gvSettlementsInMedBill.Rows[i].Cells["Reconciled"].ReadOnly = false;
                        gvSettlementsInMedBill.Rows[i].Cells["ACHNo"].ReadOnly = true;
                        gvSettlementsInMedBill.Rows[i].Cells["CreditCard"].ReadOnly = true;
                    }

                    if (gvSettlementsInMedBill["PaymentMethod", i]?.Value?.ToString() == "ACH/Banking")
                    {
                        gvSettlementsInMedBill.Rows[i].Cells["ACHNo"].ReadOnly = false;
                        gvSettlementsInMedBill.Rows[i].Cells["PaymentDate"].ReadOnly = false;
                        gvSettlementsInMedBill.Rows[i].Cells["Reconciled"].ReadOnly = false;
                        gvSettlementsInMedBill.Rows[i].Cells["CheckNo"].ReadOnly = true;
                        gvSettlementsInMedBill.Rows[i].Cells["CreditCard"].ReadOnly = true;
                    }

                    if (gvSettlementsInMedBill["PaymentMethod", i]?.Value?.ToString() == "Credit Card")
                    {
                        gvSettlementsInMedBill.Rows[i].Cells["CreditCard"].ReadOnly = false;
                        gvSettlementsInMedBill.Rows[i].Cells["PaymentDate"].ReadOnly = false;
                        gvSettlementsInMedBill.Rows[i].Cells["Reconciled"].ReadOnly = false;
                        gvSettlementsInMedBill.Rows[i].Cells["CheckNo"].ReadOnly = true;
                        gvSettlementsInMedBill.Rows[i].Cells["ACHNo"].ReadOnly = true;
                    }
                    if (gvSettlementsInMedBill["PaymentMethod", i]?.Value == null)
                    {
                        gvSettlementsInMedBill.Rows[i].Cells["CheckNo"].ReadOnly = true;
                        gvSettlementsInMedBill.Rows[i].Cells["ACHNo"].ReadOnly = true;
                        gvSettlementsInMedBill.Rows[i].Cells["CreditCard"].ReadOnly = true;
                        gvSettlementsInMedBill.Rows[i].Cells["PaymentDate"].ReadOnly = true;
                        gvSettlementsInMedBill.Rows[i].Cells["Reconciled"].ReadOnly = true;
                    }
                }

                for (int i = 0; i < gvSettlementsInMedBill.Rows.Count; i++)
                {
                    if (gvSettlementsInMedBill[2, i]?.Value?.ToString() == "Ineligible") gvSettlementsInMedBill.Rows[i].DefaultCellStyle.BackColor = Color.Salmon;
                    else
                    {
                        gvSettlementsInMedBill["IneligibleReason", i].Value = null;
                        gvSettlementsInMedBill["IneligibleReason", i].ReadOnly = true;
                    }
                }

                if (txtMedBillAmount.Text.Trim() != String.Empty)
                {
                    Decimal SettlementTotal = 0;
                    Decimal Balance = 0;
                    Decimal Result = 0;
                    Decimal BillAmount = 0;
                    if (Decimal.TryParse(txtMedBillAmount.Text.Trim(), NumberStyles.Currency, new CultureInfo("en-US"), out Result))
                    {
                        BillAmount = Result;

                        for (int i = 0; i < gvSettlementsInMedBill.Rows.Count; i++)
                        {
                            if (gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() != "PR Reimbursement" &&
                                gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() != "Medical Provider Refund")
                            {
                                Decimal Settlement = Decimal.Parse(gvSettlementsInMedBill["SettlementAmount", i]?.Value?.ToString(), NumberStyles.Currency, new CultureInfo("en-US"));
                                SettlementTotal += Settlement;
                            }
                        }
                        if (SettlementTotal > BillAmount) MessageBox.Show("Settlement Total exceeds the Medical Bill Amount.", "Alert");
                        else
                        {
                            Balance = BillAmount - SettlementTotal;
                            txtBalance.Text = Balance.ToString("C");
                        }
                    }
                }

                Decimal TotalSharedAmount = 0;
                //if (gvSettlementsInMedBill.Rows.Count == 0) txtTotalSharedAmtMedBill.Text = TotalSharedAmount.ToString("C");
                txtTotalSharedAmtMedBill.Text = TotalSharedAmount.ToString("C");

                for (int i = 0; i < gvSettlementsInMedBill.Rows.Count; i++)
                {
                    Decimal SharedAmount = 0;
                    Decimal MedicalProviderRefund = 0;
                    Decimal result = 0;

                    if (gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "CMM Provider Payment" ||
                        gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "CMM Member Reimbursement" ||
                        gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "PR Reimbursement")
                    {
                        if (Decimal.TryParse(gvSettlementsInMedBill["SettlementAmount", i].Value.ToString(), NumberStyles.Currency, new CultureInfo("en-US"), out result))
                        {
                            SharedAmount = result;
                            TotalSharedAmount += SharedAmount;
                            txtTotalSharedAmtMedBill.Text = TotalSharedAmount.ToString("C");
                        }
                    }
                    else if (gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "Medical Provider Refund")
                    {
                        if (Decimal.TryParse(gvSettlementsInMedBill["SettlementAmount", i]?.Value?.ToString(), NumberStyles.Currency, new CultureInfo("en-US"), out result))
                        {
                            MedicalProviderRefund = result;
                            TotalSharedAmount -= MedicalProviderRefund;
                            txtTotalSharedAmtMedBill.Text = TotalSharedAmount.ToString("C");
                        }
                    }
                }

                //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                ///

                Decimal PersonResponsibilityAmt = PersonalResponsibilityAmountInMedBill;
                Decimal PersonalResponsibilityBalance = PersonalResponsibilityAmountInMedBill;
                Decimal TotalPersonalResponsibilityShared = 0;

                for (int i = 0; i < gvSettlementsInMedBill.Rows.Count; i++)
                {
                    Decimal PersonalResponsibilityShared = 0;
                    Decimal result = 0;

                    if (gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "Self Pay Discount" ||
                        gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "3rd Party Discount" ||
                        gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "Member Payment")
                    {
                        if (Decimal.TryParse(gvSettlementsInMedBill["PersonalResponsibility", i]?.Value?.ToString(), NumberStyles.Currency, new CultureInfo("en-US"), out result))
                        {
                            PersonalResponsibilityShared = result;
                            TotalPersonalResponsibilityShared += PersonalResponsibilityShared;
                            PersonalResponsibilityBalance -= TotalPersonalResponsibilityShared;
                        }
                    }
                }

                txtPersonalResponsibility.Text = PersonalResponsibilityBalance.ToString("C");

                // Populate Task GridView

                MedBillNoForTask = gvMedBillList["MedBill_BillNo", e.RowIndex].Value.ToString();
                String strSqlQueryForTaskInMedBill = "select [dbo].[tbl_task].[Subject], [dbo].[tbl_task].[DueDate], [dbo].[tbl_user].[User_Name], [dbo].[tbl_task_status_code].[TaskStatusValue], " +
                                                     "[dbo].[tbl_task].[id] " +
                                                     "from [dbo].[tbl_task] " +
                                                     "inner join [dbo].[tbl_user] on [dbo].[tbl_task].[AssignedTo] = [dbo].[tbl_user].[User_Id] " +
                                                     "inner join [dbo].[tbl_task_status_code] on [dbo].[tbl_task].[Status] = [dbo].[tbl_task_status_code].[TaskStatusCode] " +
                                                     "where [dbo].[tbl_task].[whatid] = @MedBillNo " +
                                                     "order by [dbo].[tbl_task].[CreateDate] desc";

                SqlCommand cmdQueryForTask = new SqlCommand(strSqlQueryForTaskInMedBill, connRN4);
                cmdQueryForTask.CommandType = CommandType.Text;

                cmdQueryForTask.Parameters.AddWithValue("@MedBillNo", MedBillNoForTask);

                SqlDependency dependencyTask = new SqlDependency(cmdQueryForTask);
                dependencyTask.OnChange += new OnChangeEventHandler(OnTaskInMedBillChange);

                if (connRN4.State != ConnectionState.Closed)
                {
                    connRN4.Close();
                    connRN4.Open();
                }
                else if (connRN4.State == ConnectionState.Closed) connRN4.Open();

                SqlDataReader rdrTaskForMedBill = cmdQueryForTask.ExecuteReader();
                gvMostRecentTasks.Rows.Clear();
                if (rdrTaskForMedBill.HasRows)
                {
                    while (rdrTaskForMedBill.Read())
                    {
                        DataGridViewRow row = new DataGridViewRow();
                        if (!rdrTaskForMedBill.IsDBNull(0)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrTaskForMedBill.GetString(0) });
                        else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                        if (!rdrTaskForMedBill.IsDBNull(1)) row.Cells.Add(new CalendarCell { Value = rdrTaskForMedBill.GetDateTime(1).ToString("MM/dd/yyyy") });
                        else row.Cells.Add(new CalendarCell { Value = String.Empty });
                        if (!rdrTaskForMedBill.IsDBNull(2)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrTaskForMedBill.GetString(2) });
                        else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                        if (!rdrTaskForMedBill.IsDBNull(3)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrTaskForMedBill.GetString(3) });
                        else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                        if (!rdrTaskForMedBill.IsDBNull(4)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrTaskForMedBill.GetInt32(4).ToString() });
                        else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });

                        gvMostRecentTasks.Rows.Add(row);
                    }
                }
                rdrTaskForMedBill.Close();

                if (connRN4.State == ConnectionState.Open) connRN4.Close();

                EnableMedicalBillForm();

                btnMedBillCreatePgUpperSave.Enabled = true;
                //btnMedBillCreationPgLowerSave.Enabled = true;

                if (bMedBillInUse)
                {
                    DisableMedicalBillForm();

                    EnableGroupDocumentProcessingForViewing();
                    EnableGroupMedBillDocumentsForViewing();

                }

                tbCMMManager.SelectedTab = tbpgMedicalBill;
                //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                //if (!tbCMMManager.TabPages.Contains(tbpgMedicalBill))
                //{
                //    tbCMMManager.TabPages.Add(tbpgMedicalBill);
                //    tbCMMManager.SelectedTab = tbpgMedicalBill;
                //}
                //else
                //{
                //    MessageBox.Show("Medical Bill page is already open. Close Medical Bill page first.", "Alert");
                //    return;
                //}
            }

        }

        private void btnExport_Click(object sender, EventArgs e)
        {
            ExcelPackage excelApprovedSettlement = new ExcelPackage();

            String strSqlQueryForAuthorName = "select [dbo].[tbl_user].[User_Name] from [dbo].[tbl_user] where [dbo].[tbl_user].[User_Id] = @UserId";

            SqlCommand cmdQueryForAuthorName = new SqlCommand(strSqlQueryForAuthorName, connRN3);
            cmdQueryForAuthorName.CommandType = CommandType.Text;

            cmdQueryForAuthorName.Parameters.AddWithValue("@UserId", nLoggedUserId);

            if (connRN3.State != ConnectionState.Closed)
            {
                connRN3.Close();
                connRN3.Open();
            }
            else if (connRN3.State == ConnectionState.Closed) connRN3.Open();
            String strUserName = cmdQueryForAuthorName.ExecuteScalar()?.ToString();
            if (connRN3.State == ConnectionState.Open) connRN3.Close();

            excelApprovedSettlement.Workbook.Properties.Author = strUserName;
            excelApprovedSettlement.Workbook.Properties.Title = "Approved Settlement Export";
            excelApprovedSettlement.Workbook.Properties.Subject = "Approved Settlement List";
            excelApprovedSettlement.Workbook.Properties.Created = DateTime.Now;

            ExcelWorksheet wsApprovedSettlements = excelApprovedSettlement.Workbook.Worksheets.Add("Sheet 1");

            wsApprovedSettlements.Cells["A1"].Value = "Full Name";
            wsApprovedSettlements.Cells["A1"].Style.WrapText = true;
            wsApprovedSettlements.Cells["A1"].Style.VerticalAlignment = ExcelVerticalAlignment.Center;
            wsApprovedSettlements.Cells["A1"].Style.Font.Bold = true;
            wsApprovedSettlements.Column(1).Width = 20;
            wsApprovedSettlements.Cells["B1"].Value = "First Name";
            wsApprovedSettlements.Cells["B1"].Style.WrapText = true;
            wsApprovedSettlements.Cells["B1"].Style.VerticalAlignment = ExcelVerticalAlignment.Center;
            wsApprovedSettlements.Cells["B1"].Style.Font.Bold = true;
            wsApprovedSettlements.Column(2).Width = 15;
            wsApprovedSettlements.Cells["C1"].Value = "Middle Name";
            wsApprovedSettlements.Cells["C1"].Style.WrapText = true;
            wsApprovedSettlements.Cells["C1"].Style.VerticalAlignment = ExcelVerticalAlignment.Center;
            wsApprovedSettlements.Cells["C1"].Style.Font.Bold = true;
            wsApprovedSettlements.Column(3).Width = 10;
            wsApprovedSettlements.Cells["D1"].Value = "Last Name";
            wsApprovedSettlements.Cells["D1"].Style.WrapText = true;
            wsApprovedSettlements.Cells["D1"].Style.VerticalAlignment = ExcelVerticalAlignment.Center;
            wsApprovedSettlements.Cells["D1"].Style.Font.Bold = true;
            wsApprovedSettlements.Column(4).Width = 10;
            wsApprovedSettlements.Cells["E1"].Value = "Household Role";
            wsApprovedSettlements.Cells["E1"].Style.WrapText = true;
            wsApprovedSettlements.Cells["E1"].Style.VerticalAlignment = ExcelVerticalAlignment.Center;
            wsApprovedSettlements.Cells["E1"].Style.Font.Bold = true;
            wsApprovedSettlements.Column(5).Width = 20;
            wsApprovedSettlements.Cells["F1"].Value = "Individual ID";
            wsApprovedSettlements.Cells["F1"].Style.WrapText = true;
            wsApprovedSettlements.Cells["F1"].Style.VerticalAlignment = ExcelVerticalAlignment.Center;
            wsApprovedSettlements.Cells["F1"].Style.Font.Bold = true;
            wsApprovedSettlements.Column(6).Width = 20;
            wsApprovedSettlements.Cells["G1"].Value = "Primary Name";
            wsApprovedSettlements.Cells["G1"].Style.WrapText = true;
            wsApprovedSettlements.Cells["G1"].Style.VerticalAlignment = ExcelVerticalAlignment.Center;
            wsApprovedSettlements.Cells["G1"].Style.Font.Bold = true;
            wsApprovedSettlements.Column(7).Width = 20;
            wsApprovedSettlements.Cells["H1"].Value = "CMM Payment Method";
            wsApprovedSettlements.Cells["H1"].Style.WrapText = true;
            wsApprovedSettlements.Cells["H1"].Style.VerticalAlignment = ExcelVerticalAlignment.Center;
            wsApprovedSettlements.Cells["H1"].Style.Font.Bold = true;
            wsApprovedSettlements.Column(8).Width = 20;
            wsApprovedSettlements.Cells["I1"].Value = "Program Name";
            wsApprovedSettlements.Cells["I1"].Style.WrapText = true;
            wsApprovedSettlements.Cells["I1"].Style.VerticalAlignment = ExcelVerticalAlignment.Center;
            wsApprovedSettlements.Cells["I1"].Style.Font.Bold = true;
            wsApprovedSettlements.Column(9).Width = 20;
            wsApprovedSettlements.Cells["J1"].Value = "Incident Program";
            wsApprovedSettlements.Cells["J1"].Style.WrapText = true;
            wsApprovedSettlements.Cells["J1"].Style.VerticalAlignment = ExcelVerticalAlignment.Center;
            wsApprovedSettlements.Cells["J1"].Style.Font.Bold = true;
            wsApprovedSettlements.Column(10).Width = 15;
            wsApprovedSettlements.Cells["K1"].Value = "Membership Start Date";
            wsApprovedSettlements.Cells["K1"].Style.WrapText = true;
            wsApprovedSettlements.Cells["K1"].Style.VerticalAlignment = ExcelVerticalAlignment.Center;
            wsApprovedSettlements.Cells["K1"].Style.Font.Bold = true;
            wsApprovedSettlements.Column(11).Width = 20;
            wsApprovedSettlements.Cells["L1"].Value = "Membership: Membership Number";
            wsApprovedSettlements.Cells["L1"].Style.WrapText = true;
            wsApprovedSettlements.Cells["L1"].Style.VerticalAlignment = ExcelVerticalAlignment.Center;
            wsApprovedSettlements.Cells["L1"].Style.Font.Bold = true;
            wsApprovedSettlements.Column(12).Width = 20;
            wsApprovedSettlements.Cells["M1"].Value = "Itemized Bill Received Date";
            wsApprovedSettlements.Cells["M1"].Style.WrapText = true;
            wsApprovedSettlements.Cells["M1"].Style.VerticalAlignment = ExcelVerticalAlignment.Center;
            wsApprovedSettlements.Cells["M1"].Style.Font.Bold = true;
            wsApprovedSettlements.Column(13).Width = 25;
            wsApprovedSettlements.Cells["N1"].Value = "Date of Service";
            wsApprovedSettlements.Cells["N1"].Style.WrapText = true;
            wsApprovedSettlements.Cells["N1"].Style.VerticalAlignment = ExcelVerticalAlignment.Center;
            wsApprovedSettlements.Cells["N1"].Style.Font.Bold = true;
            wsApprovedSettlements.Column(14).Width = 15;
            wsApprovedSettlements.Cells["O1"].Value = "Medical Provider: Account Name";
            wsApprovedSettlements.Cells["O1"].Style.WrapText = true;
            wsApprovedSettlements.Cells["O1"].Style.VerticalAlignment = ExcelVerticalAlignment.Center;
            wsApprovedSettlements.Cells["O1"].Style.Font.Bold = true;
            wsApprovedSettlements.Column(15).Width = 30;
            wsApprovedSettlements.Cells["P1"].Value = "Member's Account Number at Provider";
            wsApprovedSettlements.Cells["P1"].Style.WrapText = true;
            wsApprovedSettlements.Cells["P1"].Style.VerticalAlignment = ExcelVerticalAlignment.Center;
            wsApprovedSettlements.Cells["P1"].Style.Font.Bold = true;
            wsApprovedSettlements.Column(16).Width = 30;
            wsApprovedSettlements.Cells["Q1"].Value = "Account Name: Shipping Street";
            wsApprovedSettlements.Cells["Q1"].Style.WrapText = true;
            wsApprovedSettlements.Cells["Q1"].Style.VerticalAlignment = ExcelVerticalAlignment.Center;
            wsApprovedSettlements.Cells["Q1"].Style.Font.Bold = true;
            wsApprovedSettlements.Column(17).Width = 30;
            wsApprovedSettlements.Cells["R1"].Value = "Account Name: Shipping City";
            wsApprovedSettlements.Cells["R1"].Style.WrapText = true;
            wsApprovedSettlements.Cells["R1"].Style.VerticalAlignment = ExcelVerticalAlignment.Center;
            wsApprovedSettlements.Cells["R1"].Style.Font.Bold = true;
            wsApprovedSettlements.Column(18).Width = 25;
            wsApprovedSettlements.Cells["S1"].Value = "Account Name: Shipping State/Province";
            wsApprovedSettlements.Cells["S1"].Style.WrapText = true;
            wsApprovedSettlements.Cells["S1"].Style.VerticalAlignment = ExcelVerticalAlignment.Center;
            wsApprovedSettlements.Cells["S1"].Style.Font.Bold = true;
            wsApprovedSettlements.Column(19).Width = 30;
            wsApprovedSettlements.Cells["T1"].Value = "Account Name: Shipping Zip/Postal Code";
            wsApprovedSettlements.Cells["T1"].Style.WrapText = true;
            wsApprovedSettlements.Cells["T1"].Style.VerticalAlignment = ExcelVerticalAlignment.Center;
            wsApprovedSettlements.Cells["T1"].Style.Font.Bold = true;
            wsApprovedSettlements.Column(20).Width = 30;
            wsApprovedSettlements.Cells["U1"].Value = "Amount";
            wsApprovedSettlements.Cells["U1"].Style.WrapText = true;
            wsApprovedSettlements.Cells["U1"].Style.VerticalAlignment = ExcelVerticalAlignment.Center;
            wsApprovedSettlements.Cells["U1"].Style.Font.Bold = true;
            wsApprovedSettlements.Column(21).Width = 10;
            wsApprovedSettlements.Cells["V1"].Value = "Type";
            wsApprovedSettlements.Cells["V1"].Style.WrapText = true;
            wsApprovedSettlements.Cells["V1"].Style.VerticalAlignment = ExcelVerticalAlignment.Center;
            wsApprovedSettlements.Cells["V1"].Style.Font.Bold = true;
            wsApprovedSettlements.Column(22).Width = 30;
            wsApprovedSettlements.Cells["W1"].Value = "Medical Bill Name";
            wsApprovedSettlements.Cells["W1"].Style.WrapText = true;
            wsApprovedSettlements.Cells["W1"].Style.VerticalAlignment = ExcelVerticalAlignment.Center;
            wsApprovedSettlements.Cells["W1"].Style.Font.Bold = true;
            wsApprovedSettlements.Column(23).Width = 20;
            wsApprovedSettlements.Cells["X1"].Value = "Settlement Name";
            wsApprovedSettlements.Cells["X1"].Style.WrapText = true;
            wsApprovedSettlements.Cells["X1"].Style.VerticalAlignment = ExcelVerticalAlignment.Center;
            wsApprovedSettlements.Cells["X1"].Style.Font.Bold = true;
            wsApprovedSettlements.Column(24).Width = 20;
            wsApprovedSettlements.Cells["Y1"].Value = "Well-Being Care Shared";
            wsApprovedSettlements.Cells["Y1"].Style.WrapText = true;
            wsApprovedSettlements.Cells["Y1"].Style.VerticalAlignment = ExcelVerticalAlignment.Center;
            wsApprovedSettlements.Cells["Y1"].Style.Font.Bold = true;
            wsApprovedSettlements.Column(25).Width = 20;
            wsApprovedSettlements.Cells["Z1"].Value = "ICD10 Code: ICD10 Description";
            wsApprovedSettlements.Cells["Z1"].Style.WrapText = true;
            wsApprovedSettlements.Cells["Z1"].Style.VerticalAlignment = ExcelVerticalAlignment.Center;
            wsApprovedSettlements.Cells["Z1"].Style.Font.Bold = true;
            wsApprovedSettlements.Column(26).Width = 50;
            wsApprovedSettlements.Cells["AA1"].Value = "Created by - Full Name";
            wsApprovedSettlements.Cells["AA1"].Style.WrapText = true;
            wsApprovedSettlements.Cells["AA1"].Style.VerticalAlignment = ExcelVerticalAlignment.Center;
            wsApprovedSettlements.Cells["AA1"].Style.Font.Bold = true;
            wsApprovedSettlements.Column(27).Width = 20;
            wsApprovedSettlements.Cells["AB1"].Value = "Last Modified By - Full Name";
            wsApprovedSettlements.Cells["AB1"].Style.WrapText = true;
            wsApprovedSettlements.Cells["AB1"].Style.VerticalAlignment = ExcelVerticalAlignment.Center;
            wsApprovedSettlements.Cells["AB1"].Style.Font.Bold = true;
            wsApprovedSettlements.Column(28).Width = 30;
            wsApprovedSettlements.Cells["AC1"].Value = "Membership Status";
            wsApprovedSettlements.Cells["AC1"].Style.WrapText = true;
            wsApprovedSettlements.Cells["AC1"].Style.VerticalAlignment = ExcelVerticalAlignment.Center;
            wsApprovedSettlements.Cells["AC1"].Style.Font.Bold = true;
            wsApprovedSettlements.Column(29).Width = 20;
            wsApprovedSettlements.Cells["AD1"].Value = "Approved";
            wsApprovedSettlements.Cells["AD1"].Style.WrapText = true;
            wsApprovedSettlements.Cells["AD1"].Style.VerticalAlignment = ExcelVerticalAlignment.Center;
            wsApprovedSettlements.Cells["AD1"].Style.Font.Bold = true;
            wsApprovedSettlements.Column(30).Width = 10;
            wsApprovedSettlements.Cells["AE1"].Value = "Incident: Incident Name";
            wsApprovedSettlements.Cells["AE1"].Style.WrapText = true;
            wsApprovedSettlements.Cells["AE1"].Style.VerticalAlignment = ExcelVerticalAlignment.Center;
            wsApprovedSettlements.Cells["AE1"].Style.Font.Bold = true;
            wsApprovedSettlements.Column(30).Width = 20;


            ApprovedSettlementInfo info = new ApprovedSettlementInfo();

            String strSqlQueryForSettlementApproved = "select [dbo].[tbl_incident].[IncidentNo], [dbo].[tbl_settlement].[Name], " +
                                                      "[dbo].[tbl_settlement].[MedicalBillID], [dbo].[tbl_medbill].[Individual_Id], " +
                                                      "[dbo].[tbl_payment_method].[PaymentMethod_Value], [dbo].[tbl_program].[ProgramName], " +
                                                      "[dbo].[tbl_case].[IB_Receiv_Date], " +
                                                      "[dbo].[tbl_medbill].[BillDate], [dbo].[tbl_medbill].[Account_At_Provider], " +
                                                      "[dbo].[tbl_settlement].[Amount], [dbo].[tbl_settlement_type_code].[SettlementTypeValue]," +
                                                      "[dbo].[tbl_CreateStaff].[Staff_Name], [dbo].[tbl_ModifiStaff].[Staff_Name], " +
                                                      "[dbo].[tbl_medbill].[MedicalProvider_Id], [dbo].[tbl_illness].[ICD_10_Id], " +
                                                      "[dbo].[tbl_medbill].[Account_At_Provider], [dbo].[tbl_settlement].[Approved] " +
                                                      "from [dbo].[tbl_settlement] " +
                                                      "inner join [dbo].[tbl_payment_method] on [dbo].[tbl_settlement].[CMMPaymentMethod] = [dbo].[tbl_payment_method].[PaymentMethod_Id] " +
                                                      "inner join [dbo].[tbl_settlement_type_code] on [dbo].[tbl_settlement].[SettlementType] = [dbo].[tbl_settlement_type_code].[SettlementTypeCode] " +
                                                      "inner join [dbo].[tbl_medbill] on [dbo].[tbl_settlement].[MedicalBillID] = [dbo].[tbl_medbill].[BillNo] " +
                                                      "inner join [dbo].[tbl_case] on [dbo].[tbl_medbill].[Case_Id] = [dbo].[tbl_case].[Case_Name] " +
                                                      "inner join [dbo].[tbl_incident] on [dbo].[tbl_medbill].[Incident_Id] = [dbo].[tbl_incident].[Incident_id] " +
                                                      "inner join [dbo].[tbl_program] on [dbo].[tbl_incident].[Program_id] = [dbo].[tbl_program].[Program_Id] " +
                                                      "inner join [dbo].[tbl_illness] on [dbo].[tbl_medbill].[Illness_Id] = [dbo].[tbl_illness].[Illness_Id] " +
                                                      "inner join [dbo].[tbl_CreateStaff] on [dbo].[tbl_settlement].[CreateByID] = [dbo].[tbl_CreateStaff].[CreateStaff_Id] " +
                                                      "inner join [dbo].[tbl_ModifiStaff] on [dbo].[tbl_settlement].[LastModifiedByID] = [dbo].[tbl_ModifiStaff].[ModifiStaff_Id] " +
                                                      "where [dbo].[tbl_settlement].[Approved] = 1 and " +
                                                      "[dbo].[tbl_illness].[ICD_10_Id] <> 'Z00.00' and [dbo].[tbl_illness].[ICD_10_Id] <> 'Z00.012' and [dbo].[tbl_illness].[ICD_10_Id] is not NULL and " +
                                                      "([dbo].[tbl_payment_method].[PaymentMethod_Value] = 'Check' or [dbo].[tbl_payment_method].[PaymentMethod_Value] = 'ACH/Banking') and " +
                                                      "([dbo].[tbl_settlement_type_code].[SettlementTypeValue] = 'CMM Member Reimbursement' or " +
                                                      "[dbo].[tbl_settlement_type_code].[SettlementTypeValue] = 'CMM Provider Payment' or " +
                                                      "[dbo].[tbl_settlement_type_code].[SettlementTypeValue] = 'PR Reimbursement') and " +
                                                      "([dbo].[tbl_medbill].[WellBeingCare] = 0 or [dbo].[tbl_medbill].[WellBeingCare] is NULL) and " +
                                                      "([dbo].[tbl_settlement].[CheckDate] is NULL or [dbo].[tbl_settlement].[CheckDate] = '') and " +
                                                      "([dbo].[tbl_settlement].[CheckNo] is NULL or [dbo].[tbl_settlement].[CheckNo] = '') and " +
                                                      "([dbo].[tbl_settlement].[ACH_Number] is NULL or [dbo].[tbl_settlement].[CheckNo] = '') and " +
                                                      "([dbo].[tbl_settlement].[IsExported] = 0 or [dbo].[tbl_settlement].[IsExported] is NULL)";

            SqlCommand cmdQueryForSettlementApproved = new SqlCommand(strSqlQueryForSettlementApproved, connRN);
            cmdQueryForSettlementApproved.CommandType = CommandType.Text;

            List<String> lstMedBillID = new List<String>();
            if (connRN.State != ConnectionState.Closed)
            {
                connRN.Close();
                connRN.Open();
            }
            else if (connRN.State == ConnectionState.Closed) connRN.Open();
            SqlDataReader rdrSettlementApproved = cmdQueryForSettlementApproved.ExecuteReader();

            List<ApprovedSettlementInfo> lstApprovedSettlement = new List<ApprovedSettlementInfo>();

            if (rdrSettlementApproved.HasRows)
            {
                while (rdrSettlementApproved.Read())
                {
                    ApprovedSettlementInfo settlement = new ApprovedSettlementInfo();

                    if (!rdrSettlementApproved.IsDBNull(0)) settlement.IncidentNo = rdrSettlementApproved.GetString(0);
                    if (!rdrSettlementApproved.IsDBNull(1)) settlement.SettlementName = rdrSettlementApproved.GetString(1);
                    if (!rdrSettlementApproved.IsDBNull(2)) settlement.MedBillName = rdrSettlementApproved.GetString(2);
                    if (!rdrSettlementApproved.IsDBNull(3)) settlement.IndividualId = rdrSettlementApproved.GetString(3);
                    if (!rdrSettlementApproved.IsDBNull(4)) settlement.PaymentType = rdrSettlementApproved.GetString(4);
                    if (!rdrSettlementApproved.IsDBNull(5)) settlement.IncidentProgram = rdrSettlementApproved.GetString(5);
                    if (!rdrSettlementApproved.IsDBNull(6)) settlement.IBReceivedDate = rdrSettlementApproved.GetDateTime(6);
                    if (!rdrSettlementApproved.IsDBNull(7)) settlement.ServiceDate = rdrSettlementApproved.GetDateTime(7);
                    if (!rdrSettlementApproved.IsDBNull(8)) settlement.AccountNoAtMedProvider = rdrSettlementApproved.GetString(8);
                    if (!rdrSettlementApproved.IsDBNull(9)) settlement.Amount = rdrSettlementApproved.GetDecimal(9);
                    if (!rdrSettlementApproved.IsDBNull(10)) settlement.SettlementType = rdrSettlementApproved.GetString(10);
                    if (!rdrSettlementApproved.IsDBNull(11)) settlement.CreatedBy = rdrSettlementApproved.GetString(11);
                    if (!rdrSettlementApproved.IsDBNull(12)) settlement.LastModifiedBy = rdrSettlementApproved.GetString(12);
                    if (!rdrSettlementApproved.IsDBNull(13)) settlement.MedicalProviderId = rdrSettlementApproved.GetString(13);
                    if (!rdrSettlementApproved.IsDBNull(14)) settlement.ICD10Code = rdrSettlementApproved.GetString(14);
                    if (settlement.ICD10Code != "Z00.00" && settlement.ICD10Code != "Z00.012") settlement.WellBeingCareShared = 0;
                    //if (settlement.ICD10Code == "Z00.00" || settlement.ICD10Code == "Z00.012") settlement.WellBeingCareShared = settlement.Amount;

                    if (!rdrSettlementApproved.IsDBNull(15)) settlement.AccountNoAtMedProvider = rdrSettlementApproved.GetString(15);
                    if (!rdrSettlementApproved.IsDBNull(16)) settlement.Approved = rdrSettlementApproved.GetBoolean(16);

                    lstApprovedSettlement.Add(settlement);

                }
            }
            rdrSettlementApproved.Close();
            if (connRN.State == ConnectionState.Open) connRN.Close();

            foreach (ApprovedSettlementInfo settlement in lstApprovedSettlement)
            {
                if (settlement.ICD10Code != null)
                {
                    String strSqlQueryForDiseaseName = "select [dbo].[ICD10 Code].[Name] from [dbo].[ICD10 Code] where [dbo].[ICD10 Code].[ICD10_CODE__C] = @ICD10Code";

                    SqlCommand cmdQueryForDiseaseName = new SqlCommand(strSqlQueryForDiseaseName, connSalesforce);
                    cmdQueryForDiseaseName.CommandType = CommandType.Text;

                    cmdQueryForDiseaseName.Parameters.AddWithValue("@ICD10Code", settlement.ICD10Code);

                    if (connSalesforce.State != ConnectionState.Closed)
                    {
                        connSalesforce.Close();
                        connSalesforce.Open();
                    }
                    else if (connSalesforce.State == ConnectionState.Closed) connSalesforce.Open();
                    Object objDiseaseName = cmdQueryForDiseaseName.ExecuteScalar();
                    if (objDiseaseName != null) settlement.ICD10CodeDescription = objDiseaseName.ToString();
                    if (connSalesforce.State == ConnectionState.Open) connSalesforce.Close();
                }
                else settlement.ICD10CodeDescription = String.Empty;
            }


            foreach (ApprovedSettlementInfo settlement in lstApprovedSettlement)
            {
                String strSqlQueryForIndividualInfo = "select [dbo].[contact].[Name], [dbo].[contact].[FirstName], [dbo].[contact].[MiddleName], [dbo].[contact].[LastName], " +
                                                      "[dbo].[contact].[Household_Role__c], [dbo].[contact].[Primary_Name__c], [dbo].[program].[Name], " +
                                                      "[dbo].[contact].[Membership_IND_Start_date__c], [dbo].[contact].[Membership_Number__c], " +
                                                      "[dbo].[account].[SHIPPINGSTREET], [dbo].[account].[SHIPPINGCITY], [dbo].[account].[SHIPPINGSTATE], [dbo].[account].[SHIPPINGPOSTALCODE], " +
                                                      "[dbo].[contact].[c4g_Membership_Status__c] " +
                                                      "from [dbo].[contact] " +
                                                      "inner join [dbo].[program] on [dbo].[contact].[c4g_Plan__c] = [dbo].[program].[ID] " +
                                                      "inner join [dbo].[account] on [dbo].[contact].[AccountId] = [dbo].[account].[ID] " +
                                                      "where [dbo].[contact].[Individual_ID__c] = @IndividualId";

                SqlCommand cmdQueryForIndividualInfo = new SqlCommand(strSqlQueryForIndividualInfo, connSalesforce);
                cmdQueryForIndividualInfo.CommandType = CommandType.Text;

                cmdQueryForIndividualInfo.Parameters.AddWithValue("@IndividualId", settlement.IndividualId);

                if (connSalesforce.State != ConnectionState.Closed)
                {
                    connSalesforce.Close();
                    connSalesforce.Open();
                }
                else if (connSalesforce.State == ConnectionState.Closed) connSalesforce.Open();

                SqlDataReader rdrIndividualInfo = cmdQueryForIndividualInfo.ExecuteReader();

                if (rdrIndividualInfo.HasRows)
                {
                    rdrIndividualInfo.Read();
                    if (!rdrIndividualInfo.IsDBNull(0)) settlement.FullName = rdrIndividualInfo.GetString(0);
                    if (!rdrIndividualInfo.IsDBNull(1)) settlement.FirstName = rdrIndividualInfo.GetString(1);
                    if (!rdrIndividualInfo.IsDBNull(2)) settlement.MiddleName = rdrIndividualInfo.GetString(2);
                    if (!rdrIndividualInfo.IsDBNull(3)) settlement.LastName = rdrIndividualInfo.GetString(3);
                    if (!rdrIndividualInfo.IsDBNull(4)) settlement.HouseholdRole = rdrIndividualInfo.GetString(4);
                    if (!rdrIndividualInfo.IsDBNull(5)) settlement.PrimaryName = rdrIndividualInfo.GetString(5);
                    if (!rdrIndividualInfo.IsDBNull(6)) settlement.ProgramName = rdrIndividualInfo.GetString(6);
                    if (!rdrIndividualInfo.IsDBNull(7)) settlement.MembershipStartDate = rdrIndividualInfo.GetDateTime(7);
                    if (!rdrIndividualInfo.IsDBNull(8)) settlement.MembershipNo = rdrIndividualInfo.GetString(8);
                    if (!rdrIndividualInfo.IsDBNull(9)) settlement.AccountShippingStreet = rdrIndividualInfo.GetString(9);
                    if (!rdrIndividualInfo.IsDBNull(10)) settlement.AccountShippingCity = rdrIndividualInfo.GetString(10);
                    if (!rdrIndividualInfo.IsDBNull(11)) settlement.AccountShippingState = rdrIndividualInfo.GetString(11);
                    if (!rdrIndividualInfo.IsDBNull(12)) settlement.AccountShppingZip = rdrIndividualInfo.GetDouble(12).ToString();
                    if (!rdrIndividualInfo.IsDBNull(13)) settlement.MembershipStatus = rdrIndividualInfo.GetString(13);
                }

                rdrIndividualInfo.Close();
                if (connSalesforce.State == ConnectionState.Open) connSalesforce.Close();
            }

            foreach (ApprovedSettlementInfo settlement in lstApprovedSettlement)
            {
                String strSqlQueryForMedicalProviderName = "select [dbo].[MedicalProvider].[Name] from [dbo].[MedicalProvider] where [dbo].[MedicalProvider].[ID] = @MedicalProviderId";

                SqlCommand cmdQueryForMedicalProvider = new SqlCommand(strSqlQueryForMedicalProviderName, connSalesforce);
                cmdQueryForMedicalProvider.CommandType = CommandType.Text;

                cmdQueryForMedicalProvider.Parameters.AddWithValue("@MedicalProviderId", settlement.MedicalProviderId);

                if (connSalesforce.State != ConnectionState.Closed)
                {
                    connSalesforce.Close();
                    connSalesforce.Open();
                }
                else if (connSalesforce.State == ConnectionState.Closed) connSalesforce.Open();
                Object objMedicalProviderName = cmdQueryForMedicalProvider.ExecuteScalar();
                if (objMedicalProviderName != null) settlement.MedicalProviderName = objMedicalProviderName.ToString();
                if (connSalesforce.State == ConnectionState.Open) connSalesforce.Close();
            }




            for (int i = 0; i < lstApprovedSettlement.Count; i++)
            {
                if (i % 2 == 0)
                {
                    wsApprovedSettlements.Cells[i + 2, 1].Value = lstApprovedSettlement[i].FullName;
                    wsApprovedSettlements.Cells[i + 2, 2].Value = lstApprovedSettlement[i].FirstName;
                    wsApprovedSettlements.Cells[i + 2, 3].Value = lstApprovedSettlement[i].MiddleName;
                    wsApprovedSettlements.Cells[i + 2, 4].Value = lstApprovedSettlement[i].LastName;
                    wsApprovedSettlements.Cells[i + 2, 5].Value = lstApprovedSettlement[i].HouseholdRole;
                    wsApprovedSettlements.Cells[i + 2, 6].Value = lstApprovedSettlement[i].IndividualId;
                    wsApprovedSettlements.Cells[i + 2, 7].Value = lstApprovedSettlement[i].PrimaryName;
                    wsApprovedSettlements.Cells[i + 2, 8].Value = lstApprovedSettlement[i].PaymentType;
                    wsApprovedSettlements.Cells[i + 2, 9].Value = lstApprovedSettlement[i].ProgramName;
                    wsApprovedSettlements.Cells[i + 2, 10].Value = lstApprovedSettlement[i].IncidentProgram;
                    wsApprovedSettlements.Cells[i + 2, 11].Value = lstApprovedSettlement[i].MembershipStartDate.ToString("MM/dd/yyyy");
                    wsApprovedSettlements.Cells[i + 2, 12].Value = lstApprovedSettlement[i].MembershipNo;
                    wsApprovedSettlements.Cells[i + 2, 13].Value = lstApprovedSettlement[i].IBReceivedDate.ToString("MM/dd/yyyy");
                    wsApprovedSettlements.Cells[i + 2, 14].Value = lstApprovedSettlement[i].ServiceDate.ToString("MM/dd/yyyy");
                    wsApprovedSettlements.Cells[i + 2, 15].Value = lstApprovedSettlement[i].MedicalProviderName;
                    wsApprovedSettlements.Cells[i + 2, 16].Value = lstApprovedSettlement[i].AccountNoAtMedProvider;
                    wsApprovedSettlements.Cells[i + 2, 17].Value = lstApprovedSettlement[i].AccountShippingStreet;
                    wsApprovedSettlements.Cells[i + 2, 18].Value = lstApprovedSettlement[i].AccountShippingCity;
                    wsApprovedSettlements.Cells[i + 2, 19].Value = lstApprovedSettlement[i].AccountShippingState;
                    wsApprovedSettlements.Cells[i + 2, 20].Value = lstApprovedSettlement[i].AccountShppingZip;
                    wsApprovedSettlements.Cells[i + 2, 21].Value = lstApprovedSettlement[i].Amount;
                    wsApprovedSettlements.Cells[i + 2, 22].Value = lstApprovedSettlement[i].SettlementType;
                    wsApprovedSettlements.Cells[i + 2, 23].Value = lstApprovedSettlement[i].MedBillName;
                    wsApprovedSettlements.Cells[i + 2, 24].Value = lstApprovedSettlement[i].SettlementName;
                    wsApprovedSettlements.Cells[i + 2, 25].Value = lstApprovedSettlement[i].WellBeingCareShared;
                    wsApprovedSettlements.Cells[i + 2, 26].Value = lstApprovedSettlement[i].ICD10CodeDescription;
                    wsApprovedSettlements.Cells[i + 2, 27].Value = lstApprovedSettlement[i].CreatedBy;
                    wsApprovedSettlements.Cells[i + 2, 28].Value = lstApprovedSettlement[i].LastModifiedBy;
                    wsApprovedSettlements.Cells[i + 2, 29].Value = lstApprovedSettlement[i].MembershipStatus;
                    wsApprovedSettlements.Cells[i + 2, 30].Value = lstApprovedSettlement[i].Approved;
                    wsApprovedSettlements.Cells[i + 2, 31].Value = lstApprovedSettlement[i].IncidentNo;
                }
                else
                {
                    wsApprovedSettlements.Cells[i + 2, 1].Value = lstApprovedSettlement[i].FullName;
                    wsApprovedSettlements.Cells[i + 2, 1].Style.Fill.PatternType = ExcelFillStyle.Solid;
                    wsApprovedSettlements.Cells[i + 2, 1].Style.Fill.BackgroundColor.SetColor(Color.FromKnownColor(KnownColor.LightGray));
                    wsApprovedSettlements.Cells[i + 2, 2].Value = lstApprovedSettlement[i].FirstName;
                    wsApprovedSettlements.Cells[i + 2, 2].Style.Fill.PatternType = ExcelFillStyle.Solid;
                    wsApprovedSettlements.Cells[i + 2, 2].Style.Fill.BackgroundColor.SetColor(Color.FromKnownColor(KnownColor.LightGray));
                    wsApprovedSettlements.Cells[i + 2, 3].Value = lstApprovedSettlement[i].MiddleName;
                    wsApprovedSettlements.Cells[i + 2, 3].Style.Fill.PatternType = ExcelFillStyle.Solid;
                    wsApprovedSettlements.Cells[i + 2, 3].Style.Fill.BackgroundColor.SetColor(Color.FromKnownColor(KnownColor.LightGray));
                    wsApprovedSettlements.Cells[i + 2, 4].Value = lstApprovedSettlement[i].LastName;
                    wsApprovedSettlements.Cells[i + 2, 4].Style.Fill.PatternType = ExcelFillStyle.Solid;
                    wsApprovedSettlements.Cells[i + 2, 4].Style.Fill.BackgroundColor.SetColor(Color.FromKnownColor(KnownColor.LightGray));
                    wsApprovedSettlements.Cells[i + 2, 5].Value = lstApprovedSettlement[i].HouseholdRole;
                    wsApprovedSettlements.Cells[i + 2, 5].Style.Fill.PatternType = ExcelFillStyle.Solid;
                    wsApprovedSettlements.Cells[i + 2, 5].Style.Fill.BackgroundColor.SetColor(Color.FromKnownColor(KnownColor.LightGray));
                    wsApprovedSettlements.Cells[i + 2, 6].Value = lstApprovedSettlement[i].IndividualId;
                    wsApprovedSettlements.Cells[i + 2, 6].Style.Fill.PatternType = ExcelFillStyle.Solid;
                    wsApprovedSettlements.Cells[i + 2, 6].Style.Fill.BackgroundColor.SetColor(Color.FromKnownColor(KnownColor.LightGray));
                    wsApprovedSettlements.Cells[i + 2, 7].Value = lstApprovedSettlement[i].PrimaryName;
                    wsApprovedSettlements.Cells[i + 2, 7].Style.Fill.PatternType = ExcelFillStyle.Solid;
                    wsApprovedSettlements.Cells[i + 2, 7].Style.Fill.BackgroundColor.SetColor(Color.FromKnownColor(KnownColor.LightGray));
                    wsApprovedSettlements.Cells[i + 2, 8].Value = lstApprovedSettlement[i].PaymentType;
                    wsApprovedSettlements.Cells[i + 2, 8].Style.Fill.PatternType = ExcelFillStyle.Solid;
                    wsApprovedSettlements.Cells[i + 2, 8].Style.Fill.BackgroundColor.SetColor(Color.FromKnownColor(KnownColor.LightGray));
                    wsApprovedSettlements.Cells[i + 2, 9].Value = lstApprovedSettlement[i].ProgramName;
                    wsApprovedSettlements.Cells[i + 2, 9].Style.Fill.PatternType = ExcelFillStyle.Solid;
                    wsApprovedSettlements.Cells[i + 2, 9].Style.Fill.BackgroundColor.SetColor(Color.FromKnownColor(KnownColor.LightGray));
                    wsApprovedSettlements.Cells[i + 2, 10].Value = lstApprovedSettlement[i].IncidentProgram;
                    wsApprovedSettlements.Cells[i + 2, 10].Style.Fill.PatternType = ExcelFillStyle.Solid;
                    wsApprovedSettlements.Cells[i + 2, 10].Style.Fill.BackgroundColor.SetColor(Color.FromKnownColor(KnownColor.LightGray));
                    wsApprovedSettlements.Cells[i + 2, 11].Value = lstApprovedSettlement[i].MembershipStartDate.ToString("MM/dd/yyyy");
                    wsApprovedSettlements.Cells[i + 2, 11].Style.Fill.PatternType = ExcelFillStyle.Solid;
                    wsApprovedSettlements.Cells[i + 2, 11].Style.Fill.BackgroundColor.SetColor(Color.FromKnownColor(KnownColor.LightGray));
                    wsApprovedSettlements.Cells[i + 2, 12].Value = lstApprovedSettlement[i].MembershipNo;
                    wsApprovedSettlements.Cells[i + 2, 12].Style.Fill.PatternType = ExcelFillStyle.Solid;
                    wsApprovedSettlements.Cells[i + 2, 12].Style.Fill.BackgroundColor.SetColor(Color.FromKnownColor(KnownColor.LightGray));
                    wsApprovedSettlements.Cells[i + 2, 13].Value = lstApprovedSettlement[i].IBReceivedDate.ToString("MM/dd/yyyy");
                    wsApprovedSettlements.Cells[i + 2, 13].Style.Fill.PatternType = ExcelFillStyle.Solid;
                    wsApprovedSettlements.Cells[i + 2, 13].Style.Fill.BackgroundColor.SetColor(Color.FromKnownColor(KnownColor.LightGray));
                    wsApprovedSettlements.Cells[i + 2, 14].Value = lstApprovedSettlement[i].ServiceDate.ToString("MM/dd/yyyy");
                    wsApprovedSettlements.Cells[i + 2, 14].Style.Fill.PatternType = ExcelFillStyle.Solid;
                    wsApprovedSettlements.Cells[i + 2, 14].Style.Fill.BackgroundColor.SetColor(Color.FromKnownColor(KnownColor.LightGray));
                    wsApprovedSettlements.Cells[i + 2, 15].Value = lstApprovedSettlement[i].MedicalProviderName;
                    wsApprovedSettlements.Cells[i + 2, 15].Style.Fill.PatternType = ExcelFillStyle.Solid;
                    wsApprovedSettlements.Cells[i + 2, 15].Style.Fill.BackgroundColor.SetColor(Color.FromKnownColor(KnownColor.LightGray));
                    wsApprovedSettlements.Cells[i + 2, 16].Value = lstApprovedSettlement[i].AccountNoAtMedProvider;
                    wsApprovedSettlements.Cells[i + 2, 16].Style.Fill.PatternType = ExcelFillStyle.Solid;
                    wsApprovedSettlements.Cells[i + 2, 16].Style.Fill.BackgroundColor.SetColor(Color.FromKnownColor(KnownColor.LightGray));
                    wsApprovedSettlements.Cells[i + 2, 17].Value = lstApprovedSettlement[i].AccountShippingStreet;
                    wsApprovedSettlements.Cells[i + 2, 17].Style.Fill.PatternType = ExcelFillStyle.Solid;
                    wsApprovedSettlements.Cells[i + 2, 17].Style.Fill.BackgroundColor.SetColor(Color.FromKnownColor(KnownColor.LightGray));
                    wsApprovedSettlements.Cells[i + 2, 18].Value = lstApprovedSettlement[i].AccountShippingCity;
                    wsApprovedSettlements.Cells[i + 2, 18].Style.Fill.PatternType = ExcelFillStyle.Solid;
                    wsApprovedSettlements.Cells[i + 2, 18].Style.Fill.BackgroundColor.SetColor(Color.FromKnownColor(KnownColor.LightGray));
                    wsApprovedSettlements.Cells[i + 2, 19].Value = lstApprovedSettlement[i].AccountShippingState;
                    wsApprovedSettlements.Cells[i + 2, 19].Style.Fill.PatternType = ExcelFillStyle.Solid;
                    wsApprovedSettlements.Cells[i + 2, 19].Style.Fill.BackgroundColor.SetColor(Color.FromKnownColor(KnownColor.LightGray));
                    wsApprovedSettlements.Cells[i + 2, 20].Value = lstApprovedSettlement[i].AccountShppingZip;
                    wsApprovedSettlements.Cells[i + 2, 20].Style.Fill.PatternType = ExcelFillStyle.Solid;
                    wsApprovedSettlements.Cells[i + 2, 20].Style.Fill.BackgroundColor.SetColor(Color.FromKnownColor(KnownColor.LightGray));
                    wsApprovedSettlements.Cells[i + 2, 21].Value = lstApprovedSettlement[i].Amount;
                    wsApprovedSettlements.Cells[i + 2, 21].Style.Fill.PatternType = ExcelFillStyle.Solid;
                    wsApprovedSettlements.Cells[i + 2, 21].Style.Fill.BackgroundColor.SetColor(Color.FromKnownColor(KnownColor.LightGray));
                    wsApprovedSettlements.Cells[i + 2, 22].Value = lstApprovedSettlement[i].SettlementType;
                    wsApprovedSettlements.Cells[i + 2, 22].Style.Fill.PatternType = ExcelFillStyle.Solid;
                    wsApprovedSettlements.Cells[i + 2, 22].Style.Fill.BackgroundColor.SetColor(Color.FromKnownColor(KnownColor.LightGray));
                    wsApprovedSettlements.Cells[i + 2, 23].Value = lstApprovedSettlement[i].MedBillName;
                    wsApprovedSettlements.Cells[i + 2, 23].Style.Fill.PatternType = ExcelFillStyle.Solid;
                    wsApprovedSettlements.Cells[i + 2, 23].Style.Fill.BackgroundColor.SetColor(Color.FromKnownColor(KnownColor.LightGray));
                    wsApprovedSettlements.Cells[i + 2, 24].Value = lstApprovedSettlement[i].SettlementName;
                    wsApprovedSettlements.Cells[i + 2, 24].Style.Fill.PatternType = ExcelFillStyle.Solid;
                    wsApprovedSettlements.Cells[i + 2, 24].Style.Fill.BackgroundColor.SetColor(Color.FromKnownColor(KnownColor.LightGray));
                    wsApprovedSettlements.Cells[i + 2, 25].Value = lstApprovedSettlement[i].WellBeingCareShared;
                    wsApprovedSettlements.Cells[i + 2, 25].Style.Fill.PatternType = ExcelFillStyle.Solid;
                    wsApprovedSettlements.Cells[i + 2, 25].Style.Fill.BackgroundColor.SetColor(Color.FromKnownColor(KnownColor.LightGray));
                    wsApprovedSettlements.Cells[i + 2, 26].Value = lstApprovedSettlement[i].ICD10CodeDescription;
                    wsApprovedSettlements.Cells[i + 2, 26].Style.Fill.PatternType = ExcelFillStyle.Solid;
                    wsApprovedSettlements.Cells[i + 2, 26].Style.Fill.BackgroundColor.SetColor(Color.FromKnownColor(KnownColor.LightGray));
                    wsApprovedSettlements.Cells[i + 2, 27].Value = lstApprovedSettlement[i].CreatedBy;
                    wsApprovedSettlements.Cells[i + 2, 27].Style.Fill.PatternType = ExcelFillStyle.Solid;
                    wsApprovedSettlements.Cells[i + 2, 27].Style.Fill.BackgroundColor.SetColor(Color.FromKnownColor(KnownColor.LightGray));
                    wsApprovedSettlements.Cells[i + 2, 28].Value = lstApprovedSettlement[i].LastModifiedBy;
                    wsApprovedSettlements.Cells[i + 2, 28].Style.Fill.PatternType = ExcelFillStyle.Solid;
                    wsApprovedSettlements.Cells[i + 2, 28].Style.Fill.BackgroundColor.SetColor(Color.FromKnownColor(KnownColor.LightGray));
                    wsApprovedSettlements.Cells[i + 2, 29].Value = lstApprovedSettlement[i].MembershipStatus;
                    wsApprovedSettlements.Cells[i + 2, 29].Style.Fill.PatternType = ExcelFillStyle.Solid;
                    wsApprovedSettlements.Cells[i + 2, 29].Style.Fill.BackgroundColor.SetColor(Color.FromKnownColor(KnownColor.LightGray));
                    wsApprovedSettlements.Cells[i + 2, 30].Value = lstApprovedSettlement[i].Approved;
                    wsApprovedSettlements.Cells[i + 2, 30].Style.Fill.PatternType = ExcelFillStyle.Solid;
                    wsApprovedSettlements.Cells[i + 2, 30].Style.Fill.BackgroundColor.SetColor(Color.FromKnownColor(KnownColor.LightGray));
                    wsApprovedSettlements.Cells[i + 2, 31].Value = lstApprovedSettlement[i].IncidentNo;
                    wsApprovedSettlements.Cells[i + 2, 31].Style.Fill.PatternType = ExcelFillStyle.Solid;
                    wsApprovedSettlements.Cells[i + 2, 31].Style.Fill.BackgroundColor.SetColor(Color.FromKnownColor(KnownColor.LightGray));
                }

            }

            SaveFileDialog saveFileDlg = new SaveFileDialog();
            saveFileDlg.Filter = "Excel File|*.xlsx";
            saveFileDlg.Title = "Save an Excel File";
            saveFileDlg.ShowDialog();

            if (saveFileDlg.FileName != "")
            {
                FileInfo fi = new FileInfo(saveFileDlg.FileName);
                excelApprovedSettlement.SaveAs(fi);
            }
        }

        private void btnWellBeingExport_Click(object sender, EventArgs e)
        {
            ExcelPackage excelApprovedSettlement = new ExcelPackage();

            String strSqlQueryForAuthorName = "select [dbo].[tbl_user].[User_Name] from [dbo].[tbl_user] where [dbo].[tbl_user].[User_Id] = @UserId";

            SqlCommand cmdQueryForAuthorName = new SqlCommand(strSqlQueryForAuthorName, connRN3);
            cmdQueryForAuthorName.CommandType = CommandType.Text;

            cmdQueryForAuthorName.Parameters.AddWithValue("@UserId", nLoggedUserId);

            if (connRN3.State != ConnectionState.Closed)
            {
                connRN3.Close();
                connRN3.Open();
            }
            else if (connRN3.State == ConnectionState.Closed) connRN3.Open();
            String strUserName = cmdQueryForAuthorName.ExecuteScalar()?.ToString();
            if (connRN3.State == ConnectionState.Open) connRN3.Close();

            excelApprovedSettlement.Workbook.Properties.Author = strUserName;
            excelApprovedSettlement.Workbook.Properties.Title = "Approved Settlement Export";
            excelApprovedSettlement.Workbook.Properties.Subject = "Approved Settlement List";
            excelApprovedSettlement.Workbook.Properties.Created = DateTime.Now;

            ExcelWorksheet wsApprovedSettlements = excelApprovedSettlement.Workbook.Worksheets.Add("Sheet 1");

            wsApprovedSettlements.Cells["A1"].Value = "Full Name";
            wsApprovedSettlements.Cells["A1"].Style.WrapText = true;
            wsApprovedSettlements.Cells["A1"].Style.VerticalAlignment = ExcelVerticalAlignment.Center;
            wsApprovedSettlements.Cells["A1"].Style.Font.Bold = true;
            wsApprovedSettlements.Column(1).Width = 20;
            wsApprovedSettlements.Cells["B1"].Value = "First Name";
            wsApprovedSettlements.Cells["B1"].Style.WrapText = true;
            wsApprovedSettlements.Cells["B1"].Style.VerticalAlignment = ExcelVerticalAlignment.Center;
            wsApprovedSettlements.Cells["B1"].Style.Font.Bold = true;
            wsApprovedSettlements.Column(2).Width = 15;
            wsApprovedSettlements.Cells["C1"].Value = "Middle Name";
            wsApprovedSettlements.Cells["C1"].Style.WrapText = true;
            wsApprovedSettlements.Cells["C1"].Style.VerticalAlignment = ExcelVerticalAlignment.Center;
            wsApprovedSettlements.Cells["C1"].Style.Font.Bold = true;
            wsApprovedSettlements.Column(3).Width = 10;
            wsApprovedSettlements.Cells["D1"].Value = "Last Name";
            wsApprovedSettlements.Cells["D1"].Style.WrapText = true;
            wsApprovedSettlements.Cells["D1"].Style.VerticalAlignment = ExcelVerticalAlignment.Center;
            wsApprovedSettlements.Cells["D1"].Style.Font.Bold = true;
            wsApprovedSettlements.Column(4).Width = 10;
            wsApprovedSettlements.Cells["E1"].Value = "Household Role";
            wsApprovedSettlements.Cells["E1"].Style.WrapText = true;
            wsApprovedSettlements.Cells["E1"].Style.VerticalAlignment = ExcelVerticalAlignment.Center;
            wsApprovedSettlements.Cells["E1"].Style.Font.Bold = true;
            wsApprovedSettlements.Column(5).Width = 20;
            wsApprovedSettlements.Cells["F1"].Value = "Individual ID";
            wsApprovedSettlements.Cells["F1"].Style.WrapText = true;
            wsApprovedSettlements.Cells["F1"].Style.VerticalAlignment = ExcelVerticalAlignment.Center;
            wsApprovedSettlements.Cells["F1"].Style.Font.Bold = true;
            wsApprovedSettlements.Column(6).Width = 20;
            wsApprovedSettlements.Cells["G1"].Value = "Primary Name";
            wsApprovedSettlements.Cells["G1"].Style.WrapText = true;
            wsApprovedSettlements.Cells["G1"].Style.VerticalAlignment = ExcelVerticalAlignment.Center;
            wsApprovedSettlements.Cells["G1"].Style.Font.Bold = true;
            wsApprovedSettlements.Column(7).Width = 20;
            wsApprovedSettlements.Cells["H1"].Value = "CMM Payment Method";
            wsApprovedSettlements.Cells["H1"].Style.WrapText = true;
            wsApprovedSettlements.Cells["H1"].Style.VerticalAlignment = ExcelVerticalAlignment.Center;
            wsApprovedSettlements.Cells["H1"].Style.Font.Bold = true;
            wsApprovedSettlements.Column(8).Width = 20;
            wsApprovedSettlements.Cells["I1"].Value = "Program Name";
            wsApprovedSettlements.Cells["I1"].Style.WrapText = true;
            wsApprovedSettlements.Cells["I1"].Style.VerticalAlignment = ExcelVerticalAlignment.Center;
            wsApprovedSettlements.Cells["I1"].Style.Font.Bold = true;
            wsApprovedSettlements.Column(9).Width = 20;
            wsApprovedSettlements.Cells["J1"].Value = "Incident Program";
            wsApprovedSettlements.Cells["J1"].Style.WrapText = true;
            wsApprovedSettlements.Cells["J1"].Style.VerticalAlignment = ExcelVerticalAlignment.Center;
            wsApprovedSettlements.Cells["J1"].Style.Font.Bold = true;
            wsApprovedSettlements.Column(10).Width = 15;
            wsApprovedSettlements.Cells["K1"].Value = "Membership Start Date";
            wsApprovedSettlements.Cells["K1"].Style.WrapText = true;
            wsApprovedSettlements.Cells["K1"].Style.VerticalAlignment = ExcelVerticalAlignment.Center;
            wsApprovedSettlements.Cells["K1"].Style.Font.Bold = true;
            wsApprovedSettlements.Column(11).Width = 20;
            wsApprovedSettlements.Cells["L1"].Value = "Membership: Membership Number";
            wsApprovedSettlements.Cells["L1"].Style.WrapText = true;
            wsApprovedSettlements.Cells["L1"].Style.VerticalAlignment = ExcelVerticalAlignment.Center;
            wsApprovedSettlements.Cells["L1"].Style.Font.Bold = true;
            wsApprovedSettlements.Column(12).Width = 20;
            wsApprovedSettlements.Cells["M1"].Value = "Itemized Bill Received Date";
            wsApprovedSettlements.Cells["M1"].Style.WrapText = true;
            wsApprovedSettlements.Cells["M1"].Style.VerticalAlignment = ExcelVerticalAlignment.Center;
            wsApprovedSettlements.Cells["M1"].Style.Font.Bold = true;
            wsApprovedSettlements.Column(13).Width = 25;
            wsApprovedSettlements.Cells["N1"].Value = "Date of Service";
            wsApprovedSettlements.Cells["N1"].Style.WrapText = true;
            wsApprovedSettlements.Cells["N1"].Style.VerticalAlignment = ExcelVerticalAlignment.Center;
            wsApprovedSettlements.Cells["N1"].Style.Font.Bold = true;
            wsApprovedSettlements.Column(14).Width = 15;
            wsApprovedSettlements.Cells["O1"].Value = "Medical Provider: Account Name";
            wsApprovedSettlements.Cells["O1"].Style.WrapText = true;
            wsApprovedSettlements.Cells["O1"].Style.VerticalAlignment = ExcelVerticalAlignment.Center;
            wsApprovedSettlements.Cells["O1"].Style.Font.Bold = true;
            wsApprovedSettlements.Column(15).Width = 30;
            wsApprovedSettlements.Cells["P1"].Value = "Member's Account Number at Provider";
            wsApprovedSettlements.Cells["P1"].Style.WrapText = true;
            wsApprovedSettlements.Cells["P1"].Style.VerticalAlignment = ExcelVerticalAlignment.Center;
            wsApprovedSettlements.Cells["P1"].Style.Font.Bold = true;
            wsApprovedSettlements.Column(16).Width = 30;
            wsApprovedSettlements.Cells["Q1"].Value = "Account Name: Shipping Street";
            wsApprovedSettlements.Cells["Q1"].Style.WrapText = true;
            wsApprovedSettlements.Cells["Q1"].Style.VerticalAlignment = ExcelVerticalAlignment.Center;
            wsApprovedSettlements.Cells["Q1"].Style.Font.Bold = true;
            wsApprovedSettlements.Column(17).Width = 30;
            wsApprovedSettlements.Cells["R1"].Value = "Account Name: Shipping City";
            wsApprovedSettlements.Cells["R1"].Style.WrapText = true;
            wsApprovedSettlements.Cells["R1"].Style.VerticalAlignment = ExcelVerticalAlignment.Center;
            wsApprovedSettlements.Cells["R1"].Style.Font.Bold = true;
            wsApprovedSettlements.Column(18).Width = 25;
            wsApprovedSettlements.Cells["S1"].Value = "Account Name: Shipping State/Province";
            wsApprovedSettlements.Cells["S1"].Style.WrapText = true;
            wsApprovedSettlements.Cells["S1"].Style.VerticalAlignment = ExcelVerticalAlignment.Center;
            wsApprovedSettlements.Cells["S1"].Style.Font.Bold = true;
            wsApprovedSettlements.Column(19).Width = 30;
            wsApprovedSettlements.Cells["T1"].Value = "Account Name: Shipping Zip/Postal Code";
            wsApprovedSettlements.Cells["T1"].Style.WrapText = true;
            wsApprovedSettlements.Cells["T1"].Style.VerticalAlignment = ExcelVerticalAlignment.Center;
            wsApprovedSettlements.Cells["T1"].Style.Font.Bold = true;
            wsApprovedSettlements.Column(20).Width = 30;
            wsApprovedSettlements.Cells["U1"].Value = "Amount";
            wsApprovedSettlements.Cells["U1"].Style.WrapText = true;
            wsApprovedSettlements.Cells["U1"].Style.VerticalAlignment = ExcelVerticalAlignment.Center;
            wsApprovedSettlements.Cells["U1"].Style.Font.Bold = true;
            wsApprovedSettlements.Column(21).Width = 10;
            wsApprovedSettlements.Cells["V1"].Value = "Type";
            wsApprovedSettlements.Cells["V1"].Style.WrapText = true;
            wsApprovedSettlements.Cells["V1"].Style.VerticalAlignment = ExcelVerticalAlignment.Center;
            wsApprovedSettlements.Cells["V1"].Style.Font.Bold = true;
            wsApprovedSettlements.Column(22).Width = 30;
            wsApprovedSettlements.Cells["W1"].Value = "Medical Bill Name";
            wsApprovedSettlements.Cells["W1"].Style.WrapText = true;
            wsApprovedSettlements.Cells["W1"].Style.VerticalAlignment = ExcelVerticalAlignment.Center;
            wsApprovedSettlements.Cells["W1"].Style.Font.Bold = true;
            wsApprovedSettlements.Column(23).Width = 20;
            wsApprovedSettlements.Cells["X1"].Value = "Settlement Name";
            wsApprovedSettlements.Cells["X1"].Style.WrapText = true;
            wsApprovedSettlements.Cells["X1"].Style.VerticalAlignment = ExcelVerticalAlignment.Center;
            wsApprovedSettlements.Cells["X1"].Style.Font.Bold = true;
            wsApprovedSettlements.Column(24).Width = 20;
            wsApprovedSettlements.Cells["Y1"].Value = "Well-Being Care Shared";
            wsApprovedSettlements.Cells["Y1"].Style.WrapText = true;
            wsApprovedSettlements.Cells["Y1"].Style.VerticalAlignment = ExcelVerticalAlignment.Center;
            wsApprovedSettlements.Cells["Y1"].Style.Font.Bold = true;
            wsApprovedSettlements.Column(25).Width = 20;
            wsApprovedSettlements.Cells["Z1"].Value = "ICD10 Code: ICD10 Description";
            wsApprovedSettlements.Cells["Z1"].Style.WrapText = true;
            wsApprovedSettlements.Cells["Z1"].Style.VerticalAlignment = ExcelVerticalAlignment.Center;
            wsApprovedSettlements.Cells["Z1"].Style.Font.Bold = true;
            wsApprovedSettlements.Column(26).Width = 50;
            wsApprovedSettlements.Cells["AA1"].Value = "Created by - Full Name";
            wsApprovedSettlements.Cells["AA1"].Style.WrapText = true;
            wsApprovedSettlements.Cells["AA1"].Style.VerticalAlignment = ExcelVerticalAlignment.Center;
            wsApprovedSettlements.Cells["AA1"].Style.Font.Bold = true;
            wsApprovedSettlements.Column(27).Width = 20;
            wsApprovedSettlements.Cells["AB1"].Value = "Last Modified By - Full Name";
            wsApprovedSettlements.Cells["AB1"].Style.WrapText = true;
            wsApprovedSettlements.Cells["AB1"].Style.VerticalAlignment = ExcelVerticalAlignment.Center;
            wsApprovedSettlements.Cells["AB1"].Style.Font.Bold = true;
            wsApprovedSettlements.Column(28).Width = 30;
            wsApprovedSettlements.Cells["AC1"].Value = "Membership Status";
            wsApprovedSettlements.Cells["AC1"].Style.WrapText = true;
            wsApprovedSettlements.Cells["AC1"].Style.VerticalAlignment = ExcelVerticalAlignment.Center;
            wsApprovedSettlements.Cells["AC1"].Style.Font.Bold = true;
            wsApprovedSettlements.Column(29).Width = 20;
            wsApprovedSettlements.Cells["AD1"].Value = "Approved";
            wsApprovedSettlements.Cells["AD1"].Style.WrapText = true;
            wsApprovedSettlements.Cells["AD1"].Style.VerticalAlignment = ExcelVerticalAlignment.Center;
            wsApprovedSettlements.Cells["AD1"].Style.Font.Bold = true;
            wsApprovedSettlements.Column(30).Width = 10;
            wsApprovedSettlements.Cells["AE1"].Value = "Incident: Incident Name";
            wsApprovedSettlements.Cells["AE1"].Style.WrapText = true;
            wsApprovedSettlements.Cells["AE1"].Style.VerticalAlignment = ExcelVerticalAlignment.Center;
            wsApprovedSettlements.Cells["AE1"].Style.Font.Bold = true;
            wsApprovedSettlements.Column(30).Width = 20;


            ApprovedSettlementInfo info = new ApprovedSettlementInfo();

            String strSqlQueryForSettlementApproved = "select [dbo].[tbl_incident].[IncidentNo], [dbo].[tbl_settlement].[Name], " +
                                                      "[dbo].[tbl_settlement].[MedicalBillID], [dbo].[tbl_medbill].[Individual_Id], " +
                                                      "[dbo].[tbl_payment_method].[PaymentMethod_Value], [dbo].[tbl_program].[ProgramName], " +
                                                      "[dbo].[tbl_case].[IB_Receiv_Date], " +
                                                      "[dbo].[tbl_medbill].[BillDate], [dbo].[tbl_medbill].[Account_At_Provider], " +
                                                      "[dbo].[tbl_settlement].[Amount], [dbo].[tbl_settlement_type_code].[SettlementTypeValue]," +
                                                      "[dbo].[tbl_CreateStaff].[Staff_Name], [dbo].[tbl_ModifiStaff].[Staff_Name], " +
                                                      "[dbo].[tbl_medbill].[MedicalProvider_Id], [dbo].[tbl_illness].[ICD_10_Id], " +
                                                      "[dbo].[tbl_medbill].[Account_At_Provider], [dbo].[tbl_settlement].[Approved] " +
                                                      "from [dbo].[tbl_settlement] " +
                                                      "inner join [dbo].[tbl_payment_method] on [dbo].[tbl_settlement].[CMMPaymentMethod] = [dbo].[tbl_payment_method].[PaymentMethod_Id] " +
                                                      "inner join [dbo].[tbl_settlement_type_code] on [dbo].[tbl_settlement].[SettlementType] = [dbo].[tbl_settlement_type_code].[SettlementTypeCode] " +
                                                      "inner join [dbo].[tbl_medbill] on [dbo].[tbl_settlement].[MedicalBillID] = [dbo].[tbl_medbill].[BillNo] " +
                                                      "inner join [dbo].[tbl_case] on [dbo].[tbl_medbill].[Case_Id] = [dbo].[tbl_case].[Case_Name] " +
                                                      "inner join [dbo].[tbl_incident] on [dbo].[tbl_medbill].[Incident_Id] = [dbo].[tbl_incident].[Incident_id] " +
                                                      "inner join [dbo].[tbl_program] on [dbo].[tbl_incident].[Program_id] = [dbo].[tbl_program].[Program_Id] " +
                                                      "inner join [dbo].[tbl_illness] on [dbo].[tbl_medbill].[Illness_Id] = [dbo].[tbl_illness].[Illness_Id] " +
                                                      "inner join [dbo].[tbl_CreateStaff] on [dbo].[tbl_settlement].[CreateByID] = [dbo].[tbl_CreateStaff].[CreateStaff_Id] " +
                                                      "inner join [dbo].[tbl_ModifiStaff] on [dbo].[tbl_settlement].[LastModifiedByID] = [dbo].[tbl_ModifiStaff].[ModifiStaff_Id] " +
                                                      "where [dbo].[tbl_settlement].[Approved] = 1 and " +
                                                      "([dbo].[tbl_illness].[ICD_10_Id] ='Z00.00' or [dbo].[tbl_illness].[ICD_10_Id] = 'Z00.012') and " +
                                                      "([dbo].[tbl_payment_method].[PaymentMethod_Value] = 'Check' or [dbo].[tbl_payment_method].[PaymentMethod_Value] = 'ACH/Banking') and " +
                                                      "([dbo].[tbl_settlement_type_code].[SettlementTypeValue] = 'CMM Member Reimbursement' or " +
                                                      "[dbo].[tbl_settlement_type_code].[SettlementTypeValue] = 'CMM Provider Payment' or " +
                                                      "[dbo].[tbl_settlement_type_code].[SettlementTypeValue] = 'PR Reimbursement') and " +
                                                      "([dbo].[tbl_medbill].[WellBeingCare] = 0 or [dbo].[tbl_medbill].[WellBeingCare] is NULL) and " +
                                                      "([dbo].[tbl_settlement].[CheckDate] is NULL or [dbo].[tbl_settlement].[CheckDate] = '') and " +
                                                      "([dbo].[tbl_settlement].[CheckNo] is NULL or [dbo].[tbl_settlement].[CheckNo] = '') and " +
                                                      "([dbo].[tbl_settlement].[ACH_Number] is NULL or [dbo].[tbl_settlement].[CheckNo] = '') and " +
                                                      "([dbo].[tbl_settlement].[IsExported] = 0 or [dbo].[tbl_settlement].[IsExported] is NULL)";

            SqlCommand cmdQueryForSettlementApproved = new SqlCommand(strSqlQueryForSettlementApproved, connRN);
            cmdQueryForSettlementApproved.CommandType = CommandType.Text;

            List<String> lstMedBillID = new List<String>();
            if (connRN.State != ConnectionState.Closed)
            {
                connRN.Close();
                connRN.Open();
            }
            else if (connRN.State == ConnectionState.Closed) connRN.Open();
            SqlDataReader rdrSettlementApproved = cmdQueryForSettlementApproved.ExecuteReader();

            List<ApprovedSettlementInfo> lstApprovedSettlement = new List<ApprovedSettlementInfo>();

            if (rdrSettlementApproved.HasRows)
            {
                while (rdrSettlementApproved.Read())
                {
                    ApprovedSettlementInfo settlement = new ApprovedSettlementInfo();

                    if (!rdrSettlementApproved.IsDBNull(0)) settlement.IncidentNo = rdrSettlementApproved.GetString(0);
                    if (!rdrSettlementApproved.IsDBNull(1)) settlement.SettlementName = rdrSettlementApproved.GetString(1);
                    if (!rdrSettlementApproved.IsDBNull(2)) settlement.MedBillName = rdrSettlementApproved.GetString(2);
                    if (!rdrSettlementApproved.IsDBNull(3)) settlement.IndividualId = rdrSettlementApproved.GetString(3);
                    if (!rdrSettlementApproved.IsDBNull(4)) settlement.PaymentType = rdrSettlementApproved.GetString(4);
                    if (!rdrSettlementApproved.IsDBNull(5)) settlement.IncidentProgram = rdrSettlementApproved.GetString(5);
                    if (!rdrSettlementApproved.IsDBNull(6)) settlement.IBReceivedDate = rdrSettlementApproved.GetDateTime(6);
                    if (!rdrSettlementApproved.IsDBNull(7)) settlement.ServiceDate = rdrSettlementApproved.GetDateTime(7);
                    if (!rdrSettlementApproved.IsDBNull(8)) settlement.AccountNoAtMedProvider = rdrSettlementApproved.GetString(8);
                    if (!rdrSettlementApproved.IsDBNull(9)) settlement.Amount = rdrSettlementApproved.GetDecimal(9);
                    if (!rdrSettlementApproved.IsDBNull(10)) settlement.SettlementType = rdrSettlementApproved.GetString(10);
                    if (!rdrSettlementApproved.IsDBNull(11)) settlement.CreatedBy = rdrSettlementApproved.GetString(11);
                    if (!rdrSettlementApproved.IsDBNull(12)) settlement.LastModifiedBy = rdrSettlementApproved.GetString(12);
                    if (!rdrSettlementApproved.IsDBNull(13)) settlement.MedicalProviderId = rdrSettlementApproved.GetString(13);
                    if (!rdrSettlementApproved.IsDBNull(14)) settlement.ICD10Code = rdrSettlementApproved.GetString(14);
                    //if (settlement.ICD10Code != "Z00.00" && settlement.ICD10Code != "Z00.012") settlement.WellBeingCareShared = 0;
                    if (settlement.ICD10Code == "Z00.00" || settlement.ICD10Code == "Z00.012") settlement.WellBeingCareShared = settlement.Amount;
                    if (!rdrSettlementApproved.IsDBNull(15)) settlement.AccountNoAtMedProvider = rdrSettlementApproved.GetString(15);
                    if (!rdrSettlementApproved.IsDBNull(16)) settlement.Approved = rdrSettlementApproved.GetBoolean(16);

                    lstApprovedSettlement.Add(settlement);

                }
            }
            rdrSettlementApproved.Close();
            if (connRN.State == ConnectionState.Open) connRN.Close();

            foreach (ApprovedSettlementInfo settlement in lstApprovedSettlement)
            {
                if (settlement.ICD10Code != null)
                {
                    String strSqlQueryForDiseaseName = "select [dbo].[ICD10 Code].[Name] from [dbo].[ICD10 Code] where [dbo].[ICD10 Code].[ICD10_CODE__C] = @ICD10Code";

                    SqlCommand cmdQueryForDiseaseName = new SqlCommand(strSqlQueryForDiseaseName, connSalesforce);
                    cmdQueryForDiseaseName.CommandType = CommandType.Text;

                    cmdQueryForDiseaseName.Parameters.AddWithValue("@ICD10Code", settlement.ICD10Code);

                    if (connSalesforce.State != ConnectionState.Closed)
                    {
                        connSalesforce.Close();
                        connSalesforce.Open();
                    }
                    else if (connSalesforce.State == ConnectionState.Closed) connSalesforce.Open();
                    Object objDiseaseName = cmdQueryForDiseaseName.ExecuteScalar();
                    if (objDiseaseName != null) settlement.ICD10CodeDescription = objDiseaseName.ToString();
                    if (connSalesforce.State == ConnectionState.Open) connSalesforce.Close();
                }
                else settlement.ICD10CodeDescription = String.Empty;
            }


            foreach (ApprovedSettlementInfo settlement in lstApprovedSettlement)
            {
                String strSqlQueryForIndividualInfo = "select [dbo].[contact].[Name], [dbo].[contact].[FirstName], [dbo].[contact].[MiddleName], [dbo].[contact].[LastName], " +
                                                      "[dbo].[contact].[Household_Role__c], [dbo].[contact].[Primary_Name__c], [dbo].[program].[Name], " +
                                                      "[dbo].[contact].[Membership_IND_Start_date__c], [dbo].[contact].[Membership_Number__c], " +
                                                      "[dbo].[account].[SHIPPINGSTREET], [dbo].[account].[SHIPPINGCITY], [dbo].[account].[SHIPPINGSTATE], [dbo].[account].[SHIPPINGPOSTALCODE], " +
                                                      "[dbo].[contact].[c4g_Membership_Status__c] " +
                                                      "from [dbo].[contact] " +
                                                      "inner join [dbo].[program] on [dbo].[contact].[c4g_Plan__c] = [dbo].[program].[ID] " +
                                                      "inner join [dbo].[account] on [dbo].[contact].[AccountId] = [dbo].[account].[ID] " +
                                                      "where [dbo].[contact].[Individual_ID__c] = @IndividualId";

                SqlCommand cmdQueryForIndividualInfo = new SqlCommand(strSqlQueryForIndividualInfo, connSalesforce);
                cmdQueryForIndividualInfo.CommandType = CommandType.Text;

                cmdQueryForIndividualInfo.Parameters.AddWithValue("@IndividualId", settlement.IndividualId);

                if (connSalesforce.State != ConnectionState.Closed)
                {
                    connSalesforce.Close();
                    connSalesforce.Open();
                }
                else if (connSalesforce.State == ConnectionState.Closed) connSalesforce.Open();

                SqlDataReader rdrIndividualInfo = cmdQueryForIndividualInfo.ExecuteReader();

                if (rdrIndividualInfo.HasRows)
                {
                    rdrIndividualInfo.Read();
                    if (!rdrIndividualInfo.IsDBNull(0)) settlement.FullName = rdrIndividualInfo.GetString(0);
                    if (!rdrIndividualInfo.IsDBNull(1)) settlement.FirstName = rdrIndividualInfo.GetString(1);
                    if (!rdrIndividualInfo.IsDBNull(2)) settlement.MiddleName = rdrIndividualInfo.GetString(2);
                    if (!rdrIndividualInfo.IsDBNull(3)) settlement.LastName = rdrIndividualInfo.GetString(3);
                    if (!rdrIndividualInfo.IsDBNull(4)) settlement.HouseholdRole = rdrIndividualInfo.GetString(4);
                    if (!rdrIndividualInfo.IsDBNull(5)) settlement.PrimaryName = rdrIndividualInfo.GetString(5);
                    if (!rdrIndividualInfo.IsDBNull(6)) settlement.ProgramName = rdrIndividualInfo.GetString(6);
                    if (!rdrIndividualInfo.IsDBNull(7)) settlement.MembershipStartDate = rdrIndividualInfo.GetDateTime(7);
                    if (!rdrIndividualInfo.IsDBNull(8)) settlement.MembershipNo = rdrIndividualInfo.GetString(8);
                    if (!rdrIndividualInfo.IsDBNull(9)) settlement.AccountShippingStreet = rdrIndividualInfo.GetString(9);
                    if (!rdrIndividualInfo.IsDBNull(10)) settlement.AccountShippingCity = rdrIndividualInfo.GetString(10);
                    if (!rdrIndividualInfo.IsDBNull(11)) settlement.AccountShippingState = rdrIndividualInfo.GetString(11);
                    if (!rdrIndividualInfo.IsDBNull(12)) settlement.AccountShppingZip = rdrIndividualInfo.GetDouble(12).ToString();
                    if (!rdrIndividualInfo.IsDBNull(13)) settlement.MembershipStatus = rdrIndividualInfo.GetString(13);
                }

                rdrIndividualInfo.Close();
                if (connSalesforce.State == ConnectionState.Open) connSalesforce.Close();
            }

            foreach (ApprovedSettlementInfo settlement in lstApprovedSettlement)
            {
                String strSqlQueryForMedicalProviderName = "select [dbo].[MedicalProvider].[Name] from [dbo].[MedicalProvider] where [dbo].[MedicalProvider].[ID] = @MedicalProviderId";

                SqlCommand cmdQueryForMedicalProvider = new SqlCommand(strSqlQueryForMedicalProviderName, connSalesforce);
                cmdQueryForMedicalProvider.CommandType = CommandType.Text;

                cmdQueryForMedicalProvider.Parameters.AddWithValue("@MedicalProviderId", settlement.MedicalProviderId);

                if (connSalesforce.State != ConnectionState.Closed)
                {
                    connSalesforce.Close();
                    connSalesforce.Open();
                }
                else if (connSalesforce.State == ConnectionState.Closed) connSalesforce.Open();
                Object objMedicalProviderName = cmdQueryForMedicalProvider.ExecuteScalar();
                if (objMedicalProviderName != null) settlement.MedicalProviderName = objMedicalProviderName.ToString();
                if (connSalesforce.State == ConnectionState.Open) connSalesforce.Close();
            }




            for (int i = 0; i < lstApprovedSettlement.Count; i++)
            {
                if (i % 2 == 0)
                {
                    wsApprovedSettlements.Cells[i + 2, 1].Value = lstApprovedSettlement[i].FullName;
                    wsApprovedSettlements.Cells[i + 2, 2].Value = lstApprovedSettlement[i].FirstName;
                    wsApprovedSettlements.Cells[i + 2, 3].Value = lstApprovedSettlement[i].MiddleName;
                    wsApprovedSettlements.Cells[i + 2, 4].Value = lstApprovedSettlement[i].LastName;
                    wsApprovedSettlements.Cells[i + 2, 5].Value = lstApprovedSettlement[i].HouseholdRole;
                    wsApprovedSettlements.Cells[i + 2, 6].Value = lstApprovedSettlement[i].IndividualId;
                    wsApprovedSettlements.Cells[i + 2, 7].Value = lstApprovedSettlement[i].PrimaryName;
                    wsApprovedSettlements.Cells[i + 2, 8].Value = lstApprovedSettlement[i].PaymentType;
                    wsApprovedSettlements.Cells[i + 2, 9].Value = lstApprovedSettlement[i].ProgramName;
                    wsApprovedSettlements.Cells[i + 2, 10].Value = lstApprovedSettlement[i].IncidentProgram;
                    wsApprovedSettlements.Cells[i + 2, 11].Value = lstApprovedSettlement[i].MembershipStartDate.ToString("MM/dd/yyyy");
                    wsApprovedSettlements.Cells[i + 2, 12].Value = lstApprovedSettlement[i].MembershipNo;
                    wsApprovedSettlements.Cells[i + 2, 13].Value = lstApprovedSettlement[i].IBReceivedDate.ToString("MM/dd/yyyy");
                    wsApprovedSettlements.Cells[i + 2, 14].Value = lstApprovedSettlement[i].ServiceDate.ToString("MM/dd/yyyy");
                    wsApprovedSettlements.Cells[i + 2, 15].Value = lstApprovedSettlement[i].MedicalProviderName;
                    wsApprovedSettlements.Cells[i + 2, 16].Value = lstApprovedSettlement[i].AccountNoAtMedProvider;
                    wsApprovedSettlements.Cells[i + 2, 17].Value = lstApprovedSettlement[i].AccountShippingStreet;
                    wsApprovedSettlements.Cells[i + 2, 18].Value = lstApprovedSettlement[i].AccountShippingCity;
                    wsApprovedSettlements.Cells[i + 2, 19].Value = lstApprovedSettlement[i].AccountShippingState;
                    wsApprovedSettlements.Cells[i + 2, 20].Value = lstApprovedSettlement[i].AccountShppingZip;
                    wsApprovedSettlements.Cells[i + 2, 21].Value = lstApprovedSettlement[i].Amount;
                    wsApprovedSettlements.Cells[i + 2, 22].Value = lstApprovedSettlement[i].SettlementType;
                    wsApprovedSettlements.Cells[i + 2, 23].Value = lstApprovedSettlement[i].MedBillName;
                    wsApprovedSettlements.Cells[i + 2, 24].Value = lstApprovedSettlement[i].SettlementName;
                    wsApprovedSettlements.Cells[i + 2, 25].Value = lstApprovedSettlement[i].WellBeingCareShared;
                    wsApprovedSettlements.Cells[i + 2, 26].Value = lstApprovedSettlement[i].ICD10CodeDescription;
                    wsApprovedSettlements.Cells[i + 2, 27].Value = lstApprovedSettlement[i].CreatedBy;
                    wsApprovedSettlements.Cells[i + 2, 28].Value = lstApprovedSettlement[i].LastModifiedBy;
                    wsApprovedSettlements.Cells[i + 2, 29].Value = lstApprovedSettlement[i].MembershipStatus;
                    wsApprovedSettlements.Cells[i + 2, 30].Value = lstApprovedSettlement[i].Approved;
                    wsApprovedSettlements.Cells[i + 2, 31].Value = lstApprovedSettlement[i].IncidentNo;
                }
                else
                {
                    wsApprovedSettlements.Cells[i + 2, 1].Value = lstApprovedSettlement[i].FullName;
                    wsApprovedSettlements.Cells[i + 2, 1].Style.Fill.PatternType = ExcelFillStyle.Solid;
                    wsApprovedSettlements.Cells[i + 2, 1].Style.Fill.BackgroundColor.SetColor(Color.FromKnownColor(KnownColor.LightGray));
                    wsApprovedSettlements.Cells[i + 2, 2].Value = lstApprovedSettlement[i].FirstName;
                    wsApprovedSettlements.Cells[i + 2, 2].Style.Fill.PatternType = ExcelFillStyle.Solid;
                    wsApprovedSettlements.Cells[i + 2, 2].Style.Fill.BackgroundColor.SetColor(Color.FromKnownColor(KnownColor.LightGray));
                    wsApprovedSettlements.Cells[i + 2, 3].Value = lstApprovedSettlement[i].MiddleName;
                    wsApprovedSettlements.Cells[i + 2, 3].Style.Fill.PatternType = ExcelFillStyle.Solid;
                    wsApprovedSettlements.Cells[i + 2, 3].Style.Fill.BackgroundColor.SetColor(Color.FromKnownColor(KnownColor.LightGray));
                    wsApprovedSettlements.Cells[i + 2, 4].Value = lstApprovedSettlement[i].LastName;
                    wsApprovedSettlements.Cells[i + 2, 4].Style.Fill.PatternType = ExcelFillStyle.Solid;
                    wsApprovedSettlements.Cells[i + 2, 4].Style.Fill.BackgroundColor.SetColor(Color.FromKnownColor(KnownColor.LightGray));
                    wsApprovedSettlements.Cells[i + 2, 5].Value = lstApprovedSettlement[i].HouseholdRole;
                    wsApprovedSettlements.Cells[i + 2, 5].Style.Fill.PatternType = ExcelFillStyle.Solid;
                    wsApprovedSettlements.Cells[i + 2, 5].Style.Fill.BackgroundColor.SetColor(Color.FromKnownColor(KnownColor.LightGray));
                    wsApprovedSettlements.Cells[i + 2, 6].Value = lstApprovedSettlement[i].IndividualId;
                    wsApprovedSettlements.Cells[i + 2, 6].Style.Fill.PatternType = ExcelFillStyle.Solid;
                    wsApprovedSettlements.Cells[i + 2, 6].Style.Fill.BackgroundColor.SetColor(Color.FromKnownColor(KnownColor.LightGray));
                    wsApprovedSettlements.Cells[i + 2, 7].Value = lstApprovedSettlement[i].PrimaryName;
                    wsApprovedSettlements.Cells[i + 2, 7].Style.Fill.PatternType = ExcelFillStyle.Solid;
                    wsApprovedSettlements.Cells[i + 2, 7].Style.Fill.BackgroundColor.SetColor(Color.FromKnownColor(KnownColor.LightGray));
                    wsApprovedSettlements.Cells[i + 2, 8].Value = lstApprovedSettlement[i].PaymentType;
                    wsApprovedSettlements.Cells[i + 2, 8].Style.Fill.PatternType = ExcelFillStyle.Solid;
                    wsApprovedSettlements.Cells[i + 2, 8].Style.Fill.BackgroundColor.SetColor(Color.FromKnownColor(KnownColor.LightGray));
                    wsApprovedSettlements.Cells[i + 2, 9].Value = lstApprovedSettlement[i].ProgramName;
                    wsApprovedSettlements.Cells[i + 2, 9].Style.Fill.PatternType = ExcelFillStyle.Solid;
                    wsApprovedSettlements.Cells[i + 2, 9].Style.Fill.BackgroundColor.SetColor(Color.FromKnownColor(KnownColor.LightGray));
                    wsApprovedSettlements.Cells[i + 2, 10].Value = lstApprovedSettlement[i].IncidentProgram;
                    wsApprovedSettlements.Cells[i + 2, 10].Style.Fill.PatternType = ExcelFillStyle.Solid;
                    wsApprovedSettlements.Cells[i + 2, 10].Style.Fill.BackgroundColor.SetColor(Color.FromKnownColor(KnownColor.LightGray));
                    wsApprovedSettlements.Cells[i + 2, 11].Value = lstApprovedSettlement[i].MembershipStartDate.ToString("MM/dd/yyyy");
                    wsApprovedSettlements.Cells[i + 2, 11].Style.Fill.PatternType = ExcelFillStyle.Solid;
                    wsApprovedSettlements.Cells[i + 2, 11].Style.Fill.BackgroundColor.SetColor(Color.FromKnownColor(KnownColor.LightGray));
                    wsApprovedSettlements.Cells[i + 2, 12].Value = lstApprovedSettlement[i].MembershipNo;
                    wsApprovedSettlements.Cells[i + 2, 12].Style.Fill.PatternType = ExcelFillStyle.Solid;
                    wsApprovedSettlements.Cells[i + 2, 12].Style.Fill.BackgroundColor.SetColor(Color.FromKnownColor(KnownColor.LightGray));
                    wsApprovedSettlements.Cells[i + 2, 13].Value = lstApprovedSettlement[i].IBReceivedDate.ToString("MM/dd/yyyy");
                    wsApprovedSettlements.Cells[i + 2, 13].Style.Fill.PatternType = ExcelFillStyle.Solid;
                    wsApprovedSettlements.Cells[i + 2, 13].Style.Fill.BackgroundColor.SetColor(Color.FromKnownColor(KnownColor.LightGray));
                    wsApprovedSettlements.Cells[i + 2, 14].Value = lstApprovedSettlement[i].ServiceDate.ToString("MM/dd/yyyy");
                    wsApprovedSettlements.Cells[i + 2, 14].Style.Fill.PatternType = ExcelFillStyle.Solid;
                    wsApprovedSettlements.Cells[i + 2, 14].Style.Fill.BackgroundColor.SetColor(Color.FromKnownColor(KnownColor.LightGray));
                    wsApprovedSettlements.Cells[i + 2, 15].Value = lstApprovedSettlement[i].MedicalProviderName;
                    wsApprovedSettlements.Cells[i + 2, 15].Style.Fill.PatternType = ExcelFillStyle.Solid;
                    wsApprovedSettlements.Cells[i + 2, 15].Style.Fill.BackgroundColor.SetColor(Color.FromKnownColor(KnownColor.LightGray));
                    wsApprovedSettlements.Cells[i + 2, 16].Value = lstApprovedSettlement[i].AccountNoAtMedProvider;
                    wsApprovedSettlements.Cells[i + 2, 16].Style.Fill.PatternType = ExcelFillStyle.Solid;
                    wsApprovedSettlements.Cells[i + 2, 16].Style.Fill.BackgroundColor.SetColor(Color.FromKnownColor(KnownColor.LightGray));
                    wsApprovedSettlements.Cells[i + 2, 17].Value = lstApprovedSettlement[i].AccountShippingStreet;
                    wsApprovedSettlements.Cells[i + 2, 17].Style.Fill.PatternType = ExcelFillStyle.Solid;
                    wsApprovedSettlements.Cells[i + 2, 17].Style.Fill.BackgroundColor.SetColor(Color.FromKnownColor(KnownColor.LightGray));
                    wsApprovedSettlements.Cells[i + 2, 18].Value = lstApprovedSettlement[i].AccountShippingCity;
                    wsApprovedSettlements.Cells[i + 2, 18].Style.Fill.PatternType = ExcelFillStyle.Solid;
                    wsApprovedSettlements.Cells[i + 2, 18].Style.Fill.BackgroundColor.SetColor(Color.FromKnownColor(KnownColor.LightGray));
                    wsApprovedSettlements.Cells[i + 2, 19].Value = lstApprovedSettlement[i].AccountShippingState;
                    wsApprovedSettlements.Cells[i + 2, 19].Style.Fill.PatternType = ExcelFillStyle.Solid;
                    wsApprovedSettlements.Cells[i + 2, 19].Style.Fill.BackgroundColor.SetColor(Color.FromKnownColor(KnownColor.LightGray));
                    wsApprovedSettlements.Cells[i + 2, 20].Value = lstApprovedSettlement[i].AccountShppingZip;
                    wsApprovedSettlements.Cells[i + 2, 20].Style.Fill.PatternType = ExcelFillStyle.Solid;
                    wsApprovedSettlements.Cells[i + 2, 20].Style.Fill.BackgroundColor.SetColor(Color.FromKnownColor(KnownColor.LightGray));
                    wsApprovedSettlements.Cells[i + 2, 21].Value = lstApprovedSettlement[i].Amount;
                    wsApprovedSettlements.Cells[i + 2, 21].Style.Fill.PatternType = ExcelFillStyle.Solid;
                    wsApprovedSettlements.Cells[i + 2, 21].Style.Fill.BackgroundColor.SetColor(Color.FromKnownColor(KnownColor.LightGray));
                    wsApprovedSettlements.Cells[i + 2, 22].Value = lstApprovedSettlement[i].SettlementType;
                    wsApprovedSettlements.Cells[i + 2, 22].Style.Fill.PatternType = ExcelFillStyle.Solid;
                    wsApprovedSettlements.Cells[i + 2, 22].Style.Fill.BackgroundColor.SetColor(Color.FromKnownColor(KnownColor.LightGray));
                    wsApprovedSettlements.Cells[i + 2, 23].Value = lstApprovedSettlement[i].MedBillName;
                    wsApprovedSettlements.Cells[i + 2, 23].Style.Fill.PatternType = ExcelFillStyle.Solid;
                    wsApprovedSettlements.Cells[i + 2, 23].Style.Fill.BackgroundColor.SetColor(Color.FromKnownColor(KnownColor.LightGray));
                    wsApprovedSettlements.Cells[i + 2, 24].Value = lstApprovedSettlement[i].SettlementName;
                    wsApprovedSettlements.Cells[i + 2, 24].Style.Fill.PatternType = ExcelFillStyle.Solid;
                    wsApprovedSettlements.Cells[i + 2, 24].Style.Fill.BackgroundColor.SetColor(Color.FromKnownColor(KnownColor.LightGray));
                    wsApprovedSettlements.Cells[i + 2, 25].Value = lstApprovedSettlement[i].WellBeingCareShared;
                    wsApprovedSettlements.Cells[i + 2, 25].Style.Fill.PatternType = ExcelFillStyle.Solid;
                    wsApprovedSettlements.Cells[i + 2, 25].Style.Fill.BackgroundColor.SetColor(Color.FromKnownColor(KnownColor.LightGray));
                    wsApprovedSettlements.Cells[i + 2, 26].Value = lstApprovedSettlement[i].ICD10CodeDescription;
                    wsApprovedSettlements.Cells[i + 2, 26].Style.Fill.PatternType = ExcelFillStyle.Solid;
                    wsApprovedSettlements.Cells[i + 2, 26].Style.Fill.BackgroundColor.SetColor(Color.FromKnownColor(KnownColor.LightGray));
                    wsApprovedSettlements.Cells[i + 2, 27].Value = lstApprovedSettlement[i].CreatedBy;
                    wsApprovedSettlements.Cells[i + 2, 27].Style.Fill.PatternType = ExcelFillStyle.Solid;
                    wsApprovedSettlements.Cells[i + 2, 27].Style.Fill.BackgroundColor.SetColor(Color.FromKnownColor(KnownColor.LightGray));
                    wsApprovedSettlements.Cells[i + 2, 28].Value = lstApprovedSettlement[i].LastModifiedBy;
                    wsApprovedSettlements.Cells[i + 2, 28].Style.Fill.PatternType = ExcelFillStyle.Solid;
                    wsApprovedSettlements.Cells[i + 2, 28].Style.Fill.BackgroundColor.SetColor(Color.FromKnownColor(KnownColor.LightGray));
                    wsApprovedSettlements.Cells[i + 2, 29].Value = lstApprovedSettlement[i].MembershipStatus;
                    wsApprovedSettlements.Cells[i + 2, 29].Style.Fill.PatternType = ExcelFillStyle.Solid;
                    wsApprovedSettlements.Cells[i + 2, 29].Style.Fill.BackgroundColor.SetColor(Color.FromKnownColor(KnownColor.LightGray));
                    wsApprovedSettlements.Cells[i + 2, 30].Value = lstApprovedSettlement[i].Approved;
                    wsApprovedSettlements.Cells[i + 2, 30].Style.Fill.PatternType = ExcelFillStyle.Solid;
                    wsApprovedSettlements.Cells[i + 2, 30].Style.Fill.BackgroundColor.SetColor(Color.FromKnownColor(KnownColor.LightGray));
                    wsApprovedSettlements.Cells[i + 2, 31].Value = lstApprovedSettlement[i].IncidentNo;
                    wsApprovedSettlements.Cells[i + 2, 31].Style.Fill.PatternType = ExcelFillStyle.Solid;
                    wsApprovedSettlements.Cells[i + 2, 31].Style.Fill.BackgroundColor.SetColor(Color.FromKnownColor(KnownColor.LightGray));
                }

            }

            SaveFileDialog saveFileDlg = new SaveFileDialog();
            saveFileDlg.Filter = "Excel File|*.xlsx";
            saveFileDlg.Title = "Save an Excel File";
            saveFileDlg.ShowDialog();

            if (saveFileDlg.FileName != "")
            {
                FileInfo fi = new FileInfo(saveFileDlg.FileName);
                excelApprovedSettlement.SaveAs(fi);
            }
        }

        private void btnCreateTask_Click(object sender, EventArgs e)
        {
            String IndividualId = txtIndividualIDMedBill.Text.Trim();
            String IndividualName = txtPatientNameMedBill.Text.Trim();
            String MedBillId = txtMedBillNo.Text.Trim();

            frmTaskCreationPage frmTask = new frmTaskCreationPage(IndividualId,
                                                                  RelatedToTable.MedicalBill,
                                                                  IndividualName,
                                                                  MedBillId,
                                                                  nLoggedUserId,
                                                                  LoggedInUserName,
                                                                  LoggedInUserRole,
                                                                  LoggedInUserDepartment,
                                                                  TaskMode.AddNew);
            frmTask.ShowDialog();
        }

        private void gvMostRecentTasks_CellDoubleClick(object sender, DataGridViewCellEventArgs e)
        {
            DataGridView gvTask = (DataGridView)sender;

            String strTaskId = gvTask["TaskIdMedBill", e.RowIndex].Value as String;
            //String strSubject = gvTask[0, e.RowIndex].Value as String;
            //String strDueDate = gvTask[1, e.RowIndex].Value as String;
            //String AssignedTo = gvTask[2, e.RowIndex].Value as String;
            //String StatusTask = gvTask[3, e.RowIndex].Value as String;

            if (strTaskId != String.Empty)
            {
                int nTaskId = Int32.Parse(strTaskId);

                String strSqlQueryForCreateById = "select [dbo].[tbl_task].[CreatedById] from [dbo].[tbl_task] where [dbo].[tbl_task].[id] = @TaskId";

                SqlCommand cmdQueryForCreateById = new SqlCommand(strSqlQueryForCreateById, connRN5);
                cmdQueryForCreateById.CommandType = CommandType.Text;

                cmdQueryForCreateById.Parameters.AddWithValue("@TaskId", nTaskId);

                if (connRN5.State != ConnectionState.Closed)
                {
                    connRN5.Close();
                    connRN5.Open();
                }
                else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                Object objCreateById = cmdQueryForCreateById.ExecuteScalar();
                if (connRN5.State == ConnectionState.Open) connRN5.Close();

                int? nCreateById = null;
                if (objCreateById != null) nCreateById = Int16.Parse(objCreateById.ToString());

                String TaskCreatorName = String.Empty;
                int? nTaskCreatorId = null;
                int? nTaskCreatorUserRoleId = null;

                String strSqlQueryForCreateByUserRoleId = "select [dbo].[tbl_user].[User_Name], [dbo].[tbl_user].[User_Id], [dbo].[tbl_user].[User_Role_Id] " +
                                                          "from [dbo].[tbl_user] where [dbo].[tbl_user].[User_Id] = @CreateById";

                SqlCommand cmdQueryForCreateByUserRoleId = new SqlCommand(strSqlQueryForCreateByUserRoleId, connRN5);
                cmdQueryForCreateByUserRoleId.CommandType = CommandType.Text;

                cmdQueryForCreateByUserRoleId.Parameters.AddWithValue("@CreateById", nCreateById);
                if (connRN5.State != ConnectionState.Closed)
                {
                    connRN5.Close();
                    connRN5.Open();
                }
                else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                SqlDataReader rdrTaskCreatorInfo = cmdQueryForCreateByUserRoleId.ExecuteReader();
                if (rdrTaskCreatorInfo.HasRows)
                {
                    if (rdrTaskCreatorInfo.Read())
                    {
                        if (!rdrTaskCreatorInfo.IsDBNull(0)) TaskCreatorName = rdrTaskCreatorInfo.GetString(0);
                        if (!rdrTaskCreatorInfo.IsDBNull(1)) nTaskCreatorId = rdrTaskCreatorInfo.GetInt16(1);
                        if (!rdrTaskCreatorInfo.IsDBNull(2)) nTaskCreatorUserRoleId = rdrTaskCreatorInfo.GetInt16(2);
                    }
                }
                //Object objCreateByUserRoleId = cmdQueryForCreateByUserRoleId.ExecuteScalar();
                if (connRN5.State == ConnectionState.Open) connRN5.Close();

                //if (objCreateByUserRoleId != null) nCreateByUserRoleId = Int16.Parse(objCreateByUserRoleId.ToString());

                String WhoId = txtIndividualIDMedBill.Text.Trim();
                String IndividualName = txtPatientNameMedBill.Text.Trim();

                //frmTaskCreationPage(int task_id, String individual_id, String creator_name, int creator_id, int login_user_id, String login_user_name, UserRole login_user_role_id, Department login_user_department, TaskMode mode)

                frmTaskCreationPage frmTaskToModify = new frmTaskCreationPage(nTaskId, WhoId, TaskCreatorName, nTaskCreatorId.Value, nLoggedUserId, LoggedInUserName, LoggedInUserRole, LoggedInUserDepartment, TaskMode.EditInMedBill);

                frmTaskToModify.ShowDialog();


                //if (LoggedInUserRole == UserRole.RNManager)
                //{
                //    if ((UserRole)nCreateByUserRoleId.Value != UserRole.RNStaff)
                //    {
                //        MessageBox.Show("The Task is not created by RN staff. It can't be modified by RN manager.");
                //        return;
                //    }
                //}

                //if (LoggedInUserRole == UserRole.NPManager)
                //{
                //    if ((UserRole)nCreateByUserRoleId.Value != UserRole.NPStaff)
                //    {
                //        MessageBox.Show("This Task is not created by NP staff. It can't be modified by NP manager.");
                //        return;
                //    }
                //}

                //if (LoggedInUserRole == UserRole.FDManager)
                //{
                //    if ((UserRole)nCreateByUserRoleId.Value != UserRole.FDStaff)
                //    {
                //        MessageBox.Show("This Task is not created by FD staff. It can't be modified by FD manager.");
                //        return;
                //    }
                //}

                //if (LoggedInUserRole != UserRole.Administrator &&
                //    LoggedInUserRole != UserRole.FDManager &&
                //    LoggedInUserRole != UserRole.NPManager &&
                //    LoggedInUserRole != UserRole.RNManager)
                //{
                //    MessageBox.Show("You are not authorized to modify the task.");
                //    return;
                //}

                //String strSqlQueryForTask = "select [dbo].[tbl_task].[AssignedTo], [dbo].[tbl_task].[Subject], [dbo].[tbl_task].[DueDate], " +
                //                            "[dbo].[tbl_task].[RelatedToTableId], [dbo].[tbl_task].[whatid], " +
                //                            "[dbo].[tbl_task].[IndividualName], [dbo][tbl_task].[whoid], " +
                //                            "[dbo].[tbl_task].[Comment], [dbo].[tbl_task].[Solution], " +
                //                            "[dbo].[tbl_task].[Status], [dbo].[tbl_task].[Priority], " +
                //                            "[dbo].[tbl_task].[IsReminderSet], [dbo].[tbl_task].[ReminderDateTime], [dbo].[tbl_task].[HasAttachment], [dbo].[tbl_task].[Attachment] " +
                //                            "from [dbo].[tbl_task] " +                                            
                //                            "where [dbo].[tbl_task].[id] = @TaskId";

                //SqlCommand cmdQueryForTask = new SqlCommand(strSqlQueryForTask, connRN5);
                //cmdQueryForTask.CommandType = CommandType.Text;

                //cmdQueryForTask.Parameters.AddWithValue("@TaskId", nTaskId);

                //if (connRN5.State != ConnectionState.Closed)
                //{
                //    connRN5.Close();
                //    connRN5.Open();
                //}
                //else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                //SqlDataReader rdrTaskForEdit = cmdQueryForTask.ExecuteReader();
                //if (rdrTaskForEdit.HasRows)
                //{

                //}

                //if (connRN5.State == ConnectionState.Open) connRN5.Close();
            }
        }

        private void gvSettlementsInMedBill_KeyDown(object sender, KeyEventArgs e)
        {
            if (e.KeyCode == Keys.Delete || e.KeyCode == Keys.Back)
            {
                gvSettlementsInMedBill.CurrentCell.Value = String.Empty;
            }
        }

        private void gvPaymentCreditCard_CellContentClick(object sender, DataGridViewCellEventArgs e)
        {
            DataGridView gvCCPayment = (DataGridView)sender;

            if (e.ColumnIndex == 0)
            {
                String ccPaymentIndividualId = String.Empty;
                if (gvCCPayment["IndividualIdInPaymentCreditCard", e.RowIndex].Value != null) ccPaymentIndividualId = gvCCPayment["IndividualIdInPaymentCreditCard", e.RowIndex].Value.ToString();
                String ccPaymentIndividualName = String.Empty;
                if (gvCCPayment["IndividualNamePaymentCreditCard", e.RowIndex].Value != null) ccPaymentIndividualName = gvCCPayment["IndividualNamePaymentCreditCard", e.RowIndex].Value.ToString();
                String ccPaymentMedicalBillNo = String.Empty;
                if (gvCCPayment["MedBillNoInPaymentCreditCard", e.RowIndex].Value != null) ccPaymentMedicalBillNo = gvCCPayment["MedBillNoInPaymentCreditCard", e.RowIndex].Value.ToString();
                String ccPaymentSettlementNo = String.Empty;
                if (gvCCPayment["SettlementNoInPaymentCreditCard", e.RowIndex].Value != null) ccPaymentSettlementNo = gvCCPayment["SettlementNoInPaymentCreditCard", e.RowIndex].Value.ToString();
                String ccPaymentMedicalProviderName = String.Empty;
                if (gvCCPayment["MedProviderInPaymentCreditCard", e.RowIndex].Value != null) ccPaymentMedicalProviderName = gvCCPayment["MedProviderInPaymentCreditCard", e.RowIndex].Value.ToString();
                String ccPaymentCreditCardNo = String.Empty;
                if (gvCCPayment["CreditCardNoCreditCardPayment", e.RowIndex].Value != null) ccPaymentCreditCardNo = gvCCPayment["CreditCardNoCreditCardPayment", e.RowIndex].Value.ToString();
                else
                {
                    MessageBox.Show("No credit card is selected.", "Alert");
                    return;
                }
                String ccPaymentMedBillAmount = String.Empty;
                Decimal MedBillAmount = 0;
                Decimal MedBillAmountResult = 0;
                if (gvCCPayment["BillAmountCreditCardPayment", e.RowIndex].Value != null)
                {
                    ccPaymentMedBillAmount = gvCCPayment["BillAmountCreditCardPayment", e.RowIndex].Value.ToString();
                    if (Decimal.TryParse(ccPaymentMedBillAmount, NumberStyles.Currency, new CultureInfo("en-US"), out MedBillAmountResult))
                    {
                        MedBillAmount = MedBillAmountResult;
                    }
                    else
                    {
                        MessageBox.Show("Medical bill amount is invalid.", "Error");
                        return;
                    }
                }

                String ccPaymentSettlementPaymentAmount = String.Empty;
                Decimal SettlementPaymentAmount = 0;
                Decimal SettlementPaymentResult = 0;
                if (gvCCPayment["AmountInPaymentCreditCard", e.RowIndex].Value != null)
                {
                    ccPaymentSettlementPaymentAmount = gvCCPayment["AmountInPaymentCreditCard", e.RowIndex].Value.ToString();
                    if (Decimal.TryParse(ccPaymentSettlementPaymentAmount, NumberStyles.Currency, new CultureInfo("en-US"), out SettlementPaymentResult))
                    {
                        SettlementPaymentAmount = SettlementPaymentResult;
                    }
                    else
                    {
                        MessageBox.Show("Settlement payment amount is invalid.", "Error");
                        return;
                    }
                }

                Decimal SettlementAmountForComparison = 0;
                String strSqlQueryForSettlementAmountForComparison = "select [dbo].[tbl_settlement].[Amount] from [dbo].[tbl_settlement] where [dbo].[tbl_settlement].[Name] = @SettlementNo";

                SqlCommand cmdQueryForSettlementAmountForComparison = new SqlCommand(strSqlQueryForSettlementAmountForComparison, connRN5);
                cmdQueryForSettlementAmountForComparison.CommandType = CommandType.Text;

                cmdQueryForSettlementAmountForComparison.Parameters.AddWithValue("@SettlementNo", ccPaymentSettlementNo);

                if (connRN5.State != ConnectionState.Closed)
                {
                    connRN5.Close();
                    connRN5.Open();
                }
                else if (connRN5.State == ConnectionState.Closed) connRN5.Open();

                Object objSettlementAmountForComparison = cmdQueryForSettlementAmountForComparison.ExecuteScalar();
                if (objSettlementAmountForComparison != null) SettlementAmountForComparison = Decimal.Parse(objSettlementAmountForComparison.ToString());
                if (connRN5.State == ConnectionState.Open) connRN5.Close();

                String ccPaymentSettlementNotes = gvCCPayment["CreditCardPaymentNote", e.RowIndex].Value.ToString();

                frmConfirmCCPaymentDlg dlgConfirmation = new frmConfirmCCPaymentDlg(ccPaymentIndividualId,
                                                                                ccPaymentIndividualName,
                                                                                ccPaymentMedicalProviderName,
                                                                                ccPaymentMedicalBillNo,
                                                                                ccPaymentSettlementNo,
                                                                                ccPaymentCreditCardNo,
                                                                                MedBillAmount,
                                                                                SettlementAmountForComparison,
                                                                                SettlementPaymentAmount,
                                                                                ccPaymentSettlementNotes);
                DialogResult dlgResult = dlgConfirmation.ShowDialog();
                String SettlementNote = dlgConfirmation.Note;

                if (dlgResult == DialogResult.Yes)
                {
                    if (SettlementAmountForComparison == SettlementPaymentAmount)
                    {
                        String strSqlUpdateSettlementForPayment = "update [dbo].[tbl_settlement] set [dbo].[tbl_settlement].[Notes] = @PaymentNotes, " +
                                                                  "[dbo].[tbl_settlement].[IsPaid] = @PaymentConfirmed, [dbo].[tbl_settlement].[PaidByID] = @PaidBy, " +
                                                                  "[dbo].[tbl_settlement].[CMMCreditCard] = @CreditCardId, [dbo].[tbl_settlement].[CMMCreditCardPaidDate] = @CCPaidDate " +
                                                                  "where [dbo].[tbl_settlement].[Name] = @SettlementNo";

                        SqlCommand cmdUpdateSettlementForPayment = new SqlCommand(strSqlUpdateSettlementForPayment, connRN5);
                        cmdUpdateSettlementForPayment.CommandType = CommandType.Text;

                        cmdUpdateSettlementForPayment.Parameters.AddWithValue("@PaymentNotes", SettlementNote);
                        cmdUpdateSettlementForPayment.Parameters.AddWithValue("@PaymentConfirmed", 1);
                        cmdUpdateSettlementForPayment.Parameters.AddWithValue("@PaidBy", nLoggedUserId);
                        int? nCreditCardId = null;
                        foreach (CreditCardInfo info in lstCreditCardInfo)
                        {
                            String CreditCardNo = String.Empty;
                            if (gvCCPayment["CreditCardNoCreditCardPayment", e.RowIndex].Value != null) CreditCardNo = gvCCPayment["CreditCardNoCreditCardPayment", e.RowIndex].Value.ToString();
                            if (info.CreditCardNo == CreditCardNo)
                            {
                                nCreditCardId = info.CreditCardId;
                            }
                        }
                        cmdUpdateSettlementForPayment.Parameters.AddWithValue("@CreditCardId", nCreditCardId);
                        cmdUpdateSettlementForPayment.Parameters.AddWithValue("@CCPaidDate", DateTime.Today);
                        cmdUpdateSettlementForPayment.Parameters.AddWithValue("@SettlementNo", ccPaymentSettlementNo);


                        if (connRN5.State != ConnectionState.Closed)
                        {
                            connRN5.Close();
                            connRN5.Open();
                        }
                        else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                        int nRowAffected = cmdUpdateSettlementForPayment.ExecuteNonQuery();
                        if (connRN5.State == ConnectionState.Open) connRN5.Close();

                        if (nRowAffected == 1)
                        {
                            MessageBox.Show("The payment has been confirmed.", "Info");
                            return;
                        }
                        else if (nRowAffected == 0)
                        {
                            MessageBox.Show("The payment has not been confirmed.", "Info");
                            return;
                        }
                    }
                    else if (SettlementAmountForComparison > SettlementPaymentAmount)
                    {
                        // update settlement for extra discount from medical provider
                        String strSqlUpdateSettlementForModifiedPayment = "update [dbo].[tbl_settlement] set [dbo].[tbl_settlement].[Notes] = @PaymentNotes, " +
                                                                          "[dbo].[tbl_settlement].[IsPaid] = @PaymentConfirmed, [dbo].[tbl_settlement].[PaidByID] = @PaidBy, " +
                                                                          "[dbo].[tbl_settlement].[CMMCreditCard] = @CreditCardId, [dbo].[tbl_settlement].[CMMCreditCardPaidDate] = @CCPaidDate " +
                                                                          "[dbo].[tbl_settlement].[Amount] = @SettlementAmount " +
                                                                          "where [dbo].[tbl_settlement].[Name] = @SettlementNo";

                        SqlCommand cmdUpdateSettlementForModifiedPayment = new SqlCommand(strSqlUpdateSettlementForModifiedPayment, connRN5);
                        cmdUpdateSettlementForModifiedPayment.CommandType = CommandType.Text;

                        cmdUpdateSettlementForModifiedPayment.Parameters.AddWithValue("@PaymentNotes", SettlementNote);
                        cmdUpdateSettlementForModifiedPayment.Parameters.AddWithValue("@PaymentConfirmed", 1);
                        cmdUpdateSettlementForModifiedPayment.Parameters.AddWithValue("@PaidBy", nLoggedUserId);
                        int? nCreditCardId = null;
                        foreach (CreditCardInfo info in lstCreditCardInfo)
                        {
                            String CreditCardNo = String.Empty;
                            if (gvCCPayment["CreditCardNoCreditCardPayment", e.RowIndex].Value != null) CreditCardNo = gvCCPayment["CreditCardNoCreditCardPayment", e.RowIndex].Value.ToString();
                            if (info.CreditCardNo == CreditCardNo)
                            {
                                nCreditCardId = info.CreditCardId;
                            }
                        }
                        cmdUpdateSettlementForModifiedPayment.Parameters.AddWithValue("@CreditCardId", nCreditCardId);
                        cmdUpdateSettlementForModifiedPayment.Parameters.AddWithValue("@CCPaidDate", DateTime.Today);
                        cmdUpdateSettlementForModifiedPayment.Parameters.AddWithValue("@SettlementAmount", SettlementPaymentAmount);
                        cmdUpdateSettlementForModifiedPayment.Parameters.AddWithValue("@SettlementNo", ccPaymentSettlementNo);

                        if (connRN5.State != ConnectionState.Closed)
                        {
                            connRN5.Close();
                            connRN5.Open();
                        }
                        else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                        int nSettlementUpdated = cmdUpdateSettlementForModifiedPayment.ExecuteNonQuery();
                        if (connRN5.State == ConnectionState.Open) connRN5.Close();

                        // insert into new discount settlement for the difference when medical provider gives member extra discount
                        String strSqlQueryForLastSettlementNo = "select max([dbo].[tbl_settlement].[Name]) from [dbo].[tbl_settlement]";

                        SqlCommand cmdQueryForLastSettlementNo = new SqlCommand(strSqlQueryForLastSettlementNo, connRN5);
                        cmdQueryForLastSettlementNo.CommandType = CommandType.Text;

                        if (connRN5.State != ConnectionState.Closed)
                        {
                            connRN5.Close();
                            connRN5.Open();
                        }
                        else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                        Object objMaxSettlementNo = cmdQueryForLastSettlementNo.ExecuteScalar();
                        if (connRN5.State == ConnectionState.Open) connRN5.Close();
                        String MaxSettlementNo = String.Empty;
                        if (objMaxSettlementNo != null) MaxSettlementNo = objMaxSettlementNo.ToString();

                        String MaxSettlementNumber = MaxSettlementNo.Substring(5);
                        int nMaxSettlementNo = Int32.Parse(MaxSettlementNumber);
                        nMaxSettlementNo++;
                        String NewSettlementNo = "STLM-";
                        NewSettlementNo += nMaxSettlementNo.ToString();

                        Decimal SettlementAmount = SettlementAmountForComparison - SettlementPaymentAmount;
                        String Notes = "Member Discount Settlement added by the application";
                        //ccPaymentMedicalBillNo
                        String strSqlInsertMemberDiscountSettlement = "insert into [dbo].[tbl_settlement] (IsDeleted, Name, CreateDate, CreateByID, LastModifiedDate, LastModifiedByID, " +
                                                                      "SystemModifiedStamp, LastActivityDate, LastViewedDate, MedicalBillID, SettlementType, " +
                                                                      "Amount, PersonalResponsibilityCredit, CMMPaymentMethod, CMMCreditCard ,Notes) " +
                                                                      "values (0, @NewSettlementNo, @CreateDate, @CreateByID, @ModifiedDate, @LastModifiedByID, " +
                                                                      "@SystemModifiedDate, @LastActivityDate, @LastViewedDate, @MedicalBillId, @SettlementType, " +
                                                                      "@SettlementAmount, @PersonalResponsibility, @CMMPaymentMethod, @CMMCreditCard, @Notes)";

                        SqlCommand cmdInsertMemberDiscountSettlement = new SqlCommand(strSqlInsertMemberDiscountSettlement, connRN5);
                        cmdInsertMemberDiscountSettlement.CommandType = CommandType.Text;

                        cmdInsertMemberDiscountSettlement.Parameters.AddWithValue("@NewSettlementNo", NewSettlementNo);
                        cmdInsertMemberDiscountSettlement.Parameters.AddWithValue("@CreateDate", DateTime.Today);
                        cmdInsertMemberDiscountSettlement.Parameters.AddWithValue("@CreateByID", nLoggedUserId);
                        cmdInsertMemberDiscountSettlement.Parameters.AddWithValue("@ModifiedDate", DateTime.Today);
                        cmdInsertMemberDiscountSettlement.Parameters.AddWithValue("@LastModifiedByID", nLoggedUserId);
                        cmdInsertMemberDiscountSettlement.Parameters.AddWithValue("@SystemModifiedDate", DateTime.Today);
                        cmdInsertMemberDiscountSettlement.Parameters.AddWithValue("@LastActivityDate", DateTime.Today);
                        cmdInsertMemberDiscountSettlement.Parameters.AddWithValue("@LastViewedDate", DateTime.Today);
                        cmdInsertMemberDiscountSettlement.Parameters.AddWithValue("@MedicalBillID", ccPaymentMedicalBillNo);
                        cmdInsertMemberDiscountSettlement.Parameters.AddWithValue("@SettlementType", SettlementType.MemberDiscount);
                        cmdInsertMemberDiscountSettlement.Parameters.AddWithValue("@SettlementAmount", SettlementAmount);
                        cmdInsertMemberDiscountSettlement.Parameters.AddWithValue("@PersonalResponsibility", SettlementAmount);
                        cmdInsertMemberDiscountSettlement.Parameters.AddWithValue("@CMMPaymentMethod", 0);
                        cmdInsertMemberDiscountSettlement.Parameters.AddWithValue("@CMMCreditCard", 0);
                        cmdInsertMemberDiscountSettlement.Parameters.AddWithValue("@Notes", Notes);

                        if (connRN5.State != ConnectionState.Closed)
                        {
                            connRN5.Close();
                            connRN5.Open();
                        }
                        else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                        int nSettlementInserted = cmdInsertMemberDiscountSettlement.ExecuteNonQuery();
                        if (connRN5.State == ConnectionState.Open) connRN5.Close();

                        // 02/06/19 - begin here to calculate Medical Bill Balance, PR Balance and update Medbill accordingly
                        //ccPaymentMedicalBillNo
                        String strSqlQueryForMedBillAmount = "select [dbo].[tbl_medbill].[BillAmount] from [dbo].[tbl_medbill] where [dbo].[tbl_medbill].[BillNo] = @MedBillNo";

                        SqlCommand cmdQueryForMedBillAmount = new SqlCommand(strSqlQueryForMedBillAmount, connRN5);
                        cmdQueryForMedBillAmount.CommandType = CommandType.Text;

                        cmdQueryForMedBillAmount.Parameters.AddWithValue("@MedBillNo", ccPaymentMedicalBillNo);

                        if (connRN5.State != ConnectionState.Closed)
                        {
                            connRN5.Close();
                            connRN5.Open();
                        }
                        else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                        Object objBillAmount = cmdQueryForMedBillAmount.ExecuteScalar();
                        if (connRN5.State == ConnectionState.Open) connRN5.Close();

                        Decimal MedicalBillAmount = 0;
                        if (objBillAmount != null) MedicalBillAmount = Decimal.Parse(objBillAmount.ToString());

                        String strSqlQueryForSettlementSum = "select sum([dbo].[tbl_settlement].[Amount]) from [dbo].[tbl_settlement] " +
                                                             "where [dbo].[tbl_settlement].[MedicalBillID] = @MedicalBillNo and " +
                                                             "([dbo].[tbl_settlement].[SettlementType] = 1 or " +
                                                             "[dbo].[tbl_settlement].[SettlementType] = 2 or " +
                                                             "[dbo].[tbl_settlement].[SettlementType] = 3 or " +
                                                             "[dbo].[tbl_settlement].[SettlementType] = 4 or " +
                                                             "[dbo].[tbl_settlement].[SettlementType] = 5 or " +
                                                             "[dbo].[tbl_settlement].[SettlementType] = 6 or " +
                                                             "[dbo].[tbl_settlement].[SettlementType] = 7 or " +
                                                             "[dbo].[tbl_settlement].[SettlementType] = 9 or " +
                                                             "[dbo].[tbl_settlement].[SettlementType] = 10)";

                        SqlCommand cmdQueryForSettlementSum = new SqlCommand(strSqlQueryForSettlementSum, connRN5);
                        cmdQueryForSettlementSum.CommandType = CommandType.Text;

                        cmdQueryForSettlementSum.Parameters.AddWithValue("@MedicalBillNo", ccPaymentMedicalBillNo);

                        if (connRN5.State != ConnectionState.Closed)
                        {
                            connRN5.Close();
                            connRN5.Open();
                        }
                        else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                        Object objSettlementSum = cmdQueryForSettlementSum.ExecuteScalar();
                        if (connRN5.State == ConnectionState.Open) connRN5.Close();

                        Decimal SettlementSum = 0;
                        if (objSettlementSum != null) SettlementSum = Decimal.Parse(objSettlementSum.ToString());

                        String strSqlQueryForMedProviderRefund = "select sum([dbo].[tbl_settlement].[Amount]) from [dbo].[tbl_settlement] " +
                                                                 "where [dbo].[tbl_settlement].[MedicalBillID] = @MedicalBillNo and " +
                                                                 "[dbo].[tbl_settlement].[SettlementType] = 8";

                        SqlCommand cmdQueryForMedProviderRefund = new SqlCommand(strSqlQueryForMedProviderRefund, connRN5);
                        cmdQueryForMedProviderRefund.CommandType = CommandType.Text;

                        cmdQueryForMedProviderRefund.Parameters.AddWithValue("@MedicalBillNo", ccPaymentMedicalBillNo);


                        if (connRN5.State != ConnectionState.Closed)
                        {
                            connRN5.Close();
                            connRN5.Open();
                        }
                        else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                        Object objMedProviderRefund = cmdQueryForMedProviderRefund.ExecuteScalar();
                        if (connRN5.State == ConnectionState.Open) connRN5.Close();

                        Decimal MedProviderRefund = 0;
                        if (objMedProviderRefund != null) MedProviderRefund = Decimal.Parse(objMedProviderRefund.ToString());

                        Decimal MedBillBalance = MedicalBillAmount - SettlementSum + MedProviderRefund;

                        String strSqlUpdateMedBillBalance = "update [dbo].[tbl_medbill] set [dbo].[tbl_medbill].[Balance] = @UpdatedMedBillBalance " +
                                                            "where [dbo].[tbl_medbill].[BillNo] = @MedBillNo";

                        SqlCommand cmdUpdateMedBillBalance = new SqlCommand(strSqlUpdateMedBillBalance, connRN5);
                        cmdUpdateMedBillBalance.CommandType = CommandType.Text;

                        cmdUpdateMedBillBalance.Parameters.AddWithValue("@UpdatedMedBillBalance", MedBillBalance);
                        cmdUpdateMedBillBalance.Parameters.AddWithValue("@MedBillNo", ccPaymentMedicalBillNo);

                        if (connRN5.State != ConnectionState.Closed)
                        {
                            connRN5.Close();
                            connRN5.Open();
                        }
                        else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                        int nUpdatedMedBill = cmdUpdateMedBillBalance.ExecuteNonQuery();
                        if (connRN5.State == ConnectionState.Open) connRN5.Close();


                        //MedBillBalance -= SettlementAmount;

                        //String strSqlUpdateMedBillBalance = "update [dbo].[tbl_medbill] set [dbo].[tbl_medbill].[Balance] = @NewBalance where [dbo].[tbl_medbill].[BillNo] = @MedBillNo";

                        //SqlCommand cmdUpdateMedBillBalance = new SqlCommand(strSqlUpdateMedBillBalance, connRN5);
                        //cmdUpdateMedBillBalance.CommandType = CommandType.Text;

                        //cmdUpdateMedBillBalance.Parameters.AddWithValue("@NewBalance", MedBillBalance);
                        //cmdUpdateMedBillBalance.Parameters.AddWithValue("@MedBillNo", ccPaymentMedicalBillNo);

                        //if (connRN5.State != ConnectionState.Closed)
                        //{
                        //    connRN5.Close();
                        //    connRN5.Open();
                        //}
                        //else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                        //int nMedBillUpdated = cmdUpdateMedBillBalance.ExecuteNonQuery();
                        //if (connRN5.State == ConnectionState.Open) connRN5.Close();

                        if (nSettlementUpdated == 1 && nSettlementInserted == 1)
                        {
                            MessageBox.Show("The payment has been confirmed.", "Info");
                            return;
                        }
                        else
                        {
                            MessageBox.Show("The payment has not been confirmed.", "Error");
                            return;
                        }
                    }

                    // Save the settlement payment
                    //String SettlementNo = gvCCPayment["SettlementNoInPaymentCreditCard", e.RowIndex].Value.ToString();
                    //String strPaymentAmount = gvCCPayment["AmountInPaymentCreditCard", e.RowIndex].Value.ToString();
                    //String strSettlementNotes = gvCCPayment["CreditCardPaymentNote", e.RowIndex].Value.ToString();
                    //String IndividualId = gvCCPayment["IndividualIdInPaymentCreditCard", e.RowIndex].Value.ToString();
                    //Decimal AmountResult = 0;
                    //Decimal PaymentAmount = 0;
                    //if (Decimal.TryParse(strPaymentAmount.Trim(), NumberStyles.Currency, new CultureInfo("en-US"), out AmountResult))
                    //{
                    //    PaymentAmount = AmountResult;
                    //}
                    //else
                    //{
                    //    MessageBox.Show("Payment amount is invalid.", "Error");
                    //    return;
                    //}

                    //String strSqlQueryForSettlementAmount = "select [dbo].[tbl_settlement].[Amount] from [dbo].[tbl_settlement] where [dbo].[tbl_settlement].[Name] = @SettlementNo";

                    //SqlCommand cmdQueryForSettlementAmount = new SqlCommand(strSqlQueryForSettlementAmount, connRN5);
                    //cmdQueryForSettlementAmount.CommandType = CommandType.Text;

                    //cmdQueryForSettlementAmount.Parameters.AddWithValue("@SettlementNo", SettlementNo);

                    //if (connRN5.State != ConnectionState.Closed)
                    //{
                    //    connRN5.Close();
                    //    connRN5.Open();
                    //}
                    //else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                    //Object objSettlementAmount = cmdQueryForSettlementAmount.ExecuteScalar();
                    //Decimal SettlementAmount = 0;
                    //if (objSettlementAmount != null) SettlementAmount = Decimal.Parse(objSettlementAmount.ToString());
                    //if (connRN5.State == ConnectionState.Open) connRN5.Close();

                    //if (PaymentAmount == SettlementAmount)
                    //{
                    //    String strSqlUpdateSettlementForPayment = "update [dbo].[tbl_settlement] set [dbo].[tbl_settlement].[Notes] = @PaymentNotes, " +
                    //                                              "[dbo].[tbl_settlement].[IsPaid] = @PaymentConfirmed, " +
                    //                                              "[dbo].[tbl_settlement].[PaidByID] = @PaidBy " +
                    //                                              "where [dbo].[tbl_settlement].[Name] = @SettlementName";

                    //    SqlCommand cmdUpdateSettlementForPayment = new SqlCommand(strSqlUpdateSettlementForPayment, connRN5);
                    //    cmdUpdateSettlementForPayment.CommandType = CommandType.Text;

                    //    //cmdUpdateSettlementForPayment.Parameters.AddWithValue("@PaymentAmount", PaymentAmount);
                    //    cmdUpdateSettlementForPayment.Parameters.AddWithValue("@PaymentNotes", strSettlementNotes);
                    //    cmdUpdateSettlementForPayment.Parameters.AddWithValue("@PaymentConfirmed", 1);
                    //    cmdUpdateSettlementForPayment.Parameters.AddWithValue("@PaidBy", nLoggedUserId);
                    //    cmdUpdateSettlementForPayment.Parameters.AddWithValue("@SettlementName", SettlementNo);

                    //    if (connRN5.State != ConnectionState.Closed)
                    //    {
                    //        connRN5.Close();
                    //        connRN5.Open();
                    //    }
                    //    else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                    //    int nSettlementUpdated = cmdUpdateSettlementForPayment.ExecuteNonQuery();
                    //    if (connRN5.State == ConnectionState.Open) connRN5.Close();
                    //}
                    //else
                    //{
                    //    String strSqlUpdateSettlementAmountForPayment = "update [dbo].[tbl_settlement] set [dbo].[tbl_settlement].[Amount] = @AmountPaid, " +
                    //                                                    "[dbo].[tbl_settlement].[Notes] = @PaymentNotes, " +
                    //                                                    "[dbo].[tbl_settlement].[IsPaid] = @PaymentConfirmed, " +
                    //                                                    "[dbo].[tbl_settlement].[PaidByID] = @PaidBy " +
                    //                                                    "where [dbo].[tbl_settlement].[Name] = @SettlementName";

                    //    SqlCommand cmdUpdateSettlementAmountForPayment = new SqlCommand(strSqlUpdateSettlementAmountForPayment, connRN5);
                    //    cmdUpdateSettlementAmountForPayment.CommandType = CommandType.Text;

                    //    cmdUpdateSettlementAmountForPayment.Parameters.AddWithValue("@AmountPaid", PaymentAmount);
                    //    cmdUpdateSettlementAmountForPayment.Parameters.AddWithValue("@PaymentNotes", strSettlementNotes);
                    //    cmdUpdateSettlementAmountForPayment.Parameters.AddWithValue("@PaymentConfirmed", 1);
                    //    cmdUpdateSettlementAmountForPayment.Parameters.AddWithValue("@PaidBy", nLoggedUserId);
                    //    cmdUpdateSettlementAmountForPayment.Parameters.AddWithValue("@SettlementName", SettlementNo);

                    //    if (connRN5.State != ConnectionState.Closed)
                    //    {
                    //        connRN5.Close();
                    //        connRN5.Open();
                    //    }
                    //    else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                    //    int nRowSettlementUpdated = cmdUpdateSettlementAmountForPayment.ExecuteNonQuery();
                    //    if (connRN5.State == ConnectionState.Open) connRN5.Close();

                    //    String strSqlQueryForMedBillNoForSettlement = "select [dbo].[tbl_settlement].[MedicalBillID] from [dbo].[tbl_settlement] " +
                    //                                                  "where [dbo].[tbl_settlement].[Name] = @SettlementName";

                    //    SqlCommand cmdQueryForMedBillIDForSettlement = new SqlCommand(strSqlQueryForMedBillNoForSettlement, connRN5);
                    //    cmdQueryForMedBillIDForSettlement.CommandType = CommandType.Text;

                    //    cmdQueryForMedBillIDForSettlement.Parameters.AddWithValue("@SettlementName", SettlementNo);

                    //    if (connRN5.State != ConnectionState.Closed)
                    //    {
                    //        connRN5.Close();
                    //        connRN5.Open();
                    //    }
                    //    else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                    //    Object objMedBillID = cmdQueryForMedBillIDForSettlement.ExecuteScalar();
                    //    String MedBillIDForSettlement = String.Empty;
                    //    if (objMedBillID != null) MedBillIDForSettlement = objMedBillID.ToString();
                    //    if (connRN5.State == ConnectionState.Open) connRN5.Close();

                    //    String strSqlQueryForTotalSharedAmountForMedBill = "select sum([dbo].[tbl_settlement].[Amount]) from [dbo].[tbl_settlement] " +
                    //                                                       "where [dbo].[tbl_settlement].[IsDeleted] = 0 and " +
                    //                                                       "[dbo].[tbl_settlement].[MedicalBillID] = @MedBillID and " +
                    //                                                       "([dbo].[tbl_settlement].[SettlementType] = 4 or " +
                    //                                                       "[dbo].[tbl_settlement].[SettlementType] = 6 or " +
                    //                                                       "[dbo].[tbl_settlement].[SettlementType] = 9)";

                    //    SqlCommand cmdQueryForTotalSharedAmountForMedBill = new SqlCommand(strSqlQueryForTotalSharedAmountForMedBill, connRN5);
                    //    cmdQueryForTotalSharedAmountForMedBill.CommandType = CommandType.Text;

                    //    cmdQueryForTotalSharedAmountForMedBill.Parameters.AddWithValue("@MedBillID", MedBillIDForSettlement);

                    //    if (connRN5.State != ConnectionState.Closed)
                    //    {
                    //        connRN5.Close();
                    //        connRN5.Open();
                    //    }
                    //    else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                    //    Object objTotalSharedAmount = cmdQueryForTotalSharedAmountForMedBill.ExecuteScalar();
                    //    if (connRN5.State == ConnectionState.Open) connRN5.Close();
                    //    Decimal TotalSharedAmount = 0;
                    //    if (objTotalSharedAmount != null) TotalSharedAmount = Decimal.Parse(objTotalSharedAmount.ToString());

                    //    String strSqlQueryForMedicalProviderRefund = "select sum([dbo].[tbl_settlement].[Amount]) from [dbo].[tbl_settlement] " +
                    //                                                 "where [dbo].[tbl_settlement].[IsDeleted] = 0 and " +
                    //                                                 "[dbo].[tbl_settlement].[MedicalBillID] = @MedBillID and " +
                    //                                                 "[dbo].[tbl_settlement].[SettlementType] = 8";

                    //    SqlCommand cmdQeuryForMedicalProviderRefund = new SqlCommand(strSqlQueryForMedicalProviderRefund, connRN5);
                    //    cmdQeuryForMedicalProviderRefund.CommandType = CommandType.Text;

                    //    cmdQeuryForMedicalProviderRefund.Parameters.AddWithValue("@MedBillID", MedBillIDForSettlement);

                    //    if (connRN5.State != ConnectionState.Closed)
                    //    {
                    //        connRN5.Close();
                    //        connRN5.Open();
                    //    }
                    //    else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                    //    Object objMedProviderRefund = cmdQeuryForMedicalProviderRefund.ExecuteScalar();
                    //    Decimal MedProviderRefund = 0;
                    //    if (objMedProviderRefund != null) MedProviderRefund = Decimal.Parse(objMedProviderRefund.ToString());

                    //    TotalSharedAmount -= MedProviderRefund;

                    //    String strSqlUpdateMedBillForNewSTotalSharedAmount = "update [dbo].[tbl_medbill] set [dbo].[tbl_medbill].[TotalSharedAmount] = @TotalSharedAmount " +
                    //                                                         "where [dbo].[tbl_medbill].[BillNo] = @MedBillID";

                    //    SqlCommand cmdUpdateMedBillForNewTotalSharedAmount = new SqlCommand(strSqlUpdateMedBillForNewSTotalSharedAmount, connRN5);
                    //    cmdUpdateMedBillForNewTotalSharedAmount.CommandType = CommandType.Text;

                    //    cmdUpdateMedBillForNewTotalSharedAmount.Parameters.AddWithValue("@TotalSharedAmount", TotalSharedAmount);
                    //    cmdUpdateMedBillForNewTotalSharedAmount.Parameters.AddWithValue("@MedBillID", MedBillIDForSettlement);

                    //    if (connRN5.State != ConnectionState.Closed)
                    //    {
                    //        connRN5.Close();
                    //        connRN5.Open();
                    //    }
                    //    else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                    //    int nRowMedBillUpdated = cmdUpdateMedBillForNewTotalSharedAmount.ExecuteNonQuery();
                    //    if (connRN5.State == ConnectionState.Open) connRN5.Close();

                    //    String strSqlQueryForIncidentIdForMedBill = "select [dbo].[tbl_medbill].[Incident_Id] from [dbo].[tbl_medbill] " +
                    //                                                "where [dbo].[tbl_medbill].[BillNo] = @MedBillID";

                    //    SqlCommand cmdQueryForIncidentIdForMedBill = new SqlCommand(strSqlQueryForIncidentIdForMedBill, connRN5);
                    //    cmdQueryForIncidentIdForMedBill.CommandType = CommandType.Text;

                    //    cmdQueryForIncidentIdForMedBill.Parameters.AddWithValue("@MedBillID", MedBillIDForSettlement);

                    //    if (connRN5.State != ConnectionState.Closed)
                    //    {
                    //        connRN5.Close();
                    //        connRN5.Open();
                    //    }
                    //    else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                    //    Object objIncidentId = cmdQueryForIncidentIdForMedBill.ExecuteScalar();
                    //    String IncidentId = String.Empty;
                    //    if (objIncidentId != null) IncidentId = objIncidentId.ToString();
                    //    if (connRN5.State == ConnectionState.Open) connRN5.Close();

                    //    // 01/25/19 begin here to add tbl_medbill.IsDeleted = 0 to where clause
                    //    String strSqlQueryForIncidentSharedTotal = "select sum([dbo].[tbl_medbill].[TotalSharedAmount]) from [dbo].[tbl_medbill] " +
                    //                                               "where [dbo].[tbl_medbill].[Incident_Id] = @IncidentId";

                    //    SqlCommand cmdQueryForIncidentSharedTotal = new SqlCommand(strSqlQueryForIncidentSharedTotal, connRN5);
                    //    cmdQueryForIncidentSharedTotal.Parameters.AddWithValue("@IncidentId", IncidentId);

                    //    if (connRN5.State != ConnectionState.Closed)
                    //    {
                    //        connRN5.Close();
                    //        connRN5.Open();
                    //    }
                    //    else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                    //    Object objIncidentTotalSharedAmount = cmdQueryForIncidentSharedTotal.ExecuteScalar();
                    //    if (connRN5.State == ConnectionState.Open) connRN5.Close();

                    //    Decimal IncidentTotalSharedAmount = 0;
                    //    if (objIncidentTotalSharedAmount != null) IncidentTotalSharedAmount = Decimal.Parse(objIncidentTotalSharedAmount.ToString());

                    //    String strSqlUpdateIncidentForTotalSharedAmount = "update [dbo].[tbl_incident] set [dbo].[tbl_incident].[TotalSharedAmount] = @IncidentTotalSharedAmount " +
                    //                                                      "where [dbo].[tbl_incident].[Incidend_id] = @IncidentId";

                    //    SqlCommand cmdUpdateIncidentForTotalSharedAmount = new SqlCommand(strSqlUpdateIncidentForTotalSharedAmount, connRN5);
                    //    cmdUpdateIncidentForTotalSharedAmount.CommandType = CommandType.Text;

                    //    cmdUpdateIncidentForTotalSharedAmount.Parameters.AddWithValue("@IncidentTotalSharedAmount", IncidentTotalSharedAmount);
                    //    cmdUpdateIncidentForTotalSharedAmount.Parameters.AddWithValue("@IncidentId", IncidentId);

                    //    if (connRN5.State != ConnectionState.Closed)
                    //    {
                    //        connRN5.Close();
                    //        connRN5.Open();
                    //    }
                    //    else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                    //    int nRowIncidentUpdated = cmdUpdateIncidentForTotalSharedAmount.ExecuteNonQuery();
                    //    if (connRN5.State == ConnectionState.Open) connRN5.Close();

                    //    String strSqlQueryForIllnessId = "select [dbo].[tbl_incident].[Illness_id] from [dbo].[tbl_incident] where [dbo].[tbl_incident].[Incident_id] = @IncidentId";

                    //    SqlCommand cmdQueryForIllnessId = new SqlCommand(strSqlQueryForIllnessId, connRN5);
                    //    cmdQueryForIllnessId.CommandType = CommandType.Text;

                    //    cmdQueryForIllnessId.Parameters.AddWithValue("@IncidentId", IncidentId);

                    //    if (connRN5.State != ConnectionState.Closed)
                    //    {
                    //        connRN5.Close();
                    //        connRN5.Open();
                    //    }
                    //    else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                    //    Object objIllnessId = cmdQueryForIllnessId.ExecuteScalar();
                    //    if (connRN5.State == ConnectionState.Open) connRN5.Close();
                    //    int nIllnessId = 0;
                    //    if (objIllnessId != null) nIllnessId = Int32.Parse(objIllnessId.ToString());

                    //    String strSqlQueryForIllnessSharedTotal = "select sum([dbo].[tbl_incident].[TotalSharedAmount]) from [dbo].[tbl_incident] " +
                    //                                              "where [dbo].[tbl_incident].[Illness_id] = @IllnessId";

                    //    SqlCommand cmdQueryForIllnessSharedTotal = new SqlCommand(strSqlQueryForIllnessSharedTotal, connRN5);
                    //    cmdQueryForIllnessSharedTotal.CommandType = CommandType.Text;

                    //    cmdQueryForIllnessSharedTotal.Parameters.AddWithValue("@IllnessId", nIllnessId);

                    //    if (connRN5.State != ConnectionState.Closed)
                    //    {
                    //        connRN5.Close();
                    //        connRN5.Open();
                    //    }
                    //    else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                    //    Object objIllnessTotalSharedAmount = cmdQueryForIllnessSharedTotal.ExecuteScalar();
                    //    if (connRN5.State == ConnectionState.Open) connRN5.Close();
                    //    Decimal IllnessTotalSharedAmount = Int32.Parse(objIllnessTotalSharedAmount.ToString());

                    //    String strSqlUpdateIllnessTotalSharedAmount = "update [dbo].[tbl_illness] set [dbo].[tbl_illess].[TotalSharedAmount] = @IllnessTotalSharedAmount " +
                    //                                                 "where [dbo].[tbl_illness].[Illness_Id] = @IllnessId";

                    //    SqlCommand cmdUpdateIllnessTotalSharedAmount = new SqlCommand(strSqlUpdateIllnessTotalSharedAmount, connRN5);
                    //    cmdUpdateIllnessTotalSharedAmount.CommandType = CommandType.Text;

                    //    cmdUpdateIllnessTotalSharedAmount.Parameters.AddWithValue("@IllnessTotalSharedAmount", IllnessTotalSharedAmount);
                    //    cmdUpdateIllnessTotalSharedAmount.Parameters.AddWithValue("@IllnessId", nIllnessId);

                    //    if (connRN5.State != ConnectionState.Closed)
                    //    {
                    //        connRN5.Close();
                    //        connRN5.Open();
                    //    }
                    //    else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                    //    int nRowIllnessUpdated = cmdUpdateIllnessTotalSharedAmount.ExecuteNonQuery();
                    //    if (connRN5.State == ConnectionState.Open) connRN5.Close();

                    //    String strSqlQueryForIndividualID = "select [dbo].[tbl_illness].[Individual_Id] from [dbo].[tbl_illness] where [dbo].[tbl_illness].[Illness_Id] = @IllnessId";

                    //    SqlCommand cmdQueryForIndividualID = new SqlCommand(strSqlQueryForIndividualID, connRN5);
                    //    cmdQueryForIndividualID.Parameters.AddWithValue("@IllnessId", nIllnessId);

                    //    if (connRN5.State != ConnectionState.Closed)
                    //    {
                    //        connRN5.Close();
                    //        connRN5.Open();
                    //    }
                    //    else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                    //    Object objIndividualID = cmdQueryForIndividualID.ExecuteScalar();
                    //    if (connRN5.State == ConnectionState.Open) connRN5.Close();

                    //    String IndividualIdQueried = String.Empty;
                    //    if (objIndividualID != null) IndividualIdQueried = objIndividualID.ToString();

                    //    if (IndividualId.Trim() == IndividualIdQueried.Trim())
                    //    {
                    //        String strSqlQueryForIndividualTotalSharedAmount = "select sum([dbo].[tbl_illness].[TotalSharedAmount]) from [dbo].[tbl_illness] " +
                    //                                                           "where [dbo].[tbl_illness].[Individual_Id] = @IndividualId";

                    //        SqlCommand cmdQueryForIndividualTotalSharedAmount = new SqlCommand(strSqlQueryForIndividualTotalSharedAmount, connRN5);
                    //        cmdQueryForIndividualTotalSharedAmount.CommandType = CommandType.Text;

                    //        cmdQueryForIndividualTotalSharedAmount.Parameters.AddWithValue("@IndividualId", IndividualId);

                    //        if (connRN5.State != ConnectionState.Closed)
                    //        {
                    //            connRN5.Close();
                    //            connRN5.Open();
                    //        }
                    //        else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                    //        Object objIndividualTotalSharedAmount = cmdQueryForIndividualTotalSharedAmount.ExecuteScalar();
                    //        if (connRN5.State == ConnectionState.Open) connRN5.Close();

                    //        Decimal IndividualTotalSharedAmount = 0;
                    //        if (objIndividualTotalSharedAmount != null) IndividualTotalSharedAmount = Decimal.Parse(objIndividualTotalSharedAmount.ToString());

                    //        String strSqlUpdateIndividualTotalSharedAmount = "update [dbo].[contact] set [dbo].[contact].[TotalSharedAmount] = @IndividualTotalSharedAmount " +
                    //                                                         "[dbo].[contact].[Individual_ID__c] = @IndivudalId";

                    //        SqlCommand cmdUpdateIndividualTotalSharedAmount = new SqlCommand(strSqlUpdateIndividualTotalSharedAmount, connSalesforce);
                    //        cmdUpdateIndividualTotalSharedAmount.CommandType = CommandType.Text;

                    //        cmdUpdateIndividualTotalSharedAmount.Parameters.AddWithValue("@IndividualTotalSharedAmount", IndividualTotalSharedAmount);
                    //        cmdUpdateIndividualTotalSharedAmount.Parameters.AddWithValue("@IndividualId", IndividualId);

                    //        if (connSalesforce.State != ConnectionState.Closed)
                    //        {
                    //            connSalesforce.Close();
                    //            connSalesforce.Open();
                    //        }
                    //        else if (connSalesforce.State == ConnectionState.Closed) connSalesforce.Open();
                    //        int nRowIndividualUpdated = cmdUpdateIndividualTotalSharedAmount.ExecuteNonQuery();
                    //        if (connSalesforce.State == ConnectionState.Open) connSalesforce.Close();


                    //    }
                    //}
                }
                else if (dlgResult == DialogResult.Cancel) return;      // The user choose to cancel. return to credit card payment tab

            }
        }

        private void gvPaymentCreditCard_CellDoubleClick(object sender, DataGridViewCellEventArgs e)
        {
            if (e.RowIndex <= -1) return;

            DataGridView gvCCPayment = sender as DataGridView;
            if (e.ColumnIndex == 20)
            {
                String SettlementNo = gvCCPayment["SettlementNoInPaymentCreditCard", e.RowIndex].Value.ToString();
                String SettlementNote = String.Empty;
                if (gvCCPayment["CreditCardPaymentNote", e.RowIndex]?.Value != null) SettlementNote = gvCCPayment["CreditCardPaymentNote", e.RowIndex].Value.ToString();

                frmSettlementNote frmNote = new frmSettlementNote(SettlementNo, SettlementNote);

                DialogResult dlgResult = frmNote.ShowDialog();

                if (dlgResult == DialogResult.OK)
                {
                    // Save the Settlement Note
                    String strSettlementNo = frmNote.SettlementNo;
                    String strSettlementNote = frmNote.SettlementNote;

                    String strSqlUpdateSettlementNote = "update [dbo].[tbl_settlement] set [dbo].[tbl_settlement].[Notes] = @Notes where [dbo].[tbl_settlement].[Name] = @SettlementNo";

                    SqlCommand cmdUpdateSettlementNote = new SqlCommand(strSqlUpdateSettlementNote, connRN5);
                    cmdUpdateSettlementNote.CommandType = CommandType.Text;

                    cmdUpdateSettlementNote.Parameters.AddWithValue("@Notes", strSettlementNote);
                    cmdUpdateSettlementNote.Parameters.AddWithValue("@SettlementNo", strSettlementNo);

                    if (connRN5.State != ConnectionState.Closed)
                    {
                        connRN5.Close();
                        connRN5.Open();
                    }
                    else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                    int nRowUpdated = cmdUpdateSettlementNote.ExecuteNonQuery();
                    if (nRowUpdated == 1) MessageBox.Show("The Settlement Note has been saved.", "Info");
                    else MessageBox.Show("The Settlement Note has not been saved.", "Error");
                    if (connRN5.State == ConnectionState.Open) connRN5.Close();

                }
                else return;
            }
        }

        private void gvPaymentACH_ColumnHeaderMouseDoubleClick(object sender, DataGridViewCellMouseEventArgs e)
        {

            Boolean bAllACHSelected = true;

            if (e.ColumnIndex == 0)
            {
                for (int i = 0; i < gvPaymentACH.Rows.Count; i++)
                {
                    if (Boolean.Parse(gvPaymentACH["SelectedACHPayment", i].Value.ToString()) == false) bAllACHSelected = false;
                }
                if (bAllACHSelected == false)
                {
                    for (int i = 0; i < gvPaymentACH.Rows.Count; i++)
                    {
                        gvPaymentACH["SelectedACHPayment", i].Value = true;
                    }
                }
                else if (bAllACHSelected == true)
                {
                    for (int i = 0; i < gvPaymentACH.Rows.Count; i++)
                    {
                        gvPaymentACH["SelectedACHPayment", i].Value = false;
                    }
                }
            }
        }

        private void gvPaymentCheckMemberReimbursement_ColumnHeaderMouseDoubleClick(object sender, DataGridViewCellMouseEventArgs e)
        {
            Boolean bAllCheckPaymentSelected = true;

            if (e.ColumnIndex == 0)
            {
                for (int i = 0; i < gvPaymentCheckMemberReimbursement.Rows.Count; i++)
                {
                    if (Boolean.Parse(gvPaymentCheckMemberReimbursement["SelectedPaymentCheck", i].Value.ToString()) == false) bAllCheckPaymentSelected = false;
                }

                if (bAllCheckPaymentSelected == false)
                {
                    for (int i = 0; i < gvPaymentCheckMemberReimbursement.Rows.Count; i++)
                    {
                        gvPaymentCheckMemberReimbursement["SelectedPaymentCheck", i].Value = true;
                    }
                }
                else if (bAllCheckPaymentSelected == true)
                {
                    for (int i = 0; i < gvPaymentCheckMemberReimbursement.Rows.Count; i++)
                    {
                        gvPaymentCheckMemberReimbursement["SelectedPaymentCheck", i].Value = false;
                    }
                }
            }
        }

        private void cbReimbursementMethod_SelectedIndexChanged(object sender, EventArgs e)
        {
            if (cbReimbursementMethod.SelectedIndex == 0)
            {
                txtBankName.Text = String.Empty;
                txtBankName.ReadOnly = true;
                txtBankRoutingNo.Text = String.Empty;
                txtBankRoutingNo.ReadOnly = true;
                txtAccountNo.Text = String.Empty;
                txtAccountNo.ReadOnly = true;
                txtAccountHolder.Text = String.Empty;
                txtAccountHolder.ReadOnly = true;
            }
            else if (cbReimbursementMethod.SelectedIndex == 1)
            {
                txtBankName.ReadOnly = false;
                if (IndividualBankInfo.BankName != String.Empty) txtBankName.Text = IndividualBankInfo.BankName;
                txtBankRoutingNo.ReadOnly = false;
                if (IndividualBankInfo.BankRoutingNumber != String.Empty) txtBankRoutingNo.Text = IndividualBankInfo.BankRoutingNumber;
                txtAccountNo.ReadOnly = false;
                if (IndividualBankInfo.AccountNumber != String.Empty) txtAccountNo.Text = IndividualBankInfo.AccountNumber;
                txtAccountHolder.ReadOnly = false;
                if (IndividualBankInfo.AccountHolder != String.Empty) txtAccountHolder.Text = IndividualBankInfo.AccountHolder;
            }
        }

        private void btnACHExport_Click(object sender, EventArgs e)
        {

            Boolean bIsACHPaymentSelected = false;
            for (int i = 0; i < gvPaymentACH.Rows.Count; i++)
            {
                if (Boolean.Parse(gvPaymentACH["SelectedACHPayment", i].Value.ToString()) == true) bIsACHPaymentSelected = true;
            }
            if (bIsACHPaymentSelected == false)
            {
                MessageBox.Show("No Settlement is selected.", "Alert");
                return;
            }

            List<ACHPaymentExportInfo> lstACHPaymentExport = new List<ACHPaymentExportInfo>();
            List<ACHPaymentExportInfo> lstACHMemberReimbursement = new List<ACHPaymentExportInfo>();
            List<ACHPaymentCSVExportInfo> lstACHMemberReimbursementCSV = new List<ACHPaymentCSVExportInfo>();

            for (int i = 0; i < gvPaymentACH.Rows.Count; i++)
            {
                if (Boolean.Parse(gvPaymentACH["SelectedACHPayment", i].Value.ToString()) == true)
                {
                    ACHPaymentCSVExportInfo info = new ACHPaymentCSVExportInfo();

                    String ACHPaymentBankAccountHolderName = String.Empty;
                    if (gvPaymentACH["AccountHolderPaymentACH", i].Value != null) ACHPaymentBankAccountHolderName = gvPaymentACH["AccountHolderPaymentACH", i].Value.ToString();
                    else
                    {
                        MessageBox.Show("Bank account holder's name is empty.", "Error");
                        return;
                    }

                    String ACHPaymentIndividualId = String.Empty;
                    if (gvPaymentACH["IndividualIdPaymentACH", i].Value != null)
                    {
                        ACHPaymentIndividualId = gvPaymentACH["IndividualIdPaymentACH", i].Value.ToString();
                        info.IndividualId = ACHPaymentIndividualId;
                    }
                    else
                    {
                        MessageBox.Show("Individual Id is empty.", "Error");
                        return;
                    }

                    String ACHPaymentIndividualName = String.Empty;
                    if (gvPaymentACH["IndividualNamePaymentACH", i].Value != null) ACHPaymentIndividualName = gvPaymentACH["IndividualNamePaymentACH", i].Value.ToString();
                    else
                    {
                        MessageBox.Show("Individual name is empty.", "Error");
                    }

                    String ACHPaymentSettlementNo = String.Empty;
                    if (gvPaymentACH["SettlementNoPaymentACH", i].Value != null)
                    {
                        ACHPaymentSettlementNo = gvPaymentACH["SettlementNoPaymentACH", i].Value.ToString();
                        info.SettlementNo = ACHPaymentSettlementNo;
                    }
                    else
                    {
                        MessageBox.Show("Settlement No is empty.", "Error");
                        return;
                    }

                    String Amount = String.Empty;
                    if (gvPaymentACH["AmountPaymentACH", i].Value != null) Amount = gvPaymentACH["AmountPaymentACH", i].Value.ToString();
                    else
                    {
                        MessageBox.Show("Amount is empty.", "Error");
                        return;
                    }
                    Decimal ACHPaymentAmount = 0;
                    Decimal ACHAmountResult = 0;

                    if (Decimal.TryParse(Amount, NumberStyles.Currency, new CultureInfo("en-US"), out ACHAmountResult))
                    {
                        ACHPaymentAmount = ACHAmountResult;
                        info.ExpenseAmount = ACHPaymentAmount;
                    }
                    else
                    {
                        MessageBox.Show("ACH Amount is invalid.", "Error");
                        return;
                    }

                    String ACHPaymentRoutingNo = String.Empty;
                    if (gvPaymentACH["RoutingNoPaymentACH", i].Value != null) ACHPaymentRoutingNo = gvPaymentACH["RoutingNoPaymentACH", i].Value.ToString();
                    else
                    {
                        MessageBox.Show("Routing number is empty.", "Error");
                        return;
                    }

                    String ACHPaymentAccountNo = String.Empty;
                    if (gvPaymentACH["AccountNoPaymentACH", i].Value != null) ACHPaymentAccountNo = gvPaymentACH["AccountNoPaymentACH", i].Value.ToString();
                    else
                    {
                        MessageBox.Show("Account numbre is empty", "Error");
                        return;
                    }

                    Boolean bACHPaymentMemberReimbursement = (Boolean)gvPaymentACH["IsMemberReimbursementACHPayment", i].Value;

                    String ACHPaymentVendorId = String.Empty;
                    if (gvPaymentACH["VendorIdACHPayment", i].Value != null) ACHPaymentVendorId = gvPaymentACH["VendorIdACHPayment", i].Value.ToString();
                    else
                    {
                        MessageBox.Show("Vendor Id is empty", "Error");
                        return;
                    }

                    ACHPaymentExportInfo ach_Info = new ACHPaymentExportInfo();
                    ach_Info.BankAccountHolderName = ACHPaymentIndividualName;
                    ach_Info.IndividualId = ACHPaymentIndividualId;
                    ach_Info.IndividualName = ACHPaymentIndividualName;
                    ach_Info.SettlementNumber = ACHPaymentSettlementNo;
                    ach_Info.Amount = ACHPaymentAmount;
                    ach_Info.RoutingNumber = ACHPaymentRoutingNo;
                    ach_Info.AccountNumber = ACHPaymentAccountNo;

                    lstACHPaymentExport.Add(ach_Info);

                    if (bACHPaymentMemberReimbursement == true)
                    {
                        ACHPaymentExportInfo achMemberReimbursementInfo = new ACHPaymentExportInfo();

                        achMemberReimbursementInfo.IndividualId = ACHPaymentIndividualId;
                        achMemberReimbursementInfo.VendorId = ACHPaymentVendorId;

                        lstACHMemberReimbursement.Add(achMemberReimbursementInfo);
                    }

                    lstACHMemberReimbursementCSV.Add(info);
                }
            }

            frmMemberReimbursementTransacDate dlgTransactDate = new frmMemberReimbursementTransacDate();

            if (dlgTransactDate.ShowDialog() == DialogResult.OK)
            {
                foreach (ACHPaymentCSVExportInfo info in lstACHMemberReimbursementCSV) info.TransactionDate = dlgTransactDate.TransactionDate;
            }
            else return;

            foreach (ACHPaymentCSVExportInfo info in lstACHMemberReimbursementCSV)
            {
                String strSqlQueryForACHSettlementInfo = "select [dbo].[tbl_medbill].[BillDate], [dbo].[tbl_medbill].[MedicalProvider_Id], [dbo].[tbl_medbill].[Account_At_Provider], " +
                                                        "[dbo].[tbl_program].[ProgramName], [dbo].[tbl_incident].[IncidentNo] " +
                                                        "from [dbo].[tbl_medbill] " +
                                                        "inner join [dbo].[tbl_incident] on [dbo].[tbl_medbill].[Incident_Id] = [dbo].[tbl_incident].[Incident_id] " +
                                                        "inner join [dbo].[tbl_program] on [dbo].[tbl_incident].[Program_id] = [dbo].[tbl_program].[Program_Id] " +
                                                        "inner join [dbo].[tbl_settlement] on [dbo].[tbl_medbill].[BillNo] = [dbo].[tbl_settlement].[MedicalBillID] " +
                                                        "where [dbo].[tbl_medbill].[Individual_Id] = @IndividualId and " +
                                                        "[dbo].[tbl_settlement].[Name] = @SettlementNo";

                SqlCommand cmdQueryForACHSettlementInfo = new SqlCommand(strSqlQueryForACHSettlementInfo, connRN7);
                cmdQueryForACHSettlementInfo.CommandType = CommandType.Text;

                cmdQueryForACHSettlementInfo.Parameters.AddWithValue("@IndividualId", info.IndividualId);
                cmdQueryForACHSettlementInfo.Parameters.AddWithValue("@SettlementNo", info.SettlementNo);

                if (connRN7.State != ConnectionState.Closed)
                {
                    connRN7.Close();
                    connRN7.Open();
                }
                else if (connRN7.State == ConnectionState.Closed) connRN7.Open();
                SqlDataReader rdrACHSettlementInfo = cmdQueryForACHSettlementInfo.ExecuteReader();
                if (rdrACHSettlementInfo.HasRows)
                {
                    rdrACHSettlementInfo.Read();
                    if (!rdrACHSettlementInfo.IsDBNull(0)) info.ServiceDate = rdrACHSettlementInfo.GetDateTime(0);
                    if (!rdrACHSettlementInfo.IsDBNull(1)) info.MedicalProviderId = rdrACHSettlementInfo.GetString(1);
                    if (!rdrACHSettlementInfo.IsDBNull(2))
                    {
                        info.AccountNoAtProvider = rdrACHSettlementInfo.GetString(2);
                        if (info.AccountNoAtProvider == String.Empty) info.AccountNoAtProvider = "None";
                    }
                    if (!rdrACHSettlementInfo.IsDBNull(3)) info.IncidentProgram = rdrACHSettlementInfo.GetString(3);
                    if (!rdrACHSettlementInfo.IsDBNull(4)) info.IncidentNo = rdrACHSettlementInfo.GetString(4);
                }
                rdrACHSettlementInfo.Close();
                if (connRN7.State != ConnectionState.Closed) connRN7.Close();
            }

            foreach (ACHPaymentCSVExportInfo info in lstACHMemberReimbursementCSV)
            {
                String strSqlQueryForMedicalProvider = "select [dbo].[account].[Name] from [dbo].[account] where [dbo].[account].[Id] = @MedicalProviderId";

                SqlCommand cmdQueryForMedicalProvider = new SqlCommand(strSqlQueryForMedicalProvider, connSalesforce4);
                cmdQueryForMedicalProvider.CommandType = CommandType.Text;

                cmdQueryForMedicalProvider.Parameters.AddWithValue("@MedicalProviderId", info.MedicalProviderId);

                if (connSalesforce4.State != ConnectionState.Closed)
                {
                    connSalesforce4.Close();
                    connSalesforce4.Open();
                }
                else if (connSalesforce4.State == ConnectionState.Closed) connSalesforce4.Open();
                Object objProviderName = cmdQueryForMedicalProvider.ExecuteScalar();
                if (connSalesforce4.State != ConnectionState.Closed) connSalesforce4.Close();

                info.MedicalProvider = objProviderName?.ToString();
            }


            foreach(ACHPaymentCSVExportInfo info in lstACHMemberReimbursementCSV)
            {
                String strSqlQueryForACHPaymentExportInfo = "select [SalesForce].[dbo].[contact].[Membership_Number__c], " +
                                                            "[SalesForce].[dbo].[contact].[LastName], [SalesForce].[dbo].[contact].[FirstName], [SalesForce].[dbo].[contact].[MiddleName], " +
                                                            "[SalesForce].[dbo].[account].[ShippingStreet], [SalesForce].[dbo].[account].[ShippingCity], " +
                                                            "[SalesForce].[dbo].[account].[ShippingState], [SalesForce].[dbo].[account].[ShippingPostalCode], " +
                                                            "[SalesForce].[dbo].[contact].[Name] " +
                                                            "from [SalesForce].[dbo].[contact] " +
                                                            "inner join [SalesForce].[dbo].[account] on [SalesForce].[dbo].[contact].[AccountId] = [SalesForce].[dbo].[account].[ID] " +
                                                            "where [SalesForce].[dbo].[contact].[Individual_ID__c] = @IndividualId";

                SqlCommand cmdQueryForACHPaymentExportInfo = new SqlCommand(strSqlQueryForACHPaymentExportInfo, connSalesforce4);
                cmdQueryForACHPaymentExportInfo.CommandType = CommandType.Text;

                cmdQueryForACHPaymentExportInfo.Parameters.AddWithValue("@IndividualId", info.IndividualId);

                if (connSalesforce4.State != ConnectionState.Closed)
                {
                    connSalesforce4.Close();
                    connSalesforce4.Open();
                }
                else if (connSalesforce4.State == ConnectionState.Closed) connSalesforce4.Open();
                SqlDataReader rdrACHPaymentExportInfo = cmdQueryForACHPaymentExportInfo.ExecuteReader();
                if (rdrACHPaymentExportInfo.HasRows)
                {
                    rdrACHPaymentExportInfo.Read();
                    if (!rdrACHPaymentExportInfo.IsDBNull(0)) info.MembershipNo = rdrACHPaymentExportInfo.GetString(0);
                    if (!rdrACHPaymentExportInfo.IsDBNull(1)) info.LastName = rdrACHPaymentExportInfo.GetString(1);
                    if (!rdrACHPaymentExportInfo.IsDBNull(2)) info.FirstName = rdrACHPaymentExportInfo.GetString(2);
                    if (!rdrACHPaymentExportInfo.IsDBNull(3)) info.MiddleName = rdrACHPaymentExportInfo.GetString(3);
                    if (!rdrACHPaymentExportInfo.IsDBNull(4)) info.StreetAddress = rdrACHPaymentExportInfo.GetString(4);
                    if (!rdrACHPaymentExportInfo.IsDBNull(5)) info.City = rdrACHPaymentExportInfo.GetString(5);
                    if (!rdrACHPaymentExportInfo.IsDBNull(6)) info.State = rdrACHPaymentExportInfo.GetString(6);
                    if (!rdrACHPaymentExportInfo.IsDBNull(7)) info.Zip = rdrACHPaymentExportInfo.GetString(7);
                    if (!rdrACHPaymentExportInfo.IsDBNull(8)) info.IndividualName = rdrACHPaymentExportInfo.GetString(8);
                }
                rdrACHPaymentExportInfo.Close();
                if (connSalesforce4.State != ConnectionState.Closed) connSalesforce4.Close();
            }

            List<String> lstIndividualIDs = new List<String>();
            lstIndividualIDs = lstACHPaymentExport.Select(x => x.IndividualId).Distinct().ToList();

            // Export ACH Payment csv files here
            SaveFileDialog dlgACHExport = new SaveFileDialog();
            dlgACHExport.FileName = DateTime.Today.ToString("MMddyyyy") + "-MemberReimbursement - ACH";
            dlgACHExport.DefaultExt = "*.csv";
            dlgACHExport.Filter = "CSV documents (.csv)|*.csv";

            if (dlgACHExport.ShowDialog() == DialogResult.OK)
            {
                using (FileStream fs = File.Create(dlgACHExport.FileName))
                {
                    Byte[] heading = new UTF8Encoding(true)
                        .GetBytes("\"AccountFullName\",\"Check PayeeEntity\",\"RefNumber\",\"Txndate\",\"Memo\",\"address1\",\"address2\",\"City\",\"State\",\"postal\",\"IsToBePrinted\",\"Expense Account\",\"Expense Amount\",\"Expense Memo\"" + Environment.NewLine);
                    fs.Write(heading, 0, heading.Length);
                    int nReferenceNo = 1;

                    for (int i = 0; i < lstACHMemberReimbursementCSV.Count; i++)
                    {
                        if (i == 0)
                        {
                            StringBuilder sbSettlement = new StringBuilder();

                            sbSettlement.Append("\"Bank of Hope:Bank of Hope [ACH-Med] (4125)\"" + ",");
                            sbSettlement.Append("\"" + lstACHMemberReimbursementCSV[i].IndividualId + "\",");
                            sbSettlement.Append("\"" + nReferenceNo.ToString() + "\",");
                            sbSettlement.Append("\"" + lstACHMemberReimbursementCSV[i].TransactionDate.Value.ToShortDateString() + "\",");
                            sbSettlement.Append("\"" + "ACH " + lstACHMemberReimbursementCSV[i].MembershipNo + "-" + "CMM NEEDS SHARED" + "\",");
                            if (lstACHMemberReimbursementCSV[i].MiddleName != String.Empty)
                                sbSettlement.Append("\"" + lstACHMemberReimbursementCSV[i].LastName + "," +
                                                           lstACHMemberReimbursementCSV[i].FirstName + " " +
                                                           lstACHMemberReimbursementCSV[i].MiddleName + "\",");
                            else sbSettlement.Append("\"" + lstACHMemberReimbursementCSV[i].LastName + "," +
                                                            lstACHMemberReimbursementCSV[i].FirstName + "\",");
                            sbSettlement.Append("\"" + lstACHMemberReimbursementCSV[i].StreetAddress + "\",");
                            sbSettlement.Append("\"" + lstACHMemberReimbursementCSV[i].City + "\",");
                            sbSettlement.Append("\"" + lstACHMemberReimbursementCSV[i].State + "\",");
                            sbSettlement.Append("\"" + lstACHMemberReimbursementCSV[i].Zip + "\",");
                            sbSettlement.Append("\"FALSE\",");
                            sbSettlement.Append("\"CMM Expense:Medical Bill\",");
                            sbSettlement.Append("\"" + lstACHMemberReimbursementCSV[i].ExpenseAmount.ToString() + "\",");
                            sbSettlement.Append("\"" + lstACHMemberReimbursementCSV[i].ServiceDate.Value.ToString("MM/dd/yyyy") + " - " +
                                                       lstACHMemberReimbursementCSV[i].MedicalProvider + " - " +
                                                       lstACHMemberReimbursementCSV[i].AccountNoAtProvider + "\"" +
                                                       Environment.NewLine);

                            Byte[] settlement = new UTF8Encoding(true).GetBytes(sbSettlement.ToString());

                            fs.Write(settlement, 0, settlement.Length);

                            if (lstACHMemberReimbursementCSV.Count > (i + 1))
                            {
                                if (lstACHMemberReimbursementCSV[i].IndividualId != lstACHMemberReimbursementCSV[i + 1].IndividualId)
                                {
                                    StringBuilder sbIncidentInfo = new StringBuilder();
                                    sbIncidentInfo.Append(",," + nReferenceNo + ",,,,,,,,,,," + "\"" +
                                                                 lstACHMemberReimbursementCSV[i].IncidentProgram.Trim() + " - " +
                                                                 lstACHMemberReimbursementCSV[i].IndividualName + " - " +
                                                                 lstACHMemberReimbursementCSV[i].IncidentNo.Trim() + "\"" +
                                                                 Environment.NewLine);

                                    Byte[] incidentInfo = new UTF8Encoding(true).GetBytes(sbIncidentInfo.ToString());
                                    fs.Write(incidentInfo, 0, incidentInfo.Length);

                                    StringBuilder sbIndividualId = new StringBuilder();
                                    sbIndividualId.Append(",," + nReferenceNo + ",,,,,,,,,,," + lstACHMemberReimbursementCSV[i].IndividualId + Environment.NewLine);

                                    Byte[] IndividualId = new UTF8Encoding(true).GetBytes(sbIndividualId.ToString());
                                    fs.Write(IndividualId, 0, IndividualId.Length);

                                    nReferenceNo++;
                                }
                            }
                            if (i == lstACHMemberReimbursementCSV.Count - 1)
                            {
                                StringBuilder sbIncidentInfo = new StringBuilder();
                                sbIncidentInfo.Append(",," + nReferenceNo + ",,,,,,,,,,," + "\"" +
                                                             lstACHMemberReimbursementCSV[i].IncidentProgram.Trim() + " - " +
                                                             lstACHMemberReimbursementCSV[i].IndividualName.Trim() + " - " +
                                                             lstACHMemberReimbursementCSV[i].IncidentNo.Trim() + "\"" +
                                                             Environment.NewLine);

                                Byte[] incidentInfo = new UTF8Encoding(true).GetBytes(sbIncidentInfo.ToString());
                                fs.Write(incidentInfo, 0, incidentInfo.Length);

                                StringBuilder sbIndividualId = new StringBuilder();
                                sbIndividualId.Append(",," + nReferenceNo + ",,,,,,,,,,," + lstACHMemberReimbursementCSV[i].IndividualId + Environment.NewLine);

                                Byte[] IndividualId = new UTF8Encoding(true).GetBytes(sbIndividualId.ToString());
                                fs.Write(IndividualId, 0, IndividualId.Length);

                                nReferenceNo++;

                            }
                        }
                        else if (i > 0)
                        {
                            if (lstACHMemberReimbursementCSV[i].IndividualId != lstACHMemberReimbursementCSV[i - 1].IndividualId)
                            {
                                StringBuilder sbSettlement = new StringBuilder();

                                sbSettlement.Append("\"Bank of Hope:Bank of Hope [ACH-Med] (4125)\"" + ",");
                                sbSettlement.Append("\"" + lstACHMemberReimbursementCSV[i].IndividualId + "\",");
                                sbSettlement.Append("\"" + nReferenceNo.ToString() + "\",");
                                sbSettlement.Append("\"" + lstACHMemberReimbursementCSV[i].TransactionDate.Value.ToShortDateString() + "\",");
                                sbSettlement.Append("\"" + "ACH " + lstACHMemberReimbursementCSV[i].MembershipNo + "-CMM NEEDS SHARED\",");

                                if (lstACHMemberReimbursementCSV[i].MiddleName == String.Empty)
                                    sbSettlement.Append("\"" + lstACHMemberReimbursementCSV[i].LastName.Trim() + "," +
                                                               lstACHMemberReimbursementCSV[i].FirstName.Trim() + "\",");

                                else
                                    sbSettlement.Append("\"" + lstACHMemberReimbursementCSV[i].LastName.Trim() + "," +
                                                               lstACHMemberReimbursementCSV[i].FirstName.Trim() + " " +
                                                               lstACHMemberReimbursementCSV[i].MiddleName.Trim() + "\",");
                                sbSettlement.Append("\"" + lstACHMemberReimbursementCSV[i].StreetAddress + "\",");
                                sbSettlement.Append("\"" + lstACHMemberReimbursementCSV[i].City + "\",");
                                sbSettlement.Append("\"" + lstACHMemberReimbursementCSV[i].State + "\",");
                                sbSettlement.Append("\"" + lstACHMemberReimbursementCSV[i].Zip + "\",");
                                sbSettlement.Append("\"FALSE\",");
                                sbSettlement.Append("\"CMM Expense:Medical Bill\",");
                                sbSettlement.Append("\"" + lstACHMemberReimbursementCSV[i].ExpenseAmount.ToString() + "\",");
                                                                
                                sbSettlement.Append("\"" + lstACHMemberReimbursementCSV[i].ServiceDate.Value.ToString("MM/dd/yyyy") + " - " +
                                                           lstACHMemberReimbursementCSV[i].MedicalProvider.Trim() + " - " +
                                                           lstACHMemberReimbursementCSV[i].AccountNoAtProvider + "\"" +
                                                           Environment.NewLine);

                                Byte[] settlement = new UTF8Encoding(true).GetBytes(sbSettlement.ToString());

                                fs.Write(settlement, 0, settlement.Length);

                                if (lstACHMemberReimbursementCSV.Count > (i + 1))
                                {
                                    if (lstACHMemberReimbursementCSV[i].IndividualId != lstACHMemberReimbursementCSV[i + 1].IndividualId)
                                    {
                                        StringBuilder sbIncidentInfo = new StringBuilder();
                                        sbIncidentInfo.Append(",," + nReferenceNo + ",,,,,,,,,,," +
                                                              "\"" + lstACHMemberReimbursementCSV[i].IncidentProgram.Trim() + " - " +
                                                                     lstACHMemberReimbursementCSV[i].IndividualName + " - " +
                                                                     lstACHMemberReimbursementCSV[i].IncidentNo.Trim() + "\"" +
                                                                     Environment.NewLine);

                                        Byte[] incidentInfo = new UTF8Encoding(true).GetBytes(sbIncidentInfo.ToString());
                                        fs.Write(incidentInfo, 0, incidentInfo.Length);

                                        StringBuilder sbIndividualId = new StringBuilder();
                                        sbIndividualId.Append(",," + nReferenceNo + ",,,,,,,,,,," + lstACHMemberReimbursementCSV[i].IndividualId + Environment.NewLine);

                                        Byte[] IndividualId = new UTF8Encoding(true).GetBytes(sbIndividualId.ToString());
                                        fs.Write(IndividualId, 0, IndividualId.Length);

                                        nReferenceNo++;
                                    }
                                }

                                if (i == lstACHMemberReimbursementCSV.Count - 1)
                                {
                                    StringBuilder sbIncidentInfo = new StringBuilder();
                                    sbIncidentInfo.Append(",," + nReferenceNo + ",,,,,,,,,,," +
                                                          "\"" + lstACHMemberReimbursementCSV[i].IncidentProgram.Trim() + " - " +
                                                                 lstACHMemberReimbursementCSV[i].IndividualName + " - " +
                                                                 lstACHMemberReimbursementCSV[i].IncidentNo.Trim() + "\"" +
                                                                 Environment.NewLine);

                                    Byte[] incidentInfo = new UTF8Encoding(true).GetBytes(sbIncidentInfo.ToString());
                                    fs.Write(incidentInfo, 0, incidentInfo.Length);

                                    StringBuilder sbIndividualId = new StringBuilder();
                                    sbIndividualId.Append(",," + nReferenceNo + ",,,,,,,,,,," + lstACHMemberReimbursementCSV[i].IndividualId + Environment.NewLine);

                                    Byte[] IndividualId = new UTF8Encoding(true).GetBytes(sbIndividualId.ToString());
                                    fs.Write(IndividualId, 0, IndividualId.Length);

                                    nReferenceNo++;
                                }
                            }
                            else if (lstACHMemberReimbursementCSV[i].IndividualId == lstACHMemberReimbursementCSV[i - 1].IndividualId)
                            {
                                StringBuilder sbSettlement = new StringBuilder();

                                sbSettlement.Append(",," + nReferenceNo.ToString() + ",,,,,,,,," + "CMM Expense:Medical Bill" + "," +
                                                    lstACHMemberReimbursementCSV[i].ExpenseAmount.ToString() + ",\"" +
                                                    lstACHMemberReimbursementCSV[i].ServiceDate.Value.ToString("MM/dd/yyyy") + " - " +
                                                    lstACHMemberReimbursementCSV[i].MedicalProvider + " - " +
                                                    lstACHMemberReimbursementCSV[i].AccountNoAtProvider + "\"" +
                                                    Environment.NewLine);

                                Byte[] settlement = new UTF8Encoding(true).GetBytes(sbSettlement.ToString());

                                fs.Write(settlement, 0, settlement.Length);

                                if (lstACHMemberReimbursementCSV.Count > (i + 1))
                                {
                                    if (lstACHMemberReimbursementCSV[i].IndividualId != lstACHMemberReimbursementCSV[i + 1].IndividualId)
                                    {
                                        StringBuilder sbIncidentInfo = new StringBuilder();
                                        sbIncidentInfo.Append(",," + nReferenceNo.ToString() + ",,,,,,,,,,," +
                                                              "\"" + lstACHMemberReimbursementCSV[i].IncidentProgram.Trim() + " - " +
                                                                     lstACHMemberReimbursementCSV[i].IndividualName + " - " +
                                                                     lstACHMemberReimbursementCSV[i].IncidentNo.Trim() + "\"" +
                                                                     Environment.NewLine);

                                        Byte[] incidentInfo = new UTF8Encoding(true).GetBytes(sbIncidentInfo.ToString());
                                        fs.Write(incidentInfo, 0, incidentInfo.Length);

                                        StringBuilder sbIndividualId = new StringBuilder();
                                        sbIndividualId.Append(",," + nReferenceNo.ToString() + ",,,,,,,,,,," + lstACHMemberReimbursementCSV[i].IndividualId + Environment.NewLine);

                                        Byte[] IndividualId = new UTF8Encoding(true).GetBytes(sbIndividualId.ToString());
                                        fs.Write(IndividualId, 0, IndividualId.Length);

                                        nReferenceNo++;
                                    }
                                }
                                if (i == lstACHMemberReimbursementCSV.Count - 1)
                                {
                                    StringBuilder sbIncidentInfo = new StringBuilder();
                                    sbIncidentInfo.Append(",," + nReferenceNo.ToString() + ",,,,,,,,,,," +
                                                          "\"" + lstACHMemberReimbursementCSV[i].IncidentProgram.Trim() + " - " +
                                                                 lstACHMemberReimbursementCSV[i].IndividualName + " - " +
                                                                 lstACHMemberReimbursementCSV[i].IncidentNo.Trim() + "\"" +
                                                                 Environment.NewLine);

                                    Byte[] incidentInfo = new UTF8Encoding(true).GetBytes(sbIncidentInfo.ToString());
                                    fs.Write(incidentInfo, 0, incidentInfo.Length);

                                    StringBuilder sbIndividualId = new StringBuilder();
                                    sbIndividualId.Append(",," + nReferenceNo.ToString() + ",,,,,,,,,,," + lstACHMemberReimbursementCSV[i].IndividualId + Environment.NewLine);

                                    Byte[] IndividualId = new UTF8Encoding(true).GetBytes(sbIndividualId.ToString());
                                    fs.Write(IndividualId, 0, IndividualId.Length);

                                    nReferenceNo++;
                                }
                            }
                        }
                    }
                }

                String VendorIDFileName = Path.GetDirectoryName(dlgACHExport.FileName);
                VendorIDFileName += "\\" + DateTime.Today.ToString("MMddyyyy") + "vendorupdate - ACH.csv";

                using (FileStream fs = File.Create(VendorIDFileName))
                {
                    Byte[] heading = new UTF8Encoding(true).GetBytes("Vendor_id" + Environment.NewLine);
                    fs.Write(heading, 0, heading.Length);

                    foreach (String strIndividualId in lstIndividualIDs)
                    {
                        StringBuilder sbIndividualId = new StringBuilder();
                        sbIndividualId.Append(strIndividualId + Environment.NewLine);

                        Byte[] IndividualId = new UTF8Encoding(true).GetBytes(sbIndividualId.ToString());
                        fs.Write(IndividualId, 0, IndividualId.Length);
                    }
                }
            }

            List<ACHPaymentExportInfo> lstACHPaymentExportDistinctIndividual = new List<ACHPaymentExportInfo>();

            foreach (String IndvidualId in lstIndividualIDs)
            {
                ACHPaymentExportInfo exportInfo = new ACHPaymentExportInfo();
                exportInfo.IndividualId = IndvidualId;
                foreach (ACHPaymentExportInfo info in lstACHPaymentExport)
                {
                    if (exportInfo.IndividualId == info.IndividualId)
                    {
                        exportInfo.BankAccountHolderName = info.BankAccountHolderName;
                        exportInfo.IndividualName = info.IndividualName;
                        exportInfo.SettlementNumber += info.SettlementNumber.Substring(7) + "; ";
                        exportInfo.Amount += info.Amount;
                        exportInfo.RoutingNumber = info.RoutingNumber;
                        exportInfo.AccountNumber = info.AccountNumber;
                    }
                }
                lstACHPaymentExportDistinctIndividual.Add(exportInfo);
            }

            foreach (ACHPaymentExportInfo info in lstACHPaymentExportDistinctIndividual)
            {
                info.Description += " - " + info.IndividualName + " - STLM-" + info.SettlementNumber;
            }

            SaveFileDialog dlg = new SaveFileDialog();
            dlg.FileName = DateTime.Today.ToString("MMddyyyy") + "-ACH-Payment";
            dlg.DefaultExt = ".txt";
            dlg.Filter = "Text documents (.txt)|*.txt";

            DialogResult result = dlg.ShowDialog();

            if (result == DialogResult.OK)
            {
                Cursor.Current = Cursors.WaitCursor;

                try
                {
                    using (FileStream fs = File.Create(dlg.FileName))
                    {
                        Byte[] heading = new UTF8Encoding(true).GetBytes("BANK HOLDER'S NAME\t\tAMOUNT\tROUTING NUMBER\tACCOUNT NUMBER\tDESCRIPTION" + Environment.NewLine);
                        fs.Write(heading, 0, heading.Length);
                        foreach (ACHPaymentExportInfo info in lstACHPaymentExportDistinctIndividual)
                        {
                            StringBuilder sbSettlement = new StringBuilder();
                            sbSettlement.Append(info.IndividualName + '\t');
                            sbSettlement.Append(info.IndividualId + '\t');
                            sbSettlement.Append(info.Amount.ToString() + '\t');
                            sbSettlement.Append(info.RoutingNumber + '\t');
                            sbSettlement.Append(info.AccountNumber + '\t');
                            sbSettlement.Append(info.Description + Environment.NewLine);
                            Byte[] settlement = new UTF8Encoding(true).GetBytes(sbSettlement.ToString());

                            fs.Write(settlement, 0, settlement.Length);
                        }
                    }
                }
                catch (Exception ex)
                {
                    MessageBox.Show(ex.Message);
                    return;
                }
                Boolean bACHSettlementUpdated = true;
                foreach (ACHPaymentExportInfo info in lstACHPaymentExport)
                {
                    String strSqlUpdateSettlementPaid = "update [dbo].[tbl_settlement] set [dbo].[tbl_settlement].[IsACHExported] = 1, [dbo].[tbl_settlement].[ACHExportedByID] = @ExportedByID " +
                                                        "where [dbo].[tbl_settlement].[Name] = @SettlementNo";

                    SqlCommand cmdUpdateSettlementPaid = new SqlCommand(strSqlUpdateSettlementPaid, connRN5);
                    cmdUpdateSettlementPaid.CommandType = CommandType.Text;

                    cmdUpdateSettlementPaid.Parameters.AddWithValue("@ExportedByID", nLoggedUserId);
                    cmdUpdateSettlementPaid.Parameters.AddWithValue("@SettlementNo", info.SettlementNumber);

                    if (connRN5.State != ConnectionState.Closed)
                    {
                        connRN5.Close();
                        connRN5.Open();
                    }
                    else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                    int nSettlementUpdated = cmdUpdateSettlementPaid.ExecuteNonQuery();
                    if (connRN5.State == ConnectionState.Open) connRN5.Close();
                    if (nSettlementUpdated == 0) bACHSettlementUpdated = false;
                }

                Cursor.Current = Cursors.Default;
                if (bACHSettlementUpdated == true)
                {
                    MessageBox.Show("ACH Settlement have been updated.", "Info");
                    return;
                }
                else
                {
                    MessageBox.Show("At least one of ACH Settlements has not been updated.", "Error");
                    return;
                }
            }
        }

        private void btnConfirmCheckPaymentMemberReimbursement_Click(object sender, EventArgs e)
        {

            frmConfirmCheckPayment frmConfirm = new frmConfirmCheckPayment();
            DialogResult ConfirmDialog = frmConfirm.ShowDialog();

            if (ConfirmDialog == DialogResult.OK)
            {
                Cursor.Current = Cursors.WaitCursor;
                DateTime CheckDate = frmConfirm.CheckDate;
                int nCheckNo = frmConfirm.CheckNumber;

                String BeginningIndividualId = String.Empty;

                for (int i = 0; i < gvPaymentCheckMemberReimbursement.Rows.Count; i++)
                {
                    if ((Boolean.Parse(gvPaymentCheckMemberReimbursement["ExportedMemberReimbursement", i].Value.ToString())) == true)
                    {
                        BeginningIndividualId = gvPaymentCheckMemberReimbursement["IndividualIdPaymentCheck", i].Value.ToString();
                        break;
                    }
                }

                Boolean bSettlementUpdated = true;
                for (int i = 0; i < gvPaymentCheckMemberReimbursement.Rows.Count; i++)
                {
                    if ((Boolean.Parse(gvPaymentCheckMemberReimbursement["ExportedMemberReimbursement", i].Value.ToString()) == true))
                    {
                        String IndividualIdCheckPaymentForMemberReimbursement = String.Empty;
                        if (gvPaymentCheckMemberReimbursement["IndividualIdPaymentCheck", i].Value != null)
                            IndividualIdCheckPaymentForMemberReimbursement = gvPaymentCheckMemberReimbursement["IndividualIdPaymentCheck", i].Value.ToString().Trim();
                        if (BeginningIndividualId == IndividualIdCheckPaymentForMemberReimbursement)
                        {
                            String SettlementNo = String.Empty;
                            if (gvPaymentCheckMemberReimbursement["SettlementNoPaymentCheck", i].Value != null)
                                SettlementNo = gvPaymentCheckMemberReimbursement["SettlementNoPaymentCheck", i].Value.ToString().Trim();

                            String strSqlUpdateSettlementForCheckPaymentMemberReimbursement = "update [dbo].[tbl_settlement] set [dbo].[tbl_settlement].[IsPaid] = 1, " +
                                                                                              "[dbo].[tbl_settlement].[PaidByID] = @PaidByID, " +
                                                                                              "[dbo].[tbl_settlement].[CheckDate] = @CheckDate, " +
                                                                                              "[dbo].[tbl_settlement].[CheckNo] = @CheckNo " +
                                                                                              "where [dbo].[tbl_settlement].[Name] = @SettlementNo";

                            SqlCommand cmdUpdateSettlementForCheckPaymentMemberReimbursement = new SqlCommand(strSqlUpdateSettlementForCheckPaymentMemberReimbursement, connRN5);
                            cmdUpdateSettlementForCheckPaymentMemberReimbursement.CommandType = CommandType.Text;

                            cmdUpdateSettlementForCheckPaymentMemberReimbursement.Parameters.AddWithValue("@PaidByID", nLoggedUserId);
                            cmdUpdateSettlementForCheckPaymentMemberReimbursement.Parameters.AddWithValue("@CheckDate", CheckDate);
                            cmdUpdateSettlementForCheckPaymentMemberReimbursement.Parameters.AddWithValue("@CheckNo", nCheckNo);
                            cmdUpdateSettlementForCheckPaymentMemberReimbursement.Parameters.AddWithValue("@SettlementNo", SettlementNo);

                            if (connRN5.State != ConnectionState.Closed)
                            {
                                connRN5.Close();
                                connRN5.Open();
                            }
                            else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                            int nSettlementUpdated = cmdUpdateSettlementForCheckPaymentMemberReimbursement.ExecuteNonQuery();
                            if (connRN5.State != ConnectionState.Closed) connRN5.Close();
                            if (nSettlementUpdated == 0) bSettlementUpdated = false;
                        }
                        else
                        {
                            BeginningIndividualId = IndividualIdCheckPaymentForMemberReimbursement;
                            nCheckNo++;

                            String SettlementNo = String.Empty;
                            if (gvPaymentCheckMemberReimbursement["SettlementNoPaymentCheck", i].Value != null)
                                SettlementNo = gvPaymentCheckMemberReimbursement["SettlementNoPaymentCheck", i].Value.ToString().Trim();

                            String strSqlUpdateSettlementForCheckPaymentMemberReimbursement = "update [dbo].[tbl_settlement] set [dbo].[tbl_settlement].[IsPaid] = 1, " +
                                                                                              "[dbo].[tbl_settlement].[PaidByID] = @PaidByID, " +
                                                                                              "[dbo].[tbl_settlement].[CheckDate] = @CheckDate, " +
                                                                                              "[dbo].[tbl_settlement].[CheckNo] = @CheckNo " +
                                                                                              "where [dbo].[tbl_settlement].[Name] = @SettlementNo";

                            SqlCommand cmdUpdateSettlementForCheckPaymentMemberReimbursement = new SqlCommand(strSqlUpdateSettlementForCheckPaymentMemberReimbursement, connRN5);
                            cmdUpdateSettlementForCheckPaymentMemberReimbursement.CommandType = CommandType.Text;

                            cmdUpdateSettlementForCheckPaymentMemberReimbursement.Parameters.AddWithValue("@PaidByID", nLoggedUserId);
                            cmdUpdateSettlementForCheckPaymentMemberReimbursement.Parameters.AddWithValue("@CheckDate", CheckDate);
                            cmdUpdateSettlementForCheckPaymentMemberReimbursement.Parameters.AddWithValue("@CheckNo", nCheckNo);
                            cmdUpdateSettlementForCheckPaymentMemberReimbursement.Parameters.AddWithValue("@SettlementNo", SettlementNo);

                            if (connRN5.State != ConnectionState.Closed)
                            {
                                connRN5.Close();
                                connRN5.Open();
                            }
                            else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                            int nSettlementUpdated = cmdUpdateSettlementForCheckPaymentMemberReimbursement.ExecuteNonQuery();
                            if (connRN5.State != ConnectionState.Closed) connRN5.Close();
                            if (nSettlementUpdated == 0) bSettlementUpdated = false;
                        }
                    }
                }

                Cursor.Current = Cursors.Default;

                if (bSettlementUpdated == true)
                {
                    MessageBox.Show("Settlements have been updated for member reimbursement.", "Info");
                    return;
                }
                else
                {
                    MessageBox.Show("At least one of settlement has not been updated for member reimbursement.", "Error");
                    return;
                }
            }
            else if (ConfirmDialog == DialogResult.Cancel) return;
        }

        private void btnConfirmACH_Click(object sender, EventArgs e)
        {

            frmConfirmACHPayment frmConfirm = new frmConfirmACHPayment();

            DialogResult ConfirmDialogResult = frmConfirm.ShowDialog();

            if (ConfirmDialogResult == DialogResult.OK)
            {
                Cursor.Current = Cursors.WaitCursor;
                List<String> lstSettlements = new List<String>();
                for (int i = 0; i < gvPaymentACH.Rows.Count; i++)
                {
                    if (Boolean.Parse(gvPaymentACH["IsACHExportedACHPayment", i].Value.ToString()) == true)
                    {
                        lstSettlements.Add(gvPaymentACH["SettlementNoPaymentACH", i].Value.ToString());
                    }
                }

                if (lstSettlements.Count == 0)
                {
                    MessageBox.Show("No settlement selected.", "Alert");
                    return;
                }

                DateTime ACH_Date = frmConfirm.ACH_Date;
                String ACH_Number = frmConfirm.ACH_Number;

                Boolean bUpdateSucceeded = true;
                foreach (String settlement in lstSettlements)
                {
                    String strSqlUpdateSettlementForACHPayment = "update [dbo].[tbl_settlement] set [dbo].[tbl_settlement].[IsPaid] = 1, [dbo].[tbl_settlement].[PaidByID] = @PaidByID, " +
                                                                 "[dbo].[tbl_settlement].[ACH_Number] = @ACH_Number, [dbo].[tbl_settlement].[ACH_Date] = @ACH_Date " +
                                                                 "where [dbo].[tbl_settlement].[Name] = @Settlement";

                    SqlCommand cmdUpdateSettlementForACHPayment = new SqlCommand(strSqlUpdateSettlementForACHPayment, connRN5);
                    cmdUpdateSettlementForACHPayment.CommandType = CommandType.Text;

                    cmdUpdateSettlementForACHPayment.Parameters.AddWithValue("@PaidByID", nLoggedUserId);
                    cmdUpdateSettlementForACHPayment.Parameters.AddWithValue("@ACH_Number", ACH_Number);
                    cmdUpdateSettlementForACHPayment.Parameters.AddWithValue("@ACH_Date", ACH_Date);
                    cmdUpdateSettlementForACHPayment.Parameters.AddWithValue("@Settlement", settlement);

                    if (connRN5.State != ConnectionState.Closed)
                    {
                        connRN5.Close();
                        connRN5.Open();
                    }
                    else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                    int nSettlementUpdated = cmdUpdateSettlementForACHPayment.ExecuteNonQuery();
                    if (connRN5.State == ConnectionState.Open) connRN5.Close();

                    if (nSettlementUpdated != 1) bUpdateSucceeded = false;
                }

                Cursor.Current = Cursors.Default;

                if (bUpdateSucceeded)
                {
                    MessageBox.Show("The ACH payments have been confirmed.", "Info");
                    return;
                }
                else
                {
                    MessageBox.Show("At least one of settlement has not been confirmed.", "Error");
                    return;
                }
            }
            else if (ConfirmDialogResult == DialogResult.Cancel)
            {
                return;
            }
        }

        private void gvPaymentACH_CellContentClick(object sender, DataGridViewCellEventArgs e)
        {
            if ((e.ColumnIndex == 0 || e.ColumnIndex == 1) && e.RowIndex >= 0)
            {
                if (Boolean.Parse(gvPaymentACH[e.ColumnIndex, e.RowIndex].Value.ToString()) == true)
                {
                    gvPaymentACH[e.ColumnIndex, e.RowIndex].Value = false;
                    return;
                }
                else
                {
                    gvPaymentACH[e.ColumnIndex, e.RowIndex].Value = true;
                    return;
                }
            }
        }

        private void gvPaymentCheckMemberReimbursement_CellContentClick(object sender, DataGridViewCellEventArgs e)
        {
            if ((e.ColumnIndex == 0 || e.ColumnIndex == 1) && e.RowIndex >= 0)
            {
                if (Boolean.Parse(gvPaymentCheckMemberReimbursement[e.ColumnIndex, e.RowIndex].Value.ToString()) == true)
                {
                    gvPaymentCheckMemberReimbursement[e.ColumnIndex, e.RowIndex].Value = false;
                    return;
                }
                else
                {
                    gvPaymentCheckMemberReimbursement[e.ColumnIndex, e.RowIndex].Value = true;
                    return;
                }
            }
        }

        private void btnNewTaskCaseForm_Click(object sender, EventArgs e)
        {
            frmTaskCreationPage frm = new frmTaskCreationPage(txtCaseIndividualID.Text.Trim(),
                                                              RelatedToTable.Case,
                                                              txtCreateCaseIndividualName.Text.Trim(),
                                                              txtCaseName.Text.Trim(),
                                                              nLoggedUserId,
                                                              LoggedInUserName,
                                                              LoggedInUserRole,
                                                              LoggedInUserDepartment,
                                                              TaskMode.AddNew,
                                                              0);

            DialogResult result = frm.ShowDialog();
            return;
        }

        private void gvTaskInCase_CellDoubleClick(object sender, DataGridViewCellEventArgs e)
        {
            DataGridView gvSelectedTask = (DataGridView)sender;

            String strTaskId = String.Empty;
            if (gvSelectedTask["TaskIdCaseTask", e.RowIndex].Value != null) strTaskId = gvSelectedTask["TaskIdCaseTask", e.RowIndex].Value.ToString();
            int? nTaskId = null;
            if (strTaskId != String.Empty) nTaskId = Int32.Parse(strTaskId);

            frmTaskCreationPage frmTaskToEdit = new frmTaskCreationPage(nTaskId.Value, TaskMode.EditInCase);

            frmTaskToEdit.ShowDialog();

            return;
        }

        private void btnExportCheckPayment_Click(object sender, EventArgs e)
        {

            SaveFileDialog dlg = new SaveFileDialog();
            dlg.FileName = DateTime.Today.ToString("MMddyyyy") + "-MemberReimbursement";
            dlg.DefaultExt = ".csv";
            dlg.Filter = "CSV documents (.csv)|*.csv";

            DialogResult result = dlg.ShowDialog();

            String VendorIDPath = dlg.FileName;

            if (result == DialogResult.OK)
            {

                List<String> lstSettlementSelected = new List<String>();
                for (int i = 0; i < gvPaymentCheckMemberReimbursement.Rows.Count; i++)
                {
                    if ((Boolean.Parse(gvPaymentCheckMemberReimbursement["SelectedPaymentCheck", i].Value.ToString())) == true)
                    {
                        lstSettlementSelected.Add(gvPaymentCheckMemberReimbursement["SettlementNoPaymentCheck", i].Value.ToString());
                    }
                }

                if (lstSettlementSelected.Count == 0)
                {
                    MessageBox.Show("No settlment selected.", "Alert");
                    return;
                }

                frmMemberReimbursementTransacDate frmTransactDate = new frmMemberReimbursementTransacDate();
                DialogResult resultTransact = frmTransactDate.ShowDialog();
                DateTime? TransactDate = null;

                if (resultTransact == DialogResult.OK) TransactDate = frmTransactDate.TransactionDate;
                else return;

                List<CheckPaymentCSVExportInfo> lstCheckPayemntCSVExport = new List<CheckPaymentCSVExportInfo>();
                for (int i = 0; i < gvPaymentCheckMemberReimbursement.Rows.Count; i++)
                {
                    if ((Boolean.Parse(gvPaymentCheckMemberReimbursement["SelectedPaymentCheck", i].Value.ToString())) == true)
                    {
                        CheckPaymentCSVExportInfo csv_info = new CheckPaymentCSVExportInfo();

                        if (gvPaymentCheckMemberReimbursement["IndividualIdPaymentCheck", i].Value != null) csv_info.IndividualId = gvPaymentCheckMemberReimbursement["IndividualIdPaymentCheck", i].Value.ToString();
                        if (gvPaymentCheckMemberReimbursement["IndividualNamePaymentCheck", i].Value != null)
                        {
                            csv_info.IndividualName = gvPaymentCheckMemberReimbursement["IndividualNamePaymentCheck", i].Value.ToString();
                            csv_info.PatientName = gvPaymentCheckMemberReimbursement["IndividualNamePaymentCheck", i].Value.ToString();
                        }
                        if (gvPaymentCheckMemberReimbursement["HouseholdRolePaymentCheck", i].Value != null) csv_info.HouseholdRole = gvPaymentCheckMemberReimbursement["HouseholdRolePaymentCheck", i].Value.ToString();
                        if (gvPaymentCheckMemberReimbursement["IncidentNoPaymentCheck", i].Value != null) csv_info.IncidentNo = gvPaymentCheckMemberReimbursement["IncidentNoPaymentCheck", i].Value.ToString();
                        if (gvPaymentCheckMemberReimbursement["IncidentProgramNamePaymentCheck", i].Value != null) csv_info.IncidentProgram = gvPaymentCheckMemberReimbursement["IncidentProgramNamePaymentCheck", i].Value.ToString();
                        if (gvPaymentCheckMemberReimbursement["SettlementNoPaymentCheck", i].Value != null) csv_info.SettlementNo = gvPaymentCheckMemberReimbursement["SettlementNoPaymentCheck", i].Value.ToString();
                        if (gvPaymentCheckMemberReimbursement["PrimaryNamePaymentCheck", i].Value != null) csv_info.PrimaryName = gvPaymentCheckMemberReimbursement["PrimaryNamePaymentCheck", i].Value.ToString();



                        csv_info.TransactionDate = TransactDate.Value;
                        if (gvPaymentCheckMemberReimbursement["MembershipNoPaymentCheck", i].Value != null) csv_info.MembershipNo = gvPaymentCheckMemberReimbursement["MembershipNoPaymentCheck", i].Value.ToString();
                        if (gvPaymentCheckMemberReimbursement["AmountPaymentCheck", i].Value != null)
                        {
                            Decimal AmountResult = 0;
                            if (Decimal.TryParse(gvPaymentCheckMemberReimbursement["AmountPaymentCheck", i].Value.ToString(), NumberStyles.Currency, new CultureInfo("en-US"), out AmountResult))
                            {
                                csv_info.SettlementAmount = AmountResult;
                            }
                        }
                        if (gvPaymentCheckMemberReimbursement["DateOfServicePaymentCheck", i].Value != null)
                        {
                            DateTime ServiceDate;
                            if (DateTime.TryParse(gvPaymentCheckMemberReimbursement["DateOfServicePaymentCheck", i].Value.ToString(), out ServiceDate)) csv_info.ServiceDate = ServiceDate;
                        }
                        if (gvPaymentCheckMemberReimbursement["MedProviderPaymentCheck", i].Value != null) csv_info.MedicalProvider = gvPaymentCheckMemberReimbursement["MedProviderPaymentCheck", i].Value.ToString();
                        if (gvPaymentCheckMemberReimbursement["AccountNamePaymentCheck", i].Value != null) csv_info.AccountNoAtProvider = gvPaymentCheckMemberReimbursement["AccountNamePaymentCheck", i].Value.ToString();
                        if (gvPaymentCheckMemberReimbursement["ShippingStreetPaymentCheck", i].Value != null) csv_info.StreetAddress = gvPaymentCheckMemberReimbursement["ShippingStreetPaymentCheck", i].Value.ToString();
                        if (gvPaymentCheckMemberReimbursement["ShippingCityPaymentCheck", i].Value != null) csv_info.City = gvPaymentCheckMemberReimbursement["ShippingCityPaymentCheck", i].Value.ToString();
                        if (gvPaymentCheckMemberReimbursement["ShippingStatePaymentCheck", i].Value != null) csv_info.State = gvPaymentCheckMemberReimbursement["ShippingStatePaymentCheck", i].Value.ToString();
                        if (gvPaymentCheckMemberReimbursement["ShippingZipPaymentCheck", i].Value != null) csv_info.Zip = gvPaymentCheckMemberReimbursement["ShippingZipPaymentCheck", i].Value.ToString();

                        lstCheckPayemntCSVExport.Add(csv_info);
                    }
                }
                List<CheckPaymentCSVExportInfo> lstSortedCheckPaymentCSVExport = new List<CheckPaymentCSVExportInfo>();
                lstSortedCheckPaymentCSVExport = lstCheckPayemntCSVExport.OrderBy(o => o.IndividualId).ToList();

                Cursor.Current = Cursors.WaitCursor;

                foreach (CheckPaymentCSVExportInfo info in lstSortedCheckPaymentCSVExport)
                {
                    String strSqlQueryForPatientName = "select [dbo].[contact].[LastName], [dbo].[contact].[FirstName], [dbo].[contact].[MiddleName] from [dbo].[contact] " +
                                                       "where [dbo].[contact].[Individual_ID__c] = @IndividualId";

                    SqlCommand cmdQueryForPatientName = new SqlCommand(strSqlQueryForPatientName, connSalesforce);
                    cmdQueryForPatientName.CommandType = CommandType.Text;

                    cmdQueryForPatientName.Parameters.AddWithValue("@IndividualId", info.IndividualId);

                    if (connSalesforce.State != ConnectionState.Closed)
                    {
                        connSalesforce.Close();
                        connSalesforce.Open();
                    }
                    else if (connSalesforce.State == ConnectionState.Closed) connSalesforce.Open();
                    SqlDataReader rdrPatientName = cmdQueryForPatientName.ExecuteReader();
                    if (rdrPatientName.HasRows)
                    {
                        rdrPatientName.Read();
                        if (!rdrPatientName.IsDBNull(0)) info.PatientLastName = rdrPatientName.GetString(0);
                        if (!rdrPatientName.IsDBNull(1)) info.PatientFirstName = rdrPatientName.GetString(1);
                        if (!rdrPatientName.IsDBNull(2)) info.PatientMiddleName = rdrPatientName.GetString(2);
                    }
                    rdrPatientName.Close();
                    if (connSalesforce.State == ConnectionState.Open) connSalesforce.Close();
                }

                using (FileStream fs = File.Create(dlg.FileName))
                {
                    Byte[] heading = new UTF8Encoding(true)
                        .GetBytes("\"AccountFullName\",\"Check PayeeEntity\",\"RefNumber\",\"Txndate\",\"Memo\",\"address1\",\"address2\",\"City\",\"State\",\"postal\",\"IsToBePrinted\",\"Expense Account\",\"Expense Amount\",\"Expense Memo\"" + Environment.NewLine);
                    fs.Write(heading, 0, heading.Length);
                    int nReferenceNo = 1;

                    for (int i = 0; i < lstSortedCheckPaymentCSVExport.Count; i++)
                    {
                        if (i == 0)
                        {
                            StringBuilder sbSettlement = new StringBuilder();

                            sbSettlement.Append("\"Bank of Hope:Bank of Hope [ACH-Med] (4125)\"" + ",");
                            sbSettlement.Append("\"" + lstSortedCheckPaymentCSVExport[i].IndividualId + "\",");
                            sbSettlement.Append("\"" + nReferenceNo.ToString() + "\",");
                            sbSettlement.Append("\"" + lstSortedCheckPaymentCSVExport[i].TransactionDate.ToShortDateString() + "\",");
                            sbSettlement.Append("\"" + lstSortedCheckPaymentCSVExport[i].MembershipNo + "-CMM NEEDS SHARED\",");
                            if (lstSortedCheckPaymentCSVExport[i].HouseholdRole.Trim() == "Child")
                            {
                                if (lstSortedCheckPaymentCSVExport[i].PatientMiddleName == String.Empty)
                                {
                                    sbSettlement.Append("\"" + lstSortedCheckPaymentCSVExport[i].PatientLastName.Trim() + "," +
                                                        lstSortedCheckPaymentCSVExport[i].PatientFirstName.Trim() + "|" +
                                                        lstSortedCheckPaymentCSVExport[i].PrimaryName.Trim() + "\",");
                                }
                                else
                                {
                                    sbSettlement.Append("\"" + lstSortedCheckPaymentCSVExport[i].PatientLastName.Trim() + "," +
                                                        lstSortedCheckPaymentCSVExport[i].PatientFirstName.Trim() + " " +
                                                        lstSortedCheckPaymentCSVExport[i].PatientMiddleName.Trim() + "|" +
                                                        lstSortedCheckPaymentCSVExport[i].PrimaryName.Trim() + "\",");
                                }
                            }
                            else
                            {
                                if (lstSortedCheckPaymentCSVExport[i].PatientMiddleName == String.Empty)
                                {
                                    sbSettlement.Append("\"" + lstSortedCheckPaymentCSVExport[i].PatientLastName.Trim() + "," +
                                                        lstSortedCheckPaymentCSVExport[i].PatientFirstName.Trim() + "\",");
                                }
                                else
                                {
                                    sbSettlement.Append("\"" + lstSortedCheckPaymentCSVExport[i].PatientLastName.Trim() + "," +
                                                        lstSortedCheckPaymentCSVExport[i].PatientFirstName.Trim() + " " +
                                                        lstSortedCheckPaymentCSVExport[i].PatientMiddleName.Trim() + "\",");
                                }
                            }
                            sbSettlement.Append("\"" + lstSortedCheckPaymentCSVExport[i].StreetAddress + "\",");
                            sbSettlement.Append("\"" + lstSortedCheckPaymentCSVExport[i].City + "\",");
                            sbSettlement.Append("\"" + lstSortedCheckPaymentCSVExport[i].State + "\",");
                            sbSettlement.Append("\"" + lstSortedCheckPaymentCSVExport[i].Zip + "\",");
                            sbSettlement.Append("\"TRUE\",");
                            sbSettlement.Append("\"CMM Expense:Medical Bill\",");
                            sbSettlement.Append("\"" + lstSortedCheckPaymentCSVExport[i].SettlementAmount.ToString() + "\",");
                            if (lstSortedCheckPaymentCSVExport[i].AccountNoAtProvider != String.Empty)
                            {
                                sbSettlement.Append("\"" + lstSortedCheckPaymentCSVExport[i].ServiceDate.ToString("MM/dd/yyyy") + " - " +
                                                    lstSortedCheckPaymentCSVExport[i].MedicalProvider.Trim() + " - " +
                                                    lstSortedCheckPaymentCSVExport[i].AccountNoAtProvider + "\"" +
                                                    Environment.NewLine);
                            }
                            else
                            {
                                sbSettlement.Append("\"" + lstSortedCheckPaymentCSVExport[i].ServiceDate.ToString("MM/dd/yyyy") + " - " +
                                                    lstSortedCheckPaymentCSVExport[i].MedicalProvider.Trim() + "\"" +
                                                    Environment.NewLine);
                            }

                            Byte[] settlement = new UTF8Encoding(true).GetBytes(sbSettlement.ToString());

                            fs.Write(settlement, 0, settlement.Length);

                            if (lstSortedCheckPaymentCSVExport.Count > (i + 1))
                            {
                                if (lstSortedCheckPaymentCSVExport[i].IndividualId != lstSortedCheckPaymentCSVExport[i + 1].IndividualId)
                                {
                                    StringBuilder sbIncidentInfo = new StringBuilder();
                                    sbIncidentInfo.Append(",," + nReferenceNo + ",,,,,,,,,,," + "\"" +
                                                                lstSortedCheckPaymentCSVExport[i].IncidentProgram.Trim() + " - " +
                                                                lstSortedCheckPaymentCSVExport[i].PatientName + " - " +
                                                                lstSortedCheckPaymentCSVExport[i].IncidentNo + "\"" +
                                                                Environment.NewLine);

                                    Byte[] incidentInfo = new UTF8Encoding(true).GetBytes(sbIncidentInfo.ToString());
                                    fs.Write(incidentInfo, 0, incidentInfo.Length);

                                    StringBuilder sbIndividualId = new StringBuilder();
                                    sbIndividualId.Append(",," + nReferenceNo + ",,,,,,,,,,," + lstSortedCheckPaymentCSVExport[i].IndividualId + Environment.NewLine);

                                    Byte[] IndividualId = new UTF8Encoding(true).GetBytes(sbIndividualId.ToString());
                                    fs.Write(IndividualId, 0, IndividualId.Length);

                                    nReferenceNo++;
                                }
                            }
                            if (i == lstSortedCheckPaymentCSVExport.Count - 1)
                            {
                                StringBuilder sbIncidentInfo = new StringBuilder();
                                sbIncidentInfo.Append(",," + nReferenceNo + ",,,,,,,,,,," + "\"" +
                                                            lstSortedCheckPaymentCSVExport[i].IncidentProgram.Trim() + " - " +
                                                            lstSortedCheckPaymentCSVExport[i].PatientName + " - " +
                                                            lstSortedCheckPaymentCSVExport[i].IncidentNo + "\"" +
                                                            Environment.NewLine);

                                Byte[] incidentInfo = new UTF8Encoding(true).GetBytes(sbIncidentInfo.ToString());
                                fs.Write(incidentInfo, 0, incidentInfo.Length);

                                StringBuilder sbIndividualId = new StringBuilder();
                                sbIndividualId.Append(",," + nReferenceNo + ",,,,,,,,,,," + lstSortedCheckPaymentCSVExport[i].IndividualId + Environment.NewLine);

                                Byte[] IndividualId = new UTF8Encoding(true).GetBytes(sbIndividualId.ToString());
                                fs.Write(IndividualId, 0, IndividualId.Length);

                                nReferenceNo++;
                            }
                        }
                        else if (i > 0)
                        {
                            if (lstSortedCheckPaymentCSVExport[i].IndividualId != lstSortedCheckPaymentCSVExport[i - 1].IndividualId)
                            {
                                StringBuilder sbSettlement = new StringBuilder();

                                sbSettlement.Append("\"Bank of Hope:Bank of Hope [ACH-Med] (4125)\"" + ",");
                                sbSettlement.Append("\"" + lstSortedCheckPaymentCSVExport[i].IndividualId + "\",");
                                sbSettlement.Append("\"" + nReferenceNo.ToString() + "\",");
                                sbSettlement.Append("\"" + lstSortedCheckPaymentCSVExport[i].TransactionDate.ToShortDateString() + "\",");
                                sbSettlement.Append("\"" + lstSortedCheckPaymentCSVExport[i].MembershipNo + "-CMM NEEDS SHARED\",");
                                if (lstSortedCheckPaymentCSVExport[i].HouseholdRole.Trim() == "Child")
                                {
                                    if (lstSortedCheckPaymentCSVExport[i].PatientMiddleName == String.Empty)
                                    {
                                        sbSettlement.Append("\"" + lstSortedCheckPaymentCSVExport[i].PatientLastName.Trim() + "," +
                                                            lstSortedCheckPaymentCSVExport[i].PatientFirstName.Trim() + "|" +
                                                            lstSortedCheckPaymentCSVExport[i].PrimaryName.Trim() + "\",");
                                    }
                                    else
                                    {
                                        sbSettlement.Append("\"" + lstSortedCheckPaymentCSVExport[i].PatientLastName.Trim() + "," +
                                                            lstSortedCheckPaymentCSVExport[i].PatientFirstName.Trim() + " " +
                                                            lstSortedCheckPaymentCSVExport[i].PatientMiddleName.Trim() + "|" +
                                                            lstSortedCheckPaymentCSVExport[i].PrimaryName.Trim() + "\",");
                                    }
                                }
                                else
                                {
                                    if (lstSortedCheckPaymentCSVExport[i].PatientMiddleName == String.Empty)
                                    {
                                        sbSettlement.Append("\"" + lstSortedCheckPaymentCSVExport[i].PatientLastName.Trim() + "," +
                                                            lstSortedCheckPaymentCSVExport[i].PatientFirstName.Trim() + "\",");
                                    }
                                    else
                                    {
                                        sbSettlement.Append("\"" + lstSortedCheckPaymentCSVExport[i].PatientLastName.Trim() + "," +
                                                            lstSortedCheckPaymentCSVExport[i].PatientFirstName.Trim() + " " +
                                                            lstSortedCheckPaymentCSVExport[i].PatientMiddleName.Trim() + "\",");
                                    }
                                }
                                sbSettlement.Append("\"" + lstSortedCheckPaymentCSVExport[i].StreetAddress + "\",");
                                sbSettlement.Append("\"" + lstSortedCheckPaymentCSVExport[i].City + "\",");
                                sbSettlement.Append("\"" + lstSortedCheckPaymentCSVExport[i].State + "\",");
                                sbSettlement.Append("\"" + lstSortedCheckPaymentCSVExport[i].Zip + "\",");
                                sbSettlement.Append("\"TRUE\",");
                                sbSettlement.Append("\"CMM Expense:Medical Bill\",");
                                sbSettlement.Append("\"" + lstSortedCheckPaymentCSVExport[i].SettlementAmount.ToString() + "\",");
                                if (lstSortedCheckPaymentCSVExport[i].AccountNoAtProvider != String.Empty)
                                {
                                    sbSettlement.Append("\"" + lstSortedCheckPaymentCSVExport[i].ServiceDate.ToString("MM/dd/yyyy") + " - " +
                                                        lstSortedCheckPaymentCSVExport[i].MedicalProvider.Trim() + " - " +
                                                        lstSortedCheckPaymentCSVExport[i].AccountNoAtProvider + "\"" +
                                                        Environment.NewLine);
                                }
                                else
                                {
                                    sbSettlement.Append("\"" + lstSortedCheckPaymentCSVExport[i].ServiceDate.ToString("MM/dd/yyyy") + " - " +
                                                        lstSortedCheckPaymentCSVExport[i].MedicalProvider.Trim() + "\"" +
                                                        Environment.NewLine);
                                }

                                Byte[] settlement = new UTF8Encoding(true).GetBytes(sbSettlement.ToString());

                                fs.Write(settlement, 0, settlement.Length);

                                if (lstSortedCheckPaymentCSVExport.Count > (i + 1))
                                {
                                    if (lstSortedCheckPaymentCSVExport[i].IndividualId != lstSortedCheckPaymentCSVExport[i + 1].IndividualId)
                                    {
                                        StringBuilder sbIncidentInfo = new StringBuilder();
                                        sbIncidentInfo.Append(",," + nReferenceNo + ",,,,,,,,,,," +
                                                                    "\"" + lstSortedCheckPaymentCSVExport[i].IncidentProgram.Trim() + " - " +
                                                                    lstSortedCheckPaymentCSVExport[i].PatientName + " - " +
                                                                    lstSortedCheckPaymentCSVExport[i].IncidentNo + "\"" +
                                                                    Environment.NewLine);

                                        Byte[] incidentInfo = new UTF8Encoding(true).GetBytes(sbIncidentInfo.ToString());
                                        fs.Write(incidentInfo, 0, incidentInfo.Length);

                                        StringBuilder sbIndividualId = new StringBuilder();
                                        sbIndividualId.Append(",," + nReferenceNo + ",,,,,,,,,,," + lstSortedCheckPaymentCSVExport[i].IndividualId + Environment.NewLine);

                                        Byte[] IndividualId = new UTF8Encoding(true).GetBytes(sbIndividualId.ToString());
                                        fs.Write(IndividualId, 0, IndividualId.Length);

                                        nReferenceNo++;
                                    }
                                }

                                if (i == lstSortedCheckPaymentCSVExport.Count - 1)
                                {
                                    StringBuilder sbIncidentInfo = new StringBuilder();
                                    sbIncidentInfo.Append(",," + nReferenceNo + ",,,,,,,,,,," +
                                                                "\"" + lstSortedCheckPaymentCSVExport[i].IncidentProgram.Trim() + " - " +
                                                                lstSortedCheckPaymentCSVExport[i].PatientName + " - " +
                                                                lstSortedCheckPaymentCSVExport[i].IncidentNo + "\"" +
                                                                Environment.NewLine);

                                    Byte[] incidentInfo = new UTF8Encoding(true).GetBytes(sbIncidentInfo.ToString());
                                    fs.Write(incidentInfo, 0, incidentInfo.Length);

                                    StringBuilder sbIndividualId = new StringBuilder();
                                    sbIndividualId.Append(",," + nReferenceNo + ",,,,,,,,,,," + lstSortedCheckPaymentCSVExport[i].IndividualId + Environment.NewLine);

                                    Byte[] IndividualId = new UTF8Encoding(true).GetBytes(sbIndividualId.ToString());
                                    fs.Write(IndividualId, 0, IndividualId.Length);

                                    nReferenceNo++;
                                }
                            }
                            else if (lstSortedCheckPaymentCSVExport[i].IndividualId == lstSortedCheckPaymentCSVExport[i - 1].IndividualId)
                            {
                                StringBuilder sbSettlement = new StringBuilder();

                                if (lstSortedCheckPaymentCSVExport[i].AccountNoAtProvider != String.Empty)
                                {
                                    sbSettlement.Append(",," + nReferenceNo.ToString() + ",,,,,,,,," + "CMM Expense:Medical Bill" + "," +
                                                        lstSortedCheckPaymentCSVExport[i].SettlementAmount.ToString() + "," +
                                                        "\"" + lstSortedCheckPaymentCSVExport[i].ServiceDate.ToString("MM/dd/yyyy") + " - " +
                                                        lstSortedCheckPaymentCSVExport[i].MedicalProvider + " - " +
                                                        lstSortedCheckPaymentCSVExport[i].AccountNoAtProvider + "\"" +
                                                        Environment.NewLine);
                                }
                                else
                                {
                                    sbSettlement.Append(",," + nReferenceNo.ToString() + ",,,,,,,,," + "CMM Expense:Medical Bill" + "," +
                                                        lstSortedCheckPaymentCSVExport[i].SettlementAmount.ToString() + "," +
                                                        "\"" + lstSortedCheckPaymentCSVExport[i].ServiceDate.ToString("MM/dd/yyyy") + " - " +
                                                        lstSortedCheckPaymentCSVExport[i].MedicalProvider + "\"" +
                                                        Environment.NewLine);
                                }

                                Byte[] settlement = new UTF8Encoding(true).GetBytes(sbSettlement.ToString());

                                fs.Write(settlement, 0, settlement.Length);

                                if (lstSortedCheckPaymentCSVExport.Count > (i + 1))
                                {
                                    if (lstSortedCheckPaymentCSVExport[i].IndividualId != lstSortedCheckPaymentCSVExport[i + 1].IndividualId)
                                    {
                                        StringBuilder sbIncidentInfo = new StringBuilder();
                                        sbIncidentInfo.Append(",," + nReferenceNo + ",,,,,,,,,,," +
                                                                    "\"" + lstSortedCheckPaymentCSVExport[i].IncidentProgram.Trim() + " - " +
                                                                    lstSortedCheckPaymentCSVExport[i].PatientName + " - " +
                                                                    lstSortedCheckPaymentCSVExport[i].IncidentNo + "\"" +
                                                                    Environment.NewLine);

                                        Byte[] incidentInfo = new UTF8Encoding(true).GetBytes(sbIncidentInfo.ToString());
                                        fs.Write(incidentInfo, 0, incidentInfo.Length);

                                        StringBuilder sbIndividualId = new StringBuilder();
                                        sbIndividualId.Append(",," + nReferenceNo + ",,,,,,,,,,," + lstSortedCheckPaymentCSVExport[i].IndividualId + Environment.NewLine);

                                        Byte[] IndividualId = new UTF8Encoding(true).GetBytes(sbIndividualId.ToString());
                                        fs.Write(IndividualId, 0, IndividualId.Length);

                                        nReferenceNo++;
                                    }
                                }
                                if (i == lstSortedCheckPaymentCSVExport.Count - 1)
                                {
                                    StringBuilder sbIncidentInfo = new StringBuilder();
                                    sbIncidentInfo.Append(",," + nReferenceNo + ",,,,,,,,,,," +
                                                                "\"" + lstSortedCheckPaymentCSVExport[i].IncidentProgram.Trim() + " - " +
                                                                lstSortedCheckPaymentCSVExport[i].PatientName + " - " +
                                                                lstSortedCheckPaymentCSVExport[i].IncidentNo + "\"" +
                                                                Environment.NewLine);

                                    Byte[] incidentInfo = new UTF8Encoding(true).GetBytes(sbIncidentInfo.ToString());
                                    fs.Write(incidentInfo, 0, incidentInfo.Length);

                                    StringBuilder sbIndividualId = new StringBuilder();
                                    sbIndividualId.Append(",," + nReferenceNo + ",,,,,,,,,,," + lstSortedCheckPaymentCSVExport[i].IndividualId + Environment.NewLine);

                                    Byte[] IndividualId = new UTF8Encoding(true).GetBytes(sbIndividualId.ToString());
                                    fs.Write(IndividualId, 0, IndividualId.Length);

                                    nReferenceNo++;
                                }
                            }
                        }
                    }
                }

                //String VendorUpdateFileName = DateTime.Today.ToString("MMddyyyy") + "vendorupdate.csv";

                //String VendorIDPath = dlg.FileName;

                String VendorIDFileName = Path.GetDirectoryName(dlg.FileName);

                VendorIDFileName += "\\" + DateTime.Today.ToString("MMddyyyy") + "vendorupdate.csv";

                using (FileStream fs = File.Create(VendorIDFileName))
                {
                    Byte[] heading = new UTF8Encoding(true).GetBytes("Vendor_id," + Environment.NewLine);
                    fs.Write(heading, 0, heading.Length);

                    String CurrentIndividualId = String.Empty;
                    String NextIndividualId = String.Empty;

                    CurrentIndividualId = lstSortedCheckPaymentCSVExport[0].IndividualId;

                    for (int i = 0; i < lstSortedCheckPaymentCSVExport.Count; i++)
                    {
                        StringBuilder sbVendorId = new StringBuilder();

                        if (i < lstSortedCheckPaymentCSVExport.Count - 1)
                        {
                            if (CurrentIndividualId != lstSortedCheckPaymentCSVExport[i + 1].IndividualId)
                                CurrentIndividualId = lstSortedCheckPaymentCSVExport[i + 1].IndividualId;
                            else continue;
                        }

                        if (lstSortedCheckPaymentCSVExport[i].PatientMiddleName != String.Empty)
                            if (lstSortedCheckPaymentCSVExport[i].HouseholdRole == "Child")
                                sbVendorId.Append(lstSortedCheckPaymentCSVExport[i].IndividualId + "," +
                                              "\"" + lstSortedCheckPaymentCSVExport[i].PatientLastName + "," +
                                                     lstSortedCheckPaymentCSVExport[i].PatientFirstName + " " +
                                                     lstSortedCheckPaymentCSVExport[i].PatientMiddleName + "|" +
                                                     lstSortedCheckPaymentCSVExport[i].PrimaryName + "\"" +
                                                     Environment.NewLine);
                            else
                                sbVendorId.Append(lstSortedCheckPaymentCSVExport[i].IndividualId + "," +
                                             "\"" + lstSortedCheckPaymentCSVExport[i].PatientLastName + "," +
                                                    lstSortedCheckPaymentCSVExport[i].PatientFirstName + " " +
                                                    lstSortedCheckPaymentCSVExport[i].PrimaryMiddleName + "\"" +
                                                    Environment.NewLine);

                        else
                            if (lstSortedCheckPaymentCSVExport[i].HouseholdRole == "Child")
                                sbVendorId.Append(lstSortedCheckPaymentCSVExport[i].IndividualId + "," +
                                              "\"" + lstSortedCheckPaymentCSVExport[i].PatientLastName + "," +
                                                     lstSortedCheckPaymentCSVExport[i].PatientFirstName + "|" +
                                                     lstSortedCheckPaymentCSVExport[i].PrimaryName + "\"" +
                                                     Environment.NewLine);
                            else
                                sbVendorId.Append(lstSortedCheckPaymentCSVExport[i].IndividualId + "," +
                                              "\"" + lstSortedCheckPaymentCSVExport[i].PatientLastName + "," +
                                                     lstSortedCheckPaymentCSVExport[i].PatientFirstName + "\"" +
                                                     Environment.NewLine);

                        Byte[] VendorId = new UTF8Encoding(true).GetBytes(sbVendorId.ToString());

                        fs.Write(VendorId, 0, VendorId.Length);
                    }
                }


                Boolean bExportSucceeded = true;

                foreach (CheckPaymentCSVExportInfo info in lstSortedCheckPaymentCSVExport)
                {
                    String strSqlUpdateSettlementForCheckPaymentExport = "update [dbo].[tbl_settlement] set [dbo].[tbl_settlement].[IsCheckExported] = 1, " +
                                                                         "[dbo].[tbl_settlement].[CheckExportedByID] = @ExportedByID " +
                                                                         "where [dbo].[tbl_settlement].[Name] = @SettlementNo";

                    SqlCommand cmdUpdateSettlemetnForCheckPaymentExport = new SqlCommand(strSqlUpdateSettlementForCheckPaymentExport, connRN5);
                    cmdUpdateSettlemetnForCheckPaymentExport.CommandType = CommandType.Text;

                    cmdUpdateSettlemetnForCheckPaymentExport.Parameters.AddWithValue("@ExportedByID", nLoggedUserId);
                    cmdUpdateSettlemetnForCheckPaymentExport.Parameters.AddWithValue("@SettlementNo", info.SettlementNo);

                    if (connRN5.State != ConnectionState.Closed)
                    {
                        connRN5.Close();
                        connRN5.Open();
                    }
                    else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                    int nSettlementExported = cmdUpdateSettlemetnForCheckPaymentExport.ExecuteNonQuery();
                    if (connRN5.State == ConnectionState.Open) connRN5.Close();
                    if (nSettlementExported != 1) bExportSucceeded = false;
                }

                Cursor.Current = Cursors.Default;
                if (bExportSucceeded)
                {
                    MessageBox.Show("Check payments have been exported.", "Info");
                    return;
                }
                else
                {
                    MessageBox.Show("At least one of check payment has not been exported.", "Error");
                    return;
                }
            }
        }

        private void btnExportCheckProviderPayment_Click(object sender, EventArgs e)
        {
            SaveFileDialog dlg = new SaveFileDialog();
            dlg.FileName = DateTime.Today.ToString("MMddyyyy") + "-ProviderPayment";
            dlg.DefaultExt = ".csv";
            dlg.Filter = "CSV documents (.csv)|*.csv";

            DialogResult result = dlg.ShowDialog();

            if (result == DialogResult.OK)
            {

                List<String> lstSettlementSelected = new List<String>();
                for (int i = 0; i < gvPaymentCheckProvider.Rows.Count; i++)
                {
                    if ((Boolean.Parse(gvPaymentCheckProvider["SelectedProviderPaymentCheck", i].Value.ToString())) == true)
                    {
                        lstSettlementSelected.Add(gvPaymentCheckProvider["SettlementNoProviderPaymentCheck", i].Value.ToString());
                    }
                }

                if (lstSettlementSelected.Count == 0)
                {
                    MessageBox.Show("No settlment selected.", "Alert");
                    return;
                }

                DateTime? TransactDate = null;

                frmMemberReimbursementTransacDate frmCMMProviderPaymentTransactDate = new frmMemberReimbursementTransacDate();
                DialogResult resultCMMProviderPaymentTransactDate = frmCMMProviderPaymentTransactDate.ShowDialog();

                if (resultCMMProviderPaymentTransactDate == DialogResult.OK) TransactDate = frmCMMProviderPaymentTransactDate.TransactionDate;
                else return;

                List<CheckPaymentCSVExportInfo> lstCheckPayemntCSVExport = new List<CheckPaymentCSVExportInfo>();
                for (int i = 0; i < gvPaymentCheckProvider.Rows.Count; i++)
                {
                    if ((Boolean.Parse(gvPaymentCheckProvider["SelectedProviderPaymentCheck", i].Value.ToString())) == true)
                    {
                        CheckPaymentCSVExportInfo csv_info = new CheckPaymentCSVExportInfo();

                        if (gvPaymentCheckProvider["IndividualIdProviderPaymentCheck", i].Value != null) csv_info.IndividualId = gvPaymentCheckProvider["IndividualIdProviderPaymentCheck", i].Value.ToString();
                        if (gvPaymentCheckProvider["IndividualNameProviderPaymentCheck", i].Value != null)
                        {
                            csv_info.IndividualName = gvPaymentCheckProvider["IndividualNameProviderPaymentCheck", i].Value.ToString();
                            csv_info.PatientName = gvPaymentCheckProvider["IndividualNameProviderPaymentCheck", i].Value.ToString();
                        }
                        if (gvPaymentCheckProvider["HouseholdRoleProviderPaymentCheck", i].Value != null) csv_info.HouseholdRole = gvPaymentCheckProvider["HouseholdRoleProviderPaymentCheck", i].Value.ToString();
                        if (gvPaymentCheckProvider["IncidentNoProviderPaymentCheck", i].Value != null) csv_info.IncidentNo = gvPaymentCheckProvider["IncidentNoProviderPaymentCheck", i].Value.ToString();
                        if (gvPaymentCheckProvider["IncidentProgramNameProviderPaymentCheck", i].Value != null) csv_info.IncidentProgram = gvPaymentCheckProvider["IncidentProgramNameProviderPaymentCheck", i].Value.ToString();
                        if (gvPaymentCheckProvider["SettlementNoProviderPaymentCheck", i].Value != null) csv_info.SettlementNo = gvPaymentCheckProvider["SettlementNoProviderPaymentCheck", i].Value.ToString();
                        if (gvPaymentCheckProvider["PrimaryNameProviderPaymentCheck", i].Value != null) csv_info.PrimaryName = gvPaymentCheckProvider["PrimaryNameProviderPaymentCheck", i].Value.ToString();

                        //csv_info.TransactionDate = DateTime.Today;
                        csv_info.TransactionDate = TransactDate.Value;
                        if (gvPaymentCheckProvider["MembershipNoProviderPaymentCheck", i].Value != null) csv_info.MembershipNo = gvPaymentCheckProvider["MembershipNoProviderPaymentCheck", i].Value.ToString();
                        if (gvPaymentCheckProvider["AmountProviderPaymentCheck", i].Value != null)
                        {
                            Decimal AmountResult = 0;
                            if (Decimal.TryParse(gvPaymentCheckProvider["AmountProviderPaymentCheck", i].Value.ToString(), NumberStyles.Currency, new CultureInfo("en-US"), out AmountResult))
                            {
                                csv_info.SettlementAmount = AmountResult;
                            }
                        }
                        if (gvPaymentCheckProvider["DateOfServiceProviderPaymentCheck", i].Value != null)
                        {
                            DateTime ServiceDate;
                            if (DateTime.TryParse(gvPaymentCheckProvider["DateOfServiceProviderPaymentCheck", i].Value.ToString(), out ServiceDate)) csv_info.ServiceDate = ServiceDate;
                        }
                        if (gvPaymentCheckProvider["MedicalProviderProviderPaymentCheck", i].Value != null) csv_info.MedicalProvider = gvPaymentCheckProvider["MedicalProviderProviderPaymentCheck", i].Value.ToString();
                        if (gvPaymentCheckProvider["MedicalProviderIdProviderPaymentCheck", i].Value != null) csv_info.MedicalProviderId = gvPaymentCheckProvider["MedicalProviderIdProviderPaymentCheck", i].Value.ToString();
                        if (gvPaymentCheckProvider["AccountNameProviderPaymentCheck", i].Value != null) csv_info.AccountNoAtProvider = gvPaymentCheckProvider["AccountNameProviderPaymentCheck", i].Value.ToString();
                        if (gvPaymentCheckProvider["ShippingStreetProviderPaymentCheck", i].Value != null) csv_info.StreetAddress = gvPaymentCheckProvider["ShippingStreetProviderPaymentCheck", i].Value.ToString();
                        if (gvPaymentCheckProvider["ShippingCityProviderPaymentCheck", i].Value != null) csv_info.City = gvPaymentCheckProvider["ShippingCityProviderPaymentCheck", i].Value.ToString();
                        if (gvPaymentCheckProvider["ShippingStateProviderPaymentCheck", i].Value != null) csv_info.State = gvPaymentCheckProvider["ShippingStateProviderPaymentCheck", i].Value.ToString();
                        if (gvPaymentCheckProvider["ShippingZipProviderPaymentCheck", i].Value != null) csv_info.Zip = gvPaymentCheckProvider["ShippingZipProviderPaymentCheck", i].Value.ToString();

                        lstCheckPayemntCSVExport.Add(csv_info);
                    }
                }
                List<CheckPaymentCSVExportInfo> lstSortedCheckPaymentCSVExport = new List<CheckPaymentCSVExportInfo>();
                lstSortedCheckPaymentCSVExport = lstCheckPayemntCSVExport.OrderBy(info => info.MedicalProvider).ToList();

                Cursor.Current = Cursors.WaitCursor;
                foreach (CheckPaymentCSVExportInfo info in lstSortedCheckPaymentCSVExport)
                {
                    String strSqlQueryForPatientName = "select [dbo].[contact].[LastName], [dbo].[contact].[FirstName], [dbo].[contact].[MiddleName] from [dbo].[contact] " +
                                                       "where [dbo].[contact].[Individual_ID__c] = @IndividualId";

                    SqlCommand cmdQueryForPatientName = new SqlCommand(strSqlQueryForPatientName, connSalesforce);
                    cmdQueryForPatientName.CommandType = CommandType.Text;

                    cmdQueryForPatientName.Parameters.AddWithValue("@IndividualId", info.IndividualId);

                    if (connSalesforce.State != ConnectionState.Closed)
                    {
                        connSalesforce.Close();
                        connSalesforce.Open();
                    }
                    else if (connSalesforce.State == ConnectionState.Closed) connSalesforce.Open();
                    SqlDataReader rdrPatientName = cmdQueryForPatientName.ExecuteReader();
                    if (rdrPatientName.HasRows)
                    {
                        rdrPatientName.Read();
                        if (!rdrPatientName.IsDBNull(0)) info.PatientLastName = rdrPatientName.GetString(0);
                        if (!rdrPatientName.IsDBNull(1)) info.PatientFirstName = rdrPatientName.GetString(1);
                        if (!rdrPatientName.IsDBNull(2)) info.PatientMiddleName = rdrPatientName.GetString(2);
                    }
                    rdrPatientName.Close();
                    if (connSalesforce.State != ConnectionState.Closed) connSalesforce.Close();
                }

                // modify this section for Provider Check Payment
                using (FileStream fs = File.Create(dlg.FileName))
                {
                    Byte[] heading = new UTF8Encoding(true)
                        .GetBytes("\"AccountFullName\",\"Check PayeeEntity\",\"RefNumber\",\"Txndate\",\"Memo\",\"address1\",\"address2\",\"City\",\"State\",\"postal\",\"IsToBePrinted\",\"Expense Account\",\"Expense Amount\",\"Expense Memo\"" + Environment.NewLine);
                    fs.Write(heading, 0, heading.Length);
                    int nReferenceNo = 1;

                    String CurrentMedicalProviderId = String.Empty;
                    String CurrentIncidentNo = String.Empty;

                    for (int i = 0; i < lstSortedCheckPaymentCSVExport.Count; i++)
                    {
                        //CurrentMedicalProviderId = lstSortedCheckPaymentCSVExport[i].MedicalProviderId;
                        //CurrentIncidentNo = lstSortedCheckPaymentCSVExport[i].IncidentNo;

                        if (i == 0)
                        {
                            StringBuilder sbSettlement = new StringBuilder();
                            sbSettlement.Append("\"Bank of Hope:Bank of Hope [ACH-Med] (4125)" + "\",");
                            sbSettlement.Append("\"" + lstSortedCheckPaymentCSVExport[i].MedicalProvider + "\",");
                            sbSettlement.Append("\"" + nReferenceNo.ToString() + "\",");
                            sbSettlement.Append("\"" + lstSortedCheckPaymentCSVExport[i].TransactionDate.ToShortDateString() + "\",");

                            if (lstSortedCheckPaymentCSVExport[i].PatientMiddleName != String.Empty)
                            {
                                sbSettlement.Append("\"" + "Pt Name:" + lstSortedCheckPaymentCSVExport[i].PatientFirstName +
                                                                        lstSortedCheckPaymentCSVExport[i].PatientMiddleName.ElementAt(0) + ". " +
                                                                        lstSortedCheckPaymentCSVExport[i].PatientLastName + ",");
                            }
                            else
                            {
                                sbSettlement.Append("\"" + "Pt Name:" + lstSortedCheckPaymentCSVExport[i].PatientFirstName + " " +
                                                                        lstSortedCheckPaymentCSVExport[i].PatientLastName + ",");
                            }
                            sbSettlement.Append("Acct# " + lstSortedCheckPaymentCSVExport[i].AccountNoAtProvider + "\",");

                            sbSettlement.Append("\"" + lstSortedCheckPaymentCSVExport[i].MedicalProvider + "\",");
                            sbSettlement.Append("\"" + lstSortedCheckPaymentCSVExport[i].StreetAddress + "\",");
                            sbSettlement.Append("\"" + lstSortedCheckPaymentCSVExport[i].City + "\",");
                            sbSettlement.Append("\"" + lstSortedCheckPaymentCSVExport[i].State + "\",");
                            sbSettlement.Append("\"" + lstSortedCheckPaymentCSVExport[i].Zip + "\",");

                            sbSettlement.Append("\"TRUE\",");
                            sbSettlement.Append("\"CMM Expense:Medical Bill\",");
                            sbSettlement.Append("\"" + lstSortedCheckPaymentCSVExport[i].SettlementAmount.ToString() + "\",");
                            sbSettlement.Append("\"" + lstSortedCheckPaymentCSVExport[i].ServiceDate.ToString("MM/dd/yyyy") + " - " +
                                                lstSortedCheckPaymentCSVExport[i].MedicalProvider.Trim() + "\"" + " - " +
                                                lstSortedCheckPaymentCSVExport[i].AccountNoAtProvider.Trim() + "\"" +
                                                Environment.NewLine);

                            Byte[] settlement = new UTF8Encoding(true).GetBytes(sbSettlement.ToString());
                            fs.Write(settlement, 0, settlement.Length);

                            if (lstSortedCheckPaymentCSVExport.Count > (i + 1))
                            {
                                if (lstSortedCheckPaymentCSVExport[i].MedicalProvider != lstSortedCheckPaymentCSVExport[i + 1].MedicalProvider)
                                {
                                    StringBuilder sbIncidentInfo = new StringBuilder();
                                    sbIncidentInfo.Append(",," + nReferenceNo + ",,,,,,,,,,," + "\"" + lstSortedCheckPaymentCSVExport[i].IncidentProgram.Trim() + " - " +
                                                                                                       lstSortedCheckPaymentCSVExport[i].PatientName.Trim() + " - " +
                                                                                                       lstSortedCheckPaymentCSVExport[i].IncidentNo.Trim() + "\"" +
                                                                                                       Environment.NewLine);
                                    Byte[] incidentInfo = new UTF8Encoding(true).GetBytes(sbIncidentInfo.ToString());
                                    fs.Write(incidentInfo, 0, incidentInfo.Length);

                                    StringBuilder sbIndividualId = new StringBuilder();
                                    sbIndividualId.Append(",," + nReferenceNo + ",,,,,,,,,,," + lstSortedCheckPaymentCSVExport[i].IndividualId + Environment.NewLine);

                                    Byte[] IndividualId = new UTF8Encoding(true).GetBytes(sbIndividualId.ToString());
                                    fs.Write(IndividualId, 0, IndividualId.Length);

                                    nReferenceNo++;
                                }
                            }

                            if ((lstSortedCheckPaymentCSVExport.Count - 1) == i)
                            {
                                // When lstSortedCheckPaymentCSVExport has only one row - 05/20/19
                                StringBuilder sbIncidentInfo = new StringBuilder();
                                sbIncidentInfo.Append(",," + nReferenceNo + ",,,,,,,,,,," + "\"" +
                                                            lstSortedCheckPaymentCSVExport[i].IncidentProgram.Trim() + " - " +
                                                            lstSortedCheckPaymentCSVExport[i].IndividualName.Trim() + " - " +
                                                            lstSortedCheckPaymentCSVExport[i].IncidentNo.Trim() +
                                                            Environment.NewLine);

                                sbIncidentInfo.Append(lstSortedCheckPaymentCSVExport[i].MembershipNo.Trim() +
                                                      "-CMM NEEDS SHARED" +
                                                      Environment.NewLine);
                            }
                        }
                        else if (i > 0)
                        {
                            if (lstSortedCheckPaymentCSVExport[i].MedicalProvider != lstSortedCheckPaymentCSVExport[i - 1].MedicalProvider)
                            {
                                StringBuilder sbSettlement = new StringBuilder();

                                sbSettlement.Append("\"Bank of Hope:Bank of Hope [ACH-Med] (4125)\"" + ",");
                                sbSettlement.Append("\"" + lstSortedCheckPaymentCSVExport[i].MedicalProvider + "\",");
                                sbSettlement.Append("\"" + nReferenceNo.ToString() + "\",");
                                sbSettlement.Append("\"" + lstSortedCheckPaymentCSVExport[i].TransactionDate.ToShortDateString() + "\",");
                                sbSettlement.Append("\"" + "Pt Name:" + lstSortedCheckPaymentCSVExport[i].PatientName + ",Acct#" +
                                                    lstSortedCheckPaymentCSVExport[i].AccountNoAtProvider + "\",");
                                sbSettlement.Append("\"" + lstSortedCheckPaymentCSVExport[i].MedicalProvider + "\",");
                                sbSettlement.Append("\"" + lstSortedCheckPaymentCSVExport[i].StreetAddress + "\",");
                                sbSettlement.Append("\"" + lstSortedCheckPaymentCSVExport[i].City + "\",");
                                sbSettlement.Append("\"" + lstSortedCheckPaymentCSVExport[i].State + "\",");
                                sbSettlement.Append("\"" + lstSortedCheckPaymentCSVExport[i].Zip + "\",");
                                sbSettlement.Append("\"TRUE\",");
                                sbSettlement.Append("\"CMM Expense:Medical Bill\",");
                                sbSettlement.Append("\"" + lstSortedCheckPaymentCSVExport[i].SettlementAmount.ToString() + "\",");
                                sbSettlement.Append("\"" + lstSortedCheckPaymentCSVExport[i].ServiceDate.ToString("MM/dd/yyyy") + " - " +
                                                    lstSortedCheckPaymentCSVExport[i].MedicalProvider + " - " +
                                                    lstSortedCheckPaymentCSVExport[i].AccountNoAtProvider + "\"" +
                                                    Environment.NewLine);


                                //05/22/19
                                
                            }
                        }

                        for (int j = i + 1; j < lstSortedCheckPaymentCSVExport.Count; j++)
                        {
                            if (CurrentMedicalProviderId == lstSortedCheckPaymentCSVExport[j].MedicalProviderId)
                            {
                                if (CurrentIncidentNo == lstSortedCheckPaymentCSVExport[j].IncidentNo)
                                {
                                    StringBuilder sbInnerSettlement = new StringBuilder();
                                    sbInnerSettlement.Append(",," + nReferenceNo + ",,,,,,,,," + "\"CMM Expense:Medical Bill\"," + 
                                                             "\"" + lstSortedCheckPaymentCSVExport[j].SettlementAmount + "\"," +
                                                             "\"" + lstSortedCheckPaymentCSVExport[j].ServiceDate.ToString("MM/dd/yyyy") + " - " +
                                                             lstSortedCheckPaymentCSVExport[j].MedicalProvider +
                                                             Environment.NewLine);

                                    Byte[] innerSettlement = new UTF8Encoding(true).GetBytes(sbInnerSettlement.ToString());
                                    fs.Write(innerSettlement, 0, innerSettlement.Length);
                                }
                                else if (CurrentIncidentNo != lstSortedCheckPaymentCSVExport[j].IncidentNo)
                                {
                                    StringBuilder sbInnerSettlement = new StringBuilder();
                                    sbInnerSettlement.Append(",," + nReferenceNo + ",,,,,,,,,,," + "\"" + lstSortedCheckPaymentCSVExport[j].IncidentProgram + " - \"" +
                                                             lstSortedCheckPaymentCSVExport[j].PatientName +
                                                             " - " + lstSortedCheckPaymentCSVExport[j].IncidentNo + "\"" +
                                                             Environment.NewLine);

                                    Byte[] innerSettlement = new UTF8Encoding(true).GetBytes(sbInnerSettlement.ToString());
                                    fs.Write(innerSettlement, 0, innerSettlement.Length);
                                }
                            }
                            else if (CurrentMedicalProviderId != lstSortedCheckPaymentCSVExport[j].MedicalProviderId)
                            {
                                StringBuilder sbIndividualInfo = new StringBuilder();
                                sbIndividualInfo.Append(",," + nReferenceNo + ",,,,,,,,,,,,," + "\"" + lstSortedCheckPaymentCSVExport[j].IndividualId + Environment.NewLine);
                                sbIndividualInfo.Append(",," + nReferenceNo + ",,,,,,,,,,,,," + "\"" + lstSortedCheckPaymentCSVExport[j].MembershipNo + "-CMM NEEDS SHARED\"" + Environment.NewLine);

                                Byte[] individualInfo = new UTF8Encoding(true).GetBytes(sbIndividualInfo.ToString());
                                fs.Write(individualInfo, 0, individualInfo.Length);

                                nReferenceNo++;
                                break;
                            }
                        }


                        //if (i == 0)
                        //{
                        //    StringBuilder sbSettlement = new StringBuilder();

                        //    sbSettlement.Append("\"Bank of Hope:Bank of Hope [ACH-Med] (4125)" + "\",");
                        //    sbSettlement.Append("\"" + lstSortedCheckPaymentCSVExport[i].MedicalProvider + "\",");
                        //    sbSettlement.Append("\"" + nReferenceNo.ToString() + "\",");
                        //    sbSettlement.Append("\"" + lstSortedCheckPaymentCSVExport[i].TransactionDate.ToShortDateString() + "\",");
                        //    if (lstSortedCheckPaymentCSVExport[i].PatientMiddleName != String.Empty)
                        //    {
                        //        sbSettlement.Append("\"" + "Pt Name:" + lstSortedCheckPaymentCSVExport[i].PatientFirstName +
                        //                                                lstSortedCheckPaymentCSVExport[i].PatientMiddleName.ElementAt(0) + ". " +
                        //                                                lstSortedCheckPaymentCSVExport[i].PatientLastName + ",");
                        //    }
                        //    else
                        //    {
                        //        sbSettlement.Append("\"" + "Pt Name:" + lstSortedCheckPaymentCSVExport[i].PatientFirstName + " " +
                        //                                                lstSortedCheckPaymentCSVExport[i].PatientLastName + ",");
                        //    }
                        //    sbSettlement.Append("Acct# " + lstSortedCheckPaymentCSVExport[i].AccountNoAtProvider + "\",");
                        //    sbSettlement.Append("\"" + lstSortedCheckPaymentCSVExport[i].MedicalProvider + "\",");
                        //    sbSettlement.Append("\"" + lstSortedCheckPaymentCSVExport[i].StreetAddress + "\",");
                        //    sbSettlement.Append("\"" + lstSortedCheckPaymentCSVExport[i].City + "\",");
                        //    sbSettlement.Append("\"" + lstSortedCheckPaymentCSVExport[i].State + "\",");
                        //    sbSettlement.Append("\"" + lstSortedCheckPaymentCSVExport[i].Zip + "\",");

                        //    sbSettlement.Append("\"TRUE\",");
                        //    sbSettlement.Append("\"CMM Expense:Medical Bill\",");
                        //    sbSettlement.Append("\"" + lstSortedCheckPaymentCSVExport[i].SettlementAmount.ToString() + "\",");
                        //    sbSettlement.Append("\"" + lstSortedCheckPaymentCSVExport[i].ServiceDate.ToString("MM/dd/yyyy") + " - " +
                        //                        lstSortedCheckPaymentCSVExport[i].MedicalProvider.Trim() + "\"" + " - " +
                        //                        lstSortedCheckPaymentCSVExport[i].AccountNoAtProvider.Trim() + "\"" +
                        //                        Environment.NewLine);

                        //    Byte[] settlement = new UTF8Encoding(true).GetBytes(sbSettlement.ToString());

                        //    fs.Write(settlement, 0, settlement.Length);

                        //    if (lstSortedCheckPaymentCSVExport.Count > (i + 1))
                        //    {
                        //        if (lstSortedCheckPaymentCSVExport[i].MedicalProviderId != lstSortedCheckPaymentCSVExport[i + 1].MedicalProviderId)
                        //        {
                        //            StringBuilder sbIncidentInfo = new StringBuilder();
                        //            sbIncidentInfo.Append(",," + nReferenceNo + ",,,,,,,,,,," +
                        //                                        "\"" + lstSortedCheckPaymentCSVExport[i].IncidentProgram.Trim() + " - " +
                        //                                        lstSortedCheckPaymentCSVExport[i].PatientName + " - " +
                        //                                        lstSortedCheckPaymentCSVExport[i].IncidentNo + "\"" +
                        //                                        Environment.NewLine);

                        //            Byte[] incidentInfo = new UTF8Encoding(true).GetBytes(sbIncidentInfo.ToString());
                        //            fs.Write(incidentInfo, 0, incidentInfo.Length);

                        //            StringBuilder sbIndividualId = new StringBuilder();
                        //            sbIndividualId.Append(",," + nReferenceNo + ",,,,,,,,,,," + "\"" + lstSortedCheckPaymentCSVExport[i].IndividualId + "\"" + Environment.NewLine);
                        //            Byte[] IndividualId = new UTF8Encoding(true).GetBytes(sbIndividualId.ToString());
                        //            fs.Write(IndividualId, 0, IndividualId.Length);

                        //            StringBuilder sbMemebershipNo = new StringBuilder();
                        //            sbMemebershipNo.Append(",," + nReferenceNo + ",,,,,,,,,,," + "\"" + lstSortedCheckPaymentCSVExport[i].MembershipNo + "-CMM NEEDS SHARED\"" + Environment.NewLine);
                        //            Byte[] MembershipNo = new UTF8Encoding(true).GetBytes(sbMemebershipNo.ToString());
                        //            fs.Write(MembershipNo, 0, MembershipNo.Length);

                        //            nReferenceNo++;
                        //        }
                        //    }
                        //    if (i == lstSortedCheckPaymentCSVExport.Count - 1)
                        //    {
                        //        StringBuilder sbIncidentInfo = new StringBuilder();
                        //        sbIncidentInfo.Append(",," + nReferenceNo + ",,,,,,,,,,," +
                        //                                    "\"" + lstSortedCheckPaymentCSVExport[i].IncidentProgram.Trim() + " - " +
                        //                                    lstSortedCheckPaymentCSVExport[i].PatientName + " - " +
                        //                                    lstSortedCheckPaymentCSVExport[i].IncidentNo + "\"" +
                        //                                    Environment.NewLine);

                        //        Byte[] incidentInfo = new UTF8Encoding(true).GetBytes(sbIncidentInfo.ToString());
                        //        fs.Write(incidentInfo, 0, incidentInfo.Length);

                        //        StringBuilder sbIndividualId = new StringBuilder();
                        //        sbIndividualId.Append(",," + nReferenceNo + ",,,,,,,,,,," + "\"" + lstSortedCheckPaymentCSVExport[i].IndividualId + "\"" + Environment.NewLine);
                        //        Byte[] IndividualId = new UTF8Encoding(true).GetBytes(sbIndividualId.ToString());
                        //        fs.Write(IndividualId, 0, IndividualId.Length);

                        //        StringBuilder sbMemebershipNo = new StringBuilder();
                        //        sbMemebershipNo.Append(",," + nReferenceNo + ",,,,,,,,,,," + "\"" + lstSortedCheckPaymentCSVExport[i].MembershipNo + "-CMM NEEDS SHARED\"" + Environment.NewLine);
                        //        Byte[] MembershipNo = new UTF8Encoding(true).GetBytes(sbMemebershipNo.ToString());
                        //        fs.Write(MembershipNo, 0, MembershipNo.Length);

                        //        nReferenceNo++;
                        //    }
                        //}
                        //else if (i > 0)
                        //{
                        //    //if (lstSortedCheckPaymentCSVExport[i].IndividualId != lstSortedCheckPaymentCSVExport[i - 1].IndividualId)
                        //    if (lstSortedCheckPaymentCSVExport[i].MedicalProviderId != lstSortedCheckPaymentCSVExport[i - 1].MedicalProviderId)
                        //    {
                        //        StringBuilder sbSettlement = new StringBuilder();

                        //        sbSettlement.Append("\"Bank of Hope:Bank of Hope [ACH-Med] (4125)" + "\",");
                        //        sbSettlement.Append("\"" + lstSortedCheckPaymentCSVExport[i].MedicalProvider + "\",");
                        //        sbSettlement.Append("\"" + nReferenceNo.ToString() + "\",");
                        //        sbSettlement.Append("\"" + lstSortedCheckPaymentCSVExport[i].TransactionDate.ToShortDateString() + "\",");
                        //        if (lstSortedCheckPaymentCSVExport[i].PatientMiddleName != String.Empty)
                        //        {
                        //            sbSettlement.Append("\"" + "Pt Name:" + lstSortedCheckPaymentCSVExport[i].PatientFirstName +
                        //                                                    lstSortedCheckPaymentCSVExport[i].PatientMiddleName.ElementAt(0) + ". " +
                        //                                                    lstSortedCheckPaymentCSVExport[i].PatientLastName + ",");
                        //        }
                        //        else
                        //        {
                        //            sbSettlement.Append("\"" + "Pt Name:" + lstSortedCheckPaymentCSVExport[i].PatientFirstName + " " +
                        //                                                    lstSortedCheckPaymentCSVExport[i].PatientLastName + ",");
                        //        }
                        //        sbSettlement.Append("Acct# " + lstSortedCheckPaymentCSVExport[i].AccountNoAtProvider + "\",");
                        //        sbSettlement.Append("\"" + lstSortedCheckPaymentCSVExport[i].MedicalProvider + "\",");
                        //        sbSettlement.Append("\"" + lstSortedCheckPaymentCSVExport[i].StreetAddress + "\",");
                        //        sbSettlement.Append("\"" + lstSortedCheckPaymentCSVExport[i].City + "\",");
                        //        sbSettlement.Append("\"" + lstSortedCheckPaymentCSVExport[i].State + "\",");
                        //        sbSettlement.Append("\"" + lstSortedCheckPaymentCSVExport[i].Zip + "\",");

                        //        sbSettlement.Append("\"TRUE\",");
                        //        sbSettlement.Append("\"CMM Expense:Medical Bill\",");
                        //        sbSettlement.Append("\"" + lstSortedCheckPaymentCSVExport[i].SettlementAmount.ToString() + "\",");
                        //        sbSettlement.Append("\"" + lstSortedCheckPaymentCSVExport[i].ServiceDate.ToString("MM/dd/yyyy") + " - " +
                        //                            lstSortedCheckPaymentCSVExport[i].MedicalProvider.Trim() + "\"" + " - " +
                        //                            lstSortedCheckPaymentCSVExport[i].AccountNoAtProvider + "\"" +
                        //                            Environment.NewLine);

                        //        Byte[] settlement = new UTF8Encoding(true).GetBytes(sbSettlement.ToString());

                        //        fs.Write(settlement, 0, settlement.Length);

                        //        if (lstSortedCheckPaymentCSVExport.Count > (i + 1))
                        //        {
                        //            if (lstSortedCheckPaymentCSVExport[i].IndividualId != lstSortedCheckPaymentCSVExport[i + 1].IndividualId)
                        //            {
                        //                StringBuilder sbIncidentInfo = new StringBuilder();
                        //                sbIncidentInfo.Append(",," + nReferenceNo + ",,,,,,,,,,," +
                        //                                            "\"" + lstSortedCheckPaymentCSVExport[i].IncidentProgram.Trim() + " - " +
                        //                                            lstSortedCheckPaymentCSVExport[i].PatientName + " - " +
                        //                                            lstSortedCheckPaymentCSVExport[i].IncidentNo + "\"" +
                        //                                            Environment.NewLine);

                        //                Byte[] incidentInfo = new UTF8Encoding(true).GetBytes(sbIncidentInfo.ToString());

                        //                fs.Write(incidentInfo, 0, incidentInfo.Length);
                        //                nReferenceNo++;
                        //            }
                        //        }
                        //        if (i == lstSortedCheckPaymentCSVExport.Count - 1)
                        //        {
                        //            StringBuilder sbIncidentInfo = new StringBuilder();
                        //            sbIncidentInfo.Append(",," + nReferenceNo + ",,,,,,,,,,," +
                        //                                        "\"" + lstSortedCheckPaymentCSVExport[i].IncidentProgram.Trim() + " - " +
                        //                                        lstSortedCheckPaymentCSVExport[i].PatientName + " - " +
                        //                                        lstSortedCheckPaymentCSVExport[i].IncidentNo + "\"" +
                        //                                        Environment.NewLine);

                        //            Byte[] incidentInfo = new UTF8Encoding(true).GetBytes(sbIncidentInfo.ToString());

                        //            fs.Write(incidentInfo, 0, incidentInfo.Length);
                        //            nReferenceNo++;
                        //        }
                        //    }
                        //    else if (lstSortedCheckPaymentCSVExport[i].IndividualId == lstSortedCheckPaymentCSVExport[i - 1].IndividualId)
                        //    {
                        //        //StringBuilder sbSettlement = new StringBuilder();

                        //        //if (lstSortedCheckPaymentCSVExport[i].AccountNoAtProvider != String.Empty)
                        //        //{
                        //        //    sbSettlement.Append(",," + nReferenceNo.ToString() + ",,,,,,,,,,," + 
                        //        //                        lstSortedCheckPaymentCSVExport[i].SettlementAmount.ToString() + "," +
                        //        //                        "\"" + lstSortedCheckPaymentCSVExport[i].ServiceDate.ToString("MM/dd/yyyy") + " - " +
                        //        //                        lstSortedCheckPaymentCSVExport[i].MedicalProvider + " - " +
                        //        //                        lstSortedCheckPaymentCSVExport[i].AccountNoAtProvider + "\"" +
                        //        //                        Environment.NewLine);
                        //        //}
                        //        //else
                        //        //{
                        //        //    sbSettlement.Append(",," + nReferenceNo.ToString() + ",,,,,,,,,,," +
                        //        //                        lstSortedCheckPaymentCSVExport[i].SettlementAmount.ToString() + "," +
                        //        //                        "\"" + lstSortedCheckPaymentCSVExport[i].ServiceDate.ToString("MM/dd/yyyy") + " - " +
                        //        //                        lstSortedCheckPaymentCSVExport[i].MedicalProvider + "\"" +
                        //        //                        Environment.NewLine);
                        //        //}

                        //        //Byte[] settlement = new UTF8Encoding(true).GetBytes(sbSettlement.ToString());

                        //        //fs.Write(settlement, 0, settlement.Length);

                        //        if (lstSortedCheckPaymentCSVExport.Count > (i + 3))
                        //        {

                        //            StringBuilder sbIncidentInfo = new StringBuilder();

                        //            if (lstSortedCheckPaymentCSVExport[i].PatientMiddleName != String.Empty)
                        //            {
                        //                sbIncidentInfo.Append(",," + nReferenceNo + ",,,,,,,,,,," +
                        //                                            lstSortedCheckPaymentCSVExport[i].IncidentProgram.Trim() + " - " +
                        //                                            lstSortedCheckPaymentCSVExport[i].PatientFirstName + " " +
                        //                                            lstSortedCheckPaymentCSVExport[i].PatientMiddleName[0].ToString().ToUpper() + ". " + 
                        //                                            lstSortedCheckPaymentCSVExport[i].PatientLastName + " - " +
                        //                                            lstSortedCheckPaymentCSVExport[i].IncidentNo +
                        //                                            Environment.NewLine);
                        //            }



                        //            Byte[] incidentInfo = new UTF8Encoding(true).GetBytes(sbIncidentInfo.ToString());
                        //            fs.Write(incidentInfo, 0, incidentInfo.Length);

                        //            StringBuilder sbIndividualID = new StringBuilder();
                        //            sbIndividualID.Append(",," + nReferenceNo + ",,,,,,,,,,," + lstSortedCheckPaymentCSVExport[i].IndividualId + Environment.NewLine);

                        //            Byte[] IndividualID = new UTF8Encoding(true).GetBytes(sbIndividualID.ToString());

                        //            fs.Write(IndividualID, 0, IndividualID.Length);

                        //            StringBuilder sbMembershipNo = new StringBuilder();
                        //            sbMembershipNo.Append(",," + nReferenceNo + ",,,,,,,,,,," + lstSortedCheckPaymentCSVExport[i].MembershipNo.Trim() + "-CMM NEEDS SHARED");
                        //            nReferenceNo++;

                        //        }
                        //        //if (i == lstSortedCheckPaymentCSVExport.Count - 1)
                        //        //{
                        //        //    StringBuilder sbIncidentInfo = new StringBuilder();
                        //        //    sbIncidentInfo.Append(",," + nReferenceNo + ",,,,,,,,,,," +
                        //        //                                lstSortedCheckPaymentCSVExport[i].IncidentProgram.Trim() + " - " +
                        //        //                                lstSortedCheckPaymentCSVExport[i].PatientName + " - " +
                        //        //                                lstSortedCheckPaymentCSVExport[i].IncidentNo +
                        //        //                                Environment.NewLine);

                        //        //    Byte[] incidentInfo = new UTF8Encoding(true).GetBytes(sbIncidentInfo.ToString());

                        //        //    fs.Write(incidentInfo, 0, incidentInfo.Length);
                        //        //    nReferenceNo++;
                        //        //}
                        //    }
                        //}





                    }
                }

                Boolean bExportSucceeded = true;

                foreach (CheckPaymentCSVExportInfo info in lstSortedCheckPaymentCSVExport)
                {
                    String strSqlUpdateSettlementForCheckPaymentExport = "update [dbo].[tbl_settlement] set [dbo].[tbl_settlement].[IsCheckExported] = 1, " +
                                                                         "[dbo].[tbl_settlement].[CheckExportedByID] = @ExportedByID " +
                                                                         "where [dbo].[tbl_settlement].[Name] = @SettlementNo";

                    SqlCommand cmdUpdateSettlemetnForCheckPaymentExport = new SqlCommand(strSqlUpdateSettlementForCheckPaymentExport, connRN5);
                    cmdUpdateSettlemetnForCheckPaymentExport.CommandType = CommandType.Text;

                    cmdUpdateSettlemetnForCheckPaymentExport.Parameters.AddWithValue("@ExportedByID", nLoggedUserId);
                    cmdUpdateSettlemetnForCheckPaymentExport.Parameters.AddWithValue("@SettlementNo", info.SettlementNo);

                    if (connRN5.State != ConnectionState.Closed)
                    {
                        connRN5.Close();
                        connRN5.Open();
                    }
                    else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                    int nSettlementExported = cmdUpdateSettlemetnForCheckPaymentExport.ExecuteNonQuery();
                    if (connRN5.State == ConnectionState.Open) connRN5.Close();
                    if (nSettlementExported != 1) bExportSucceeded = false;
                }
                Cursor.Current = Cursors.Default;

                if (bExportSucceeded)
                {
                    MessageBox.Show("Check payments have been exported.", "Info");
                    return;
                }
                else
                {
                    MessageBox.Show("At least one of check payment has not been exported.", "Error");
                    return;
                }
            }
        }

        private void gvPaymentCheckProvider_ColumnHeaderMouseDoubleClick(object sender, DataGridViewCellMouseEventArgs e)
        {
            Boolean bAllProviderCheckPaymentSelected = true;

            if (e.ColumnIndex == 0)
            {
                for (int i = 0; i < gvPaymentCheckProvider.Rows.Count; i++)
                {
                    if (Boolean.Parse(gvPaymentCheckProvider["SelectedProviderPaymentCheck", i].Value.ToString()) == false) bAllProviderCheckPaymentSelected = false;
                }

                if (bAllProviderCheckPaymentSelected == false)
                {
                    for (int i = 0; i < gvPaymentCheckProvider.Rows.Count; i++)
                    {
                        gvPaymentCheckProvider["SelectedProviderPaymentCheck", i].Value = true;
                    }
                }
                else if (bAllProviderCheckPaymentSelected == true)
                {
                    for (int i = 0; i < gvPaymentCheckProvider.Rows.Count; i++)
                    {
                        gvPaymentCheckProvider["SelectedProviderPaymentCheck", i].Value = false;
                    }
                }
            }
        }

        private void btnConfirmCheckProviderPayment_Click(object sender, EventArgs e)
        {
            frmConfirmCheckPayment frmConfirm = new frmConfirmCheckPayment();
            DialogResult ConfirmDialog = frmConfirm.ShowDialog();

            if (ConfirmDialog == DialogResult.OK)
            {
                Cursor.Current = Cursors.WaitCursor;

                DateTime CheckDate = frmConfirm.CheckDate;
                int nCheckNo = frmConfirm.CheckNumber;

                String BeginningIndividualId = String.Empty;
                for (int i = 0; i < gvPaymentCheckProvider.Rows.Count; i++)
                {
                    if (Boolean.Parse(gvPaymentCheckProvider["ExportedProviderPaymentCheck", i].Value.ToString()) == true)
                    {
                        BeginningIndividualId = gvPaymentCheckProvider["IndividualIdProviderPaymentCheck", i].Value.ToString();
                        break;
                    }
                }

                Boolean bSettlementUpdated = true;
                for (int i = 0; i < gvPaymentCheckProvider.Rows.Count; i++)
                {
                    if ((Boolean.Parse(gvPaymentCheckProvider["ExportedProviderPaymentCheck", i].Value.ToString()) == true))
                    {
                        String IndividualIdCheckPaymentToProvider = String.Empty;
                        if (gvPaymentCheckProvider["IndividualIdProviderPaymentCheck", i].Value != null)
                            IndividualIdCheckPaymentToProvider = gvPaymentCheckProvider["IndividualIdProviderPaymentCheck", i].Value.ToString().Trim();
                        if (BeginningIndividualId == IndividualIdCheckPaymentToProvider)
                        {
                            String SettlementNo = String.Empty;
                            if (gvPaymentCheckProvider["SettlementNoProviderPaymentCheck", i].Value != null)
                                SettlementNo = gvPaymentCheckProvider["SettlementNoProviderPaymentCheck", i].Value.ToString().Trim();

                            String strSqlUpdateSettlementForCheckPaymentToProvider = "update [dbo].[tbl_settlement] set [dbo].[tbl_settlement].[IsPaid] = 1, " +
                                                                                              "[dbo].[tbl_settlement].[PaidByID] = @PaidByID, " +
                                                                                              "[dbo].[tbl_settlement].[CheckDate] = @CheckDate, " +
                                                                                              "[dbo].[tbl_settlement].[CheckNo] = @CheckNo " +
                                                                                              "where [dbo].[tbl_settlement].[Name] = @SettlementNo";

                            SqlCommand cmdUpdateSettlementForCheckPaymentToProvider = new SqlCommand(strSqlUpdateSettlementForCheckPaymentToProvider, connRN5);
                            cmdUpdateSettlementForCheckPaymentToProvider.CommandType = CommandType.Text;

                            cmdUpdateSettlementForCheckPaymentToProvider.Parameters.AddWithValue("@PaidByID", nLoggedUserId);
                            cmdUpdateSettlementForCheckPaymentToProvider.Parameters.AddWithValue("@CheckDate", CheckDate);
                            cmdUpdateSettlementForCheckPaymentToProvider.Parameters.AddWithValue("@CheckNo", nCheckNo);
                            cmdUpdateSettlementForCheckPaymentToProvider.Parameters.AddWithValue("@SettlementNo", SettlementNo);

                            if (connRN5.State != ConnectionState.Closed)
                            {
                                connRN5.Close();
                                connRN5.Open();
                            }
                            else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                            int nSettlementUpdated = cmdUpdateSettlementForCheckPaymentToProvider.ExecuteNonQuery();
                            if (connRN5.State != ConnectionState.Closed) connRN5.Close();
                            if (nSettlementUpdated == 0) bSettlementUpdated = false;
                        }
                        else
                        {
                            BeginningIndividualId = IndividualIdCheckPaymentToProvider;
                            nCheckNo++;

                            String SettlementNo = String.Empty;
                            if (gvPaymentCheckProvider["SettlementNoProviderPaymentCheck", i].Value != null)
                                SettlementNo = gvPaymentCheckProvider["SettlementNoProviderPaymentCheck", i].Value.ToString().Trim();

                            String strSqlUpdateSettlementForCheckPaymentToProvider = "update [dbo].[tbl_settlement] set [dbo].[tbl_settlement].[IsPaid] = 1, " +
                                                                                              "[dbo].[tbl_settlement].[PaidByID] = @PaidByID, " +
                                                                                              "[dbo].[tbl_settlement].[CheckDate] = @CheckDate, " +
                                                                                              "[dbo].[tbl_settlement].[CheckNo] = @CheckNo " +
                                                                                              "where [dbo].[tbl_settlement].[Name] = @SettlementNo";

                            SqlCommand cmdUpdateSettlementForCheckPaymentToProvider = new SqlCommand(strSqlUpdateSettlementForCheckPaymentToProvider, connRN5);
                            cmdUpdateSettlementForCheckPaymentToProvider.CommandType = CommandType.Text;

                            cmdUpdateSettlementForCheckPaymentToProvider.Parameters.AddWithValue("@PaidByID", nLoggedUserId);
                            cmdUpdateSettlementForCheckPaymentToProvider.Parameters.AddWithValue("@CheckDate", CheckDate);
                            cmdUpdateSettlementForCheckPaymentToProvider.Parameters.AddWithValue("@CheckNo", nCheckNo);
                            cmdUpdateSettlementForCheckPaymentToProvider.Parameters.AddWithValue("@SettlementNo", SettlementNo);

                            if (connRN5.State != ConnectionState.Closed)
                            {
                                connRN5.Close();
                                connRN5.Open();
                            }
                            else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                            int nSettlementUpdated = cmdUpdateSettlementForCheckPaymentToProvider.ExecuteNonQuery();
                            if (connRN5.State != ConnectionState.Closed) connRN5.Close();
                            if (nSettlementUpdated == 0) bSettlementUpdated = false;
                        }
                    }
                }

                Cursor.Current = Cursors.Default;

                if (bSettlementUpdated == true)
                {
                    MessageBox.Show("Settlements have been updated for member reimbursement.", "Info");
                    return;
                }
                else
                {
                    MessageBox.Show("At least one of settlement has not been updated for member reimbursement.", "Error");
                    return;
                }
            }
            else if (ConfirmDialog == DialogResult.Cancel) return;
        }

        private void rbCheckBlueSheet_CheckedChanged(object sender, EventArgs e)
        {
            RadioButton rbCheck = (RadioButton)sender;

            if (rbCheck.Checked)
            {
                txtCheckNoBlueSheet.Enabled = true;
                txtCheckNoBlueSheet.ReadOnly = false;
                dtpCheckIssueDateBlueSheet.Enabled = true;

                txtACHNoBlueSheet.Text = String.Empty;
                txtACHNoBlueSheet.Enabled = false;
                txtACHNoBlueSheet.ReadOnly = true;
                txtCreditCardNoBlueSheet.Text = String.Empty;
                txtCreditCardNoBlueSheet.Enabled = false;
                txtCreditCardNoBlueSheet.ReadOnly = true;
                dtpACHTransactionDateBlueSheet.Enabled = false;
                dtpCreditCardPaymentDateBlueSheet.Enabled = false;
            }
        }

        private void rbACHBlueSheet_CheckedChanged(object sender, EventArgs e)
        {
            RadioButton rbACH = (RadioButton)sender;

            if (rbACH.Checked)
            {
                txtACHNoBlueSheet.Enabled = true;
                txtACHNoBlueSheet.ReadOnly = false;
                dtpACHTransactionDateBlueSheet.Enabled = true;

                txtCheckNoBlueSheet.Text = String.Empty;
                txtCheckNoBlueSheet.Enabled = false;
                txtCheckNoBlueSheet.ReadOnly = true;
                txtCreditCardNoBlueSheet.Text = String.Empty;
                txtCreditCardNoBlueSheet.Enabled = false;
                txtCreditCardNoBlueSheet.ReadOnly = true;
                dtpCheckIssueDateBlueSheet.Enabled = false;
                dtpCreditCardPaymentDateBlueSheet.Enabled = false;
            }
        }

        private void rbCreditCardBlueSheet_CheckedChanged(object sender, EventArgs e)
        {
            RadioButton rbCreditCard = (RadioButton)sender;

            if (rbCreditCard.Checked)
            {
                txtCreditCardNoBlueSheet.Enabled = true;
                txtCreditCardNoBlueSheet.ReadOnly = false;
                dtpCreditCardPaymentDateBlueSheet.Enabled = true;

                txtCheckNoBlueSheet.Text = String.Empty;
                txtCheckNoBlueSheet.Enabled = false;
                txtCheckNoBlueSheet.ReadOnly = true;
                txtACHNoBlueSheet.Text = String.Empty;
                txtACHNoBlueSheet.Enabled = false;
                txtACHNoBlueSheet.ReadOnly = true;
                dtpCheckIssueDateBlueSheet.Enabled = false;
                dtpACHTransactionDateBlueSheet.Enabled = false;
            }
        }

        private void rbNoSharingOnlyBlueSheet_CheckedChanged(object sender, EventArgs e)
        {
            RadioButton rbNoSharingOnly = (RadioButton)sender;

            if (rbNoSharingOnly.Checked)
            {
                txtIncidentNoBlueSheet.Enabled = true;
                txtIncidentNoBlueSheet.ReadOnly = false;

                txtCheckNoBlueSheet.Enabled = false;
                txtACHNoBlueSheet.Enabled = false;
                txtCreditCardNoBlueSheet.Enabled = false;
                dtpCheckIssueDateBlueSheet.Enabled = false;
                dtpACHTransactionDateBlueSheet.Enabled = false;
                dtpCreditCardPaymentDateBlueSheet.Enabled = false;
            }
        }

        private void btnSearchBlueSheet_Click(object sender, EventArgs e)
        {
            Cursor.Current = Cursors.WaitCursor;

            if (txtIndividualIDBlueSheet.Text.Trim() == String.Empty)
            {
                MessageBox.Show("You haven't entered Individual ID.", "Error");
                return;
            }

            if (rbCheckBlueSheet.Checked && txtCheckNoBlueSheet.Text.Trim() == String.Empty && txtIncidentNoBlueSheet.Text.Trim() == String.Empty)
            {
                MessageBox.Show("Please enter check number", "Alert");
                return;
            }
            else strCheckNoBlueSheet = txtCheckNoBlueSheet.Text;

            if (rbACHBlueSheet.Checked && txtACHNoBlueSheet.Text.Trim() == String.Empty && txtIncidentNoBlueSheet.Text.Trim() == String.Empty)
            {
                MessageBox.Show("Please enter ACH number.", "Alert");
                return;
            }

            strPrimaryNameBlueSheet = String.Empty;
            strMembershipIdBlueSheet = String.Empty;
            strIndividualIDBlueSheet = String.Empty;
            strIndividualNameBlueSheet = String.Empty;
            strStreetAddressBlueSheet = String.Empty;
            strCityBlueSheet = String.Empty;
            strStateBlueSheet = String.Empty;
            strZipBlueSheet = String.Empty;

            // Initialize HasRow boolean variables
            bPaidHasRowBlueSheet = false;
            bCMMPendingPaymentHasRowBlueSheet = false;
            bPendingHasRowBlueSheet = false;
            bIneligibleHasRowBlueSheet = false;

            gvSharedMedBillBlueSheet.DataSource = null;
            gvCMMPendingPaymentBlueSheet.DataSource = null;
            gvPendingBlueSheet.DataSource = null;
            gvIneligibleBlueSheet.DataSource = null;
            gvSummaryBlueSheet.DataSource = null;

            gvSharedInPaidTab.DataSource = null;
            gvCMMPendingPaymentInTab.DataSource = null;
            gvPendingInTab.DataSource = null;
            gvIneligibleInTab.DataSource = null;
            gvPersonalResponsibility.DataSource = null;
            gvIneligibleNoSharing.DataSource = null;

            //BlueSheetSForce.Settlement__c settlement = null;
            //List<BlueSheetSForce.Settlement__c> lstSettlement = new List<BlueSheetSForce.Settlement__c>();
            //List<BlueSheetSForce.Settlement__c> lstDistinctSettlements = new List<BlueSheetSForce.Settlement__c>();

            List<MedBillCheckInfo> lstMedBillCheckInfo = new List<MedBillCheckInfo>();
            List<MedBillACHInfo> lstMedBillACHInfo = new List<MedBillACHInfo>();
            List<MedBillCreditCardPaymentInfo> lstMedBillCreditCardInfo = new List<MedBillCreditCardPaymentInfo>();
            List<IncidentInfo> lstIncidentInfo = new List<IncidentInfo>();

            lstIncidentsBlueSheet = new List<IncidentBlueSheet>();

            List<String> lstMedBillNamesBlueSheet = new List<String>();
            List<String> lstDistinctMedBillNamesBlueSheet = new List<String>();
            List<String> lstDistinctMedBillNoSharingBlueSheet = new List<String>();

            List<String> lstIncdNamesBlueSheet = new List<String>();
            List<String> lstDistinctIncdNamesBlueSheet = new List<String>();

            ChkInfoEnteredBlueSheet = null;
            ACHInfoEnteredBlueSheet = null;
            CreditCardPaymentEnteredBlueSheet = null;

            if (rbNoSharingOnlyBlueSheet.Checked)
            {

            }
            if (!rbNoSharingOnlyBlueSheet.Checked)
            {
                if (rbCheckBlueSheet.Checked)
                {
                    ChkInfoEnteredBlueSheet = new CheckInfoBlueSheet();

                    if (txtCheckNoBlueSheet.Text.Trim() != String.Empty)
                    {
                        String strSqlQueryForMedBill = "select [RN_DB].[dbo].[tbl_medbill].[BillNo], [SalesForce].[dbo].[account].[Name], " +
                                                       "[RN_DB].[dbo].[tbl_settlement].[CheckNo], [RN_DB].[dbo].[tbl_settlement].[CheckDate], " +
                                                       "[RN_DB].[dbo].[tbl_settlement].[Amount], [RN_DB].[dbo].[tbl_settlement].[Name], " +
                                                       "[SalesForce].[dbo].[contact].[Primary_Name__c], " +
                                                       //"[SalesForce].[dbo].[contact].[MailingStreet], [SalesForce].[dbo].[contact].[MailingCity], " +
                                                       //"[SalesForce].[dbo].[contact].[MailingState], [SalesForce].[dbo].[contact].[MailingPostalCode], " +
                                                       "[SalesForce].[dbo].[Account].[ShippingStreet], [SalesForce].[dbo].[Account].[ShippingCity], " +
                                                       "[SalesForce].[dbo].[Account].[ShippingState], [SalesForce].[dbo].[Account].[ShippingPostalCode], " +
                                                       //"[dbo].[Account].[BillingStreet], [dbo].[Account].[BillingCity], [dbo].[Account].[BillingState], [dbo].[Account].[BillingPostalCode], " +
                                                       "[SalesForce].[dbo].[membership].[Name], " +
                                                       "[SalesForce].[dbo].[contact].[Name], " +
                                                       "[SalesForce].[dbo].[contact].[LastName], [SalesForce].[dbo].[contact].[MiddleName], [SalesForce].[dbo].[contact].[FirstName], " +
                                                       "[SalesForce].[dbo].[contact].[Individual_ID__c] " +
                                                       "from [RN_DB].[dbo].[tbl_settlement] " +
                                                       "inner join [RN_DB].[dbo].[tbl_settlement_type_code] on [RN_DB].[dbo].[tbl_settlement].[SettlementType] = [RN_DB].[dbo].[tbl_settlement_type_code].[SettlementTypeCode] " +
                                                       "inner join [RN_DB].[dbo].[tbl_medbill] on [RN_DB].[dbo].[tbl_settlement].[MedicalBillID] = [RN_DB].[dbo].[tbl_medbill].[BillNo] " +
                                                       "inner join [SalesForce].[dbo].[contact] on [RN_DB].[dbo].[tbl_medbill].[Individual_Id] = [SalesForce].[dbo].[contact].[Individual_ID__c] " +
                                                       "inner join [SalesForce].[dbo].[membership] on [SalesForce].[dbo].[contact].[c4g_Membership__c] = [SalesForce].[dbo].[membership].[Id] " +
                                                       "inner join [SalesForce].[dbo].[account] on [SalesForce].[dbo].[contact].[AccountId] = [SalesForce].[dbo].[account].[Id] " +
                                                       "where ([RN_DB].[dbo].[tbl_settlement_type_code].[SettlementTypeValue] = 'CMM Member Reimbursement' or " +
                                                       "[RN_DB].[dbo].[tbl_settlement_type_code].[SettlementTypeValue] = 'PR Reimbursement' or " +
                                                       "[RN_DB].[dbo].[tbl_settlement_type_code].[SettlementTypeValue] = 'CMM Provider Payment') and " +
                                                       "[RN_DB].[dbo].[tbl_medbill].[Individual_Id] like '%' + @IndividualId + '%' and " +
                                                       "[RN_DB].[dbo].[tbl_settlement].[CheckNo] = @CheckNo and " +
                                                       "[RN_DB].[dbo].[tbl_settlement].[CheckDate] IS NOT NULL and " +
                                                       "cast([RN_DB].[dbo].[tbl_settlement].[CheckDate] as date) = @CheckDate ";

                        SqlCommand cmdQueryForMedBill = new SqlCommand(strSqlQueryForMedBill, connRN6);
                        cmdQueryForMedBill.CommandType = CommandType.Text;

                        cmdQueryForMedBill.Parameters.AddWithValue("@IndividualId", txtIndividualIDBlueSheet.Text.Trim());
                        cmdQueryForMedBill.Parameters.AddWithValue("@CheckNo", txtCheckNoBlueSheet.Text.Trim());
                        cmdQueryForMedBill.Parameters.AddWithValue("@CheckDate", dtpCheckIssueDateBlueSheet.Value.ToString("yyyy-MM-dd"));

                        if (connRN6.State != ConnectionState.Closed)
                        {
                            connRN6.Close();
                            connRN6.Open();
                        }
                        else if (connRN6.State == ConnectionState.Closed) connRN6.Open();
                        SqlDataReader rdrMedBillInfo = cmdQueryForMedBill.ExecuteReader();
                        if (rdrMedBillInfo.HasRows)
                        {
                            while (rdrMedBillInfo.Read())
                            {
                                if (!rdrMedBillInfo.IsDBNull(4)) ChkInfoEnteredBlueSheet.CheckAmount += Double.Parse(rdrMedBillInfo.GetDecimal(4).ToString());
                                if (!rdrMedBillInfo.IsDBNull(2)) ChkInfoEnteredBlueSheet.CheckNumber = rdrMedBillInfo.GetString(2);
                                if (!rdrMedBillInfo.IsDBNull(6)) strPrimaryNameBlueSheet = rdrMedBillInfo.GetString(6);
                                if (!rdrMedBillInfo.IsDBNull(7)) strStreetAddressBlueSheet = rdrMedBillInfo.GetString(7);
                                if (!rdrMedBillInfo.IsDBNull(8)) strCityBlueSheet = rdrMedBillInfo.GetString(8);
                                if (!rdrMedBillInfo.IsDBNull(9)) strStateBlueSheet = rdrMedBillInfo.GetString(9);
                                if (!rdrMedBillInfo.IsDBNull(10)) strZipBlueSheet = rdrMedBillInfo.GetString(10);
                                if (!rdrMedBillInfo.IsDBNull(11)) strMembershipIdBlueSheet = rdrMedBillInfo.GetString(11);
                                if (!rdrMedBillInfo.IsDBNull(12)) strIndividualNameBlueSheet = rdrMedBillInfo.GetString(12);
                                if (!rdrMedBillInfo.IsDBNull(13)) strIndividualLastNameBlueSheet = rdrMedBillInfo.GetString(13);
                                if (!rdrMedBillInfo.IsDBNull(14)) strIndividualMiddleNameBlueSheet = rdrMedBillInfo.GetString(14);
                                if (!rdrMedBillInfo.IsDBNull(15)) strIndiviaualFirstNameBlueSheet = rdrMedBillInfo.GetString(15);
                                if (!rdrMedBillInfo.IsDBNull(16)) strIndividualIDBlueSheet = rdrMedBillInfo.GetString(16);

                            }
                        }
                        rdrMedBillInfo.Close();
                        if (connRN6.State != ConnectionState.Closed) connRN6.Close();
                    }
                    else
                    {
                        MessageBox.Show("Please enter check no.", "Alert");
                        return;
                    }

                    if (txtCheckNoBlueSheet.Text.Trim() != String.Empty)
                    {
                        String strSqlQueryForIncidents = "select [RN_DB].[dbo].[tbl_incident].[IncidentNo], [RN_DB].[dbo].[tbl_settlement_type_code].[SettlementTypeValue], " +
                                                         "[SalesForce].[dbo].[account].[Name], [SalesForce].[dbo].[contact].[Name] " +
                                                         "from [RN_DB].[dbo].[tbl_settlement] " +
                                                         "inner join [RN_DB].[dbo].[tbl_settlement_type_code] on [RN_DB].[dbo].[tbl_settlement].[SettlementType] = [RN_DB].[dbo].[tbl_settlement_type_code].[SettlementTypeCode] " +
                                                         "inner join [RN_DB].[dbo].[tbl_medbill] on [RN_DB].[dbo].[tbl_settlement].[MedicalBillID] = [RN_DB].[dbo].[tbl_medbill].[BillNo] " +
                                                         "inner join [RN_DB].[dbo].[tbl_incident] on [RN_DB].[dbo].[tbl_medbill].[Incident_Id] = [RN_DB].[dbo].[tbl_incident].[Incident_id] " +
                                                         "inner join [SalesForce].[dbo].[contact] on [RN_DB].[dbo].[tbl_medbill].[Individual_Id] = [SalesForce].[dbo].[contact].[Individual_ID__c] " +
                                                         "inner join [SalesForce].[dbo].[account] on [SalesForce].[dbo].[contact].[AccountId] = [SalesForce].[dbo].[account].[Id] " +
                                                         "where ([RN_DB].[dbo].[tbl_settlement_type_code].[SettlementTypeValue] = 'CMM Member Reimbursement' or " +
                                                         "[RN_DB].[dbo].[tbl_settlement_type_code].[SettlementTypeValue] = 'PR reimbursement' or " +
                                                         "[RN_DB].[dbo].[tbl_settlement_type_code].[SettlementTypeValue] = 'CMM Provider Payment') and " +
                                                         "[RN_DB].[dbo].[tbl_medbill].[Individual_Id] like '%' + @IndividualId + '%' and " +
                                                         "[RN_DB].[dbo].[tbl_settlement].[CheckNo] = @CheckNo and " +
                                                         "[RN_DB].[dbo].[tbl_settlement].[CheckDate] IS NOT NULL and " +
                                                         "cast([RN_DB].[dbo].[tbl_settlement].[CheckDate] as date) = @CheckDate";

                        SqlCommand cmdQueryForIncidents = new SqlCommand(strSqlQueryForIncidents, connRN6);
                        cmdQueryForIncidents.CommandType = CommandType.Text;

                        String CheckIssueDate = dtpCheckIssueDateBlueSheet.Value.ToString("MM/dd/yyyy");

                        cmdQueryForIncidents.Parameters.AddWithValue("@IndividualId", txtIndividualIDBlueSheet.Text.Trim());
                        cmdQueryForIncidents.Parameters.AddWithValue("@CheckNo", txtCheckNoBlueSheet.Text.Trim());
                        //cmdQueryForIncidents.Parameters.AddWithValue("@CheckDate", dtpCheckIssueDateBlueSheet.Value.ToString("yyyy-MM-dd"));
                        cmdQueryForIncidents.Parameters.AddWithValue("@CheckDate", CheckIssueDate);

                        if (connRN6.State != ConnectionState.Closed)
                        {
                            connRN6.Close();
                            connRN6.Open();
                        }
                        else if (connRN6.State == ConnectionState.Closed) connRN6.Open();
                        SqlDataReader rdrIncidentInfo = cmdQueryForIncidents.ExecuteReader();
                        if (rdrIncidentInfo.HasRows)
                        {
                            while (rdrIncidentInfo.Read())
                            {
                                IncidentInfo info = new IncidentInfo();
                                if (!rdrIncidentInfo.IsDBNull(0)) info.IncidentNo = rdrIncidentInfo.GetString(0);
                                if (!rdrIncidentInfo.IsDBNull(1)) info.SettlementType = rdrIncidentInfo.GetString(1);
                                if (!rdrIncidentInfo.IsDBNull(2)) info.MedicalProviderName = rdrIncidentInfo.GetString(2);
                                if (!rdrIncidentInfo.IsDBNull(3)) info.ContactName = rdrIncidentInfo.GetString(3);
                                lstIncidentInfo.Add(info);
                            }
                        }
                        else
                        {
                            MessageBox.Show("No Incident found.", "Alert");
                            rdrIncidentInfo.Close();
                            return;
                        }
                        rdrIncidentInfo.Close();
                        if (connRN6.State != ConnectionState.Closed) connRN6.Close();

                        foreach (IncidentInfo info in lstIncidentInfo)
                        {
                            if (info.SettlementType == "CMM Member Reimbursement" || info.SettlementType == "PR reimbursement")
                            {
                                PaidToBlueSheet = EnumPaidTo.Member;
                                ChkInfoEnteredBlueSheet.PaidTo = info.ContactName;
                            }
                            else if (info.SettlementType == "CMM Provider Payment")
                            {
                                PaidToBlueSheet = EnumPaidTo.MedicalProvider;
                                ChkInfoEnteredBlueSheet.PaidTo = info.MedicalProviderName;
                            }
                            lstIncdNamesBlueSheet.Add(info.IncidentNo);
                        }
                    }
                    else
                    {
                        MessageBox.Show("Please enter check no.", "Alert");
                        return;
                    }

                    if (lstIncdNamesBlueSheet.Count > 0)
                    {
                        foreach (String IncdName in lstIncdNamesBlueSheet.Distinct())
                        {
                            lstDistinctIncdNamesBlueSheet.Add(IncdName);
                        }
                        lstDistinctIncdNamesBlueSheet.Sort();
                    }

                    if (lstDistinctIncdNamesBlueSheet.Count > 0)
                    {
                        foreach (String IncidentName in lstDistinctIncdNamesBlueSheet)
                        {
                            String strSqlQueryForMedBillNo = "select [dbo].[tbl_medbill].[BillNo] from [dbo].[tbl_medbill] " +
                                                             "inner join [dbo].[tbl_incident] on [dbo].[tbl_medbill].[Incident_Id] = [dbo].[tbl_incident].[Incident_id] " +
                                                             "where [dbo].[tbl_incident].[IncidentNo] = @IncidentName " +
                                                             "order by [dbo].[tbl_medbill].[BillDate]";

                            SqlCommand cmdQueryForMedBillNo = new SqlCommand(strSqlQueryForMedBillNo, connRN6);
                            cmdQueryForMedBillNo.CommandType = CommandType.Text;

                            cmdQueryForMedBillNo.Parameters.AddWithValue("@IncidentName", IncidentName);

                            if (connRN6.State != ConnectionState.Closed)
                            {
                                connRN6.Close();
                                connRN6.Open();
                            }
                            else if (connRN6.State == ConnectionState.Closed) connRN6.Open();
                            SqlDataReader rdrMedBillNo = cmdQueryForMedBillNo.ExecuteReader();
                            if (rdrMedBillNo.HasRows)
                            {
                                while (rdrMedBillNo.Read())
                                {
                                    if (!rdrMedBillNo.IsDBNull(0)) lstMedBillNamesBlueSheet.Add(rdrMedBillNo.GetString(0));
                                }
                            }
                            rdrMedBillNo.Close();
                            if (connRN6.State != ConnectionState.Closed) connRN6.Close();

                        }
                    }

                    if (lstMedBillNamesBlueSheet.Count > 0)
                    {
                        foreach (String strMedBillNo in lstMedBillNamesBlueSheet)
                        {
                            lstDistinctMedBillNamesBlueSheet.Add(strMedBillNo);
                        }
                        //lstDistinctMedBillNamesBlueSheet.Sort();
                    }
                }

                if (rbACHBlueSheet.Checked)
                {
                    ACHInfoEnteredBlueSheet = new ACHInfoBlueSheet();

                    if (txtACHNoBlueSheet.Text.Trim() != String.Empty)
                    {
                        String strSqlQueryForMedBill = "select [RN_DB].[dbo].[tbl_medbill].[BillNo], [SalesForce].[dbo].[account].[Name], " +
                                                       "[RN_DB].[dbo].[tbl_settlement].[ACH_Number], [RN_DB].[dbo].[tbl_settlement].[ACH_Date], " +
                                                       "[RN_DB].[dbo].[tbl_settlement].[Amount], [RN_DB].[dbo].[tbl_settlement].[Name], " +
                                                       "[SalesForce].[dbo].[contact].[Primary_Name__c], " +
                                                       //"[SalesForce].[dbo].[contact].[MailingStreet], [SalesForce].[dbo].[contact].[MailingCity], " +
                                                       //"[SalesForce].[dbo].[contact].[MailingState], [SalesForce].[dbo].[contact].[MailingPostalCode], " +
                                                       "[SalesForce].[dbo].[Account].[ShippingStreet], [SalesForce].[dbo].[Account].[ShippingCity], " +
                                                       "[SalesForce].[dbo].[Account].[ShippingState], [SalesForce].[dbo].[Account].[ShippingPostalCode], " +
                                                       "[SalesForce].[dbo].[membership].[Name], " +
                                                       "[SalesForce].[dbo].[contact].[Name], " +
                                                       "[SalesForce].[dbo].[contact].[LastName], [SalesForce].[dbo].[contact].[MiddleName], [SalesForce].[dbo].[contact].[FirstName], " +
                                                       "[SalesForce].[dbo].[contact].[Individual_ID__c] " +
                                                       "from [RN_DB].[dbo].[tbl_settlement] " +
                                                       "inner join [RN_DB].[dbo].[tbl_settlement_type_code] on [RN_DB].[dbo].[tbl_settlement].[SettlementType] = [RN_DB].[dbo].[tbl_settlement_type_code].[SettlementTypeCode] " +
                                                       "inner join [RN_DB].[dbo].[tbl_medbill] on [RN_DB].[dbo].[tbl_settlement].[MedicalBillID] = [RN_DB].[dbo].[tbl_medbill].[BillNo] " +
                                                       "inner join [SalesForce].[dbo].[contact] on [RN_DB].[dbo].[tbl_medbill].[Individual_Id] = [SalesForce].[dbo].[contact].[Individual_ID__c] " +
                                                       "inner join [SalesForce].[dbo].[membership] on [SalesForce].[dbo].[contact].[c4g_Membership__c] = [SalesForce].[dbo].[membership].[Id] " +
                                                       "inner join [SalesForce].[dbo].[account] on [SalesForce].[dbo].[contact].[AccountId] = [SalesForce].[dbo].[account].[Id] " +
                                                       "where ([RN_DB].[dbo].[tbl_settlement_type_code].[SettlementTypeValue] = 'CMM Member Reimbursement' or " +
                                                       "[RN_DB].[dbo].[tbl_settlement_type_code].[SettlementTypeValue] = 'PR Reimbursement' or " +
                                                       "[RN_DB].[dbo].[tbl_settlement_type_code].[SettlementTypeValue] = 'CMM Provider Payment') and " +
                                                       "[RN_DB].[dbo].[tbl_medbill].[Individual_Id] like '%' + @IndividualId + '%' and " +
                                                       "[RN_DB].[dbo].[tbl_settlement].[ACH_Number] = @ACH_No and " +
                                                       "[RN_DB].[dbo].[tbl_settlement].[ACH_Date] IS NOT NULL and " +
                                                       "cast([RN_DB].[dbo].[tbl_settlement].[ACH_Date] as date) = @ACH_Date";

                        SqlCommand cmdQueryForMedBill = new SqlCommand(strSqlQueryForMedBill, connRN6);
                        cmdQueryForMedBill.CommandType = CommandType.Text;

                        cmdQueryForMedBill.Parameters.AddWithValue("@IndividualId", txtIndividualIDBlueSheet.Text.Trim());
                        cmdQueryForMedBill.Parameters.AddWithValue("@ACH_No", txtACHNoBlueSheet.Text.Trim());
                        cmdQueryForMedBill.Parameters.AddWithValue("@ACH_Date", dtpACHTransactionDateBlueSheet.Value.ToString("yyyy-MM-dd"));

                        if (connRN6.State != ConnectionState.Closed)
                        {
                            connRN6.Close();
                            connRN6.Open();
                        }
                        else if (connRN6.State == ConnectionState.Closed) connRN6.Open();
                        SqlDataReader rdrMedBillInfo = cmdQueryForMedBill.ExecuteReader();
                        if (rdrMedBillInfo.HasRows)
                        {
                            while (rdrMedBillInfo.Read())
                            {
                                if (!rdrMedBillInfo.IsDBNull(4)) ACHInfoEnteredBlueSheet.ACHAmount += Double.Parse(rdrMedBillInfo.GetDecimal(4).ToString());
                                if (!rdrMedBillInfo.IsDBNull(2)) ACHInfoEnteredBlueSheet.ACHNumber = rdrMedBillInfo.GetString(2);

                                //MedBillACHInfo info = new MedBillACHInfo();
                                //if (!rdrMedBillInfo.IsDBNull(6)) info.ContactPrimaryName = rdrMedBillInfo.GetString(6);
                                //if (!rdrMedBillInfo.IsDBNull(7)) info.ContactMailingStreet = rdrMedBillInfo.GetString(7);
                                //if (!rdrMedBillInfo.IsDBNull(8)) info.ContactMailingCity = rdrMedBillInfo.GetString(8);
                                //if (!rdrMedBillInfo.IsDBNull(9)) info.ContactMailingState = rdrMedBillInfo.GetString(9);
                                //if (!rdrMedBillInfo.IsDBNull(10)) info.ContactMailingZip = rdrMedBillInfo.GetString(10);
                                //if (!rdrMedBillInfo.IsDBNull(11)) info.MembershipName = rdrMedBillInfo.GetString(11);
                                //if (!rdrMedBillInfo.IsDBNull(12)) info.ContactName = rdrMedBillInfo.GetString(12);
                                //if (!rdrMedBillInfo.IsDBNull(13)) info.ContactLastName = rdrMedBillInfo.GetString(13);
                                //if (!rdrMedBillInfo.IsDBNull(14)) info.ContactMiddleName = rdrMedBillInfo.GetString(14);
                                //if (!rdrMedBillInfo.IsDBNull(15)) info.ContactFirstName = rdrMedBillInfo.GetString(15);
                                //if (!rdrMedBillInfo.IsDBNull(16)) info.IndividualId = rdrMedBillInfo.GetString(16);

                                //lstMedBillACHInfo.Add(info);
                                if (!rdrMedBillInfo.IsDBNull(6)) strPrimaryNameBlueSheet = rdrMedBillInfo.GetString(6);
                                if (!rdrMedBillInfo.IsDBNull(7)) strStreetAddressBlueSheet = rdrMedBillInfo.GetString(7);
                                if (!rdrMedBillInfo.IsDBNull(8)) strCityBlueSheet = rdrMedBillInfo.GetString(8);
                                if (!rdrMedBillInfo.IsDBNull(9)) strStateBlueSheet = rdrMedBillInfo.GetString(9);
                                if (!rdrMedBillInfo.IsDBNull(10)) strZipBlueSheet = rdrMedBillInfo.GetString(10);
                                if (!rdrMedBillInfo.IsDBNull(11)) strMembershipIdBlueSheet = rdrMedBillInfo.GetString(11);
                                if (!rdrMedBillInfo.IsDBNull(12)) strIndividualNameBlueSheet = rdrMedBillInfo.GetString(12);
                                if (!rdrMedBillInfo.IsDBNull(13)) strIndividualLastNameBlueSheet = rdrMedBillInfo.GetString(13);
                                if (!rdrMedBillInfo.IsDBNull(14)) strIndividualMiddleNameBlueSheet = rdrMedBillInfo.GetString(14);
                                if (!rdrMedBillInfo.IsDBNull(15)) strIndiviaualFirstNameBlueSheet = rdrMedBillInfo.GetString(15);
                                if (!rdrMedBillInfo.IsDBNull(16)) strIndividualIDBlueSheet = rdrMedBillInfo.GetString(16);

                            }
                        }
                        rdrMedBillInfo.Close();
                        if (connRN6.State != ConnectionState.Closed) connRN6.Close();
                    }

                    if (txtACHNoBlueSheet.Text.Trim() != String.Empty)
                    {
                        String strSqlQueryForIncidents = "select [RN_DB].[dbo].[tbl_incident].[IncidentNo], [RN_DB].[dbo].[tbl_settlement_type_code].[SettlementTypeValue], " +
                                                        "[SalesForce].[dbo].[account].[Name], [SalesForce].[dbo].[contact].[Name] " +
                                                        "from [RN_DB].[dbo].[tbl_settlement] " +
                                                        "inner join [RN_DB].[dbo].[tbl_settlement_type_code] on [RN_DB].[dbo].[tbl_settlement].[SettlementType] = [RN_DB].[dbo].[tbl_settlement_type_code].[SettlementTypeCode] " +
                                                        "inner join [RN_DB].[dbo].[tbl_medbill] on [RN_DB].[dbo].[tbl_settlement].[MedicalBillID] = [RN_DB].[dbo].[tbl_medbill].[BillNo] " +
                                                        "inner join [RN_DB].[dbo].[tbl_incident] on [RN_DB].[dbo].[tbl_medbill].[Incident_Id] = [RN_DB].[dbo].[tbl_incident].[Incident_id] " +
                                                        "inner join [SalesForce].[dbo].[contact] on [RN_DB].[dbo].[tbl_medbill].[Individual_Id] = [SalesForce].[dbo].[contact].[Individual_ID__c] " +
                                                        "inner join [SalesForce].[dbo].[account] on [SalesForce].[dbo].[contact].[AccountId] = [SalesForce].[dbo].[account].[Id] " +
                                                        "where ([RN_DB].[dbo].[tbl_settlement_type_code].[SettlementTypeValue] = 'CMM Member Reimbursement' or " +
                                                        "[RN_DB].[dbo].[tbl_settlement_type_code].[SettlementTypeValue] = 'PR reimbursement' or " +
                                                        "[RN_DB].[dbo].[tbl_settlement_type_code].[SettlementTypeValue] = 'CMM Provider Payment') and " +
                                                        "[RN_DB].[dbo].[tbl_medbill].[Individual_Id] like '%' + @IndividualId + '%' and " +
                                                        "[RN_DB].[dbo].[tbl_settlement].[ACH_Number] = @ACH_No and " +
                                                        "[RN_DB].[dbo].[tbl_settlement].[ACH_Date] IS NOT NULL and " +
                                                        "cast([RN_DB].[dbo].[tbl_settlement].[ACH_Date] as date) = @ACH_Date";

                        SqlCommand cmdQueryForIncidents = new SqlCommand(strSqlQueryForIncidents, connRN6);
                        cmdQueryForIncidents.CommandType = CommandType.Text;

                        cmdQueryForIncidents.Parameters.AddWithValue("@IndividualId", txtIndividualIDBlueSheet.Text.Trim());
                        cmdQueryForIncidents.Parameters.AddWithValue("@ACH_No", txtACHNoBlueSheet.Text.Trim());
                        cmdQueryForIncidents.Parameters.AddWithValue("@ACH_Date", dtpACHTransactionDateBlueSheet.Value.ToString("MM/dd/yyyy"));

                        if (connRN6.State != ConnectionState.Closed)
                        {
                            connRN6.Close();
                            connRN6.Open();
                        }
                        else if (connRN6.State == ConnectionState.Closed) connRN6.Open();
                        SqlDataReader rdrIncidentInfo = cmdQueryForIncidents.ExecuteReader();
                        if (rdrIncidentInfo.HasRows)
                        {
                            while (rdrIncidentInfo.Read())
                            {
                                IncidentInfo info = new IncidentInfo();
                                if (!rdrIncidentInfo.IsDBNull(0)) info.IncidentNo = rdrIncidentInfo.GetString(0);
                                if (!rdrIncidentInfo.IsDBNull(1)) info.SettlementType = rdrIncidentInfo.GetString(1);
                                if (!rdrIncidentInfo.IsDBNull(2)) info.MedicalProviderName = rdrIncidentInfo.GetString(2);
                                if (!rdrIncidentInfo.IsDBNull(3)) info.ContactName = rdrIncidentInfo.GetString(3);
                                lstIncidentInfo.Add(info);
                            }
                        }
                        else
                        {
                            MessageBox.Show("No incident found.", "Alert");
                            rdrIncidentInfo.Close();
                            return;
                        }
                        rdrIncidentInfo.Close();
                        if (connRN6.State != ConnectionState.Closed) connRN6.Close();

                        foreach (IncidentInfo info in lstIncidentInfo)
                        {
                            if (info.SettlementType == "CMM Member Reimbursement" ||
                                info.SettlementType == "PR Reimbursement")
                            {
                                PaidToBlueSheet = EnumPaidTo.Member;
                                ACHInfoEnteredBlueSheet.PaidTo = info.ContactName;
                            }
                            else if (info.SettlementType == "CMM Provider Payment")
                            {
                                PaidToBlueSheet = EnumPaidTo.MedicalProvider;
                                ACHInfoEnteredBlueSheet.PaidTo = info.MedicalProviderName;
                            }
                            lstIncdNamesBlueSheet.Add(info.IncidentNo);
                        }
                    }
                    else
                    {
                        MessageBox.Show("Please enter ACH Number.", "Alert");
                        return;
                    }

                    if (lstIncdNamesBlueSheet.Count > 0)
                    {
                        foreach (String IncdName in lstIncdNamesBlueSheet.Distinct())
                        {
                            lstDistinctIncdNamesBlueSheet.Add(IncdName);
                        }
                        lstDistinctIncdNamesBlueSheet.Sort();
                    }

                    if (lstDistinctIncdNamesBlueSheet.Count > 0)
                    {
                        foreach (String IncidentName in lstDistinctIncdNamesBlueSheet)
                        {
                            String strSqlQueryForMedBillNo = "select [dbo].[tbl_medbill].[BillNo] from [dbo].[tbl_medbill] " +
                                                             "inner join [dbo].[tbl_incident] on [dbo].[tbl_medbill].[Incident_Id] = [dbo].[tbl_incident].[Incident_id] " +
                                                             "where [dbo].[tbl_incident].[IncidentNo] = @IncidentName " +
                                                             "order by [dbo].[tbl_medbill].[BillDate]";

                            SqlCommand cmdQueryForMedBillNo = new SqlCommand(strSqlQueryForMedBillNo, connRN6);
                            cmdQueryForMedBillNo.CommandType = CommandType.Text;

                            cmdQueryForMedBillNo.Parameters.AddWithValue("@IncidentName", IncidentName);

                            if (connRN6.State != ConnectionState.Closed)
                            {
                                connRN6.Close();
                                connRN6.Open();
                            }
                            else if (connRN6.State == ConnectionState.Closed) connRN6.Open();
                            SqlDataReader rdrMedBillNo = cmdQueryForMedBillNo.ExecuteReader();
                            if (rdrMedBillNo.HasRows)
                            {
                                while (rdrMedBillNo.Read())
                                {
                                    if (!rdrMedBillNo.IsDBNull(0)) lstMedBillNamesBlueSheet.Add(rdrMedBillNo.GetString(0));
                                }
                            }
                            rdrMedBillNo.Close();
                            if (connRN6.State != ConnectionState.Closed) connRN6.Close();
                        }
                    }
                    if (lstMedBillNamesBlueSheet.Count > 0)
                    {
                        foreach (String strMedBillNo in lstMedBillNamesBlueSheet)
                        {
                            lstDistinctMedBillNamesBlueSheet.Add(strMedBillNo);
                        }
                        //lstDistinctMedBillNamesBlueSheet.Sort();
                    }
                }

                if (rbCreditCardBlueSheet.Checked)
                {
                    CreditCardPaymentEnteredBlueSheet = new CreditCardPaymentInfoBlueSheet();

                    DateTime dtYesterday = DateTime.Parse(dtpCreditCardPaymentDateBlueSheet.Value.ToString("yyyy-MM-dd"));
                    DateTime dtTomorrow = DateTime.Parse(dtpCreditCardPaymentDateBlueSheet.Value.ToString("yyyy-MM-dd")).AddDays(1);

                    if (dtpCreditCardPaymentDateBlueSheet.Value.ToString() != String.Empty)
                    {
                        String strSqlQueryForMedicalBill = "select [RN_DB].[dbo].[tbl_settlement].[Amount], [RN_DB].[dbo].[tbl_medbill].[BillNo], " +
                                                           "[SalesForce].[dbo].[account].[Name], [RN_DB].[dbo].[tbl_settlement].[CMMCreditCardPaidDate], " +
                                                           "[RN_DB].[dbo].[tbl_incident].[IncidentNo], [RN_DB].[dbo].[tbl_settlement].[Name], " +
                                                           "[SalesForce].[dbo].[contact].[Primary_Name__c], " +
                                                           //"[SalesForce].[dbo].[contact].[MailingStreet], [SalesForce].[dbo].[contact].[MailingCity], " +
                                                           //"[SalesForce].[dbo].[contact].[MailingState], [SalesForce].[dbo].[contact].[MailingPostalCode], " +
                                                           "[SalesForce].[dbo].[Account].[ShippingStreet], [SalesForce].[dbo].[Account].[ShippingCity], " +
                                                           "[SalesForce].[dbo].[Account].[ShippingState], [SalesForce].[dbo].[Account].[ShippingPostalCode], " +
                                                           "[SalesForce].[dbo].[membership].[Name], " +
                                                           "[SalesForce].[dbo].[contact].[Name], " +
                                                           "[SalesForce].[dbo].[contact].[LastName], [SalesForce].[dbo].[contact].[MiddleName], [SalesForce].[dbo].[contact].[FirstName], " +
                                                           "[SalesForce].[dbo].[contact].[Individual_ID__c], " +
                                                           "[RN_DB].[dbo].[tbl_settlement_type_code].[SettlementTypeValue] " +
                                                           "from [RN_DB].[dbo].[tbl_settlement] " +
                                                           "inner join [RN_DB].[dbo].[tbl_settlement_type_code] on " +
                                                           "[RN_DB].[dbo].[tbl_settlement].[SettlementType] = [RN_DB].[dbo].[tbl_settlement_type_code].[SettlementTypeCode] " +
                                                           "inner join [RN_DB].[dbo].[tbl_medbill] on [RN_DB].[dbo].[tbl_settlement].[MedicalBillID] = [RN_DB].[dbo].[tbl_medbill].[BillNo] " +
                                                           "inner join [SalesForce].[dbo].[account] on [RN_DB].[dbo].[tbl_medbill].[MedicalProvider_Id] = [SalesForce].[dbo].[account].[Id] " +
                                                           "inner join [RN_DB].[dbo].[tbl_incident] on [RN_DB].[dbo].[tbl_medbill].[Incident_Id] = [RN_DB].[dbo].[tbl_incident].[Incident_id] " +
                                                           "inner join [SalesForce].[dbo].[contact] on [RN_DB].[dbo].[tbl_medbill].[Individual_Id] = [SalesForce].[dbo].[contact].[Individual_ID__c] " +
                                                           "inner join [SalesForce].[dbo].[membership] on [SalesForce].[dbo].[contact].[c4g_Membership__c] = [SalesForce].[dbo].[membership].[Id] " +
                                                           "where [RN_DB].[dbo].[tbl_settlement_type_code].[SettlementTypeValue] = 'CMM Provider Payment' and " +
                                                           "[RN_DB].[dbo].[tbl_medbill].[Individual_Id] like '%' + @IndividualId + '%' and " +
                                                           "[RN_DB].[dbo].[tbl_settlement].[CMMCreditCardPaidDate] IS NOT NULL and " +
                                                           "cast([RN_DB].[dbo].[tbl_settlement].[CMMCreditCardPaidDate] as date) = @CreditCardPaidDate";

                        SqlCommand cmdQueryForMedicalBill = new SqlCommand(strSqlQueryForMedicalBill, connRN6);
                        cmdQueryForMedicalBill.CommandType = CommandType.Text;

                        cmdQueryForMedicalBill.Parameters.AddWithValue("@IndividualId", txtIndividualIDBlueSheet.Text.Trim());
                        cmdQueryForMedicalBill.Parameters.AddWithValue("@CreditCardPaidDate", dtpCreditCardPaymentDateBlueSheet.Value.ToString("MM/dd/yyyy"));

                        if (connRN6.State != ConnectionState.Closed)
                        {
                            connRN6.Close();
                            connRN6.Open();
                        }
                        else if (connRN6.State == ConnectionState.Closed) connRN6.Open();
                        SqlDataReader rdrMedicalBill = cmdQueryForMedicalBill.ExecuteReader();
                        if (rdrMedicalBill.HasRows)
                        {
                            while (rdrMedicalBill.Read())
                            {
                                if (!rdrMedicalBill.IsDBNull(0)) CreditCardPaymentEnteredBlueSheet.CCPaymentAmount += (double?)rdrMedicalBill.GetDecimal(0);
                                if (!rdrMedicalBill.IsDBNull(3)) CreditCardPaymentEnteredBlueSheet.dtPaymentDate = rdrMedicalBill.GetDateTime(3);
                                if (!rdrMedicalBill.IsDBNull(6)) strPrimaryNameBlueSheet = rdrMedicalBill.GetString(6);
                                if (!rdrMedicalBill.IsDBNull(7)) strStreetAddressBlueSheet = rdrMedicalBill.GetString(7);
                                if (!rdrMedicalBill.IsDBNull(8)) strCityBlueSheet = rdrMedicalBill.GetString(8);
                                if (!rdrMedicalBill.IsDBNull(9)) strStateBlueSheet = rdrMedicalBill.GetString(9);
                                if (!rdrMedicalBill.IsDBNull(10)) strZipBlueSheet = rdrMedicalBill.GetString(10);
                                if (!rdrMedicalBill.IsDBNull(11)) strMembershipIdBlueSheet = rdrMedicalBill.GetString(11);
                                else strMembershipIdBlueSheet = String.Empty;
                                if (!rdrMedicalBill.IsDBNull(12)) strIndividualNameBlueSheet = rdrMedicalBill.GetString(12);
                                if (!rdrMedicalBill.IsDBNull(13)) strIndividualLastNameBlueSheet = rdrMedicalBill.GetString(13);
                                if (!rdrMedicalBill.IsDBNull(14)) strIndividualMiddleNameBlueSheet = rdrMedicalBill.GetString(14);
                                if (!rdrMedicalBill.IsDBNull(15)) strIndiviaualFirstNameBlueSheet = rdrMedicalBill.GetString(15);
                                if (!rdrMedicalBill.IsDBNull(16)) strIndividualIDBlueSheet = rdrMedicalBill.GetString(16);
                            }
                        }
                        rdrMedicalBill.Close();
                        if (connRN6.State != ConnectionState.Closed) connRN6.Close();
                    }
                    else
                    {
                        MessageBox.Show("Please enter credit card payment date.", "Error");
                        return;
                    }

                    if (dtpCreditCardPaymentDateBlueSheet.Value.ToString() != String.Empty)
                    {
                        // 03/25/19 - begin here for dtpCreditCardPaymentDateBlueSheet.Value.ToString() != String.Empty

                        String strSqlQueryForIncidents = "select [RN_DB].[dbo].[tbl_incident].[IncidentNo], [RN_DB].[dbo].[tbl_settlement_type_code].[SettlementTypeValue], " +
                                                         "[SalesForce].[dbo].[account].[Name], [SalesForce].[dbo].[contact].[Name] from " +
                                                         "[RN_DB].[dbo].[tbl_settlement] " +
                                                         "inner join [RN_DB].[dbo].[tbl_medbill] on [RN_DB].[dbo].[tbl_settlement].[MedicalBillID] = [RN_DB].[dbo].[tbl_medbill].[BillNo] " +
                                                         "inner join [RN_DB].[dbo].[tbl_incident] on [RN_DB].[dbo].[tbl_medbill].[Incident_Id] = [RN_DB].[dbo].[tbl_incident].[Incident_id] " +
                                                         "inner join [RN_DB].[dbo].[tbl_settlement_type_code] " +
                                                         "on [RN_DB].[dbo].[tbl_settlement].[SettlementType] = [RN_DB].[dbo].[tbl_settlement_type_code].[SettlementTypeCode] " +
                                                         "inner join [SalesForce].[dbo].[account] on [RN_DB].[dbo].[tbl_medbill].[MedicalProvider_Id] = [SalesForce].[dbo].[account].[Id] " +
                                                         "inner join [SalesForce].[dbo].[contact] on [RN_DB].[dbo].[tbl_medbill].[Individual_Id] = [SalesForce].[dbo].[contact].[Individual_ID__c] " +
                                                         "where [RN_DB].[dbo].[tbl_settlement_type_code].[SettlementTypeValue] = 'CMM Provider Payment' and " +
                                                         "[RN_DB].[dbo].[tbl_medbill].[Individual_Id] like '%' + @IndividualId + '%' and " +
                                                         "[RN_DB].[dbo].[tbl_settlement].[CMMCreditCardPaidDate] IS NOT NULL and " +
                                                         "cast([RN_DB].[dbo].[tbl_settlement].[CMMCreditCardPaidDate] as date) = @CreditCardPaidDate";

                        SqlCommand cmdQueryForIncidents = new SqlCommand(strSqlQueryForIncidents, connRN6);
                        cmdQueryForIncidents.CommandType = CommandType.Text;

                        cmdQueryForIncidents.Parameters.AddWithValue("@IndividualId", txtIndividualIDBlueSheet.Text.Trim());
                        //cmdQueryForIncidents.Parameters.AddWithValue("@CreditCardPaidDate", dtpCreditCardPaymentDateBlueSheet.Value.ToString("yyyy-MM-dd"));
                        cmdQueryForIncidents.Parameters.AddWithValue("@CreditCardPaidDate", dtpCreditCardPaymentDateBlueSheet.Value.ToString("MM/dd/yyyy"));

                        if (connRN6.State != ConnectionState.Closed)
                        {
                            connRN6.Close();
                            connRN6.Open();
                        }
                        else if (connRN6.State == ConnectionState.Closed) connRN6.Open();
                        SqlDataReader rdrIncidents = cmdQueryForIncidents.ExecuteReader();
                        if (rdrIncidents.HasRows)
                        {
                            while (rdrIncidents.Read())
                            {
                                if (!rdrIncidents.IsDBNull(1))
                                {
                                    String SettlementType = rdrIncidents.GetString(1);
                                    if (SettlementType == "CMM Member Reimbursement")
                                    {
                                        PaidToBlueSheet = EnumPaidTo.Member;
                                        if (!rdrIncidents.IsDBNull(3)) CreditCardPaymentEnteredBlueSheet.PaidTo = rdrIncidents.GetString(3);
                                    }
                                    else if (SettlementType == "CMM Provider Payment")
                                    {
                                        PaidToBlueSheet = EnumPaidTo.MedicalProvider;
                                        if (!rdrIncidents.IsDBNull(3)) CreditCardPaymentEnteredBlueSheet.PaidTo = rdrIncidents.GetString(3);
                                    }
                                }
                                if (!rdrIncidents.IsDBNull(0)) lstIncdNamesBlueSheet.Add(rdrIncidents.GetString(0));
                            }
                        }
                        else
                        {
                            MessageBox.Show("No incident found.", "Information");
                            rdrIncidents.Close();
                            return;
                        }
                        rdrIncidents.Close();
                        if (connRN6.State != ConnectionState.Closed) connRN6.Close();
                    }

                    if (lstIncdNamesBlueSheet.Count > 0)
                    {
                        foreach (String IncdName in lstIncdNamesBlueSheet.Distinct())
                        {
                            lstDistinctIncdNamesBlueSheet.Add(IncdName);
                        }
                        lstDistinctIncdNamesBlueSheet.Sort();
                    }

                    if (lstDistinctIncdNamesBlueSheet.Count > 0)
                    {
                        foreach (String IncdName in lstDistinctIncdNamesBlueSheet)
                        {
                            String strSqlQueryForMedBills = "select [RN_DB].[dbo].[tbl_medbill].[BillNo] " +
                                                            "from [RN_DB].[dbo].[tbl_medbill] " +
                                                            "inner join [RN_DB].[dbo].[tbl_incident] on [RN_DB].[dbo].[tbl_medbill].[Incident_Id] = [RN_DB].[dbo].[tbl_incident].[Incident_id] " +
                                                            "where [RN_DB].[dbo].[tbl_incident].[IncidentNo] = @IncidentNo " +
                                                            "order by [RN_DB].[dbo].[tbl_medbill].[BillDate]";
                                                            
                            SqlCommand cmdQueryForMedBills = new SqlCommand(strSqlQueryForMedBills, connRN6);
                            cmdQueryForMedBills.CommandType = CommandType.Text;

                            cmdQueryForMedBills.Parameters.AddWithValue("@IncidentNo", IncdName);

                            if (connRN6.State != ConnectionState.Closed)
                            {
                                connRN6.Close();
                                connRN6.Open();
                            }
                            else if (connRN6.State == ConnectionState.Closed) connRN6.Open();
                            SqlDataReader rdrMedBills = cmdQueryForMedBills.ExecuteReader();
                            if (rdrMedBills.HasRows)
                            {
                                while (rdrMedBills.Read())
                                {
                                    if (!rdrMedBills.IsDBNull(0)) lstMedBillNamesBlueSheet.Add(rdrMedBills.GetString(0));
                                }
                            }
                            else
                            {
                                MessageBox.Show("No medical bill for IncidentNo: " + IncdName, "Information");
                                rdrMedBills.Close();
                                return;
                            }
                            rdrMedBills.Close();
                            if (connRN6.State != ConnectionState.Closed) connRN6.Close();
                        }
                    }

                    if (lstMedBillNamesBlueSheet.Count > 0)
                    {
                        foreach (String strMedBillName in lstMedBillNamesBlueSheet.Distinct())
                        {
                            //lstDistinctIncdNamesBlueSheet.Add(strMedBillName);
                            lstDistinctMedBillNamesBlueSheet.Add(strMedBillName);
                        }
                        //lstDistinctIncdNamesBlueSheet.Sort();
                        //lstDistinctMedBillNamesBlueSheet.Sort();
                    }
                }

                lstIncidentsBlueSheet.Clear();

                foreach (String strIncdName in lstDistinctIncdNamesBlueSheet)
                {
                    //String strSqlQueryForICD10Names = "select [RN_DB].[dbo].[tbl_incident].[IncidentNo], [SalesForce].[dbo].[contact].[Name], " +
                    //                                    "[RN_DB].[dbo].[tbl_illness].[ICD_10_Id], [SalesForce].[dbo].[ICD10 Code].[Name] " +
                    //                                    "from [RN_DB].[dbo].[tbl_incident] " +
                    //                                    "inner join [SalesForce].[dbo].[contact] on [RN_DB].[dbo].[tbl_incident].[Individual_id] = [SalesForce].[dbo].[contact].[Individual_ID__c] " +
                    //                                    "inner join [RN_DB].[dbo].[tbl_illness] on [RN_DB].[dbo].[tbl_incident].[Illness_id] = [RN_DB].[dbo].[tbl_illness].[Illness_Id] " +
                    //                                    "inner join [SalesForce].[dbo].[ICD10 Code] on [RN_DB].[dbo].[tbl_illness].[ICD_10_Id] = [SalesForce].[dbo].[ICD10 Code].[ICD10_CODE__C] " +
                    //                                    "where [RN_DB].[dbo].[tbl_incident].[IncidentNo] = @IncdName";

                    String strSqlQueryForICD10Names = "select [RN_DB].[dbo].[tbl_incident].[IncidentNo], [SalesForce].[dbo].[contact].[Name], " +
                                    "[RN_DB].[dbo].[tbl_illness].[ICD_10_Id], [SalesForce].[dbo].[ICD10 Code].[Name] " +
                                    "from [RN_DB].[dbo].[tbl_incident] " +
                                    "inner join [SalesForce].[dbo].[contact] on [RN_DB].[dbo].[tbl_incident].[Individual_id] = [SalesForce].[dbo].[contact].[Individual_ID__c] " +
                                    "inner join [RN_DB].[dbo].[tbl_illness] on [RN_DB].[dbo].[tbl_incident].[Illness_id] = [RN_DB].[dbo].[tbl_illness].[Illness_Id] " +
                                    "inner join [SalesForce].[dbo].[ICD10 Code] on [RN_DB].[dbo].[tbl_illness].[ICD_10_Id] = [SalesForce].[dbo].[ICD10 Code].[ICD10_CODE__C]" +
                                    "where [RN_DB].[dbo].[tbl_incident].[IncidentNo] = @IncdName";

                    SqlCommand cmdQueryForICD10Names = new SqlCommand(strSqlQueryForICD10Names, connRN6);
                    cmdQueryForICD10Names.CommandType = CommandType.Text;

                    cmdQueryForICD10Names.Parameters.AddWithValue("@IncdName", strIncdName);

                    if (connRN6.State != ConnectionState.Closed)
                    {
                        connRN6.Close();
                        connRN6.Open();
                    }
                    else if (connRN6.State == ConnectionState.Closed) connRN6.Open();
                    SqlDataReader rdrICD10Names = cmdQueryForICD10Names.ExecuteReader();
                    if (rdrICD10Names.HasRows)
                    {
                        while (rdrICD10Names.Read())
                        {
                            if (!rdrICD10Names.IsDBNull(2))
                            {
                                //lstIncidentsBlueSheet.Add(new IncidentBlueSheet { Name = rdrICD10Names.GetString(0), PatientName = rdrICD10Names.GetString(1), ICD10_Code = String.Empty }); // rdrICD10Names.GetString(3) });
                                lstIncidentsBlueSheet.Add(new IncidentBlueSheet { Name = rdrICD10Names.GetString(0), PatientName = rdrICD10Names.GetString(1), ICD10_Code = rdrICD10Names.GetString(3) }); // rdrICD10Names.GetString(3) });

                            }
                        }
                    }
                    if (connRN6.State != ConnectionState.Closed) connRN6.Close();
                }

                lstIncidentsBlueSheet.Sort(delegate (IncidentBlueSheet incd1, IncidentBlueSheet incd2)
                {
                    if (incd1.Name == null && incd2.Name == null) return 0;
                    else if (incd1.Name == null) return -1;
                    else if (incd2.Name == null) return 1;
                    else return incd1.Name.CompareTo(incd2.Name);
                });

                DataTable dtMedicalBillPaid = new DataTable();

                dtMedicalBillPaid.Columns.Add("INCD", typeof(String));
                dtMedicalBillPaid.Columns.Add("회원 이름", typeof(String));
                dtMedicalBillPaid.Columns.Add("MED_BILL", typeof(String));
                dtMedicalBillPaid.Columns.Add("서비스 날짜", typeof(String));
                dtMedicalBillPaid.Columns.Add("의료기관명", typeof(String));
                dtMedicalBillPaid.Columns.Add("청구액(원금)", typeof(String));
                dtMedicalBillPaid.Columns.Add("본인 부담금", typeof(String));
                dtMedicalBillPaid.Columns.Add("회원할인", typeof(String));
                dtMedicalBillPaid.Columns.Add("CMM 할인", typeof(String));
                dtMedicalBillPaid.Columns.Add("의료기관 지불금", typeof(String));
                if (PaidToBlueSheet == EnumPaidTo.Member)
                {
                    dtMedicalBillPaid.Columns.Add("기지급액", typeof(String));
                    dtMedicalBillPaid.Columns.Add("회원 환불금", typeof(String));
                }
                if (PaidToBlueSheet == EnumPaidTo.MedicalProvider)
                {
                    dtMedicalBillPaid.Columns.Add("기지급액 (의료기관)", typeof(String));
                    dtMedicalBillPaid.Columns.Add("기지급액 (회원)", typeof(String));
                }

                dtMedicalBillPaid.Columns.Add("잔액/보류", typeof(String));

                DataRow drClosed = null;

                List<String> lstIncidentNames = new List<String>();

                List<MedicalExpenseBlueSheet> lstMedicalExpense = new List<MedicalExpenseBlueSheet>();

                List<String> lstMedicalBillPaid = new List<String>();

                foreach (String strMedBillName in lstDistinctMedBillNamesBlueSheet)
                {
                    String strSqlSettlementPaid = String.Empty;

                    if (rbCheckBlueSheet.Checked)
                    {
                        strSqlSettlementPaid = "select [dbo].[tbl_medbill].[BillNo] " +
                                                "from [dbo].[tbl_settlement] " +
                                                "inner join [dbo].[tbl_medbill] on [dbo].[tbl_settlement].[MedicalBillID] = [dbo].[tbl_medbill].[BillNo] " +
                                                "inner join [dbo].[tbl_medbill_status_code] on [dbo].[tbl_medbill].[BillStatus] = [dbo].[tbl_medbill_status_code].[BillStatusCode] " +
                                                "where [dbo].[tbl_medbill].[BillNo] = @MedBillNo and " +
                                                "(([dbo].[tbl_settlement].[CheckNo] IS NOT NULL and [dbo].[tbl_settlement].[CheckDate] IS NOT NULL) or " +
                                                "([dbo].[tbl_medbill_status_code].[BillStatusValue] = 'Partially Ineligible' and [dbo].[tbl_settlement].[PersonalResponsibilityCredit] > 0) or " +
                                                "([dbo].[tbl_medbill_status_code].[BillStatusValue] = 'Closed' and [dbo].[tbl_settlement].[PersonalResponsibilityCredit] > 0)) ";
                    }
                    if (rbACHBlueSheet.Checked)
                    {
                        strSqlSettlementPaid = "select [dbo].[tbl_medbill].[BillNo] " +
                                                "from [dbo].[tbl_settlement] " +
                                                "inner join [dbo].[tbl_medbill] on [dbo].[tbl_settlement].[MedicalBillID] = [dbo].[tbl_medbill].[BillNo] " +
                                                "inner join [dbo].[tbl_medbill_status_code] on [dbo].[tbl_medbill].[BillStatus] = [dbo].[tbl_medbill_status_code].[BillStatusCode] " +
                                                "where [dbo].[tbl_medbill].[BillNo] = @MedBillNo and " +
                                                "(([dbo].[tbl_settlement].[ACH_Number] IS NOT NULL and [dbo].[tbl_settlement].[ACH_Date] IS NOT NULL) or " +
                                                "([dbo].[tbl_medbill_status_code].[BillStatusValue] = 'Partially Ineligible' and [dbo].[tbl_settlement].[PersonalResponsibilityCredit] > 0) or " +
                                                "([dbo].[tbl_medbill_status_code].[BillStatusValue] = 'Closed' and [dbo].[tbl_settlement].[PersonalResponsibilityCredit] > 0)) ";
                    }
                    if (rbCreditCardBlueSheet.Checked)
                    {
                        strSqlSettlementPaid = "select [dbo].[tbl_medbill].[BillNo] " +
                                                "from [dbo].[tbl_settlement] " +
                                                "inner join [dbo].[tbl_medbill] on [dbo].[tbl_settlement].[MedicalBillID] = [dbo].[tbl_medbill].[BillNo] " +
                                                "inner join [dbo].[tbl_medbill_status_code] on [dbo].[tbl_medbill].[BillStatus] = [dbo].[tbl_medbill_status_code].[BillStatusCode] " +
                                                "where [dbo].[tbl_medbill].[BillNo] = @MedBillNo and " +
                                                "([dbo].[tbl_settlement].[CMMCreditCardPaidDate] IS NOT NULL or " +
                                                "([dbo].[tbl_medbill_status_code].[BillStatusValue] = 'Partially Ineligible' and [dbo].[tbl_settlement].[PersonalResponsibilityCredit] > 0) or " +
                                                "([dbo].[tbl_medbill_status_code].[BillStatusValue] = 'Closed' and [dbo].[tbl_settlement].[PersonalResponsibilityCredit] > 0)) ";
                    }

                    SqlCommand cmdQueryForSettlementPaid = new SqlCommand(strSqlSettlementPaid, connRN6);
                    cmdQueryForSettlementPaid.CommandType = CommandType.Text;

                    cmdQueryForSettlementPaid.Parameters.AddWithValue("@MedBillNo", strMedBillName);

                    if (connRN6.State != ConnectionState.Closed)
                    {
                        connRN6.Close();
                        connRN6.Open();
                    }
                    else if (connRN6.State == ConnectionState.Closed) connRN6.Open();
                    Object objBillNo = cmdQueryForSettlementPaid.ExecuteScalar();
                    if (connRN6.State != ConnectionState.Closed) connRN6.Close();

                    if (objBillNo != null) lstMedicalBillPaid.Add(objBillNo.ToString().Trim());

                }

                List<String> lstDistinctMedicalBillPaid = new List<String>();

                foreach (String MedicalBillNo in lstMedicalBillPaid.Distinct())
                {
                    lstDistinctMedicalBillPaid.Add(MedicalBillNo);
                }

                foreach (String strMedBillNo in lstDistinctMedicalBillPaid)
                {
                    //String strSqlQueryBillPaid = "select [RN_DB].[dbo].[tbl_incident].[IncidentNo], [SalesForce].[dbo].[contact].[Name], [SalesForce].[dbo].[ICD10 Code].[NAME], " +
                    //                             "[RN_DB].[dbo].[tbl_medbill].[BillNo], [RN_DB].[dbo].[tbl_medbill].[BillDate], " +
                    //                             "[SalesForce].[dbo].[account].[Name], [RN_DB].[dbo].[tbl_medbill].[BillAmount], " +
                    //                             "[RN_DB].[dbo].[tbl_medbill].[PersonalResponsibilityCredit], [RN_DB].[dbo].[tbl_medbill].[Balance] " +
                    //                             "from [RN_DB].[dbo].[tbl_medbill] " +
                    //                             "inner join [RN_DB].[dbo].[tbl_incident] on [RN_DB].[dbo].[tbl_medbill].[Incident_Id] = [RN_DB].[dbo].[tbl_incident].[Incident_id] " +
                    //                             "inner join [RN_DB].[dbo].[tbl_illness] on [RN_DB].[dbo].[tbl_medbill].[Illness_Id] = [RN_DB].[dbo].[tbl_illness].[Illness_Id] " +
                    //                             "inner join [SalesForce].[dbo].[account] on [RN_DB].[dbo].[tbl_medbill].[MedicalProvider_Id] = [SalesForce].[dbo].[account].[Id] " +
                    //                             "inner join [SalesForce].[dbo].[ICD10 Code] on [RN_DB].[dbo].[tbl_illness].[ICD_10_Id] = [SalesForce].[dbo].[ICD10 Code].[ICD10_CODE__C] " +
                    //                             "inner join [SalesForce].[dbo].[contact] on [RN_DB].[dbo].[tbl_medbill].[Individual_Id] = [SalesForce].[dbo].[contact].[Individual_ID__c] " +
                    //                             "where [RN_DB].[dbo].[tbl_medbill].[BillNo] = @MedBillNo";

                    String strSqlQueryBillPaid = "select [RN_DB].[dbo].[tbl_incident].[IncidentNo], [SalesForce].[dbo].[contact].[Name], " +
                             "[RN_DB].[dbo].[tbl_medbill].[BillNo], [RN_DB].[dbo].[tbl_medbill].[BillDate], " +
                             "[SalesForce].[dbo].[account].[Name], [RN_DB].[dbo].[tbl_medbill].[BillAmount], " +
                             "[RN_DB].[dbo].[tbl_medbill].[PersonalResponsibilityCredit], [RN_DB].[dbo].[tbl_medbill].[Balance] " +
                             "from [RN_DB].[dbo].[tbl_medbill] " +
                             "inner join [RN_DB].[dbo].[tbl_incident] on [RN_DB].[dbo].[tbl_medbill].[Incident_Id] = [RN_DB].[dbo].[tbl_incident].[Incident_id] " +
                             "inner join [RN_DB].[dbo].[tbl_illness] on [RN_DB].[dbo].[tbl_medbill].[Illness_Id] = [RN_DB].[dbo].[tbl_illness].[Illness_Id] " +
                             "inner join [SalesForce].[dbo].[account] on [RN_DB].[dbo].[tbl_medbill].[MedicalProvider_Id] = [SalesForce].[dbo].[account].[Id] " +
                             "inner join [SalesForce].[dbo].[contact] on [RN_DB].[dbo].[tbl_medbill].[Individual_Id] = [SalesForce].[dbo].[contact].[Individual_ID__c] " +
                             "where [RN_DB].[dbo].[tbl_medbill].[BillNo] = @MedBillNo";

                    SqlCommand cmdQueryForMedBillPaid = new SqlCommand(strSqlQueryBillPaid, connRN6);
                    cmdQueryForMedBillPaid.CommandType = CommandType.Text;

                    cmdQueryForMedBillPaid.Parameters.AddWithValue("@MedBillNo", strMedBillNo);

                    if (connRN6.State != ConnectionState.Closed)
                    {
                        connRN6.Close();
                        connRN6.Open();
                    }
                    else if (connRN6.State == ConnectionState.Closed) connRN6.Open();
                    SqlDataReader rdrMedBillPaid = cmdQueryForMedBillPaid.ExecuteReader();
                    if (rdrMedBillPaid.HasRows)
                    {
                        bPaidHasRowBlueSheet = true;

                        while (rdrMedBillPaid.Read())
                        {
                            if (!rdrMedBillPaid.IsDBNull(0)) lstIncdNamesBlueSheet.Add(rdrMedBillPaid.GetString(0));

                            MedicalExpenseBlueSheet expense = new MedicalExpenseBlueSheet();

                            String IncidentNo = String.Empty;

                            drClosed = dtMedicalBillPaid.NewRow();
                            if (!rdrMedBillPaid.IsDBNull(0))
                            {
                                IncidentNo = rdrMedBillPaid.GetString(0);
                                drClosed["INCD"] = IncidentNo;
                            }
                            if (!rdrMedBillPaid.IsDBNull(1)) drClosed["회원 이름"] = rdrMedBillPaid.GetString(1);
                            if (!rdrMedBillPaid.IsDBNull(2)) drClosed["MED_BILL"] = rdrMedBillPaid.GetString(2).Substring(10);
                            if (!rdrMedBillPaid.IsDBNull(3)) drClosed["서비스 날짜"] = rdrMedBillPaid.GetDateTime(3).ToString("MM/dd/yyyy");
                            if (!rdrMedBillPaid.IsDBNull(4)) drClosed["의료기관명"] = rdrMedBillPaid.GetString(4);
                            if (!rdrMedBillPaid.IsDBNull(5))
                            {
                                expense.BillAmount = (Double?)rdrMedBillPaid.GetDecimal(5);
                                drClosed["청구액(원금)"] = expense.BillAmount.Value.ToString("C");
                            }
                            if (!rdrMedBillPaid.IsDBNull(7))
                            {
                                expense.Balance = (Double?)rdrMedBillPaid.GetDecimal(7);
                                drClosed["잔액/보류"] = expense.Balance.Value.ToString("C");
                            }

                            // Ask Tim about this section to confirm, (personal responisibility types)
                            String strSqlQueryForPersonalResponsibility = "select [dbo].[tbl_settlement].[PersonalResponsibilityCredit], [dbo].[tbl_settlement].[SettlementType] " +
                                                                          "from [dbo].[tbl_settlement] " +
                                                                          "inner join [dbo].[tbl_settlement_type_code] " +
                                                                          "on [dbo].[tbl_settlement].[SettlementType] = [dbo].[tbl_settlement_type_code].[SettlementTypeCode] " +
                                                                          "inner join [dbo].[tbl_medbill] on [dbo].[tbl_settlement].[MedicalBillID] = [dbo].[tbl_medbill].[BillNo] " +
                                                                          "inner join [dbo].[tbl_incident] on [dbo].[tbl_medbill].[Incident_Id] = [dbo].[tbl_incident].[Incident_id] " +
                                                                          "where ([dbo].[tbl_settlement_type_code].[SettlementTypeValue] = 'Member Payment' or " +
                                                                          "[dbo].[tbl_settlement_type_code].[SettlementTypeValue] = '3rd Party Discount' or " +
                                                                          "[dbo].[tbl_settlement_type_code].[SettlementTypeValue] = 'Member Discount') and " +
                                                                          "[dbo].[tbl_settlement].[PersonalResponsibilityCredit] > 0 and " +
                                                                          "[dbo].[tbl_medbill].[BillNo] = @MedBillNo and [dbo].[tbl_incident].[IncidentNo] = @IncidentNo";


                            SqlCommand cmdQueryForPersonalResponsibility = new SqlCommand(strSqlQueryForPersonalResponsibility, connRN5);
                            cmdQueryForPersonalResponsibility.CommandType = CommandType.Text;

                            cmdQueryForPersonalResponsibility.Parameters.AddWithValue("@MedBillNo", strMedBillNo);
                            cmdQueryForPersonalResponsibility.Parameters.AddWithValue("@IncidentNo", IncidentNo);

                            Decimal? PersonalResponsibility = 0;

                            if (connRN5.State != ConnectionState.Closed)
                            {
                                connRN5.Close();
                                connRN5.Open();
                            }
                            else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                            SqlDataReader rdrPersonalResponsibility = cmdQueryForPersonalResponsibility.ExecuteReader();
                            if (rdrPersonalResponsibility.HasRows)
                            {
                                while (rdrPersonalResponsibility.Read())
                                {
                                    if (!rdrPersonalResponsibility.IsDBNull(0)) PersonalResponsibility += rdrPersonalResponsibility.GetDecimal(0);
                                }
                            }
                            rdrPersonalResponsibility.Close();
                            if (connRN5.State != ConnectionState.Closed) connRN5.Close();

                            expense.PersonalResponsibility = (double?)PersonalResponsibility.Value;

                            drClosed["본인 부담금"] = expense.PersonalResponsibility.Value.ToString("C");
                            ////////////////////////////////////////////////////////////////////////////////////////////
                            ///

                            String strSqlQueryForMemberDiscount = "select [dbo].[tbl_settlement].[Amount], [dbo].[tbl_settlement].[SettlementType] " +
                                                                  "from [dbo].[tbl_settlement] " +
                                                                "inner join [dbo].[tbl_settlement_type_code] " +
                                                                "on [dbo].[tbl_settlement].[SettlementType] = [dbo].[tbl_settlement_type_code].[SettlementTypeCode] " +
                                                                "inner join [dbo].[tbl_medbill] on [dbo].[tbl_settlement].[MedicalBillID] = [dbo].[tbl_medbill].[BillNo] " +
                                                                "inner join [dbo].[tbl_incident] on [dbo].[tbl_medbill].[Incident_Id] = [dbo].[tbl_incident].[Incident_id] " +
                                                                "where [dbo].[tbl_settlement_type_code].[SettlementTypeValue] = 'Member Discount' and " +
                                                                "[dbo].[tbl_settlement].[PersonalResponsibilityCredit] = 0 and " +
                                                                "[dbo].[tbl_medbill].[BillNo] = @MedBillNo and [dbo].[tbl_incident].[IncidentNo] = @IncidentNo";

                            SqlCommand cmdQueryForMemberDiscount = new SqlCommand(strSqlQueryForMemberDiscount, connRN5);
                            cmdQueryForMemberDiscount.CommandType = CommandType.Text;

                            cmdQueryForMemberDiscount.Parameters.AddWithValue("@MedBillNo", strMedBillNo);
                            cmdQueryForMemberDiscount.Parameters.AddWithValue("@IncidentNo", IncidentNo);

                            Decimal? MemberDiscount = 0;

                            if (connRN5.State != ConnectionState.Closed)
                            {
                                connRN5.Close();
                                connRN5.Open();
                            }
                            else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                            SqlDataReader rdrMemberDiscount = cmdQueryForMemberDiscount.ExecuteReader();
                            if (rdrMemberDiscount.HasRows)
                            {
                                while (rdrMemberDiscount.Read())
                                {
                                    if (!rdrMemberDiscount.IsDBNull(0)) MemberDiscount += rdrMemberDiscount.GetDecimal(0);
                                }
                            }
                            rdrMemberDiscount.Close();
                            if (connRN5.State != ConnectionState.Closed) connRN5.Close();

                            expense.MemberDiscount = (double?)MemberDiscount.Value;

                            drClosed["회원할인"] = expense.MemberDiscount.Value.ToString("C");

                            /////////////////////////////////////////////////////////////////////////////////////////
                            ///
                            string strSqlQueryForCMMDiscount = "select [dbo].[tbl_settlement].[Amount], [dbo].[tbl_settlement].[SettlementType] " +
                                                                "from [dbo].[tbl_settlement] " +
                                                                "inner join [dbo].[tbl_settlement_type_code] " +
                                                                "on [dbo].[tbl_settlement].[SettlementType] = [dbo].[tbl_settlement_type_code].[SettlementTypeCode] " +
                                                                "inner join [dbo].[tbl_medbill] on [dbo].[tbl_settlement].[MedicalBillID] = [dbo].[tbl_medbill].[BillNo] " +
                                                                "inner join [dbo].[tbl_incident] on [dbo].[tbl_medbill].[Incident_Id] = [dbo].[tbl_incident].[Incident_id] " +
                                                                "where [dbo].[tbl_settlement_type_code].[SettlementTypeValue] = 'CMM Discount' and " +
                                                                "[dbo].[tbl_settlement].[PersonalResponsibilityCredit] = 0 and " +
                                                                "[dbo].[tbl_medbill].[BillNo] = @MedBillNo and [dbo].[tbl_incident].[IncidentNo] = @IncidentNo";

                            SqlCommand cmdQueryForCMMDiscount = new SqlCommand(strSqlQueryForCMMDiscount, connRN5);
                            cmdQueryForCMMDiscount.CommandType = CommandType.Text;

                            cmdQueryForCMMDiscount.Parameters.AddWithValue("@MedBillNo", strMedBillNo);
                            cmdQueryForCMMDiscount.Parameters.AddWithValue("@IncidentNo", IncidentNo);

                            Decimal? CMMDiscount = 0;
                            if (connRN5.State != ConnectionState.Closed)
                            {
                                connRN5.Close();
                                connRN5.Open();
                            }
                            else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                            SqlDataReader rdrCMMDiscount = cmdQueryForCMMDiscount.ExecuteReader();
                            if (rdrCMMDiscount.HasRows)
                            {
                                while (rdrCMMDiscount.Read())
                                {
                                    if (!rdrCMMDiscount.IsDBNull(0)) CMMDiscount += rdrCMMDiscount.GetDecimal(0);
                                }
                            }
                            rdrCMMDiscount.Close();
                            if (connRN5.State != ConnectionState.Closed) connRN5.Close();

                            expense.CMMDiscount = (double?)CMMDiscount.Value;
                            drClosed["CMM 할인"] = expense.CMMDiscount.Value.ToString("C");

                            string strSqlCMMProviderPayment = string.Empty;

                            if (rbCheckBlueSheet.Checked || rbACHBlueSheet.Checked)
                            {
                                strSqlCMMProviderPayment = "select [dbo].[tbl_settlement].[Amount], [dbo].[tbl_settlement].[SettlementType] " +
                                                           "from [dbo].[tbl_settlement] " +
                                                           "inner join [dbo].[tbl_settlement_type_code] on [dbo].[tbl_settlement].[SettlementType] = [dbo].[tbl_settlement_type_code].[SettlementTypeCode] " +
                                                           "inner join [dbo].[tbl_medbill] on [dbo].[tbl_settlement].[MedicalBillID] = [dbo].[tbl_medbill].[BillNo] " +
                                                           "inner join [dbo].[tbl_incident] on [dbo].[tbl_medbill].[Incident_Id] = [dbo].[tbl_incident].[Incident_id] " +
                                                           "where [dbo].[tbl_settlement_type_code].[SettlementTypeValue] = 'CMM Provider Payment' and " +
                                                           "[dbo].[tbl_medbill].[BillNo] = @MedBillNo and [dbo].[tbl_incident].[IncidentNo] = @IncidentNo and " +
                                                           "(([dbo].[tbl_settlement].[CheckDate] IS NOT NULL and [dbo].[tbl_settlement].[CheckNo] IS NOT NULL) or " +
                                                           "([dbo].[tbl_settlement].[ACH_Date] IS NOT NULL and [dbo].[tbl_settlement].[ACH_Number] IS NOT NULL) or " +
                                                           "([dbo].[tbl_settlement].[CMMCreditCardPaidDate] IS NOT NULL))";
                            }
                            if (rbCreditCardBlueSheet.Checked)
                            {
                                strSqlCMMProviderPayment = "select [dbo].[tbl_settlement].[Amount], [dbo].[tbl_settlement].[SettlementType] " +
                                                           "from [dbo].[tbl_settlement] " +
                                                           "inner join [dbo].[tbl_settlement_type_code] on [dbo].[tbl_settlement].[SettlementType] = [dbo].[tbl_settlement_type_code].[SettlementTypeCode] " +
                                                           "inner join [dbo].[tbl_medbill] on [dbo].[tbl_settlement].[MedicalBillID] = [dbo].[tbl_medbill].[BillNo] " +
                                                           "inner join [dbo].[tbl_incident] on [dbo].[tbl_medbill].[Incident_Id] = [dbo].[tbl_incident].[Incident_id] " +
                                                           "where [dbo].[tbl_settlement_type_code].[SettlementTypeValue] = 'CMM Provider Payment' and " +
                                                           "[dbo].[tbl_medbill].[BillNo] = @MedBillNo and [dbo].[tbl_incident].[IncidentNo] = @IncidentNo and " +
                                                           "([dbo].[tbl_settlement].[CMMCreditCardPaidDate] IS NOT NULL and " +
                                                           "cast([dbo].[tbl_settlement].[CMMCreditCardPaidDate] as date) = @CreditCardPaidDate)";
                            }

                            SqlCommand cmdQueryForCMMProviderPayment = new SqlCommand(strSqlCMMProviderPayment, connRN5);
                            cmdQueryForCMMProviderPayment.CommandType = CommandType.Text;

                            cmdQueryForCMMProviderPayment.Parameters.AddWithValue("@MedBillNo", strMedBillNo);
                            cmdQueryForCMMProviderPayment.Parameters.AddWithValue("@IncidentNo", IncidentNo);
                            cmdQueryForCMMProviderPayment.Parameters.AddWithValue("@CreditCardPaidDate", dtpCreditCardPaymentDateBlueSheet.Value.ToString("MM/dd/yyyy"));

                            Decimal? CMMProviderPayment = 0;

                            if (connRN5.State != ConnectionState.Closed)
                            {
                                connRN5.Close();
                                connRN5.Open();
                            }
                            else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                            SqlDataReader rdrCMMProviderPayment = cmdQueryForCMMProviderPayment.ExecuteReader();
                            if (rdrCMMProviderPayment.HasRows)
                            {
                                while (rdrCMMProviderPayment.Read())
                                {
                                    if (!rdrCMMProviderPayment.IsDBNull(0)) CMMProviderPayment += rdrCMMProviderPayment.GetDecimal(0);
                                }
                            }
                            rdrCMMProviderPayment.Close();
                            if (connRN5.State != ConnectionState.Closed) connRN5.Close();

                            expense.CMMProviderPayment = (double?)CMMProviderPayment.Value;
                            drClosed["의료기관 지불금"] = expense.CMMProviderPayment.Value.ToString("C");

                            if (PaidToBlueSheet == EnumPaidTo.Member)
                            {
                                String strSqlQueryForPastReimbursement = "select [dbo].[tbl_settlement].[Amount], [dbo].[tbl_settlement].[SettlementType] " +
                                                                   "from [dbo].[tbl_settlement] " +
                                                                   "inner join [dbo].[tbl_settlement_type_code] on [dbo].[tbl_settlement].[SettlementType] = [dbo].[tbl_settlement_type_code].[SettlementTypeCode] " +
                                                                   "inner join [dbo].[tbl_medbill] on [dbo].[tbl_settlement].[MedicalBillID] = [dbo].[tbl_medbill].[BillNo] " +
                                                                   "inner join [dbo].[tbl_incident] on [dbo].[tbl_medbill].[Incident_Id] = [dbo].[tbl_incident].[Incident_id] " +
                                                                   "where ([dbo].[tbl_settlement_type_code].[SettlementTypeValue] = 'CMM Member Reimbursement' or " +
                                                                   "[dbo].[tbl_settlement_type_code].[SettlementTypeValue] = 'PR reimbursement') and " +
                                                                   "[dbo].[tbl_medbill].[BillNo] = @MedBillNo and [dbo].[tbl_incident].[IncidentNo] = @IncidentNo and " +
                                                                   "(([dbo].[tbl_settlement].[CheckDate] IS NOT NULL and [dbo].[tbl_settlement].[CheckNo] != @CheckNo) or " +
                                                                   "([dbo].[tbl_settlement].[ACH_Date] IS NOT NULL and [dbo].[tbl_settlement].[ACH_Number] != @ACH_No))";

                                SqlCommand cmdQueryForPastReimbursement = new SqlCommand(strSqlQueryForPastReimbursement, connRN5);
                                cmdQueryForPastReimbursement.CommandType = CommandType.Text;

                                cmdQueryForPastReimbursement.Parameters.AddWithValue("@MedBillNo", strMedBillNo);
                                cmdQueryForPastReimbursement.Parameters.AddWithValue("@IncidentNo", IncidentNo);
                                cmdQueryForPastReimbursement.Parameters.AddWithValue("@CheckNo", txtCheckNoBlueSheet.Text.Trim());
                                cmdQueryForPastReimbursement.Parameters.AddWithValue("@ACH_No", txtACHNoBlueSheet.Text.Trim());

                                Decimal? PastReimbursement = 0;

                                if (connRN5.State != ConnectionState.Closed)
                                {
                                    connRN5.Close();
                                    connRN5.Open();
                                }
                                else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                                SqlDataReader rdrPastReimbursement = cmdQueryForPastReimbursement.ExecuteReader();
                                if (rdrPastReimbursement.HasRows)
                                {
                                    while (rdrPastReimbursement.Read())
                                    {
                                        if (!rdrPastReimbursement.IsDBNull(0)) PastReimbursement += rdrPastReimbursement.GetDecimal(0);
                                    }
                                }
                                if (connRN5.State != ConnectionState.Closed) connRN5.Close();

                                expense.PastReimbursement = (double?)PastReimbursement.Value;
                                drClosed["기지급액"] = expense.Reimbursement.Value.ToString("C");

                                if (PaidToBlueSheet == EnumPaidTo.Member)
                                {
                                    String strSqlReimbursement = "select [dbo].[tbl_settlement].[Amount], [dbo].[tbl_settlement].[SettlementType] " +
                                                                   "from [dbo].[tbl_settlement] " +
                                                                   "inner join [dbo].[tbl_settlement_type_code] on [dbo].[tbl_settlement].[SettlementType] = [dbo].[tbl_settlement_type_code].[SettlementTypeCode] " +
                                                                   "inner join [dbo].[tbl_medbill] on [dbo].[tbl_settlement].[MedicalBillID] = [dbo].[tbl_medbill].[BillNo] " +
                                                                   "inner join [dbo].[tbl_incident] on [dbo].[tbl_medbill].[Incident_Id] = [dbo].[tbl_incident].[Incident_id] " +
                                                                   "where ([dbo].[tbl_settlement_type_code].[SettlementTypeValue] = 'CMM Member Reimbursement' or " +
                                                                   "[dbo].[tbl_settlement_type_code].[SettlementTypeValue] = 'PR reimbursement') and " +
                                                                   "[dbo].[tbl_medbill].[BillNo] = @MedBillNo and [dbo].[tbl_incident].[IncidentNo] = @IncidentNo and " +
                                                                   "(([dbo].[tbl_settlement].[CheckDate] IS NOT NULL and [dbo].[tbl_settlement].[CheckNo] = @CheckNo) or " +
                                                                   "([dbo].[tbl_settlement].[ACH_Date] IS NOT NULL and [dbo].[tbl_settlement].[ACH_Number] = @ACH_No))";

                                    SqlCommand cmdQueryForReimbursement = new SqlCommand(strSqlReimbursement, connRN5);
                                    cmdQueryForReimbursement.CommandType = CommandType.Text;

                                    cmdQueryForReimbursement.Parameters.AddWithValue("@MedBillNo", strMedBillNo);
                                    cmdQueryForReimbursement.Parameters.AddWithValue("@IncidentNo", IncidentNo);
                                    cmdQueryForReimbursement.Parameters.AddWithValue("@CheckNo", txtCheckNoBlueSheet.Text.Trim());
                                    cmdQueryForReimbursement.Parameters.AddWithValue("@ACH_No", txtACHNoBlueSheet.Text.Trim());

                                    Decimal? Reimbursement = 0;

                                    if (connRN5.State != ConnectionState.Closed)
                                    {
                                        connRN5.Close();
                                        connRN5.Open();
                                    }
                                    else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                                    SqlDataReader rdrMemberReimbursement = cmdQueryForReimbursement.ExecuteReader();
                                    if (rdrMemberReimbursement.HasRows)
                                    {
                                        while (rdrMemberReimbursement.Read())
                                        {
                                            if (!rdrMemberReimbursement.IsDBNull(0)) Reimbursement += rdrMemberReimbursement.GetDecimal(0);
                                        }
                                    }
                                    rdrMemberReimbursement.Close();
                                    if (connRN5.State != ConnectionState.Closed) connRN5.Close();

                                    expense.Reimbursement = (double?)Reimbursement;
                                    drClosed["회원 환불금"] = expense.Reimbursement.Value.ToString("C");
                                }
                            }

                            if (PaidToBlueSheet == EnumPaidTo.MedicalProvider)
                            {
                                String strSqlPastProviderPayment = "select [dbo].[tbl_settlement].[Amount], [dbo].[tbl_settlement].[SettlementType] " +
                                                                "from [dbo].[tbl_settlement] " +
                                                                "inner join [dbo].[tbl_settlement_type_code] on [dbo].[tbl_settlement].[SettlementType] = [dbo].[tbl_settlement_type_code].[SettlementTypeCode] " +
                                                                "inner join [dbo].[tbl_medbill] on [dbo].[tbl_settlement].[MedicalBillID] = [dbo].[tbl_medbill].[BillNo] " +
                                                                "inner join [dbo].[tbl_incident] on [dbo].[tbl_medbill].[Incident_Id] = [dbo].[tbl_incident].[Incident_id] " +
                                                                "where [dbo].[tbl_settlement_type_code].[SettlementTypeValue] = 'CMM Provider Payment' and  " +
                                                                "[dbo].[tbl_medbill].[BillNo] = @MedBillNo and [dbo].[tbl_incident].[IncidentNo] = @IncidentNo and " +
                                                                "(([dbo].[tbl_settlement].[CheckDate] IS NOT NULL and [dbo].[tbl_settlement].[CheckNo] != @CheckNo) or " +
                                                                "([dbo].[tbl_settlement].[ACH_Date] IS NOT NULL and [dbo].[tbl_settlement].[ACH_Number] != @ACH_No) or " +
                                                                "([dbo].[tbl_settlement].[CMMCreditCard] IS NOT NULL and [dbo].[tbl_settlement].[CMMCreditCard] != 0 and " +
                                                                "[dbo].[tbl_settlement].[CMMCreditCardPaidDate] < @CreditCardPaymentDate))";

                                SqlCommand cmdQueryForPastProviderPayment = new SqlCommand(strSqlPastProviderPayment, connRN5);
                                cmdQueryForPastProviderPayment.CommandType = CommandType.Text;

                                cmdQueryForPastProviderPayment.Parameters.AddWithValue("@MedBillNo", strMedBillNo);
                                cmdQueryForPastProviderPayment.Parameters.AddWithValue("@IncidentNo", IncidentNo);
                                cmdQueryForPastProviderPayment.Parameters.AddWithValue("@CheckNo", txtCheckNoBlueSheet.Text.Trim());
                                cmdQueryForPastProviderPayment.Parameters.AddWithValue("@ACH_No", txtACHNoBlueSheet.Text.Trim());
                                cmdQueryForPastProviderPayment.Parameters.AddWithValue("@CreditCardPaymentDate", dtpCreditCardPaymentDateBlueSheet.Value);

                                Decimal? PastProviderPayment = 0;

                                if (connRN5.State != ConnectionState.Closed)
                                {
                                    connRN5.Close();
                                    connRN5.Open();
                                }
                                else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                                SqlDataReader rdrPastProviderPayment = cmdQueryForPastProviderPayment.ExecuteReader();
                                if (rdrPastProviderPayment.HasRows)
                                {
                                    while (rdrPastProviderPayment.Read())
                                    {
                                        if (!rdrPastProviderPayment.IsDBNull(0)) PastProviderPayment += rdrPastProviderPayment.GetDecimal(0);
                                    }
                                }
                                rdrPastProviderPayment.Close();
                                if (connRN5.State != ConnectionState.Closed) connRN5.Close();

                                expense.PastCMMProviderPayment = (double?)PastProviderPayment.Value;
                                drClosed["기지급액 (의료기관)"] = expense.PastCMMProviderPayment.Value.ToString("C");

                                String strSqlPastMemberReimbursement = "select [dbo].[tbl_settlement].[Amount], [dbo].[tbl_settlement].[SettlementType] " +
                                                    "from [dbo].[tbl_settlement] " +
                                                    "inner join [dbo].[tbl_settlement_type_code] on [dbo].[tbl_settlement].[SettlementType] = [dbo].[tbl_settlement_type_code].[SettlementTypeCode] " +
                                                    "inner join [dbo].[tbl_medbill] on [dbo].[tbl_settlement].[MedicalBillID] = [dbo].[tbl_medbill].[BillNo] " +
                                                    "inner join [dbo].[tbl_incident] on [dbo].[tbl_medbill].[Incident_Id] = [dbo].[tbl_incident].[Incident_id] " +
                                                    "where (([dbo].[tbl_settlement_type_code].[SettlementTypeValue] = 'CMM Member Reimbursement' or " +
                                                    "[dbo].[tbl_settlement_type_code].[SettlementTypeValue] = 'PR Reimbursement') and  " +
                                                    "[dbo].[tbl_medbill].[BillNo] = @MedBillNo and [dbo].[tbl_incident].[IncidentNo] = @IncidentNo and " +
                                                    "(([dbo].[tbl_settlement].[CheckDate] IS NOT NULL and [dbo].[tbl_settlement].[CheckNo] != @CheckNo) or " +
                                                    "([dbo].[tbl_settlement].[ACH_Date] IS NOT NULL and [dbo].[tbl_settlement].[ACH_Number] != @ACH_No)))";

                                SqlCommand cmdQueryForPastMemberReimbursement = new SqlCommand(strSqlPastMemberReimbursement, connRN5);
                                cmdQueryForPastMemberReimbursement.CommandType = CommandType.Text;

                                cmdQueryForPastMemberReimbursement.Parameters.AddWithValue("@MedBillNo", strMedBillNo);
                                cmdQueryForPastMemberReimbursement.Parameters.AddWithValue("@IncidentNo", IncidentNo);
                                cmdQueryForPastMemberReimbursement.Parameters.AddWithValue("@CheckNo", txtCheckNoBlueSheet.Text.Trim());
                                cmdQueryForPastMemberReimbursement.Parameters.AddWithValue("@ACH_No", txtACHNoBlueSheet.Text.Trim());

                                Decimal? PastMemberReimbursement = 0;

                                if (connRN5.State != ConnectionState.Closed)
                                {
                                    connRN5.Close();
                                    connRN5.Open();
                                }
                                else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                                SqlDataReader rdrPastMemberReimbursement = cmdQueryForPastMemberReimbursement.ExecuteReader();
                                if (rdrPastMemberReimbursement.HasRows)
                                {
                                    while (rdrPastMemberReimbursement.Read())
                                    {
                                        if (!rdrPastMemberReimbursement.IsDBNull(0)) PastMemberReimbursement += rdrPastMemberReimbursement.GetDecimal(0);
                                    }
                                }
                                rdrPastMemberReimbursement.Close();
                                if (connRN5.State != ConnectionState.Closed) connRN5.Close();

                                expense.PastReimbursement = (double?)PastMemberReimbursement.Value;
                                drClosed["기지급액 (회원)"] = expense.PastReimbursement.Value.ToString("C");
                            }
                            if (drClosed != null)
                            {
                                dtMedicalBillPaid.Rows.Add(drClosed);
                                lstMedicalExpense.Add(expense);
                            }
                        }
                    }
                    if (connRN6.State != ConnectionState.Closed) connRN6.Close();
                }

                if (bPaidHasRowBlueSheet)
                {
                    double sumClosedBillAmount = 0;
                    double sumClosedPersonalResponsibility = 0;
                    double sumClosedMemberDiscount = 0;
                    double sumClosedCMMDiscount = 0;
                    double sumClosedCMMProviderPayment = 0;
                    double sumClosedPastCMMProviderPayment = 0;
                    double sumClosedPastReimbursement = 0;
                    double sumClosedReimbursement = 0;
                    double sumClosedBalance = 0;

                    foreach (MedicalExpenseBlueSheet expense in lstMedicalExpense)
                    {
                        sumClosedBillAmount += expense.BillAmount.Value;
                        sumClosedPersonalResponsibility += expense.PersonalResponsibility.Value;
                        sumClosedMemberDiscount += expense.MemberDiscount.Value;
                        sumClosedCMMDiscount += expense.CMMDiscount.Value;
                        sumClosedCMMProviderPayment += expense.CMMProviderPayment.Value;
                        sumClosedPastCMMProviderPayment += expense.PastCMMProviderPayment.Value;
                        sumClosedPastReimbursement += expense.PastReimbursement.Value;
                        sumClosedReimbursement += expense.Reimbursement.Value;
                        sumClosedBalance += expense.Balance.Value;
                    }

                    DataRow drClosedSum = dtMedicalBillPaid.NewRow();

                    drClosedSum["의료기관명"] = "합계";

                    drClosedSum["청구액(원금)"] = sumClosedBillAmount.ToString("C");
                    drClosedSum["본인 부담금"] = sumClosedPersonalResponsibility.ToString("C");
                    drClosedSum["회원할인"] = sumClosedMemberDiscount.ToString("C");
                    drClosedSum["CMM 할인"] = sumClosedCMMDiscount.ToString("C");
                    drClosedSum["의료기관 지불금"] = sumClosedCMMProviderPayment.ToString("C");

                    if (PaidToBlueSheet == EnumPaidTo.Member)
                    {
                        drClosedSum["기지급액"] = sumClosedPastReimbursement.ToString("C");
                        drClosedSum["회원 환불금"] = sumClosedReimbursement.ToString("C");
                    }

                    if (PaidToBlueSheet == EnumPaidTo.MedicalProvider)
                    {
                        drClosedSum["기지급액 (의료기관)"] = sumClosedPastCMMProviderPayment.ToString("C");
                        drClosedSum["기지급액 (회원)"] = sumClosedPastReimbursement.ToString("C");
                    }
                    drClosedSum["잔액/보류"] = sumClosedBalance.ToString("C");

                    dtMedicalBillPaid.Rows.Add(drClosedSum);

                    gvSharedMedBillBlueSheet.DataSource = null;
                    gvSharedMedBillBlueSheet.DataSource = dtMedicalBillPaid;

                    DataTable dt = dtMedicalBillPaid.Copy();
                    gvSharedInPaidTab.DataSource = null;
                    gvSharedInPaidTab.DataSource = dt;

                    paidSortedFieldBlueSheet.Field = "서비스 날짜";
                    paidSortedFieldBlueSheet.Sorted = EnumSorted.NotSorted;
                    SortBillSharedTable(paidSortedFieldBlueSheet);

                    gvSharedMedBillBlueSheet.Columns["INCD"].SortMode = DataGridViewColumnSortMode.Programmatic;
                    gvSharedMedBillBlueSheet.Columns["회원 이름"].SortMode = DataGridViewColumnSortMode.Programmatic;
                    gvSharedMedBillBlueSheet.Columns["MED_BILL"].SortMode = DataGridViewColumnSortMode.Programmatic;
                    gvSharedMedBillBlueSheet.Columns["서비스 날짜"].SortMode = DataGridViewColumnSortMode.Programmatic;
                    gvSharedMedBillBlueSheet.Columns["의료기관명"].SortMode = DataGridViewColumnSortMode.Programmatic;

                    gvSharedMedBillBlueSheet.Columns["회원 이름"].SortMode = DataGridViewColumnSortMode.NotSortable;
                    gvSharedMedBillBlueSheet.Columns["청구액(원금)"].SortMode = DataGridViewColumnSortMode.NotSortable;
                    gvSharedMedBillBlueSheet.Columns["본인 부담금"].SortMode = DataGridViewColumnSortMode.NotSortable;
                    gvSharedMedBillBlueSheet.Columns["회원할인"].SortMode = DataGridViewColumnSortMode.NotSortable;
                    gvSharedMedBillBlueSheet.Columns["CMM 할인"].SortMode = DataGridViewColumnSortMode.NotSortable;
                    gvSharedMedBillBlueSheet.Columns["의료기관 지불금"].SortMode = DataGridViewColumnSortMode.NotSortable;

                    if (PaidToBlueSheet == EnumPaidTo.Member)
                    {
                        gvSharedMedBillBlueSheet.Columns["기지급액"].SortMode = DataGridViewColumnSortMode.NotSortable;
                        gvSharedMedBillBlueSheet.Columns["회원 환불금"].SortMode = DataGridViewColumnSortMode.NotSortable;
                    }

                    if (PaidToBlueSheet == EnumPaidTo.MedicalProvider)
                    {
                        gvSharedMedBillBlueSheet.Columns["기지급액 (의료기관)"].SortMode = DataGridViewColumnSortMode.NotSortable;
                        gvSharedMedBillBlueSheet.Columns["기지급액 (회원)"].SortMode = DataGridViewColumnSortMode.NotSortable;
                    }
                    gvSharedMedBillBlueSheet.Columns["잔액/보류"].SortMode = DataGridViewColumnSortMode.NotSortable;

                    foreach (DataGridViewColumn col in gvSharedMedBillBlueSheet.Columns)
                    {
                        col.HeaderCell.Style.Alignment = DataGridViewContentAlignment.MiddleCenter;
                    }

                    foreach (DataGridViewColumn col in gvSharedInPaidTab.Columns)
                    {
                        col.HeaderCell.Style.Alignment = DataGridViewContentAlignment.MiddleCenter;
                    }

                    gvSharedMedBillBlueSheet.Columns["INCD"].DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleCenter;
                    gvSharedMedBillBlueSheet.Columns["회원 이름"].DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleCenter;
                    gvSharedMedBillBlueSheet.Columns["MED_BILL"].DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleCenter;
                    gvSharedMedBillBlueSheet.Columns["서비스 날짜"].DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleCenter;
                    gvSharedMedBillBlueSheet.Columns["의료기관명"].DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleLeft;
                    gvSharedMedBillBlueSheet.Columns["청구액(원금)"].DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleRight;
                    gvSharedMedBillBlueSheet.Columns["본인 부담금"].DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleRight;
                    gvSharedMedBillBlueSheet.Columns["회원할인"].DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleRight;
                    gvSharedMedBillBlueSheet.Columns["CMM 할인"].DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleRight;
                    gvSharedMedBillBlueSheet.Columns["의료기관 지불금"].DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleRight;

                    if (PaidToBlueSheet == EnumPaidTo.Member)
                    {
                        gvSharedMedBillBlueSheet.Columns["기지급액"].DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleRight;
                        gvSharedMedBillBlueSheet.Columns["회원 환불금"].DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleRight;
                    }

                    if (PaidToBlueSheet == EnumPaidTo.MedicalProvider)
                    {
                        gvSharedMedBillBlueSheet.Columns["기지급액 (의료기관)"].DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleRight;
                        gvSharedMedBillBlueSheet.Columns["기지급액 (회원)"].DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleRight;
                    }
                    gvSharedMedBillBlueSheet.Columns["잔액/보류"].DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleRight;

                    gvSharedMedBillBlueSheet.Columns["INCD"].Width = 100;
                    gvSharedMedBillBlueSheet.Columns["회원 이름"].Width = 150;
                    gvSharedMedBillBlueSheet.Columns["MED_BILL"].Width = 80;
                    gvSharedMedBillBlueSheet.Columns["서비스 날짜"].Width = 100;
                    gvSharedMedBillBlueSheet.Columns["의료기관명"].Width = 200;
                    gvSharedMedBillBlueSheet.Columns["청구액(원금)"].Width = 100;
                    gvSharedMedBillBlueSheet.Columns["본인 부담금"].Width = 100;
                    gvSharedMedBillBlueSheet.Columns["회원할인"].Width = 80;
                    gvSharedMedBillBlueSheet.Columns["CMM 할인"].Width = 100;
                    gvSharedMedBillBlueSheet.Columns["의료기관 지불금"].Width = 120;

                    if (PaidToBlueSheet == EnumPaidTo.Member)
                    {
                        gvSharedMedBillBlueSheet.Columns["기지급액"].Width = 100;
                        gvSharedMedBillBlueSheet.Columns["회원 환불금"].Width = 120;
                    }

                    if (PaidToBlueSheet == EnumPaidTo.MedicalProvider)
                    {
                        gvSharedMedBillBlueSheet.Columns["기지급액 (의료기관)"].Width = 140;
                        gvSharedMedBillBlueSheet.Columns["기지급액 (회원)"].Width = 100;
                    }
                    gvSharedMedBillBlueSheet.Columns["잔액/보류"].Width = 100;


                    paidInPaidTabSortedFieldBlueSheet.Field = "서비스 날짜";
                    paidInPaidTabSortedFieldBlueSheet.Sorted = EnumSorted.NotSorted;

                    ///////////////////////////////////////////////////////////////////////////////////
                    ///
                    gvSharedInPaidTab.Columns["INCD"].Width = 100;
                    gvSharedInPaidTab.Columns["회원 이름"].Width = 150;
                    gvSharedInPaidTab.Columns["MED_BILL"].Width = 80;
                    gvSharedInPaidTab.Columns["서비스 날짜"].Width = 100;
                    gvSharedInPaidTab.Columns["의료기관명"].Width = 200;
                    gvSharedInPaidTab.Columns["청구액(원금)"].Width = 100;
                    gvSharedInPaidTab.Columns["본인 부담금"].Width = 100;
                    gvSharedInPaidTab.Columns["회원할인"].Width = 80;
                    gvSharedInPaidTab.Columns["CMM 할인"].Width = 100;
                    gvSharedInPaidTab.Columns["의료기관 지불금"].Width = 120;

                    if (PaidToBlueSheet == EnumPaidTo.Member)
                    {
                        gvSharedInPaidTab.Columns["기지급액"].Width = 100;
                        gvSharedInPaidTab.Columns["회원 환불금"].Width = 120;
                    }

                    if (PaidToBlueSheet == EnumPaidTo.MedicalProvider)
                    {
                        gvSharedInPaidTab.Columns["기지급액 (의료기관)"].Width = 140;
                        gvSharedInPaidTab.Columns["기지급액 (회원)"].Width = 100;
                    }
                    gvSharedInPaidTab.Columns["잔액/보류"].Width = 100;

                    gvSharedInPaidTab.Columns["INCD"].DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleCenter; ;
                    gvSharedInPaidTab.Columns["회원 이름"].DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleCenter;
                    gvSharedInPaidTab.Columns["MED_BILL"].DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleCenter;
                    gvSharedInPaidTab.Columns["서비스 날짜"].DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleCenter;
                    gvSharedInPaidTab.Columns["의료기관명"].DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleLeft;

                    gvSharedInPaidTab.Columns["청구액(원금)"].DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleRight;
                    gvSharedInPaidTab.Columns["본인 부담금"].DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleRight;
                    gvSharedInPaidTab.Columns["회원할인"].DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleRight;
                    gvSharedInPaidTab.Columns["CMM 할인"].DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleRight;
                    gvSharedInPaidTab.Columns["의료기관 지불금"].DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleRight;

                    if (PaidToBlueSheet == EnumPaidTo.Member)
                    {
                        gvSharedInPaidTab.Columns["기지급액"].DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleRight;
                        gvSharedInPaidTab.Columns["회원 환불금"].DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleRight;
                    }

                    if (PaidToBlueSheet == EnumPaidTo.MedicalProvider)
                    {
                        gvSharedInPaidTab.Columns["기지급액 (의료기관)"].DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleRight;
                        gvSharedInPaidTab.Columns["기지급액 (회원)"].DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleRight;
                    }
                    gvSharedInPaidTab.Columns["잔액/보류"].DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleRight;


                    SortBillSharedTableInPaidTab(paidInPaidTabSortedFieldBlueSheet);
                }

                DataTable dtCMMPendingPayment = new DataTable();
                dtCMMPendingPayment.Columns.Add("INCD", typeof(String));
                dtCMMPendingPayment.Columns.Add("회원 이름", typeof(String));
                dtCMMPendingPayment.Columns.Add("MED_BILL", typeof(String));
                dtCMMPendingPayment.Columns.Add("서비스 날짜", typeof(String));
                dtCMMPendingPayment.Columns.Add("의료기관명", typeof(String));
                dtCMMPendingPayment.Columns.Add("청구액(원금)", typeof(String));
                dtCMMPendingPayment.Columns.Add("회원할인", typeof(String));
                dtCMMPendingPayment.Columns.Add("CMM 할인", typeof(String));
                dtCMMPendingPayment.Columns.Add("본인 부담금", typeof(String));
                dtCMMPendingPayment.Columns.Add("정산 완료", typeof(String));
                dtCMMPendingPayment.Columns.Add("지원 예정", typeof(String));

                DataRow drCMMPendingPayment = null;

                List<CMMPendingPaymentBlueSheet> lstCMMPendingPayment = new List<CMMPendingPaymentBlueSheet>();

                foreach (String IncdName in lstDistinctIncdNamesBlueSheet)
                {
                    String strSqlQueryForMedBillCMMPendingPayment = "select [dbo].[tbl_medbill].[BillNo], [dbo].[tbl_settlement].[Approved], " +
                                                                    "[dbo].[tbl_settlement].[SettlementType], [dbo].[tbl_settlement].[Amount] " +
                                                                    "from [dbo].[tbl_settlement] " +
                                                                    "inner join [dbo].[tbl_medbill] on [dbo].[tbl_settlement].[MedicalBillID] = [dbo].[tbl_medbill].[BillNo] " +
                                                                    "inner join [dbo].[tbl_incident] on [dbo].[tbl_medbill].[Incident_Id] = [dbo].[tbl_incident].[Incident_id] " +
                                                                    "where [dbo].[tbl_settlement].[Approved] = 1 and " +
                                                                    "[dbo].[tbl_settlement].[Amount] > 0 and " +
                                                                    "[dbo].[tbl_settlement].[Amount] IS NOT NULL and " +
                                                                    "[dbo].[tbl_settlement].[CheckNo] IS NULL and " +
                                                                    "[dbo].[tbl_settlement].[ACH_Number] IS NULL and " +
                                                                    "[dbo].[tbl_settlement].[CMMCreditCardPaidDate] IS NULL and" +
                                                                    "[dbo].[tbl_incident].[IncidentNo] = @IncidentNo " +
                                                                    "order by [dbo].[tbl_medbill].[BillDate]";

                    SqlCommand cmdQueryForMedBillCMMPendingPayment = new SqlCommand(strSqlQueryForMedBillCMMPendingPayment, connRN5);
                    cmdQueryForMedBillCMMPendingPayment.CommandType = CommandType.Text;

                    cmdQueryForMedBillCMMPendingPayment.Parameters.AddWithValue("@IncidentNo", IncdName);

                    if (connRN5.State != ConnectionState.Closed)
                    {
                        connRN5.Close();
                        connRN5.Open();
                    }
                    else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                    SqlDataReader rdrMedBillCMMPendingPayment = cmdQueryForMedBillCMMPendingPayment.ExecuteReader();
                    if (rdrMedBillCMMPendingPayment.HasRows)
                    {
                        bCMMPendingPaymentHasRowBlueSheet = true;

                        List<String> lstCMMPendingPaymentMedBillNames = new List<string>();
                        while (rdrMedBillCMMPendingPayment.Read())
                        {
                            if (!rdrMedBillCMMPendingPayment.IsDBNull(0)) lstCMMPendingPaymentMedBillNames.Add(rdrMedBillCMMPendingPayment.GetString(0));
                        }

                        List<string> lstCMMPendingPaymentDistinctMedBillNames = new List<string>();

                        foreach (string MedBillName in lstCMMPendingPaymentMedBillNames.Distinct())
                        {
                            lstCMMPendingPaymentDistinctMedBillNames.Add(MedBillName);
                        }

                        foreach (String DistinctMedBillName in lstCMMPendingPaymentDistinctMedBillNames)
                        {
                            String strSqlQueryForCMMPendingPayment = "select [RN_DB].[dbo].[tbl_incident].[IncidentNo], [SalesForce].[dbo].[contact].[Name], " +
                                                                     "[RN_DB].[dbo].[tbl_medbill].[BillNo], [RN_DB].[dbo].[tbl_medbill].[BillDate], " +
                                                                     "[SalesForce].[dbo].[account].[Name], [RN_DB].[dbo].[tbl_medbill].[BillAmount] " +
                                                                     "from [RN_DB].[dbo].[tbl_medbill] " +
                                                                     "inner join [SalesForce].[dbo].[contact] on [RN_DB].[dbo].[tbl_medbill].[Individual_Id] = [SalesForce].[dbo].[contact].[Individual_ID__c] " +
                                                                     "inner join [SalesForce].[dbo].[account] on [RN_DB].[dbo].[tbl_medbill].[MedicalProvider_Id] = [SalesForce].[dbo].[account].[Id] " +
                                                                     "inner join [RN_DB].[dbo].[tbl_incident] on [RN_DB].[dbo].[tbl_medbill].[Incident_Id] = [RN_DB].[dbo].[tbl_incident].[Incident_id] " +
                                                                     "where [RN_DB].[dbo].[tbl_medbill].[BillNo] = @MedBillNo and " +
                                                                     "[RN_DB].[dbo].[tbl_incident].[IncidentNo] = @IncidentNo";

                            SqlCommand cmdQueryForCMMPendingPayment = new SqlCommand(strSqlQueryForCMMPendingPayment, connRN7);
                            cmdQueryForCMMPendingPayment.CommandType = CommandType.Text;

                            cmdQueryForCMMPendingPayment.Parameters.AddWithValue("@MedBillNo", DistinctMedBillName);
                            cmdQueryForCMMPendingPayment.Parameters.AddWithValue("@IncidentNo", IncdName);

                            if (connRN7.State != ConnectionState.Closed)
                            {
                                connRN7.Close();
                                connRN7.Open();
                            }
                            else if (connRN7.State == ConnectionState.Closed) connRN7.Open();
                            SqlDataReader rdrCMMPendingPayment = cmdQueryForCMMPendingPayment.ExecuteReader();
                            if (rdrCMMPendingPayment.HasRows)
                            {
                                CMMPendingPaymentBlueSheet cmm_pending_payment = new CMMPendingPaymentBlueSheet();
                                while (rdrCMMPendingPayment.Read())
                                {
                                    drCMMPendingPayment = dtCMMPendingPayment.NewRow();
                                    if (!rdrCMMPendingPayment.IsDBNull(0)) drCMMPendingPayment["INCD"] = rdrCMMPendingPayment.GetString(0);
                                    if (!rdrCMMPendingPayment.IsDBNull(1)) drCMMPendingPayment["회원 이름"] = rdrCMMPendingPayment.GetString(1);
                                    if (!rdrCMMPendingPayment.IsDBNull(2)) drCMMPendingPayment["MED_BILL"] = rdrCMMPendingPayment.GetString(2).Substring(10);
                                    if (!rdrCMMPendingPayment.IsDBNull(3)) drCMMPendingPayment["서비스 날짜"] = rdrCMMPendingPayment.GetDateTime(3).ToString("MM/dd/yyyy");
                                    if (!rdrCMMPendingPayment.IsDBNull(4)) drCMMPendingPayment["의료기관명"] = rdrCMMPendingPayment.GetString(4);
                                    if (!rdrCMMPendingPayment.IsDBNull(5))
                                    {
                                        cmm_pending_payment.BillAmount = (double?)rdrCMMPendingPayment.GetDecimal(5);
                                        drCMMPendingPayment["청구액(원금)"] = cmm_pending_payment.BillAmount.Value.ToString("C");
                                    }

                                    String strSqlQueryForCMMPendingMemberDiscount = "select [dbo].[tbl_settlement].[Amount], [dbo].[tbl_settlement].[SettlementType] " +
                                                                                    "from [dbo].[tbl_settlement] " +
                                                                                    "inner join [dbo].[tbl_medbill] on [dbo].[tbl_settlement].[MedicalBillID] = [dbo].[tbl_medbill].[BillNo] " +
                                                                                    "inner join [dbo].[tbl_incident] on [dbo].[tbl_medbill].[Incident_Id] = [dbo].[tbl_incident].[Incident_id] " +
                                                                                    "inner join [dbo].[tbl_settlement_type_code] " +
                                                                                    "on [dbo].[tbl_settlement].[SettlementType] = [dbo].[tbl_settlement_type_code].[SettlementTypeCode] " +
                                                                                    "where [dbo].[tbl_medbill].[BillNo] = @MedBillNo and " +
                                                                                    "[dbo].[tbl_incident].[IncidentNo] = @IncidentNo and " +
                                                                                    "[dbo].[tbl_settlement_type_code].[SettlementTypeValue] = 'Member Discount' and " +
                                                                                    "[dbo].[tbl_settlement].[PersonalResponsibilityCredit] = 0";

                                    SqlCommand cmdQueryForCMMPendingMemberDiscount = new SqlCommand(strSqlQueryForCMMPendingMemberDiscount, connRN6);
                                    cmdQueryForCMMPendingMemberDiscount.CommandType = CommandType.Text;

                                    cmdQueryForCMMPendingMemberDiscount.Parameters.AddWithValue("@MedBillNo", DistinctMedBillName);
                                    cmdQueryForCMMPendingMemberDiscount.Parameters.AddWithValue("@IncidentNo", IncdName);

                                    Double? MemberDiscount = 0;

                                    if (connRN6.State != ConnectionState.Closed)
                                    {
                                        connRN6.Close();
                                        connRN6.Open();
                                    }
                                    else if (connRN6.State == ConnectionState.Closed) connRN6.Open();
                                    SqlDataReader rdrCMMPendingMemberDiscount = cmdQueryForCMMPendingMemberDiscount.ExecuteReader();
                                    if (rdrCMMPendingMemberDiscount.HasRows)
                                    {
                                        while (rdrCMMPendingMemberDiscount.Read())
                                        {
                                            if (!rdrCMMPendingMemberDiscount.IsDBNull(0)) MemberDiscount += (double?)rdrCMMPendingMemberDiscount.GetDecimal(0);
                                        }
                                    }
                                    rdrCMMPendingMemberDiscount.Close();
                                    if (connRN6.State != ConnectionState.Closed) connRN6.Close();

                                    cmm_pending_payment.MemberDiscount = MemberDiscount.Value;
                                    drCMMPendingPayment["회원할인"] = cmm_pending_payment.MemberDiscount.Value.ToString("C");

                                    String strSqlQueryForCMMPendingCMMDiscount = "select [dbo].[tbl_settlement].[Amount], [dbo].[tbl_settlement].[SettlementType] " +
                                                                                 "from [dbo].[tbl_settlement] " +
                                                                                 "inner join [dbo].[tbl_medbill] on [dbo].[tbl_settlement].[MedicalBillID] = [dbo].[tbl_medbill].[BillNo] " +
                                                                                 "inner join [dbo].[tbl_incident] on [dbo].[tbl_medbill].[Incident_Id] = [dbo].[tbl_incident].[Incident_id] " +
                                                                                 "inner join [dbo].[tbl_settlement_type_code] " +
                                                                                 "on [dbo].[tbl_settlement].[SettlementType] = [dbo].[tbl_settlement_type_code].[SettlementTypeCode] " + "where [dbo].[tbl_medbill].[BillNo] = @MedBillNo and " +
                                                                                 "[dbo].[tbl_incident].[IncidentNo] = @IncidentNo and " +
                                                                                 "[dbo].[tbl_settlement_type_code].[SettlementTypeValue] = 'CMM Discount' and " +
                                                                                 "[dbo].[tbl_settlement].[PersonalResponsibilityCredit] = 0";

                                    SqlCommand cmdQueryForCMMPendingCMMDiscount = new SqlCommand(strSqlQueryForCMMPendingCMMDiscount, connRN6);
                                    cmdQueryForCMMPendingCMMDiscount.CommandType = CommandType.Text;

                                    cmdQueryForCMMPendingCMMDiscount.Parameters.AddWithValue("@MedBillNo", DistinctMedBillName);
                                    cmdQueryForCMMPendingCMMDiscount.Parameters.AddWithValue("@IncidentNo", IncdName);

                                    Double? CMMDiscount = 0;

                                    if (connRN6.State != ConnectionState.Closed)
                                    {
                                        connRN6.Close();
                                        connRN6.Open();
                                    }
                                    else if (connRN6.State == ConnectionState.Closed) connRN6.Open();
                                    SqlDataReader rdrCMMPendingCMMDiscount = cmdQueryForCMMPendingCMMDiscount.ExecuteReader();
                                    if (rdrCMMPendingCMMDiscount.HasRows)
                                    {
                                        while (rdrCMMPendingCMMDiscount.Read())
                                        {
                                            if (!rdrCMMPendingCMMDiscount.IsDBNull(0)) CMMDiscount += (double?)rdrCMMPendingCMMDiscount.GetDecimal(0);
                                        }
                                    }
                                    rdrCMMPendingCMMDiscount.Close();
                                    if (connRN6.State != ConnectionState.Closed) connRN6.Close();

                                    cmm_pending_payment.CMMDiscount = CMMDiscount.Value;
                                    drCMMPendingPayment["CMM 할인"] = cmm_pending_payment.CMMDiscount.Value.ToString("C");

                                    String strSqlQueryForCMMPendingPersonalResponsibility = "select [dbo].[tbl_settlement].[PersonalResponsibilityCredit], [dbo].[tbl_settlement].[SettlementType] " +
                                                                                            "from [dbo].[tbl_settlement] " +
                                                                                            "inner join [dbo].[tbl_medbill] on [dbo].[tbl_settlement].[MedicalBillID] = [dbo].[tbl_medbill].[BillNo] " +
                                                                                            "inner join [dbo].[tbl_incident] on [dbo].[tbl_medbill].[Incident_Id] = [dbo].[tbl_incident].[Incident_id] " +
                                                                                            "inner join [dbo].[tbl_settlement_type_code] " +
                                                                                            "on [dbo].[tbl_settlement].[SettlementType] = [dbo].[tbl_settlement_type_code].[SettlementTypeCode] " +
                                                                                            "where [dbo].[tbl_medbill].[BillNo] = @MedBillNo and " +
                                                                                            "[dbo].[tbl_incident].[IncidentNo] = @IncidentNo and " +
                                                                                            "([dbo].[tbl_settlement_type_code].[SettlementTypeValue] = 'Member Payment' or " +
                                                                                            "[dbo].[tbl_settlement_type_code].[SettlementTypeValue] = '3rd Party Discount' or " +
                                                                                            "[dbo].[tbl_settlement_type_code].[SettlementTypeValue] = 'Member Discount') and " +
                                                                                            "[dbo].[tbl_settlement].[PersonalResponsibilityCredit] > 0";

                                    SqlCommand cmdQueryForCMMPendingPersonalResponsibility = new SqlCommand(strSqlQueryForCMMPendingPersonalResponsibility, connRN6);
                                    cmdQueryForCMMPendingPersonalResponsibility.CommandType = CommandType.Text;

                                    cmdQueryForCMMPendingPersonalResponsibility.Parameters.AddWithValue("@MedBillNo", DistinctMedBillName);
                                    cmdQueryForCMMPendingPersonalResponsibility.Parameters.AddWithValue("@IncidentNo", IncdName);

                                    Double? CMMPendingPersonalResponsibility = 0;

                                    if (connRN6.State != ConnectionState.Closed)
                                    {
                                        connRN6.Close();
                                        connRN6.Open();
                                    }
                                    else if (connRN6.State == ConnectionState.Closed) connRN6.Open();
                                    SqlDataReader rdrCMMPendingPersonalResponsibility = cmdQueryForCMMPendingPersonalResponsibility.ExecuteReader();
                                    if (rdrCMMPendingPersonalResponsibility.HasRows)
                                    {
                                        while (rdrCMMPendingPersonalResponsibility.Read())
                                        {
                                            if (!rdrCMMPendingPersonalResponsibility.IsDBNull(0)) CMMPendingPersonalResponsibility += (double?)rdrCMMPendingPersonalResponsibility.GetDecimal(0);
                                        }
                                    }
                                    rdrCMMPendingPersonalResponsibility.Close();
                                    if (connRN6.State != ConnectionState.Closed) connRN6.Close();

                                    cmm_pending_payment.PersonalResponsibility = CMMPendingPersonalResponsibility.Value;
                                    drCMMPendingPayment["본인 부담금"] = cmm_pending_payment.PersonalResponsibility.Value.ToString("C");

                                    String strSqlQueryForCMMPendingSharedAmount = "select [dbo].[tbl_settlement].[Amount] " +
                                                                                  "from [dbo].[tbl_settlement] " +
                                                                                  "inner join [dbo].[tbl_medbill] on [dbo].[tbl_settlement].[MedicalBillID] = [dbo].[tbl_medbill].[BillNo] " +
                                                                                  "inner join [dbo].[tbl_incident] on [dbo].[tbl_medbill].[Incident_Id] = [dbo].[tbl_incident].[Incident_id] " +
                                                                                  "where [dbo].[tbl_settlement].[Approved] = 1 and " +
                                                                                  "([dbo].[tbl_settlement].[CheckNo] IS NOT NULL or " +
                                                                                  "[dbo].[tbl_settlement].[ACH_Number] IS NOT NULL or " +
                                                                                  "[dbo].[tbl_settlement].[CMMCreditCardPaidDate] IS NOT NULL) and " +
                                                                                  "[dbo].[tbl_medbill].[BillNo] = @MedBillNo and " +
                                                                                  "[dbo].[tbl_incident].[IncidentNo] = @IncidentNo";

                                    SqlCommand cmdQueryForCMMPendingSharedAmount = new SqlCommand(strSqlQueryForCMMPendingSharedAmount, connRN6);
                                    cmdQueryForCMMPendingSharedAmount.CommandType = CommandType.Text;

                                    cmdQueryForCMMPendingSharedAmount.Parameters.AddWithValue("@MedBillNo", DistinctMedBillName);
                                    cmdQueryForCMMPendingSharedAmount.Parameters.AddWithValue("@IncidentNo", IncdName);

                                    Double? SharedAmount = 0;

                                    if (connRN6.State != ConnectionState.Closed)
                                    {
                                        connRN6.Close();
                                        connRN6.Open();
                                    }
                                    else if (connRN6.State == ConnectionState.Closed) connRN6.Open();
                                    SqlDataReader rdrCMMPendingSharedAmount = cmdQueryForCMMPendingSharedAmount.ExecuteReader();
                                    if (rdrCMMPendingSharedAmount.HasRows)
                                    {
                                        while (rdrCMMPendingSharedAmount.Read())
                                        {
                                            if (!rdrCMMPendingSharedAmount.IsDBNull(0)) SharedAmount += (Double?)rdrCMMPendingSharedAmount.GetDecimal(0);
                                        }
                                    }
                                    rdrCMMPendingSharedAmount.Close();
                                    if (connRN6.State != ConnectionState.Closed) connRN6.Close();

                                    cmm_pending_payment.SharedAmount = SharedAmount.Value;
                                    drCMMPendingPayment["정산 완료"] = cmm_pending_payment.SharedAmount.Value.ToString("C");

                                    String strSqlQueryForCMMPendingBalance = "select [dbo].[tbl_settlement].[Amount] " +
                                                                             "from [dbo].[tbl_settlement] " +
                                                                             "inner join [dbo].[tbl_medbill] on [dbo].[tbl_settlement].[MedicalBillID] = [dbo].[tbl_medbill].[BillNo] " +
                                                                             "inner join [dbo].[tbl_incident] on [dbo].[tbl_medbill].[Incident_Id] = [dbo].[tbl_incident].[Incident_id] " +
                                                                             "where [dbo].[tbl_settlement].[Approved] = 1 and " +
                                                                             "([dbo].[tbl_settlement].[CheckNo] IS NULL and " +
                                                                             "[dbo].[tbl_settlement].[ACH_Number] IS NULL and " +
                                                                             "[dbo].[tbl_settlement].[CMMCreditCardPaidDate] IS NULL) and " +
                                                                             "[dbo].[tbl_medbill].[BillNo] = @MedBillNo and " +
                                                                             "[dbo].[tbl_incident].[IncidentNo] = @IncidentNo";

                                    SqlCommand cmdQueryforCMMPendingBalance = new SqlCommand(strSqlQueryForCMMPendingBalance, connRN6);
                                    cmdQueryforCMMPendingBalance.CommandType = CommandType.Text;

                                    cmdQueryforCMMPendingBalance.Parameters.AddWithValue("@MedBillNo", DistinctMedBillName);
                                    cmdQueryforCMMPendingBalance.Parameters.AddWithValue("@IncidentNo", IncdName);

                                    Double? Balance = 0;

                                    if (connRN6.State != ConnectionState.Closed)
                                    {
                                        connRN6.Close();
                                        connRN6.Open();
                                    }
                                    else if (connRN6.State == ConnectionState.Closed) connRN6.Open();
                                    SqlDataReader rdrCMMPendingBalance = cmdQueryforCMMPendingBalance.ExecuteReader();
                                    if (rdrCMMPendingBalance.HasRows)
                                    {
                                        while (rdrCMMPendingBalance.Read())
                                        {
                                            if (!rdrCMMPendingBalance.IsDBNull(0)) Balance += (Double?)rdrCMMPendingBalance.GetDecimal(0);
                                        }
                                    }
                                    rdrCMMPendingBalance.Close();
                                    if (connRN6.State != ConnectionState.Closed) connRN6.Close();

                                    cmm_pending_payment.AmountWillBeShared = Balance.Value;
                                    drCMMPendingPayment["지원 예정"] = cmm_pending_payment.AmountWillBeShared.Value.ToString("C");

                                    lstCMMPendingPayment.Add(cmm_pending_payment);
                                    dtCMMPendingPayment.Rows.Add(drCMMPendingPayment);
                                }
                            }
                            if (connRN7.State != ConnectionState.Closed) connRN7.Close();
                        }
                    }
                    if (connRN5.State != ConnectionState.Closed) connRN5.Close();
                }

                if (bCMMPendingPaymentHasRowBlueSheet)
                {
                    double sumCMMPendingPaymentBillAmount = 0;
                    double sumCMMPendingPaymentMemberDiscount = 0;
                    double sumCMMPendingPaymentCMMDiscount = 0;
                    double sumCMMPendingPaymentPersonalResponisiblity = 0;
                    double sumCMMPendingPaymentSharedAmount = 0;
                    double sumCMMPendingPaymentAmountWillBeShared = 0;

                    foreach (CMMPendingPaymentBlueSheet cmm_payment in lstCMMPendingPayment)
                    {
                        sumCMMPendingPaymentBillAmount += cmm_payment.BillAmount.Value;
                        sumCMMPendingPaymentMemberDiscount += cmm_payment.MemberDiscount.Value;
                        sumCMMPendingPaymentCMMDiscount += cmm_payment.CMMDiscount.Value;
                        sumCMMPendingPaymentPersonalResponisiblity += cmm_payment.PersonalResponsibility.Value;
                        sumCMMPendingPaymentSharedAmount += cmm_payment.SharedAmount.Value;
                        sumCMMPendingPaymentAmountWillBeShared += cmm_payment.AmountWillBeShared.Value;
                    }

                    DataRow drCMMPendingPaymentSum = dtCMMPendingPayment.NewRow();

                    drCMMPendingPaymentSum["의료기관명"] = "합계";
                    drCMMPendingPaymentSum["청구액(원금)"] = sumCMMPendingPaymentBillAmount.ToString("C");
                    drCMMPendingPaymentSum["회원할인"] = sumCMMPendingPaymentMemberDiscount.ToString("C");
                    drCMMPendingPaymentSum["CMM 할인"] = sumCMMPendingPaymentCMMDiscount.ToString("C");
                    drCMMPendingPaymentSum["본인 부담금"] = sumCMMPendingPaymentPersonalResponisiblity.ToString("C");
                    drCMMPendingPaymentSum["정산 완료"] = sumCMMPendingPaymentSharedAmount.ToString("C");
                    drCMMPendingPaymentSum["지원 예정"] = sumCMMPendingPaymentAmountWillBeShared.ToString("C");

                    dtCMMPendingPayment.Rows.Add(drCMMPendingPaymentSum);

                    gvCMMPendingPaymentBlueSheet.DataSource = null;
                    gvCMMPendingPaymentBlueSheet.DataSource = dtCMMPendingPayment;

                    DataTable dtCMMPendingCopy = dtCMMPendingPayment.Copy();
                    gvCMMPendingPaymentInTab.DataSource = null;
                    gvCMMPendingPaymentInTab.DataSource = dtCMMPendingCopy;

                    //if (cmmPendingPaymentSortedFieldBlueSheet.Field != "서비스 날짜")
                    //{
                    cmmPendingPaymentSortedFieldBlueSheet.Field = "서비스 날짜";
                    cmmPendingPaymentSortedFieldBlueSheet.Sorted = EnumSorted.NotSorted;
                    //}
                    SortCMMPendingPaymentTable(cmmPendingPaymentSortedFieldBlueSheet);

                    gvCMMPendingPaymentBlueSheet.Columns["INCD"].Width = 100;
                    gvCMMPendingPaymentBlueSheet.Columns["회원 이름"].Width = 150;
                    gvCMMPendingPaymentBlueSheet.Columns["MED_BILL"].Width = 80;
                    gvCMMPendingPaymentBlueSheet.Columns["서비스 날짜"].Width = 100;
                    gvCMMPendingPaymentBlueSheet.Columns["의료기관명"].Width = 200;
                    gvCMMPendingPaymentBlueSheet.Columns["청구액(원금)"].Width = 100;
                    gvCMMPendingPaymentBlueSheet.Columns["회원할인"].Width = 80;
                    gvCMMPendingPaymentBlueSheet.Columns["CMM 할인"].Width = 100;
                    gvCMMPendingPaymentBlueSheet.Columns["본인 부담금"].Width = 100;
                    gvCMMPendingPaymentBlueSheet.Columns["정산 완료"].Width = 120;
                    gvCMMPendingPaymentBlueSheet.Columns["지원 예정"].Width = 100;

                    gvCMMPendingPaymentBlueSheet.Columns["INCD"].DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleCenter;
                    gvCMMPendingPaymentBlueSheet.Columns["회원 이름"].DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleCenter;
                    gvCMMPendingPaymentBlueSheet.Columns["MED_BILL"].DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleCenter;
                    gvCMMPendingPaymentBlueSheet.Columns["서비스 날짜"].DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleCenter;
                    gvCMMPendingPaymentBlueSheet.Columns["의료기관명"].DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleLeft;
                    gvCMMPendingPaymentBlueSheet.Columns["청구액(원금)"].DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleRight;
                    gvCMMPendingPaymentBlueSheet.Columns["회원할인"].DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleRight;
                    gvCMMPendingPaymentBlueSheet.Columns["CMM 할인"].DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleRight;
                    gvCMMPendingPaymentBlueSheet.Columns["본인 부담금"].DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleRight;
                    gvCMMPendingPaymentBlueSheet.Columns["정산 완료"].DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleRight;
                    gvCMMPendingPaymentBlueSheet.Columns["지원 예정"].DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleRight;

                    foreach (DataGridViewColumn col in gvCMMPendingPaymentBlueSheet.Columns)
                    {
                        col.HeaderCell.Style.Alignment = DataGridViewContentAlignment.MiddleCenter;
                    }


                    gvCMMPendingPaymentBlueSheet.Columns["INCD"].SortMode = DataGridViewColumnSortMode.Programmatic;
                    gvCMMPendingPaymentBlueSheet.Columns["회원 이름"].SortMode = DataGridViewColumnSortMode.Programmatic;
                    gvCMMPendingPaymentBlueSheet.Columns["MED_BILL"].SortMode = DataGridViewColumnSortMode.Programmatic;
                    gvCMMPendingPaymentBlueSheet.Columns["서비스 날짜"].SortMode = DataGridViewColumnSortMode.Programmatic;
                    //gvCMMPendingPayment.Columns["접수 날짜"].SortMode = DataGridViewColumnSortMode.Programmatic;
                    gvCMMPendingPaymentBlueSheet.Columns["의료기관명"].SortMode = DataGridViewColumnSortMode.Programmatic;

                    gvCMMPendingPaymentBlueSheet.Columns["청구액(원금)"].SortMode = DataGridViewColumnSortMode.NotSortable;
                    gvCMMPendingPaymentBlueSheet.Columns["회원할인"].SortMode = DataGridViewColumnSortMode.NotSortable;
                    gvCMMPendingPaymentBlueSheet.Columns["CMM 할인"].SortMode = DataGridViewColumnSortMode.NotSortable;
                    gvCMMPendingPaymentBlueSheet.Columns["본인 부담금"].SortMode = DataGridViewColumnSortMode.NotSortable;
                    gvCMMPendingPaymentBlueSheet.Columns["정산 완료"].SortMode = DataGridViewColumnSortMode.NotSortable;
                    gvCMMPendingPaymentBlueSheet.Columns["지원 예정"].SortMode = DataGridViewColumnSortMode.NotSortable;




                    //if (cmmCMMPendingPaymentInTabSortedFieldBlueSheet.Field != "서비스 날짜")
                    //{
                    cmmCMMPendingPaymentInTabSortedFieldBlueSheet.Field = "서비스 날짜";
                    cmmCMMPendingPaymentInTabSortedFieldBlueSheet.Sorted = EnumSorted.NotSorted;
                    //}
                    SortCMMPendingPaymentTableInTab(cmmCMMPendingPaymentInTabSortedFieldBlueSheet);

                    foreach (DataGridViewColumn col in gvCMMPendingPaymentInTab.Columns)
                    {
                        col.HeaderCell.Style.Alignment = DataGridViewContentAlignment.MiddleCenter;
                    }

                    gvCMMPendingPaymentInTab.Columns["INCD"].SortMode = DataGridViewColumnSortMode.Programmatic;
                    gvCMMPendingPaymentInTab.Columns["회원 이름"].SortMode = DataGridViewColumnSortMode.Programmatic;
                    gvCMMPendingPaymentInTab.Columns["MED_BILL"].SortMode = DataGridViewColumnSortMode.Programmatic;
                    gvCMMPendingPaymentInTab.Columns["서비스 날짜"].SortMode = DataGridViewColumnSortMode.Programmatic;
                    gvCMMPendingPaymentInTab.Columns["의료기관명"].SortMode = DataGridViewColumnSortMode.Programmatic;

                    gvCMMPendingPaymentInTab.Columns["청구액(원금)"].SortMode = DataGridViewColumnSortMode.NotSortable;
                    gvCMMPendingPaymentInTab.Columns["회원할인"].SortMode = DataGridViewColumnSortMode.NotSortable;
                    gvCMMPendingPaymentInTab.Columns["CMM 할인"].SortMode = DataGridViewColumnSortMode.NotSortable;
                    gvCMMPendingPaymentInTab.Columns["본인 부담금"].SortMode = DataGridViewColumnSortMode.NotSortable;
                    gvCMMPendingPaymentInTab.Columns["정산 완료"].SortMode = DataGridViewColumnSortMode.NotSortable;
                    gvCMMPendingPaymentInTab.Columns["지원 예정"].SortMode = DataGridViewColumnSortMode.NotSortable;

                    gvCMMPendingPaymentInTab.Columns["INCD"].Width = 100;
                    gvCMMPendingPaymentInTab.Columns["회원 이름"].Width = 150;
                    gvCMMPendingPaymentInTab.Columns["MED_BILL"].Width = 80;
                    gvCMMPendingPaymentInTab.Columns["서비스 날짜"].Width = 100;
                    gvCMMPendingPaymentInTab.Columns["의료기관명"].Width = 200;
                    gvCMMPendingPaymentInTab.Columns["청구액(원금)"].Width = 100;
                    gvCMMPendingPaymentInTab.Columns["회원할인"].Width = 80;
                    gvCMMPendingPaymentInTab.Columns["CMM 할인"].Width = 100;
                    gvCMMPendingPaymentInTab.Columns["본인 부담금"].Width = 100;
                    gvCMMPendingPaymentInTab.Columns["정산 완료"].Width = 120;
                    gvCMMPendingPaymentInTab.Columns["지원 예정"].Width = 100;

                    gvCMMPendingPaymentInTab.Columns["INCD"].DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleCenter;
                    gvCMMPendingPaymentInTab.Columns["회원 이름"].DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleCenter;
                    gvCMMPendingPaymentInTab.Columns["MED_BILL"].DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleCenter;
                    gvCMMPendingPaymentInTab.Columns["서비스 날짜"].DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleCenter;
                    gvCMMPendingPaymentInTab.Columns["의료기관명"].DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleLeft;
                    gvCMMPendingPaymentInTab.Columns["청구액(원금)"].DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleRight;
                    gvCMMPendingPaymentInTab.Columns["회원할인"].DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleRight;
                    gvCMMPendingPaymentInTab.Columns["CMM 할인"].DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleRight;
                    gvCMMPendingPaymentInTab.Columns["본인 부담금"].DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleRight;
                    gvCMMPendingPaymentInTab.Columns["정산 완료"].DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleRight;
                    gvCMMPendingPaymentInTab.Columns["지원 예정"].DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleRight;
                }

                // The beginning of Pending Status
                DataTable dtPending = new DataTable();
                dtPending.Columns.Add("INCD", typeof(String));
                dtPending.Columns.Add("회원 이름", typeof(String));
                dtPending.Columns.Add("MED_BILL", typeof(String));
                dtPending.Columns.Add("서비스 날짜", typeof(String));
                dtPending.Columns.Add("접수 날짜", typeof(String));
                dtPending.Columns.Add("의료기관명", typeof(String));
                dtPending.Columns.Add("청구액(원금)", typeof(String));
                dtPending.Columns.Add("잔액/보류", typeof(String));
                dtPending.Columns.Add("보류 사유", typeof(String));

                DataRow drPending = null;
                List<PendingBlueSheet> lstPending = new List<PendingBlueSheet>();

                foreach (String IncdName in lstDistinctIncdNamesBlueSheet)
                {
                    String strSqlQueryForPending = "select [RN_DB].[dbo].[tbl_incident].[IncidentNo], [RN_DB].[dbo].[tbl_medbill].[BillNo], [SalesForce].[dbo].[contact].[Name], " +
                                                   "[RN_DB].[dbo].[tbl_medbill].[BillDate], [RN_DB].[dbo].[tbl_medbill].[DueDate], [SalesForce].[dbo].[account].[Name], " +
                                                   "[RN_DB].[dbo].[tbl_medbill].[Balance], [RN_DB].[dbo].[tbl_medbill].[BillAmount], [RN_DB].[dbo].[tbl_pending_reason].[name] " +
                                                   "from [RN_DB].[dbo].[tbl_medbill] " +
                                                   "inner join [RN_DB].[dbo].[tbl_incident] on [RN_DB].[dbo].[tbl_medbill].[Incident_Id] = [RN_DB].[dbo].[tbl_incident].[Incident_id] " +
                                                   "inner join [SalesForce].[dbo].[contact] on [RN_DB].[dbo].[tbl_medbill].[Individual_Id] = [SalesForce].[dbo].[contact].[Individual_ID__c] " +
                                                   "inner join [SalesForce].[dbo].[account] on [RN_DB].[dbo].[tbl_medbill].[MedicalProvider_Id] = [SalesForce].[dbo].[account].[Id] " +
                                                   "inner join [RN_DB].[dbo].[tbl_pending_reason] on [RN_DB].[dbo].[tbl_medbill].[PendingReason] = [RN_DB].[dbo].[tbl_pending_reason].[ID] " +
                                                   "where [RN_DB].[dbo].[tbl_pending_reason].[name] IS NOT NULL and " +
                                                   "[RN_DB].[dbo].[tbl_medbill].[Balance] > 0 and " +
                                                   "[RN_DB].[dbo].[tbl_incident].[IncidentNo] = @IncidentNo " +
                                                   "order by [RN_DB].[dbo].[tbl_medbill].[BillDate]";

                    SqlCommand cmdQueryForPending = new SqlCommand(strSqlQueryForPending, connRN7);
                    cmdQueryForPending.CommandType = CommandType.Text;

                    cmdQueryForPending.Parameters.AddWithValue("@IncidentNo", IncdName);

                    if (connRN7.State != ConnectionState.Closed)
                    {
                        connRN7.Close();
                        connRN7.Open();
                    }
                    else if (connRN7.State == ConnectionState.Closed) connRN7.Open();
                    SqlDataReader rdrPending = cmdQueryForPending.ExecuteReader();
                    if (rdrPending.HasRows)
                    {
                        bPendingHasRowBlueSheet = true;

                        while (rdrPending.Read())
                        {
                            PendingBlueSheet pending_expense = new PendingBlueSheet();

                            drPending = dtPending.NewRow();

                            if (!rdrPending.IsDBNull(0)) drPending["INCD"] = rdrPending.GetString(0);
                            if (!rdrPending.IsDBNull(1)) drPending["MED_BILL"] = rdrPending.GetString(1).Substring(10);
                            if (!rdrPending.IsDBNull(2)) drPending["회원 이름"] = rdrPending.GetString(2);
                            if (!rdrPending.IsDBNull(3)) drPending["서비스 날짜"] = rdrPending.GetDateTime(3).ToString("MM/dd/yyyy");
                            if (!rdrPending.IsDBNull(4)) drPending["접수 날짜"] = rdrPending.GetDateTime(4).ToString("MM/dd/yyyy");
                            if (!rdrPending.IsDBNull(5)) drPending["의료기관명"] = rdrPending.GetString(5);
                            if (!rdrPending.IsDBNull(6))
                            {
                                pending_expense.Balance = (double?)rdrPending.GetDecimal(6);
                                drPending["잔액/보류"] = pending_expense.Balance.Value.ToString("C");
                            }
                            if (!rdrPending.IsDBNull(7))
                            {
                                pending_expense.BillAmount = (double?)rdrPending.GetDecimal(7);
                                drPending["청구액(원금)"] = pending_expense.BillAmount.Value.ToString("C");
                            }
                            if (!rdrPending.IsDBNull(8)) drPending["보류 사유"] = rdrPending.GetString(8);

                            dtPending.Rows.Add(drPending);
                            lstPending.Add(pending_expense);
                        }
                    }
                    rdrPending.Close();
                    if (connRN7.State != ConnectionState.Closed) connRN7.Close();
                }
                if (bPendingHasRowBlueSheet)
                {
                    double sumPendingBillAmount = 0;
                    double sumPendingBalance = 0;

                    foreach (PendingBlueSheet cmm_pending in lstPending)
                    {
                        sumPendingBillAmount += cmm_pending.BillAmount.Value;
                        sumPendingBalance += cmm_pending.Balance.Value;
                    }

                    DataRow drPendingSum = dtPending.NewRow();

                    drPendingSum["의료기관명"] = "합계";
                    drPendingSum["청구액(원금)"] = sumPendingBillAmount.ToString("C");
                    drPendingSum["잔액/보류"] = sumPendingBalance.ToString("C");

                    dtPending.Rows.Add(drPendingSum);

                    gvPendingBlueSheet.DataSource = null;
                    gvPendingBlueSheet.DataSource = dtPending;

                    DataTable dtPendingInTab = dtPending.Copy();

                    gvPendingInTab.DataSource = null;
                    gvPendingInTab.DataSource = dtPendingInTab;

                    //if (pendingSortedFieldBlueSheet.Field != "서비스 날짜")
                    //{
                    pendingSortedFieldBlueSheet.Field = "서비스 날짜";
                    pendingSortedFieldBlueSheet.Sorted = EnumSorted.NotSorted;
                    //}
                    SortPendingTable(pendingSortedFieldBlueSheet);

                    foreach (DataGridViewColumn col in gvPendingBlueSheet.Columns)
                    {
                        col.HeaderCell.Style.Alignment = DataGridViewContentAlignment.MiddleCenter;
                    }

                    gvPendingBlueSheet.Columns["INCD"].SortMode = DataGridViewColumnSortMode.Programmatic;
                    gvPendingBlueSheet.Columns["회원 이름"].SortMode = DataGridViewColumnSortMode.Programmatic;
                    gvPendingBlueSheet.Columns["MED_BILL"].SortMode = DataGridViewColumnSortMode.Programmatic;
                    gvPendingBlueSheet.Columns["서비스 날짜"].SortMode = DataGridViewColumnSortMode.Programmatic;
                    gvPendingBlueSheet.Columns["접수 날짜"].SortMode = DataGridViewColumnSortMode.Programmatic;
                    gvPendingBlueSheet.Columns["의료기관명"].SortMode = DataGridViewColumnSortMode.Programmatic;
                    gvPendingBlueSheet.Columns["보류 사유"].SortMode = DataGridViewColumnSortMode.Programmatic;

                    gvPendingBlueSheet.Columns["청구액(원금)"].SortMode = DataGridViewColumnSortMode.NotSortable;
                    gvPendingBlueSheet.Columns["잔액/보류"].SortMode = DataGridViewColumnSortMode.NotSortable;



                    //if (pendingInTabSortedFieldBlueSheet.Field != "서비스 날짜")
                    //{
                    pendingInTabSortedFieldBlueSheet.Field = "서비스 날짜";
                    pendingInTabSortedFieldBlueSheet.Sorted = EnumSorted.NotSorted;
                    //}
                    SortPendingTableInTab(pendingInTabSortedFieldBlueSheet);

                    foreach (DataGridViewColumn col in gvPendingInTab.Columns)
                    {
                        col.HeaderCell.Style.Alignment = DataGridViewContentAlignment.MiddleCenter;
                    }

                    gvPendingInTab.Columns["INCD"].SortMode = DataGridViewColumnSortMode.Programmatic;
                    gvPendingInTab.Columns["회원 이름"].SortMode = DataGridViewColumnSortMode.Programmatic;
                    gvPendingInTab.Columns["MED_BILL"].SortMode = DataGridViewColumnSortMode.Programmatic;
                    gvPendingInTab.Columns["서비스 날짜"].SortMode = DataGridViewColumnSortMode.Programmatic;
                    gvPendingInTab.Columns["접수 날짜"].SortMode = DataGridViewColumnSortMode.Programmatic;
                    gvPendingInTab.Columns["의료기관명"].SortMode = DataGridViewColumnSortMode.Programmatic;
                    gvPendingInTab.Columns["보류 사유"].SortMode = DataGridViewColumnSortMode.Programmatic;

                    gvPendingInTab.Columns["청구액(원금)"].SortMode = DataGridViewColumnSortMode.NotSortable;
                    gvPendingInTab.Columns["잔액/보류"].SortMode = DataGridViewColumnSortMode.NotSortable;

                    gvPendingBlueSheet.Columns["INCD"].DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleCenter;
                    gvPendingBlueSheet.Columns["회원 이름"].DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleCenter;
                    gvPendingBlueSheet.Columns["MED_BILL"].DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleCenter;
                    gvPendingBlueSheet.Columns["서비스 날짜"].DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleCenter;
                    gvPendingBlueSheet.Columns["접수 날짜"].DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleCenter;
                    gvPendingBlueSheet.Columns["의료기관명"].DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleLeft;
                    gvPendingBlueSheet.Columns["청구액(원금)"].DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleRight;
                    gvPendingBlueSheet.Columns["잔액/보류"].DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleRight;
                    gvPendingBlueSheet.Columns["보류 사유"].DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleLeft;

                    gvPendingBlueSheet.Columns["INCD"].Width = 100;
                    gvPendingBlueSheet.Columns["회원 이름"].Width = 150;
                    gvPendingBlueSheet.Columns["MED_BILL"].Width = 80;
                    gvPendingBlueSheet.Columns["서비스 날짜"].Width = 100;
                    gvPendingBlueSheet.Columns["접수 날짜"].Width = 100;
                    gvPendingBlueSheet.Columns["의료기관명"].Width = 200;
                    gvPendingBlueSheet.Columns["청구액(원금)"].Width = 100;
                    gvPendingBlueSheet.Columns["잔액/보류"].Width = 80;
                    gvPendingBlueSheet.Columns["보류 사유"].Width = 520;

                    gvPendingInTab.Columns["INCD"].DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleCenter;
                    gvPendingInTab.Columns["회원 이름"].DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleCenter;
                    gvPendingInTab.Columns["MED_BILL"].DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleCenter;
                    gvPendingInTab.Columns["서비스 날짜"].DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleCenter;
                    gvPendingInTab.Columns["접수 날짜"].DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleCenter;
                    gvPendingInTab.Columns["의료기관명"].DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleLeft;

                    gvPendingInTab.Columns["청구액(원금)"].DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleRight;
                    gvPendingInTab.Columns["잔액/보류"].DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleRight;
                    gvPendingInTab.Columns["보류 사유"].DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleLeft;
                }

                DataTable dtMedicalBillIneligible = new DataTable();
                dtMedicalBillIneligible.Columns.Add("INCD", typeof(String));
                dtMedicalBillIneligible.Columns.Add("회원 이름", typeof(String));
                dtMedicalBillIneligible.Columns.Add("MED_BILL", typeof(String));
                dtMedicalBillIneligible.Columns.Add("서비스 날짜", typeof(String));
                dtMedicalBillIneligible.Columns.Add("접수 날짜", typeof(String));
                dtMedicalBillIneligible.Columns.Add("의료기관명", typeof(String));
                dtMedicalBillIneligible.Columns.Add("청구액(원금)", typeof(String));
                dtMedicalBillIneligible.Columns.Add("전액/일부 지원불가 금액", typeof(String));
                dtMedicalBillIneligible.Columns.Add("지원되지않는 사유", typeof(String));

                DataRow drIneligible = null;

                List<MedicalExpenseIneligibleBlueSheet> lstMedicalBillIneligible = new List<MedicalExpenseIneligibleBlueSheet>();

                foreach (String IncdName in lstDistinctIncdNamesBlueSheet)
                {

                    String strSqlMedBillIneligible = "select [RN_DB].[dbo].[tbl_incident].[IncidentNo], [RN_DB].[dbo].[tbl_medbill].[BillNo], [SalesForce].[dbo].[contact].[Name], " +
                                                     "[RN_DB].[dbo].[tbl_medbill].[BillDate], [RN_DB].[dbo].[tbl_medbill].[DueDate], [RN_DB].[dbo].[tbl_medbill].[BillAmount], " +
                                                     "[SalesForce].[dbo].[account].[Name], [RN_DB].[dbo].[tbl_ineligible_reason].[name] " +
                                                     "from [RN_DB].[dbo].[tbl_medbill] " +
                                                     "inner join [RN_DB].[dbo].[tbl_incident] on [RN_DB].[dbo].[tbl_medbill].[Incident_Id] = [RN_DB].[dbo].[tbl_incident].[Incident_id] " +
                                                     "inner join [SalesForce].[dbo].[contact] on [RN_DB].[dbo].[tbl_medbill].[Individual_Id] = [SalesForce].[dbo].[contact].[Individual_ID__c] " +
                                                     "inner join [SalesForce].[dbo].[account] on [RN_DB].[dbo].[tbl_medbill].[MedicalProvider_Id] = [SalesForce].[dbo].[account].[Id] " +
                                                     "inner join [RN_DB].[dbo].[tbl_ineligible_reason] on [RN_DB].[dbo].[tbl_medbill].[IneligibleReason] = [RN_DB].[dbo].[tbl_ineligible_reason].[id] " +
                                                     "inner join [RN_DB].[dbo].[tbl_medbill_status_code] on [RN_DB].[dbo].[tbl_medbill].[BillStatus] = [RN_DB].[dbo].[tbl_medbill_status_code].[BillStatusCode] " +
                                                     "where [RN_DB].[dbo].[tbl_medbill_status_code].[BillStatusValue] = 'Ineligible' and " +
                                                     "[RN_DB].[dbo].[tbl_ineligible_reason].[name] IS NOT NULL and " +
                                                     "[RN_DB].[dbo].[tbl_incident].[IncidentNo] = @IncidentNo";
                                                     

                    SqlCommand cmdQueryForMedBillIneligible = new SqlCommand(strSqlMedBillIneligible, connRN7);
                    cmdQueryForMedBillIneligible.CommandType = CommandType.Text;

                    cmdQueryForMedBillIneligible.Parameters.AddWithValue("@IncidentNo", IncdName);

                    if (connRN7.State != ConnectionState.Closed)
                    {
                        connRN7.Close();
                        connRN7.Open();
                    }
                    else if (connRN7.State == ConnectionState.Closed) connRN7.Open();
                    SqlDataReader rdrMedBillIneligible = cmdQueryForMedBillIneligible.ExecuteReader();
                    if (rdrMedBillIneligible.HasRows)
                    {
                        bIneligibleHasRowBlueSheet = true;
                        while (rdrMedBillIneligible.Read())
                        {
                            MedicalExpenseIneligibleBlueSheet expenseIneligible = new MedicalExpenseIneligibleBlueSheet();
                            drIneligible = dtMedicalBillIneligible.NewRow();

                            if (!rdrMedBillIneligible.IsDBNull(0)) drIneligible["INCD"] = rdrMedBillIneligible.GetString(0);
                            if (!rdrMedBillIneligible.IsDBNull(1)) drIneligible["MED_BILL"] = rdrMedBillIneligible.GetString(1).Substring(10);
                            if (!rdrMedBillIneligible.IsDBNull(2)) drIneligible["회원 이름"] = rdrMedBillIneligible.GetString(2);
                            if (!rdrMedBillIneligible.IsDBNull(3)) drIneligible["서비스 날짜"] = rdrMedBillIneligible.GetDateTime(3).ToString("MM/dd/yyyy");
                            if (!rdrMedBillIneligible.IsDBNull(4)) drIneligible["접수 날짜"] = rdrMedBillIneligible.GetDateTime(4).ToString("MM/dd/yyyy");
                            if (!rdrMedBillIneligible.IsDBNull(5))
                            {
                                expenseIneligible.BillAmount = (double?)rdrMedBillIneligible.GetDecimal(5);
                                drIneligible["청구액(원금)"] = expenseIneligible.BillAmount.Value.ToString("C");
                                expenseIneligible.AmountIneligible = (double?)rdrMedBillIneligible.GetDecimal(5);
                                drIneligible["전액/일부 지원불가 금액"] = expenseIneligible.AmountIneligible.Value.ToString("C");

                            }
                            if (!rdrMedBillIneligible.IsDBNull(6)) drIneligible["의료기관명"] = rdrMedBillIneligible.GetString(6);
                            if (!rdrMedBillIneligible.IsDBNull(7)) drIneligible["지원되지않는 사유"] = rdrMedBillIneligible.GetString(7);

                            lstMedicalBillIneligible.Add(expenseIneligible);
                            dtMedicalBillIneligible.Rows.Add(drIneligible);
                        }
                    }
                    rdrMedBillIneligible.Close();
                    if (connRN7.State != ConnectionState.Closed) connRN7.Close();
                }

                foreach (String IncdName in lstDistinctIncdNamesBlueSheet)
                {
                    String strSqlQueryForMedBillPartiallyIneligible = "select [dbo].[tbl_medbill].[BillNo] from [dbo].[tbl_medbill] " +
                                                                      "inner join [dbo].[tbl_incident] on [dbo].[tbl_medbill].[Incident_Id] = [dbo].[tbl_incident].[Incident_id] " +
                                                                      "inner join [dbo].[tbl_medbill_status_code] on [dbo].[tbl_medbill].[BillStatus] = [dbo].[tbl_medbill_status_code].[BillStatusCode] " +
                                                                      "inner join [dbo].[tbl_ineligible_reason] on [dbo].[tbl_medbill].[IneligibleReason] = [dbo].[tbl_ineligible_reason].[id] " +
                                                                      "where [dbo].[tbl_medbill_status_code].[BillStatusValue] = 'Partially Ineligible' and " +
                                                                      "[dbo].[tbl_ineligible_reason].[name] IS NOT NULL and " +
                                                                      "[dbo].[tbl_incident].[IncidentNo] = @IncidentNo";

                    SqlCommand cmdQueryForMedBillPartiallyIneligible = new SqlCommand(strSqlQueryForMedBillPartiallyIneligible, connRN7);
                    cmdQueryForMedBillPartiallyIneligible.CommandType = CommandType.Text;

                    cmdQueryForMedBillPartiallyIneligible.Parameters.AddWithValue("@IncidentNo", IncdName);

                    if (connRN7.State != ConnectionState.Closed)
                    {
                        connRN7.Close();
                        connRN7.Open();
                    }
                    else if (connRN7.State == ConnectionState.Closed) connRN7.Open();
                    SqlDataReader rdrMedBillPartiallyIneligible = cmdQueryForMedBillPartiallyIneligible.ExecuteReader();
                    if (rdrMedBillPartiallyIneligible.HasRows)
                    {
                        bIneligibleHasRowBlueSheet = true;
                        List<String> lstMedicalBillNames = new List<string>();
                        List<String> lstDistinctMedicalBillNames = new List<string>();

                        while (rdrMedBillPartiallyIneligible.Read())
                        {
                            if (!rdrMedBillPartiallyIneligible.IsDBNull(0)) lstMedicalBillNames.Add(rdrMedBillPartiallyIneligible.GetString(0));
                        }
                        foreach (String MedicalBillName in lstMedicalBillNames.Distinct())
                        {
                            lstDistinctMedicalBillNames.Add(MedicalBillName);
                        }

                        if (lstDistinctMedicalBillNames.Count > 0)
                        {
                            List<MedicalExpensePartiallyIneligibleBlueSheet> lstMedBillPartiallyIneligible = new List<MedicalExpensePartiallyIneligibleBlueSheet>();

                            foreach (String strMedBillName in lstDistinctMedicalBillNames)
                            {

                                String strSqlQueryForPartiallyIneligible = "select [RN_DB].[dbo].[tbl_incident].[IncidentNo], [RN_DB].[dbo].[tbl_medbill].[BillNo], " +
                                                                           "[SalesForce].[dbo].[contact].[Name], [RN_DB].[dbo].[tbl_medbill].[BillDate], [RN_DB].[dbo].[tbl_medbill].[DueDate], " +
                                                                           "[SalesForce].[dbo].[account].[Name], [RN_DB].[dbo].[tbl_medbill].[BillAmount], " +
                                                                           "[RN_DB].[dbo].[tbl_settlement].[Amount], " +
                                                                           "[RN_DB].[dbo].[tbl_medbill_status_code].[BillStatusValue], [RN_DB].[dbo].[tbl_ineligible_reason].[name] " +
                                                                           "from [RN_DB].[dbo].[tbl_medbill] " +
                                                                           "inner join [RN_DB].[dbo].[tbl_incident] on [RN_DB].[dbo].[tbl_medbill].[Incident_Id] = [RN_DB].[dbo].[tbl_incident].[Incident_id] " +
                                                                           "inner join [SalesForce].[dbo].[contact] on [RN_DB].[dbo].[tbl_medbill].[Individual_Id] = [SalesForce].[dbo].[contact].[Individual_ID__c] " +
                                                                           "inner join [SalesForce].[dbo].[account] on [RN_DB].[dbo].[tbl_medbill].[MedicalProvider_Id] = [SalesForce].[dbo].[account].[Id] " +
                                                                           "inner join [RN_DB].[dbo].[tbl_settlement] on [RN_DB].[dbo].[tbl_medbill].[BillNo] = [RN_DB].[dbo].[tbl_settlement].[MedicalBillID] " +
                                                                           "inner join [RN_DB].[dbo].[tbl_settlement_type_code] on [RN_DB].[dbo].[tbl_settlement].[SettlementType] = [RN_DB].[dbo].[tbl_settlement_type_code].[SettlementTypeCode] " +
                                                                           "inner join [RN_DB].[dbo].[tbl_medbill_status_code] on [RN_DB].[dbo].[tbl_medbill].[BillStatus] = [RN_DB].[dbo].[tbl_medbill_status_code].[BillStatusCode] " +
                                                                           "inner join [RN_DB].[dbo].[tbl_ineligible_reason] on [RN_DB].[dbo].[tbl_medbill].[IneligibleReason] = [RN_DB].[dbo].[tbl_ineligible_reason].[id] " +
                                                                           "where [RN_DB].[dbo].[tbl_medbill_status_code].[BillStatusValue] = 'Partially Ineligible' and " +
                                                                           "[RN_DB].[dbo].[tbl_settlement_type_code].[SettlementTypeValue] = 'Ineligible' and " +
                                                                           "[RN_DB].[dbo].[tbl_ineligible_reason].[name] IS NOT NULL and " +
                                                                           "[RN_DB].[dbo].[tbl_medbill].[BillNo] = @MedBillNo";

                                SqlCommand cmdQueryForPartiallyIneligible = new SqlCommand(strSqlQueryForPartiallyIneligible, connRN6);
                                cmdQueryForPartiallyIneligible.CommandType = CommandType.Text;

                                cmdQueryForPartiallyIneligible.Parameters.AddWithValue("@MedBillNo", strMedBillName);

                                if (connRN6.State != ConnectionState.Closed)
                                {
                                    connRN6.Close();
                                    connRN6.Open();
                                }
                                else if (connRN6.State == ConnectionState.Closed) connRN6.Open();
                                SqlDataReader rdrPartiallyIneligible = cmdQueryForPartiallyIneligible.ExecuteReader();
                                if (rdrPartiallyIneligible.HasRows)
                                {
                                    bIneligibleHasRowBlueSheet = true;

                                    MedicalExpensePartiallyIneligibleBlueSheet medbill = new MedicalExpensePartiallyIneligibleBlueSheet();
                                    MedicalExpenseIneligibleBlueSheet expenseIneligible = new MedicalExpenseIneligibleBlueSheet();

                                    while (rdrPartiallyIneligible.Read())
                                    {
                                        if (!rdrPartiallyIneligible.IsDBNull(0)) medbill.INCD = rdrPartiallyIneligible.GetString(0).Substring(5);
                                        if (!rdrPartiallyIneligible.IsDBNull(1)) medbill.MedBill = rdrPartiallyIneligible.GetString(1).Substring(10);
                                        if (!rdrPartiallyIneligible.IsDBNull(2)) medbill.PatientName = rdrPartiallyIneligible.GetString(2);
                                        if (!rdrPartiallyIneligible.IsDBNull(3)) medbill.ServiceDate = rdrPartiallyIneligible.GetDateTime(3);
                                        else medbill.ServiceDate = null;
                                        if (!rdrPartiallyIneligible.IsDBNull(4)) medbill.ReceiveDate = rdrPartiallyIneligible.GetDateTime(4);
                                        else medbill.ReceiveDate = null;
                                        if (!rdrPartiallyIneligible.IsDBNull(5)) medbill.MedicalProvider = rdrPartiallyIneligible.GetString(5);
                                        else medbill.MedicalProvider = String.Empty;
                                        if (!rdrPartiallyIneligible.IsDBNull(6))
                                        {
                                            expenseIneligible.BillAmount = (double?)rdrPartiallyIneligible.GetDecimal(6);
                                            medbill.BillAmount = (double?)rdrPartiallyIneligible.GetDecimal(6);
                                        }
                                        else
                                        {
                                            expenseIneligible.BillAmount = 0;
                                            medbill.BillAmount = 0;
                                        }
                                        if (!rdrPartiallyIneligible.IsDBNull(7))
                                        {
                                            medbill.IneligibleAmount = (double?)rdrPartiallyIneligible.GetDecimal(7);
                                            expenseIneligible.AmountIneligible = (double?)rdrPartiallyIneligible.GetDecimal(7);
                                        }
                                        else
                                        {
                                            medbill.IneligibleAmount = 0;
                                            expenseIneligible.AmountIneligible = 0;
                                        }
                                        if (!rdrPartiallyIneligible.IsDBNull(9)) medbill.IneligibleReason = rdrPartiallyIneligible.GetString(9);

                                        lstMedicalBillIneligible.Add(expenseIneligible);
                                        lstMedBillPartiallyIneligible.Add(medbill);
                                    }
                                }
                                rdrPartiallyIneligible.Close();
                                if (connRN6.State != ConnectionState.Closed) connRN6.Close();

                                if (lstMedBillPartiallyIneligible.Count > 0)
                                {
                                    drIneligible = dtMedicalBillIneligible.NewRow();
                                    drIneligible["INCD"] = lstMedBillPartiallyIneligible[0].INCD;
                                    drIneligible["회원 이름"] = lstMedBillPartiallyIneligible[0].PatientName;
                                    //drIneligible["MED_BILL"] = lstMedBillPartiallyIneligible[0].MedBill.Substring(10);
                                    drIneligible["MED_BILL"] = lstMedBillPartiallyIneligible[0].MedBill;
                                    if (lstMedBillPartiallyIneligible[0].ServiceDate != null) drIneligible["서비스 날짜"] = lstMedBillPartiallyIneligible[0].ServiceDate.Value.ToString("MM/dd/yyyy");
                                    if (lstMedBillPartiallyIneligible[0].ReceiveDate != null) drIneligible["접수 날짜"] = lstMedBillPartiallyIneligible[0].ReceiveDate.Value.ToString("MM/dd/yyyy");
                                    drIneligible["의료기관명"] = lstMedBillPartiallyIneligible[0].MedicalProvider;
                                    drIneligible["청구액(원금)"] = lstMedBillPartiallyIneligible[0].BillAmount.Value.ToString("C");

                                    Double? IneligibleAmount = 0;
                                    for (int i = 0; i < lstMedBillPartiallyIneligible.Count; i++)
                                    {
                                        IneligibleAmount += lstMedBillPartiallyIneligible[i].IneligibleAmount;
                                    }
                                    drIneligible["전액/일부 지원불가 금액"] = IneligibleAmount.Value.ToString("C");
                                    drIneligible["지원되지않는 사유"] = lstMedBillPartiallyIneligible[0].IneligibleReason;

                                    dtMedicalBillIneligible.Rows.Add(drIneligible);
                                }
                            }
                        }
                    }
                    rdrMedBillPartiallyIneligible.Close();
                    if (connRN7.State != ConnectionState.Closed) connRN7.Close();
                }

                foreach (string IncdName in lstDistinctIncdNamesBlueSheet)
                {
                    String strSqlMedBillClosed = "select [dbo].[tbl_medbill].[BillNo] from [dbo].[tbl_medbill] " +
                                                 "inner join [dbo].[tbl_settlement] on [dbo].[tbl_medbill].[BillNo] = [dbo].[tbl_settlement].[MedicalBillID] " +
                                                 "inner join [dbo].[tbl_medbill_status_code] on [dbo].[tbl_medbill].[BillStatus] = [dbo].[tbl_medbill_status_code].[BillStatusCode] " +
                                                 "inner join [dbo].[tbl_incident] on [dbo].[tbl_medbill].[incident_id] = [dbo].[tbl_incident].[Incident_id] " +
                                                 "where [dbo].[tbl_medbill_status_code].[BillStatusValue] = 'Closed' and " + // or [dbo].[tbl_medbill_status_code].[BillStatusValue] = 'Partially Ineligible') and " +
                                                 "([dbo].[tbl_settlement].[CheckNo] = @CheckNo or " +
                                                 "[dbo].[tbl_settlement].[ACH_Number] = @ACH_No or " +
                                                 "[dbo].[tbl_settlement].[CMMCreditCardPaidDate] >= @CreditCardPaymentDate) and " +
                                                 "[dbo].[tbl_incident].[IncidentNo] = @IncidentNo";

                    SqlCommand cmdMedBillClosed = new SqlCommand(strSqlMedBillClosed, connRN7);
                    cmdMedBillClosed.CommandType = CommandType.Text;

                    cmdMedBillClosed.Parameters.AddWithValue("@CheckNo", txtCheckNoBlueSheet.Text.Trim());
                    cmdMedBillClosed.Parameters.AddWithValue("@ACH_No", txtACHNoBlueSheet.Text.Trim());
                    cmdMedBillClosed.Parameters.AddWithValue("@CreditCardPaymentDate", dtpCreditCardPaymentDateBlueSheet.Value.ToString("MM/dd/yyyy"));
                    cmdMedBillClosed.Parameters.AddWithValue("@IncidentNo", IncdName);

                    if (connRN7.State != ConnectionState.Closed)
                    {
                        connRN7.Open();
                        connRN7.Close();
                    }
                    else if (connRN7.State == ConnectionState.Closed) connRN7.Open();
                    SqlDataReader rdrMedBillClosed = cmdMedBillClosed.ExecuteReader();
                    if (rdrMedBillClosed.HasRows)
                    {
                        List<String> lstMedicalBillNames = new List<string>();
                        while (rdrMedBillClosed.Read())
                        {
                            if (!rdrMedBillClosed.IsDBNull(0)) lstMedicalBillNames.Add(rdrMedBillClosed.GetString(0));
                        }

                        List<String> lstDistinctMedicalBillNames = new List<string>();

                        foreach (String MedicalBillName in lstMedicalBillNames.Distinct())
                        {
                            lstDistinctMedicalBillNames.Add(MedicalBillName);
                        }

                        if (lstDistinctMedicalBillNames.Count > 0)
                        {
                            foreach (String strMedBillName in lstDistinctMedicalBillNames)
                            {
                                String strSqlMedBillClosedIneligible = "select [RN_DB].[dbo].[tbl_incident].[IncidentNo], [RN_DB].[dbo].[tbl_medbill].[BillNo], " +
                                                                       "[SalesForce].[dbo].[contact].[Name], [RN_DB].[dbo].[tbl_medbill].[BillDate], [RN_DB].[dbo].[tbl_medbill].[DueDate], " +
                                                                       "[SalesForce].[dbo].[account].[Name], [RN_DB].[dbo].[tbl_medbill].[BillAmount], [RN_DB].[dbo].[tbl_settlement].[Amount], " +
                                                                       "[RN_DB].[dbo].[tbl_medbill_status_code].[BillStatusValue], [RN_DB].[dbo].[tbl_settlement_type_code].[SettlementTypeValue], " +
                                                                       "[RN_DB].[dbo].[tbl_ineligible_reason].[name] " +
                                                                       "from [RN_DB].[dbo].[tbl_medbill] " +
                                                                       "inner join [RN_DB].[dbo].[tbl_medbill_status_code] on [RN_DB].[dbo].[tbl_medbill].[BillStatus] = [RN_DB].[dbo].[tbl_medbill_status_code].[BillStatusCode] " +   // this line may get deleted
                                                                       "inner join [RN_DB].[dbo].[tbl_incident] on [RN_DB].[dbo].[tbl_medbill].[Incident_Id] = [RN_DB].[dbo].[tbl_incident].[Incident_id] " +
                                                                       "inner join [RN_DB].[dbo].[tbl_settlement] on [RN_DB].[dbo].[tbl_medbill].[BillNo] = [RN_DB].[dbo].[tbl_settlement].[MedicalBillID] " +
                                                                       "inner join [RN_DB].[dbo].[tbl_settlement_type_code] on [RN_DB].[dbo].[tbl_settlement].[SettlementType] = [RN_DB].[dbo].[tbl_settlement_type_code].[SettlementTypeCode] " +
                                                                       "inner join [RN_DB].[dbo].[tbl_ineligible_reason] on [RN_DB].[dbo].[tbl_medbill].[IneligibleReason] = [RN_DB].[dbo].[tbl_ineligible_reason].[id] " +
                                                                       "inner join [SalesForce].[dbo].[contact] on [RN_DB].[dbo].[tbl_medbill].[Individual_Id] = [SalesForce].[dbo].[contact].[Individual_ID__c] " +
                                                                       "inner join [SalesForce].[dbo].[account] on [RN_DB].[dbo].[tbl_medbill].[MedicalProvider_Id] = [SalesForce].[dbo].[account].[Id] " +
                                                                       "where ([RN_DB].[dbo].[tbl_medbill_status_code].[BillStatusValue] = 'Closed' or " +
                                                                       "[RN_DB].[dbo].[tbl_medbill_status_code].[BillStatusValue] = 'Partially Ineligible') and " +
                                                                       "[RN_DB].[dbo].[tbl_settlement_type_code].[SettlementTypeValue] = 'Ineligible' and " +
                                                                       "[RN_DB].[dbo].[tbl_ineligible_reason].[name] IS NOT NULL and " +
                                                                       "[RN_DB].[dbo].[tbl_medbill].[BillNo] = @MedBillNo";

                                SqlCommand cmdQueryForMedBillClosedIneligible = new SqlCommand(strSqlMedBillClosedIneligible, connRN6);
                                cmdQueryForMedBillClosedIneligible.CommandType = CommandType.Text;

                                cmdQueryForMedBillClosedIneligible.Parameters.AddWithValue("@MedBillNo", strMedBillName);

                                if (connRN6.State != ConnectionState.Closed)
                                {
                                    connRN6.Close();
                                    connRN6.Open();
                                }
                                else if (connRN6.State == ConnectionState.Closed) connRN6.Open();
                                SqlDataReader rdrMedBillClosedIneligible = cmdQueryForMedBillClosedIneligible.ExecuteReader();
                                if (rdrMedBillClosedIneligible.HasRows)
                                {
                                    bIneligibleHasRowBlueSheet = true;
                                    while (rdrMedBillClosedIneligible.Read())
                                    {
                                        MedicalExpenseIneligibleBlueSheet expenseIneligible = new MedicalExpenseIneligibleBlueSheet();

                                        drIneligible = dtMedicalBillIneligible.NewRow();

                                        if (!rdrMedBillClosedIneligible.IsDBNull(0)) drIneligible["INCD"] = rdrMedBillClosedIneligible.GetString(0).Substring(5);
                                        if (!rdrMedBillClosedIneligible.IsDBNull(1)) drIneligible["MED_BILL"] = rdrMedBillClosedIneligible.GetString(1).Substring(10);
                                        if (!rdrMedBillClosedIneligible.IsDBNull(2)) drIneligible["회원 이름"] = rdrMedBillClosedIneligible.GetString(2);
                                        if (!rdrMedBillClosedIneligible.IsDBNull(3)) drIneligible["서비스 날짜"] = rdrMedBillClosedIneligible.GetDateTime(3);
                                        if (!rdrMedBillClosedIneligible.IsDBNull(4)) drIneligible["접수 날짜"] = rdrMedBillClosedIneligible.GetDateTime(4);
                                        if (!rdrMedBillClosedIneligible.IsDBNull(5)) drIneligible["의료기관명"] = rdrMedBillClosedIneligible.GetString(5);
                                        if (!rdrMedBillClosedIneligible.IsDBNull(6))
                                        {
                                            expenseIneligible.BillAmount = (double?)rdrMedBillClosedIneligible.GetDecimal(6);
                                            drIneligible["청구액(원금)"] = expenseIneligible.BillAmount.Value.ToString("C");
                                        }
                                        if (!rdrMedBillClosedIneligible.IsDBNull(7))
                                        {
                                            expenseIneligible.AmountIneligible = (double?)rdrMedBillClosedIneligible.GetDecimal(7);
                                            drIneligible["전액/일부 지원불가 금액"] = expenseIneligible.AmountIneligible.Value.ToString("C");
                                        }
                                        if (!rdrMedBillClosedIneligible.IsDBNull(10)) drIneligible["지원되지않는 사유"] = rdrMedBillClosedIneligible.GetString(10);

                                        lstMedicalBillIneligible.Add(expenseIneligible);
                                        dtMedicalBillIneligible.Rows.Add(drIneligible);
                                    }
                                }
                                if (connRN6.State != ConnectionState.Closed) connRN6.Close();
                            }
                        }
                    }
                    rdrMedBillClosed.Close();
                    if (connRN7.State != ConnectionState.Closed) connRN7.Close();

                }

                // Sort Ineligible medical bill
                //DataView dvIneligible = dtMedicalBillIneligible.DefaultView;
                //dvIneligible.Sort = "[서비스 날짜] DESC";
                //DataTable dtIneligible = dvIneligible.ToTable();

                //if (ineligibleSortedFieldBlueSheet.Field != "서비스 날짜")
                //{


                if (bIneligibleHasRowBlueSheet)
                {
                    double sumIneligibleBillAmount = 0;
                    double sumIneligibleAmountIneligible = 0;

                    //foreach (MedicalExpenseIneligible expenseIneligible in lstMedicalBillIneligible)
                    foreach (MedicalExpenseIneligibleBlueSheet expenseIneligible in lstMedicalBillIneligible)
                    {
                        sumIneligibleBillAmount += expenseIneligible.BillAmount.Value;
                        sumIneligibleAmountIneligible += expenseIneligible.AmountIneligible.Value;
                    }

                    DataRow drSumIneligible = dtMedicalBillIneligible.NewRow();

                    drSumIneligible["의료기관명"] = "합계";
                    drSumIneligible["청구액(원금)"] = sumIneligibleBillAmount.ToString("C");
                    drSumIneligible["전액/일부 지원불가 금액"] = sumIneligibleAmountIneligible.ToString("C");

                    dtMedicalBillIneligible.Rows.Add(drSumIneligible);

                    //gvIneligibleBlueSheet
                    gvIneligibleBlueSheet.DataSource = null;
                    gvIneligibleBlueSheet.DataSource = dtMedicalBillIneligible;

                    DataTable dtIneligibleInTab = dtMedicalBillIneligible.Copy();
                    gvIneligibleInTab.DataSource = null;
                    gvIneligibleInTab.DataSource = dtIneligibleInTab;

                    ineligibleSortedFieldBlueSheet.Field = "서비스 날짜";
                    ineligibleSortedFieldBlueSheet.Sorted = EnumSorted.NotSorted;
                    SortIneligibleTable(ineligibleSortedFieldBlueSheet);

                    foreach (DataGridViewColumn col in gvIneligibleBlueSheet.Columns)
                    {
                        col.HeaderCell.Style.Alignment = DataGridViewContentAlignment.MiddleCenter;
                    }

                    gvIneligibleBlueSheet.Columns["INCD"].SortMode = DataGridViewColumnSortMode.Programmatic;
                    gvIneligibleBlueSheet.Columns["회원 이름"].SortMode = DataGridViewColumnSortMode.Programmatic;
                    gvIneligibleBlueSheet.Columns["MED_BILL"].SortMode = DataGridViewColumnSortMode.Programmatic;
                    gvIneligibleBlueSheet.Columns["서비스 날짜"].SortMode = DataGridViewColumnSortMode.Programmatic;
                    gvIneligibleBlueSheet.Columns["접수 날짜"].SortMode = DataGridViewColumnSortMode.Programmatic;
                    gvIneligibleBlueSheet.Columns["의료기관명"].SortMode = DataGridViewColumnSortMode.Programmatic;
                    gvIneligibleBlueSheet.Columns["지원되지않는 사유"].SortMode = DataGridViewColumnSortMode.Programmatic;

                    gvIneligibleBlueSheet.Columns["청구액(원금)"].SortMode = DataGridViewColumnSortMode.NotSortable;
                    gvIneligibleBlueSheet.Columns["전액/일부 지원불가 금액"].SortMode = DataGridViewColumnSortMode.NotSortable;


                    ineligibleInTabSortedFieldBlueSheet.Field = "서비스 날짜";
                    ineligibleInTabSortedFieldBlueSheet.Sorted = EnumSorted.NotSorted;
                    SortIneligibleTableInTab(ineligibleInTabSortedFieldBlueSheet);

                    foreach (DataGridViewColumn col in gvIneligibleInTab.Columns)
                    {
                        col.HeaderCell.Style.Alignment = DataGridViewContentAlignment.MiddleCenter;
                    }

                    gvIneligibleInTab.Columns["INCD"].SortMode = DataGridViewColumnSortMode.Programmatic;
                    gvIneligibleInTab.Columns["회원 이름"].SortMode = DataGridViewColumnSortMode.Programmatic;
                    gvIneligibleInTab.Columns["MED_BILL"].SortMode = DataGridViewColumnSortMode.Programmatic;
                    gvIneligibleInTab.Columns["서비스 날짜"].SortMode = DataGridViewColumnSortMode.Programmatic;
                    gvIneligibleInTab.Columns["접수 날짜"].SortMode = DataGridViewColumnSortMode.Programmatic;
                    gvIneligibleInTab.Columns["의료기관명"].SortMode = DataGridViewColumnSortMode.Programmatic;
                    gvIneligibleInTab.Columns["지원되지않는 사유"].SortMode = DataGridViewColumnSortMode.Programmatic;

                    gvIneligibleInTab.Columns["청구액(원금)"].SortMode = DataGridViewColumnSortMode.NotSortable;
                    gvIneligibleInTab.Columns["전액/일부 지원불가 금액"].SortMode = DataGridViewColumnSortMode.NotSortable;


                    gvIneligibleBlueSheet.Columns["INCD"].DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleCenter;
                    gvIneligibleBlueSheet.Columns["회원 이름"].DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleCenter;
                    gvIneligibleBlueSheet.Columns["MED_BILL"].DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleCenter;
                    gvIneligibleBlueSheet.Columns["서비스 날짜"].DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleCenter;
                    gvIneligibleBlueSheet.Columns["접수 날짜"].DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleCenter;
                    gvIneligibleBlueSheet.Columns["의료기관명"].DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleLeft;
                    gvIneligibleBlueSheet.Columns["청구액(원금)"].DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleRight;
                    gvIneligibleBlueSheet.Columns["전액/일부 지원불가 금액"].DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleRight;
                    gvIneligibleBlueSheet.Columns["지원되지않는 사유"].DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleLeft;

                    gvIneligibleBlueSheet.Columns["의료기관명"].Width = 200;
                    gvIneligibleBlueSheet.Columns["청구액(원금)"].Width = 100;
                    gvIneligibleBlueSheet.Columns["전액/일부 지원불가 금액"].Width = 180;
                    gvIneligibleBlueSheet.Columns["지원되지않는 사유"].Width = 200;

                    gvIneligibleInTab.Columns["INCD"].DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleCenter;
                    gvIneligibleInTab.Columns["회원 이름"].DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleCenter;
                    gvIneligibleInTab.Columns["MED_BILL"].DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleCenter;
                    gvIneligibleInTab.Columns["서비스 날짜"].DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleCenter;
                    gvIneligibleInTab.Columns["접수 날짜"].DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleCenter;
                    gvIneligibleInTab.Columns["의료기관명"].DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleLeft;
                    gvIneligibleInTab.Columns["청구액(원금)"].DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleRight;
                    gvIneligibleInTab.Columns["전액/일부 지원불가 금액"].DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleRight;
                    gvIneligibleInTab.Columns["지원되지않는 사유"].DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleLeft;



                }
            }
        }

        private void SortBillSharedTable(SortedFieldBlueSheet sf)
        {
            DataTable dtPaidWithSum = (DataTable)gvSharedMedBillBlueSheet.DataSource;

            DataTable dtSorted = dtPaidWithSum.Clone();

            DataTable dtClone = new DataTable();

            /////////////////////////////////////////

            dtClone.Columns.Add("INCD", typeof(String));
            dtClone.Columns.Add("회원 이름", typeof(String));
            dtClone.Columns.Add("MED_BILL", typeof(String));
            dtClone.Columns.Add("서비스 날짜", typeof(DateTime));
            dtClone.Columns.Add("의료기관명", typeof(String));
            dtClone.Columns.Add("청구액(원금)", typeof(String));
            dtClone.Columns.Add("본인 부담금", typeof(String));
            dtClone.Columns.Add("회원할인", typeof(String));
            dtClone.Columns.Add("CMM 할인", typeof(String));
            dtClone.Columns.Add("의료기관 지불금", typeof(String));
            //if (rbCheck.Checked || rbACH.Checked)
            if (PaidToBlueSheet == EnumPaidTo.Member)
            {
                dtClone.Columns.Add("기지급액", typeof(String));
                dtClone.Columns.Add("회원 환불금", typeof(String));
            }
            //if (rbCreditCard.Checked)
            if (PaidToBlueSheet == EnumPaidTo.MedicalProvider)
            {
                dtClone.Columns.Add("기지급액 (의료기관)", typeof(String));
                dtClone.Columns.Add("기지급액 (회원)", typeof(String));
            }
            dtClone.Columns.Add("잔액/보류", typeof(String));

            dtPaidWithSum.Rows.RemoveAt(dtPaidWithSum.Rows.Count - 1);

            foreach (DataRow row in dtPaidWithSum.Rows)
            {
                DataRow rowClone = dtClone.NewRow();
                dtClone.Rows.Add(rowClone);
            }

            for (int i = 0; i < dtPaidWithSum.Rows.Count; i++)
            {
                dtClone.Rows[i]["INCD"] = dtPaidWithSum.Rows[i]["INCD"];
                dtClone.Rows[i]["회원 이름"] = dtPaidWithSum.Rows[i]["회원 이름"];
                dtClone.Rows[i]["MED_BILL"] = dtPaidWithSum.Rows[i]["MED_BILL"];
                dtClone.Rows[i]["서비스 날짜"] = DateTime.Parse(dtPaidWithSum.Rows[i]["서비스 날짜"].ToString());
                dtClone.Rows[i]["의료기관명"] = dtPaidWithSum.Rows[i]["의료기관명"];
                dtClone.Rows[i]["청구액(원금)"] = dtPaidWithSum.Rows[i]["청구액(원금)"];
                dtClone.Rows[i]["본인 부담금"] = dtPaidWithSum.Rows[i]["본인 부담금"];
                dtClone.Rows[i]["회원할인"] = dtPaidWithSum.Rows[i]["회원할인"];
                dtClone.Rows[i]["CMM 할인"] = dtPaidWithSum.Rows[i]["CMM 할인"];
                dtClone.Rows[i]["의료기관 지불금"] = dtPaidWithSum.Rows[i]["의료기관 지불금"];
                //if (rbCheck.Checked || rbACH.Checked)
                if (PaidToBlueSheet == EnumPaidTo.Member)
                {
                    dtClone.Rows[i]["기지급액"] = dtPaidWithSum.Rows[i]["기지급액"];
                    dtClone.Rows[i]["회원 환불금"] = dtPaidWithSum.Rows[i]["회원 환불금"];
                }
                //if (rbCreditCard.Checked)
                if (PaidToBlueSheet == EnumPaidTo.MedicalProvider)
                {
                    dtClone.Rows[i]["기지급액 (의료기관)"] = dtPaidWithSum.Rows[i]["기지급액 (의료기관)"];
                    dtClone.Rows[i]["기지급액 (회원)"] = dtPaidWithSum.Rows[i]["기지급액 (회원)"];
                }
                dtClone.Rows[i]["잔액/보류"] = dtPaidWithSum.Rows[i]["잔액/보류"];
            }

            switch (sf.Sorted)
            {
                case EnumSorted.NotSorted:
                    dtClone.DefaultView.Sort = sf.Field + " ASC";
                    sf.Sorted = EnumSorted.SortedAsc;
                    break;
                case EnumSorted.SortedDesc:
                    dtClone.DefaultView.Sort = sf.Field + " ASC";
                    sf.Sorted = EnumSorted.SortedAsc;
                    break;
                case EnumSorted.SortedAsc:
                    dtClone.DefaultView.Sort = sf.Field + " DESC";
                    sf.Sorted = EnumSorted.SortedDesc;
                    break;
            }

            DataTable dtCloneSorted = dtClone.Clone();
            dtCloneSorted = dtClone.DefaultView.ToTable();

            foreach (DataRow row in dtCloneSorted.Rows)
            {
                DataRow rowSorted = dtSorted.NewRow();
                dtSorted.Rows.Add(rowSorted);
            }

            for (int i = 0; i < dtCloneSorted.Rows.Count; i++)
            {
                dtSorted.Rows[i]["INCD"] = dtCloneSorted.Rows[i]["INCD"];
                dtSorted.Rows[i]["회원 이름"] = dtCloneSorted.Rows[i]["회원 이름"];
                dtSorted.Rows[i]["MED_BILL"] = dtCloneSorted.Rows[i]["MED_BILL"];
                dtSorted.Rows[i]["서비스 날짜"] = DateTime.Parse(dtCloneSorted.Rows[i]["서비스 날짜"].ToString()).ToString("MM/dd/yyyy");
                dtSorted.Rows[i]["의료기관명"] = dtCloneSorted.Rows[i]["의료기관명"];
                dtSorted.Rows[i]["청구액(원금)"] = dtCloneSorted.Rows[i]["청구액(원금)"];
                dtSorted.Rows[i]["본인 부담금"] = dtCloneSorted.Rows[i]["본인 부담금"];
                dtSorted.Rows[i]["회원할인"] = dtCloneSorted.Rows[i]["회원할인"];
                dtSorted.Rows[i]["CMM 할인"] = dtCloneSorted.Rows[i]["CMM 할인"];
                dtSorted.Rows[i]["의료기관 지불금"] = dtCloneSorted.Rows[i]["의료기관 지불금"];
                //if (rbCheck.Checked || rbACH.Checked)
                if (PaidToBlueSheet == EnumPaidTo.Member)
                {
                    dtSorted.Rows[i]["기지급액"] = dtCloneSorted.Rows[i]["기지급액"];
                    dtSorted.Rows[i]["회원 환불금"] = dtCloneSorted.Rows[i]["회원 환불금"];
                }
                //if (rbCreditCard.Checked)
                if (PaidToBlueSheet == EnumPaidTo.MedicalProvider)
                {
                    dtSorted.Rows[i]["기지급액 (의료기관)"] = dtCloneSorted.Rows[i]["기지급액 (의료기관)"];
                    dtSorted.Rows[i]["기지급액 (회원)"] = dtCloneSorted.Rows[i]["기지급액 (회원)"];
                }
                dtSorted.Rows[i]["잔액/보류"] = dtCloneSorted.Rows[i]["잔액/보류"];
            }

            DataRow drBillPaidSumNew = dtSorted.NewRow();

            List<MedicalExpenseBlueSheet> lstMedicalExpense = new List<MedicalExpenseBlueSheet>();

            DataRow rowSelected = dtSorted.Rows[0];

            foreach (DataRow row in dtSorted.Rows)
            {
                if (PaidToBlueSheet == EnumPaidTo.Member)
                {
                    //lstMedicalExpense.Add(new MedicalExpense(Double.Parse(row[5].ToString().Substring(1)),
                    //                                         Double.Parse(row[6].ToString().Substring(1)),
                    //                                         Double.Parse(row[7].ToString().Substring(1)),
                    //                                         Double.Parse(row[8].ToString().Substring(1)),
                    //                                         Double.Parse(row[9].ToString().Substring(1)),
                    //                                         0,
                    //                                         Double.Parse(row[10].ToString().Substring(1)),
                    //                                         Double.Parse(row[11].ToString().Substring(1)),
                    //                                         Double.Parse(row[12].ToString().Substring(1))));

                    MedicalExpenseBlueSheet expense = new MedicalExpenseBlueSheet();
                    expense.BillAmount = Double.Parse(row[5].ToString().Substring(1));
                    expense.PersonalResponsibility = Double.Parse(row[6].ToString().Substring(1));
                    expense.MemberDiscount = Double.Parse(row[7].ToString().Substring(1));
                    expense.CMMDiscount = Double.Parse(row[8].ToString().Substring(1));
                    expense.CMMProviderPayment = Double.Parse(row[9].ToString().Substring(1));
                    expense.PastReimbursement = Double.Parse(row[10].ToString().Substring(1));
                    expense.Reimbursement = Double.Parse(row[11].ToString().Substring(1));
                    expense.Balance = Double.Parse(row[12].ToString().Substring(1));

                    lstMedicalExpense.Add(expense);
                }
                if (PaidToBlueSheet == EnumPaidTo.MedicalProvider)
                {
                    MedicalExpenseBlueSheet expense = new MedicalExpenseBlueSheet();
                    expense.BillAmount = Double.Parse(row[5].ToString().Substring(1));
                    expense.PersonalResponsibility = Double.Parse(row[6].ToString().Substring(1));
                    expense.MemberDiscount = Double.Parse(row[7].ToString().Substring(1));
                    expense.CMMDiscount = Double.Parse(row[8].ToString().Substring(1));
                    expense.CMMProviderPayment = Double.Parse(row[9].ToString().Substring(1));
                    expense.PastCMMProviderPayment = Double.Parse(row[10].ToString().Substring(1));
                    expense.PastReimbursement = Double.Parse(row[11].ToString().Substring(1));
                    expense.Balance = Double.Parse(row[12].ToString().Substring(1));

                    lstMedicalExpense.Add(expense);
                }
            }

            drBillPaidSumNew["INCD"] = String.Empty;
            drBillPaidSumNew["MED_BILL"] = String.Empty;
            drBillPaidSumNew["서비스 날짜"] = String.Empty;
            drBillPaidSumNew["의료기관명"] = "합계";

            MedicalExpenseBlueSheet sumMedicalExpense = new MedicalExpenseBlueSheet();

            foreach (MedicalExpenseBlueSheet expense in lstMedicalExpense)
            {
                sumMedicalExpense.BillAmount += expense.BillAmount;
                sumMedicalExpense.MemberDiscount += expense.MemberDiscount;
                sumMedicalExpense.CMMDiscount += expense.CMMDiscount;
                sumMedicalExpense.PersonalResponsibility += expense.PersonalResponsibility;
                sumMedicalExpense.CMMProviderPayment += expense.CMMProviderPayment;
                sumMedicalExpense.PastCMMProviderPayment += expense.PastCMMProviderPayment;
                sumMedicalExpense.PastReimbursement += expense.PastReimbursement;
                sumMedicalExpense.Reimbursement += expense.Reimbursement;
                sumMedicalExpense.Balance += expense.Balance;
            }

            drBillPaidSumNew["청구액(원금)"] = sumMedicalExpense.BillAmount.Value.ToString("C");
            drBillPaidSumNew["본인 부담금"] = sumMedicalExpense.PersonalResponsibility.Value.ToString("C");
            drBillPaidSumNew["회원할인"] = sumMedicalExpense.MemberDiscount.Value.ToString("C");
            drBillPaidSumNew["CMM 할인"] = sumMedicalExpense.CMMDiscount.Value.ToString("C");
            drBillPaidSumNew["의료기관 지불금"] = sumMedicalExpense.CMMProviderPayment.Value.ToString("C");
            //if (rbCheck.Checked || rbACH.Checked)
            if (PaidToBlueSheet == EnumPaidTo.Member)
            {
                drBillPaidSumNew["기지급액"] = sumMedicalExpense.PastReimbursement.Value.ToString("C");
                drBillPaidSumNew["회원 환불금"] = sumMedicalExpense.Reimbursement.Value.ToString("C");
            }
            //if (rbCreditCard.Checked)
            if (PaidToBlueSheet == EnumPaidTo.MedicalProvider)
            {
                drBillPaidSumNew["기지급액 (의료기관)"] = sumMedicalExpense.PastCMMProviderPayment.Value.ToString("C");
                drBillPaidSumNew["기지급액 (회원)"] = sumMedicalExpense.PastReimbursement.Value.ToString("C");
            }
            drBillPaidSumNew["잔액/보류"] = sumMedicalExpense.Balance.Value.ToString("C");

            dtSorted.Rows.Add(drBillPaidSumNew);
            gvSharedMedBillBlueSheet.DataSource = dtSorted;
        }

        private void gvPaymentCheckProvider_CellContentClick(object sender, DataGridViewCellEventArgs e)
        {
            if ((e.ColumnIndex == 0 || e.ColumnIndex == 1) && e.RowIndex >= 0)
            {
                if (Boolean.Parse(gvPaymentCheckProvider[e.ColumnIndex, e.RowIndex].Value.ToString()) == true)
                {
                    gvPaymentCheckProvider[e.ColumnIndex, e.RowIndex].Value = false;
                }
                else
                {
                    gvPaymentCheckProvider[e.ColumnIndex, e.RowIndex].Value = true;
                }
            }
        }

        private void btnNPFUploadMedBill_Click(object sender, EventArgs e)
        {
            if (chkNPFMedBill.Checked)
            {
                OpenFileDialog OpenSourceFileDlg = new OpenFileDialog();

                OpenSourceFileDlg.Filter = "PDF Files | *.pdf; | JPG Files | *.jpg; *.jpeg";
                OpenSourceFileDlg.DefaultExt = "pdf";
                OpenSourceFileDlg.RestoreDirectory = true;

                if (OpenSourceFileDlg.ShowDialog() == DialogResult.OK)
                {

                    strNPFSourceFilePathMedBill = OpenSourceFileDlg.FileName.Trim();
                    strNPFDestinationFilePathMedBill = strMedBillDocDestinationPath + "_NPF_MedBill_" + txtMedBillNo.Text.Trim() + "_" + OpenSourceFileDlg.SafeFileName.Trim();

                    txtNPFMedBillFileName.Text = OpenSourceFileDlg.SafeFileName.Trim();

                    try
                    {
                        File.Copy(strNPFSourceFilePathMedBill.Trim(), strNPFDestinationFilePathMedBill, true);
                        chkNPFMedBill.Checked = true;
                    }
                    catch (UnauthorizedAccessException ex)
                    {
                        MessageBox.Show(ex.Message, "Error");
                        return;
                    }
                    catch (ArgumentNullException ex)
                    {
                        MessageBox.Show(ex.Message + "\nPlease change the source file name.", "Error");
                        return;
                    }
                    catch (Exception ex)
                    {
                        MessageBox.Show(ex.Message, "Error");
                        return;
                    }

                    btnNPFMedBillView.Enabled = true;
                }
            }
            else
            {
                MessageBox.Show("Please check NPF check box first.", "Alert");
                return;
            }
        }

        private void btnNPFMedBillView_Click(object sender, EventArgs e)
        {
            if (txtNPFMedBillFileName.Text.Trim() != String.Empty)
            {
                String strMedBillNo = txtMedBillNo.Text.Trim();

                String strSqlQueryForNPFPath = "select [dbo].[tbl_medbill].[NPF_DestinationFileName] from [dbo].[tbl_medbill] where [dbo].[tbl_medbill].[BillNo] = @MedBillNo";

                SqlCommand cmdQueryForNPFPath = new SqlCommand(strSqlQueryForNPFPath, connRN5);
                cmdQueryForNPFPath.CommandType = CommandType.Text;

                cmdQueryForNPFPath.Parameters.AddWithValue("@MedBillNo", strMedBillNo);

                if (connRN5.State != ConnectionState.Closed)
                {
                    connRN5.Close();
                    connRN5.Open();
                }
                else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                Object objNPFPath = cmdQueryForNPFPath.ExecuteScalar();
                if (connRN5.State != ConnectionState.Closed) connRN5.Close();

                String strDestinationFilePath = String.Empty;
                if (objNPFPath != null) strDestinationFilePath = objNPFPath.ToString();

                if (strDestinationFilePath == String.Empty) strDestinationFilePath = strMedBillDocDestinationPath + "_NPF_MedBill_" + txtMedBillNo.Text.Trim() + "_" + txtNPFMedBillFileName.Text.Trim();
                
                try
                {
                    ProcessStartInfo processInfo = new ProcessStartInfo();
                    processInfo.FileName = strDestinationFilePath;
                    Process.Start(processInfo);
                }
                catch (Exception ex)
                {
                    MessageBox.Show(ex.Message, "Error");
                    return;
                }
            }
            else
            {
                MessageBox.Show("No NPF in Medical Bill has been uploaded.", "Alert");
                return;
            }
        }

        private void btnIBUploadMedBill_Click(object sender, EventArgs e)
        {
            if (chkIBMedBill.Checked)
            {
                OpenFileDialog OpenSourceFileDlg = new OpenFileDialog();

                OpenSourceFileDlg.Filter = "PDF Files | *.pdf; | JPG Files | *.jpg; *.jpeg";
                OpenSourceFileDlg.DefaultExt = "pdf";
                OpenSourceFileDlg.RestoreDirectory = true;

                if (OpenSourceFileDlg.ShowDialog() == DialogResult.OK)
                {
                    strIBSourceFilePathMedBill = OpenSourceFileDlg.FileName.Trim();
                    strIBDestinationFilePathMedBill = strMedBillDocDestinationPath + "_IB_MedBill_" + txtMedBillNo.Text.Trim() + "_" + OpenSourceFileDlg.SafeFileName.Trim();
                    txtIBMedBillFileName.Text = OpenSourceFileDlg.SafeFileName.Trim();

                    try
                    {
                        File.Copy(strIBSourceFilePathMedBill.Trim(), strIBDestinationFilePathMedBill, true);
                        chkIBMedBill.Checked = true;
                    }
                    catch (UnauthorizedAccessException ex)
                    {
                        MessageBox.Show(ex.Message, "Error");
                        return;
                    }
                    catch (ArgumentNullException ex)
                    {
                        MessageBox.Show(ex.Message + "\nPlease change the source file name.", "Error");
                        return;
                    }
                    catch (Exception ex)
                    {
                        MessageBox.Show(ex.Message, "Error");
                        return;
                    }

                    btnIBMedBillView.Enabled = true;
                }
            }
            else
            {
                MessageBox.Show("Please check IB checkbox first.", "Alert");
                return;
            }
        }

        private void btnIBMedBillView_Click(object sender, EventArgs e)
        {
            if (txtIBMedBillFileName.Text.Trim() != String.Empty)
            {
                String strMedBillNo = txtMedBillNo.Text.Trim();

                String strSqlQueryForIBPath = "select [dbo].[tbl_medbill].[IB_DestinationFileName] from [dbo].[tbl_medbill] where [dbo].[tbl_medbill].[BillNo] = @MedBillNo";

                SqlCommand cmdQueryForIBPath = new SqlCommand(strSqlQueryForIBPath, connRN5);
                cmdQueryForIBPath.CommandType = CommandType.Text;

                cmdQueryForIBPath.Parameters.AddWithValue("@MedBillNo", strMedBillNo);

                if (connRN5.State != ConnectionState.Closed)
                {
                    connRN5.Close();
                    connRN5.Open();
                }
                else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                Object objIBPath = cmdQueryForIBPath.ExecuteScalar();
                if (connRN5.State != ConnectionState.Closed) connRN5.Close();

                String strDestinationFilePath = String.Empty;
                if (objIBPath != null) strDestinationFilePath = objIBPath.ToString();

                if (strDestinationFilePath == String.Empty) strDestinationFilePath = strMedBillDocDestinationPath + "_IB_MedBill_" + txtMedBillNo.Text.Trim() + "_" + txtIBMedBillFileName.Text.Trim();

                try
                {
                    ProcessStartInfo processInfo = new ProcessStartInfo();
                    processInfo.FileName = strDestinationFilePath;
                    Process.Start(processInfo);
                }
                catch (Exception ex)
                {
                    MessageBox.Show(ex.Message, "Error");
                    return;
                }
            }
            else
            {
                MessageBox.Show("No IB in Medical Bill has been uploaded.", "Alert");
                return;
            }
        }

        private void btnPoPUploadMedBill_Click(object sender, EventArgs e)
        {
            if (chkPoPMedBill.Checked)
            {
                OpenFileDialog OpenSourceFileDlg = new OpenFileDialog();

                OpenSourceFileDlg.Filter = "PDF Files | *.pdf; | JPG Files | *.jpg; *.jpeg";
                OpenSourceFileDlg.DefaultExt = "pdf";
                OpenSourceFileDlg.RestoreDirectory = true;

                if (OpenSourceFileDlg.ShowDialog() == DialogResult.OK)
                {
                    strPoPSourceFilePathMedBill = OpenSourceFileDlg.FileName.Trim();
                    strPoPDestinationFilePathMedBill = strMedBillDocDestinationPath + "_PoP_MedBill_" + txtMedBillNo.Text.Trim() + "_" + OpenSourceFileDlg.SafeFileName.Trim();

                    txtPoPMedBillFileName.Text = OpenSourceFileDlg.SafeFileName.Trim();

                    try
                    {
                        File.Copy(strPoPSourceFilePathMedBill.Trim(), strPoPDestinationFilePathMedBill, true);
                        chkPoPMedBill.Checked = true;
                    }
                    catch (UnauthorizedAccessException ex)
                    {
                        MessageBox.Show(ex.Message, "Error");
                        return;
                    }
                    catch (ArgumentNullException ex)
                    {
                        MessageBox.Show(ex.Message + "\nPlease change the source file name.", "Error");
                        return;
                    }
                    catch (Exception ex)
                    {
                        MessageBox.Show(ex.Message, "Error");
                        return;
                    }

                    btnPoPMedBillView.Enabled = true;
                }
            }
            else
            {
                MessageBox.Show("Please check PoP checkbox first.", "Alert");
                return;
            }
        }

        private void btnPoPMedBillView_Click(object sender, EventArgs e)
        {
            if (txtPoPMedBillFileName.Text.Trim() != String.Empty)
            {
                String strMedBillNo = txtMedBillNo.Text.Trim();

                String strSqlQueryForPOPPath = "select [dbo].[tbl_medbill].[POP_DestinationFileName] from [dbo].[tbl_medbill] where [dbo].[tbl_medbill].[BillNo] = @MedBillNo";

                SqlCommand cmdQueryForPOPPath = new SqlCommand(strSqlQueryForPOPPath, connRN5);
                cmdQueryForPOPPath.CommandType = CommandType.Text;

                cmdQueryForPOPPath.Parameters.AddWithValue("@MedBillNo", strMedBillNo);

                if (connRN5.State != ConnectionState.Closed)
                {
                    connRN5.Close();
                    connRN5.Open();
                }
                else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                Object objPOPPath = cmdQueryForPOPPath.ExecuteScalar();
                if (connRN5.State != ConnectionState.Closed) connRN5.Close();

                String strDestinationFilePath = String.Empty;
                if (objPOPPath != null) strDestinationFilePath = objPOPPath.ToString();

                if (strDestinationFilePath == String.Empty) strDestinationFilePath = strMedBillDocDestinationPath + "_PoP_MedBill_" + txtMedBillNo.Text.Trim() + "_" + txtPoPMedBillFileName.Text.Trim();

                try
                {
                    ProcessStartInfo processInfo = new ProcessStartInfo();
                    processInfo.FileName = strDestinationFilePath;
                    Process.Start(processInfo);
                }
                catch (Exception ex)
                {
                    MessageBox.Show(ex.Message, "Error");
                    return;
                }
            }
            else
            {
                MessageBox.Show("No PoP in Medical Bill has been uploaded.", "Alert");
                return;
            }
        }

        private void btnMedRecUploadMedBill_Click(object sender, EventArgs e)
        {
            if (chkMedRecMedBill.Checked)
            {
                OpenFileDialog OpenSourceFileDlg = new OpenFileDialog();

                OpenSourceFileDlg.Filter = "PDF Files | *.pdf; | JPG Files | *.jpg; *.jpeg";
                OpenSourceFileDlg.DefaultExt = "pdf";
                OpenSourceFileDlg.RestoreDirectory = true;

                if (OpenSourceFileDlg.ShowDialog() == DialogResult.OK)
                {
                    strMedRecSourceFilePathMedBill = OpenSourceFileDlg.FileName.Trim();
                    strMedRecDestinationFilePathMedBill = strMedBillDocDestinationPath + "_MedRec_MedBill_" + txtMedBillNo.Text.Trim() + "_" + OpenSourceFileDlg.SafeFileName.Trim();
                    txtMedRecMedBillFileName.Text = OpenSourceFileDlg.SafeFileName.Trim();

                    try
                    {
                        File.Copy(strMedRecSourceFilePathMedBill.Trim(), strMedRecDestinationFilePathMedBill, true);
                        chkMedRecMedBill.Checked = true;
                    }
                    catch (UnauthorizedAccessException ex)
                    {
                        MessageBox.Show(ex.Message, "Error");
                        return;
                    }
                    catch (ArgumentNullException ex)
                    {
                        MessageBox.Show(ex.Message + "\nPlease change the source file name.", "Error");
                        return;
                    }
                    catch (Exception ex)
                    {
                        MessageBox.Show(ex.Message, "Error");
                        return;
                    }

                    btnMedRecMedBillView.Enabled = true;

                }
            }
            else
            {
                MessageBox.Show("Please check MedRec checkbox first.", "Alert");
                return;
            }
        }

        private void btnMedRecMedBillView_Click(object sender, EventArgs e)
        {
            if (txtMedRecMedBillFileName.Text.Trim() != String.Empty)
            {
                String strMedBillNo = txtMedBillNo.Text.Trim();

                String strSqlQueryForMedRecPath = "select [dbo].[tbl_medbill].[MedRec_DestinationFileName] from [dbo].[tbl_medbill] where [dbo].[tbl_medbill].[BillNo] = @MedBillNo";

                SqlCommand cmdQueryForMedRecPath = new SqlCommand(strSqlQueryForMedRecPath, connRN5);
                cmdQueryForMedRecPath.CommandType = CommandType.Text;

                cmdQueryForMedRecPath.Parameters.AddWithValue("@MedBillNo", strMedBillNo);

                if (connRN5.State != ConnectionState.Closed)
                {
                    connRN5.Close();
                    connRN5.Open();
                }
                else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                Object objMedRecPath = cmdQueryForMedRecPath.ExecuteScalar();
                if (connRN5.State != ConnectionState.Closed) connRN5.Close();

                String strDestinationFilePath = String.Empty;
                if (objMedRecPath != null) strDestinationFilePath = objMedRecPath.ToString();

                if (strDestinationFilePath == String.Empty) strDestinationFilePath = strMedBillDocDestinationPath + "_MedRec_MedBill_" + txtMedBillNo.Text.Trim() + "_" + txtMedRecMedBillFileName.Text.Trim();

                try
                {
                    ProcessStartInfo processInfo = new ProcessStartInfo();
                    processInfo.FileName = strDestinationFilePath;
                    Process.Start(processInfo);
                }
                catch (Exception ex)
                {
                    MessageBox.Show(ex.Message, "Error");
                    return;
                }
            }
            else
            {
                MessageBox.Show("No MedRec in Medical Bill has been uploaded.", "Alert");
                return;
            }
        }

        private void btnOtherDocUploadMedBill_Click(object sender, EventArgs e)
        {
            if (chkOtherDocMedBill.Checked)
            {
                OpenFileDialog OpenSourceFileDlg = new OpenFileDialog();
                OpenSourceFileDlg.Filter = "PDF Files | *.pdf; | JPG Files | *.jpg; *.jpeg";
                OpenSourceFileDlg.DefaultExt = "pdf";
                OpenSourceFileDlg.RestoreDirectory = true;

                if (OpenSourceFileDlg.ShowDialog() == DialogResult.OK)
                {
                    strOtherDocSourceFilePathMedBill = OpenSourceFileDlg.FileName.Trim();
                    strOtherDocDestinationFilePathMedBill = strMedBillDocDestinationPath + "_OtherDoc_MedBill_" + txtMedBillNo.Text.Trim() + "_" + OpenSourceFileDlg.SafeFileName.Trim();
                    txtOtherDocMedBillFileName.Text = OpenSourceFileDlg.SafeFileName.Trim();

                    try
                    {
                        File.Copy(strOtherDocSourceFilePathMedBill.Trim(), strOtherDocDestinationFilePathMedBill, true);
                        chkOtherDocMedBill.Checked = true;
                    }
                    catch (UnauthorizedAccessException ex)
                    {
                        MessageBox.Show(ex.Message, "Error");
                        return;
                    }
                    catch (ArgumentNullException ex)
                    {
                        MessageBox.Show(ex.Message + "\nPlease change the source file name.", "Error");
                        return;
                    }
                    catch (Exception ex)
                    {
                        MessageBox.Show(ex.Message, "Error");
                        return;
                    }

                    btnOtherDocMedBillView.Enabled = true;
                }
            }
            else
            {
                MessageBox.Show("Please check OtherDoc checkbox first.", "Alert");
                return;
            }
        }

        private void btnOtherDocMedBillView_Click(object sender, EventArgs e)
        {
            if (txtOtherDocMedBillFileName.Text.Trim() != String.Empty)
            {

                String strMedBillNo = txtMedBillNo.Text.Trim();

                String strSqlQueryForOtherDocPath = "select [dbo].[tbl_medbill].[Unknown_DestinationFileName] from [dbo].[tbl_medbill] where [dbo].[tbl_medbill].[BillNo] = @MedBillNo";

                SqlCommand cmdQueryForOtherDocPath = new SqlCommand(strSqlQueryForOtherDocPath, connRN5);
                cmdQueryForOtherDocPath.CommandType = CommandType.Text;

                cmdQueryForOtherDocPath.Parameters.AddWithValue("@MedBillNo", strMedBillNo);

                if (connRN5.State != ConnectionState.Closed)
                {
                    connRN5.Close();
                    connRN5.Open();
                }
                else if (connRN5.State == ConnectionState.Closed) connRN5.Open();
                Object objOtherDocPath = cmdQueryForOtherDocPath.ExecuteScalar();
                if (connRN5.State != ConnectionState.Closed) connRN5.Close();

                String strDestinationFilePath = String.Empty;
                if (objOtherDocPath != null) strDestinationFilePath = objOtherDocPath.ToString();

                if (strDestinationFilePath == String.Empty) strDestinationFilePath = strMedBillDocDestinationPath + "_OtherDoc_MedBill_" + txtMedBillNo.Text.Trim() + "_" + txtOtherDocMedBillFileName.Text.Trim();

                try
                {
                    ProcessStartInfo processInfo = new ProcessStartInfo();
                    processInfo.FileName = strDestinationFilePath;
                    Process.Start(processInfo);
                }
                catch (Exception ex)
                {
                    MessageBox.Show(ex.Message, "Error");
                    return;
                }
            }
            else
            {
                MessageBox.Show("No OtherDoc in Medical Bill has been uploaded.", "Alert");
                return;
            }
        }

        private void chkNPFMedBill_CheckedChanged(object sender, EventArgs e)
        {
            if (!chkNPFMedBill.Checked)
            {
                if (txtNPFMedBillFileName.Text.Trim() != String.Empty)
                {
                    txtNPFMedBillFileName.Text = String.Empty;
                    strNPFFormFileName = String.Empty;
                    strNPFSourceFilePathMedBill = String.Empty;
                    strNPFDestinationFilePathMedBill = String.Empty;
                }
            }
        }

        private void gvSharedMedBillBlueSheet_ColumnHeaderMouseClick(object sender, DataGridViewCellMouseEventArgs e)
        {
            switch (e.ColumnIndex)
            {
                case 0:
                    if (paidSortedFieldBlueSheet.Field != "INCD")
                    {
                        paidSortedFieldBlueSheet.Field = "INCD";
                        paidSortedFieldBlueSheet.Sorted = EnumSorted.NotSorted;
                    }
                    SortBillSharedTable(paidSortedFieldBlueSheet);
                    break;
                case 1:
                    if (paidSortedFieldBlueSheet.Field != "회원 이름")
                    {
                        paidSortedFieldBlueSheet.Field = "회원 이름";
                        paidSortedFieldBlueSheet.Sorted = EnumSorted.NotSorted;
                    }
                    SortBillSharedTable(paidSortedFieldBlueSheet);
                    break;
                case 2:
                    if (paidSortedFieldBlueSheet.Field != "MED_BILL")
                    {
                        paidSortedFieldBlueSheet.Field = "MED_BILL";
                        paidSortedFieldBlueSheet.Sorted = EnumSorted.NotSorted;
                    }
                    SortBillSharedTable(paidSortedFieldBlueSheet);
                    break;
                case 3:
                    if (paidSortedFieldBlueSheet.Field != "서비스 날짜")
                    {
                        paidSortedFieldBlueSheet.Field = "서비스 날짜";
                        paidSortedFieldBlueSheet.Sorted = EnumSorted.NotSorted;
                    }
                    SortBillSharedTable(paidSortedFieldBlueSheet);
                    break;
                case 4:
                    if (paidSortedFieldBlueSheet.Field != "의료기관명")
                    {
                        paidSortedFieldBlueSheet.Field = "의료기관명";
                        paidSortedFieldBlueSheet.Sorted = EnumSorted.NotSorted;
                    }
                    SortBillSharedTable(paidSortedFieldBlueSheet);
                    break;

            }
        }

        private void SortBillSharedTableInPaidTab(SortedFieldBlueSheet sf)
        {
            DataTable dtPaidWithSum = (DataTable)gvSharedInPaidTab.DataSource;

            DataTable dtSorted = dtPaidWithSum.Clone();

            DataTable dtClone = new DataTable();

            /////////////////////////////////////////

            dtClone.Columns.Add("INCD", typeof(String));
            dtClone.Columns.Add("회원 이름", typeof(String));
            dtClone.Columns.Add("MED_BILL", typeof(String));
            dtClone.Columns.Add("서비스 날짜", typeof(DateTime));
            dtClone.Columns.Add("의료기관명", typeof(String));
            dtClone.Columns.Add("청구액(원금)", typeof(String));
            dtClone.Columns.Add("본인 부담금", typeof(String));
            dtClone.Columns.Add("회원할인", typeof(String));
            dtClone.Columns.Add("CMM 할인", typeof(String));
            dtClone.Columns.Add("의료기관 지불금", typeof(String));
            //if (rbCheck.Checked || rbACH.Checked)
            if (PaidToBlueSheet == EnumPaidTo.Member)
            {
                dtClone.Columns.Add("기지급액", typeof(String));
                dtClone.Columns.Add("회원 환불금", typeof(String));
            }
            //if (rbCreditCard.Checked)
            if (PaidToBlueSheet == EnumPaidTo.MedicalProvider)
            {
                dtClone.Columns.Add("기지급액 (의료기관)", typeof(String));
                dtClone.Columns.Add("기지급액 (회원)", typeof(String));
            }
            dtClone.Columns.Add("잔액/보류", typeof(String));

            dtPaidWithSum.Rows.RemoveAt(dtPaidWithSum.Rows.Count - 1);

            foreach (DataRow row in dtPaidWithSum.Rows)
            {
                DataRow rowClone = dtClone.NewRow();
                dtClone.Rows.Add(rowClone);
            }

            for (int i = 0; i < dtPaidWithSum.Rows.Count; i++)
            {
                dtClone.Rows[i]["INCD"] = dtPaidWithSum.Rows[i]["INCD"];
                dtClone.Rows[i]["회원 이름"] = dtPaidWithSum.Rows[i]["회원 이름"];
                dtClone.Rows[i]["MED_BILL"] = dtPaidWithSum.Rows[i]["MED_BILL"];
                dtClone.Rows[i]["서비스 날짜"] = DateTime.Parse(dtPaidWithSum.Rows[i]["서비스 날짜"].ToString());
                dtClone.Rows[i]["의료기관명"] = dtPaidWithSum.Rows[i]["의료기관명"];
                dtClone.Rows[i]["청구액(원금)"] = dtPaidWithSum.Rows[i]["청구액(원금)"];
                dtClone.Rows[i]["본인 부담금"] = dtPaidWithSum.Rows[i]["본인 부담금"];
                dtClone.Rows[i]["회원할인"] = dtPaidWithSum.Rows[i]["회원할인"];
                dtClone.Rows[i]["CMM 할인"] = dtPaidWithSum.Rows[i]["CMM 할인"];
                dtClone.Rows[i]["의료기관 지불금"] = dtPaidWithSum.Rows[i]["의료기관 지불금"];
                //if (rbCheck.Checked || rbACH.Checked)
                if (PaidToBlueSheet == EnumPaidTo.Member)
                {
                    dtClone.Rows[i]["기지급액"] = dtPaidWithSum.Rows[i]["기지급액"];
                    dtClone.Rows[i]["회원 환불금"] = dtPaidWithSum.Rows[i]["회원 환불금"];
                }
                //if (rbCreditCard.Checked)
                if (PaidToBlueSheet == EnumPaidTo.MedicalProvider)
                {
                    dtClone.Rows[i]["기지급액 (의료기관)"] = dtPaidWithSum.Rows[i]["기지급액 (의료기관)"];
                    dtClone.Rows[i]["기지급액 (회원)"] = dtPaidWithSum.Rows[i]["기지급액 (회원)"];
                }
                dtClone.Rows[i]["잔액/보류"] = dtPaidWithSum.Rows[i]["잔액/보류"];
            }

            switch (sf.Sorted)
            {
                case EnumSorted.NotSorted:
                    dtClone.DefaultView.Sort = sf.Field + " ASC";
                    sf.Sorted = EnumSorted.SortedAsc;
                    break;
                case EnumSorted.SortedDesc:
                    dtClone.DefaultView.Sort = sf.Field + " ASC";
                    sf.Sorted = EnumSorted.SortedAsc;
                    break;
                case EnumSorted.SortedAsc:
                    dtClone.DefaultView.Sort = sf.Field + " DESC";
                    sf.Sorted = EnumSorted.SortedDesc;
                    break;
            }

            DataTable dtCloneSorted = dtClone.Clone();
            dtCloneSorted = dtClone.DefaultView.ToTable();

            foreach (DataRow row in dtCloneSorted.Rows)
            {
                DataRow rowSorted = dtSorted.NewRow();
                dtSorted.Rows.Add(rowSorted);
            }

            for (int i = 0; i < dtCloneSorted.Rows.Count; i++)
            {
                dtSorted.Rows[i]["INCD"] = dtCloneSorted.Rows[i]["INCD"];
                dtSorted.Rows[i]["회원 이름"] = dtCloneSorted.Rows[i]["회원 이름"];
                dtSorted.Rows[i]["MED_BILL"] = dtCloneSorted.Rows[i]["MED_BILL"];
                dtSorted.Rows[i]["서비스 날짜"] = DateTime.Parse(dtCloneSorted.Rows[i]["서비스 날짜"].ToString()).ToString("MM/dd/yyyy");
                dtSorted.Rows[i]["의료기관명"] = dtCloneSorted.Rows[i]["의료기관명"];
                dtSorted.Rows[i]["청구액(원금)"] = dtCloneSorted.Rows[i]["청구액(원금)"];
                dtSorted.Rows[i]["본인 부담금"] = dtCloneSorted.Rows[i]["본인 부담금"];
                dtSorted.Rows[i]["회원할인"] = dtCloneSorted.Rows[i]["회원할인"];
                dtSorted.Rows[i]["CMM 할인"] = dtCloneSorted.Rows[i]["CMM 할인"];
                dtSorted.Rows[i]["의료기관 지불금"] = dtCloneSorted.Rows[i]["의료기관 지불금"];
                //if (rbCheck.Checked || rbACH.Checked)
                if (PaidToBlueSheet == EnumPaidTo.Member)
                {
                    dtSorted.Rows[i]["기지급액"] = dtCloneSorted.Rows[i]["기지급액"];
                    dtSorted.Rows[i]["회원 환불금"] = dtCloneSorted.Rows[i]["회원 환불금"];
                }
                //if (rbCreditCard.Checked)
                if (PaidToBlueSheet == EnumPaidTo.MedicalProvider)
                {
                    dtSorted.Rows[i]["기지급액 (의료기관)"] = dtCloneSorted.Rows[i]["기지급액 (의료기관)"];
                    dtSorted.Rows[i]["기지급액 (회원)"] = dtCloneSorted.Rows[i]["기지급액 (회원)"];
                }
                dtSorted.Rows[i]["잔액/보류"] = dtCloneSorted.Rows[i]["잔액/보류"];
            }

            DataRow drBillPaidSumNew = dtSorted.NewRow();

            List<MedicalExpenseBlueSheet> lstMedicalExpense = new List<MedicalExpenseBlueSheet>();

            foreach (DataRow row in dtSorted.Rows)
            {
                //if (rbCheck.Checked || rbACH.Checked)
                if (PaidToBlueSheet == EnumPaidTo.Member)
                {
                    //lstMedicalExpense.Add(new MedicalExpense(Double.Parse(row[5].ToString().Substring(1)),
                    //                                         Double.Parse(row[6].ToString().Substring(1)),
                    //                                         Double.Parse(row[7].ToString().Substring(1)),
                    //                                         Double.Parse(row[8].ToString().Substring(1)),
                    //                                         Double.Parse(row[9].ToString().Substring(1)),
                    //                                         0,
                    //                                         Double.Parse(row[10].ToString().Substring(1)),
                    //                                         Double.Parse(row[11].ToString().Substring(1)),
                    //                                         Double.Parse(row[12].ToString().Substring(1))));

                    MedicalExpenseBlueSheet expense = new MedicalExpenseBlueSheet();
                    expense.BillAmount = Double.Parse(row[5].ToString().Substring(1));
                    expense.PersonalResponsibility = Double.Parse(row[6].ToString().Substring(1));
                    expense.MemberDiscount = Double.Parse(row[7].ToString().Substring(1));
                    expense.CMMDiscount = Double.Parse(row[8].ToString().Substring(1));
                    expense.CMMProviderPayment = Double.Parse(row[9].ToString().Substring(1));
                    expense.PastReimbursement = Double.Parse(row[10].ToString().Substring(1));
                    expense.Reimbursement = Double.Parse(row[11].ToString().Substring(1));
                    expense.Balance = Double.Parse(row[12].ToString().Substring(1));

                    lstMedicalExpense.Add(expense);
                }
                //if (rbCreditCard.Checked)
                if (PaidToBlueSheet == EnumPaidTo.MedicalProvider)
                {
                    //lstMedicalExpense.Add(new MedicalExpense(Double.Parse(row[5].ToString().Substring(1)),
                    //                                         Double.Parse(row[6].ToString().Substring(1)),
                    //                                         Double.Parse(row[7].ToString().Substring(1)),
                    //                                         Double.Parse(row[8].ToString().Substring(1)),
                    //                                         Double.Parse(row[9].ToString().Substring(1)),
                    //                                         Double.Parse(row[10].ToString().Substring(1)),
                    //                                         Double.Parse(row[11].ToString().Substring(1)),
                    //                                         0,
                    //                                         Double.Parse(row[12].ToString().Substring(1))));

                    MedicalExpenseBlueSheet expense = new MedicalExpenseBlueSheet();
                    expense.BillAmount = Double.Parse(row[5].ToString().Substring(1));
                    expense.PersonalResponsibility = Double.Parse(row[6].ToString().Substring(1));
                    expense.MemberDiscount = Double.Parse(row[7].ToString().Substring(1));
                    expense.CMMDiscount = Double.Parse(row[8].ToString().Substring(1));
                    expense.CMMProviderPayment = Double.Parse(row[9].ToString().Substring(1));
                    expense.PastCMMProviderPayment = Double.Parse(row[10].ToString().Substring(1));
                    expense.PastReimbursement = Double.Parse(row[11].ToString().Substring(1));
                    expense.Balance = Double.Parse(row[12].ToString().Substring(1));

                    lstMedicalExpense.Add(expense);

                }
            }

            drBillPaidSumNew["INCD"] = String.Empty;
            drBillPaidSumNew["MED_BILL"] = String.Empty;
            drBillPaidSumNew["서비스 날짜"] = String.Empty;
            drBillPaidSumNew["의료기관명"] = "합계";

            MedicalExpenseBlueSheet sumMedicalExpense = new MedicalExpenseBlueSheet();

            foreach (MedicalExpenseBlueSheet expense in lstMedicalExpense)
            {
                sumMedicalExpense.BillAmount += expense.BillAmount;
                sumMedicalExpense.PersonalResponsibility += expense.PersonalResponsibility;
                sumMedicalExpense.MemberDiscount += expense.MemberDiscount;
                sumMedicalExpense.CMMDiscount += expense.CMMDiscount;
                sumMedicalExpense.CMMProviderPayment += expense.CMMProviderPayment;
                sumMedicalExpense.PastCMMProviderPayment += expense.PastCMMProviderPayment;
                sumMedicalExpense.PastReimbursement += expense.PastReimbursement;
                sumMedicalExpense.Reimbursement += expense.Reimbursement;
                sumMedicalExpense.Balance += expense.Balance;
            }

            drBillPaidSumNew["청구액(원금)"] = sumMedicalExpense.BillAmount.Value.ToString("C");
            drBillPaidSumNew["본인 부담금"] = sumMedicalExpense.PersonalResponsibility.Value.ToString("C");
            drBillPaidSumNew["회원할인"] = sumMedicalExpense.MemberDiscount.Value.ToString("C");
            drBillPaidSumNew["CMM 할인"] = sumMedicalExpense.CMMDiscount.Value.ToString("C");
            drBillPaidSumNew["의료기관 지불금"] = sumMedicalExpense.CMMProviderPayment.Value.ToString("C");
            //if (rbCheck.Checked || rbACH.Checked)
            if (PaidToBlueSheet == EnumPaidTo.Member)
            {
                drBillPaidSumNew["기지급액"] = sumMedicalExpense.PastReimbursement.Value.ToString("C");
                drBillPaidSumNew["회원 환불금"] = sumMedicalExpense.Reimbursement.Value.ToString("C");
            }
            //if (rbCreditCard.Checked)
            if (PaidToBlueSheet == EnumPaidTo.MedicalProvider)
            {
                drBillPaidSumNew["기지급액 (의료기관)"] = sumMedicalExpense.PastCMMProviderPayment.Value.ToString("C");
                drBillPaidSumNew["기지급액 (회원)"] = sumMedicalExpense.PastReimbursement.Value.ToString("C");
            }
            drBillPaidSumNew["잔액/보류"] = sumMedicalExpense.Balance.Value.ToString("C");

            dtSorted.Rows.Add(drBillPaidSumNew);
            gvSharedInPaidTab.DataSource = dtSorted;
        }

        private void gvSharedInPaidTab_ColumnHeaderMouseClick(object sender, DataGridViewCellMouseEventArgs e)
        {
            switch (e.ColumnIndex)
            {
                case 0:
                    if (paidInPaidTabSortedFieldBlueSheet.Field != "INCD")
                    {
                        paidInPaidTabSortedFieldBlueSheet.Field = "INCD";
                        paidInPaidTabSortedFieldBlueSheet.Sorted = EnumSorted.NotSorted;
                    }
                    SortBillSharedTableInPaidTab(paidInPaidTabSortedFieldBlueSheet);
                    break;
                case 1:
                    if (paidInPaidTabSortedFieldBlueSheet.Field != "회원 이름")
                    {
                        paidInPaidTabSortedFieldBlueSheet.Field = "회원 이름";
                        paidInPaidTabSortedFieldBlueSheet.Sorted = EnumSorted.NotSorted;
                    }
                    SortBillSharedTableInPaidTab(paidInPaidTabSortedFieldBlueSheet);
                    break;
                case 2:
                    if (paidInPaidTabSortedFieldBlueSheet.Field != "MED_BILL")
                    {
                        paidInPaidTabSortedFieldBlueSheet.Field = "MED_BILL";
                        paidInPaidTabSortedFieldBlueSheet.Sorted = EnumSorted.NotSorted;
                    }
                    SortBillSharedTableInPaidTab(paidInPaidTabSortedFieldBlueSheet);
                    break;
                case 3:
                    if (paidInPaidTabSortedFieldBlueSheet.Field != "서비스 날짜")
                    {
                        paidInPaidTabSortedFieldBlueSheet.Field = "서비스 날짜";
                        paidInPaidTabSortedFieldBlueSheet.Sorted = EnumSorted.NotSorted;
                    }
                    SortBillSharedTableInPaidTab(paidInPaidTabSortedFieldBlueSheet);
                    break;
                case 4:
                    if (paidInPaidTabSortedFieldBlueSheet.Field != "의료기관명")
                    {
                        paidInPaidTabSortedFieldBlueSheet.Field = "의료기관명";
                        paidInPaidTabSortedFieldBlueSheet.Sorted = EnumSorted.NotSorted;
                    }
                    SortBillSharedTableInPaidTab(paidInPaidTabSortedFieldBlueSheet);
                    break;

            }
        }

        private void SortCMMPendingPaymentTable(SortedFieldBlueSheet sf)
        {
            DataTable dtCMMPendingPaymentWithSum = (DataTable)gvCMMPendingPaymentBlueSheet.DataSource;

            DataTable dtSorted = dtCMMPendingPaymentWithSum.Clone();

            DataTable dtClone = new DataTable();
            dtClone.Columns.Add("INCD", typeof(String));
            dtClone.Columns.Add("회원 이름", typeof(String));
            dtClone.Columns.Add("MED_BILL", typeof(String));
            dtClone.Columns.Add("서비스 날짜", typeof(DateTime));
            //dtClone.Columns.Add("접수 날짜", typeof(DateTime));
            dtClone.Columns.Add("의료기관명", typeof(String));
            dtClone.Columns.Add("청구액(원금)", typeof(String));
            dtClone.Columns.Add("회원할인", typeof(String));
            dtClone.Columns.Add("CMM 할인", typeof(String));
            dtClone.Columns.Add("본인 부담금", typeof(String));
            dtClone.Columns.Add("정산 완료", typeof(String));
            dtClone.Columns.Add("지원 예정", typeof(String));

            dtCMMPendingPaymentWithSum.Rows.RemoveAt(dtCMMPendingPaymentWithSum.Rows.Count - 1);

            foreach (DataRow row in dtCMMPendingPaymentWithSum.Rows)
            {
                DataRow rowClone = dtClone.NewRow();
                dtClone.Rows.Add(rowClone);
            }

            for (int i = 0; i < dtCMMPendingPaymentWithSum.Rows.Count; i++)
            {
                dtClone.Rows[i]["INCD"] = dtCMMPendingPaymentWithSum.Rows[i]["INCD"];
                dtClone.Rows[i]["회원 이름"] = dtCMMPendingPaymentWithSum.Rows[i]["회원 이름"];
                dtClone.Rows[i]["MED_BILL"] = dtCMMPendingPaymentWithSum.Rows[i]["MED_BILL"];
                dtClone.Rows[i]["서비스 날짜"] = DateTime.Parse(dtCMMPendingPaymentWithSum.Rows[i]["서비스 날짜"].ToString());

                //String strDate = dtCMMPendingPaymentWithSum.Rows[i]["접수 날짜"].ToString();

                //if (dtCMMPendingPaymentWithSum.Rows[i]["접수 날짜"].ToString() != String.Empty)
                //{
                //    dtClone.Rows[i]["접수 날짜"] = DateTime.Parse(dtCMMPendingPaymentWithSum.Rows[i]["접수 날짜"].ToString());
                //}
                //else dtClone.Rows[i]["접수 날짜"] = DBNull.Value;
                dtClone.Rows[i]["의료기관명"] = dtCMMPendingPaymentWithSum.Rows[i]["의료기관명"];
                dtClone.Rows[i]["청구액(원금)"] = dtCMMPendingPaymentWithSum.Rows[i]["청구액(원금)"];
                dtClone.Rows[i]["회원할인"] = dtCMMPendingPaymentWithSum.Rows[i]["회원할인"];
                dtClone.Rows[i]["CMM 할인"] = dtCMMPendingPaymentWithSum.Rows[i]["CMM 할인"];
                dtClone.Rows[i]["본인 부담금"] = dtCMMPendingPaymentWithSum.Rows[i]["본인 부담금"];
                dtClone.Rows[i]["정산 완료"] = dtCMMPendingPaymentWithSum.Rows[i]["정산 완료"];
                dtClone.Rows[i]["지원 예정"] = dtCMMPendingPaymentWithSum.Rows[i]["지원 예정"];
            }

            switch (sf.Sorted)
            {
                case EnumSorted.NotSorted:
                    dtClone.DefaultView.Sort = sf.Field + " ASC";
                    sf.Sorted = EnumSorted.SortedAsc;
                    break;
                case EnumSorted.SortedDesc:
                    dtClone.DefaultView.Sort = sf.Field + " ASC";
                    sf.Sorted = EnumSorted.SortedAsc;
                    break;
                case EnumSorted.SortedAsc:
                    dtClone.DefaultView.Sort = sf.Field + " DESC";
                    sf.Sorted = EnumSorted.SortedDesc;
                    break;
            }

            DataTable dtCloneSorted = dtClone.Clone();
            dtCloneSorted = dtClone.DefaultView.ToTable();

            foreach (DataRow row in dtCloneSorted.Rows)
            {
                DataRow rowSorted = dtSorted.NewRow();
                dtSorted.Rows.Add(rowSorted);
            }

            for (int i = 0; i < dtCloneSorted.Rows.Count; i++)
            {
                dtSorted.Rows[i]["INCD"] = dtCloneSorted.Rows[i]["INCD"];
                dtSorted.Rows[i]["회원 이름"] = dtCloneSorted.Rows[i]["회원 이름"];
                dtSorted.Rows[i]["MED_BILL"] = dtCloneSorted.Rows[i]["MED_BILL"];
                dtSorted.Rows[i]["서비스 날짜"] = DateTime.Parse(dtCloneSorted.Rows[i]["서비스 날짜"].ToString()).ToString("MM/dd/yyyy");
                //if (dtCloneSorted.Rows[i]["접수 날짜"].ToString() != String.Empty)
                //{
                //    dtSorted.Rows[i]["접수 날짜"] = DateTime.Parse(dtCloneSorted.Rows[i]["접수 날짜"].ToString()).ToString("MM/dd/yyyy");
                //}
                //else dtSorted.Rows[i]["접수 날짜"] = DBNull.Value;
                dtSorted.Rows[i]["의료기관명"] = dtCloneSorted.Rows[i]["의료기관명"];
                dtSorted.Rows[i]["청구액(원금)"] = dtCloneSorted.Rows[i]["청구액(원금)"];
                dtSorted.Rows[i]["회원할인"] = dtCloneSorted.Rows[i]["회원할인"];
                dtSorted.Rows[i]["CMM 할인"] = dtCloneSorted.Rows[i]["CMM 할인"];
                dtSorted.Rows[i]["본인 부담금"] = dtCloneSorted.Rows[i]["본인 부담금"];
                dtSorted.Rows[i]["정산 완료"] = dtCloneSorted.Rows[i]["정산 완료"];
                dtSorted.Rows[i]["지원 예정"] = dtCloneSorted.Rows[i]["지원 예정"];
            }

            DataRow drCMMPendingPaymentSumNew = dtSorted.NewRow();

            List<CMMPendingPaymentBlueSheet> lstCMMPendingPayment = new List<CMMPendingPaymentBlueSheet>();

            foreach (DataRow row in dtSorted.Rows)
            {
                //lstCMMPendingPayment.Add(new CMMPendingPayment(Double.Parse(row[5].ToString().Substring(1)),
                //                                               Double.Parse(row[6].ToString().Substring(1)),
                //                                               Double.Parse(row[7].ToString().Substring(1)),
                //                                               Double.Parse(row[8].ToString().Substring(1)),
                //                                               Double.Parse(row[9].ToString().Substring(1)),
                //                                               Double.Parse(row[10].ToString().Substring(1))));

                CMMPendingPaymentBlueSheet cmm_pending_payment = new CMMPendingPaymentBlueSheet();
                cmm_pending_payment.BillAmount = Double.Parse(row[5].ToString().Substring(1));
                cmm_pending_payment.MemberDiscount = Double.Parse(row[6].ToString().Substring(1));
                cmm_pending_payment.CMMDiscount = Double.Parse(row[7].ToString().Substring(1));
                cmm_pending_payment.PersonalResponsibility = Double.Parse(row[8].ToString().Substring(1));
                cmm_pending_payment.SharedAmount = Double.Parse(row[9].ToString().Substring(1));
                cmm_pending_payment.AmountWillBeShared = Double.Parse(row[10].ToString().Substring(1));

                lstCMMPendingPayment.Add(cmm_pending_payment);
            }

            drCMMPendingPaymentSumNew["INCD"] = String.Empty;
            drCMMPendingPaymentSumNew["MED_BILL"] = String.Empty;
            drCMMPendingPaymentSumNew["의료기관명"] = "합계";

            CMMPendingPaymentBlueSheet sumCMMPendingPayment = new CMMPendingPaymentBlueSheet();

            foreach (CMMPendingPaymentBlueSheet cmm_pending in lstCMMPendingPayment)
            {
                sumCMMPendingPayment.BillAmount += cmm_pending.BillAmount;
                sumCMMPendingPayment.MemberDiscount += cmm_pending.MemberDiscount;
                sumCMMPendingPayment.CMMDiscount += cmm_pending.CMMDiscount;
                sumCMMPendingPayment.PersonalResponsibility += cmm_pending.PersonalResponsibility;
                sumCMMPendingPayment.SharedAmount += cmm_pending.SharedAmount;
                sumCMMPendingPayment.AmountWillBeShared += cmm_pending.AmountWillBeShared;
            }

            drCMMPendingPaymentSumNew["청구액(원금)"] = sumCMMPendingPayment.BillAmount.Value.ToString("C");
            drCMMPendingPaymentSumNew["회원할인"] = sumCMMPendingPayment.MemberDiscount.Value.ToString("C");
            drCMMPendingPaymentSumNew["CMM 할인"] = sumCMMPendingPayment.CMMDiscount.Value.ToString("C");
            drCMMPendingPaymentSumNew["본인 부담금"] = sumCMMPendingPayment.PersonalResponsibility.Value.ToString("C");
            drCMMPendingPaymentSumNew["정산 완료"] = sumCMMPendingPayment.SharedAmount.Value.ToString("C");
            drCMMPendingPaymentSumNew["지원 예정"] = sumCMMPendingPayment.AmountWillBeShared.Value.ToString("C");

            dtSorted.Rows.Add(drCMMPendingPaymentSumNew);
            gvCMMPendingPaymentBlueSheet.DataSource = dtSorted;
        }

        private void gvCMMPendingPaymentBlueSheet_ColumnHeaderMouseClick(object sender, DataGridViewCellMouseEventArgs e)
        {
            switch (e.ColumnIndex)
            {
                case 0:
                    if (cmmPendingPaymentSortedFieldBlueSheet.Field != "INCD")
                    {
                        cmmPendingPaymentSortedFieldBlueSheet.Field = "INCD";
                        cmmPendingPaymentSortedFieldBlueSheet.Sorted = EnumSorted.NotSorted;
                    }
                    SortCMMPendingPaymentTable(cmmPendingPaymentSortedFieldBlueSheet);
                    break;
                case 1:
                    if (cmmPendingPaymentSortedFieldBlueSheet.Field != "회원 이름")
                    {
                        cmmPendingPaymentSortedFieldBlueSheet.Field = "회원 이름";
                        cmmPendingPaymentSortedFieldBlueSheet.Sorted = EnumSorted.NotSorted;
                    }
                    SortCMMPendingPaymentTable(cmmPendingPaymentSortedFieldBlueSheet);
                    break;
                case 2:
                    if (cmmPendingPaymentSortedFieldBlueSheet.Field != "MED_BILL")
                    {
                        cmmPendingPaymentSortedFieldBlueSheet.Field = "MED_BILL";
                        cmmPendingPaymentSortedFieldBlueSheet.Sorted = EnumSorted.NotSorted;
                    }
                    SortCMMPendingPaymentTable(cmmPendingPaymentSortedFieldBlueSheet);
                    break;
                case 3:
                    if (cmmPendingPaymentSortedFieldBlueSheet.Field != "서비스 날짜")
                    {
                        cmmPendingPaymentSortedFieldBlueSheet.Field = "서비스 날짜";
                        cmmPendingPaymentSortedFieldBlueSheet.Sorted = EnumSorted.NotSorted;
                    }
                    SortCMMPendingPaymentTable(cmmPendingPaymentSortedFieldBlueSheet);
                    break;
                case 4:
                    if (cmmPendingPaymentSortedFieldBlueSheet.Field != "의료기관명")
                    {
                        cmmPendingPaymentSortedFieldBlueSheet.Field = "의료기관명";
                        cmmPendingPaymentSortedFieldBlueSheet.Sorted = EnumSorted.NotSorted;
                    }
                    SortCMMPendingPaymentTable(cmmPendingPaymentSortedFieldBlueSheet);
                    break;
            }
        }

        private void SortCMMPendingPaymentTableInTab(SortedFieldBlueSheet sf)
        {
            DataTable dtCMMPendingPaymentWithSum = (DataTable)gvCMMPendingPaymentInTab.DataSource;

            DataTable dtSorted = dtCMMPendingPaymentWithSum.Clone();

            DataTable dtClone = new DataTable();
            dtClone.Columns.Add("INCD", typeof(String));
            dtClone.Columns.Add("회원 이름", typeof(String));
            dtClone.Columns.Add("MED_BILL", typeof(String));
            dtClone.Columns.Add("서비스 날짜", typeof(DateTime));
            //dtClone.Columns.Add("접수 날짜", typeof(DateTime));
            dtClone.Columns.Add("의료기관명", typeof(String));
            dtClone.Columns.Add("청구액(원금)", typeof(String));
            dtClone.Columns.Add("회원할인", typeof(String));
            dtClone.Columns.Add("CMM 할인", typeof(String));
            dtClone.Columns.Add("본인 부담금", typeof(String));
            dtClone.Columns.Add("정산 완료", typeof(String));
            dtClone.Columns.Add("지원 예정", typeof(String));

            dtCMMPendingPaymentWithSum.Rows.RemoveAt(dtCMMPendingPaymentWithSum.Rows.Count - 1);

            foreach (DataRow row in dtCMMPendingPaymentWithSum.Rows)
            {
                DataRow rowClone = dtClone.NewRow();
                dtClone.Rows.Add(rowClone);
            }

            for (int i = 0; i < dtCMMPendingPaymentWithSum.Rows.Count; i++)
            {
                dtClone.Rows[i]["INCD"] = dtCMMPendingPaymentWithSum.Rows[i]["INCD"];
                dtClone.Rows[i]["회원 이름"] = dtCMMPendingPaymentWithSum.Rows[i]["회원 이름"];
                dtClone.Rows[i]["MED_BILL"] = dtCMMPendingPaymentWithSum.Rows[i]["MED_BILL"];
                dtClone.Rows[i]["서비스 날짜"] = DateTime.Parse(dtCMMPendingPaymentWithSum.Rows[i]["서비스 날짜"].ToString());
                //if (dtCMMPendingPaymentWithSum.Rows[i]["접수 날짜"].ToString() != String.Empty)
                //{
                //    dtClone.Rows[i]["접수 날짜"] = DateTime.Parse(dtCMMPendingPaymentWithSum.Rows[i]["접수 날짜"].ToString());
                //}
                //else dtClone.Rows[i]["접수 날짜"] = DBNull.Value;
                dtClone.Rows[i]["의료기관명"] = dtCMMPendingPaymentWithSum.Rows[i]["의료기관명"];
                dtClone.Rows[i]["청구액(원금)"] = dtCMMPendingPaymentWithSum.Rows[i]["청구액(원금)"];
                dtClone.Rows[i]["회원할인"] = dtCMMPendingPaymentWithSum.Rows[i]["회원할인"];
                dtClone.Rows[i]["CMM 할인"] = dtCMMPendingPaymentWithSum.Rows[i]["CMM 할인"];
                dtClone.Rows[i]["본인 부담금"] = dtCMMPendingPaymentWithSum.Rows[i]["본인 부담금"];
                dtClone.Rows[i]["정산 완료"] = dtCMMPendingPaymentWithSum.Rows[i]["정산 완료"];
                dtClone.Rows[i]["지원 예정"] = dtCMMPendingPaymentWithSum.Rows[i]["지원 예정"];
            }

            switch (sf.Sorted)
            {
                case EnumSorted.NotSorted:
                    dtClone.DefaultView.Sort = sf.Field + " ASC";
                    sf.Sorted = EnumSorted.SortedAsc;
                    break;
                case EnumSorted.SortedDesc:
                    dtClone.DefaultView.Sort = sf.Field + " ASC";
                    sf.Sorted = EnumSorted.SortedAsc;
                    break;
                case EnumSorted.SortedAsc:
                    dtClone.DefaultView.Sort = sf.Field + " DESC";
                    sf.Sorted = EnumSorted.SortedDesc;
                    break;
            }

            DataTable dtCloneSorted = dtClone.Clone();
            dtCloneSorted = dtClone.DefaultView.ToTable();

            foreach (DataRow row in dtCloneSorted.Rows)
            {
                DataRow rowSorted = dtSorted.NewRow();
                dtSorted.Rows.Add(rowSorted);
            }

            for (int i = 0; i < dtCloneSorted.Rows.Count; i++)
            {
                dtSorted.Rows[i]["INCD"] = dtCloneSorted.Rows[i]["INCD"];
                dtSorted.Rows[i]["회원 이름"] = dtCloneSorted.Rows[i]["회원 이름"];
                dtSorted.Rows[i]["MED_BILL"] = dtCloneSorted.Rows[i]["MED_BILL"];
                dtSorted.Rows[i]["서비스 날짜"] = DateTime.Parse(dtCloneSorted.Rows[i]["서비스 날짜"].ToString()).ToString("MM/dd/yyyy");
                //if (dtCloneSorted.Rows[i]["접수 날짜"].ToString() != String.Empty)
                //{
                //    dtSorted.Rows[i]["접수 날짜"] = DateTime.Parse(dtCloneSorted.Rows[i]["접수 날짜"].ToString()).ToString("MM/dd/yyyy");
                //}
                //else dtSorted.Rows[i]["접수 날짜"] = DBNull.Value;
                dtSorted.Rows[i]["의료기관명"] = dtCloneSorted.Rows[i]["의료기관명"];
                dtSorted.Rows[i]["청구액(원금)"] = dtCloneSorted.Rows[i]["청구액(원금)"];
                dtSorted.Rows[i]["회원할인"] = dtCloneSorted.Rows[i]["회원할인"];
                dtSorted.Rows[i]["CMM 할인"] = dtCloneSorted.Rows[i]["CMM 할인"];
                dtSorted.Rows[i]["본인 부담금"] = dtCloneSorted.Rows[i]["본인 부담금"];
                dtSorted.Rows[i]["정산 완료"] = dtCloneSorted.Rows[i]["정산 완료"];
                dtSorted.Rows[i]["지원 예정"] = dtCloneSorted.Rows[i]["지원 예정"];
            }

            DataRow drCMMPendingPaymentSumNew = dtSorted.NewRow();

            List<CMMPendingPaymentBlueSheet> lstCMMPendingPayment = new List<CMMPendingPaymentBlueSheet>();

            foreach (DataRow row in dtSorted.Rows)
            {
                //lstCMMPendingPayment.Add(new CMMPendingPayment(Double.Parse(row[5].ToString().Substring(1)),
                //                                               Double.Parse(row[6].ToString().Substring(1)),
                //                                               Double.Parse(row[7].ToString().Substring(1)),
                //                                               Double.Parse(row[8].ToString().Substring(1)),
                //                                               Double.Parse(row[9].ToString().Substring(1)),
                //                                               Double.Parse(row[10].ToString().Substring(1))));

                CMMPendingPaymentBlueSheet cmm_pending_payment = new CMMPendingPaymentBlueSheet();
                cmm_pending_payment.BillAmount = Double.Parse(row[5].ToString().Substring(1));
                cmm_pending_payment.MemberDiscount = Double.Parse(row[6].ToString().Substring(1));
                cmm_pending_payment.CMMDiscount = Double.Parse(row[7].ToString().Substring(1));
                cmm_pending_payment.PersonalResponsibility = Double.Parse(row[8].ToString().Substring(1));
                cmm_pending_payment.SharedAmount = Double.Parse(row[9].ToString().Substring(1));
                cmm_pending_payment.AmountWillBeShared = Double.Parse(row[10].ToString().Substring(1));

                lstCMMPendingPayment.Add(cmm_pending_payment);
            }

            drCMMPendingPaymentSumNew["INCD"] = String.Empty;
            drCMMPendingPaymentSumNew["MED_BILL"] = String.Empty;
            drCMMPendingPaymentSumNew["의료기관명"] = "합계";

            CMMPendingPaymentBlueSheet sumCMMPendingPayment = new CMMPendingPaymentBlueSheet();

            foreach (CMMPendingPaymentBlueSheet cmm_pending in lstCMMPendingPayment)
            {
                sumCMMPendingPayment.BillAmount += cmm_pending.BillAmount;
                sumCMMPendingPayment.MemberDiscount += cmm_pending.MemberDiscount;
                sumCMMPendingPayment.CMMDiscount += cmm_pending.CMMDiscount;
                sumCMMPendingPayment.PersonalResponsibility += cmm_pending.PersonalResponsibility;
                sumCMMPendingPayment.SharedAmount += cmm_pending.SharedAmount;
                sumCMMPendingPayment.AmountWillBeShared += cmm_pending.AmountWillBeShared;
            }

            drCMMPendingPaymentSumNew["청구액(원금)"] = sumCMMPendingPayment.BillAmount.Value.ToString("C");
            drCMMPendingPaymentSumNew["회원할인"] = sumCMMPendingPayment.MemberDiscount.Value.ToString("C");
            drCMMPendingPaymentSumNew["CMM 할인"] = sumCMMPendingPayment.CMMDiscount.Value.ToString("C");
            drCMMPendingPaymentSumNew["본인 부담금"] = sumCMMPendingPayment.PersonalResponsibility.Value.ToString("C");
            drCMMPendingPaymentSumNew["정산 완료"] = sumCMMPendingPayment.SharedAmount.Value.ToString("C");
            drCMMPendingPaymentSumNew["지원 예정"] = sumCMMPendingPayment.AmountWillBeShared.Value.ToString("C");

            dtSorted.Rows.Add(drCMMPendingPaymentSumNew);
            gvCMMPendingPaymentInTab.DataSource = dtSorted;
        }

        private void gvCMMPendingPaymentInTab_ColumnHeaderMouseClick(object sender, DataGridViewCellMouseEventArgs e)
        {
            switch (e.ColumnIndex)
            {
                case 0:
                    if (cmmCMMPendingPaymentInTabSortedFieldBlueSheet.Field != "INCD")
                    {
                        cmmCMMPendingPaymentInTabSortedFieldBlueSheet.Field = "INCD";
                        cmmCMMPendingPaymentInTabSortedFieldBlueSheet.Sorted = EnumSorted.NotSorted;
                    }
                    SortCMMPendingPaymentTableInTab(cmmCMMPendingPaymentInTabSortedFieldBlueSheet);
                    break;
                case 1:
                    if (cmmCMMPendingPaymentInTabSortedFieldBlueSheet.Field != "회원 이름")
                    {
                        cmmCMMPendingPaymentInTabSortedFieldBlueSheet.Field = "회원 이름";
                        cmmCMMPendingPaymentInTabSortedFieldBlueSheet.Sorted = EnumSorted.NotSorted;
                    }
                    SortCMMPendingPaymentTableInTab(cmmCMMPendingPaymentInTabSortedFieldBlueSheet);
                    break;
                case 2:
                    if (cmmCMMPendingPaymentInTabSortedFieldBlueSheet.Field != "MED_BILL")
                    {
                        cmmCMMPendingPaymentInTabSortedFieldBlueSheet.Field = "MED_BILL";
                        cmmCMMPendingPaymentInTabSortedFieldBlueSheet.Sorted = EnumSorted.NotSorted;
                    }
                    SortCMMPendingPaymentTableInTab(cmmCMMPendingPaymentInTabSortedFieldBlueSheet);
                    break;
                case 3:
                    if (cmmCMMPendingPaymentInTabSortedFieldBlueSheet.Field != "서비스 날짜")
                    {
                        cmmCMMPendingPaymentInTabSortedFieldBlueSheet.Field = "서비스 날짜";
                        cmmCMMPendingPaymentInTabSortedFieldBlueSheet.Sorted = EnumSorted.NotSorted;
                    }
                    SortCMMPendingPaymentTableInTab(cmmCMMPendingPaymentInTabSortedFieldBlueSheet);
                    break;
                case 4:
                    if (cmmCMMPendingPaymentInTabSortedFieldBlueSheet.Field != "의료기관명")
                    {
                        cmmCMMPendingPaymentInTabSortedFieldBlueSheet.Field = "의료기관명";
                        cmmCMMPendingPaymentInTabSortedFieldBlueSheet.Sorted = EnumSorted.NotSorted;
                    }
                    SortCMMPendingPaymentTableInTab(cmmCMMPendingPaymentInTabSortedFieldBlueSheet);
                    break;
            }
        }

        private void SortPendingTable(SortedFieldBlueSheet sf)
        {
            DataTable dtPendingWithSum = (DataTable)gvPendingBlueSheet.DataSource;

            DataTable dtSorted = dtPendingWithSum.Clone();

            DataTable dtClone = new DataTable();

            dtClone.Columns.Add("INCD", typeof(String));
            dtClone.Columns.Add("회원 이름", typeof(String));
            dtClone.Columns.Add("MED_BILL", typeof(String));
            dtClone.Columns.Add("서비스 날짜", typeof(DateTime));
            dtClone.Columns.Add("접수 날짜", typeof(DateTime));
            dtClone.Columns.Add("의료기관명", typeof(String));
            dtClone.Columns.Add("청구액(원금)", typeof(String));
            //dtClone.Columns.Add("회원 할인", typeof(String));
            //dtClone.Columns.Add("CMM 할인", typeof(String));
            //dtClone.Columns.Add("정산 완료", typeof(String));
            dtClone.Columns.Add("잔액/보류", typeof(String));
            dtClone.Columns.Add("보류 사유", typeof(String));

            dtPendingWithSum.Rows.RemoveAt(dtPendingWithSum.Rows.Count - 1);

            foreach (DataRow row in dtPendingWithSum.Rows)
            {
                DataRow rowClone = dtClone.NewRow();
                dtClone.Rows.Add(rowClone);
            }

            for (int i = 0; i < dtPendingWithSum.Rows.Count; i++)
            {
                dtClone.Rows[i]["INCD"] = dtPendingWithSum.Rows[i]["INCD"];
                dtClone.Rows[i]["회원 이름"] = dtPendingWithSum.Rows[i]["회원 이름"];
                dtClone.Rows[i]["MED_BILL"] = dtPendingWithSum.Rows[i]["MED_BILL"];
                dtClone.Rows[i]["서비스 날짜"] = DateTime.Parse(dtPendingWithSum.Rows[i]["서비스 날짜"].ToString());
                if (dtPendingWithSum.Rows[i]["접수 날짜"].ToString() != String.Empty)
                {
                    dtClone.Rows[i]["접수 날짜"] = DateTime.Parse(dtPendingWithSum.Rows[i]["접수 날짜"].ToString());
                }
                else dtClone.Rows[i]["접수 날짜"] = DBNull.Value;
                dtClone.Rows[i]["의료기관명"] = dtPendingWithSum.Rows[i]["의료기관명"];
                dtClone.Rows[i]["청구액(원금)"] = dtPendingWithSum.Rows[i]["청구액(원금)"];
                //dtClone.Rows[i]["회원 할인"] = dtPendingWithSum.Rows[i]["회원 할인"];
                //dtClone.Rows[i]["CMM 할인"] = dtPendingWithSum.Rows[i]["CMM 할인"];
                //dtClone.Rows[i]["정산 완료"] = dtPendingWithSum.Rows[i]["정산 완료"];
                dtClone.Rows[i]["잔액/보류"] = dtPendingWithSum.Rows[i]["잔액/보류"];
                dtClone.Rows[i]["보류 사유"] = dtPendingWithSum.Rows[i]["보류 사유"];
            }

            switch (sf.Sorted)
            {
                case EnumSorted.NotSorted:
                    dtClone.DefaultView.Sort = sf.Field + " ASC";
                    sf.Sorted = EnumSorted.SortedAsc;
                    break;
                case EnumSorted.SortedDesc:
                    dtClone.DefaultView.Sort = sf.Field + " ASC";
                    sf.Sorted = EnumSorted.SortedAsc;
                    break;
                case EnumSorted.SortedAsc:
                    dtClone.DefaultView.Sort = sf.Field + " DESC";
                    sf.Sorted = EnumSorted.SortedDesc;
                    break;
            }

            DataTable dtCloneSorted = dtClone.Clone();
            dtCloneSorted = dtClone.DefaultView.ToTable();

            foreach (DataRow row in dtCloneSorted.Rows)
            {
                DataRow rowSorted = dtSorted.NewRow();
                dtSorted.Rows.Add(rowSorted);
            }

            for (int i = 0; i < dtCloneSorted.Rows.Count; i++)
            {
                dtSorted.Rows[i]["INCD"] = dtCloneSorted.Rows[i]["INCD"];
                dtSorted.Rows[i]["회원 이름"] = dtCloneSorted.Rows[i]["회원 이름"];
                dtSorted.Rows[i]["MED_BILL"] = dtCloneSorted.Rows[i]["MED_BILL"];
                dtSorted.Rows[i]["서비스 날짜"] = DateTime.Parse(dtCloneSorted.Rows[i]["서비스 날짜"].ToString()).ToString("MM/dd/yyyy");
                if (dtCloneSorted.Rows[i]["접수 날짜"].ToString() != String.Empty)
                {
                    dtSorted.Rows[i]["접수 날짜"] = DateTime.Parse(dtCloneSorted.Rows[i]["접수 날짜"].ToString()).ToString("MM/dd/yyyy");
                }
                else dtSorted.Rows[i]["접수 날짜"] = DBNull.Value;
                dtSorted.Rows[i]["의료기관명"] = dtCloneSorted.Rows[i]["의료기관명"];
                dtSorted.Rows[i]["청구액(원금)"] = dtCloneSorted.Rows[i]["청구액(원금)"];
                dtSorted.Rows[i]["잔액/보류"] = dtCloneSorted.Rows[i]["잔액/보류"];
                //dtSorted.Rows[i]["회원 할인"] = dtCloneSorted.Rows[i]["회원 할인"];
                //dtSorted.Rows[i]["CMM 할인"] = dtCloneSorted.Rows[i]["CMM 할인"];
                //dtSorted.Rows[i]["정산 완료"] = dtCloneSorted.Rows[i]["정산 완료"];
                //dtSorted.Rows[i]["보류"] = dtCloneSorted.Rows[i]["보류"];
                dtSorted.Rows[i]["보류 사유"] = dtCloneSorted.Rows[i]["보류 사유"];
            }

            //dtSorted = dtPendingWithSum.DefaultView.ToTable();
            DataRow drPendingSumNew = dtSorted.NewRow();
            List<PendingBlueSheet> lstPending = new List<PendingBlueSheet>();

            foreach (DataRow row in dtSorted.Rows)
            {
                //lstPending.Add(new Pending(Double.Parse(row[6].ToString().Substring(1)),
                //                           Double.Parse(row[7].ToString().Substring(1)), 0, 0, 0, 0));
                PendingBlueSheet pending = new PendingBlueSheet();
                pending.BillAmount = Double.Parse(row[6].ToString().Substring(1));
                pending.Balance = Double.Parse(row[7].ToString().Substring(1));
                pending.MemberDiscount = 0;
                pending.CMMDiscount = 0;
                pending.SharedAmount = 0;
                pending.PendingAmount = 0;

                lstPending.Add(pending);
            }

            drPendingSumNew["INCD"] = String.Empty;
            drPendingSumNew["MED_BILL"] = String.Empty;
            //drPendingSumNew["서비스 날짜"] = String.Empty;
            //drPendingSumNew["접수 날짜"] = String.Empty;
            drPendingSumNew["의료기관명"] = "합계";
            drPendingSumNew["보류 사유"] = String.Empty;

            PendingBlueSheet sumPending = new PendingBlueSheet ();
            foreach (PendingBlueSheet pending in lstPending)
            {
                sumPending.BillAmount += pending.BillAmount;
                sumPending.Balance += pending.Balance;
                //sumPending.MemberDiscount += pending.MemberDiscount;
                //sumPending.CMMDiscount += pending.CMMDiscount;
                //sumPending.SharedAmount += pending.SharedAmount;
                //sumPending.PendingAmount += pending.PendingAmount;
            }

            drPendingSumNew["청구액(원금)"] = sumPending.BillAmount.Value.ToString("C");
            //drPendingSumNew["회원 할인"] = sumPending.MemberDiscount.Value.ToString("C");
            //drPendingSumNew["CMM 할인"] = sumPending.CMMDiscount.Value.ToString("C");
            //drPendingSumNew["정산 완료"] = sumPending.SharedAmount.Value.ToString("C");
            //drPendingSumNew["잔액/보류"] = sumPending.PendingAmount.Value.ToString("C");
            drPendingSumNew["잔액/보류"] = sumPending.Balance.Value.ToString("C");

            dtSorted.Rows.Add(drPendingSumNew);
            gvPendingBlueSheet.DataSource = dtSorted;
        }

        private void gvPendingBlueSheet_ColumnHeaderMouseClick(object sender, DataGridViewCellMouseEventArgs e)
        {
            switch (e.ColumnIndex)
            {
                case 0:
                    if (pendingSortedFieldBlueSheet.Field != "INCD")
                    {
                        pendingSortedFieldBlueSheet.Field = "INCD";
                        pendingSortedFieldBlueSheet.Sorted = EnumSorted.NotSorted;
                    }
                    SortPendingTable(pendingSortedFieldBlueSheet);
                    break;
                case 1:
                    if (pendingSortedFieldBlueSheet.Field != "회원 이름")
                    {
                        pendingSortedFieldBlueSheet.Field = "회원 이름";
                        pendingSortedFieldBlueSheet.Sorted = EnumSorted.NotSorted;
                    }
                    SortPendingTable(pendingSortedFieldBlueSheet);
                    break;
                case 2:
                    if (pendingSortedFieldBlueSheet.Field != "MED_BILL")
                    {
                        pendingSortedFieldBlueSheet.Field = "MED_BILL";
                        pendingSortedFieldBlueSheet.Sorted = EnumSorted.NotSorted;
                    }
                    SortPendingTable(pendingSortedFieldBlueSheet);
                    break;
                case 3:
                    if (pendingSortedFieldBlueSheet.Field != "서비스 날짜")
                    {
                        pendingSortedFieldBlueSheet.Field = "서비스 날짜";
                        pendingSortedFieldBlueSheet.Sorted = EnumSorted.NotSorted;
                    }
                    SortPendingTable(pendingSortedFieldBlueSheet);
                    break;
                //case 4:
                //    if (pendingSortedField.Field != "접수 날짜")
                //    {
                //        pendingSortedField.Field = "접수 날짜";
                //        pendingSortedField.Sorted = SortedField.EnumSorted.NotSorted;
                //    }
                //    SortPendingTable(pendingSortedField);
                //    break;
                case 5:
                    if (pendingSortedFieldBlueSheet.Field != "의료기관명")
                    {
                        pendingSortedFieldBlueSheet.Field = "의료기관명";
                        pendingSortedFieldBlueSheet.Sorted = EnumSorted.NotSorted;
                    }
                    SortPendingTable(pendingSortedFieldBlueSheet);
                    break;
                case 8:
                    if (pendingSortedFieldBlueSheet.Field != "보류 사유")
                    {
                        pendingSortedFieldBlueSheet.Field = "보류 사유";
                        pendingSortedFieldBlueSheet.Sorted = EnumSorted.NotSorted;
                    }
                    SortPendingTable(pendingSortedFieldBlueSheet);
                    break;
            }
        }

        private void SortPendingTableInTab(SortedFieldBlueSheet sf)
        {
            DataTable dtPendingWithSum = (DataTable)gvPendingInTab.DataSource;

            DataTable dtSorted = dtPendingWithSum.Clone();

            DataTable dtClone = new DataTable();

            dtClone.Columns.Add("INCD", typeof(String));
            dtClone.Columns.Add("회원 이름", typeof(String));
            dtClone.Columns.Add("MED_BILL", typeof(String));
            dtClone.Columns.Add("서비스 날짜", typeof(DateTime));
            dtClone.Columns.Add("접수 날짜", typeof(DateTime));
            dtClone.Columns.Add("의료기관명", typeof(String));
            dtClone.Columns.Add("청구액(원금)", typeof(String));
            //dtClone.Columns.Add("회원 할인", typeof(String));
            //dtClone.Columns.Add("CMM 할인", typeof(String));
            //dtClone.Columns.Add("정산 완료", typeof(String));
            dtClone.Columns.Add("잔액/보류", typeof(String));
            dtClone.Columns.Add("보류 사유", typeof(String));

            dtPendingWithSum.Rows.RemoveAt(dtPendingWithSum.Rows.Count - 1);

            foreach (DataRow row in dtPendingWithSum.Rows)
            {
                DataRow rowClone = dtClone.NewRow();
                dtClone.Rows.Add(rowClone);
            }

            for (int i = 0; i < dtPendingWithSum.Rows.Count; i++)
            {
                dtClone.Rows[i]["INCD"] = dtPendingWithSum.Rows[i]["INCD"];
                dtClone.Rows[i]["회원 이름"] = dtPendingWithSum.Rows[i]["회원 이름"];
                dtClone.Rows[i]["MED_BILL"] = dtPendingWithSum.Rows[i]["MED_BILL"];
                dtClone.Rows[i]["서비스 날짜"] = DateTime.Parse(dtPendingWithSum.Rows[i]["서비스 날짜"].ToString());
                if (dtPendingWithSum.Rows[i]["접수 날짜"].ToString() != String.Empty)
                {
                    dtClone.Rows[i]["접수 날짜"] = DateTime.Parse(dtPendingWithSum.Rows[i]["접수 날짜"].ToString());
                }
                else dtClone.Rows[i]["접수 날짜"] = DBNull.Value;
                dtClone.Rows[i]["의료기관명"] = dtPendingWithSum.Rows[i]["의료기관명"];
                dtClone.Rows[i]["청구액(원금)"] = dtPendingWithSum.Rows[i]["청구액(원금)"];
                //dtClone.Rows[i]["회원 할인"] = dtPendingWithSum.Rows[i]["회원 할인"];
                //dtClone.Rows[i]["CMM 할인"] = dtPendingWithSum.Rows[i]["CMM 할인"];
                //dtClone.Rows[i]["정산 완료"] = dtPendingWithSum.Rows[i]["정산 완료"];
                dtClone.Rows[i]["잔액/보류"] = dtPendingWithSum.Rows[i]["잔액/보류"];
                dtClone.Rows[i]["보류 사유"] = dtPendingWithSum.Rows[i]["보류 사유"];
            }

            switch (sf.Sorted)
            {
                case EnumSorted.NotSorted:
                    dtClone.DefaultView.Sort = sf.Field + " ASC";
                    sf.Sorted = EnumSorted.SortedAsc;
                    break;
                case EnumSorted.SortedDesc:
                    dtClone.DefaultView.Sort = sf.Field + " ASC";
                    sf.Sorted = EnumSorted.SortedAsc;
                    break;
                case EnumSorted.SortedAsc:
                    dtClone.DefaultView.Sort = sf.Field + " DESC";
                    sf.Sorted = EnumSorted.SortedDesc;
                    break;
            }

            DataTable dtCloneSorted = dtClone.Clone();
            dtCloneSorted = dtClone.DefaultView.ToTable();

            foreach (DataRow row in dtCloneSorted.Rows)
            {
                DataRow rowSorted = dtSorted.NewRow();
                dtSorted.Rows.Add(rowSorted);
            }

            for (int i = 0; i < dtCloneSorted.Rows.Count; i++)
            {
                dtSorted.Rows[i]["INCD"] = dtCloneSorted.Rows[i]["INCD"];
                dtSorted.Rows[i]["회원 이름"] = dtCloneSorted.Rows[i]["회원 이름"];
                dtSorted.Rows[i]["MED_BILL"] = dtCloneSorted.Rows[i]["MED_BILL"];
                dtSorted.Rows[i]["서비스 날짜"] = DateTime.Parse(dtCloneSorted.Rows[i]["서비스 날짜"].ToString()).ToString("MM/dd/yyyy");
                if (dtCloneSorted.Rows[i]["접수 날짜"].ToString() != String.Empty)
                {
                    dtSorted.Rows[i]["접수 날짜"] = DateTime.Parse(dtCloneSorted.Rows[i]["접수 날짜"].ToString()).ToString("MM/dd/yyyy");
                }
                else dtSorted.Rows[i]["접수 날짜"] = DBNull.Value;
                dtSorted.Rows[i]["의료기관명"] = dtCloneSorted.Rows[i]["의료기관명"];
                dtSorted.Rows[i]["청구액(원금)"] = dtCloneSorted.Rows[i]["청구액(원금)"];
                //dtSorted.Rows[i]["회원 할인"] = dtCloneSorted.Rows[i]["회원 할인"];
                //dtSorted.Rows[i]["CMM 할인"] = dtCloneSorted.Rows[i]["CMM 할인"];
                //dtSorted.Rows[i]["정산 완료"] = dtCloneSorted.Rows[i]["정산 완료"];
                dtSorted.Rows[i]["잔액/보류"] = dtCloneSorted.Rows[i]["잔액/보류"];
                dtSorted.Rows[i]["보류 사유"] = dtCloneSorted.Rows[i]["보류 사유"];
            }

            //dtSorted = dtPendingWithSum.DefaultView.ToTable();
            DataRow drPendingSumNew = dtSorted.NewRow();
            List<PendingBlueSheet> lstPending = new List<PendingBlueSheet>();

            foreach (DataRow row in dtSorted.Rows)
            {

                //lstPending.Add(new Pending(Double.Parse(row[6].ToString().Substring(1)),
                //                           Double.Parse(row[7].ToString().Substring(1)), 0, 0, 0, 0));

                PendingBlueSheet pending = new PendingBlueSheet();
                pending.BillAmount = Double.Parse(row[6].ToString().Substring(1));
                pending.Balance = Double.Parse(row[7].ToString().Substring(1));
                pending.MemberDiscount = 0;
                pending.CMMDiscount = 0;
                pending.SharedAmount = 0;
                pending.PendingAmount = 0;

                lstPending.Add(pending);
            }

            drPendingSumNew["INCD"] = String.Empty;
            drPendingSumNew["MED_BILL"] = String.Empty;
            //drPendingSumNew["서비스 날짜"] = String.Empty;
            //drPendingSumNew["접수 날짜"] = String.Empty;
            drPendingSumNew["의료기관명"] = "합계";
            drPendingSumNew["보류 사유"] = String.Empty;

            PendingBlueSheet sumPending = new PendingBlueSheet();
            foreach (PendingBlueSheet pending in lstPending)
            {
                sumPending.BillAmount += pending.BillAmount;
                sumPending.Balance += pending.Balance;
                //sumPending.MemberDiscount += pending.MemberDiscount;
                //sumPending.CMMDiscount += pending.CMMDiscount;
                //sumPending.SharedAmount += pending.SharedAmount;
                //sumPending.PendingAmount += pending.PendingAmount;
            }

            drPendingSumNew["청구액(원금)"] = sumPending.BillAmount.Value.ToString("C");
            drPendingSumNew["잔액/보류"] = sumPending.Balance.Value.ToString("C");
            //drPendingSumNew["회원 할인"] = sumPending.MemberDiscount.Value.ToString("C");
            //drPendingSumNew["CMM 할인"] = sumPending.CMMDiscount.Value.ToString("C");
            //drPendingSumNew["정산 완료"] = sumPending.SharedAmount.Value.ToString("C");
            //drPendingSumNew["잔액/보류"] = sumPending.PendingAmount.Value.ToString("C");

            dtSorted.Rows.Add(drPendingSumNew);
            gvPendingInTab.DataSource = dtSorted;
        }

        private void gvPendingInTab_ColumnHeaderMouseClick(object sender, DataGridViewCellMouseEventArgs e)
        {
            switch (e.ColumnIndex)
            {
                case 0:
                    if (pendingInTabSortedFieldBlueSheet.Field != "INCD")
                    {
                        pendingInTabSortedFieldBlueSheet.Field = "INCD";
                        pendingInTabSortedFieldBlueSheet.Sorted = EnumSorted.NotSorted;
                    }
                    SortPendingTableInTab(pendingInTabSortedFieldBlueSheet);
                    break;
                case 1:
                    if (pendingInTabSortedFieldBlueSheet.Field != "회원 이름")
                    {
                        pendingInTabSortedFieldBlueSheet.Field = "회원 이름";
                        pendingInTabSortedFieldBlueSheet.Sorted = EnumSorted.NotSorted;
                    }
                    SortPendingTableInTab(pendingInTabSortedFieldBlueSheet);
                    break;
                case 2:
                    if (pendingInTabSortedFieldBlueSheet.Field != "MED_BILL")
                    {
                        pendingInTabSortedFieldBlueSheet.Field = "MED_BILL";
                        pendingInTabSortedFieldBlueSheet.Sorted = EnumSorted.NotSorted;
                    }
                    SortPendingTableInTab(pendingInTabSortedFieldBlueSheet);
                    break;
                case 3:
                    if (pendingInTabSortedFieldBlueSheet.Field != "서비스 날짜")
                    {
                        pendingInTabSortedFieldBlueSheet.Field = "서비스 날짜";
                        pendingInTabSortedFieldBlueSheet.Sorted = EnumSorted.NotSorted;
                    }
                    SortPendingTableInTab(pendingInTabSortedFieldBlueSheet);
                    break;
                //case 4:
                //    if (pendingInTabSortedField.Field != "접수 날짜")
                //    {
                //        pendingInTabSortedField.Field = "접수 날짜";
                //        pendingInTabSortedField.Sorted = SortedField.EnumSorted.NotSorted;
                //    }
                //    SortPendingTableInTab(pendingInTabSortedField);
                //    break;
                case 5:
                    if (pendingInTabSortedFieldBlueSheet.Field != "의료기관명")
                    {
                        pendingInTabSortedFieldBlueSheet.Field = "의료기관명";
                        pendingInTabSortedFieldBlueSheet.Sorted = EnumSorted.NotSorted;
                    }
                    SortPendingTableInTab(pendingInTabSortedFieldBlueSheet);
                    break;
                case 8:
                    if (pendingInTabSortedFieldBlueSheet.Field != "보류 사유")
                    {
                        pendingInTabSortedFieldBlueSheet.Field = "보류 사유";
                        pendingInTabSortedFieldBlueSheet.Sorted = EnumSorted.NotSorted;
                    }
                    SortPendingTableInTab(pendingInTabSortedFieldBlueSheet);
                    break;
            }
        }

        private void SortIneligibleTable(SortedFieldBlueSheet sf)
        {
            DataTable dtIneligibleWithSum = (DataTable)gvIneligibleBlueSheet.DataSource;

            DataTable dtSorted = dtIneligibleWithSum.Clone();

            DataTable dtClone = new DataTable();
            dtClone.Columns.Add("INCD", typeof(String));
            dtClone.Columns.Add("회원 이름", typeof(String));
            dtClone.Columns.Add("MED_BILL", typeof(String));
            //dtSorted.Columns.Add("서비스 날짜", typeof(String));
            dtClone.Columns.Add("서비스 날짜", typeof(DateTime));
            dtClone.Columns.Add("접수 날짜", typeof(DateTime));
            dtClone.Columns.Add("의료기관명", typeof(String));
            dtClone.Columns.Add("청구액(원금)", typeof(String));
            dtClone.Columns.Add("전액/일부 지원불가 금액", typeof(String));
            dtClone.Columns.Add("지원되지않는 사유", typeof(String));

            dtIneligibleWithSum.Rows.RemoveAt(dtIneligibleWithSum.Rows.Count - 1);

            foreach (DataRow row in dtIneligibleWithSum.Rows)
            {
                DataRow rowClone = dtClone.NewRow();
                dtClone.Rows.Add(rowClone);
            }

            for (int i = 0; i < dtIneligibleWithSum.Rows.Count; i++)
            {
                dtClone.Rows[i]["INCD"] = dtIneligibleWithSum.Rows[i]["INCD"];
                dtClone.Rows[i]["회원 이름"] = dtIneligibleWithSum.Rows[i]["회원 이름"];
                dtClone.Rows[i]["MED_BILL"] = dtIneligibleWithSum.Rows[i]["MED_BILL"];
                dtClone.Rows[i]["서비스 날짜"] = DateTime.Parse(dtIneligibleWithSum.Rows[i]["서비스 날짜"].ToString());
                if (dtIneligibleWithSum.Rows[i]["접수 날짜"].ToString() != String.Empty)
                {
                    dtClone.Rows[i]["접수 날짜"] = DateTime.Parse(dtIneligibleWithSum.Rows[i]["접수 날짜"].ToString());
                }
                else dtClone.Rows[i]["접수 날짜"] = DBNull.Value;
                dtClone.Rows[i]["의료기관명"] = dtIneligibleWithSum.Rows[i]["의료기관명"];
                dtClone.Rows[i]["청구액(원금)"] = dtIneligibleWithSum.Rows[i]["청구액(원금)"];
                dtClone.Rows[i]["전액/일부 지원불가 금액"] = dtIneligibleWithSum.Rows[i]["전액/일부 지원불가 금액"];
                dtClone.Rows[i]["지원되지않는 사유"] = dtIneligibleWithSum.Rows[i]["지원되지않는 사유"];
            }

            switch (sf.Sorted)
            {
                case EnumSorted.NotSorted:
                    //dtIneligibleWithSum.DefaultView.Sort = sf.Field + " ASC";
                    dtClone.DefaultView.Sort = sf.Field + " ASC";
                    sf.Sorted = EnumSorted.SortedAsc;
                    break;
                case EnumSorted.SortedDesc:
                    //dtIneligibleWithSum.DefaultView.Sort = sf.Field + " ASC";
                    dtClone.DefaultView.Sort = sf.Field + " ASC";
                    sf.Sorted = EnumSorted.SortedAsc;
                    break;
                case EnumSorted.SortedAsc:
                    //dtIneligibleWithSum.DefaultView.Sort = sf.Field + " DESC";
                    dtClone.DefaultView.Sort = sf.Field + " DESC";
                    sf.Sorted = EnumSorted.SortedDesc;
                    break;
            }

            DataTable dtCloneSorted = dtClone.Clone();
            dtCloneSorted = dtClone.DefaultView.ToTable();

            foreach (DataRow row in dtCloneSorted.Rows)
            {
                DataRow rowSorted = dtSorted.NewRow();

                dtSorted.Rows.Add(rowSorted);
            }

            for (int i = 0; i < dtCloneSorted.Rows.Count; i++)
            {
                dtSorted.Rows[i]["INCD"] = dtCloneSorted.Rows[i]["INCD"];
                dtSorted.Rows[i]["회원 이름"] = dtCloneSorted.Rows[i]["회원 이름"];
                dtSorted.Rows[i]["MED_BILL"] = dtCloneSorted.Rows[i]["MED_BILL"];
                dtSorted.Rows[i]["서비스 날짜"] = DateTime.Parse(dtCloneSorted.Rows[i]["서비스 날짜"].ToString()).ToString("MM/dd/yyyy");
                if (dtCloneSorted.Rows[i]["접수 날짜"].ToString() != String.Empty)
                {
                    dtSorted.Rows[i]["접수 날짜"] = DateTime.Parse(dtCloneSorted.Rows[i]["접수 날짜"].ToString()).ToString("MM/dd/yyyy");
                }
                else dtSorted.Rows[i]["접수 날짜"] = DBNull.Value;
                dtSorted.Rows[i]["의료기관명"] = dtCloneSorted.Rows[i]["의료기관명"];
                dtSorted.Rows[i]["청구액(원금)"] = dtCloneSorted.Rows[i]["청구액(원금)"];
                dtSorted.Rows[i]["전액/일부 지원불가 금액"] = dtCloneSorted.Rows[i]["전액/일부 지원불가 금액"];
                dtSorted.Rows[i]["지원되지않는 사유"] = dtCloneSorted.Rows[i]["지원되지않는 사유"];

            }

            DataRow drIneligibleSumNew = dtSorted.NewRow();

            List<MedicalExpenseIneligibleBlueSheet> lstIneligible = new List<MedicalExpenseIneligibleBlueSheet>();

            foreach (DataRow row in dtSorted.Rows)
            {
                //lstIneligible.Add(new MedicalExpenseIneligible(Double.Parse(row[6].ToString().Substring(1)),
                //                                               Double.Parse(row[7].ToString().Substring(1))));

                MedicalExpenseIneligibleBlueSheet ineligible = new MedicalExpenseIneligibleBlueSheet();
                ineligible.BillAmount = Double.Parse(row[6].ToString().Substring(1));
                ineligible.AmountIneligible = Double.Parse(row[7].ToString().Substring(1));

                lstIneligible.Add(ineligible);
            }

            drIneligibleSumNew["INCD"] = String.Empty;
            drIneligibleSumNew["MED_BILL"] = String.Empty;
            //drIneligibleSumNew["서비스 날짜"] = String.Empty;
            drIneligibleSumNew["의료기관명"] = "합계";
            drIneligibleSumNew["지원되지않는 사유"] = String.Empty;

            MedicalExpenseIneligibleBlueSheet sumIneligible = new MedicalExpenseIneligibleBlueSheet();

            foreach (MedicalExpenseIneligibleBlueSheet expense in lstIneligible)
            {
                sumIneligible.BillAmount += expense.BillAmount;
                sumIneligible.AmountIneligible += expense.AmountIneligible;
            }

            drIneligibleSumNew["청구액(원금)"] = sumIneligible.BillAmount.Value.ToString("C");
            drIneligibleSumNew["전액/일부 지원불가 금액"] = sumIneligible.AmountIneligible.Value.ToString("C");

            dtSorted.Rows.Add(drIneligibleSumNew);
            gvIneligibleBlueSheet.DataSource = dtSorted;
        }

        private void gvIneligibleBlueSheet_ColumnHeaderMouseClick(object sender, DataGridViewCellMouseEventArgs e)
        {
            switch (e.ColumnIndex)
            {
                case 0:
                    if (ineligibleSortedFieldBlueSheet.Field != "INCD")
                    {
                        ineligibleSortedFieldBlueSheet.Field = "INCD";
                        ineligibleSortedFieldBlueSheet.Sorted = EnumSorted.NotSorted;
                    }
                    SortIneligibleTable(ineligibleSortedFieldBlueSheet);
                    break;
                case 1:
                    if (ineligibleSortedFieldBlueSheet.Field != "회원 이름")
                    {
                        ineligibleSortedFieldBlueSheet.Field = "회원 이름";
                        ineligibleSortedFieldBlueSheet.Sorted = EnumSorted.NotSorted;
                    }
                    SortIneligibleTable(ineligibleSortedFieldBlueSheet);
                    break;
                case 2:
                    if (ineligibleSortedFieldBlueSheet.Field != "MED_BILL")
                    {
                        ineligibleSortedFieldBlueSheet.Field = "MED_BILL";
                        ineligibleSortedFieldBlueSheet.Sorted = EnumSorted.NotSorted;
                    }
                    SortIneligibleTable(ineligibleSortedFieldBlueSheet);
                    break;
                case 3:
                    if (ineligibleSortedFieldBlueSheet.Field != "서비스 날짜")
                    {
                        ineligibleSortedFieldBlueSheet.Field = "서비스 날짜";
                        ineligibleSortedFieldBlueSheet.Sorted = EnumSorted.NotSorted;
                    }
                    SortIneligibleTable(ineligibleSortedFieldBlueSheet);
                    break;
                case 4:
                    if (ineligibleSortedFieldBlueSheet.Field != "접수 날짜")
                    {
                        ineligibleSortedFieldBlueSheet.Field = "접수 날짜";
                        ineligibleSortedFieldBlueSheet.Sorted = EnumSorted.NotSorted;
                    }
                    SortIneligibleTable(ineligibleSortedFieldBlueSheet);
                    break;
                case 5:
                    if (ineligibleSortedFieldBlueSheet.Field != "의료기관명")
                    {
                        ineligibleSortedFieldBlueSheet.Field = "의료기관명";
                        ineligibleSortedFieldBlueSheet.Sorted = EnumSorted.NotSorted;
                    }
                    SortIneligibleTable(ineligibleSortedFieldBlueSheet);
                    break;
                case 8:
                    if (ineligibleSortedFieldBlueSheet.Field != "지원되지않는 사유")
                    {
                        ineligibleSortedFieldBlueSheet.Field = "지원되지않는 사유";
                        ineligibleSortedFieldBlueSheet.Sorted = EnumSorted.NotSorted;
                    }
                    SortIneligibleTable(ineligibleSortedFieldBlueSheet);
                    break;
            }
        }

        private void SortIneligibleTableInTab(SortedFieldBlueSheet sf)
        {
            DataTable dtIneligibleWithSum = (DataTable)gvIneligibleInTab.DataSource;

            DataTable dtSorted = dtIneligibleWithSum.Clone();

            DataTable dtClone = new DataTable();
            dtClone.Columns.Add("INCD", typeof(String));
            dtClone.Columns.Add("회원 이름", typeof(String));
            dtClone.Columns.Add("MED_BILL", typeof(String));
            dtClone.Columns.Add("서비스 날짜", typeof(DateTime));
            dtClone.Columns.Add("접수 날짜", typeof(DateTime));
            dtClone.Columns.Add("의료기관명", typeof(String));
            dtClone.Columns.Add("청구액(원금)", typeof(String));
            dtClone.Columns.Add("전액/일부 지원불가 금액", typeof(String));
            dtClone.Columns.Add("지원되지않는 사유", typeof(String));

            dtIneligibleWithSum.Rows.RemoveAt(dtIneligibleWithSum.Rows.Count - 1);

            foreach (DataRow row in dtIneligibleWithSum.Rows)
            {
                DataRow rowClone = dtClone.NewRow();
                dtClone.Rows.Add(rowClone);
            }

            for (int i = 0; i < dtIneligibleWithSum.Rows.Count; i++)
            {
                dtClone.Rows[i]["INCD"] = dtIneligibleWithSum.Rows[i]["INCD"];
                dtClone.Rows[i]["회원 이름"] = dtIneligibleWithSum.Rows[i]["회원 이름"];
                dtClone.Rows[i]["MED_BILL"] = dtIneligibleWithSum.Rows[i]["MED_BILL"];
                dtClone.Rows[i]["서비스 날짜"] = DateTime.Parse(dtIneligibleWithSum.Rows[i]["서비스 날짜"].ToString());
                if (dtIneligibleWithSum.Rows[i]["접수 날짜"].ToString() != String.Empty)
                {
                    dtClone.Rows[i]["접수 날짜"] = DateTime.Parse(dtIneligibleWithSum.Rows[i]["접수 날짜"].ToString());
                }
                else dtClone.Rows[i]["접수 날짜"] = DBNull.Value;
                dtClone.Rows[i]["의료기관명"] = dtIneligibleWithSum.Rows[i]["의료기관명"];
                dtClone.Rows[i]["청구액(원금)"] = dtIneligibleWithSum.Rows[i]["청구액(원금)"];
                dtClone.Rows[i]["전액/일부 지원불가 금액"] = dtIneligibleWithSum.Rows[i]["전액/일부 지원불가 금액"];
                dtClone.Rows[i]["지원되지않는 사유"] = dtIneligibleWithSum.Rows[i]["지원되지않는 사유"];
            }

            switch (sf.Sorted)
            {
                case EnumSorted.NotSorted:
                    dtClone.DefaultView.Sort = sf.Field + " ASC";
                    sf.Sorted = EnumSorted.SortedAsc;
                    break;
                case EnumSorted.SortedDesc:
                    dtClone.DefaultView.Sort = sf.Field + " ASC";
                    sf.Sorted = EnumSorted.SortedAsc;
                    break;
                case EnumSorted.SortedAsc:
                    dtClone.DefaultView.Sort = sf.Field + " DESC";
                    sf.Sorted = EnumSorted.SortedDesc;
                    break;
            }

            DataTable dtCloneSorted = dtClone.Clone();
            dtCloneSorted = dtClone.DefaultView.ToTable();

            foreach (DataRow row in dtCloneSorted.Rows)
            {
                DataRow rowSorted = dtSorted.NewRow();

                dtSorted.Rows.Add(rowSorted);
            }

            for (int i = 0; i < dtCloneSorted.Rows.Count; i++)
            {
                dtSorted.Rows[i]["INCD"] = dtCloneSorted.Rows[i]["INCD"];
                dtSorted.Rows[i]["회원 이름"] = dtCloneSorted.Rows[i]["회원 이름"];
                dtSorted.Rows[i]["MED_BILL"] = dtCloneSorted.Rows[i]["MED_BILL"];
                dtSorted.Rows[i]["서비스 날짜"] = DateTime.Parse(dtCloneSorted.Rows[i]["서비스 날짜"].ToString()).ToString("MM/dd/yyyy");
                if (dtCloneSorted.Rows[i]["접수 날짜"].ToString() != String.Empty)
                {
                    dtSorted.Rows[i]["접수 날짜"] = DateTime.Parse(dtCloneSorted.Rows[i]["접수 날짜"].ToString()).ToString("MM/dd/yyyy");
                }
                else dtSorted.Rows[i]["접수 날짜"] = DBNull.Value;
                dtSorted.Rows[i]["의료기관명"] = dtCloneSorted.Rows[i]["의료기관명"];
                dtSorted.Rows[i]["청구액(원금)"] = dtCloneSorted.Rows[i]["청구액(원금)"];
                dtSorted.Rows[i]["전액/일부 지원불가 금액"] = dtCloneSorted.Rows[i]["전액/일부 지원불가 금액"];
                dtSorted.Rows[i]["지원되지않는 사유"] = dtCloneSorted.Rows[i]["지원되지않는 사유"];
            }

            DataRow drIneligibleSumNew = dtSorted.NewRow();

            List<MedicalExpenseIneligibleBlueSheet> lstIneligible = new List<MedicalExpenseIneligibleBlueSheet>();

            foreach (DataRow row in dtSorted.Rows)
            {
                //lstIneligible.Add(new MedicalExpenseIneligible(Double.Parse(row[6].ToString().Substring(1)),
                //                                               Double.Parse(row[7].ToString().Substring(1))));

                MedicalExpenseIneligibleBlueSheet ineligible = new MedicalExpenseIneligibleBlueSheet();
                ineligible.BillAmount = Double.Parse(row[6].ToString().Substring(1));
                ineligible.AmountIneligible = Double.Parse(row[7].ToString().Substring(1));

                lstIneligible.Add(ineligible);
            }

            drIneligibleSumNew["INCD"] = String.Empty;
            drIneligibleSumNew["MED_BILL"] = String.Empty;
            //drIneligibleSumNew["서비스 날짜"] = String.Empty;
            drIneligibleSumNew["의료기관명"] = "합계";
            drIneligibleSumNew["지원되지않는 사유"] = String.Empty;

            MedicalExpenseIneligibleBlueSheet sumIneligible = new MedicalExpenseIneligibleBlueSheet();

            foreach (MedicalExpenseIneligibleBlueSheet expense in lstIneligible)
            {
                sumIneligible.BillAmount += expense.BillAmount;
                sumIneligible.AmountIneligible += expense.AmountIneligible;
            }

            drIneligibleSumNew["청구액(원금)"] = sumIneligible.BillAmount.Value.ToString("C");
            drIneligibleSumNew["전액/일부 지원불가 금액"] = sumIneligible.AmountIneligible.Value.ToString("C");

            dtSorted.Rows.Add(drIneligibleSumNew);
            gvIneligibleInTab.DataSource = dtSorted;
        }

        private void gvIneligibleInTab_ColumnHeaderMouseClick(object sender, DataGridViewCellMouseEventArgs e)
        {
            switch (e.ColumnIndex)
            {
                case 0:
                    if (ineligibleInTabSortedFieldBlueSheet.Field != "INCD")
                    {
                        ineligibleInTabSortedFieldBlueSheet.Field = "INCD";
                        ineligibleInTabSortedFieldBlueSheet.Sorted = EnumSorted.NotSorted;
                    }
                    SortIneligibleTableInTab(ineligibleInTabSortedFieldBlueSheet);
                    break;
                case 1:
                    if (ineligibleInTabSortedFieldBlueSheet.Field != "회원 이름")
                    {
                        ineligibleInTabSortedFieldBlueSheet.Field = "회원 이름";
                        ineligibleInTabSortedFieldBlueSheet.Sorted = EnumSorted.NotSorted;
                    }
                    SortIneligibleTableInTab(ineligibleInTabSortedFieldBlueSheet);
                    break;
                case 2:
                    if (ineligibleInTabSortedFieldBlueSheet.Field != "MED_BILL")
                    {
                        ineligibleInTabSortedFieldBlueSheet.Field = "MED_BILL";
                        ineligibleInTabSortedFieldBlueSheet.Sorted = EnumSorted.NotSorted;
                    }
                    SortIneligibleTableInTab(ineligibleInTabSortedFieldBlueSheet);
                    break;
                case 3:
                    if (ineligibleInTabSortedFieldBlueSheet.Field != "서비스 날짜")
                    {
                        ineligibleInTabSortedFieldBlueSheet.Field = "서비스 날짜";
                        ineligibleInTabSortedFieldBlueSheet.Sorted = EnumSorted.NotSorted;
                    }
                    SortIneligibleTableInTab(ineligibleInTabSortedFieldBlueSheet);
                    break;
                case 4:
                    if (ineligibleInTabSortedFieldBlueSheet.Field != "접수 날짜")
                    {
                        ineligibleInTabSortedFieldBlueSheet.Field = "접수 날짜";
                        ineligibleInTabSortedFieldBlueSheet.Sorted = EnumSorted.NotSorted;
                    }
                    SortIneligibleTableInTab(ineligibleInTabSortedFieldBlueSheet);
                    break;
                case 5:
                    if (ineligibleInTabSortedFieldBlueSheet.Field != "의료기관명")
                    {
                        ineligibleInTabSortedFieldBlueSheet.Field = "의료기관명";
                        ineligibleInTabSortedFieldBlueSheet.Sorted = EnumSorted.NotSorted;
                    }
                    SortIneligibleTableInTab(ineligibleInTabSortedFieldBlueSheet);
                    break;
                case 8:
                    if (ineligibleInTabSortedFieldBlueSheet.Field != "지원되지않는 사유")
                    {
                        ineligibleInTabSortedFieldBlueSheet.Field = "지원되지않는 사유";
                        ineligibleInTabSortedFieldBlueSheet.Sorted = EnumSorted.NotSorted;
                    }
                    SortIneligibleTableInTab(ineligibleInTabSortedFieldBlueSheet);
                    break;
            }
        }

        private void SortPersonalResponsibilityTable(SortedFieldBlueSheet sf)
        {
            DataTable dtPersonalResponsibility = (DataTable)gvPersonalResponsibility.DataSource;

            DataTable dtSorted = dtPersonalResponsibility.Clone();
            DataTable dtClone = new DataTable();

            //////////////////////////////////////////////////////////////////////////////////////////////////
            dtClone.Columns.Add("MEDBILL", typeof(String));
            dtClone.Columns.Add("서비스 날짜", typeof(DateTime));
            dtClone.Columns.Add("의료기관명", typeof(String));
            dtClone.Columns.Add("청구액(원금)", typeof(String));
            dtClone.Columns.Add("Type", typeof(String));
            dtClone.Columns.Add("PR Type: Member Payment", typeof(String));
            dtClone.Columns.Add("PR Type: Member Discount", typeof(String));
            dtClone.Columns.Add("PR Type: 3rd Party Discount", typeof(String));
            dtClone.Columns.Add("Personal Responsibility Total", typeof(String));

            //dtClone.Columns.Add("본인 부담금", typeof(String));


            dtPersonalResponsibility.Rows.RemoveAt(dtPersonalResponsibility.Rows.Count - 1);

            foreach (DataRow row in dtPersonalResponsibility.Rows)
            {
                DataRow rowClone = dtClone.NewRow();
                dtClone.Rows.Add(rowClone);
            }

            for (int i = 0; i < dtPersonalResponsibility.Rows.Count; i++)
            {
                dtClone.Rows[i]["MEDBILL"] = dtPersonalResponsibility.Rows[i]["MEDBILL"];
                dtClone.Rows[i]["서비스 날짜"] = DateTime.Parse(dtPersonalResponsibility.Rows[i]["서비스 날짜"].ToString());
                dtClone.Rows[i]["의료기관명"] = dtPersonalResponsibility.Rows[i]["의료기관명"];
                dtClone.Rows[i]["청구액(원금)"] = dtPersonalResponsibility.Rows[i]["청구액(원금)"];
                dtClone.Rows[i]["Type"] = dtPersonalResponsibility.Rows[i]["Type"];
                dtClone.Rows[i]["PR Type: Member Payment"] = dtPersonalResponsibility.Rows[i]["PR Type: Member Payment"];
                dtClone.Rows[i]["PR Type: Member Discount"] = dtPersonalResponsibility.Rows[i]["PR Type: Member Discount"];
                dtClone.Rows[i]["PR Type: 3rd Party Discount"] = dtPersonalResponsibility.Rows[i]["PR Type: 3rd Party Discount"];
                dtClone.Rows[i]["Personal Responsibility Total"] = dtPersonalResponsibility.Rows[i]["Personal Responsibility Total"];
                //dtClone.Rows[i]["본인 부담금"] = dtPersonalResponsibility.Rows[i]["본인 부담금"];
            }

            switch (sf.Sorted)
            {
                case EnumSorted.NotSorted:
                    dtClone.DefaultView.Sort = sf.Field + " ASC";
                    sf.Sorted = EnumSorted.SortedAsc;
                    break;
                case EnumSorted.SortedDesc:
                    dtClone.DefaultView.Sort = sf.Field + " ASC";
                    sf.Sorted = EnumSorted.SortedAsc;
                    break;
                case EnumSorted.SortedAsc:
                    dtClone.DefaultView.Sort = sf.Field + " DESC";
                    sf.Sorted = EnumSorted.SortedDesc;
                    break;
            }

            DataTable dtCloneSorted = dtClone.Clone();
            dtCloneSorted = dtClone.DefaultView.ToTable();

            foreach (DataRow row in dtCloneSorted.Rows)
            {
                DataRow rowSorted = dtSorted.NewRow();
                dtSorted.Rows.Add(rowSorted);
            }

            for (int i = 0; i < dtCloneSorted.Rows.Count; i++)
            {
                dtSorted.Rows[i]["MEDBILL"] = dtCloneSorted.Rows[i]["MEDBILL"];
                dtSorted.Rows[i]["서비스 날짜"] = DateTime.Parse(dtCloneSorted.Rows[i]["서비스 날짜"].ToString()).ToString("MM/dd/yyyy");
                dtSorted.Rows[i]["의료기관명"] = dtCloneSorted.Rows[i]["의료기관명"];
                dtSorted.Rows[i]["청구액(원금)"] = dtCloneSorted.Rows[i]["청구액(원금)"];
                dtSorted.Rows[i]["Type"] = dtCloneSorted.Rows[i]["Type"];
                dtSorted.Rows[i]["PR Type: Member Payment"] = dtCloneSorted.Rows[i]["PR Type: Member Payment"];
                dtSorted.Rows[i]["PR Type: Member Discount"] = dtCloneSorted.Rows[i]["PR Type: Member Discount"];
                dtSorted.Rows[i]["PR Type: 3rd Party Discount"] = dtCloneSorted.Rows[i]["PR Type: 3rd Party Discount"];
                dtSorted.Rows[i]["Personal Responsibility Total"] = dtCloneSorted.Rows[i]["Personal Responsibility Total"];

                //dtSorted.Rows[i]["본인 부담금"] = dtCloneSorted.Rows[i]["본인 부담금"];
            }

            DataRow drPersonalResponsibilitySumNew = dtSorted.NewRow();

            List<PersonalResponsibilityExpenseBlueSheet> lstPersonalResponsibilityExpense = new List<PersonalResponsibilityExpenseBlueSheet>();

            foreach (DataRow row in dtSorted.Rows)
            {
                //lstPersonalResponsibilityExpense.Add(new PersonalResponsibilityExpense { BillAmount = Double.Parse(row[3].ToString().Substring(1)),
                //                                                                         MemberPayment = Double.Parse(row[5].ToString().Substring(1)),
                //                                                                         MemberDiscount = Double.Parse(row[6].ToString().Substring(1)) });

                PersonalResponsibilityExpenseBlueSheet expense = new PersonalResponsibilityExpenseBlueSheet();
                expense.BillAmount = Double.Parse(row[3].ToString().Substring(1));
                if (row[5] != DBNull.Value) expense.MemberPayment = Double.Parse(row[5].ToString().Substring(1));
                if (row[6] != DBNull.Value) expense.MemberDiscount = Double.Parse(row[6].ToString().Substring(1));
                if (row[7] != DBNull.Value) expense.ThirdPartyDiscount = Double.Parse(row[7].ToString().Substring(1));
                if (row[8] != DBNull.Value) expense.PersonalResponsiblityTotal = Double.Parse(row[8].ToString().Substring(1));

                lstPersonalResponsibilityExpense.Add(expense);

            }

            drPersonalResponsibilitySumNew["MEDBILL"] = String.Empty;
            drPersonalResponsibilitySumNew["서비스 날짜"] = String.Empty;
            drPersonalResponsibilitySumNew["의료기관명"] = "합계";

            PersonalResponsibilityExpenseBlueSheet sumPersonalResponsibility = new PersonalResponsibilityExpenseBlueSheet();
            foreach (PersonalResponsibilityExpenseBlueSheet expense in lstPersonalResponsibilityExpense)
            {
                sumPersonalResponsibility.BillAmount += expense.BillAmount;
                sumPersonalResponsibility.MemberPayment += expense.MemberPayment;
                sumPersonalResponsibility.MemberDiscount += expense.MemberDiscount;
                //sumPersonalResponsibility.SettlementAmount += expense.SettlementAmount;
            }

            drPersonalResponsibilitySumNew["청구액(원금)"] = sumPersonalResponsibility.BillAmount.ToString("C");
            drPersonalResponsibilitySumNew["PR Type: Member Payment"] = sumPersonalResponsibility.MemberPayment.ToString("C");
            drPersonalResponsibilitySumNew["PR Type: Member Discount"] = sumPersonalResponsibility.MemberDiscount.ToString("C");
            drPersonalResponsibilitySumNew["PR Type: 3rd Party Discount"] = sumPersonalResponsibility.ThirdPartyDiscount.ToString("C");
            drPersonalResponsibilitySumNew["Personal Responsibility Total"] = sumPersonalResponsibility.PersonalResponsiblityTotal.ToString("C");
            //drPersonalResponsibilitySumNew["본인 부담금"] = sumPersonalResponsibility.SettlementAmount.ToString("C");

            dtSorted.Rows.Add(drPersonalResponsibilitySumNew);
            gvPersonalResponsibility.DataSource = dtSorted;
        }

        private void gvPersonalResponsibility_ColumnHeaderMouseClick(object sender, DataGridViewCellMouseEventArgs e)
        {
            switch (e.ColumnIndex)
            {
                case 0:
                    if (prSortedFieldBlueSheet.Field != "MEDBILL")
                    {
                        prSortedFieldBlueSheet.Field = "MEDBILL";
                        prSortedFieldBlueSheet.Sorted = EnumSorted.NotSorted;
                    }
                    SortPersonalResponsibilityTable(prSortedFieldBlueSheet);
                    break;
                case 1:
                    if (prSortedFieldBlueSheet.Field != "서비스 날짜")
                    {
                        prSortedFieldBlueSheet.Field = "서비스 날짜";
                        prSortedFieldBlueSheet.Sorted = EnumSorted.NotSorted;
                    }
                    SortPersonalResponsibilityTable(prSortedFieldBlueSheet);
                    break;
                case 2:
                    if (prSortedFieldBlueSheet.Field != "의료기관명")
                    {
                        prSortedFieldBlueSheet.Field = "의료기관명";
                        prSortedFieldBlueSheet.Sorted = EnumSorted.NotSorted;
                    }
                    SortPersonalResponsibilityTable(prSortedFieldBlueSheet);
                    break;
                case 4:
                    if (prSortedFieldBlueSheet.Field != "Type")
                    {
                        prSortedFieldBlueSheet.Field = "Type";
                        prSortedFieldBlueSheet.Sorted = EnumSorted.NotSorted;
                    }
                    SortPersonalResponsibilityTable(prSortedFieldBlueSheet);
                    break;
                case 5:
                    if (prSortedFieldBlueSheet.Field != "PR Type")
                    {
                        prSortedFieldBlueSheet.Field = "PR Type";
                        prSortedFieldBlueSheet.Sorted = EnumSorted.NotSorted;
                    }
                    SortPersonalResponsibilityTable(prSortedFieldBlueSheet);
                    break;
            }
        }

        private void btnGenerateKoreanPDFBlueSheet_Click(object sender, EventArgs e)
        {
            if ((gvSharedMedBillBlueSheet.RowCount > 0) || (gvCMMPendingPaymentBlueSheet.RowCount > 0) || (gvPendingBlueSheet.RowCount > 0) || (gvIneligibleBlueSheet.RowCount > 0))
            {

                //DateTime? dtDocReceivedDate = null;

                //frmDocReceivedDate frmDocumentReceivedDate = new frmDocReceivedDate();

                //frmDocumentReceivedDate.StartPosition = FormStartPosition.CenterParent;

                //var dlgResultDocReceivedDate = frmDocumentReceivedDate.ShowDialog();

                //if (dlgResultDocReceivedDate == DialogResult.OK)
                //{
                //dtDocReceivedDate = frmDocumentReceivedDate.ReceivedDate;

                MigraDocDOM.Document pdfDoc = new MigraDocDOM.Document();

                MigraDocDOM.Section section = pdfDoc.AddSection();
                pdfDoc.UseCmykColor = true;

                section.PageSetup.PageFormat = MigraDocDOM.PageFormat.Letter;
                section.PageSetup.HeaderDistance = "0.25in";
                section.PageSetup.TopMargin = "1.5in";
                //section.PageSetup.LeftMargin = "0.3in";
                //section.PageSetup.RightMargin = "0.3in";
                section.PageSetup.LeftMargin = "0.8in";
                section.PageSetup.RightMargin = "0.8in";
                section.PageSetup.BottomMargin = "0.5in";

                section.PageSetup.DifferentFirstPageHeaderFooter = false;
                section.Headers.Primary.Format.SpaceBefore = "0.25in";

                MigraDocDOM.Shapes.Image image = section.Headers.Primary.AddImage("C:\\Program Files (x86)\\RN\\RNManager\\cmmlogo.png");
                //MigraDocDOM.Shapes.Image image = section.Headers.Primary.AddImage("../cmmlogo.png");


                //savefileDlg.FileName = strIndividualID + "_" + strIndividualName + "_" + DateTime.Today.ToString("MM-dd-yyyy") + "_Ko";


                image.Height = "0.8in";
                image.LockAspectRatio = true;
                image.RelativeVertical = MigraDocDOM.Shapes.RelativeVertical.Line;
                image.RelativeHorizontal = MigraDocDOM.Shapes.RelativeHorizontal.Margin;
                image.Top = MigraDocDOM.Shapes.ShapePosition.Top;
                image.Left = MigraDocDOM.Shapes.ShapePosition.Center;
                image.WrapFormat.Style = MigraDocDOM.Shapes.WrapStyle.TopBottom;

                MigraDocDOM.Paragraph paraCMMAddress = section.Headers.Primary.AddParagraph();
                paraCMMAddress.Format.Font.Name = "Arial";
                paraCMMAddress.Format.Font.Size = 8;
                paraCMMAddress.Format.SpaceBefore = "0.15in";
                paraCMMAddress.Format.SpaceAfter = "0.25in";
                //paraCMMAddress.Format.LeftIndent = "0.5in";
                //paraCMMAddress.Format.RightIndent = "0.5in";
                paraCMMAddress.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                String strVerticalBar = " | ";
                String strStreet = "5235 N. Elston Ave.";
                String strCityStateZip = "Chicago, IL 60630";
                String strPhone = "Phone 773.777.8889";
                String strFax = "Fax 773.777.0004";
                String strWebsiteAddr = "www.cmmlogos.org";

                paraCMMAddress.AddFormattedText(strStreet, MigraDocDOM.TextFormat.NotBold);
                paraCMMAddress.AddFormattedText(strVerticalBar, MigraDocDOM.TextFormat.Bold);
                paraCMMAddress.AddFormattedText(strCityStateZip, MigraDocDOM.TextFormat.NotBold);
                paraCMMAddress.AddFormattedText(strVerticalBar, MigraDocDOM.TextFormat.Bold);
                paraCMMAddress.AddFormattedText(strPhone, MigraDocDOM.TextFormat.NotBold);
                paraCMMAddress.AddFormattedText(strVerticalBar, MigraDocDOM.TextFormat.Bold);
                paraCMMAddress.AddFormattedText(strFax, MigraDocDOM.TextFormat.NotBold);
                paraCMMAddress.AddFormattedText(strVerticalBar, MigraDocDOM.TextFormat.Bold);
                paraCMMAddress.AddFormattedText(strWebsiteAddr, MigraDocDOM.TextFormat.NotBold);

                MigraDocDOM.Paragraph paraToday = section.AddParagraph();
                paraToday.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                paraToday.Format.Font.Name = "Arial";
                paraToday.Format.Alignment = MigraDocDOM.ParagraphAlignment.Left;
                paraToday.Format.SpaceBefore = "0.25in";
                paraToday.Format.SpaceAfter = "0.25in";
                //paraToday.Format.LeftIndent = "0.5in";
                //paraToday.Format.RightIndent = "0.5in";
                //dtpCheckIssueDateBlueSheet
                paraToday.AddFormattedText(DateTime.Today.ToString("MM/dd/yyyy"));
                //if (rbCheckBlueSheet.Checked) paraToday.AddFormattedText(dtpCheckIssueDateBlueSheet.Value.ToString("MM/dd/yyyy"));
                //else if (rbACHBlueSheet.Checked) paraToday.AddFormattedText(dtpACHTransactionDateBlueSheet.Value.ToString("MM/dd/yyyy"));
                //else if (rbCreditCardBlueSheet.Checked) paraToday.AddFormattedText(dtpCreditCardPaymentDateBlueSheet.Value.ToString("MM/dd/yyyy"));

                MigraDocDOM.Paragraph paraMembershipInfo = section.AddParagraph();

                paraMembershipInfo.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                paraMembershipInfo.Format.Font.Name = "Arial";
                //paraMembershipInfo.Format.SpaceBefore = "0.70in";
                paraMembershipInfo.Format.SpaceBefore = "0.20in";
                paraMembershipInfo.Format.SpaceAfter = "0.20in";
                //paraMembershipInfo.Format.LeftIndent = "0.5in";
                //paraMembershipInfo.Format.RightIndent = "0.5in";
                paraMembershipInfo.Format.Alignment = MigraDocDOM.ParagraphAlignment.Left;
                //paraMembershipInfo.AddFormattedText("Primary Name: " + strPrimaryName + "\n");
                if (strMembershipIdBlueSheet != String.Empty) paraMembershipInfo.AddFormattedText(strMembershipIdBlueSheet + " (" + strIndividualIDBlueSheet + ")\n");
                else paraMembershipInfo.AddFormattedText(strIndividualIDBlueSheet + "\n");
                paraMembershipInfo.AddFormattedText(strIndividualNameBlueSheet + "\n");
                paraMembershipInfo.AddFormattedText(strStreetAddressBlueSheet + "\n");
                paraMembershipInfo.AddFormattedText(strCityBlueSheet + ", " + strStateBlueSheet + " " + strZipBlueSheet + "\n");


                MigraDocDOM.Paragraph paraDearMember = section.AddParagraph();
                paraDearMember.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                paraDearMember.Format.Font.Name = "Malgun Gothic";
                paraDearMember.Format.Font.Size = 8;
                paraDearMember.Format.Alignment = MigraDocDOM.ParagraphAlignment.Left;
                //paraDearMember.Format.LeftIndent = "0.5in";
                //paraDearMember.Format.RightIndent = "0.5in";
                paraDearMember.Format.SpaceBefore = "0.1in";
                paraDearMember.Format.SpaceAfter = "0.1in";
                if (strIndividualMiddleNameBlueSheet != String.Empty) paraDearMember.AddFormattedText(strIndividualLastNameBlueSheet + ", " + strIndiviaualFirstNameBlueSheet + " 회원께,");
                else paraDearMember.AddFormattedText(strIndividualLastNameBlueSheet + ", " + strIndiviaualFirstNameBlueSheet + " " + strIndividualMiddleNameBlueSheet + " 회원께,");


                MigraDocDOM.Paragraph paraGreetingMessage = section.AddParagraph();

                paraGreetingMessage.Format.Font.Color = MigraDoc.DocumentObjectModel.Color.FromCmyk(100, 100, 100, 100);
                paraGreetingMessage.Format.Font.Name = "Malgun Gothic";
                paraGreetingMessage.Format.Font.Size = 8;
                paraGreetingMessage.Format.SpaceAfter = "5pt";
                //paraGreetingMessage.Format.LeftIndent = "0.5in";
                //paraGreetingMessage.Format.RightIndent = "0.5in";
                paraGreetingMessage.Format.Alignment = MigraDocDOM.ParagraphAlignment.Justify;
                //paraGreetingMessage.AddFormattedText(strGreetingMessage, TextFormat.NotBold);
                paraGreetingMessage.AddFormattedText(strGreetingMessagePara1, MigraDocDOM.TextFormat.NotBold);

                MigraDocDOM.Paragraph paraGreetingMessage2 = section.AddParagraph();
                paraGreetingMessage2.Format.Font.Color = MigraDoc.DocumentObjectModel.Color.FromCmyk(100, 100, 100, 100);
                paraGreetingMessage2.Format.Font.Name = "Malgun Gothic";
                paraGreetingMessage2.Format.Font.Size = 8;
                paraGreetingMessage2.Format.SpaceAfter = "5pt";
                //paraGreetingMessage2.Format.LeftIndent = "0.5in";
                //paraGreetingMessage2.Format.RightIndent = "0.5in";
                paraGreetingMessage2.Format.Alignment = MigraDocDOM.ParagraphAlignment.Justify;
                paraGreetingMessage2.AddFormattedText(strGreetingMessagePara2, MigraDocDOM.TextFormat.NotBold);

                MigraDocDOM.Paragraph paraGreetingMessage3 = section.AddParagraph();
                paraGreetingMessage3.Format.Font.Color = MigraDoc.DocumentObjectModel.Color.FromCmyk(100, 100, 100, 100);
                paraGreetingMessage3.Format.Font.Name = "Malgun Gothic";
                paraGreetingMessage3.Format.Font.Size = 8;
                paraGreetingMessage3.Format.SpaceAfter = "5pt";
                //paraGreetingMessage3.Format.LeftIndent = "0.5in";
                //paraGreetingMessage3.Format.RightIndent = "0.5in";
                paraGreetingMessage3.Format.Alignment = MigraDocDOM.ParagraphAlignment.Justify;
                paraGreetingMessage3.AddFormattedText(strGreetingMessagePara3, MigraDocDOM.TextFormat.NotBold);

                MigraDocDOM.Paragraph paraGreetingMessage4 = section.AddParagraph();
                paraGreetingMessage4.Format.Font.Color = MigraDoc.DocumentObjectModel.Color.FromCmyk(100, 100, 100, 100);
                paraGreetingMessage4.Format.Font.Name = "Malgun Gothic";
                paraGreetingMessage4.Format.Font.Size = 8;
                //paraGreetingMessage4.Format.LeftIndent = "0.5in";
                //paraGreetingMessage4.Format.RightIndent = "0.5in";
                paraGreetingMessage4.Format.Alignment = MigraDocDOM.ParagraphAlignment.Justify;
                paraGreetingMessage4.AddFormattedText(strGreetingMessagePara4, MigraDocDOM.TextFormat.NotBold);

                MigraDocDOM.Paragraph paraNeedsProcessing = section.AddParagraph();

                paraNeedsProcessing.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                paraNeedsProcessing.Format.Font.Name = "Arial";
                paraNeedsProcessing.Format.Font.Size = 8;
                paraNeedsProcessing.Format.Font.Bold = true;
                paraNeedsProcessing.Format.Alignment = MigraDocDOM.ParagraphAlignment.Left;
                paraNeedsProcessing.Format.SpaceBefore = "0.2in";
                //paraNeedsProcessing.Format.LeftIndent = "0.5in";
                //paraNeedsProcessing.Format.RightIndent = "0.5in";
                paraNeedsProcessing.AddFormattedText(strCMM_NeedProcessing + "\n");

                MigraDocDOM.Paragraph paraPhoneFaxEmail = section.AddParagraph();
                paraPhoneFaxEmail.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                paraPhoneFaxEmail.Format.Font.Size = 8;
                paraPhoneFaxEmail.Format.Alignment = MigraDocDOM.ParagraphAlignment.Left;
                //paraPhoneFaxEmail.Format.LeftIndent = "0.5in";
                paraPhoneFaxEmail.Format.RightIndent = "0.5in";
                paraPhoneFaxEmail.AddFormattedText(strNP_Phone_Fax_Email + "\n");

                MigraDocDOM.Paragraph paraHorizontalLine = section.AddParagraph();

                paraHorizontalLine.Format.SpaceBefore = "0.05in";
                paraHorizontalLine.Format.SpaceAfter = "0.05in";
                paraHorizontalLine.Format.Borders.Top.Width = 0;
                paraHorizontalLine.Format.Borders.Left.Width = 0;
                paraHorizontalLine.Format.Borders.Right.Width = 0;
                paraHorizontalLine.Format.Borders.Bottom.Width = 1;
                paraHorizontalLine.Format.Borders.Bottom.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                paraHorizontalLine.Format.Borders.Style = MigraDocDOM.BorderStyle.DashDot;

                MigraDocDOM.Paragraph paraNPStatement = section.AddParagraph();
                paraNPStatement.Format.Font.Color = MigraDoc.DocumentObjectModel.Color.FromCmyk(100, 100, 0, 0);
                paraNPStatement.Format.Font.Name = "Malgun Gothic";
                paraNPStatement.Format.Font.Size = 12;
                paraNPStatement.Format.Font.Bold = true;
                paraNPStatement.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;
                paraNPStatement.Format.SpaceAfter = "0.1in";

                paraNPStatement.AddFormattedText("의료비 정산 내역서\n", MigraDocDOM.TextFormat.Bold);

                MigraDocDOM.Paragraph paraCheckInfo = section.AddParagraph();
                paraCheckInfo.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                paraCheckInfo.Format.Font.Name = "Arial";
                paraCheckInfo.Format.Font.Size = 8;
                paraCheckInfo.Format.Font.Bold = true;
                paraCheckInfo.Format.Alignment = MigraDocDOM.ParagraphAlignment.Left;
                paraCheckInfo.Format.SpaceBefore = "0.1in";
                //paraCheckInfo.Format.SpaceAfter = "0.1in";
 
                if (rbCheckBlueSheet.Checked)
                {
                    //paraCheckInfo.AddFormattedText("Issue Date: " + ChkInfoEnteredBlueSheet.dtCheckIssueDate.ToString("MM/dd/yyyy") +
                    //                                "\tCheck No: " + ChkInfoEnteredBlueSheet.CheckNumber +
                    //                                "\tCheck Amount: " + ChkInfoEnteredBlueSheet.CheckAmount.Value.ToString("C") +
                    //                                "\tPaid To: " + ChkInfoEnteredBlueSheet.PaidTo);
                    paraCheckInfo.AddFormattedText("Issue Date: " + dtpCheckIssueDateBlueSheet.Value.ToString("MM/dd/yyyy") +
                                "\tCheck No: " + ChkInfoEnteredBlueSheet.CheckNumber +
                                "\tCheck Amount: " + ChkInfoEnteredBlueSheet.CheckAmount.Value.ToString("C") +
                                "\tPaid To: " + ChkInfoEnteredBlueSheet.PaidTo);

                }
                else if (rbACHBlueSheet.Checked)
                {
                    paraCheckInfo.AddFormattedText("Issue Date: " + dtpACHTransactionDateBlueSheet.Value.ToString("MM/dd/yyyy") +
                                                    "\tACH No: " + ACHInfoEnteredBlueSheet.ACHNumber +
                                                    "\tACH Amount: " + ACHInfoEnteredBlueSheet.ACHAmount.Value.ToString("C") +
                                                    "\tPaid To: " + ACHInfoEnteredBlueSheet.PaidTo);
                }
                else if (rbCreditCardBlueSheet.Checked)
                {
                    paraCheckInfo.AddFormattedText("Date: " + dtpCreditCardPaymentDateBlueSheet.Value.ToString("MM/dd/yyyy") +
                                                    "\tCredit Card Payment Amount: " + CreditCardPaymentEnteredBlueSheet.CCPaymentAmount.Value.ToString("C") +
                                                    "\tPaid To: " + CreditCardPaymentEnteredBlueSheet.PaidTo);
                }

                //int nRowHeight = 302;
                int nRowHeight = 296;

                if (lstIncidentsBlueSheet.Count > 0)
                {
                    MigraDocDOM.Paragraph paraIncd = section.AddParagraph();

                    paraIncd.Format.Font.Color = MigraDoc.DocumentObjectModel.Color.FromCmyk(100, 100, 100, 100);
                    paraIncd.Format.Font.Name = "Malgun Gothic";
                    paraIncd.Format.Font.Size = 8;
                    paraIncd.Format.Font.Bold = true;

                    MigraDocDOM.Tables.Table tableIncd = new MigraDocDOM.Tables.Table();
                    tableIncd.Borders.Width = 0;
                    tableIncd.Borders.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                    MigraDocDOM.Tables.Column colINCD = tableIncd.AddColumn(MigraDocDOM.Unit.FromInch(0.85));
                    colINCD.Format.Alignment = MigraDocDOM.ParagraphAlignment.Left;
                    //colINCD = tableIncd.AddColumn(MigraDocDOM.Unit.FromInch(1.1));
                    //colINCD.Format.Alignment = ParagraphAlignment.Left;
                    colINCD = tableIncd.AddColumn(MigraDocDOM.Unit.FromInch(4.5));
                    colINCD.Format.Alignment = MigraDocDOM.ParagraphAlignment.Left;

                    foreach (IncidentBlueSheet incd in lstIncidentsBlueSheet)
                    {
                        nRowHeight += 18;

                        MigraDocDOM.Tables.Row IncdRow = tableIncd.AddRow();
                        IncdRow.Height = "0.15in";
                        IncdRow.VerticalAlignment = MigraDocDOM.Tables.VerticalAlignment.Center;

                        MigraDocDOM.Tables.Cell cellIncdName = IncdRow.Cells[0];
                        cellIncdName.Format.Font.Bold = true;
                        cellIncdName.Format.Font.Size = 8;
                        //cellIncdName.Format.Font.Name = "Malgun Gothic";
                        cellIncdName.Format.Font.Name = "Arial";
                        cellIncdName.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                        cellIncdName.AddParagraph(incd.Name.Substring(2) + ": ");

                        //MigraDocDOM.Tables.Cell cellPatientName = IncdRow.Cells[1];
                        //cellPatientName.Format.Font.Bold = true;
                        //cellPatientName.Format.Font.Size = 8;
                        ////cellPatientName.Format.Font.Name = "Malgun Gothic";
                        //cellIncdName.Format.Font.Name = "Arial";
                        //cellPatientName.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                        //if (incd.PatientName.Length > 11)
                        //{
                        //    cellPatientName.AddParagraph(incd.PatientName.Substring(0, 11) + " ...");
                        //}
                        //else cellPatientName.AddParagraph(incd.PatientName);

                        MigraDocDOM.Tables.Cell cellICD10Code = IncdRow.Cells[1];
                        cellICD10Code.Format.Font.Bold = true;
                        cellICD10Code.Format.Font.Size = 8;
                        //cellICD10Code.Format.Font.Name = "Malgun Gothic";
                        cellIncdName.Format.Font.Name = "Arial";
                        cellICD10Code.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                        cellICD10Code.AddParagraph(incd.ICD10_Code);
                    }

                    pdfDoc.LastSection.Add(tableIncd);
                }

                //section.AddParagraph();
                //lstPaidMedicalExpenseTableRow.Clear();

                if (gvSharedMedBillBlueSheet.RowCount > 0)
                {

                    section.AddParagraph();
                    lstPaidMedicalExpenseTableRowBlueSheet.Clear();

                    //nRowHeight += 30;
                    nRowHeight += 22;

                    MigraDocDOM.Paragraph paraSpaceBefore = section.AddParagraph();
                    //paraSpaceBefore.Format.SpaceBefore = "0.18in";
                    paraSpaceBefore.Format.SpaceBefore = "0.08in";
                    paraSpaceBefore.Format.SpaceAfter = "0.05in";
                    paraSpaceBefore.Format.Font.Color = MigraDoc.DocumentObjectModel.Color.FromCmyk(100, 100, 0, 0);
                    paraSpaceBefore.Format.Font.Name = "Malgun Gothic";
                    paraSpaceBefore.Format.Font.Size = 7;
                    paraSpaceBefore.AddFormattedText("CMM이 회원 및 의료기관으로 지불한 의료비", MigraDocDOM.TextFormat.Bold);

                    for (int nRow = 0; nRow < gvSharedMedBillBlueSheet.RowCount; nRow++)
                    {

                        PaidMedicalExpenseTableRowBlueSheet expenseRow = new PaidMedicalExpenseTableRowBlueSheet();
                        expenseRow.PatientName = gvSharedMedBillBlueSheet[1, nRow].Value.ToString();
                        expenseRow.MED_BILL = gvSharedMedBillBlueSheet[2, nRow].Value.ToString();
                        //String strBillDate = gvBillPaid[3, nRow].Value.ToString();
                        //DateTime? dtBillDate = DateTime.Parse(strBillDate);
                        //expenseRow.Bill_Date = dtBillDate
                        if (gvSharedMedBillBlueSheet[3, nRow].Value.ToString() != String.Empty) expenseRow.Bill_Date = DateTime.Parse(gvSharedMedBillBlueSheet[3, nRow].Value.ToString());
                        else expenseRow.Bill_Date = null;
                        expenseRow.Medical_Provider = gvSharedMedBillBlueSheet[4, nRow].Value.ToString();
                        expenseRow.Bill_Amount = gvSharedMedBillBlueSheet[5, nRow].Value.ToString();
                        expenseRow.Personal_Responsibility = gvSharedMedBillBlueSheet[6, nRow].Value.ToString();
                        expenseRow.Member_Discount = gvSharedMedBillBlueSheet[7, nRow].Value.ToString();
                        expenseRow.CMM_Discount = gvSharedMedBillBlueSheet[8, nRow].Value.ToString();
                        expenseRow.CMM_Provider_Payment = gvSharedMedBillBlueSheet[9, nRow].Value.ToString();
                        //if (rbCheck.Checked || rbACH.Checked)
                        if (PaidToBlueSheet == EnumPaidTo.Member)
                        {
                            expenseRow.PastReimbursement = gvSharedMedBillBlueSheet[10, nRow].Value.ToString();
                            expenseRow.Reimbursement = gvSharedMedBillBlueSheet[11, nRow].Value.ToString();
                        }
                        //if (rbCreditCard.Checked)
                        if (PaidToBlueSheet == EnumPaidTo.MedicalProvider)
                        {
                            expenseRow.PastCMM_Provider_Payment = gvSharedMedBillBlueSheet[10, nRow].Value.ToString();
                            expenseRow.PastReimbursement = gvSharedMedBillBlueSheet[11, nRow].Value.ToString();
                            //expenseRow.Reimbursement = gvBillPaid[12, nRow].Value.ToString();
                        }
                        expenseRow.Balance = gvSharedMedBillBlueSheet[12, nRow].Value.ToString();
                        lstPaidMedicalExpenseTableRowBlueSheet.Add(expenseRow);
                    }



                    MigraDocDOM.Tables.Table table = new MigraDocDOM.Tables.Table();
                    table.Borders.Width = 0.1;
                    table.Borders.Color = MigraDoc.DocumentObjectModel.Color.FromCmyk(100, 100, 100, 100);

                    //MigraDocDOM.Tables.Column col = table.AddColumn(Unit.FromInch(0.8));
                    //col.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                    MigraDocDOM.Tables.Column col = table.AddColumn(MigraDocDOM.Unit.FromInch(0.5));
                    col.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                    //col = table.AddColumn(MigraDocDOM.Unit.FromInch(0.6));
                    //col.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;
                    col = table.AddColumn(MigraDocDOM.Unit.FromInch(0.6));
                    col.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                    //col = table.AddColumn(MigraDocDOM.Unit.FromInch(1.4));
                    //col.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;
                    col = table.AddColumn(MigraDocDOM.Unit.FromInch(1.2));
                    col.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                    col = table.AddColumn(MigraDocDOM.Unit.FromInch(0.7));
                    col.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                    col = table.AddColumn(MigraDocDOM.Unit.FromInch(0.5));
                    col.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                    col = table.AddColumn(MigraDocDOM.Unit.FromInch(0.6));
                    col.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                    col = table.AddColumn(MigraDocDOM.Unit.FromInch(0.5));
                    col.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                    col = table.AddColumn(MigraDocDOM.Unit.FromInch(0.6));
                    col.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                    //if (rbCreditCard.Checked)
                    //{
                    //    col = table.AddColumn(MigraDocDOM.Unit.FromInch(0.6));
                    //    col.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;
                    //}

                    col = table.AddColumn(MigraDocDOM.Unit.FromInch(0.6));
                    col.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                    col = table.AddColumn(MigraDocDOM.Unit.FromInch(0.6));
                    col.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                    col = table.AddColumn(MigraDocDOM.Unit.FromInch(0.6));
                    col.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                    MigraDocDOM.Tables.Row row = table.AddRow();

                    nRowHeight += 22;
                    row.Height = "0.3in";
                    row.VerticalAlignment = MigraDocDOM.Tables.VerticalAlignment.Center;

                    //MigraDocDOM.Tables.Cell cellTitlePatientName = row.Cells[0];
                    //cellTitlePatientName.AddParagraph("회원 이름");
                    //cellTitlePatientName.Format.Font.Bold = true;
                    //cellTitlePatientName.Format.Font.Size = 7;
                    //cellTitlePatientName.Format.Font.Name = "Malgun Gothic";
                    //cellTitlePatientName.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                    MigraDocDOM.Tables.Cell cellTitleMedBill = row.Cells[0];
                    cellTitleMedBill.AddParagraph("MEDBILL");
                    cellTitleMedBill.Format.Font.Bold = true;
                    cellTitleMedBill.Format.Font.Size = 7;
                    cellTitleMedBill.Format.Font.Name = "Malgun Gothic";
                    cellTitleMedBill.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                    MigraDocDOM.Tables.Cell cellTitleBillDate = row.Cells[1];
                    cellTitleBillDate.AddParagraph("서비스 날짜");
                    cellTitleBillDate.Format.Font.Bold = true;
                    cellTitleBillDate.Format.Font.Size = 7;
                    cellTitleBillDate.Format.Font.Name = "Malgun Gothic";
                    cellTitleBillDate.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                    MigraDocDOM.Tables.Cell cellTitleMedicalProvider = row.Cells[2];
                    cellTitleMedicalProvider.AddParagraph("의료기관명");
                    cellTitleMedicalProvider.Format.Font.Bold = true;
                    cellTitleMedicalProvider.Format.Font.Size = 7;
                    cellTitleMedicalProvider.Format.Font.Name = "Malgun Gothic";
                    cellTitleMedicalProvider.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                    MigraDocDOM.Tables.Cell cellTitleBillAmount = row.Cells[3];
                    cellTitleBillAmount.AddParagraph("청구 (원금)");
                    cellTitleBillAmount.Format.Font.Bold = true;
                    cellTitleBillAmount.Format.Font.Size = 7;
                    cellTitleBillAmount.Format.Font.Name = "Malgun Gothic";
                    cellTitleBillAmount.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                    MigraDocDOM.Tables.Cell cellTitlePersonalResponsibility = row.Cells[4];
                    cellTitlePersonalResponsibility.AddParagraph("본인 부담금");
                    cellTitlePersonalResponsibility.Format.Font.Bold = true;
                    cellTitlePersonalResponsibility.Format.Font.Size = 7;
                    cellTitlePersonalResponsibility.Format.Font.Name = "Malgun Gothic";
                    cellTitlePersonalResponsibility.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                    MigraDocDOM.Tables.Cell cellTitleMemberDiscount = row.Cells[5];
                    cellTitleMemberDiscount.AddParagraph("회원 (할인)");
                    cellTitleMemberDiscount.Format.Font.Bold = true;
                    cellTitleMemberDiscount.Format.Font.Size = 7;
                    cellTitleMemberDiscount.Format.Font.Name = "Malgun Gothic";
                    cellTitleMemberDiscount.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                    MigraDocDOM.Tables.Cell cellTitleCMMDiscount = row.Cells[6];
                    cellTitleCMMDiscount.AddParagraph("CMM (할인)");
                    cellTitleCMMDiscount.Format.Font.Bold = true;
                    cellTitleCMMDiscount.Format.Font.Size = 7;
                    cellTitleCMMDiscount.Format.Font.Name = "Malgun Gothic";
                    cellTitleCMMDiscount.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                    MigraDocDOM.Tables.Cell cellTitleCMMProviderDiscount = row.Cells[7];
                    cellTitleCMMProviderDiscount.AddParagraph("의료기관 지불금");
                    cellTitleCMMProviderDiscount.Format.Font.Bold = true;
                    cellTitleCMMProviderDiscount.Format.Font.Size = 7;
                    cellTitleCMMProviderDiscount.Format.Font.Name = "Malgun Gothic";
                    cellTitleCMMProviderDiscount.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                    //if (rbCheck.Checked || rbACH.Checked)
                    if (PaidToBlueSheet == EnumPaidTo.Member)
                    {
                        MigraDocDOM.Tables.Cell cellTitlePastReimbursement = row.Cells[8];
                        cellTitlePastReimbursement.AddParagraph("기지급액");
                        cellTitlePastReimbursement.Format.Font.Bold = true;
                        cellTitlePastReimbursement.Format.Font.Size = 7;
                        cellTitlePastReimbursement.Format.Font.Name = "Malgun Gothic";
                        cellTitlePastReimbursement.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                        MigraDocDOM.Tables.Cell cellTitleReimbursement = row.Cells[9];
                        cellTitleReimbursement.AddParagraph("회원 환불금");
                        cellTitleReimbursement.Format.Font.Bold = true;
                        cellTitleReimbursement.Format.Font.Size = 7;
                        cellTitleReimbursement.Format.Font.Name = "Malgun Gothic";
                        cellTitleReimbursement.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100); ;


                    }
                    //if (rbCreditCard.Checked)
                    if (PaidToBlueSheet == EnumPaidTo.MedicalProvider)
                    {
                        MigraDocDOM.Tables.Cell cellTitlePastReimbursement = row.Cells[8];
                        cellTitlePastReimbursement.AddParagraph("기지급액 (의료기관)");
                        cellTitlePastReimbursement.Format.Font.Bold = true;
                        cellTitlePastReimbursement.Format.Font.Size = 7;
                        cellTitlePastReimbursement.Format.Font.Name = "Malgun Gothic";
                        cellTitlePastReimbursement.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                        MigraDocDOM.Tables.Cell cellTitlePastCMMProviderPayment = row.Cells[9];
                        cellTitlePastCMMProviderPayment.AddParagraph("기지급액 (회원)");
                        cellTitlePastCMMProviderPayment.Format.Font.Bold = true;
                        cellTitlePastCMMProviderPayment.Format.Font.Size = 7;
                        cellTitlePastCMMProviderPayment.Format.Font.Name = "Malgun Gothic";
                        cellTitlePastCMMProviderPayment.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                        //MigraDocDOM.Tables.Cell cellTitleReimbursement = row.Cells[10];
                        //cellTitleReimbursement.AddParagraph("회원 환불금");
                        //cellTitleReimbursement.Format.Font.Bold = true;
                        //cellTitleReimbursement.Format.Font.Size = 7;
                        //cellTitleReimbursement.Format.Font.Name = "Malgun Gothic";
                        //cellTitleReimbursement.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100); ;


                    }
                    MigraDocDOM.Tables.Cell cellTitleBalance = row.Cells[10];
                    cellTitleBalance.AddParagraph("잔액/보류");
                    cellTitleBalance.Format.Font.Bold = true;
                    cellTitleBalance.Format.Font.Size = 7;
                    cellTitleBalance.Format.Font.Name = "Malgun Gothic";
                    cellTitleBalance.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);


                    for (int i = 0; i < lstPaidMedicalExpenseTableRowBlueSheet.Count; i++)
                    {
                        if (nRowHeight > 645) nRowHeight = 0;
                        nRowHeight += 18;
                        MigraDocDOM.Tables.Row rowData = table.AddRow();
                        rowData.VerticalAlignment = MigraDocDOM.Tables.VerticalAlignment.Center;

                        if (i < lstPaidMedicalExpenseTableRowBlueSheet.Count - 1)
                        {
                            rowData.Height = "0.18in";

                            //MigraDocDOM.Tables.Cell cell = rowData.Cells[0];
                            //if (lstPaidMedicalExpenseTableRow[i].PatientName.Length > 11)
                            //{
                            //    cell.AddParagraph(lstPaidMedicalExpenseTableRow[i].PatientName.Substring(0, 11) + " ...");
                            //}
                            //else
                            //{
                            //    cell.AddParagraph(lstPaidMedicalExpenseTableRow[i].PatientName);
                            //}
                            //cell.Format.Font.Bold = false;
                            //cell.Format.Font.Name = "Malgun Gothic";
                            //cell.Format.Font.Size = 7;
                            //cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            //cell.Format.Alignment = ParagraphAlignment.Left;

                            MigraDocDOM.Tables.Cell cell = rowData.Cells[0];
                            cell.AddParagraph(lstPaidMedicalExpenseTableRowBlueSheet[i].MED_BILL);
                            cell.Format.Font.Bold = false;
                            cell.Format.Font.Name = "Malgun Gothic";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                            cell = rowData.Cells[1];
                            cell.AddParagraph(lstPaidMedicalExpenseTableRowBlueSheet[i].Bill_Date.Value.ToString("MM/dd/yy"));
                            cell.Format.Font.Bold = false;
                            cell.Format.Font.Name = "Malgun Gothic";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                            cell = rowData.Cells[2];
                            if (lstPaidMedicalExpenseTableRowBlueSheet[i].Medical_Provider.Length > 16)
                            {
                                cell.AddParagraph(lstPaidMedicalExpenseTableRowBlueSheet[i].Medical_Provider.Substring(0, 16) + " ...");
                            }
                            else
                            {
                                cell.AddParagraph(lstPaidMedicalExpenseTableRowBlueSheet[i].Medical_Provider);
                            }
                            cell.Format.Font.Bold = false;
                            cell.Format.Font.Name = "Malgun Gothic";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Left;


                            cell = rowData.Cells[3];
                            cell.AddParagraph(lstPaidMedicalExpenseTableRowBlueSheet[i].Bill_Amount);
                            cell.Format.Font.Bold = false;
                            cell.Format.Font.Name = "Malgun Gothic";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Right;

                            cell = rowData.Cells[4];
                            cell.AddParagraph(lstPaidMedicalExpenseTableRowBlueSheet[i].Personal_Responsibility);
                            cell.Format.Font.Bold = false;
                            cell.Format.Font.Name = "Malgun Gothic";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDoc.DocumentObjectModel.Color.FromCmyk(100, 100, 100, 100);
                            cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Right;

                            cell = rowData.Cells[5];
                            cell.AddParagraph(lstPaidMedicalExpenseTableRowBlueSheet[i].Member_Discount);
                            cell.Format.Font.Bold = false;
                            cell.Format.Font.Name = "Malgun Gothic";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Right;

                            cell = rowData.Cells[6];
                            cell.AddParagraph(lstPaidMedicalExpenseTableRowBlueSheet[i].CMM_Discount);
                            cell.Format.Font.Bold = false;
                            cell.Format.Font.Name = "Malgun Gothic";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Right;

                            cell = rowData.Cells[7];
                            cell.AddParagraph(lstPaidMedicalExpenseTableRowBlueSheet[i].CMM_Provider_Payment);
                            cell.Format.Font.Bold = false;
                            cell.Format.Font.Name = "Malgun Gothic";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDoc.DocumentObjectModel.Color.FromCmyk(0, 100, 100, 0);
                            cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Right;

                            //if (rbCheck.Checked || rbACH.Checked)
                            if (PaidToBlueSheet == EnumPaidTo.Member)
                            {
                                cell = rowData.Cells[8];
                                cell.AddParagraph(lstPaidMedicalExpenseTableRowBlueSheet[i].PastReimbursement);
                                cell.Format.Font.Bold = false;
                                cell.Format.Font.Name = "Malgun Gothic";
                                cell.Format.Font.Size = 7;
                                cell.Format.Font.Color = MigraDoc.DocumentObjectModel.Color.FromCmyk(100, 100, 100, 100);
                                cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Right;

                                cell = rowData.Cells[9];
                                cell.AddParagraph(lstPaidMedicalExpenseTableRowBlueSheet[i].Reimbursement);
                                cell.Format.Font.Bold = false;
                                cell.Format.Font.Name = "Malgun Gothic";
                                cell.Format.Font.Size = 7;
                                cell.Format.Font.Color = MigraDoc.DocumentObjectModel.Color.FromCmyk(0, 100, 100, 0);
                                cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Right;

                            }
                            //if (rbCreditCard.Checked)
                            if (PaidToBlueSheet == EnumPaidTo.MedicalProvider)
                            {
                                cell = rowData.Cells[8];
                                cell.AddParagraph(lstPaidMedicalExpenseTableRowBlueSheet[i].PastCMM_Provider_Payment);
                                cell.Format.Font.Bold = false;
                                cell.Format.Font.Name = "Malgun Gothic";
                                cell.Format.Font.Size = 7;
                                cell.Format.Font.Color = MigraDoc.DocumentObjectModel.Color.FromCmyk(100, 100, 100, 100);
                                cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Right;

                                cell = rowData.Cells[9];
                                cell.AddParagraph(lstPaidMedicalExpenseTableRowBlueSheet[i].PastReimbursement);
                                cell.Format.Font.Bold = false;
                                cell.Format.Font.Name = "Malgun Gothic";
                                cell.Format.Font.Size = 7;
                                cell.Format.Font.Color = MigraDoc.DocumentObjectModel.Color.FromCmyk(100, 100, 100, 100);
                                cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Right;

                                //cell = rowData.Cells[10];
                                //cell.AddParagraph(lstPaidMedicalExpenseTableRow[i].Reimbursement);
                                //cell.Format.Font.Bold = false;
                                //cell.Format.Font.Name = "Malgun Gothic";
                                //cell.Format.Font.Size = 7;
                                //cell.Format.Font.Color = MigraDoc.DocumentObjectModel.Color.FromCmyk(0, 100, 100, 0);
                                //cell.Format.Alignment = ParagraphAlignment.Right;
                            }

                            cell = rowData.Cells[10];
                            cell.AddParagraph(lstPaidMedicalExpenseTableRowBlueSheet[i].Balance);
                            cell.Format.Font.Bold = false;
                            cell.Format.Font.Name = "Malgun Gothic";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDoc.DocumentObjectModel.Color.FromCmyk(100, 100, 100, 100);
                            cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Right;

                        }
                        if (i == lstPaidMedicalExpenseTableRowBlueSheet.Count - 1)
                        {
                            rowData.Height = "0.2in";

                            //MigraDocDOM.Tables.Cell cell = rowData.Cells[0];
                            //if (lstPaidMedicalExpenseTableRow[i].PatientName.Length > 11)
                            //{
                            //    cell.AddParagraph(lstPaidMedicalExpenseTableRow[i].PatientName.Substring(0, 11) + " ...");
                            //}
                            //else
                            //{
                            //    cell.AddParagraph(lstPaidMedicalExpenseTableRow[i].PatientName);
                            //}
                            //cell.Format.Font.Bold = true;
                            //cell.Format.Font.Name = "Malgun Gothic";
                            //cell.Format.Font.Size = 7;
                            //cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                            MigraDocDOM.Tables.Cell cell = rowData.Cells[0];
                            cell.AddParagraph(lstPaidMedicalExpenseTableRowBlueSheet[i].MED_BILL);
                            cell.Format.Font.Bold = true;
                            cell.Format.Font.Name = "Malgun Gothic";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                            cell = rowData.Cells[1];
                            //cell.AddParagraph(lstPaidMedicalExpenseTableRow[i].Bill_Date.Value.ToString("MM/dd/yy"));
                            cell.Format.Font.Bold = true;
                            cell.Format.Font.Name = "Malgun Gothic";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                            cell = rowData.Cells[2];
                            if (lstPaidMedicalExpenseTableRowBlueSheet[i].Medical_Provider.Length > 22)
                            {
                                cell.AddParagraph(lstPaidMedicalExpenseTableRowBlueSheet[i].Medical_Provider.Substring(0, 22) + " ...");
                            }
                            else
                            {
                                cell.AddParagraph(lstPaidMedicalExpenseTableRowBlueSheet[i].Medical_Provider);
                            }

                            cell.Format.Font.Bold = true;
                            cell.Format.Font.Name = "Malgun Gothic";
                            cell.Format.Font.Size = 7;
                            cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                            cell = rowData.Cells[3];
                            cell.AddParagraph(lstPaidMedicalExpenseTableRowBlueSheet[i].Bill_Amount);
                            cell.Format.Font.Bold = true;
                            cell.Format.Font.Name = "Malgun Gothic";
                            cell.Format.Font.Size = 7;
                            cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Right;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                            cell = rowData.Cells[4];
                            cell.AddParagraph(lstPaidMedicalExpenseTableRowBlueSheet[i].Personal_Responsibility);
                            cell.Format.Font.Bold = false;
                            cell.Format.Font.Name = "Malgun Gothic";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Right;

                            cell = rowData.Cells[5];
                            cell.AddParagraph(lstPaidMedicalExpenseTableRowBlueSheet[i].Member_Discount);
                            cell.Format.Font.Bold = true;
                            cell.Format.Font.Name = "Malgun Gothic";
                            cell.Format.Font.Size = 7;
                            cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Right;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                            cell = rowData.Cells[6];
                            cell.AddParagraph(lstPaidMedicalExpenseTableRowBlueSheet[i].CMM_Discount);
                            cell.Format.Font.Bold = true;
                            cell.Format.Font.Name = "Malgun Gothic";
                            cell.Format.Font.Size = 7;
                            cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Right;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                            cell = rowData.Cells[7];
                            cell.AddParagraph(lstPaidMedicalExpenseTableRowBlueSheet[i].CMM_Provider_Payment);
                            cell.Format.Font.Bold = true;
                            cell.Format.Font.Name = "Malgun Gothic";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDoc.DocumentObjectModel.Color.FromCmyk(0, 100, 100, 0);
                            cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Right;

                            //if (rbCheck.Checked || rbACH.Checked)
                            if (PaidToBlueSheet == EnumPaidTo.Member)
                            {
                                cell = rowData.Cells[8];
                                cell.AddParagraph(lstPaidMedicalExpenseTableRowBlueSheet[i].PastReimbursement);
                                cell.Format.Font.Bold = true;
                                cell.Format.Font.Name = "Malgun Gothic";
                                cell.Format.Font.Size = 7;
                                cell.Format.Font.Color = MigraDoc.DocumentObjectModel.Color.FromCmyk(100, 100, 100, 100);
                                cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Right;

                                cell = rowData.Cells[9];
                                cell.AddParagraph(lstPaidMedicalExpenseTableRowBlueSheet[i].Reimbursement);
                                cell.Format.Font.Bold = true;
                                cell.Format.Font.Name = "Malgun Gothic";
                                cell.Format.Font.Size = 7;
                                cell.Format.Font.Color = MigraDoc.DocumentObjectModel.Color.FromCmyk(0, 100, 100, 0);
                                cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Right;

                            }
                            //if (rbCreditCard.Checked)
                            if (PaidToBlueSheet == EnumPaidTo.MedicalProvider)
                            {
                                cell = rowData.Cells[8];
                                cell.AddParagraph(lstPaidMedicalExpenseTableRowBlueSheet[i].PastCMM_Provider_Payment);
                                cell.Format.Font.Bold = true;
                                cell.Format.Font.Name = "Malgun Gothic";
                                cell.Format.Font.Size = 7;
                                cell.Format.Font.Color = MigraDoc.DocumentObjectModel.Color.FromCmyk(100, 100, 100, 100);
                                cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Right;

                                cell = rowData.Cells[9];
                                cell.AddParagraph(lstPaidMedicalExpenseTableRowBlueSheet[i].PastReimbursement);
                                cell.Format.Font.Bold = true;
                                cell.Format.Font.Name = "Malgun Gothic";
                                cell.Format.Font.Size = 7;
                                cell.Format.Font.Color = MigraDoc.DocumentObjectModel.Color.FromCmyk(100, 100, 100, 100);
                                cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Right;

                                //cell = rowData.Cells[10];
                                //cell.AddParagraph(lstPaidMedicalExpenseTableRow[i].Reimbursement);
                                //cell.Format.Font.Bold = true;
                                //cell.Format.Font.Name = "Malgun Gothic";
                                //cell.Format.Font.Size = 7;
                                //cell.Format.Font.Color = MigraDoc.DocumentObjectModel.Color.FromCmyk(0, 100, 100, 0);
                                //cell.Format.Alignment = ParagraphAlignment.Right;
                            }

                            cell = rowData.Cells[10];
                            cell.AddParagraph(lstPaidMedicalExpenseTableRowBlueSheet[i].Balance);
                            cell.Format.Font.Bold = true;
                            cell.Format.Font.Name = "Malgun Gothic";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDoc.DocumentObjectModel.Color.FromCmyk(100, 100, 100, 100);
                            cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Right;
                        }
                    }

                    pdfDoc.LastSection.Add(table);
                }

                int nHeightAfterCMMPendingPayment = 0;

                if (gvCMMPendingPaymentBlueSheet.RowCount > 0)
                {
                    nHeightAfterCMMPendingPayment += 22;
                    for (int nRow = 0; nRow < gvCMMPendingPaymentBlueSheet.RowCount; nRow++)
                    {
                        nHeightAfterCMMPendingPayment += 15;
                    }

                    if ((nRowHeight > 645) ||
                        (nRowHeight + nHeightAfterCMMPendingPayment) > 645)
                    {
                        nRowHeight = 0;
                        section.AddPageBreak();
                    }
                }



                //////////////////////////////////////////////////////////////////////////////////////////////////

                // The beginning of CMM Pending Payment table


                if (gvCMMPendingPaymentBlueSheet.RowCount > 0)
                {
                    lstCMMPendingPaymentTableRowBlueSheet.Clear();
                    nRowHeight += 30;

                    MigraDocDOM.Paragraph paraSpaceBefore = section.AddParagraph();
                    paraSpaceBefore.Format.SpaceBefore = "0.18in";
                    paraSpaceBefore.Format.SpaceAfter = "0.05in";
                    paraSpaceBefore.Format.Font.Color = MigraDoc.DocumentObjectModel.Color.FromCmyk(100, 100, 0, 0);
                    paraSpaceBefore.Format.Font.Name = "Malgun Gothic";
                    paraSpaceBefore.Format.Font.Size = 7;
                    paraSpaceBefore.AddFormattedText("지원 예정 의료비", MigraDocDOM.TextFormat.Bold);

                    for (int nRow = 0; nRow < gvCMMPendingPaymentBlueSheet.RowCount; nRow++)
                    {
                        CMMPendingPaymentTableRowBlueSheet cmmPendingRow = new CMMPendingPaymentTableRowBlueSheet();

                        cmmPendingRow.PatientName = gvCMMPendingPaymentBlueSheet[1, nRow].Value.ToString();
                        cmmPendingRow.MED_BILL = gvCMMPendingPaymentBlueSheet[2, nRow].Value.ToString();
                        cmmPendingRow.Bill_Date = gvCMMPendingPaymentBlueSheet[3, nRow].Value.ToString();
                        //cmmPendingRow.Due_Date = gvCMMPendingPayment[4, nRow].Value.ToString();
                        cmmPendingRow.Medical_Provider = gvCMMPendingPaymentBlueSheet[4, nRow].Value.ToString();
                        cmmPendingRow.Bill_Amount = gvCMMPendingPaymentBlueSheet[5, nRow].Value.ToString();
                        cmmPendingRow.Member_Discount = gvCMMPendingPaymentBlueSheet[6, nRow].Value.ToString();
                        cmmPendingRow.CMM_Discount = gvCMMPendingPaymentBlueSheet[7, nRow].Value.ToString();
                        cmmPendingRow.PersonalResponsibility = gvCMMPendingPaymentBlueSheet[8, nRow].Value.ToString();
                        //cmmPendingRow.Member_Discount = gvCMMPendingPayment[7, nRow].Value.ToString();
                        //cmmPendingRow.CMM_Discount = gvCMMPendingPayment[8, nRow].Value.ToString();
                        cmmPendingRow.Shared_Amount = gvCMMPendingPaymentBlueSheet[9, nRow].Value.ToString();
                        cmmPendingRow.Balance = gvCMMPendingPaymentBlueSheet[10, nRow].Value.ToString();

                        lstCMMPendingPaymentTableRowBlueSheet.Add(cmmPendingRow);
                    }

                    MigraDocDOM.Tables.Table tableCMMPendingPayment = new MigraDocDOM.Tables.Table();

                    tableCMMPendingPayment.Borders.Width = 0.1;
                    tableCMMPendingPayment.Borders.Color = MigraDoc.DocumentObjectModel.Color.FromCmyk(100, 100, 100, 100);

                    //MigraDocDOM.Tables.Column colCMMPendingPayment = tableCMMPendingPayment.AddColumn(MigraDocDOM.Unit.FromInch(0.8));
                    //colCMMPendingPayment.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                    MigraDocDOM.Tables.Column colCMMPendingPayment = tableCMMPendingPayment.AddColumn(MigraDocDOM.Unit.FromInch(0.6));
                    colCMMPendingPayment.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                    colCMMPendingPayment = tableCMMPendingPayment.AddColumn(MigraDocDOM.Unit.FromInch(0.7));
                    colCMMPendingPayment.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                    //colCMMPendingPayment = tableCMMPendingPayment.AddColumn(MigraDocDOM.Unit.FromInch(0.7));
                    //colCMMPendingPayment.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                    colCMMPendingPayment = tableCMMPendingPayment.AddColumn(MigraDocDOM.Unit.FromInch(1.4));
                    colCMMPendingPayment.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                    colCMMPendingPayment = tableCMMPendingPayment.AddColumn(MigraDocDOM.Unit.FromInch(0.8));
                    colCMMPendingPayment.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                    colCMMPendingPayment = tableCMMPendingPayment.AddColumn(MigraDocDOM.Unit.FromInch(0.7));
                    colCMMPendingPayment.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                    colCMMPendingPayment = tableCMMPendingPayment.AddColumn(MigraDocDOM.Unit.FromInch(0.6));
                    colCMMPendingPayment.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                    colCMMPendingPayment = tableCMMPendingPayment.AddColumn(MigraDocDOM.Unit.FromInch(0.6));
                    colCMMPendingPayment.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                    colCMMPendingPayment = tableCMMPendingPayment.AddColumn(MigraDocDOM.Unit.FromInch(0.8));
                    colCMMPendingPayment.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                    colCMMPendingPayment = tableCMMPendingPayment.AddColumn(MigraDocDOM.Unit.FromInch(0.8));
                    colCMMPendingPayment.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                    MigraDocDOM.Tables.Row cmm_pending_row = tableCMMPendingPayment.AddRow();

                    cmm_pending_row.Height = "0.3in";
                    cmm_pending_row.VerticalAlignment = MigraDocDOM.Tables.VerticalAlignment.Center;

                    nRowHeight += 22;

                    //MigraDocDOM.Tables.Cell cellCMMPendingTitlePatientName = cmm_pending_row.Cells[0];
                    //cellCMMPendingTitlePatientName.AddParagraph("회원 이름");
                    //cellCMMPendingTitlePatientName.Format.Font.Bold = true;
                    //cellCMMPendingTitlePatientName.Format.Font.Size = 7;
                    //cellCMMPendingTitlePatientName.Format.Font.Name = "Malgun Gothic";
                    //cellCMMPendingTitlePatientName.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                    MigraDocDOM.Tables.Cell cellCMMPendingTitleMedBill = cmm_pending_row.Cells[0];
                    cellCMMPendingTitleMedBill.AddParagraph("MEDBILL");
                    cellCMMPendingTitleMedBill.Format.Font.Bold = true;
                    cellCMMPendingTitleMedBill.Format.Font.Size = 7;
                    cellCMMPendingTitleMedBill.Format.Font.Name = "Malgun Gothic";
                    cellCMMPendingTitleMedBill.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                    MigraDocDOM.Tables.Cell cellCMMPendingTitleBillDate = cmm_pending_row.Cells[1];
                    cellCMMPendingTitleBillDate.AddParagraph("서비스 날짜");
                    cellCMMPendingTitleBillDate.Format.Font.Bold = true;
                    cellCMMPendingTitleBillDate.Format.Font.Size = 7;
                    cellCMMPendingTitleBillDate.Format.Font.Name = "Malgun Gothic";
                    cellCMMPendingTitleBillDate.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                    //MigraDocDOM.Tables.Cell cellCMMPendingTitleDueDate = cmm_pending_row.Cells[3];
                    //cellCMMPendingTitleDueDate.AddParagraph("접수 날짜");
                    //cellCMMPendingTitleDueDate.Format.Font.Bold = true;
                    //cellCMMPendingTitleDueDate.Format.Font.Size = 7;
                    //cellCMMPendingTitleDueDate.Format.Font.Name = "Malgun Gothic";
                    //cellCMMPendingTitleDueDate.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                    MigraDocDOM.Tables.Cell cellCMMPendingTitleMedicalProvider = cmm_pending_row.Cells[2];
                    cellCMMPendingTitleMedicalProvider.AddParagraph("의료기관명");
                    cellCMMPendingTitleMedicalProvider.Format.Font.Bold = true;
                    cellCMMPendingTitleMedicalProvider.Format.Font.Size = 7;
                    cellCMMPendingTitleMedicalProvider.Format.Font.Name = "Malgun Gothic";
                    cellCMMPendingTitleMedicalProvider.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                    MigraDocDOM.Tables.Cell cellCMMPendingTitleBillAmount = cmm_pending_row.Cells[3];
                    cellCMMPendingTitleBillAmount.AddParagraph("청구액(원금)");
                    cellCMMPendingTitleBillAmount.Format.Font.Bold = true;
                    cellCMMPendingTitleBillAmount.Format.Font.Size = 7;
                    cellCMMPendingTitleBillAmount.Format.Font.Name = "Malgun Gothic";
                    cellCMMPendingTitleBillAmount.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                    MigraDocDOM.Tables.Cell cellCMMPendingTitleMemberDiscount = cmm_pending_row.Cells[4];
                    cellCMMPendingTitleMemberDiscount.AddParagraph("회원할인");
                    cellCMMPendingTitleMemberDiscount.Format.Font.Bold = true;
                    cellCMMPendingTitleMemberDiscount.Format.Font.Size = 7;
                    cellCMMPendingTitleMemberDiscount.Format.Font.Name = "Malgun Gothic";
                    cellCMMPendingTitleMemberDiscount.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                    MigraDocDOM.Tables.Cell cellCMMPendingTitleCMMDiscount = cmm_pending_row.Cells[5];
                    cellCMMPendingTitleCMMDiscount.AddParagraph("CMM 할인");
                    cellCMMPendingTitleCMMDiscount.Format.Font.Bold = true;
                    cellCMMPendingTitleCMMDiscount.Format.Font.Size = 7;
                    cellCMMPendingTitleCMMDiscount.Format.Font.Name = "Malgun Gothic";
                    cellCMMPendingTitleCMMDiscount.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                    MigraDocDOM.Tables.Cell cellCMMPendingTitlePersonalResponsibility = cmm_pending_row.Cells[6];
                    cellCMMPendingTitlePersonalResponsibility.AddParagraph("본인 부담금");
                    cellCMMPendingTitlePersonalResponsibility.Format.Font.Bold = true;
                    cellCMMPendingTitlePersonalResponsibility.Format.Font.Size = 7;
                    cellCMMPendingTitlePersonalResponsibility.Format.Font.Name = "Malgun Gothic";
                    cellCMMPendingTitlePersonalResponsibility.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                    MigraDocDOM.Tables.Cell cellCMMPendingTitleSharedAmount = cmm_pending_row.Cells[7];
                    cellCMMPendingTitleSharedAmount.AddParagraph("정산 완료");
                    cellCMMPendingTitleSharedAmount.Format.Font.Bold = true;
                    cellCMMPendingTitleSharedAmount.Format.Font.Size = 7;
                    cellCMMPendingTitleSharedAmount.Format.Font.Name = "Malgun Gothic";
                    cellCMMPendingTitleSharedAmount.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                    MigraDocDOM.Tables.Cell cellCMMPendingTitleBalance = cmm_pending_row.Cells[8];
                    cellCMMPendingTitleBalance.AddParagraph("지원 예정");
                    cellCMMPendingTitleBalance.Format.Font.Bold = true;
                    cellCMMPendingTitleBalance.Format.Font.Size = 7;
                    cellCMMPendingTitleBalance.Format.Font.Name = "Malgun Gothic";
                    cellCMMPendingTitleBalance.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                    for (int i = 0; i < lstCMMPendingPaymentTableRowBlueSheet.Count; i++)
                    {
                        nRowHeight += 18;
                        MigraDocDOM.Tables.Row rowData = tableCMMPendingPayment.AddRow();
                        rowData.VerticalAlignment = MigraDocDOM.Tables.VerticalAlignment.Center;

                        if (i < lstCMMPendingPaymentTableRowBlueSheet.Count - 1)
                        {
                            rowData.Height = "0.18in";

                            //MigraDocDOM.Tables.Cell cell = rowData.Cells[0];
                            //if (lstCMMPendingPaymentTableRow[i].PatientName.Length > 11)
                            //{
                            //    cell.AddParagraph(lstCMMPendingPaymentTableRow[i].PatientName.Substring(0, 11) + " ...");
                            //}
                            //else
                            //{
                            //    cell.AddParagraph(lstCMMPendingPaymentTableRow[i].PatientName);
                            //}
                            //cell.Format.Font.Bold = false;
                            //cell.Format.Font.Name = "Malgun Gothic";
                            //cell.Format.Font.Size = 7;
                            //cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            //cell.Format.Alignment = ParagraphAlignment.Left;

                            MigraDocDOM.Tables.Cell cell = rowData.Cells[0];
                            cell.AddParagraph(lstCMMPendingPaymentTableRowBlueSheet[i].MED_BILL);
                            cell.Format.Font.Bold = false;
                            cell.Format.Font.Name = "Malgun Gothic";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                            cell = rowData.Cells[1];
                            cell.AddParagraph(lstCMMPendingPaymentTableRowBlueSheet[i].Bill_Date);
                            cell.Format.Font.Bold = false;
                            cell.Format.Font.Name = "Malgun Gothic";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                            //cell = rowData.Cells[3];
                            //cell.AddParagraph(lstCMMPendingPaymentTableRow[i].Due_Date);
                            //cell.Format.Font.Bold = false;
                            //cell.Format.Font.Name = "Malgun Gothic";
                            //cell.Format.Font.Size = 7;
                            //cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                            cell = rowData.Cells[2];
                            if (lstCMMPendingPaymentTableRowBlueSheet[i].Medical_Provider.Length > 23)
                            {
                                cell.AddParagraph(lstCMMPendingPaymentTableRowBlueSheet[i].Medical_Provider.Substring(0, 23) + " ...");
                            }
                            else
                            {
                                cell.AddParagraph(lstCMMPendingPaymentTableRowBlueSheet[i].Medical_Provider);
                            }
                            cell.Format.Font.Bold = false;
                            cell.Format.Font.Name = "Malgun Gothic";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Left;

                            cell = rowData.Cells[3];
                            cell.AddParagraph(lstCMMPendingPaymentTableRowBlueSheet[i].Bill_Amount);
                            cell.Format.Font.Bold = false;
                            cell.Format.Font.Name = "Malgun Gothic";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Right;

                            cell = rowData.Cells[4];
                            cell.AddParagraph(lstCMMPendingPaymentTableRowBlueSheet[i].Member_Discount);
                            cell.Format.Font.Bold = false;
                            cell.Format.Font.Name = "Malgun Gothic";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Right;

                            cell = rowData.Cells[5];
                            cell.AddParagraph(lstCMMPendingPaymentTableRowBlueSheet[i].CMM_Discount);
                            cell.Format.Font.Bold = false;
                            cell.Format.Font.Name = "Malgun Gothic";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Right;

                            cell = rowData.Cells[6];
                            cell.AddParagraph(lstCMMPendingPaymentTableRowBlueSheet[i].PersonalResponsibility);
                            cell.Format.Font.Bold = false;
                            cell.Format.Font.Name = "Malgun Gothic";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Right;


                            cell = rowData.Cells[7];
                            cell.AddParagraph(lstCMMPendingPaymentTableRowBlueSheet[i].Shared_Amount);
                            cell.Format.Font.Bold = false;
                            cell.Format.Font.Name = "Malgun Gothic";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Right;

                            cell = rowData.Cells[8];
                            cell.AddParagraph(lstCMMPendingPaymentTableRowBlueSheet[i].Balance);
                            cell.Format.Font.Bold = false;
                            cell.Format.Font.Name = "Malgun Gothic";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(0, 100, 100, 0);
                            cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Right;
                        }
                        if (i == lstCMMPendingPaymentTableRowBlueSheet.Count - 1)
                        {
                            rowData.Height = "0.2in";

                            //MigraDocDOM.Tables.Cell cell = rowData.Cells[0];
                            //if (lstCMMPendingPaymentTableRow[i].PatientName.Length > 11)
                            //{
                            //    cell.AddParagraph(lstCMMPendingPaymentTableRow[i].PatientName.Substring(0, 11) + " ...");
                            //}
                            //else
                            //{
                            //    cell.AddParagraph(lstCMMPendingPaymentTableRow[i].PatientName);
                            //}
                            //cell.Format.Font.Bold = true;
                            //cell.Format.Font.Name = "Malgun Gothic";
                            //cell.Format.Font.Size = 7;
                            //cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            //cell.Format.Alignment = ParagraphAlignment.Left;

                            MigraDocDOM.Tables.Cell cell = rowData.Cells[0];
                            cell.AddParagraph(lstCMMPendingPaymentTableRowBlueSheet[i].MED_BILL);
                            cell.Format.Font.Bold = true;
                            cell.Format.Font.Name = "Malgun Gothic";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                            cell = rowData.Cells[1];
                            cell.AddParagraph(lstCMMPendingPaymentTableRowBlueSheet[i].Bill_Date);
                            cell.Format.Font.Bold = true;
                            cell.Format.Font.Name = "Malgun Gothic";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                            //cell = rowData.Cells[3];
                            //cell.AddParagraph(lstCMMPendingPaymentTableRow[i].Due_Date);
                            //cell.Format.Font.Bold = true;
                            //cell.Format.Font.Name = "Malgun Gothic";
                            //cell.Format.Font.Size = 7;
                            //cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                            cell = rowData.Cells[2];
                            if (lstCMMPendingPaymentTableRowBlueSheet[i].Medical_Provider.Length > 25)
                            {
                                cell.AddParagraph(lstCMMPendingPaymentTableRowBlueSheet[i].Medical_Provider.Substring(0, 25) + " ...");
                            }
                            else
                            {
                                cell.AddParagraph(lstCMMPendingPaymentTableRowBlueSheet[i].Medical_Provider);
                            }

                            cell.Format.Font.Bold = true;
                            cell.Format.Font.Name = "Malgun Gothic";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                            cell = rowData.Cells[3];
                            cell.AddParagraph(lstCMMPendingPaymentTableRowBlueSheet[i].Bill_Amount);
                            cell.Format.Font.Bold = true;
                            cell.Format.Font.Name = "Malgun Gothic";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Right;

                            cell = rowData.Cells[4];
                            cell.AddParagraph(lstCMMPendingPaymentTableRowBlueSheet[i].Member_Discount);
                            cell.Format.Font.Bold = true;
                            cell.Format.Font.Name = "Malgun Gothic";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Right;

                            cell = rowData.Cells[5];
                            cell.AddParagraph(lstCMMPendingPaymentTableRowBlueSheet[i].CMM_Discount);
                            cell.Format.Font.Bold = true;
                            cell.Format.Font.Name = "Malgun Gothic";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Right;

                            cell = rowData.Cells[6];
                            cell.AddParagraph(lstCMMPendingPaymentTableRowBlueSheet[i].PersonalResponsibility);
                            cell.Format.Font.Bold = true;
                            cell.Format.Font.Name = "Malgun Gothic";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Right;

                            cell = rowData.Cells[7];
                            cell.AddParagraph(lstCMMPendingPaymentTableRowBlueSheet[i].Shared_Amount);
                            cell.Format.Font.Bold = true;
                            cell.Format.Font.Name = "Malgun Gothic";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Right;

                            cell = rowData.Cells[8];
                            cell.AddParagraph(lstCMMPendingPaymentTableRowBlueSheet[i].Balance);
                            cell.Format.Font.Bold = true;
                            cell.Format.Font.Name = "Malgun Gothic";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(0, 100, 100, 0);
                            cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Right;
                        }
                    }

                    pdfDoc.LastSection.Add(tableCMMPendingPayment);
                }

                int nHeightAfterPending = 0;

                if (gvPendingBlueSheet.RowCount > 0)
                {
                    nHeightAfterPending += 22;
                    for (int nRow = 0; nRow < gvPendingBlueSheet.RowCount; nRow++)
                    {
                        nHeightAfterPending += 15;
                    }

                    if ((nRowHeight > 645) || ((nRowHeight + nHeightAfterPending) > 645))
                    {
                        nRowHeight = 0;
                        section.AddPageBreak();
                    }
                }

                // Pending table
                if (gvPendingBlueSheet.RowCount > 0)
                {
                    lstPendingTableRowBlueSheet.Clear();

                    nRowHeight += 18;

                    MigraDocDOM.Paragraph paraSpaceBefore = section.AddParagraph();
                    paraSpaceBefore.Format.SpaceBefore = "0.18in";
                    paraSpaceBefore.Format.SpaceAfter = "0.05in";
                    paraSpaceBefore.Format.Font.Color = MigraDoc.DocumentObjectModel.Color.FromCmyk(0, 100, 100, 0);
                    paraSpaceBefore.Format.Font.Name = "Malgun Gothic";
                    paraSpaceBefore.Format.Font.Size = 7;
                    paraSpaceBefore.AddFormattedText("보류 중인 의료비", MigraDocDOM.TextFormat.Bold);

                    for (int nRow = 0; nRow < gvPendingBlueSheet.RowCount; nRow++)
                    {
                        nRowHeight += 12;

                        PendingTableRowBlueSheet pendingRow = new PendingTableRowBlueSheet();
                        pendingRow.PatientName = gvPendingBlueSheet[1, nRow].Value.ToString();
                        pendingRow.MED_BILL = gvPendingBlueSheet[2, nRow].Value.ToString();
                        pendingRow.Bill_Date = gvPendingBlueSheet[3, nRow].Value.ToString();
                        pendingRow.Due_Date = gvPendingBlueSheet[4, nRow].Value.ToString();
                        pendingRow.Medical_Provider = gvPendingBlueSheet[5, nRow].Value.ToString();
                        pendingRow.Bill_Amount = gvPendingBlueSheet[6, nRow].Value.ToString();
                        pendingRow.Balance = gvPendingBlueSheet[7, nRow].Value.ToString();
                        //pendingRow.Member_Discount = gvPending[7, nRow].Value.ToString();
                        //pendingRow.CMM_Discount = gvPending[8, nRow].Value.ToString();
                        //pendingRow.Shared_Amount = gvPending[9, nRow].Value.ToString();
                        //pendingRow.Balance = gvPending[10, nRow].Value.ToString();
                        pendingRow.Pending_Reason = gvPendingBlueSheet[8, nRow].Value.ToString();

                        lstPendingTableRowBlueSheet.Add(pendingRow);
                    }

                    MigraDocDOM.Tables.Table tablePending = new MigraDocDOM.Tables.Table();
                    tablePending.Borders.Width = 0.1;
                    tablePending.Borders.Color = MigraDoc.DocumentObjectModel.Color.FromCmyk(100, 100, 100, 100);

                    //MigraDocDOM.Tables.Column colPending = tablePending.AddColumn(MigraDocDOM.Unit.FromInch(0.8));
                    //colPending.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                    MigraDocDOM.Tables.Column colPending = tablePending.AddColumn(MigraDocDOM.Unit.FromInch(0.5));
                    colPending.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                    colPending = tablePending.AddColumn(MigraDocDOM.Unit.FromInch(0.5));
                    colPending.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                    colPending = tablePending.AddColumn(MigraDocDOM.Unit.FromInch(0.5));
                    colPending.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                    colPending = tablePending.AddColumn(MigraDocDOM.Unit.FromInch(1.3));
                    colPending.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                    colPending = tablePending.AddColumn(MigraDocDOM.Unit.FromInch(0.6));
                    colPending.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                    colPending = tablePending.AddColumn(MigraDocDOM.Unit.FromInch(0.6));
                    colPending.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;


                    //colPending = tablePending.AddColumn(MigraDocDOM.Unit.FromInch(0.6));
                    //colPending.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                    //colPending = tablePending.AddColumn(MigraDocDOM.Unit.FromInch(0.5));
                    //colPending.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                    //colPending = tablePending.AddColumn(MigraDocDOM.Unit.FromInch(0.6));
                    //colPending.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                    //colPending = tablePending.AddColumn(MigraDocDOM.Unit.FromInch(0.6));
                    //colPending.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                    colPending = tablePending.AddColumn(MigraDocDOM.Unit.FromInch(3));
                    colPending.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                    MigraDocDOM.Tables.Row pending_Row = tablePending.AddRow();

                    nRowHeight += 22;

                    pending_Row.Height = "0.3in";
                    pending_Row.VerticalAlignment = MigraDocDOM.Tables.VerticalAlignment.Center;

                    //MigraDocDOM.Tables.Cell cellPendingTitleINCD = pending_Row.Cells[0];
                    //cellPendingTitleINCD.AddParagraph("회원 이름");
                    //cellPendingTitleINCD.Format.Font.Bold = true;
                    //cellPendingTitleINCD.Format.Font.Size = 7;
                    //cellPendingTitleINCD.Format.Font.Name = "Malgun Gothic";
                    //cellPendingTitleINCD.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                    MigraDocDOM.Tables.Cell cellPendingTitleMED_BILL = pending_Row.Cells[0];
                    cellPendingTitleMED_BILL.AddParagraph("MEDBILL");
                    cellPendingTitleMED_BILL.Format.Font.Bold = true;
                    cellPendingTitleMED_BILL.Format.Font.Size = 7;
                    cellPendingTitleMED_BILL.Format.Font.Name = "Malgun Gothic";
                    cellPendingTitleMED_BILL.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                    MigraDocDOM.Tables.Cell cellPendingTitleBill_Date = pending_Row.Cells[1];
                    cellPendingTitleBill_Date.AddParagraph("서비스 날짜");
                    cellPendingTitleBill_Date.Format.Font.Bold = true;
                    cellPendingTitleBill_Date.Format.Font.Size = 7;
                    cellPendingTitleBill_Date.Format.Font.Name = "Malgun Gothic";
                    cellPendingTitleBill_Date.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                    MigraDocDOM.Tables.Cell cellPendingTitleDue_Date = pending_Row.Cells[2];
                    cellPendingTitleDue_Date.AddParagraph("접수 날짜");
                    cellPendingTitleDue_Date.Format.Font.Bold = true;
                    cellPendingTitleDue_Date.Format.Font.Size = 7;
                    cellPendingTitleDue_Date.Format.Font.Name = "Malgun Gothic";
                    cellPendingTitleDue_Date.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                    MigraDocDOM.Tables.Cell cellPendingTitleMedicalProvider = pending_Row.Cells[3];
                    cellPendingTitleMedicalProvider.AddParagraph("의료기관명");
                    cellPendingTitleMedicalProvider.Format.Font.Bold = true;
                    cellPendingTitleMedicalProvider.Format.Font.Size = 7;
                    cellPendingTitleMedicalProvider.Format.Font.Name = "Malgun Gothic";
                    cellPendingTitleMedicalProvider.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                    MigraDocDOM.Tables.Cell cellPendingTitleBillAmount = pending_Row.Cells[4];
                    cellPendingTitleBillAmount.AddParagraph("청구 (원금)");
                    cellPendingTitleBillAmount.Format.Font.Bold = true;
                    cellPendingTitleBillAmount.Format.Font.Size = 7;
                    cellPendingTitleBillAmount.Format.Font.Name = "Malgun Gothic";
                    cellPendingTitleBillAmount.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                    MigraDocDOM.Tables.Cell cellPendingTitleBalance = pending_Row.Cells[5];
                    cellPendingTitleBalance.AddParagraph("잔액/보류");
                    cellPendingTitleBalance.Format.Font.Bold = true;
                    cellPendingTitleBalance.Format.Font.Size = 7;
                    cellPendingTitleBalance.Format.Font.Name = "Malgun Gothic";
                    cellPendingTitleBalance.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                    //MigraDocDOM.Tables.Cell cellPendingTitleMemberDiscount = pending_Row.Cells[6];
                    //cellPendingTitleMemberDiscount.AddParagraph("회원 (할인)");
                    //cellPendingTitleMemberDiscount.Format.Font.Bold = true;
                    //cellPendingTitleMemberDiscount.Format.Font.Size = 7;
                    //cellPendingTitleMemberDiscount.Format.Font.Name = "Malgun Gothic";
                    //cellPendingTitleMemberDiscount.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                    //MigraDocDOM.Tables.Cell cellPendingTitleCMMDiscount = pending_Row.Cells[7];
                    //cellPendingTitleCMMDiscount.AddParagraph("CMM (할인)");
                    //cellPendingTitleCMMDiscount.Format.Font.Bold = true;
                    //cellPendingTitleCMMDiscount.Format.Font.Size = 7;
                    //cellPendingTitleCMMDiscount.Format.Font.Name = "Malgun Gothic";
                    //cellPendingTitleCMMDiscount.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                    //MigraDocDOM.Tables.Cell cellPendingTitleSharedAmount = pending_Row.Cells[8];
                    //cellPendingTitleSharedAmount.AddParagraph("정산 완료");
                    //cellPendingTitleSharedAmount.Format.Font.Bold = true;
                    //cellPendingTitleSharedAmount.Format.Font.Size = 7;
                    //cellPendingTitleSharedAmount.Format.Font.Name = "Malgun Gothic";
                    //cellPendingTitleSharedAmount.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                    //MigraDocDOM.Tables.Cell cellPendingTitleBalance = pending_Row.Cells[9];
                    //cellPendingTitleBalance.AddParagraph("보류");
                    //cellPendingTitleBalance.Format.Font.Bold = true;
                    //cellPendingTitleBalance.Format.Font.Size = 7;
                    //cellPendingTitleBalance.Format.Font.Name = "Malgun Gothic";
                    //cellPendingTitleBalance.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                    MigraDocDOM.Tables.Cell cellPendingTitlePendingReason = pending_Row.Cells[6];
                    cellPendingTitlePendingReason.AddParagraph("보류 사유");
                    cellPendingTitlePendingReason.Format.Font.Bold = true;
                    cellPendingTitlePendingReason.Format.Font.Size = 7;
                    cellPendingTitlePendingReason.Format.Font.Name = "Malgun Gothic";
                    cellPendingTitlePendingReason.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                    for (int i = 0; i < lstPendingTableRowBlueSheet.Count; i++)
                    {
                        MigraDocDOM.Tables.Row pendingRowData = tablePending.AddRow();
                        pendingRowData.VerticalAlignment = MigraDocDOM.Tables.VerticalAlignment.Center;

                        if (i < lstPendingTableRowBlueSheet.Count - 1)
                        {
                            pendingRowData.Height = "0.18in";

                            //MigraDocDOM.Tables.Cell cell = pendingRowData.Cells[0];
                            //if (lstPendingTableRow[i].PatientName.Length > 11)
                            //{
                            //    cell.AddParagraph(lstPendingTableRow[i].PatientName.Substring(0, 11) + " ...");
                            //}
                            //else
                            //{
                            //    cell.AddParagraph(lstPendingTableRow[i].PatientName);
                            //}
                            //cell.Format.Font.Bold = false;
                            //cell.Format.Font.Name = "Malgun Gothic";
                            //cell.Format.Font.Size = 7;
                            //cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            //cell.Format.Alignment = ParagraphAlignment.Left;

                            MigraDocDOM.Tables.Cell cell = pendingRowData.Cells[0];
                            cell.AddParagraph(lstPendingTableRowBlueSheet[i].MED_BILL);
                            cell.Format.Font.Bold = false;
                            cell.Format.Font.Name = "Malgun Gothic";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                            cell = pendingRowData.Cells[1];
                            DateTime dtBillDate = DateTime.Parse(lstPendingTableRowBlueSheet[i].Bill_Date);
                            cell.AddParagraph(dtBillDate.ToString("MM/dd/yy"));
                            //cell.AddParagraph(lstPendingTableRow[i].Bill_Date);
                            cell.Format.Font.Bold = false;
                            cell.Format.Font.Name = "Malgun Gothic";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                            cell = pendingRowData.Cells[2];
                            DateTime dtDueDate = new DateTime();
                            if (lstPendingTableRowBlueSheet[i].Due_Date != String.Empty)
                            {
                                dtDueDate = DateTime.Parse(lstPendingTableRowBlueSheet[i].Due_Date);
                                cell.AddParagraph(dtDueDate.ToString("MM/dd/yy"));
                            }
                            //cell.AddParagraph(lstPendingTableRow[i].Due_Date);
                            cell.Format.Font.Bold = false;
                            cell.Format.Font.Name = "Malgun Gothic";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                            cell = pendingRowData.Cells[3];

                            if (lstPendingTableRowBlueSheet[i].Medical_Provider.Length > 20)
                            {
                                cell.AddParagraph(lstPendingTableRowBlueSheet[i].Medical_Provider.Substring(0, 20) + " ...");
                            }
                            else
                            {
                                cell.AddParagraph(lstPendingTableRowBlueSheet[i].Medical_Provider);
                            }
                            cell.Format.Font.Bold = false;
                            cell.Format.Font.Name = "Malgun Gothic";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Left;

                            cell = pendingRowData.Cells[4];
                            cell.AddParagraph(lstPendingTableRowBlueSheet[i].Bill_Amount);
                            cell.Format.Font.Bold = false;
                            cell.Format.Font.Name = "Malgun Gothic";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Right;

                            cell = pendingRowData.Cells[5];
                            cell.AddParagraph(lstPendingTableRowBlueSheet[i].Balance);
                            cell.Format.Font.Bold = false;
                            cell.Format.Font.Name = "Malgun Gothic";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Right;

                            //cell = pendingRowData.Cells[6];
                            //cell.AddParagraph(lstPendingTableRow[i].Member_Discount);
                            //cell.Format.Font.Bold = false;
                            //cell.Format.Font.Name = "Malgun Gothic";
                            //cell.Format.Font.Size = 7;
                            //cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            //cell.Format.Alignment = ParagraphAlignment.Right;

                            //cell = pendingRowData.Cells[7];
                            //cell.AddParagraph(lstPendingTableRow[i].CMM_Discount);
                            //cell.Format.Font.Bold = false;
                            //cell.Format.Font.Name = "Malgun Gothic";
                            //cell.Format.Font.Size = 7;
                            //cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            //cell.Format.Alignment = ParagraphAlignment.Right;

                            //cell = pendingRowData.Cells[8];
                            //cell.AddParagraph(lstPendingTableRow[i].Shared_Amount);
                            //cell.Format.Font.Bold = false;
                            //cell.Format.Font.Name = "Malgun Gothic";
                            //cell.Format.Font.Size = 7;
                            //cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            //cell.Format.Alignment = ParagraphAlignment.Right;

                            //cell = pendingRowData.Cells[9];
                            //cell.AddParagraph(lstPendingTableRow[i].Balance);
                            //cell.Format.Font.Bold = false;
                            //cell.Format.Font.Name = "Malgun Gothic";
                            //cell.Format.Font.Size = 7;
                            //cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            //cell.Format.Alignment = ParagraphAlignment.Right;

                            cell = pendingRowData.Cells[6];
                            if (lstPendingTableRowBlueSheet[i].Pending_Reason.Length > 40)
                            {
                                cell.AddParagraph(lstPendingTableRowBlueSheet[i].Pending_Reason.Substring(0, 40) + " ...");
                            }
                            else
                            {
                                cell.AddParagraph(lstPendingTableRowBlueSheet[i].Pending_Reason);
                            }
                            cell.Format.Font.Bold = false;
                            cell.Format.Font.Name = "Malgun Gothic";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Left;

                        }
                        if (i == lstPendingTableRowBlueSheet.Count - 1)
                        {
                            pendingRowData.Height = "0.2in";

                            //MigraDocDOM.Tables.Cell cell = pendingRowData.Cells[0];
                            //if (lstPendingTableRow[i].PatientName.Length > 11)
                            //{
                            //    cell.AddParagraph(lstPendingTableRow[i].PatientName.Substring(0, 11));
                            //}
                            //else
                            //{
                            //    cell.AddParagraph(lstPendingTableRow[i].PatientName);
                            //}
                            //cell.Format.Font.Bold = true;
                            //cell.Format.Font.Name = "Malgun Gothic";
                            //cell.Format.Font.Size = 7;
                            //cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            //cell.Format.Alignment = ParagraphAlignment.Left;

                            MigraDocDOM.Tables.Cell cell = pendingRowData.Cells[0];
                            cell.AddParagraph(lstPendingTableRowBlueSheet[i].MED_BILL);
                            cell.Format.Font.Bold = true;
                            cell.Format.Font.Name = "Malgun Gothic";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                            cell = pendingRowData.Cells[1];
                            cell.AddParagraph(lstPendingTableRowBlueSheet[i].Bill_Date);
                            cell.Format.Font.Bold = true;
                            cell.Format.Font.Name = "Malgun Gothic";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                            cell = pendingRowData.Cells[2];
                            cell.AddParagraph(lstPendingTableRowBlueSheet[i].Due_Date);
                            cell.Format.Font.Bold = true;
                            cell.Format.Font.Name = "Malgun Gothic";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                            cell = pendingRowData.Cells[3];
                            if (lstPendingTableRowBlueSheet[i].Medical_Provider.Length > 20)
                            {
                                cell.AddParagraph(lstPendingTableRowBlueSheet[i].Medical_Provider.Substring(0, 20) + " ...");
                            }
                            else
                            {
                                cell.AddParagraph(lstPendingTableRowBlueSheet[i].Medical_Provider);
                            }

                            cell.Format.Font.Bold = true;
                            cell.Format.Font.Name = "Malgun Gothic";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                            cell = pendingRowData.Cells[4];
                            cell.AddParagraph(lstPendingTableRowBlueSheet[i].Bill_Amount);
                            cell.Format.Font.Bold = true;
                            cell.Format.Font.Name = "Malgun Gothic";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Right;

                            cell = pendingRowData.Cells[5];
                            cell.AddParagraph(lstPendingTableRowBlueSheet[i].Balance);
                            cell.Format.Font.Bold = true;
                            cell.Format.Font.Name = "Malgun Gothic";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Right;

                            //cell = pendingRowData.Cells[6];
                            //cell.AddParagraph(lstPendingTableRow[i].Member_Discount);
                            //cell.Format.Font.Bold = true;
                            //cell.Format.Font.Name = "Malgun Gothic";
                            //cell.Format.Font.Size = 7;
                            //cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            //cell.Format.Alignment = ParagraphAlignment.Right;

                            //cell = pendingRowData.Cells[7];
                            //cell.AddParagraph(lstPendingTableRow[i].CMM_Discount);
                            //cell.Format.Font.Bold = true;
                            //cell.Format.Font.Name = "Malgun Gothic";
                            //cell.Format.Font.Size = 7;
                            //cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            //cell.Format.Alignment = ParagraphAlignment.Right;

                            //cell = pendingRowData.Cells[8];
                            //cell.AddParagraph(lstPendingTableRow[i].Shared_Amount);
                            //cell.Format.Font.Bold = true;
                            //cell.Format.Font.Name = "Malgun Gothic";
                            //cell.Format.Font.Size = 7;
                            //cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            //cell.Format.Alignment = ParagraphAlignment.Right;

                            //cell = pendingRowData.Cells[9];
                            //cell.AddParagraph(lstPendingTableRow[i].Balance);
                            //cell.Format.Font.Bold = true;
                            //cell.Format.Font.Name = "Malgun Gothic";
                            //cell.Format.Font.Size = 7;
                            //cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            //cell.Format.Alignment = ParagraphAlignment.Right;

                            cell = pendingRowData.Cells[6];
                            if (lstPendingTableRowBlueSheet[i].Pending_Reason.Length > 40)
                            {
                                cell.AddParagraph(lstPendingTableRowBlueSheet[i].Pending_Reason.Substring(0, 40) + " ...");
                            }
                            else
                            {
                                cell.AddParagraph(lstPendingTableRowBlueSheet[i].Pending_Reason);
                            }
                            //cell.AddParagraph(lstPendingTableRow[i].Pending_Reason);
                            cell.Format.Font.Bold = true;
                            cell.Format.Font.Name = "Malgun Gothic";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Left;

                        }

                    }

                    pdfDoc.LastSection.Add(tablePending);
                }

                //int nHeightAfterIneligible = 0;

                //if (gvIneligible.RowCount > 0)
                //{
                //    nHeightAfterIneligible += 22;
                //    for (int nRow = 0; nRow < gvIneligible.RowCount; nRow++)
                //    {
                //        nHeightAfterIneligible += 15;
                //    }
                //}

                //if ((nRowHeight > 645) ||
                //    (nRowHeight + nHeightAfterIneligible) > 645)
                //{
                //    nRowHeight = 0;
                //    section.AddPageBreak();
                //}

                lstBillIneligibleTableRowBlueSheet.Clear();

                for (int nRow = 0; nRow < gvIneligibleBlueSheet.RowCount; nRow++)
                {
                    //if ((gvIneligible[4, nRow].Value.ToString() != "") &&
                    //    (DateTime.Parse(gvIneligible[4, nRow].Value.ToString()) > dtDocReceivedDate.Value))
                    if (gvIneligibleBlueSheet[4, nRow].Value.ToString() != String.Empty)
                    {
                        BillIneligibleTableRowBlueSheet ineligibleRow = new BillIneligibleTableRowBlueSheet();
                        ineligibleRow.PatientName = gvIneligibleBlueSheet[1, nRow].Value.ToString();
                        ineligibleRow.MED_BILL = gvIneligibleBlueSheet[2, nRow].Value.ToString();
                        ineligibleRow.Bill_Date = gvIneligibleBlueSheet[3, nRow].Value.ToString();
                        ineligibleRow.Received_Date = gvIneligibleBlueSheet[4, nRow].Value.ToString();
                        ineligibleRow.Medical_Provider = gvIneligibleBlueSheet[5, nRow].Value.ToString();
                        ineligibleRow.Bill_Amount = gvIneligibleBlueSheet[6, nRow].Value.ToString();
                        ineligibleRow.Amount_Ineligible = gvIneligibleBlueSheet[7, nRow].Value.ToString();
                        ineligibleRow.Ineligible_Reason = gvIneligibleBlueSheet[8, nRow].Value.ToString();

                        lstBillIneligibleTableRowBlueSheet.Add(ineligibleRow);
                    }
                    //if (gvIneligible[4, nRow].Value.ToString() == "")
                    //{
                    //    BillIneligibleTableRow ineligibleRow = new BillIneligibleTableRow();
                    //    ineligibleRow.PatientName = gvIneligible[1, nRow].Value.ToString();
                    //    ineligibleRow.MED_BILL = gvIneligible[2, nRow].Value.ToString();
                    //    ineligibleRow.Bill_Date = gvIneligible[3, nRow].Value.ToString();
                    //    ineligibleRow.Received_Date = gvIneligible[4, nRow].Value.ToString();
                    //    ineligibleRow.Medical_Provider = gvIneligible[5, nRow].Value.ToString();
                    //    ineligibleRow.Bill_Amount = gvIneligible[6, nRow].Value.ToString();
                    //    ineligibleRow.Amount_Ineligible = gvIneligible[7, nRow].Value.ToString();
                    //    ineligibleRow.Ineligible_Reason = gvIneligible[8, nRow].Value.ToString();

                    //    lstBillIneligibleTableRow.Add(ineligibleRow);
                    //}
                }

                if (lstBillIneligibleTableRowBlueSheet.Count > 0)
                {
                    double? SumBillAmount = 0;
                    double? SumAmountIneligible = 0;

                    for (int nRow = 0; nRow < lstBillIneligibleTableRowBlueSheet.Count; nRow++)
                    {
                        SumBillAmount += Double.Parse(lstBillIneligibleTableRowBlueSheet[nRow].Bill_Amount.Substring(1));
                        SumAmountIneligible += Double.Parse(lstBillIneligibleTableRowBlueSheet[nRow].Amount_Ineligible.Substring(1));
                    }
                    BillIneligibleTableRowBlueSheet SumIneligibleRow = new BillIneligibleTableRowBlueSheet();

                    SumIneligibleRow.Medical_Provider = "합계";
                    SumIneligibleRow.Bill_Amount = SumBillAmount.Value.ToString("C");
                    SumIneligibleRow.Amount_Ineligible = SumAmountIneligible.Value.ToString("C");

                    lstBillIneligibleTableRowBlueSheet.Add(SumIneligibleRow);
                }

                int nHeightAfterIneligible = 0;

                if (lstBillIneligibleTableRowBlueSheet.Count > 0)
                {
                    nHeightAfterIneligible += 22;

                    for (int nRow = 0; nRow < lstBillIneligibleTableRowBlueSheet.Count; nRow++)
                    {
                        nHeightAfterIneligible += 15;
                    }

                    if ((nRowHeight > 645) ||
                        (nRowHeight + nHeightAfterIneligible) > 645)
                    {
                        nRowHeight = 0;
                        section.AddPageBreak();
                    }
                }

                if (lstBillIneligibleTableRowBlueSheet.Count > 0)
                {

                    MigraDocDOM.Paragraph paraSpaceBefore = section.AddParagraph();
                    paraSpaceBefore.Format.SpaceBefore = "0.18in";
                    paraSpaceBefore.Format.SpaceAfter = "0.05in";
                    paraSpaceBefore.Format.Font.Color = MigraDoc.DocumentObjectModel.Color.FromCmyk(0, 100, 100, 0);
                    paraSpaceBefore.Format.Font.Name = "Malgun Gothic";
                    paraSpaceBefore.Format.Font.Size = 7;
                    paraSpaceBefore.AddFormattedText("지원 불가한 의료비", MigraDocDOM.TextFormat.Bold);

                    MigraDocDOM.Tables.Table tableIneligible = new MigraDocDOM.Tables.Table();
                    tableIneligible.Borders.Width = 0.1;
                    tableIneligible.Borders.Color = MigraDoc.DocumentObjectModel.Color.FromCmyk(100, 100, 100, 100);

                    //MigraDocDOM.Tables.Column colIneligible = tableIneligible.AddColumn(MigraDocDOM.Unit.FromInch(0.8));
                    //colIneligible.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                    MigraDocDOM.Tables.Column colIneligible = tableIneligible.AddColumn(MigraDocDOM.Unit.FromInch(0.6));
                    colIneligible.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                    colIneligible = tableIneligible.AddColumn(MigraDocDOM.Unit.FromInch(0.7));
                    colIneligible.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                    colIneligible = tableIneligible.AddColumn(MigraDocDOM.Unit.FromInch(1.5));
                    colIneligible.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                    colIneligible = tableIneligible.AddColumn(MigraDocDOM.Unit.FromInch(0.9));
                    colIneligible.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                    colIneligible = tableIneligible.AddColumn(MigraDocDOM.Unit.FromInch(1.2));
                    colIneligible.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                    colIneligible = tableIneligible.AddColumn(MigraDocDOM.Unit.FromInch(2.1));
                    colIneligible.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                    MigraDocDOM.Tables.Row ineligible_Row = tableIneligible.AddRow();

                    nRowHeight += 22;
                    ineligible_Row.Height = "0.31in";
                    ineligible_Row.VerticalAlignment = MigraDocDOM.Tables.VerticalAlignment.Center;

                    //MigraDocDOM.Tables.Cell cellIneligibleTitleICND = ineligible_Row.Cells[0];
                    //cellIneligibleTitleICND.AddParagraph("회원 이름");
                    //cellIneligibleTitleICND.Format.Font.Bold = true;
                    //cellIneligibleTitleICND.Format.Font.Size = 7;
                    //cellIneligibleTitleICND.Format.Font.Name = "Malgun Gothic";
                    //cellIneligibleTitleICND.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                    MigraDocDOM.Tables.Cell cellIneligibleTitleMedBill = ineligible_Row.Cells[0];
                    cellIneligibleTitleMedBill.AddParagraph("MEDBILL");
                    cellIneligibleTitleMedBill.Format.Font.Bold = true;
                    cellIneligibleTitleMedBill.Format.Font.Size = 7;
                    cellIneligibleTitleMedBill.Format.Font.Name = "Malgun Gothic";
                    cellIneligibleTitleMedBill.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                    MigraDocDOM.Tables.Cell cellIneligibleTitleBillDate = ineligible_Row.Cells[1];
                    cellIneligibleTitleBillDate.AddParagraph("서비스 날짜");
                    cellIneligibleTitleBillDate.Format.Font.Bold = true;
                    cellIneligibleTitleBillDate.Format.Font.Size = 7;
                    cellIneligibleTitleBillDate.Format.Font.Name = "Malgun Gothic";
                    cellIneligibleTitleBillDate.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                    MigraDocDOM.Tables.Cell cellIneligibleTitleMedicalProvider = ineligible_Row.Cells[2];
                    cellIneligibleTitleMedicalProvider.AddParagraph("의료기관명");
                    cellIneligibleTitleMedicalProvider.Format.Font.Bold = true;
                    cellIneligibleTitleMedicalProvider.Format.Font.Size = 7;
                    cellIneligibleTitleMedicalProvider.Format.Font.Name = "Malgun Gothic";
                    cellIneligibleTitleMedicalProvider.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                    MigraDocDOM.Tables.Cell cellIneligibleTitleBillAmount = ineligible_Row.Cells[3];
                    cellIneligibleTitleBillAmount.AddParagraph("청구 (원금)");
                    cellIneligibleTitleBillAmount.Format.Font.Bold = true;
                    cellIneligibleTitleBillAmount.Format.Font.Size = 7;
                    cellIneligibleTitleBillAmount.Format.Font.Name = "Malgun Gothic";
                    cellIneligibleTitleBillAmount.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                    MigraDocDOM.Tables.Cell cellIneligibleTitleAmountIneligible = ineligible_Row.Cells[4];
                    cellIneligibleTitleAmountIneligible.AddParagraph("전액/일부 지원불가 금액");
                    cellIneligibleTitleAmountIneligible.Format.Font.Bold = true;
                    cellIneligibleTitleAmountIneligible.Format.Font.Size = 7;
                    cellIneligibleTitleAmountIneligible.Format.Font.Name = "Malgun Gothic";
                    cellIneligibleTitleAmountIneligible.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                    MigraDocDOM.Tables.Cell cellIneligibleTitleIneligibleReason = ineligible_Row.Cells[5];
                    cellIneligibleTitleIneligibleReason.AddParagraph("지원되지 않는 사유");
                    cellIneligibleTitleIneligibleReason.Format.Font.Bold = true;
                    cellIneligibleTitleIneligibleReason.Format.Font.Size = 7;
                    cellIneligibleTitleIneligibleReason.Format.Font.Name = "Malgun Gothic";
                    cellIneligibleTitleIneligibleReason.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                    List<BillIneligibleRowBlueSheet> lstBillIneligible = new List<BillIneligibleRowBlueSheet>();

                    for (int i = 0; i < lstBillIneligibleTableRowBlueSheet.Count; i++)
                    {
                        if (i < lstBillIneligibleTableRowBlueSheet.Count - 1)
                        {

                            MigraDocDOM.Tables.Row rowData = tableIneligible.AddRow();
                            rowData.VerticalAlignment = MigraDocDOM.Tables.VerticalAlignment.Center;
                            rowData.Height = "0.18in";

                            BillIneligibleRowBlueSheet ineligible = new BillIneligibleRowBlueSheet();

                            //MigraDocDOM.Tables.Cell cell = rowData.Cells[0];

                            //if (lstBillIneligibleTableRow[i].PatientName.Length > 11)
                            //{
                            //    cell.AddParagraph(lstBillIneligibleTableRow[i].PatientName.Substring(0, 11) + " ...");
                            //}
                            //else
                            //{
                            //    cell.AddParagraph(lstBillIneligibleTableRow[i].PatientName);
                            //}

                            //cell.Format.Font.Bold = false;
                            //cell.Format.Font.Name = "Malgun Gothic";
                            //cell.Format.Font.Size = 7;
                            //cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            //cell.Format.Alignment = ParagraphAlignment.Left;

                            MigraDocDOM.Tables.Cell cell = rowData.Cells[0];
                            cell.AddParagraph(lstBillIneligibleTableRowBlueSheet[i].MED_BILL);
                            cell.Format.Font.Bold = false;
                            cell.Format.Font.Name = "Malgun Gothic";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                            cell = rowData.Cells[1];
                            cell.AddParagraph(lstBillIneligibleTableRowBlueSheet[i].Bill_Date);
                            cell.Format.Font.Bold = false;
                            cell.Format.Font.Name = "Malgun Gothic";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                            cell = rowData.Cells[2];

                            if (lstBillIneligibleTableRowBlueSheet[i].Medical_Provider.Length > 24)
                            {
                                cell.AddParagraph(lstBillIneligibleTableRowBlueSheet[i].Medical_Provider.Substring(0, 24) + " ...");
                            }
                            else
                            {
                                cell.AddParagraph(lstBillIneligibleTableRowBlueSheet[i].Medical_Provider);
                            }

                            cell.Format.Font.Bold = false;
                            cell.Format.Font.Name = "Malgun Gothic";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Left;

                            cell = rowData.Cells[3];
                            cell.AddParagraph(lstBillIneligibleTableRowBlueSheet[i].Bill_Amount);
                            ineligible.Bill_Amount = Double.Parse(lstBillIneligibleTableRowBlueSheet[i].Bill_Amount.Substring(1));
                            cell.Format.Font.Bold = false;
                            cell.Format.Font.Name = "Malgun Gothic";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Right;

                            cell = rowData.Cells[4];
                            cell.AddParagraph(lstBillIneligibleTableRowBlueSheet[i].Amount_Ineligible);
                            ineligible.Amount_Ineligible = Double.Parse(lstBillIneligibleTableRowBlueSheet[i].Amount_Ineligible.Substring(1));
                            cell.Format.Font.Bold = false;
                            cell.Format.Font.Name = "Malgun Gothic";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Right;



                            cell = rowData.Cells[5];
                            if (lstBillIneligibleTableRowBlueSheet[i].Ineligible_Reason.Length > 33)
                            {
                                cell.AddParagraph(lstBillIneligibleTableRowBlueSheet[i].Ineligible_Reason.Substring(0, 33) + " ...");
                            }
                            else
                            {
                                cell.AddParagraph(lstBillIneligibleTableRowBlueSheet[i].Ineligible_Reason);
                            }
                            cell.Format.Font.Bold = false;
                            cell.Format.Font.Name = "Malgun Gothic";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Left;

                            lstBillIneligible.Add(ineligible);

                            PdfDocument doc = new PdfDocument();


                        }

                        if (i == lstBillIneligibleTableRowBlueSheet.Count - 1)
                        {
                            MigraDocDOM.Tables.Row rowData = tableIneligible.AddRow();
                            rowData.VerticalAlignment = MigraDocDOM.Tables.VerticalAlignment.Center;

                            rowData.Height = "0.2in";

                            //MigraDocDOM.Tables.Cell cell = rowData.Cells[0];
                            //cell.AddParagraph();
                            //if (lstBillIneligibleTableRow[i].PatientName.Length > 11)
                            //{
                            //    cell.AddParagraph(lstBillIneligibleTableRow[i].PatientName.Substring(0, 11) + " ...");
                            //}
                            //else
                            //{
                            //    cell.AddParagraph(lstBillIneligibleTableRow[i].PatientName);
                            //}
                            //cell.Format.Font.Bold = true;
                            //cell.Format.Font.Name = "Malgun Gothic";
                            //cell.Format.Font.Size = 7;
                            //cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                            MigraDocDOM.Tables.Cell cell = rowData.Cells[0];
                            //cell.AddParagraph(lstBillIneligibleTableRow[i].MED_BILL);
                            cell.AddParagraph();
                            cell.Format.Font.Bold = true;
                            cell.Format.Font.Name = "Malgun Gothic";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                            cell = rowData.Cells[1];
                            //cell.AddParagraph(lstBillIneligibleTableRow[i].Bill_Date);
                            cell.AddParagraph();
                            cell.Format.Font.Bold = true;
                            cell.Format.Font.Name = "Malgun Gothic";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                            cell = rowData.Cells[2];
                            //if (lstBillIneligibleTableRow[i].Medical_Provider.Length > 25)
                            //{
                                //    cell.AddParagraph(lstBillIneligibleTableRow[i].Medical_Provider.Substring(0, 25) + " ...");
                                //}
                                //else
                                //{
                                //    cell.AddParagraph(lstBillIneligibleTableRow[i].Medical_Provider);
                                //}
                                cell.AddParagraph("합계");
                                cell.Format.Font.Bold = true;
                                cell.Format.Font.Name = "Malgun Gothic";
                                cell.Format.Font.Size = 7;
                                cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                                Double? BillAmount = 0;
                                foreach (BillIneligibleRowBlueSheet row in lstBillIneligible)
                                {
                                    BillAmount += row.Bill_Amount;
                                }

                                cell = rowData.Cells[3];
                                //cell.AddParagraph(BillAmount.Value.ToString("C"));
                                cell.AddParagraph(lstBillIneligibleTableRowBlueSheet[i].Bill_Amount);
                                cell.Format.Font.Bold = true;
                                cell.Format.Font.Name = "Malgun Gothic";
                                cell.Format.Font.Size = 7;
                                cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                                cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Right;

                                //Double? IneligibleAmount = 0;
                                //foreach (BillIneligibleRow row in lstBillIneligible)
                                //{
                                //    IneligibleAmount += row.Amount_Ineligible;
                                //}

                                cell = rowData.Cells[4];
                                //cell.AddParagraph(IneligibleAmount.Value.ToString("C"));
                                cell.AddParagraph(lstBillIneligibleTableRowBlueSheet[i].Amount_Ineligible);
                                cell.Format.Font.Bold = true;
                                cell.Format.Font.Name = "Malgun Gothic";
                                cell.Format.Font.Size = 7;
                                cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                                cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Right;

                                cell = rowData.Cells[5];
                                //if (lstBillIneligibleTableRow[i].Ineligible_Reason.Length > 33)
                                //{
                                //    cell.AddParagraph(lstBillIneligibleTableRow[i].Ineligible_Reason.Substring(0, 33) + " ...");
                                //}
                                //{
                                //    cell.AddParagraph(lstBillIneligibleTableRow[i].Ineligible_Reason);
                                //}
                                cell.AddParagraph();
                                cell.Format.Font.Bold = true;
                                cell.Format.Font.Name = "Malgun Gothic";
                                cell.Format.Font.Size = 7;
                                cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                                cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Left;
                            }
                        }

                        pdfDoc.LastSection.Add(tableIneligible);

                    }
                    // The end of tables

                const bool unicode = true;
                const PdfFontEmbedding embedding = PdfFontEmbedding.Always;

                //PdfDocumentRenderer pdfRenderer = new PdfDocumentRenderer(unicode, embedding);
                PdfDocumentRenderer pdfRenderer = new PdfDocumentRenderer(unicode);
                pdfRenderer.Document = pdfDoc;
                pdfRenderer.RenderDocument();


                if (rbCheckBlueSheet.Checked)
                {
                    SaveFileDialog dlgSaveFile = new SaveFileDialog();
                    dlgSaveFile.FileName = strIndividualIDBlueSheet + "_" + strIndividualNameBlueSheet + "_" + dtpCheckIssueDateBlueSheet.Value.ToString("MM-dd-yyyy") + "_Ko";
                    dlgSaveFile.Filter = "PDF Files | *.pdf";
                    dlgSaveFile.DefaultExt = "pdf";
                    dlgSaveFile.InitialDirectory = CheckBlueSheetPath;
                    dlgSaveFile.RestoreDirectory = true;

                    if (dlgSaveFile.ShowDialog() == DialogResult.OK)
                    {
                        try
                        {
                            pdfRenderer.PdfDocument.Save(dlgSaveFile.FileName);

                            string strIndividualId = txtIndividualIDBlueSheet.Text.Trim();
                            String strSqlQueryForIndividualInfo = "select [dbo].[contact].[Name], [dbo].[contact].[Individual_ID__c] from [dbo].[contact] " +
                                                                  "where [dbo].[contact].[Individual_ID__c] like '%' + @IndividualId + '%'";

                            SqlCommand cmdQueryForIndividualInfo = new SqlCommand(strSqlQueryForIndividualInfo, connSalesforce4);
                            cmdQueryForIndividualInfo.CommandType = CommandType.Text;

                            cmdQueryForIndividualInfo.Parameters.AddWithValue("@IndividualId", strIndividualId);

                            IndividualInfoBlueSheet infoIndividualBlueSheet = new IndividualInfoBlueSheet();

                            if (connSalesforce4.State != ConnectionState.Closed)
                            {
                                connSalesforce4.Close();
                                connSalesforce4.Open();
                            }
                            else if (connSalesforce4.State == ConnectionState.Closed) connSalesforce4.Open();
                            SqlDataReader rdrInfoBlueSheet = cmdQueryForIndividualInfo.ExecuteReader();
                            if (rdrInfoBlueSheet.HasRows)
                            {
                                rdrInfoBlueSheet.Read();
                                if (!rdrInfoBlueSheet.IsDBNull(0)) infoIndividualBlueSheet.IndividualName = rdrInfoBlueSheet.GetString(0);
                                if (!rdrInfoBlueSheet.IsDBNull(1)) infoIndividualBlueSheet.IndividualId = rdrInfoBlueSheet.GetString(1);
                            }
                            rdrInfoBlueSheet.Close();
                            if (connSalesforce4.State != ConnectionState.Closed) connSalesforce4.Close();

                            if (infoIndividualBlueSheet.IndividualId != String.Empty)
                            {
                                int nBlueSheetType = 1;
                                String CheckNo = txtCheckNoBlueSheet.Text.Trim();
                                DateTime dtCheckIssueDate = dtpCheckIssueDateBlueSheet.Value;

                                String strSqlQueryForBlueSheetForIndividual = "select [dbo].[tbl_bluesheet].[FileName] from [dbo].[tbl_bluesheet] " +
                                                                              "where [dbo].[tbl_bluesheet].[Individual_Id] = @IndividualId and " +
                                                                              "[dbo].[tbl_bluesheet].[IndividualName] = @IndividualName and " +
                                                                              "[dbo].[tbl_bluesheet].[BlueSheetType] = @BlueSheetType and " +
                                                                              "[dbo].[tbl_bluesheet].[CheckNo] = @BlueSheetCheckNo and " +
                                                                              "cast([dbo].[tbl_bluesheet].[IssueDate] as date) = @CheckIssueDate";

                                SqlCommand cmdQueryForBlueSheetForIndividual = new SqlCommand(strSqlQueryForBlueSheetForIndividual, connRN7);
                                cmdQueryForBlueSheetForIndividual.CommandType = CommandType.Text;

                                cmdQueryForBlueSheetForIndividual.Parameters.AddWithValue("@IndividualId", infoIndividualBlueSheet.IndividualId);
                                cmdQueryForBlueSheetForIndividual.Parameters.AddWithValue("@IndividualName", infoIndividualBlueSheet.IndividualName);
                                cmdQueryForBlueSheetForIndividual.Parameters.AddWithValue("@BlueSheetType", nBlueSheetType);
                                cmdQueryForBlueSheetForIndividual.Parameters.AddWithValue("@BlueSheetCheckNo", CheckNo);
                                cmdQueryForBlueSheetForIndividual.Parameters.AddWithValue("@CheckIssueDate", dtCheckIssueDate.ToString("yyyy-MM-dd"));

                                if (connRN7.State != ConnectionState.Closed)
                                {
                                    connRN7.Close();
                                    connRN7.Open();
                                }
                                else if (connRN7.State == ConnectionState.Closed) connRN7.Open();
                                Object objFileName = cmdQueryForBlueSheetForIndividual.ExecuteScalar();
                                if (connRN7.State != ConnectionState.Closed) connRN7.Close();

                                if (objFileName == null)
                                {
                                    String FileName = dlgSaveFile.FileName;

                                    String strSqlInsertNewBlueSheet = "insert into [dbo].[tbl_bluesheet] ([dbo].[tbl_bluesheet].[Individual_Id], [dbo].[tbl_bluesheet].[IndividualName], " +
                                                                      "[dbo].[tbl_bluesheet].[BlueSheetType], " +
                                                                      "[dbo].[tbl_bluesheet].[CheckNo], [dbo].[tbl_bluesheet].[FileName], " +
                                                                      "[dbo].[tbl_bluesheet].[IssueDate]) " +
                                                                      "values (@IndividualId, @IndividualName, @BlueSheetTypeNo, @CheckNo, @FileName, @IssueDate)";

                                    SqlCommand cmdInsertNewBlueSheet = new SqlCommand(strSqlInsertNewBlueSheet, connRN7);
                                    cmdInsertNewBlueSheet.CommandType = CommandType.Text;

                                    cmdInsertNewBlueSheet.Parameters.AddWithValue("@IndividualId", infoIndividualBlueSheet.IndividualId);
                                    cmdInsertNewBlueSheet.Parameters.AddWithValue("@IndividualName", infoIndividualBlueSheet.IndividualName);
                                    cmdInsertNewBlueSheet.Parameters.AddWithValue("@BlueSheetTypeNo", nBlueSheetType);
                                    cmdInsertNewBlueSheet.Parameters.AddWithValue("@CheckNo", CheckNo);
                                    cmdInsertNewBlueSheet.Parameters.AddWithValue("@FileName", FileName);
                                    cmdInsertNewBlueSheet.Parameters.AddWithValue("@IssueDate", dtCheckIssueDate);

                                    if (connRN7.State != ConnectionState.Closed)
                                    {
                                        connRN7.Close();
                                        connRN7.Open();
                                    }
                                    else if (connRN7.State == ConnectionState.Closed) connRN7.Open();
                                    int nBlueSheetInserted = cmdInsertNewBlueSheet.ExecuteNonQuery();
                                    if (connRN7.State != ConnectionState.Closed) connRN7.Close();

                                    //System.Diagnostics.ProcessStartInfo processInfo = new System.Diagnostics.ProcessStartInfo();
                                    //processInfo.FileName = dlgSaveFile.FileName;
                                    //System.Diagnostics.Process.Start(processInfo);
                                }
                                else
                                {
                                    String FileName = dlgSaveFile.FileName;

                                    String strSqlUpdateBlueSheet = "update [dbo].[tbl_bluesheet] set [dbo].[tbl_bluesheet].[FileName] = @BlueSheetFileName " +
                                                                   "where [dbo].[tbl_bluesheet].[Individual_Id] = @IndividualId and " +
                                                                   "[dbo].[tbl_bluesheet].[IndividualName] = @IndividualName and " +
                                                                   "[dbo].[tbl_bluesheet].[BlueSheetType] = @BlueSheetType and " +
                                                                   "[dbo].[tbl_bluesheet].[CheckNo] = @CheckNo and " +
                                                                   "cast([dbo].[tbl_bluesheet].[IssueDate] as date) = @IssueDate";

                                    SqlCommand cmdUpdateBlueSheet = new SqlCommand(strSqlUpdateBlueSheet, connRN7);
                                    cmdUpdateBlueSheet.CommandType = CommandType.Text;

                                    cmdUpdateBlueSheet.Parameters.AddWithValue("@BlueSheetFileName", FileName);
                                    cmdUpdateBlueSheet.Parameters.AddWithValue("@IndividualId", infoIndividualBlueSheet.IndividualId);
                                    cmdUpdateBlueSheet.Parameters.AddWithValue("@IndividualName", infoIndividualBlueSheet.IndividualName);
                                    cmdUpdateBlueSheet.Parameters.AddWithValue("@BlueSheetType", nBlueSheetType);
                                    cmdUpdateBlueSheet.Parameters.AddWithValue("@CheckNo", CheckNo);
                                    cmdUpdateBlueSheet.Parameters.AddWithValue("@IssueDate", dtCheckIssueDate.ToString("yyyy-MM-dd"));

                                    if (connRN7.State != ConnectionState.Closed)
                                    {
                                        connRN7.Open();
                                        connRN7.Close();
                                    }
                                    else if (connRN7.State == ConnectionState.Closed) connRN7.Open();
                                    int nBlueSheetUpdated = cmdUpdateBlueSheet.ExecuteNonQuery();
                                    if (connRN7.State != ConnectionState.Closed) connRN7.Close();
                                }
                                pdfRenderer.PdfDocument.Save(dlgSaveFile.FileName);
                                System.Diagnostics.ProcessStartInfo processInfo = new System.Diagnostics.ProcessStartInfo();
                                processInfo.FileName = dlgSaveFile.FileName;

                                System.Diagnostics.Process.Start(processInfo);
                            }
                        }
                        catch (IOException ex)
                        {
                            MessageBox.Show(ex.Message, "Error");
                            return;
                        }
                        catch (SqlException ex)
                        {
                            MessageBox.Show(ex.Message, "Sql Error");
                            return;
                        }
                    }
                }
                if (rbACHBlueSheet.Checked)
                {
                    SaveFileDialog savefileDlg = new SaveFileDialog(); 
                    //savefileDlg.FileName = strIndividualIDBlueSheet + "_" + strIndividualNameBlueSheet + "_" + ACHInfoEnteredBlueSheet.dtACHDate.ToString("MM-dd-yyyy") + "_Ko";
                    savefileDlg.FileName = strIndividualIDBlueSheet + "_" + strIndividualNameBlueSheet + "_" + dtpACHTransactionDateBlueSheet.Value.ToString("MM-dd-yyyy") + "_Ko";
                    savefileDlg.Filter = "PDF Files | *.pdf";
                    savefileDlg.DefaultExt = "pdf";
                    savefileDlg.InitialDirectory = CheckBlueSheetPath;
                    savefileDlg.RestoreDirectory = true;

                    if (savefileDlg.ShowDialog() == DialogResult.OK)
                    {
                        try
                        {
                            pdfRenderer.PdfDocument.Save(savefileDlg.FileName);
                            System.Diagnostics.ProcessStartInfo processInfo = new System.Diagnostics.ProcessStartInfo();
                            processInfo.FileName = savefileDlg.FileName;

                            System.Diagnostics.Process.Start(processInfo);
                        }
                        catch (IOException ex)
                        {
                            MessageBox.Show(ex.Message, "Error");
                            return;
                        }
                        //finally
                        //{
                        //    ACHInfoEntered = null;
                        //}
                    }
                }
                if (rbCreditCardBlueSheet.Checked)
                {
                    SaveFileDialog savefileDlg = new SaveFileDialog(); 
                    //savefileDlg.FileName = strIndividualIDBlueSheet + "_" + strIndividualNameBlueSheet + "_" + CreditCardPaymentEnteredBlueSheet.dtPaymentDate.ToString("MM-dd-yyyy") + "_Ko";
                    savefileDlg.FileName = strIndividualIDBlueSheet + "_" + strIndividualNameBlueSheet + "_" + dtpCreditCardPaymentDateBlueSheet.Value.ToString("MM-dd-yyyy") + "_Ko";
                    savefileDlg.Filter = "PDF Files | *.pdf";
                    savefileDlg.DefaultExt = "pdf";
                    savefileDlg.InitialDirectory = CheckBlueSheetPath;
                    savefileDlg.RestoreDirectory = true;

                    if (savefileDlg.ShowDialog() == DialogResult.OK)
                    {
                        try
                        {
                            pdfRenderer.PdfDocument.Save(savefileDlg.FileName);
                            System.Diagnostics.ProcessStartInfo processInfo = new System.Diagnostics.ProcessStartInfo();
                            processInfo.FileName = savefileDlg.FileName;

                            System.Diagnostics.Process.Start(processInfo);
                        }
                        catch (IOException ex)
                        {
                            MessageBox.Show(ex.Message, "Error");
                            return;
                        }
                        //finally
                        //{
                        //    ACHInfoEntered = null;
                        //}
                    }
                }
                //}
                //else if (dlgResultDocReceivedDate == DialogResult.Cancel)
                //{
                //    return;
                //}
                
            }
            else if ((gvPersonalResponsibility.RowCount > 0) || (gvIneligibleNoSharing.RowCount > 0))
            {

                List<PersonalResponsibilityInfoBlueSheet> lstPersonalResponsibilityInfo = new List<PersonalResponsibilityInfoBlueSheet>();

                for (int i = 0; i < gvPersonalResponsibility.Rows.Count; i++)
                {
                        PersonalResponsibilityInfoBlueSheet prInfo = new PersonalResponsibilityInfoBlueSheet();

                    prInfo.MedBillName = gvPersonalResponsibility[0, i]?.Value.ToString();
                    String BillDate = gvPersonalResponsibility[1, i]?.Value.ToString();
                    if (BillDate != String.Empty) prInfo.BillDate = DateTime.Parse(BillDate);
                    prInfo.MedicalProvider = gvPersonalResponsibility[2, i]?.Value.ToString();
                    if (gvPersonalResponsibility[3, i] != null) prInfo.BillAmount = (Double)Decimal.Parse(gvPersonalResponsibility[3, i].Value.ToString().Substring(1));
                    prInfo.Type = gvPersonalResponsibility[4, i]?.Value.ToString();
                    if (gvPersonalResponsibility[5, i] != null) prInfo.PersonalResponsibilityTotal = (Double)Decimal.Parse(gvPersonalResponsibility[8, i].Value.ToString().Substring(1));

                    lstPersonalResponsibilityInfo.Add(prInfo);
                }

                MigraDocDOM.Document pdfPersonalResponsibilityDoc = new MigraDocDOM.Document();

                MigraDocDOM.Section section = pdfPersonalResponsibilityDoc.AddSection();

                section.PageSetup.PageFormat = MigraDocDOM.PageFormat.Letter;
                section.PageSetup.HeaderDistance = "0.25in";
                section.PageSetup.TopMargin = "1.5in";
                section.PageSetup.LeftMargin = "0.8in";
                section.PageSetup.RightMargin = "0.8in";
                section.PageSetup.BottomMargin = "0.5in";

                section.PageSetup.DifferentFirstPageHeaderFooter = false;
                section.Headers.Primary.Format.SpaceBefore = "0.25in";

                //MigraDocDOM.Shapes.Image image = section.Headers.Primary.AddImage("C:\\Program Files (x86)\\RN\\RNManager\\cmmlogo.png");
                MigraDocDOM.Shapes.Image image = section.Headers.Primary.AddImage("..\\cmmlogo.png");

                image.Height = "0.8in";
                image.LockAspectRatio = true;
                image.RelativeVertical = MigraDocDOM.Shapes.RelativeVertical.Line;
                image.RelativeHorizontal = MigraDocDOM.Shapes.RelativeHorizontal.Margin;
                image.Top = MigraDocDOM.Shapes.ShapePosition.Top;
                image.Left = MigraDocDOM.Shapes.ShapePosition.Center;
                image.WrapFormat.Style = MigraDocDOM.Shapes.WrapStyle.TopBottom;

                MigraDocDOM.Paragraph paraCMMAddress = section.Headers.Primary.AddParagraph();
                paraCMMAddress.Format.Font.Name = "Arial";
                paraCMMAddress.Format.Font.Size = 8;
                paraCMMAddress.Format.SpaceBefore = "0.15in";
                paraCMMAddress.Format.SpaceAfter = "0.25in";
                paraCMMAddress.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                String strVerticalBar = " | ";
                String strStreet = "5235 N. Elston Ave.";
                String strCityStateZip = "Chicago, IL 60630";
                String strPhone = "Phone 773.777.8889";
                String strFax = "Fax 773.777.0004";
                String strWebsiteAddr = "www.cmmlogos.org";

                paraCMMAddress.AddFormattedText(strStreet, MigraDocDOM.TextFormat.NotBold);
                paraCMMAddress.AddFormattedText(strVerticalBar, MigraDocDOM.TextFormat.Bold);
                paraCMMAddress.AddFormattedText(strCityStateZip, MigraDocDOM.TextFormat.NotBold);
                paraCMMAddress.AddFormattedText(strVerticalBar, MigraDocDOM.TextFormat.Bold);
                paraCMMAddress.AddFormattedText(strPhone, MigraDocDOM.TextFormat.NotBold);
                paraCMMAddress.AddFormattedText(strVerticalBar, MigraDocDOM.TextFormat.Bold);
                paraCMMAddress.AddFormattedText(strFax, MigraDocDOM.TextFormat.NotBold);
                paraCMMAddress.AddFormattedText(strVerticalBar, MigraDocDOM.TextFormat.Bold);
                paraCMMAddress.AddFormattedText(strWebsiteAddr, MigraDocDOM.TextFormat.NotBold);

                MigraDocDOM.Paragraph paraToday = section.AddParagraph();
                paraToday.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                paraToday.Format.Font.Name = "Arial";
                paraToday.Format.Alignment = MigraDocDOM.ParagraphAlignment.Left;
                paraToday.Format.SpaceBefore = "0.25in";
                paraToday.Format.SpaceAfter = "0.25in";
                paraToday.AddFormattedText(DateTime.Today.ToString("MM/dd/yyyy"));

                MigraDocDOM.Paragraph paraMembershipInfo = section.AddParagraph();

                paraMembershipInfo.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                paraMembershipInfo.Format.Font.Name = "Arial";
                //paraMembershipInfo.Format.SpaceBefore = "0.70in";
                paraMembershipInfo.Format.SpaceBefore = "0.20in";
                paraMembershipInfo.Format.SpaceAfter = "0.20in";
                //paraMembershipInfo.Format.LeftIndent = "0.5in";
                //paraMembershipInfo.Format.RightIndent = "0.5in";
                paraMembershipInfo.Format.Alignment = MigraDocDOM.ParagraphAlignment.Left;
                //paraMembershipInfo.AddFormattedText("Primary Name: " + strPrimaryName + "\n");
                if (strMembershipIdBlueSheet != String.Empty) paraMembershipInfo.AddFormattedText(strMembershipIdBlueSheet + " (" + strIndividualIDBlueSheet + ")\n");
                else paraMembershipInfo.AddFormattedText(strIndividualIDBlueSheet + "\n");
                paraMembershipInfo.AddFormattedText(strIndividualNameBlueSheet + "\n");
                paraMembershipInfo.AddFormattedText(strStreetAddressBlueSheet + "\n");
                paraMembershipInfo.AddFormattedText(strCityBlueSheet + ", " + strStateBlueSheet + " " + strZipBlueSheet + "\n");


                MigraDocDOM.Paragraph paraDearMember = section.AddParagraph();
                paraDearMember.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                paraDearMember.Format.Font.Name = "Malgun Gothic";
                paraDearMember.Format.Font.Size = 8;
                paraDearMember.Format.Alignment = MigraDocDOM.ParagraphAlignment.Left;
                //paraDearMember.Format.LeftIndent = "0.5in";
                //paraDearMember.Format.RightIndent = "0.5in";
                paraDearMember.Format.SpaceBefore = "0.1in";
                paraDearMember.Format.SpaceAfter = "0.1in";
                //if (strIndividualMiddleName != String.Empty) paraDearMember.AddFormattedText(strIndividualLastName + ", " + strIndiviaualFirstName + " 회원께,");
                //else paraDearMember.AddFormattedText(strIndividualLastName + ", " + strIndiviaualFirstName + " " + strIndividualMiddleName + " 회원께,");
                paraDearMember.AddFormattedText(strIndividualNameBlueSheet + " 회원께,");

                /////////////////////////////////////////////////////////////////////////////////////////////////////////////
                MigraDocDOM.Paragraph paraPRGreetingMessage1 = section.AddParagraph();

                paraPRGreetingMessage1.Format.Font.Color = MigraDoc.DocumentObjectModel.Color.FromCmyk(100, 100, 100, 100);
                paraPRGreetingMessage1.Format.Font.Name = "Malgun Gothic";
                paraPRGreetingMessage1.Format.Font.Size = 8;
                paraPRGreetingMessage1.Format.SpaceAfter = "5pt";
                //paraGreetingMessage.Format.LeftIndent = "0.5in";
                //paraGreetingMessage.Format.RightIndent = "0.5in";
                paraPRGreetingMessage1.Format.Alignment = MigraDocDOM.ParagraphAlignment.Justify;
                //paraGreetingMessage.AddFormattedText(strGreetingMessage, TextFormat.NotBold);
                paraPRGreetingMessage1.AddFormattedText(strPRGreetingMessagePara1, MigraDocDOM.TextFormat.NotBold);

                MigraDocDOM.Paragraph paraPRGreetingMessage2 = section.AddParagraph();
                paraPRGreetingMessage2.Format.Font.Color = MigraDoc.DocumentObjectModel.Color.FromCmyk(100, 100, 100, 100);
                paraPRGreetingMessage2.Format.Font.Name = "Malgun Gothic";
                paraPRGreetingMessage2.Format.Font.Size = 8;
                paraPRGreetingMessage2.Format.SpaceAfter = "5pt";
                //paraGreetingMessage2.Format.LeftIndent = "0.5in";
                //paraGreetingMessage2.Format.RightIndent = "0.5in";
                paraPRGreetingMessage2.Format.Alignment = MigraDocDOM.ParagraphAlignment.Justify;
                paraPRGreetingMessage2.AddFormattedText(strPRGreetingMessagePara2, MigraDocDOM.TextFormat.NotBold);

                MigraDocDOM.Paragraph paraPRGreetingMessage3 = section.AddParagraph();
                paraPRGreetingMessage3.Format.Font.Color = MigraDoc.DocumentObjectModel.Color.FromCmyk(100, 100, 100, 100);
                paraPRGreetingMessage3.Format.Font.Name = "Malgun Gothic";
                paraPRGreetingMessage3.Format.Font.Size = 8;
                paraPRGreetingMessage3.Format.SpaceAfter = "5pt";
                //paraGreetingMessage3.Format.LeftIndent = "0.5in";
                //paraGreetingMessage3.Format.RightIndent = "0.5in";
                paraPRGreetingMessage3.Format.Alignment = MigraDocDOM.ParagraphAlignment.Justify;
                paraPRGreetingMessage3.AddFormattedText(strPRGreetingMessagePara3, MigraDocDOM.TextFormat.NotBold);

                //////////////////////////////////////////////////////////////////////////////////////////////////////
                /// Program personal responsibility table
                /// 

                MigraDocDOM.Tables.Table tableProgramPRGuide = new MigraDocDOM.Tables.Table();
                tableProgramPRGuide.Borders.Width = 0.1;
                tableProgramPRGuide.Borders.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                MigraDocDOM.Tables.Column colProgram = tableProgramPRGuide.AddColumn(MigraDocDOM.Unit.FromInch(2));
                colProgram.Format.Alignment = MigraDocDOM.ParagraphAlignment.Left;
                MigraDocDOM.Tables.Column colPersonalResponsibility = tableProgramPRGuide.AddColumn(MigraDocDOM.Unit.FromInch(4.8));
                colPersonalResponsibility.Format.Alignment = MigraDocDOM.ParagraphAlignment.Left;

                MigraDocDOM.Tables.Row rowHeader = tableProgramPRGuide.AddRow();
                rowHeader.Height = "0.2in";
                rowHeader.VerticalAlignment = MigraDocDOM.Tables.VerticalAlignment.Center;

                MigraDocDOM.Tables.Cell cellProgramHeader = rowHeader.Cells[0];
                cellProgramHeader.Format.Font.Bold = true;
                cellProgramHeader.Format.Font.Size = 8;
                cellProgramHeader.Format.Font.Name = "Malgun Gothic";
                cellProgramHeader.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                cellProgramHeader.AddParagraph("프로그램");

                MigraDocDOM.Tables.Cell cellPersonalResponsibility = rowHeader.Cells[1];
                cellPersonalResponsibility.Format.Font.Bold = true;
                cellPersonalResponsibility.Format.Font.Size = 8;
                cellPersonalResponsibility.Format.Font.Name = "Malgun Gothic";
                cellPersonalResponsibility.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                cellPersonalResponsibility.AddParagraph("본인부담금");

                MigraDocDOM.Tables.Row rowBronze = tableProgramPRGuide.AddRow();
                rowBronze.Height = "0.2in";
                rowBronze.VerticalAlignment = MigraDocDOM.Tables.VerticalAlignment.Center;

                MigraDocDOM.Tables.Cell cellBronze = rowBronze.Cells[0];
                cellBronze.Format.Font.Bold = false;
                cellBronze.Format.Font.Size = 8;
                cellBronze.Format.Font.Name = "Malgun Gothic";
                cellBronze.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                cellBronze.AddParagraph("브론즈 Bronze");

                MigraDocDOM.Tables.Cell cellBronzePR = rowBronze.Cells[1];
                cellBronzePR.Format.Font.Bold = false;
                cellBronzePR.Format.Font.Size = 8;
                cellBronzePR.Format.Font.Name = "Malgun Gothic";
                cellBronzePR.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                cellBronzePR.AddParagraph("Incident당 $5,000");

                MigraDocDOM.Tables.Row rowSilver = tableProgramPRGuide.AddRow();
                rowSilver.Height = "0.2in";
                rowSilver.VerticalAlignment = MigraDocDOM.Tables.VerticalAlignment.Center;

                MigraDocDOM.Tables.Cell cellSilver = rowSilver.Cells[0];
                cellSilver.Format.Font.Bold = false;
                cellSilver.Format.Font.Size = 8;
                cellSilver.Format.Font.Name = "Malgun Gothic";
                cellSilver.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                cellSilver.AddParagraph("실버 Silver");

                MigraDocDOM.Tables.Cell cellSilverPR = rowSilver.Cells[1];
                cellSilverPR.Format.Font.Bold = false;
                cellSilverPR.Format.Font.Size = 8;
                cellSilverPR.Format.Font.Name = "Malgun Gothic";
                cellSilverPR.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                cellSilverPR.AddParagraph("Incident당 $1,000");

                MigraDocDOM.Tables.Row rowGold = tableProgramPRGuide.AddRow();
                rowGold.Height = "0.2in";
                rowGold.VerticalAlignment = MigraDocDOM.Tables.VerticalAlignment.Center;

                MigraDocDOM.Tables.Cell cellGold = rowGold.Cells[0];
                cellGold.Format.Font.Bold = false;
                cellGold.Format.Font.Size = 8;
                cellGold.Format.Font.Name = "Malgun Gothic";
                cellGold.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                cellGold.AddParagraph("골드 Gold");

                MigraDocDOM.Tables.Cell cellGoldPR = rowGold.Cells[1];
                cellGoldPR.Format.Font.Bold = false;
                cellGoldPR.Format.Font.Size = 8;
                cellGoldPR.Format.Font.Name = "Malgun Gothic";
                cellGoldPR.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                cellGoldPR.AddParagraph("Incident당 $500");

                MigraDocDOM.Tables.Row rowGoldPlus = tableProgramPRGuide.AddRow();
                rowGoldPlus.Height = "0.2in";
                rowGoldPlus.VerticalAlignment = MigraDocDOM.Tables.VerticalAlignment.Center;

                MigraDocDOM.Tables.Cell cellGoldPlus = rowGoldPlus.Cells[0];
                cellGoldPlus.Format.Font.Bold = false;
                cellGoldPlus.Format.Font.Size = 8;
                cellGoldPlus.Format.Font.Name = "Malgun Gothic";
                cellGoldPlus.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                cellGoldPlus.AddParagraph("골드플러스 Gold Plus");

                MigraDocDOM.Tables.Cell cellGoldPlusPR = rowGoldPlus.Cells[1];
                cellGoldPlusPR.Format.Font.Bold = false;
                cellGoldPlusPR.Format.Font.Size = 8;
                cellGoldPlusPR.Format.Font.Name = "Malgun Gothic";
                cellGoldPlusPR.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                cellGoldPlusPR.AddParagraph("1년 $500");

                pdfPersonalResponsibilityDoc.LastSection.Add(tableProgramPRGuide);

                MigraDocDOM.Paragraph paraPRGreetingMessage4 = section.AddParagraph();
                paraPRGreetingMessage4.Format.Font.Color = MigraDoc.DocumentObjectModel.Color.FromCmyk(100, 100, 100, 100);
                paraPRGreetingMessage4.Format.Font.Name = "Malgun Gothic";
                paraPRGreetingMessage4.Format.Font.Size = 8;
                //paraGreetingMessage4.Format.LeftIndent = "0.5in";
                //paraGreetingMessage4.Format.RightIndent = "0.5in";
                paraPRGreetingMessage4.Format.Alignment = MigraDocDOM.ParagraphAlignment.Justify;
                paraPRGreetingMessage4.AddFormattedText(strPRGreetingMessagePara4, MigraDocDOM.TextFormat.NotBold);

                MigraDocDOM.Paragraph paraPRGreetingMessage5 = section.AddParagraph();
                paraPRGreetingMessage5.Format.Font.Color = MigraDoc.DocumentObjectModel.Color.FromCmyk(100, 100, 100, 100);
                paraPRGreetingMessage5.Format.Font.Name = "Malgun Gothic";
                paraPRGreetingMessage5.Format.Font.Size = 8;
                //paraGreetingMessage4.Format.LeftIndent = "0.5in";
                //paraGreetingMessage4.Format.RightIndent = "0.5in";
                paraPRGreetingMessage5.Format.Alignment = MigraDocDOM.ParagraphAlignment.Justify;
                paraPRGreetingMessage5.AddFormattedText(strPRGreetingMessagePara5, MigraDocDOM.TextFormat.NotBold);

                MigraDocDOM.Paragraph paraPRGreetingMessage6 = section.AddParagraph();
                paraPRGreetingMessage6.Format.Font.Color = MigraDoc.DocumentObjectModel.Color.FromCmyk(100, 100, 100, 100);
                paraPRGreetingMessage6.Format.Font.Name = "Malgun Gothic";
                paraPRGreetingMessage6.Format.Font.Size = 8;
                //paraGreetingMessage4.Format.LeftIndent = "0.5in";
                //paraGreetingMessage4.Format.RightIndent = "0.5in";
                paraPRGreetingMessage6.Format.Alignment = MigraDocDOM.ParagraphAlignment.Justify;
                paraPRGreetingMessage6.AddFormattedText(strPRGreetingMessagePara6, MigraDocDOM.TextFormat.NotBold);




                ///////////////////////////////////////////////////////////////////////////////////////////////////////////
                MigraDocDOM.Paragraph paraNeedsProcessing = section.AddParagraph();

                paraNeedsProcessing.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                paraNeedsProcessing.Format.Font.Name = "Arial";
                paraNeedsProcessing.Format.Font.Size = 8;
                paraNeedsProcessing.Format.Font.Bold = true;
                paraNeedsProcessing.Format.Alignment = MigraDocDOM.ParagraphAlignment.Left;
                paraNeedsProcessing.Format.SpaceBefore = "0.2in";
                //paraNeedsProcessing.Format.LeftIndent = "0.5in";
                //paraNeedsProcessing.Format.RightIndent = "0.5in";
                paraNeedsProcessing.AddFormattedText(strCMM_NeedProcessing + "\n");

                MigraDocDOM.Paragraph paraPhoneFaxEmail = section.AddParagraph();
                paraPhoneFaxEmail.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                paraPhoneFaxEmail.Format.Font.Size = 8;
                paraPhoneFaxEmail.Format.Alignment = MigraDocDOM.ParagraphAlignment.Left;
                //paraPhoneFaxEmail.Format.LeftIndent = "0.5in";
                paraPhoneFaxEmail.Format.RightIndent = "0.5in";
                paraPhoneFaxEmail.AddFormattedText(strNP_Phone_Fax_Email + "\n");

                MigraDocDOM.Paragraph paraHorizontalLine = section.AddParagraph();

                paraHorizontalLine.Format.SpaceBefore = "0.05in";
                paraHorizontalLine.Format.SpaceAfter = "0.05in";
                paraHorizontalLine.Format.Borders.Top.Width = 0;
                paraHorizontalLine.Format.Borders.Left.Width = 0;
                paraHorizontalLine.Format.Borders.Right.Width = 0;
                paraHorizontalLine.Format.Borders.Bottom.Width = 1;
                paraHorizontalLine.Format.Borders.Bottom.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                paraHorizontalLine.Format.Borders.Style = MigraDocDOM.BorderStyle.DashDot;

                MigraDocDOM.Paragraph paraNPStatement = section.AddParagraph();
                paraNPStatement.Format.Font.Color = MigraDoc.DocumentObjectModel.Color.FromCmyk(100, 100, 0, 0);
                paraNPStatement.Format.Font.Name = "Malgun Gothic";
                paraNPStatement.Format.Font.Size = 12;
                paraNPStatement.Format.Font.Bold = true;
                paraNPStatement.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;
                paraNPStatement.Format.SpaceAfter = "0.1in";

                //paraNPStatement.AddFormattedText("본인 부담금 또는 지원 불가 의료비 내역서\n", TextFormat.Bold);
                paraNPStatement.AddFormattedText("본인 부담금 내역서\n", MigraDocDOM.TextFormat.Bold);

                MigraDocDOM.Paragraph paraPersonalResponsibilityTotal = section.AddParagraph();
                paraPersonalResponsibilityTotal.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                paraPersonalResponsibilityTotal.Format.Font.Name = "Arial";
                paraPersonalResponsibilityTotal.Format.Font.Size = 8;
                paraPersonalResponsibilityTotal.Format.Font.Bold = true;
                paraPersonalResponsibilityTotal.Format.Alignment = MigraDocDOM.ParagraphAlignment.Left;
                paraPersonalResponsibilityTotal.Format.SpaceBefore = "0.2in";
                //paraPersonalResponsibilityTotal.Format.SpaceAfter = "0.2in";

                paraPersonalResponsibilityTotal.AddFormattedText("Incident Occurrence Date: " + PersonalResponsibilityTotalEnteredBlueSheet.IncidentOccurrenceDate.Value.ToString("MM/dd/yyyy"));

                //paraPersonalResponsibilityTotal.AddFormattedText("Incident Occurrence Date: " + PersonalResponsibilityTotalEntered.IncidentOccurrenceDate.Value.ToString("MM/dd/yyyy") + "\t" +
                //                                 "Personal Responsibility Total: " + PersonalResponsibilityTotalEntered.PersonalResponsibilityTotal.ToString("C"));


                paraPersonalResponsibilityTotal.Format.SpaceAfter = "0.05in";

                MigraDocDOM.Paragraph paraPersonalResponsibilityTitle = section.AddParagraph();
                paraPersonalResponsibilityTitle.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                paraPersonalResponsibilityTitle.Format.Font.Name = "Malgun Gothic";
                paraPersonalResponsibilityTitle.Format.Font.Size = 7;
                paraPersonalResponsibilityTitle.Format.Font.Bold = true;
                paraPersonalResponsibilityTitle.Format.Alignment = MigraDocDOM.ParagraphAlignment.Left;
                paraPersonalResponsibilityTitle.Format.SpaceBefore = "0.18in";
                paraPersonalResponsibilityTitle.Format.SpaceAfter = "0.05in";
                paraPersonalResponsibilityTitle.AddFormattedText("본인부담금", MigraDocDOM.TextFormat.Bold);


                //Paragraph paraIncidentInfo = section.AddParagraph();
                //paraIncidentInfo.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                //paraIncidentInfo.Format.Font.Name = "Arial";
                //paraIncidentInfo.Format.Font.Size = 8;
                //paraIncidentInfo.Format.Font.Bold = true;
                //paraIncidentInfo.Format.Alignment = ParagraphAlignment.Left;
                //paraIncidentInfo.Format.SpaceBefore = "0.2in";
                //paraIncidentInfo.Format.SpaceAfter = "0.2in";

                //if (lstIncidents.Count > 0)
                //{

                //    // 09/18/18 begin here
                //    Paragraph paraIncd = section.AddParagraph();

                //    paraIncd.Format.Font.Color = MigraDoc.DocumentObjectModel.Color.FromCmyk(100, 100, 100, 100);
                //    paraIncd.Format.Font.Name = "Malgun Gothic";
                //    paraIncd.Format.Font.Size = 8;
                //    paraIncd.Format.Font.Bold = true;
                //    paraIncd.Format.SpaceAfter = "1in";

                //    MigraDocDOM.Tables.Table tableIncd = new MigraDocDOM.Tables.Table();
                //    tableIncd.Borders.Width = 0;
                //    tableIncd.Borders.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                //    tableIncd.Format.SpaceAfter = "0.05in";

                //    MigraDocDOM.Tables.Column colINCD = tableIncd.AddColumn(MigraDocDOM.Unit.FromInch(0.85));
                //    colINCD.Format.Alignment = ParagraphAlignment.Left;
                //    colINCD = tableIncd.AddColumn(MigraDocDOM.Unit.FromInch(4.5));
                //    colINCD.Format.Alignment = ParagraphAlignment.Left;

                //    foreach (Incident incd in lstIncidents)
                //    {
                //        //nRowHeight += 18;

                //        MigraDocDOM.Tables.Row IncdRow = tableIncd.AddRow();
                //        IncdRow.Height = "0.1in";
                //        IncdRow.VerticalAlignment = MigraDocDOM.Tables.VerticalAlignment.Center;

                //        MigraDocDOM.Tables.Cell cellIncdName = IncdRow.Cells[0];
                //        cellIncdName.Format.Font.Bold = true;
                //        cellIncdName.Format.Font.Size = 8;
                //        //cellIncdName.Format.Font.Name = "Malgun Gothic";
                //        cellIncdName.Format.Font.Name = "Arial";
                //        cellIncdName.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                //        cellIncdName.AddParagraph(incd.Name + ": ");

                //        MigraDocDOM.Tables.Cell cellICD10Code = IncdRow.Cells[1];
                //        cellICD10Code.Format.Font.Bold = true;
                //        cellICD10Code.Format.Font.Size = 8;
                //        //cellICD10Code.Format.Font.Name = "Malgun Gothic";
                //        cellIncdName.Format.Font.Name = "Arial";
                //        cellICD10Code.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                //        cellICD10Code.AddParagraph(incd.ICD10_Code);
                //    }

                //    pdfPersonalResponsibilityDoc.LastSection.Add(tableIncd);
                //}

                ////////////////////////////////////////////////////////////////////////////////////////////////////////////

                MigraDocDOM.Tables.Table tablePersonalResponsibility = new MigraDocDOM.Tables.Table();
                tablePersonalResponsibility.Borders.Width = 0.1;
                tablePersonalResponsibility.Borders.Color = MigraDoc.DocumentObjectModel.Color.FromCmyk(100, 100, 100, 100);

                MigraDocDOM.Tables.Column colPersonalResponsibilityColumn = tablePersonalResponsibility.AddColumn(MigraDocDOM.Unit.FromInch(0.6));  // Med bill
                colPersonalResponsibilityColumn.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                colPersonalResponsibilityColumn = tablePersonalResponsibility.AddColumn(MigraDocDOM.Unit.FromInch(0.7));        // 서비스 날짜
                colPersonalResponsibilityColumn.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                colPersonalResponsibilityColumn = tablePersonalResponsibility.AddColumn(MigraDocDOM.Unit.FromInch(1.8));        // Medical Provider
                colPersonalResponsibilityColumn.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                colPersonalResponsibilityColumn = tablePersonalResponsibility.AddColumn(MigraDocDOM.Unit.FromInch(0.8));        // Bill Amount
                colPersonalResponsibilityColumn.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                colPersonalResponsibilityColumn = tablePersonalResponsibility.AddColumn(MigraDocDOM.Unit.FromInch(1.3));        // Type
                colPersonalResponsibilityColumn.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                colPersonalResponsibilityColumn = tablePersonalResponsibility.AddColumn(MigraDocDOM.Unit.FromInch(1.5));        // Personal Responsibility Total
                colPersonalResponsibilityColumn.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                // generate row for personal responsibility table
                MigraDocDOM.Tables.Row prRow = tablePersonalResponsibility.AddRow();
                prRow.Height = "0.31in";
                prRow.VerticalAlignment = MigraDocDOM.Tables.VerticalAlignment.Center;

                MigraDocDOM.Tables.Cell cellPersonalResponsibilityMedBill = prRow.Cells[0];
                cellPersonalResponsibilityMedBill.AddParagraph("MEDBILL");
                cellPersonalResponsibilityMedBill.Format.Font.Bold = true;
                cellPersonalResponsibilityMedBill.Format.Font.Size = 7;
                cellPersonalResponsibilityMedBill.Format.Font.Name = "Malgun Gothic";
                cellPersonalResponsibilityMedBill.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                MigraDocDOM.Tables.Cell cellPersonalResponsibilityBillDate = prRow.Cells[1];
                cellPersonalResponsibilityBillDate.AddParagraph("서비스 날짜");
                cellPersonalResponsibilityBillDate.Format.Font.Bold = true;
                cellPersonalResponsibilityBillDate.Format.Font.Size = 7;
                cellPersonalResponsibilityBillDate.Format.Font.Name = "Malgun Gothic";
                cellPersonalResponsibilityBillDate.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                MigraDocDOM.Tables.Cell cellPersonalResponsibilityMedicalProvider = prRow.Cells[2];
                cellPersonalResponsibilityMedicalProvider.AddParagraph("의료기관명");
                cellPersonalResponsibilityMedicalProvider.Format.Font.Bold = true;
                cellPersonalResponsibilityMedicalProvider.Format.Font.Size = 7;
                cellPersonalResponsibilityMedicalProvider.Format.Font.Name = "Malgun Gothic";
                cellPersonalResponsibilityMedicalProvider.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                MigraDocDOM.Tables.Cell cellPersonalResponsibilityBillAmount = prRow.Cells[3];
                cellPersonalResponsibilityBillAmount.AddParagraph("청구액(원금)");
                cellPersonalResponsibilityBillAmount.Format.Font.Bold = true;
                cellPersonalResponsibilityBillAmount.Format.Font.Size = 7;
                cellPersonalResponsibilityBillAmount.Format.Font.Name = "Malgun Gothic";
                cellPersonalResponsibilityBillAmount.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                MigraDocDOM.Tables.Cell cellPersonalResponsibilityType = prRow.Cells[4];
                cellPersonalResponsibilityType.AddParagraph("Type");
                cellPersonalResponsibilityType.Format.Font.Bold = true;
                cellPersonalResponsibilityType.Format.Font.Size = 7;
                cellPersonalResponsibilityType.Format.Font.Name = "Malgun Gothic";
                cellPersonalResponsibilityType.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                MigraDocDOM.Tables.Cell cellPersonalResponsibilityTotal = prRow.Cells[5];
                cellPersonalResponsibilityTotal.AddParagraph("Personal Responsibility Total");
                cellPersonalResponsibilityTotal.Format.Font.Bold = true;
                cellPersonalResponsibilityTotal.Format.Font.Size = 7;
                cellPersonalResponsibilityTotal.Format.Font.Name = "Malgun Gothic";
                cellPersonalResponsibilityTotal.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);


                for (int i = 0; i < lstPersonalResponsibilityInfo.Count; i++)
                {
                    if (i < lstPersonalResponsibilityInfo.Count - 1)
                    {
                        MigraDocDOM.Tables.Row rowData = tablePersonalResponsibility.AddRow();
                        rowData.VerticalAlignment = MigraDocDOM.Tables.VerticalAlignment.Center;
                        rowData.Height = "0.18in";

                        MigraDocDOM.Tables.Cell cell = rowData.Cells[0];
                        cell.AddParagraph(lstPersonalResponsibilityInfo[i].MedBillName.Substring(8));
                        cell.Format.Font.Bold = false;
                        cell.Format.Font.Name = "Malgun Gothic";
                        cell.Format.Font.Size = 7;
                        cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                        cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                        cell = rowData.Cells[1];
                        cell.AddParagraph(lstPersonalResponsibilityInfo[i].BillDate.Value.ToString("MM/dd/yyyy"));
                        cell.Format.Font.Bold = false;
                        cell.Format.Font.Name = "Malgun Gothic";
                        cell.Format.Font.Size = 7;
                        cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                        cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                        cell = rowData.Cells[2];
                        cell.AddParagraph(lstPersonalResponsibilityInfo[i].MedicalProvider);
                        cell.Format.Font.Bold = false;
                        cell.Format.Font.Name = "Malgun Gothic";
                        cell.Format.Font.Size = 7;
                        cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                        cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Left;

                        cell = rowData.Cells[3];
                        cell.AddParagraph(lstPersonalResponsibilityInfo[i].BillAmount.ToString("C"));
                        cell.Format.Font.Bold = false;
                        cell.Format.Font.Name = "Malgun Gothic";
                        cell.Format.Font.Size = 7;
                        cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                        cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Right;

                        cell = rowData.Cells[4];
                        cell.AddParagraph(lstPersonalResponsibilityInfo[i].Type);
                        cell.Format.Font.Bold = false;
                        cell.Format.Font.Name = "Malgun Gothic";
                        cell.Format.Font.Size = 7;
                        cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                        cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Left;

                        cell = rowData.Cells[5];
                        cell.AddParagraph(lstPersonalResponsibilityInfo[i].PersonalResponsibilityTotal.ToString("C"));
                        cell.Format.Font.Bold = false;
                        cell.Format.Font.Name = "Malgun Gothic";
                        cell.Format.Font.Size = 7;
                        cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                        cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Right;
                    }
                    else if (i == lstPersonalResponsibilityInfo.Count - 1)
                    {
                        MigraDocDOM.Tables.Row rowData = tablePersonalResponsibility.AddRow();
                        rowData.VerticalAlignment = MigraDocDOM.Tables.VerticalAlignment.Center;
                        rowData.Height = "0.2in";

                        MigraDocDOM.Tables.Cell cell = rowData.Cells[0];
                        cell.AddParagraph(lstPersonalResponsibilityInfo[i].MedBillName);
                        cell.Format.Font.Bold = true;
                        cell.Format.Font.Name = "Malgun Gothic";
                        cell.Format.Font.Size = 7;
                        cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                        cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                        cell = rowData.Cells[1];
                        if (lstPersonalResponsibilityInfo[i].BillDate != null) cell.AddParagraph(lstPersonalResponsibilityInfo[i].BillDate.Value.ToString("MM/dd/yyyy"));
                        cell.Format.Font.Bold = true;
                        cell.Format.Font.Name = "Malgun Gothic";
                        cell.Format.Font.Size = 7;
                        cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                        cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                        cell = rowData.Cells[2];
                        cell.AddParagraph(lstPersonalResponsibilityInfo[i].MedicalProvider);
                        cell.Format.Font.Bold = true;
                        cell.Format.Font.Name = "Malgun Gothic";
                        cell.Format.Font.Size = 7;
                        cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                        cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Left;

                        cell = rowData.Cells[3];
                        cell.AddParagraph(lstPersonalResponsibilityInfo[i].BillAmount.ToString("C"));
                        cell.Format.Font.Bold = true;
                        cell.Format.Font.Name = "Malgun Gothic";
                        cell.Format.Font.Size = 7;
                        cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                        cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Right;

                        cell = rowData.Cells[4];
                        cell.AddParagraph(lstPersonalResponsibilityInfo[i].Type);
                        cell.Format.Font.Bold = true;
                        cell.Format.Font.Name = "Malgun Gothic";
                        cell.Format.Font.Size = 7;
                        cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                        cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Left;

                        cell = rowData.Cells[5];
                        cell.AddParagraph(lstPersonalResponsibilityInfo[i].PersonalResponsibilityTotal.ToString("C"));
                        cell.Format.Font.Bold = true;
                        cell.Format.Font.Name = "Malgun Gothic";
                        cell.Format.Font.Size = 7;
                        cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                        cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Right;
                    }
                }

                pdfPersonalResponsibilityDoc.LastSection.Add(tablePersonalResponsibility);

                MigraDocDOM.Paragraph verticalSpace = section.AddParagraph();

                verticalSpace.Format.SpaceBefore = "0.05in";
                //verticalSpace.Format.SpaceAfter = "0.1in";

                // put No PR, No Sharing code for generating pdf here

                if (gvIneligibleNoSharing.Rows.Count > 0)
                {
                    List<SettlementIneligibleInfoBlueSheet> lstMedBillNoPRNoSharing = new List<SettlementIneligibleInfoBlueSheet>();

                    for (int i = 0; i < gvIneligibleNoSharing.Rows.Count; i++)
                    {
                        SettlementIneligibleInfoBlueSheet info = new SettlementIneligibleInfoBlueSheet();

                        //String BillDate = gvPersonalResponsibility[1, i]?.Value.ToString();
                        //if (BillDate != String.Empty) prInfo.BillDate = DateTime.Parse(BillDate);


                        info.MedBillName = gvIneligibleNoSharing["MEDBILL", i]?.Value.ToString();
                        //info.BillDate = DateTime.Parse(gvIneligibleNoSharing["서비스 날짜", i].Value.ToString());
                        String BillDate = gvIneligibleNoSharing["서비스 날짜", i]?.Value.ToString();
                        if (BillDate != String.Empty) info.BillDate = DateTime.Parse(BillDate);

                        info.MedicalProvider = gvIneligibleNoSharing["의료기관명", i]?.Value.ToString();
                        info.BillAmount = Double.Parse(gvIneligibleNoSharing["청구액(원금)", i]?.Value.ToString().Substring(1));
                        info.Type = gvIneligibleNoSharing["Type", i]?.Value.ToString();
                        info.IneligibleAmount = Double.Parse(gvIneligibleNoSharing["지원불가 의료비", i]?.Value.ToString().Substring(1));
                        info.IneligibleReason = gvIneligibleNoSharing["지원불가 사유", i]?.Value.ToString();

                        lstMedBillNoPRNoSharing.Add(info);
                    }

                    MigraDocDOM.Paragraph paraIneligibleTitle = section.AddParagraph();
                    paraIneligibleTitle.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                    paraIneligibleTitle.Format.Font.Name = "Malgun Gothic";
                    paraIneligibleTitle.Format.Font.Size = 7;
                    paraIneligibleTitle.Format.Font.Bold = true;
                    paraIneligibleTitle.Format.Alignment = MigraDocDOM.ParagraphAlignment.Left;
                    paraIneligibleTitle.Format.SpaceAfter = "0.05in";
                    paraIneligibleTitle.AddFormattedText("지원불가 의료비", MigraDocDOM.TextFormat.Bold);


                    MigraDocDOM.Tables.Table tableIneligibleNoPR = new MigraDocDOM.Tables.Table();
                    tableIneligibleNoPR.Borders.Width = 0.1;
                    tableIneligibleNoPR.Borders.Color = MigraDoc.DocumentObjectModel.Color.FromCmyk(100, 100, 100, 100);

                    MigraDocDOM.Tables.Column colIneligibleNoPR = tableIneligibleNoPR.AddColumn(MigraDocDOM.Unit.FromInch(0.6));
                    colIneligibleNoPR.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;
                    colIneligibleNoPR = tableIneligibleNoPR.AddColumn(MigraDocDOM.Unit.FromInch(0.7));
                    colIneligibleNoPR.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;
                    colIneligibleNoPR = tableIneligibleNoPR.AddColumn(MigraDocDOM.Unit.FromInch(1.7));
                    colIneligibleNoPR.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;
                    colIneligibleNoPR = tableIneligibleNoPR.AddColumn(MigraDocDOM.Unit.FromInch(0.7));
                    colIneligibleNoPR.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;
                    colIneligibleNoPR = tableIneligibleNoPR.AddColumn(MigraDocDOM.Unit.FromInch(0.8));
                    colIneligibleNoPR.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;
                    colIneligibleNoPR = tableIneligibleNoPR.AddColumn(MigraDocDOM.Unit.FromInch(0.8));
                    colIneligibleNoPR.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;
                    colIneligibleNoPR = tableIneligibleNoPR.AddColumn(MigraDocDOM.Unit.FromInch(1.4));
                    colIneligibleNoPR.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                    MigraDocDOM.Tables.Row ineligibleRow = tableIneligibleNoPR.AddRow();
                    ineligibleRow.Height = "0.31in";
                    ineligibleRow.VerticalAlignment = MigraDocDOM.Tables.VerticalAlignment.Center;

                    MigraDocDOM.Tables.Cell cellIneligibleNoPRMedBill = ineligibleRow.Cells[0];
                    cellIneligibleNoPRMedBill.AddParagraph("MEDBILL");
                    cellIneligibleNoPRMedBill.Format.Font.Bold = true;
                    cellIneligibleNoPRMedBill.Format.Font.Size = 7;
                    cellIneligibleNoPRMedBill.Format.Font.Name = "Malgun Gothic";
                    cellIneligibleNoPRMedBill.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                    MigraDocDOM.Tables.Cell cellIneligibleNoPRBillDate = ineligibleRow.Cells[1];
                    cellIneligibleNoPRBillDate.AddParagraph("서비스 날짜");
                    cellIneligibleNoPRBillDate.Format.Font.Bold = true;
                    cellIneligibleNoPRBillDate.Format.Font.Size = 7;
                    cellIneligibleNoPRBillDate.Format.Font.Name = "Malgun Gothic";
                    cellIneligibleNoPRBillDate.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                    MigraDocDOM.Tables.Cell cellIneligibleNoPRMedicalProvider = ineligibleRow.Cells[2];
                    cellIneligibleNoPRMedicalProvider.AddParagraph("의료기관명");
                    cellIneligibleNoPRMedicalProvider.Format.Font.Bold = true;
                    cellIneligibleNoPRMedicalProvider.Format.Font.Size = 7;
                    cellIneligibleNoPRMedicalProvider.Format.Font.Name = "Malgun Gothic";

                    MigraDocDOM.Tables.Cell cellIneligibleNoPRBillAmount = ineligibleRow.Cells[3];
                    cellIneligibleNoPRBillAmount.AddParagraph("청구액(원금)");
                    cellIneligibleNoPRBillAmount.Format.Font.Bold = true;
                    cellIneligibleNoPRBillAmount.Format.Font.Size = 7;
                    cellIneligibleNoPRBillAmount.Format.Font.Name = "Malgun Gothic";

                    MigraDocDOM.Tables.Cell cellIneligibleNoPRType = ineligibleRow.Cells[4];
                    cellIneligibleNoPRType.AddParagraph("Type");
                    cellIneligibleNoPRType.Format.Font.Bold = true;
                    cellIneligibleNoPRType.Format.Font.Size = 7;
                    cellIneligibleNoPRType.Format.Font.Name = "Malgun Gothic";

                    MigraDocDOM.Tables.Cell cellIneligibleNoPRIneligibleAmount = ineligibleRow.Cells[5];
                    cellIneligibleNoPRIneligibleAmount.AddParagraph("지원불가 의료비");
                    cellIneligibleNoPRIneligibleAmount.Format.Font.Bold = true;
                    cellIneligibleNoPRIneligibleAmount.Format.Font.Size = 7;
                    cellIneligibleNoPRIneligibleAmount.Format.Font.Name = "Malgun Gothic";

                    MigraDocDOM.Tables.Cell cellIneligibleNoPRIneligibleReason = ineligibleRow.Cells[6];
                    cellIneligibleNoPRIneligibleReason.AddParagraph("지원불가 사유");
                    cellIneligibleNoPRIneligibleReason.Format.Font.Bold = true;
                    cellIneligibleNoPRIneligibleReason.Format.Font.Size = 7;
                    cellIneligibleNoPRIneligibleReason.Format.Font.Name = "Malgun Gothic";

                    for (int i = 0; i < lstMedBillNoPRNoSharing.Count; i++)
                    {
                        if (i < lstMedBillNoPRNoSharing.Count - 1)
                        {
                            MigraDocDOM.Tables.Row rowData = tableIneligibleNoPR.AddRow();
                            rowData.VerticalAlignment = MigraDocDOM.Tables.VerticalAlignment.Center;
                            rowData.Height = "0.18in";

                            MigraDocDOM.Tables.Cell cell = rowData.Cells[0];
                            cell.AddParagraph(lstMedBillNoPRNoSharing[i].MedBillName.Substring(8));
                            cell.Format.Font.Bold = false;
                            cell.Format.Font.Name = "Malgun Gothic";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                            cell = rowData.Cells[1];
                            cell.AddParagraph(lstMedBillNoPRNoSharing[i].BillDate.Value.ToString("MM/dd/yyyy"));
                            cell.Format.Font.Bold = false;
                            cell.Format.Font.Name = "Malgun Gothic";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                            cell = rowData.Cells[2];
                            cell.AddParagraph(lstMedBillNoPRNoSharing[i].MedicalProvider);
                            cell.Format.Font.Bold = false;
                            cell.Format.Font.Name = "Malgun Gothic";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Left;

                            cell = rowData.Cells[3];
                            cell.AddParagraph(lstMedBillNoPRNoSharing[i].BillAmount.ToString("C"));
                            cell.Format.Font.Bold = false;
                            cell.Format.Font.Name = "Malgun Gothic";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Right;

                            cell = rowData.Cells[4];
                            cell.AddParagraph(lstMedBillNoPRNoSharing[i].Type);
                            cell.Format.Font.Bold = false;
                            cell.Format.Font.Name = "Malgun Gothic";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Left;

                            cell = rowData.Cells[5];
                            cell.AddParagraph(lstMedBillNoPRNoSharing[i].IneligibleAmount.Value.ToString("C"));
                            cell.Format.Font.Bold = false;
                            cell.Format.Font.Name = "Malgun Gothic";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Right;

                            cell = rowData.Cells[6];
                            cell.AddParagraph(lstMedBillNoPRNoSharing[i].IneligibleReason);
                            cell.Format.Font.Bold = false;
                            cell.Format.Font.Name = "Malgun Gothic";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Left;
                        }
                        else if (i == lstMedBillNoPRNoSharing.Count - 1)
                        {
                            MigraDocDOM.Tables.Row rowData = tableIneligibleNoPR.AddRow();
                            rowData.VerticalAlignment = MigraDocDOM.Tables.VerticalAlignment.Center;
                            rowData.Height = "0.18in";

                            MigraDocDOM.Tables.Cell cell = rowData.Cells[0];
                            cell.AddParagraph(lstMedBillNoPRNoSharing[i].MedBillName);
                            cell.Format.Font.Bold = true;
                            cell.Format.Font.Name = "Malgun Gothic";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                            cell = rowData.Cells[1];
                            if (lstMedBillNoPRNoSharing[i].BillDate != null) cell.AddParagraph(lstMedBillNoPRNoSharing[i].BillDate.Value.ToString("MM/dd/yyyy"));
                            cell.Format.Font.Bold = true;
                            cell.Format.Font.Name = "Malgun Gothic";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                            cell = rowData.Cells[2];
                            cell.AddParagraph(lstMedBillNoPRNoSharing[i].MedicalProvider);
                            cell.Format.Font.Bold = true;
                            cell.Format.Font.Name = "Malgun Gothic";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                            cell = rowData.Cells[3];
                            cell.AddParagraph(lstMedBillNoPRNoSharing[i].BillAmount.ToString("C"));
                            cell.Format.Font.Bold = true;
                            cell.Format.Font.Name = "Malgun Gothic";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Right;

                            cell = rowData.Cells[4];
                            cell.AddParagraph(lstMedBillNoPRNoSharing[i].Type);
                            cell.Format.Font.Bold = true;
                            cell.Format.Font.Name = "Malgun Gothic";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                            cell = rowData.Cells[5];
                            cell.AddParagraph(lstMedBillNoPRNoSharing[i].IneligibleAmount.Value.ToString("C"));
                            cell.Format.Font.Bold = true;
                            cell.Format.Font.Name = "Malgun Gothic";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Right;

                            cell = rowData.Cells[6];
                            cell.AddParagraph(lstMedBillNoPRNoSharing[i].IneligibleReason);
                            cell.Format.Font.Bold = true;
                            cell.Format.Font.Name = "Malgun Gothic";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Left;
                        }
                    }
                    pdfPersonalResponsibilityDoc.LastSection.Add(tableIneligibleNoPR);

                }



                const bool unicode = true;
                const PdfFontEmbedding embedding = PdfFontEmbedding.Always;

                PdfDocumentRenderer pdfRenderer = new PdfDocumentRenderer(unicode, embedding);
                pdfRenderer.Document = pdfPersonalResponsibilityDoc;
                pdfRenderer.RenderDocument();


                if (txtIncidentNoBlueSheet.Text.Trim() != String.Empty)
                {
                    SaveFileDialog savefileDlg = new SaveFileDialog();
                    savefileDlg.FileName = strIndividualIDBlueSheet + "_" + strIndividualNameBlueSheet + "_" + DateTime.Today.ToString("MM-dd-yyyy") + "_Ko";
                    savefileDlg.Filter = "PDF Files | *.pdf";
                    savefileDlg.DefaultExt = "pdf";
                    savefileDlg.RestoreDirectory = true;

                    if (savefileDlg.ShowDialog() == DialogResult.OK)
                    {
                        try
                        {
                            pdfRenderer.PdfDocument.Save(savefileDlg.FileName);
                            System.Diagnostics.ProcessStartInfo processInfo = new System.Diagnostics.ProcessStartInfo();
                            processInfo.FileName = savefileDlg.FileName;

                            System.Diagnostics.Process.Start(processInfo);
                        }
                        catch (IOException ex)
                        {
                            MessageBox.Show(ex.Message, "Error");
                            return;
                        }
                        //finally
                        //{
                        //    ChkInfoEntered = null;
                        //}
                    }
                }

            }
            else
            {
                MessageBox.Show("No table is populated", "Error");
            }
        }

        private void btnGenerateEnglishPDFBlueSheet_Click(object sender, EventArgs e)
        {
            if ((gvSharedMedBillBlueSheet.RowCount > 0) || 
                (gvCMMPendingPaymentBlueSheet.RowCount > 0) || 
                (gvPendingBlueSheet.RowCount > 0) || 
                (gvIneligibleBlueSheet.RowCount > 0))
            {

                //DateTime? dtDocReceivedDate = null;

                //frmDocReceivedDate frmDocumentReceivedDate = new frmDocReceivedDate();

                //frmDocumentReceivedDate.StartPosition = FormStartPosition.CenterParent;

                //var dlgResultDocReceivedDate = frmDocumentReceivedDate.ShowDialog();

                //if (dlgResultDocReceivedDate == DialogResult.OK)
                //{
                //dtDocReceivedDate = frmDocumentReceivedDate.ReceivedDate;

                MigraDocDOM.Document pdfDoc = new MigraDocDOM.Document();

                MigraDocDOM.Section section = pdfDoc.AddSection();
                pdfDoc.UseCmykColor = true;

                section.PageSetup.PageFormat = MigraDocDOM.PageFormat.Letter;
                section.PageSetup.HeaderDistance = "0.25in";
                section.PageSetup.TopMargin = "1.5in";
                //section.PageSetup.LeftMargin = "0.3in";
                //section.PageSetup.RightMargin = "0.3in";
                section.PageSetup.LeftMargin = "0.8in";
                section.PageSetup.RightMargin = "0.8in";

                section.PageSetup.BottomMargin = "0.5in";

                section.PageSetup.DifferentFirstPageHeaderFooter = false;
                section.Headers.Primary.Format.SpaceBefore = "0.25in";

                MigraDocDOM.Shapes.Image image = section.Headers.Primary.AddImage("C:\\Program Files (x86)\\RN\\RNManager\\cmmlogo.png");

                image.Height = "0.8in";
                image.LockAspectRatio = true;
                image.RelativeVertical = MigraDocDOM.Shapes.RelativeVertical.Line;
                image.RelativeHorizontal = MigraDocDOM.Shapes.RelativeHorizontal.Margin;
                image.Top = MigraDocDOM.Shapes.ShapePosition.Top;
                image.Left = MigraDocDOM.Shapes.ShapePosition.Center;
                image.WrapFormat.Style = MigraDocDOM.Shapes.WrapStyle.TopBottom;

                MigraDocDOM.Paragraph paraCMMAddress = section.Headers.Primary.AddParagraph();
                paraCMMAddress.Format.Font.Name = "Arial";
                paraCMMAddress.Format.Font.Size = 8;
                paraCMMAddress.Format.SpaceBefore = "0.15in";
                paraCMMAddress.Format.SpaceAfter = "0.25in";
                //paraCMMAddress.Format.LeftIndent = "0.5in";
                //paraCMMAddress.Format.RightIndent = "0.5in";
                paraCMMAddress.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                String strVerticalBar = " | ";
                String strStreet = "5235 N. Elston Ave.";
                String strCityStateZip = "Chicago, IL 60630";
                String strPhone = "Phone 773.777.8889";
                String strFax = "773.777.0004";
                String strWebsiteAddr = "www.cmmlogos.org";

                paraCMMAddress.AddFormattedText(strStreet, MigraDocDOM.TextFormat.NotBold);
                paraCMMAddress.AddFormattedText(strVerticalBar, MigraDocDOM.TextFormat.Bold);
                paraCMMAddress.AddFormattedText(strCityStateZip, MigraDocDOM.TextFormat.NotBold);
                paraCMMAddress.AddFormattedText(strVerticalBar, MigraDocDOM.TextFormat.Bold);
                paraCMMAddress.AddFormattedText(strPhone, MigraDocDOM.TextFormat.NotBold);
                paraCMMAddress.AddFormattedText(strVerticalBar, MigraDocDOM.TextFormat.Bold);
                paraCMMAddress.AddFormattedText(strFax, MigraDocDOM.TextFormat.NotBold);
                paraCMMAddress.AddFormattedText(strVerticalBar, MigraDocDOM.TextFormat.Bold);
                paraCMMAddress.AddFormattedText(strWebsiteAddr, MigraDocDOM.TextFormat.NotBold);

                MigraDocDOM.Paragraph paraToday = section.AddParagraph();
                paraToday.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                paraToday.Format.Font.Name = "Arial";
                paraToday.Format.Alignment = MigraDocDOM.ParagraphAlignment.Left;
                paraToday.Format.SpaceBefore = "0.25in";
                paraToday.Format.SpaceAfter = "0.25in";
                //paraToday.Format.LeftIndent = "0.5in";
                //paraToday.Format.RightIndent = "0.5in";
                paraToday.AddFormattedText(DateTime.Today.ToString("MM/dd/yyyy"));

                //if (rbCheckBlueSheet.Checked) paraToday.AddFormattedText(dtpCheckIssueDateBlueSheet.Value.ToString("MM/dd/yyyy"));
                //else if (rbACHBlueSheet.Checked) paraToday.AddFormattedText(dtpACHTransactionDateBlueSheet.Value.ToString("MM/dd/yyyy"));
                //else if (rbCreditCardBlueSheet.Checked) paraToday.AddFormattedText(dtpCreditCardPaymentDateBlueSheet.Value.ToString("MM/dd/yyyy"));

                MigraDocDOM.Paragraph paraMembershipInfo = section.AddParagraph();

                paraMembershipInfo.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                paraMembershipInfo.Format.Font.Name = "Arial";
                //paraMembershipInfo.Format.SpaceBefore = "0.7in";
                paraMembershipInfo.Format.SpaceBefore = "0.2in";
                paraMembershipInfo.Format.SpaceAfter = "0.2in";
                //paraMembershipInfo.Format.LeftIndent = "0.5in";
                //paraMembershipInfo.Format.RightIndent = "0.5in";
                paraMembershipInfo.Format.Alignment = MigraDocDOM.ParagraphAlignment.Left;
                if (strMembershipIdBlueSheet != String.Empty) paraMembershipInfo.AddFormattedText(strMembershipIdBlueSheet + " (" + strIndividualIDBlueSheet + ")\n");
                else paraMembershipInfo.AddFormattedText(strIndividualIDBlueSheet + "\n");
                paraMembershipInfo.AddFormattedText(strIndividualNameBlueSheet + "\n");
                paraMembershipInfo.AddFormattedText(strStreetAddressBlueSheet + "\n");
                paraMembershipInfo.AddFormattedText(strCityBlueSheet + ", " + strStateBlueSheet + " " + strZipBlueSheet + "\n");


                MigraDocDOM.Paragraph paraDearMember = section.AddParagraph();
                paraDearMember.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                paraDearMember.Format.Font.Name = "Arial";
                paraDearMember.Format.Font.Size = 9;
                paraDearMember.Format.Alignment = MigraDocDOM.ParagraphAlignment.Left;
                //paraDearMember.Format.LeftIndent = "0.5in";
                //paraDearMember.Format.RightIndent = "0.5in";
                paraDearMember.Format.SpaceBefore = "0.1in";
                paraDearMember.Format.SpaceAfter = "0.1in";
                //paraDearMember.AddFormattedText(strPrimaryName + "회원(가족)께,");
                paraDearMember.AddFormattedText(strDearMember + " " + strIndividualNameBlueSheet.Trim() + ", ");


                MigraDocDOM.Paragraph paraGreetingMessage = section.AddParagraph();

                paraGreetingMessage.Format.Font.Color = MigraDoc.DocumentObjectModel.Color.FromCmyk(100, 100, 100, 100);
                paraGreetingMessage.Format.Font.Name = "Arial";
                paraGreetingMessage.Format.Font.Size = 9;
                //paraGreetingMessage.Format.LeftIndent = "0.5in";
                //paraGreetingMessage.Format.RightIndent = "0.5in";
                paraGreetingMessage.Format.Alignment = MigraDocDOM.ParagraphAlignment.Justify;
                //paraGreetingMessage.AddFormattedText(strGreetingMessage, TextFormat.NotBold);
                //paraGreetingMessage.AddFormattedText(strGreetingMessagePara1, TextFormat.NotBold);
                paraGreetingMessage.AddFormattedText(strEnglishGreetingMessage1, MigraDocDOM.TextFormat.NotBold);

                MigraDocDOM.Paragraph paraGreetingMessage2 = section.AddParagraph();
                paraGreetingMessage2.Format.Font.Color = MigraDoc.DocumentObjectModel.Color.FromCmyk(100, 100, 100, 100);
                paraGreetingMessage2.Format.Font.Name = "Arial";
                paraGreetingMessage2.Format.Font.Size = 9;
                //paraGreetingMessage2.Format.LeftIndent = "0.5in";
                //paraGreetingMessage2.Format.RightIndent = "0.5in";
                paraGreetingMessage2.Format.Alignment = MigraDocDOM.ParagraphAlignment.Justify;
                //paraGreetingMessage2.AddFormattedText(strGreetingMessagePara2, TextFormat.NotBold);
                paraGreetingMessage2.AddFormattedText(strEnglishGreetingMessage2, MigraDocDOM.TextFormat.NotBold);

                MigraDocDOM.Paragraph paraGreetingMessage3 = section.AddParagraph();
                paraGreetingMessage3.Format.Font.Color = MigraDoc.DocumentObjectModel.Color.FromCmyk(100, 100, 100, 100);
                paraGreetingMessage3.Format.Font.Name = "Arial";
                paraGreetingMessage3.Format.Font.Size = 9;
                //paraGreetingMessage3.Format.LeftIndent = "0.5in";
                //paraGreetingMessage3.Format.RightIndent = "0.5in";
                paraGreetingMessage3.Format.Alignment = MigraDocDOM.ParagraphAlignment.Justify;
                //paraGreetingMessage3.AddFormattedText(strGreetingMessagePara3, TextFormat.NotBold);
                paraGreetingMessage3.AddFormattedText(strEnglishGreetingMessage3, MigraDocDOM.TextFormat.NotBold);

                MigraDocDOM.Paragraph paraGreetingMessage4 = section.AddParagraph();
                paraGreetingMessage4.Format.Font.Color = MigraDoc.DocumentObjectModel.Color.FromCmyk(100, 100, 100, 100);
                paraGreetingMessage4.Format.Font.Name = "Arial";
                paraGreetingMessage4.Format.Font.Size = 9;
                //paraGreetingMessage4.Format.LeftIndent = "0.5in";
                //paraGreetingMessage4.Format.RightIndent = "0.5in";
                paraGreetingMessage4.Format.Alignment = MigraDocDOM.ParagraphAlignment.Justify;
                //paraGreetingMessage4.AddFormattedText(strGreetingMessagePara4, TextFormat.NotBold);
                paraGreetingMessage4.AddFormattedText(strEnglishGreetingMessage4, MigraDocDOM.TextFormat.NotBold);



                MigraDocDOM.Paragraph paraNeedsProcessing = section.AddParagraph();

                paraNeedsProcessing.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                paraNeedsProcessing.Format.Font.Name = "Arial";
                paraNeedsProcessing.Format.Font.Size = 9;
                paraNeedsProcessing.Format.Font.Bold = true;
                paraNeedsProcessing.Format.Alignment = MigraDocDOM.ParagraphAlignment.Left;
                paraNeedsProcessing.Format.SpaceBefore = "0.1in";
                //paraNeedsProcessing.Format.LeftIndent = "0.5in";
                //paraNeedsProcessing.Format.RightIndent = "0.5in";
                paraNeedsProcessing.AddFormattedText(strCMM_NeedProcessing + "\n");

                MigraDocDOM.Paragraph paraPhoneFaxEmail = section.AddParagraph();
                paraPhoneFaxEmail.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                paraPhoneFaxEmail.Format.Font.Size = 9;
                paraPhoneFaxEmail.Format.Alignment = MigraDocDOM.ParagraphAlignment.Left;
                //paraPhoneFaxEmail.Format.LeftIndent = "0.5in";
                //paraPhoneFaxEmail.Format.RightIndent = "0.5in";
                paraPhoneFaxEmail.AddFormattedText(strNP_Phone_Fax_Email + "\n");

                MigraDocDOM.Paragraph paraHorizontalLine = section.AddParagraph();

                paraHorizontalLine.Format.SpaceBefore = "0.05in";
                paraHorizontalLine.Format.SpaceAfter = "0.05in";
                paraHorizontalLine.Format.Borders.Top.Width = 0;
                paraHorizontalLine.Format.Borders.Left.Width = 0;
                paraHorizontalLine.Format.Borders.Right.Width = 0;
                paraHorizontalLine.Format.Borders.Bottom.Width = 1;
                paraHorizontalLine.Format.Borders.Bottom.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                paraHorizontalLine.Format.Borders.Style = MigraDocDOM.BorderStyle.DashDot;

                MigraDocDOM.Paragraph paraNPStatement = section.AddParagraph();
                paraNPStatement.Format.Font.Color = MigraDoc.DocumentObjectModel.Color.FromCmyk(100, 100, 0, 0);
                paraNPStatement.Format.Font.Name = "Arial";
                paraNPStatement.Format.Font.Size = 9;
                paraNPStatement.Format.Font.Bold = true;
                paraNPStatement.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;
                paraNPStatement.Format.SpaceAfter = "0.1in";

                paraNPStatement.AddFormattedText("Needs Processing Statement\n", MigraDocDOM.TextFormat.Bold);

                MigraDocDOM.Paragraph paraCheckInfo = section.AddParagraph();
                paraCheckInfo.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                paraCheckInfo.Format.Font.Name = "Arial";
                paraCheckInfo.Format.Font.Size = 9;
                paraCheckInfo.Format.Font.Bold = true;
                paraCheckInfo.Format.Alignment = MigraDocDOM.ParagraphAlignment.Left;
                paraCheckInfo.Format.SpaceBefore = "0.1in";
                //paraCheckInfo.Format.SpaceAfter = "0.1in";

                //if (rbCheckBlueSheet.Checked) paraToday.AddFormattedText(dtpCheckIssueDateBlueSheet.Value.ToString("MM/dd/yyyy"));
                //else if (rbACHBlueSheet.Checked) paraToday.AddFormattedText(dtpACHTransactionDateBlueSheet.Value.ToString("MM/dd/yyyy"));
                //else if (rbCreditCardBlueSheet.Checked) paraToday.AddFormattedText(dtpCreditCardPaymentDateBlueSheet.Value.ToString("MM/dd/yyyy"));

                //if (ChkInfoEntered != null)
                if (rbCheckBlueSheet.Checked)
                {
                    //paraCheckInfo.AddFormattedText("Issue Date: " + ChkInfoEnteredBlueSheet.dtCheckIssueDate.ToString("MM/dd/yyyy") +
                    //                                "\tCheck No: " + ChkInfoEnteredBlueSheet.CheckNumber +
                    //                                "\tCheck Amount: " + ChkInfoEnteredBlueSheet.CheckAmount.Value.ToString("C") +
                    //                                "\tPaid To: " + ChkInfoEnteredBlueSheet.PaidTo);
                    paraCheckInfo.AddFormattedText("Issue Date: " + dtpCheckIssueDateBlueSheet.Value.ToString("MM/dd/yyyy") +
                                "\tCheck No: " + ChkInfoEnteredBlueSheet.CheckNumber +
                                "\tCheck Amount: " + ChkInfoEnteredBlueSheet.CheckAmount.Value.ToString("C") +
                                "\tPaid To: " + ChkInfoEnteredBlueSheet.PaidTo);

                    //ChkInfoEntered = null;
                }
                else if (rbACHBlueSheet.Checked)
                {
                    paraCheckInfo.AddFormattedText("Issue Date: " + dtpACHTransactionDateBlueSheet.Value.ToString("MM/dd/yyyy") +
                                                    "\tACH No: " + ACHInfoEnteredBlueSheet.ACHNumber +
                                                    "\tACH Amount: " + ACHInfoEnteredBlueSheet.ACHAmount.Value.ToString("C") +
                                                    "\tPaid To: " + ACHInfoEnteredBlueSheet.PaidTo);
                }
                else if (rbCreditCardBlueSheet.Checked)
                {
                    paraCheckInfo.AddFormattedText("Date:" + dtpCreditCardPaymentDateBlueSheet.Value.ToString("MM/dd/yyyy") +
                                                    "\tCredit Card Payment Amount: " + CreditCardPaymentEnteredBlueSheet.CCPaymentAmount.Value.ToString("C") +
                                                    "\tPaid To: " + CreditCardPaymentEnteredBlueSheet.PaidTo);
                }

                //int nRowHeight = 338;
                //int nRowHeight = 302;
                int nRowHeight = 296;

                if (lstIncidentsBlueSheet.Count > 0)
                {
                    MigraDocDOM.Paragraph paraIncd = section.AddParagraph();

                    paraIncd.Format.Font.Color = MigraDoc.DocumentObjectModel.Color.FromCmyk(100, 100, 100, 100);
                    paraIncd.Format.Font.Name = "Arial";
                    paraIncd.Format.Font.Size = 8;
                    paraIncd.Format.Font.Bold = true;

                    MigraDocDOM.Tables.Table tableIncd = new MigraDocDOM.Tables.Table();
                    tableIncd.Borders.Width = 0;
                    tableIncd.Borders.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                    MigraDocDOM.Tables.Column colINCD = tableIncd.AddColumn(MigraDocDOM.Unit.FromInch(0.85));
                    colINCD.Format.Alignment = MigraDocDOM.ParagraphAlignment.Left;
                    //colINCD = tableIncd.AddColumn(MigraDocDOM.Unit.FromInch(1));
                    //colINCD.Format.Alignment = ParagraphAlignment.Left;
                    colINCD = tableIncd.AddColumn(MigraDocDOM.Unit.FromInch(3.5));
                    colINCD.Format.Alignment = MigraDocDOM.ParagraphAlignment.Left;

                    foreach (IncidentBlueSheet incd in lstIncidentsBlueSheet)
                    {
                        nRowHeight += 18;

                        MigraDocDOM.Tables.Row IncdRow = tableIncd.AddRow();
                        IncdRow.Height = "0.15in";
                        IncdRow.VerticalAlignment = MigraDocDOM.Tables.VerticalAlignment.Center;

                        MigraDocDOM.Tables.Cell cellIncdName = IncdRow.Cells[0];
                        cellIncdName.Format.Font.Bold = true;
                        cellIncdName.Format.Font.Size = 8;
                        cellIncdName.Format.Font.Name = "Arial";
                        cellIncdName.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                        cellIncdName.AddParagraph(incd.Name.Substring(2) + ": ");

                        //MigraDocDOM.Tables.Cell cellPatientName = IncdRow.Cells[1];
                        //cellPatientName.Format.Font.Bold = true;
                        //cellPatientName.Format.Font.Size = 8;
                        //cellPatientName.Format.Font.Name = "Arial";
                        //cellPatientName.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                        //if (incd.PatientName.Length > 11)
                        //{
                        //    cellPatientName.AddParagraph(incd.PatientName.Substring(0, 11) + " ...");
                        //}
                        //else cellPatientName.AddParagraph(incd.PatientName);

                        MigraDocDOM.Tables.Cell cellICD10Code = IncdRow.Cells[1];
                        cellICD10Code.Format.Font.Bold = true;
                        cellICD10Code.Format.Font.Size = 8;
                        cellICD10Code.Format.Font.Name = "Arial";
                        cellICD10Code.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                        cellICD10Code.AddParagraph(incd.ICD10_Code);
                    }

                    pdfDoc.LastSection.Add(tableIncd);
                }

                //section.AddParagraph();
                //lstPaidMedicalExpenseTableRow.Clear();

                if (gvSharedMedBillBlueSheet.RowCount > 0)
                {

                    section.AddParagraph();
                    lstPaidMedicalExpenseTableRowBlueSheet.Clear();

                    //nRowHeight += 30;
                    nRowHeight += 22;

                    MigraDocDOM.Paragraph paraSpaceBefore = section.AddParagraph();
                    //paraSpaceBefore.Format.SpaceBefore = "0.18in";
                    paraSpaceBefore.Format.SpaceBefore = "0.08in";
                    paraSpaceBefore.Format.SpaceAfter = "0.05in";
                    paraSpaceBefore.Format.Font.Color = MigraDoc.DocumentObjectModel.Color.FromCmyk(100, 100, 0, 0);
                    paraSpaceBefore.Format.Font.Name = "Arial";
                    paraSpaceBefore.Format.Font.Size = 7;
                    paraSpaceBefore.AddFormattedText("Processed Medical Bill(s)", MigraDocDOM.TextFormat.Bold);

                    for (int nRow = 0; nRow < gvSharedMedBillBlueSheet.RowCount; nRow++)
                    {
                        PaidMedicalExpenseTableRowBlueSheet expenseRow = new PaidMedicalExpenseTableRowBlueSheet();

                        //if (nRow < gvBillPaid.RowCount - 1)
                        //{
                        //    expenseRow.PatientName = gvBillPaid[1, nRow].Value.ToString();
                        //    expenseRow.MED_BILL = gvBillPaid[2, nRow].Value.ToString();
                        //    //expenseRow.Bill_Date = gvBillPaid[3, nRow].Value.ToString();
                        //    expenseRow.Bill_Date = DateTime.Parse(gvBillPaid[3, nRow].Value.ToString());
                        //    expenseRow.Medical_Provider = gvBillPaid[4, nRow].Value.ToString();
                        //    expenseRow.Bill_Amount = gvBillPaid[5, nRow].Value.ToString();
                        //    expenseRow.Personal_Responsibility = gvBillPaid[6, nRow].Value.ToString();
                        //    expenseRow.Member_Discount = gvBillPaid[7, nRow].Value.ToString();
                        //    expenseRow.CMM_Discount = gvBillPaid[8, nRow].Value.ToString();
                        //    expenseRow.CMM_Provider_Payment = gvBillPaid[9, nRow].Value.ToString();
                        //    expenseRow.PastReimbursement = gvBillPaid[10, nRow].Value.ToString();
                        //    expenseRow.Reimbursement = gvBillPaid[11, nRow].Value.ToString();
                        //    expenseRow.Balance = gvBillPaid[12, nRow].Value.ToString();

                        //}
                        //if (nRow == gvBillPaid.RowCount - 1)
                        //{
                        expenseRow.PatientName = gvSharedMedBillBlueSheet[1, nRow].Value.ToString();
                        expenseRow.MED_BILL = gvSharedMedBillBlueSheet[2, nRow].Value.ToString();
                        if (gvSharedMedBillBlueSheet[3, nRow].Value.ToString() != String.Empty) expenseRow.Bill_Date = DateTime.Parse(gvSharedMedBillBlueSheet[3, nRow].Value.ToString());
                        expenseRow.Medical_Provider = gvSharedMedBillBlueSheet[4, nRow].Value.ToString();
                        expenseRow.Bill_Amount = gvSharedMedBillBlueSheet[5, nRow].Value.ToString();
                        expenseRow.Personal_Responsibility = gvSharedMedBillBlueSheet[6, nRow].Value.ToString();
                        expenseRow.Member_Discount = gvSharedMedBillBlueSheet[7, nRow].Value.ToString();
                        expenseRow.CMM_Discount = gvSharedMedBillBlueSheet[8, nRow].Value.ToString();
                        expenseRow.CMM_Provider_Payment = gvSharedMedBillBlueSheet[9, nRow].Value.ToString();
                        if (PaidToBlueSheet == EnumPaidTo.Member)
                        {
                            expenseRow.PastReimbursement = gvSharedMedBillBlueSheet[10, nRow].Value.ToString();
                            expenseRow.Reimbursement = gvSharedMedBillBlueSheet[11, nRow].Value.ToString();
                        }
                        if (PaidToBlueSheet == EnumPaidTo.MedicalProvider)
                        {
                            expenseRow.PastCMM_Provider_Payment = gvSharedMedBillBlueSheet[10, nRow].Value.ToString();
                            expenseRow.Reimbursement = gvSharedMedBillBlueSheet[11, nRow].Value.ToString();
                        }
                        expenseRow.Balance = gvSharedMedBillBlueSheet[12, nRow].Value.ToString();
                        //}
                        lstPaidMedicalExpenseTableRowBlueSheet.Add(expenseRow);
                    }



                    MigraDocDOM.Tables.Table table = new MigraDocDOM.Tables.Table();
                    table.Borders.Width = 0.1;
                    table.Borders.Color = MigraDoc.DocumentObjectModel.Color.FromCmyk(100, 100, 100, 100);

                    //MigraDocDOM.Tables.Column col = table.AddColumn(MigraDocDOM.Unit.FromInch(0.7));
                    //col.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                    MigraDocDOM.Tables.Column col = table.AddColumn(MigraDocDOM.Unit.FromInch(0.5));
                    col.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                    col = table.AddColumn(MigraDocDOM.Unit.FromInch(0.5));
                    col.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                    col = table.AddColumn(MigraDocDOM.Unit.FromInch(1.0));
                    col.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                    col = table.AddColumn(MigraDocDOM.Unit.FromInch(0.7));
                    col.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                    col = table.AddColumn(MigraDocDOM.Unit.FromInch(0.7));
                    col.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                    col = table.AddColumn(MigraDocDOM.Unit.FromInch(0.6));
                    col.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                    col = table.AddColumn(MigraDocDOM.Unit.FromInch(0.5));
                    col.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                    col = table.AddColumn(MigraDocDOM.Unit.FromInch(0.6));
                    col.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                    col = table.AddColumn(MigraDocDOM.Unit.FromInch(0.5));
                    col.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                    col = table.AddColumn(MigraDocDOM.Unit.FromInch(0.8));
                    col.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                    col = table.AddColumn(MigraDocDOM.Unit.FromInch(0.6));
                    col.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;


                    MigraDocDOM.Tables.Row row = table.AddRow();

                    nRowHeight += 22;
                    row.Height = "0.3in";
                    row.VerticalAlignment = MigraDocDOM.Tables.VerticalAlignment.Center;

                    //MigraDocDOM.Tables.Cell cellTitlePatientName = row.Cells[0];
                    //cellTitlePatientName.AddParagraph("Member Name");
                    //cellTitlePatientName.Format.Font.Bold = true;
                    //cellTitlePatientName.Format.Font.Size = 7;
                    //cellTitlePatientName.Format.Font.Name = "Arial";
                    //cellTitlePatientName.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                    MigraDocDOM.Tables.Cell cellTitleMedBill = row.Cells[0];
                    cellTitleMedBill.AddParagraph("MEDBILL");
                    cellTitleMedBill.Format.Font.Bold = true;
                    cellTitleMedBill.Format.Font.Size = 7;
                    cellTitleMedBill.Format.Font.Name = "Arial";
                    cellTitleMedBill.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                    MigraDocDOM.Tables.Cell cellTitleBillDate = row.Cells[1];
                    cellTitleBillDate.AddParagraph("Date of Service");
                    cellTitleBillDate.Format.Font.Bold = true;
                    cellTitleBillDate.Format.Font.Size = 7;
                    cellTitleBillDate.Format.Font.Name = "Arial";
                    cellTitleBillDate.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                    MigraDocDOM.Tables.Cell cellTitleMedicalProvider = row.Cells[2];
                    cellTitleMedicalProvider.AddParagraph("Medical Provider");
                    cellTitleMedicalProvider.Format.Font.Bold = true;
                    cellTitleMedicalProvider.Format.Font.Size = 7;
                    cellTitleMedicalProvider.Format.Font.Name = "Arial";
                    cellTitleMedicalProvider.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                    MigraDocDOM.Tables.Cell cellTitleBillAmount = row.Cells[3];
                    cellTitleBillAmount.AddParagraph("Original Amount");
                    cellTitleBillAmount.Format.Font.Bold = true;
                    cellTitleBillAmount.Format.Font.Size = 7;
                    cellTitleBillAmount.Format.Font.Name = "Arial";
                    cellTitleBillAmount.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                    MigraDocDOM.Tables.Cell cellTitlePersonalResponsibility = row.Cells[4];
                    cellTitlePersonalResponsibility.AddParagraph("Personal Responsibility");
                    cellTitlePersonalResponsibility.Format.Font.Bold = true;
                    cellTitlePersonalResponsibility.Format.Font.Size = 7;
                    cellTitlePersonalResponsibility.Format.Font.Name = "Arial";
                    cellTitlePersonalResponsibility.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);


                    MigraDocDOM.Tables.Cell cellTitleMemberDiscount = row.Cells[5];
                    cellTitleMemberDiscount.AddParagraph("Member Discount");
                    cellTitleMemberDiscount.Format.Font.Bold = true;
                    cellTitleMemberDiscount.Format.Font.Size = 7;
                    cellTitleMemberDiscount.Format.Font.Name = "Arial";
                    cellTitleMemberDiscount.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                    MigraDocDOM.Tables.Cell cellTitleCMMDiscount = row.Cells[6];
                    cellTitleCMMDiscount.AddParagraph("CMM Discount");
                    cellTitleCMMDiscount.Format.Font.Bold = true;
                    cellTitleCMMDiscount.Format.Font.Size = 7;
                    cellTitleCMMDiscount.Format.Font.Name = "Arial";
                    cellTitleCMMDiscount.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                    MigraDocDOM.Tables.Cell cellTitleCMMProviderDiscount = row.Cells[7];
                    //cellTitleCMMProviderDiscount.AddParagraph("CMM Provider Payment");
                    //AddParagraph("CMM Provider Payment");
                    cellTitleCMMProviderDiscount.AddParagraph("Paid to Provider");
                    cellTitleCMMProviderDiscount.Format.Font.Bold = true;
                    cellTitleCMMProviderDiscount.Format.Font.Size = 7;
                    cellTitleCMMProviderDiscount.Format.Font.Name = "Arial";
                    cellTitleCMMProviderDiscount.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                    if (PaidToBlueSheet == EnumPaidTo.Member)
                    {
                        MigraDocDOM.Tables.Cell cellTitleSharedAmount = row.Cells[8];
                        cellTitleSharedAmount.AddParagraph("Shared Amount");
                        cellTitleSharedAmount.Format.Font.Bold = true;
                        cellTitleSharedAmount.Format.Font.Size = 7;
                        cellTitleSharedAmount.Format.Font.Name = "Arial";
                        cellTitleSharedAmount.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                        MigraDocDOM.Tables.Cell cellTitleReimbursement = row.Cells[9];
                        cellTitleReimbursement.AddParagraph("Reimbursement Amount");
                        cellTitleReimbursement.Format.Font.Bold = true;
                        cellTitleReimbursement.Format.Font.Size = 7;
                        cellTitleReimbursement.Format.Font.Name = "Arial";
                        cellTitleReimbursement.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                    }



                    MigraDocDOM.Tables.Cell cellTitleBalance = row.Cells[10];
                    cellTitleBalance.AddParagraph("Balance");
                    cellTitleBalance.Format.Font.Bold = true;
                    cellTitleBalance.Format.Font.Size = 7;
                    cellTitleBalance.Format.Font.Name = "Arial";
                    cellTitleBalance.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);


                    for (int i = 0; i < lstPaidMedicalExpenseTableRowBlueSheet.Count; i++)
                    {
                        if (nRowHeight > 645) nRowHeight = 0;
                        nRowHeight += 18;
                        MigraDocDOM.Tables.Row rowData = table.AddRow();
                        rowData.VerticalAlignment = MigraDocDOM.Tables.VerticalAlignment.Center;

                        if (i < lstPaidMedicalExpenseTableRowBlueSheet.Count - 1)
                        {
                            rowData.Height = "0.18in";

                            //MigraDocDOM.Tables.Cell cell = rowData.Cells[0];
                            //if (lstPaidMedicalExpenseTableRow[i].PatientName.Length > 9)
                            //{
                            //    cell.AddParagraph(lstPaidMedicalExpenseTableRow[i].PatientName.Substring(0, 9) + " ...");
                            //}
                            //else
                            //{
                            //    cell.AddParagraph(lstPaidMedicalExpenseTableRow[i].PatientName);
                            //}
                            //cell.Format.Font.Bold = false;
                            //cell.Format.Font.Name = "Arial";
                            //cell.Format.Font.Size = 7;
                            //cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            //cell.Format.Alignment = ParagraphAlignment.Left;

                            MigraDocDOM.Tables.Cell cell = rowData.Cells[0];
                            cell.AddParagraph(lstPaidMedicalExpenseTableRowBlueSheet[i].MED_BILL);
                            cell.Format.Font.Bold = false;
                            cell.Format.Font.Name = "Arial";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                            cell = rowData.Cells[1];
                            cell.AddParagraph(lstPaidMedicalExpenseTableRowBlueSheet[i].Bill_Date.Value.ToString("MM/dd/yy"));
                            cell.Format.Font.Bold = false;
                            cell.Format.Font.Name = "Arial";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                            cell = rowData.Cells[2];
                            if (lstPaidMedicalExpenseTableRowBlueSheet[i].Medical_Provider.Length > 14)
                            {
                                cell.AddParagraph(lstPaidMedicalExpenseTableRowBlueSheet[i].Medical_Provider.Substring(0, 14) + " ...");
                            }
                            else
                            {
                                cell.AddParagraph(lstPaidMedicalExpenseTableRowBlueSheet[i].Medical_Provider);
                            }
                            cell.Format.Font.Bold = false;
                            cell.Format.Font.Name = "Arial";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Left;


                            cell = rowData.Cells[3];
                            cell.AddParagraph(lstPaidMedicalExpenseTableRowBlueSheet[i].Bill_Amount);
                            cell.Format.Font.Bold = false;
                            cell.Format.Font.Name = "Arial";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Right;

                            cell = rowData.Cells[4];
                            cell.AddParagraph(lstPaidMedicalExpenseTableRowBlueSheet[i].Personal_Responsibility);
                            cell.Format.Font.Bold = false;
                            cell.Format.Font.Name = "Arial";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDoc.DocumentObjectModel.Color.FromCmyk(100, 100, 100, 100);
                            cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Right;

                            cell = rowData.Cells[5];
                            cell.AddParagraph(lstPaidMedicalExpenseTableRowBlueSheet[i].Member_Discount);
                            cell.Format.Font.Bold = false;
                            cell.Format.Font.Name = "Arial";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Right;

                            cell = rowData.Cells[6];
                            cell.AddParagraph(lstPaidMedicalExpenseTableRowBlueSheet[i].CMM_Discount);
                            cell.Format.Font.Bold = false;
                            cell.Format.Font.Name = "Arial";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Right;

                            cell = rowData.Cells[7];
                            cell.AddParagraph(lstPaidMedicalExpenseTableRowBlueSheet[i].CMM_Provider_Payment);
                            cell.Format.Font.Bold = false;
                            cell.Format.Font.Name = "Arial";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDoc.DocumentObjectModel.Color.FromCmyk(0, 100, 100, 0);
                            cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Right;

                            cell = rowData.Cells[8];
                            cell.AddParagraph(lstPaidMedicalExpenseTableRowBlueSheet[i].PastReimbursement);
                            cell.Format.Font.Bold = false;
                            cell.Format.Font.Name = "Arial";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDoc.DocumentObjectModel.Color.FromCmyk(100, 100, 100, 100);
                            cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Right;

                            cell = rowData.Cells[9];
                            cell.AddParagraph(lstPaidMedicalExpenseTableRowBlueSheet[i].Reimbursement);
                            cell.Format.Font.Bold = false;
                            cell.Format.Font.Name = "Arial";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDoc.DocumentObjectModel.Color.FromCmyk(0, 100, 100, 0);
                            cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Right;

                            cell = rowData.Cells[10];
                            cell.AddParagraph(lstPaidMedicalExpenseTableRowBlueSheet[i].Balance);
                            cell.Format.Font.Bold = false;
                            cell.Format.Font.Name = "Arial";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDoc.DocumentObjectModel.Color.FromCmyk(100, 100, 100, 100);
                            cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Right;

                        }
                        if (i == lstPaidMedicalExpenseTableRowBlueSheet.Count - 1)
                        {
                            rowData.Height = "0.2in";

                            //MigraDocDOM.Tables.Cell cell = rowData.Cells[0];
                            //if (lstPaidMedicalExpenseTableRow[i].PatientName.Length > 11)
                            //{
                            //    cell.AddParagraph(lstPaidMedicalExpenseTableRow[i].PatientName.Substring(0, 11) + " ...");
                            //}
                            //else
                            //{
                            //    cell.AddParagraph(lstPaidMedicalExpenseTableRow[i].PatientName);
                            //}
                            //cell.Format.Font.Bold = true;
                            //cell.Format.Font.Name = "Arial";
                            //cell.Format.Font.Size = 7;
                            //cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                            MigraDocDOM.Tables.Cell cell = rowData.Cells[0];
                            cell.AddParagraph(lstPaidMedicalExpenseTableRowBlueSheet[i].MED_BILL);
                            cell.Format.Font.Bold = true;
                            cell.Format.Font.Name = "Arial";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                            cell = rowData.Cells[1];
                            if (lstPaidMedicalExpenseTableRowBlueSheet[i].Bill_Date != null) cell.AddParagraph(lstPaidMedicalExpenseTableRowBlueSheet[i].Bill_Date.Value.ToString("MM/dd/yy"));
                            cell.Format.Font.Bold = true;
                            cell.Format.Font.Name = "Arial";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                            cell = rowData.Cells[2];
                            //if (lstPaidMedicalExpenseTableRow[i].Medical_Provider.Length > 25)
                            //{
                            //    cell.AddParagraph(lstPaidMedicalExpenseTableRow[i].Medical_Provider.Substring(0, 25) + " ...");
                            //}
                            //else
                            //{
                            //    cell.AddParagraph(lstPaidMedicalExpenseTableRow[i].Medical_Provider);
                            //}
                            cell.AddParagraph("Total");

                            cell.Format.Font.Bold = true;
                            cell.Format.Font.Name = "Arial";
                            cell.Format.Font.Size = 7;
                            cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                            cell = rowData.Cells[3];
                            cell.AddParagraph(lstPaidMedicalExpenseTableRowBlueSheet[i].Bill_Amount);
                            cell.Format.Font.Bold = true;
                            cell.Format.Font.Name = "Arial";
                            cell.Format.Font.Size = 7;
                            cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Right;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                            cell = rowData.Cells[4];
                            cell.AddParagraph(lstPaidMedicalExpenseTableRowBlueSheet[i].Personal_Responsibility);
                            cell.Format.Font.Bold = false;
                            cell.Format.Font.Name = "Arial";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Right;

                            cell = rowData.Cells[5];
                            cell.AddParagraph(lstPaidMedicalExpenseTableRowBlueSheet[i].Member_Discount);
                            cell.Format.Font.Bold = true;
                            cell.Format.Font.Name = "Arial";
                            cell.Format.Font.Size = 7;
                            cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Right;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                            cell = rowData.Cells[6];
                            cell.AddParagraph(lstPaidMedicalExpenseTableRowBlueSheet[i].CMM_Discount);
                            cell.Format.Font.Bold = true;
                            cell.Format.Font.Name = "Arial";
                            cell.Format.Font.Size = 7;
                            cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Right;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                            cell = rowData.Cells[7];
                            cell.AddParagraph(lstPaidMedicalExpenseTableRowBlueSheet[i].CMM_Provider_Payment);
                            cell.Format.Font.Bold = true;
                            cell.Format.Font.Name = "Arial";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDoc.DocumentObjectModel.Color.FromCmyk(0, 100, 100, 0);
                            cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Right;

                            cell = rowData.Cells[8];
                            cell.AddParagraph(lstPaidMedicalExpenseTableRowBlueSheet[i].PastReimbursement);
                            cell.Format.Font.Bold = false;
                            cell.Format.Font.Name = "Arial";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDoc.DocumentObjectModel.Color.FromCmyk(100, 100, 100, 100);
                            cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Right;

                            cell = rowData.Cells[9];
                            cell.AddParagraph(lstPaidMedicalExpenseTableRowBlueSheet[i].Reimbursement);
                            cell.Format.Font.Bold = true;
                            cell.Format.Font.Name = "Arial";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDoc.DocumentObjectModel.Color.FromCmyk(0, 100, 100, 0);
                            cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Right;

                            cell = rowData.Cells[10];
                            cell.AddParagraph(lstPaidMedicalExpenseTableRowBlueSheet[i].Balance);
                            cell.Format.Font.Bold = true;
                            cell.Format.Font.Name = "Arial";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDoc.DocumentObjectModel.Color.FromCmyk(100, 100, 100, 100);
                            cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Right;
                        }
                    }

                    pdfDoc.LastSection.Add(table);
                }

                int nHeightAfterCMMPendingPayment = 0;

                if (gvCMMPendingPaymentBlueSheet.RowCount > 0)
                {
                    nHeightAfterCMMPendingPayment += 22;
                    for (int nRow = 0; nRow < gvCMMPendingPaymentBlueSheet.RowCount; nRow++)
                    {
                        nHeightAfterCMMPendingPayment += 15;
                    }

                    if ((nRowHeight > 645) ||
                        (nRowHeight + nHeightAfterCMMPendingPayment) > 645)
                    {
                        nRowHeight = 0;
                        section.AddPageBreak();
                    }
                }



                //////////////////////////////////////////////////////////////////////////////////////////////////

                // The beginning of CMM Pending Payment table


                if (gvCMMPendingPaymentBlueSheet.RowCount > 0)
                {
                    lstCMMPendingPaymentTableRowBlueSheet.Clear();
                    nRowHeight += 30;

                    MigraDocDOM.Paragraph paraSpaceBefore = section.AddParagraph();
                    paraSpaceBefore.Format.SpaceBefore = "0.18in";
                    paraSpaceBefore.Format.SpaceAfter = "0.05in";
                    paraSpaceBefore.Format.Font.Color = MigraDoc.DocumentObjectModel.Color.FromCmyk(100, 100, 0, 0);
                    paraSpaceBefore.Format.Font.Name = "Arial";
                    paraSpaceBefore.Format.Font.Size = 7;
                    paraSpaceBefore.AddFormattedText("Pending Payment(s)", MigraDocDOM.TextFormat.Bold);

                    for (int nRow = 0; nRow < gvCMMPendingPaymentBlueSheet.RowCount; nRow++)
                    {
                        CMMPendingPaymentTableRowBlueSheet cmmPendingRow = new CMMPendingPaymentTableRowBlueSheet();

                        cmmPendingRow.PatientName = gvCMMPendingPaymentBlueSheet[1, nRow].Value.ToString();
                        cmmPendingRow.MED_BILL = gvCMMPendingPaymentBlueSheet[2, nRow].Value.ToString();
                        cmmPendingRow.Bill_Date = gvCMMPendingPaymentBlueSheet[3, nRow].Value.ToString();
                        //cmmPendingRow.Due_Date = gvCMMPendingPayment[4, nRow].Value.ToString();
                        cmmPendingRow.Medical_Provider = gvCMMPendingPaymentBlueSheet[4, nRow].Value.ToString();
                        cmmPendingRow.Bill_Amount = gvCMMPendingPaymentBlueSheet[5, nRow].Value.ToString();
                        cmmPendingRow.Member_Discount = gvCMMPendingPaymentBlueSheet[6, nRow].Value.ToString();
                        cmmPendingRow.CMM_Discount = gvCMMPendingPaymentBlueSheet[7, nRow].Value.ToString();
                        cmmPendingRow.PersonalResponsibility = gvCMMPendingPaymentBlueSheet[8, nRow].Value.ToString();
                        cmmPendingRow.Shared_Amount = gvCMMPendingPaymentBlueSheet[9, nRow].Value.ToString();
                        cmmPendingRow.Balance = gvCMMPendingPaymentBlueSheet[10, nRow].Value.ToString();

                        lstCMMPendingPaymentTableRowBlueSheet.Add(cmmPendingRow);
                    }

                    MigraDocDOM.Tables.Table tableCMMPendingPayment = new MigraDocDOM.Tables.Table();

                    tableCMMPendingPayment.Borders.Width = 0.1;
                    tableCMMPendingPayment.Borders.Color = MigraDoc.DocumentObjectModel.Color.FromCmyk(100, 100, 100, 100);

                    //MigraDocDOM.Tables.Column colCMMPendingPayment = tableCMMPendingPayment.AddColumn(MigraDocDOM.Unit.FromInch(0.8));
                    //colCMMPendingPayment.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                    MigraDocDOM.Tables.Column colCMMPendingPayment = tableCMMPendingPayment.AddColumn(MigraDocDOM.Unit.FromInch(0.6));
                    colCMMPendingPayment.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                    colCMMPendingPayment = tableCMMPendingPayment.AddColumn(MigraDocDOM.Unit.FromInch(0.7));
                    colCMMPendingPayment.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                    //colCMMPendingPayment = tableCMMPendingPayment.AddColumn(MigraDocDOM.Unit.FromInch(0.7));
                    //colCMMPendingPayment.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                    colCMMPendingPayment = tableCMMPendingPayment.AddColumn(MigraDocDOM.Unit.FromInch(1.4));
                    colCMMPendingPayment.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                    colCMMPendingPayment = tableCMMPendingPayment.AddColumn(MigraDocDOM.Unit.FromInch(0.8));
                    colCMMPendingPayment.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                    colCMMPendingPayment = tableCMMPendingPayment.AddColumn(MigraDocDOM.Unit.FromInch(0.6));
                    colCMMPendingPayment.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                    colCMMPendingPayment = tableCMMPendingPayment.AddColumn(MigraDocDOM.Unit.FromInch(0.6));
                    colCMMPendingPayment.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                    colCMMPendingPayment = tableCMMPendingPayment.AddColumn(MigraDocDOM.Unit.FromInch(0.8));
                    colCMMPendingPayment.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                    colCMMPendingPayment = tableCMMPendingPayment.AddColumn(MigraDocDOM.Unit.FromInch(0.8));
                    colCMMPendingPayment.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                    colCMMPendingPayment = tableCMMPendingPayment.AddColumn(MigraDocDOM.Unit.FromInch(0.7));
                    colCMMPendingPayment.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                    MigraDocDOM.Tables.Row cmm_pending_row = tableCMMPendingPayment.AddRow();

                    cmm_pending_row.Height = "0.3in";
                    cmm_pending_row.VerticalAlignment = MigraDocDOM.Tables.VerticalAlignment.Center;

                    nRowHeight += 22;

                    //MigraDocDOM.Tables.Cell cellCMMPendingTitlePatientName = cmm_pending_row.Cells[0];
                    //cellCMMPendingTitlePatientName.AddParagraph("Member Name");
                    //cellCMMPendingTitlePatientName.Format.Font.Bold = true;
                    //cellCMMPendingTitlePatientName.Format.Font.Size = 7;
                    //cellCMMPendingTitlePatientName.Format.Font.Name = "Arial";
                    //cellCMMPendingTitlePatientName.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                    MigraDocDOM.Tables.Cell cellCMMPendingTitleMedBill = cmm_pending_row.Cells[0];
                    cellCMMPendingTitleMedBill.AddParagraph("MEDBILL");
                    cellCMMPendingTitleMedBill.Format.Font.Bold = true;
                    cellCMMPendingTitleMedBill.Format.Font.Size = 7;
                    cellCMMPendingTitleMedBill.Format.Font.Name = "Arial";
                    cellCMMPendingTitleMedBill.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                    MigraDocDOM.Tables.Cell cellCMMPendingTitleBillDate = cmm_pending_row.Cells[1];
                    cellCMMPendingTitleBillDate.AddParagraph("Date of Service");
                    cellCMMPendingTitleBillDate.Format.Font.Bold = true;
                    cellCMMPendingTitleBillDate.Format.Font.Size = 7;
                    cellCMMPendingTitleBillDate.Format.Font.Name = "Arial";
                    cellCMMPendingTitleBillDate.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                    //MigraDocDOM.Tables.Cell cellCMMPendingTitleDueDate = cmm_pending_row.Cells[3];
                    //cellCMMPendingTitleDueDate.AddParagraph("Received Date");
                    //cellCMMPendingTitleDueDate.Format.Font.Bold = true;
                    //cellCMMPendingTitleDueDate.Format.Font.Size = 7;
                    //cellCMMPendingTitleDueDate.Format.Font.Name = "Arial";
                    //cellCMMPendingTitleDueDate.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                    MigraDocDOM.Tables.Cell cellCMMPendingTitleMedicalProvider = cmm_pending_row.Cells[2];
                    cellCMMPendingTitleMedicalProvider.AddParagraph("Medical Provider");
                    cellCMMPendingTitleMedicalProvider.Format.Font.Bold = true;
                    cellCMMPendingTitleMedicalProvider.Format.Font.Size = 7;
                    cellCMMPendingTitleMedicalProvider.Format.Font.Name = "Arial";
                    cellCMMPendingTitleMedicalProvider.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                    MigraDocDOM.Tables.Cell cellCMMPendingTitleBillAmount = cmm_pending_row.Cells[3];
                    cellCMMPendingTitleBillAmount.AddParagraph("Original Amount");
                    cellCMMPendingTitleBillAmount.Format.Font.Bold = true;
                    cellCMMPendingTitleBillAmount.Format.Font.Size = 7;
                    cellCMMPendingTitleBillAmount.Format.Font.Name = "Arial";
                    cellCMMPendingTitleBillAmount.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                    MigraDocDOM.Tables.Cell cellCMMPendingTitleMemberDiscount = cmm_pending_row.Cells[4];
                    cellCMMPendingTitleMemberDiscount.AddParagraph("Member Discount");
                    cellCMMPendingTitleMemberDiscount.Format.Font.Bold = true;
                    cellCMMPendingTitleMemberDiscount.Format.Font.Size = 7;
                    cellCMMPendingTitleMemberDiscount.Format.Font.Name = "Arial";
                    cellCMMPendingTitleMemberDiscount.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                    MigraDocDOM.Tables.Cell cellCMMPendingTitleCMMDiscount = cmm_pending_row.Cells[5];
                    cellCMMPendingTitleCMMDiscount.AddParagraph("CMM Discount");
                    cellCMMPendingTitleCMMDiscount.Format.Font.Bold = true;
                    cellCMMPendingTitleCMMDiscount.Format.Font.Size = 7;
                    cellCMMPendingTitleCMMDiscount.Format.Font.Name = "Arial";
                    cellCMMPendingTitleCMMDiscount.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                    MigraDocDOM.Tables.Cell cellCMMPendingTitlePersonalResponsibility = cmm_pending_row.Cells[6];
                    cellCMMPendingTitlePersonalResponsibility.AddParagraph("Personal Responsibility");
                    cellCMMPendingTitlePersonalResponsibility.Format.Font.Bold = true;
                    cellCMMPendingTitlePersonalResponsibility.Format.Font.Size = 7;
                    cellCMMPendingTitlePersonalResponsibility.Format.Font.Name = "Arial";
                    cellCMMPendingTitlePersonalResponsibility.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                    MigraDocDOM.Tables.Cell cellCMMPendingTitleSharedAmount = cmm_pending_row.Cells[7];
                    cellCMMPendingTitleSharedAmount.AddParagraph("Total Shared Amount");
                    cellCMMPendingTitleSharedAmount.Format.Font.Bold = true;
                    cellCMMPendingTitleSharedAmount.Format.Font.Size = 7;
                    cellCMMPendingTitleSharedAmount.Format.Font.Name = "Arial";
                    cellCMMPendingTitleSharedAmount.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                    MigraDocDOM.Tables.Cell cellCMMPendingTitleBalance = cmm_pending_row.Cells[8];
                    cellCMMPendingTitleBalance.AddParagraph("Balance");
                    cellCMMPendingTitleBalance.Format.Font.Bold = true;
                    cellCMMPendingTitleBalance.Format.Font.Size = 7;
                    cellCMMPendingTitleBalance.Format.Font.Name = "Arial";
                    cellCMMPendingTitleBalance.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                    for (int i = 0; i < lstCMMPendingPaymentTableRowBlueSheet.Count; i++)
                    {
                        nRowHeight += 18;
                        MigraDocDOM.Tables.Row rowData = tableCMMPendingPayment.AddRow();
                        rowData.VerticalAlignment = MigraDocDOM.Tables.VerticalAlignment.Center;

                        if (i < lstCMMPendingPaymentTableRowBlueSheet.Count - 1)
                        {
                            rowData.Height = "0.18in";

                            //MigraDocDOM.Tables.Cell cell = rowData.Cells[0];
                            //if (lstCMMPendingPaymentTableRow[i].PatientName.Length > 11)
                            //{
                            //    cell.AddParagraph(lstCMMPendingPaymentTableRow[i].PatientName.Substring(0, 11) + " ...");
                            //}
                            //else
                            //{
                            //    cell.AddParagraph(lstCMMPendingPaymentTableRow[i].PatientName);
                            //}
                            //cell.Format.Font.Bold = false;
                            //cell.Format.Font.Name = "Arial";
                            //cell.Format.Font.Size = 7;
                            //cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            //cell.Format.Alignment = ParagraphAlignment.Left;

                            MigraDocDOM.Tables.Cell cell = rowData.Cells[0];
                            cell.AddParagraph(lstCMMPendingPaymentTableRowBlueSheet[i].MED_BILL);
                            cell.Format.Font.Bold = false;
                            cell.Format.Font.Name = "Arial";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                            cell = rowData.Cells[1];
                            cell.AddParagraph(lstCMMPendingPaymentTableRowBlueSheet[i].Bill_Date);
                            cell.Format.Font.Bold = false;
                            cell.Format.Font.Name = "Arial";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                            //cell = rowData.Cells[3];
                            //cell.AddParagraph(lstCMMPendingPaymentTableRow[i].Due_Date);
                            //cell.Format.Font.Bold = false;
                            //cell.Format.Font.Name = "Arial";
                            //cell.Format.Font.Size = 7;
                            //cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                            cell = rowData.Cells[2];
                            if (lstCMMPendingPaymentTableRowBlueSheet[i].Medical_Provider.Length > 25)
                            {
                                cell.AddParagraph(lstCMMPendingPaymentTableRowBlueSheet[i].Medical_Provider.Substring(0, 25) + " ...");
                            }
                            else
                            {
                                cell.AddParagraph(lstCMMPendingPaymentTableRowBlueSheet[i].Medical_Provider);
                            }
                            cell.Format.Font.Bold = false;
                            cell.Format.Font.Name = "Arial";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Left;

                            cell = rowData.Cells[3];
                            cell.AddParagraph(lstCMMPendingPaymentTableRowBlueSheet[i].Bill_Amount);
                            cell.Format.Font.Bold = false;
                            cell.Format.Font.Name = "Arial";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Right;

                            cell = rowData.Cells[4];
                            cell.AddParagraph(lstCMMPendingPaymentTableRowBlueSheet[i].Member_Discount);
                            cell.Format.Font.Bold = false;
                            cell.Format.Font.Name = "Arial";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Right;

                            cell = rowData.Cells[5];
                            cell.AddParagraph(lstCMMPendingPaymentTableRowBlueSheet[i].CMM_Discount);
                            cell.Format.Font.Bold = false;
                            cell.Format.Font.Name = "Arial";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Right;

                            cell = rowData.Cells[6];
                            cell.AddParagraph(lstCMMPendingPaymentTableRowBlueSheet[i].PersonalResponsibility);
                            cell.Format.Font.Bold = false;
                            cell.Format.Font.Name = "Arial";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Right;

                            cell = rowData.Cells[7];
                            cell.AddParagraph(lstCMMPendingPaymentTableRowBlueSheet[i].Shared_Amount);
                            cell.Format.Font.Bold = false;
                            cell.Format.Font.Name = "Arial";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Right;

                            cell = rowData.Cells[8];
                            cell.AddParagraph(lstCMMPendingPaymentTableRowBlueSheet[i].Balance);
                            cell.Format.Font.Bold = false;
                            cell.Format.Font.Name = "Arial";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(0, 100, 100, 0);
                            cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Right;
                        }
                        if (i == lstCMMPendingPaymentTableRowBlueSheet.Count - 1)
                        {
                            rowData.Height = "0.2in";

                            //MigraDocDOM.Tables.Cell cell = rowData.Cells[0];
                            //if (lstCMMPendingPaymentTableRow[i].PatientName.Length > 11)
                            //{
                            //    cell.AddParagraph(lstCMMPendingPaymentTableRow[i].PatientName.Substring(0, 11) + " ...");
                            //}
                            //else
                            //{
                            //    cell.AddParagraph(lstCMMPendingPaymentTableRow[i].PatientName);
                            //}
                            //cell.Format.Font.Bold = true;
                            //cell.Format.Font.Name = "Arial";
                            //cell.Format.Font.Size = 7;
                            //cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            //cell.Format.Alignment = ParagraphAlignment.Left;

                            MigraDocDOM.Tables.Cell cell = rowData.Cells[0];
                            cell.AddParagraph(lstCMMPendingPaymentTableRowBlueSheet[i].MED_BILL);
                            cell.Format.Font.Bold = true;
                            cell.Format.Font.Name = "Arial";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                            cell = rowData.Cells[1];
                            cell.AddParagraph(lstCMMPendingPaymentTableRowBlueSheet[i].Bill_Date);
                            cell.Format.Font.Bold = true;
                            cell.Format.Font.Name = "Arial";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                            //cell = rowData.Cells[3];
                            //cell.AddParagraph(lstCMMPendingPaymentTableRow[i].Due_Date);
                            //cell.Format.Font.Bold = true;
                            //cell.Format.Font.Name = "Arial";
                            //cell.Format.Font.Size = 7;
                            //cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                            cell = rowData.Cells[2];
                            //if (lstCMMPendingPaymentTableRow[i].Medical_Provider.Length > 25)
                            //{
                            //    cell.AddParagraph(lstCMMPendingPaymentTableRow[i].Medical_Provider.Substring(0, 25) + " ...");
                            //}
                            //else
                            //{
                            //    cell.AddParagraph(lstCMMPendingPaymentTableRow[i].Medical_Provider);
                            //}
                            cell.AddParagraph("Total");
                            cell.Format.Font.Bold = true;
                            cell.Format.Font.Name = "Arial";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                            cell = rowData.Cells[3];
                            cell.AddParagraph(lstCMMPendingPaymentTableRowBlueSheet[i].Bill_Amount);
                            cell.Format.Font.Bold = true;
                            cell.Format.Font.Name = "Arial";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Right;

                            cell = rowData.Cells[4];
                            cell.AddParagraph(lstCMMPendingPaymentTableRowBlueSheet[i].Member_Discount);
                            cell.Format.Font.Bold = true;
                            cell.Format.Font.Name = "Arial";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Right;

                            cell = rowData.Cells[5];
                            cell.AddParagraph(lstCMMPendingPaymentTableRowBlueSheet[i].CMM_Discount);
                            cell.Format.Font.Bold = true;
                            cell.Format.Font.Name = "Arial";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Right;

                            cell = rowData.Cells[6];
                            cell.AddParagraph(lstCMMPendingPaymentTableRowBlueSheet[i].PersonalResponsibility);
                            cell.Format.Font.Bold = true;
                            cell.Format.Font.Name = "Arial";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Right;

                            cell = rowData.Cells[7];
                            cell.AddParagraph(lstCMMPendingPaymentTableRowBlueSheet[i].Shared_Amount);
                            cell.Format.Font.Bold = true;
                            cell.Format.Font.Name = "Arial";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Right;

                            cell = rowData.Cells[8];
                            cell.AddParagraph(lstCMMPendingPaymentTableRowBlueSheet[i].Balance);
                            cell.Format.Font.Bold = true;
                            cell.Format.Font.Name = "Arial";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(0, 100, 100, 0);
                            cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Right;
                        }
                    }

                    pdfDoc.LastSection.Add(tableCMMPendingPayment);
                }

                int nHeightAfterPending = 0;

                if (gvPendingBlueSheet.RowCount > 0)
                {
                    nHeightAfterPending += 22;
                    for (int nRow = 0; nRow < gvPendingBlueSheet.RowCount; nRow++)
                    {
                        nHeightAfterPending += 15;
                    }

                    if ((nRowHeight > 645) || ((nRowHeight + nHeightAfterPending) > 645))
                    {
                        nRowHeight = 0;
                        section.AddPageBreak();
                    }
                }





                // Pending table

                if (gvPendingBlueSheet.RowCount > 0)
                {
                    lstPendingTableRowBlueSheet.Clear();

                    nRowHeight += 30;

                    MigraDocDOM.Paragraph paraSpaceBefore = section.AddParagraph();
                    paraSpaceBefore.Format.SpaceBefore = "0.18in";
                    paraSpaceBefore.Format.SpaceAfter = "0.05in";
                    paraSpaceBefore.Format.Font.Color = MigraDoc.DocumentObjectModel.Color.FromCmyk(0, 100, 100, 0);
                    paraSpaceBefore.Format.Font.Name = "Arial";
                    paraSpaceBefore.Format.Font.Size = 7;
                    paraSpaceBefore.AddFormattedText("Pending Medical Bill(s)", MigraDocDOM.TextFormat.Bold);

                    for (int nRow = 0; nRow < gvPendingBlueSheet.RowCount; nRow++)
                    {
                        //nRowHeight += 15;

                        PendingTableRowBlueSheet pendingRow = new PendingTableRowBlueSheet();
                        pendingRow.PatientName = gvPendingBlueSheet[1, nRow].Value.ToString();
                        pendingRow.MED_BILL = gvPendingBlueSheet[2, nRow].Value.ToString();
                        pendingRow.Bill_Date = gvPendingBlueSheet[3, nRow].Value.ToString();
                        pendingRow.Due_Date = gvPendingBlueSheet[4, nRow].Value.ToString();
                        pendingRow.Medical_Provider = gvPendingBlueSheet[5, nRow].Value.ToString();
                        pendingRow.Bill_Amount = gvPendingBlueSheet[6, nRow].Value.ToString();
                        pendingRow.Balance = gvPendingBlueSheet[7, nRow].Value.ToString();
                        //pendingRow.Member_Discount = gvPending[7, nRow].Value.ToString();
                        //pendingRow.CMM_Discount = gvPending[8, nRow].Value.ToString();
                        //pendingRow.Shared_Amount = gvPending[9, nRow].Value.ToString();
                        //pendingRow.Balance = gvPending[10, nRow].Value.ToString();
                        pendingRow.Pending_Reason = gvPendingBlueSheet[8, nRow].Value.ToString();

                        lstPendingTableRowBlueSheet.Add(pendingRow);
                    }

                    MigraDocDOM.Tables.Table tablePending = new MigraDocDOM.Tables.Table();
                    tablePending.Borders.Width = 0.1;
                    tablePending.Borders.Color = MigraDoc.DocumentObjectModel.Color.FromCmyk(100, 100, 100, 100);

                    //MigraDocDOM.Tables.Column colPending = tablePending.AddColumn(MigraDocDOM.Unit.FromInch(0.8));
                    //colPending.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                    MigraDocDOM.Tables.Column colPending = tablePending.AddColumn(MigraDocDOM.Unit.FromInch(0.6));
                    colPending.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                    colPending = tablePending.AddColumn(MigraDocDOM.Unit.FromInch(0.6));
                    colPending.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                    colPending = tablePending.AddColumn(MigraDocDOM.Unit.FromInch(0.6));
                    colPending.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                    colPending = tablePending.AddColumn(MigraDocDOM.Unit.FromInch(1.2));
                    colPending.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                    colPending = tablePending.AddColumn(MigraDocDOM.Unit.FromInch(0.6));
                    colPending.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                    colPending = tablePending.AddColumn(MigraDocDOM.Unit.FromInch(0.6));
                    colPending.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                    //colPending = tablePending.AddColumn(MigraDocDOM.Unit.FromInch(0.6));
                    //colPending.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                    //colPending = tablePending.AddColumn(MigraDocDOM.Unit.FromInch(0.5));
                    //colPending.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                    //colPending = tablePending.AddColumn(MigraDocDOM.Unit.FromInch(0.6));
                    //colPending.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                    //colPending = tablePending.AddColumn(MigraDocDOM.Unit.FromInch(0.6));
                    //colPending.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                    colPending = tablePending.AddColumn(MigraDocDOM.Unit.FromInch(2.8));
                    colPending.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                    MigraDocDOM.Tables.Row pending_Row = tablePending.AddRow();

                    nRowHeight += 22;

                    pending_Row.Height = "0.3in";
                    pending_Row.VerticalAlignment = MigraDocDOM.Tables.VerticalAlignment.Center;

                    //MigraDocDOM.Tables.Cell cellPendingTitleINCD = pending_Row.Cells[0];
                    //cellPendingTitleINCD.AddParagraph("Member Name");
                    //cellPendingTitleINCD.Format.Font.Bold = true;
                    //cellPendingTitleINCD.Format.Font.Size = 7;
                    //cellPendingTitleINCD.Format.Font.Name = "Arial";
                    //cellPendingTitleINCD.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                    MigraDocDOM.Tables.Cell cellPendingTitleMED_BILL = pending_Row.Cells[0];
                    cellPendingTitleMED_BILL.AddParagraph("MEDBILL");
                    cellPendingTitleMED_BILL.Format.Font.Bold = true;
                    cellPendingTitleMED_BILL.Format.Font.Size = 7;
                    cellPendingTitleMED_BILL.Format.Font.Name = "Arial";
                    cellPendingTitleMED_BILL.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                    MigraDocDOM.Tables.Cell cellPendingTitleBill_Date = pending_Row.Cells[1];
                    cellPendingTitleBill_Date.AddParagraph("Date of Service");
                    cellPendingTitleBill_Date.Format.Font.Bold = true;
                    cellPendingTitleBill_Date.Format.Font.Size = 7;
                    cellPendingTitleBill_Date.Format.Font.Name = "Arial";
                    cellPendingTitleBill_Date.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                    MigraDocDOM.Tables.Cell cellPendingTitleDue_Date = pending_Row.Cells[2];
                    cellPendingTitleDue_Date.AddParagraph("Received Date");
                    cellPendingTitleDue_Date.Format.Font.Bold = true;
                    cellPendingTitleDue_Date.Format.Font.Size = 7;
                    cellPendingTitleDue_Date.Format.Font.Name = "Arial";
                    cellPendingTitleDue_Date.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                    MigraDocDOM.Tables.Cell cellPendingTitleMedicalProvider = pending_Row.Cells[3];
                    cellPendingTitleMedicalProvider.AddParagraph("Medical Provider");
                    cellPendingTitleMedicalProvider.Format.Font.Bold = true;
                    cellPendingTitleMedicalProvider.Format.Font.Size = 7;
                    cellPendingTitleMedicalProvider.Format.Font.Name = "Arial";
                    cellPendingTitleMedicalProvider.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                    MigraDocDOM.Tables.Cell cellPendingTitleBillAmount = pending_Row.Cells[4];
                    cellPendingTitleBillAmount.AddParagraph("Original Amount");
                    cellPendingTitleBillAmount.Format.Font.Bold = true;
                    cellPendingTitleBillAmount.Format.Font.Size = 7;
                    cellPendingTitleBillAmount.Format.Font.Name = "Arial";
                    cellPendingTitleBillAmount.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                    //MigraDocDOM.Tables.Cell cellPendingTitleMemberDiscount = pending_Row.Cells[6];
                    //cellPendingTitleMemberDiscount.AddParagraph("회원 (할인)");
                    //cellPendingTitleMemberDiscount.Format.Font.Bold = true;
                    //cellPendingTitleMemberDiscount.Format.Font.Size = 7;
                    //cellPendingTitleMemberDiscount.Format.Font.Name = "Arial";
                    //cellPendingTitleMemberDiscount.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                    //MigraDocDOM.Tables.Cell cellPendingTitleCMMDiscount = pending_Row.Cells[7];
                    //cellPendingTitleCMMDiscount.AddParagraph("CMM (할인)");
                    //cellPendingTitleCMMDiscount.Format.Font.Bold = true;
                    //cellPendingTitleCMMDiscount.Format.Font.Size = 7;
                    //cellPendingTitleCMMDiscount.Format.Font.Name = "Arial";
                    //cellPendingTitleCMMDiscount.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                    //MigraDocDOM.Tables.Cell cellPendingTitleSharedAmount = pending_Row.Cells[8];
                    //cellPendingTitleSharedAmount.AddParagraph("정산 완료");
                    //cellPendingTitleSharedAmount.Format.Font.Bold = true;
                    //cellPendingTitleSharedAmount.Format.Font.Size = 7;
                    //cellPendingTitleSharedAmount.Format.Font.Name = "Arial";
                    //cellPendingTitleSharedAmount.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                    //MigraDocDOM.Tables.Cell cellPendingTitleBalance = pending_Row.Cells[9];
                    //cellPendingTitleBalance.AddParagraph("보류");
                    //cellPendingTitleBalance.Format.Font.Bold = true;
                    //cellPendingTitleBalance.Format.Font.Size = 7;
                    //cellPendingTitleBalance.Format.Font.Name = "Arial";
                    //cellPendingTitleBalance.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                    MigraDocDOM.Tables.Cell cellPendingTitleBalance = pending_Row.Cells[5];
                    cellPendingTitleBalance.AddParagraph("Balance");
                    cellPendingTitleBalance.Format.Font.Bold = true;
                    cellPendingTitleBalance.Format.Font.Size = 7;
                    cellPendingTitleBalance.Format.Font.Name = "Arial";
                    cellPendingTitleBalance.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                    MigraDocDOM.Tables.Cell cellPendingTitlePendingReason = pending_Row.Cells[6];
                    cellPendingTitlePendingReason.AddParagraph("Pending Reason");
                    cellPendingTitlePendingReason.Format.Font.Bold = true;
                    cellPendingTitlePendingReason.Format.Font.Size = 7;
                    cellPendingTitlePendingReason.Format.Font.Name = "Arial";
                    cellPendingTitlePendingReason.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                    for (int i = 0; i < lstPendingTableRowBlueSheet.Count; i++)
                    {
                        MigraDocDOM.Tables.Row pendingRowData = tablePending.AddRow();
                        pendingRowData.VerticalAlignment = MigraDocDOM.Tables.VerticalAlignment.Center;
                        nRowHeight += 15;

                        if (i < lstPendingTableRowBlueSheet.Count - 1)
                        {
                            pendingRowData.Height = "0.18in";

                            //MigraDocDOM.Tables.Cell cell = pendingRowData.Cells[0];
                            //if (lstPendingTableRow[i].PatientName.Length > 11)
                            //{
                            //    cell.AddParagraph(lstPendingTableRow[i].PatientName.Substring(0, 11));
                            //}
                            //else
                            //{
                            //    cell.AddParagraph(lstPendingTableRow[i].PatientName);
                            //}
                            //cell.Format.Font.Bold = false;
                            //cell.Format.Font.Name = "Arial";
                            //cell.Format.Font.Size = 7;
                            //cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            //cell.Format.Alignment = ParagraphAlignment.Left;

                            MigraDocDOM.Tables.Cell cell = pendingRowData.Cells[0];
                            cell.AddParagraph(lstPendingTableRowBlueSheet[i].MED_BILL);
                            cell.Format.Font.Bold = false;
                            cell.Format.Font.Name = "Arial";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                            cell = pendingRowData.Cells[1];
                            cell.AddParagraph(lstPendingTableRowBlueSheet[i].Bill_Date);
                            cell.Format.Font.Bold = false;
                            cell.Format.Font.Name = "Arial";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                            cell = pendingRowData.Cells[2];
                            cell.AddParagraph(lstPendingTableRowBlueSheet[i].Due_Date);
                            cell.Format.Font.Bold = false;
                            cell.Format.Font.Name = "Arial";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                            cell = pendingRowData.Cells[3];

                            if (lstPendingTableRowBlueSheet[i].Medical_Provider.Length > 20)
                            {
                                cell.AddParagraph(lstPendingTableRowBlueSheet[i].Medical_Provider.Substring(0, 20) + " ...");
                            }
                            else
                            {
                                cell.AddParagraph(lstPendingTableRowBlueSheet[i].Medical_Provider);
                            }
                            cell.Format.Font.Bold = false;
                            cell.Format.Font.Name = "Arial";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Left;

                            cell = pendingRowData.Cells[4];
                            cell.AddParagraph(lstPendingTableRowBlueSheet[i].Bill_Amount);
                            cell.Format.Font.Bold = false;
                            cell.Format.Font.Name = "Arial";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Right;

                            cell = pendingRowData.Cells[5];
                            cell.AddParagraph(lstPendingTableRowBlueSheet[i].Balance);
                            cell.Format.Font.Bold = false;
                            cell.Format.Font.Name = "Arial";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Right;

                            //cell = pendingRowData.Cells[6];
                            //cell.AddParagraph(lstPendingTableRow[i].Member_Discount);
                            //cell.Format.Font.Bold = false;
                            //cell.Format.Font.Name = "Arial";
                            //cell.Format.Font.Size = 7;
                            //cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            //cell.Format.Alignment = ParagraphAlignment.Right;

                            //cell = pendingRowData.Cells[7];
                            //cell.AddParagraph(lstPendingTableRow[i].CMM_Discount);
                            //cell.Format.Font.Bold = false;
                            //cell.Format.Font.Name = "Arial";
                            //cell.Format.Font.Size = 7;
                            //cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            //cell.Format.Alignment = ParagraphAlignment.Right;

                            //cell = pendingRowData.Cells[8];
                            //cell.AddParagraph(lstPendingTableRow[i].Shared_Amount);
                            //cell.Format.Font.Bold = false;
                            //cell.Format.Font.Name = "Arial";
                            //cell.Format.Font.Size = 7;
                            //cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            //cell.Format.Alignment = ParagraphAlignment.Right;

                            //cell = pendingRowData.Cells[9];
                            //cell.AddParagraph(lstPendingTableRow[i].Balance);
                            //cell.Format.Font.Bold = false;
                            //cell.Format.Font.Name = "Arial";
                            //cell.Format.Font.Size = 7;
                            //cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            //cell.Format.Alignment = ParagraphAlignment.Right;

                            cell = pendingRowData.Cells[6];
                            if (lstPendingTableRowBlueSheet[i].Pending_Reason.Length > 40)
                            {
                                cell.AddParagraph(lstPendingTableRowBlueSheet[i].Pending_Reason.Substring(0, 40) + " ...");
                            }
                            else
                            {
                                cell.AddParagraph(lstPendingTableRowBlueSheet[i].Pending_Reason);
                            }
                            cell.Format.Font.Bold = false;
                            cell.Format.Font.Name = "Arial";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Left;

                        }
                        if (i == lstPendingTableRowBlueSheet.Count - 1)
                        {
                            pendingRowData.Height = "0.2in";

                            //MigraDocDOM.Tables.Cell cell = pendingRowData.Cells[0];
                            //if (lstPendingTableRow[i].PatientName.Length > 11)
                            //{
                            //    cell.AddParagraph(lstPendingTableRow[i].PatientName.Substring(0, 11));
                            //}
                            //else
                            //{
                            //    cell.AddParagraph(lstPendingTableRow[i].PatientName);
                            //}
                            //cell.Format.Font.Bold = true;
                            //cell.Format.Font.Name = "Arial";
                            //cell.Format.Font.Size = 7;
                            //cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            //cell.Format.Alignment = ParagraphAlignment.Left;

                            MigraDocDOM.Tables.Cell cell = pendingRowData.Cells[0];
                            cell.AddParagraph(lstPendingTableRowBlueSheet[i].MED_BILL);
                            cell.Format.Font.Bold = true;
                            cell.Format.Font.Name = "Arial";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                            cell = pendingRowData.Cells[1];
                            cell.AddParagraph(lstPendingTableRowBlueSheet[i].Bill_Date);
                            cell.Format.Font.Bold = true;
                            cell.Format.Font.Name = "Arial";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                            cell = pendingRowData.Cells[2];
                            cell.AddParagraph(lstPendingTableRowBlueSheet[i].Due_Date);
                            cell.Format.Font.Bold = true;
                            cell.Format.Font.Name = "Arial";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                            cell = pendingRowData.Cells[3];
                            //if (lstPendingTableRow[i].Medical_Provider.Length > 20)
                            //{
                            //    cell.AddParagraph(lstPendingTableRow[i].Medical_Provider.Substring(0, 20) + " ...");
                            //}
                            //else
                            //{
                            //    cell.AddParagraph(lstPendingTableRow[i].Medical_Provider);
                            //}
                            cell.AddParagraph("Total");

                            cell.Format.Font.Bold = true;
                            cell.Format.Font.Name = "Arial";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                            cell = pendingRowData.Cells[4];
                            cell.AddParagraph(lstPendingTableRowBlueSheet[i].Bill_Amount);
                            cell.Format.Font.Bold = true;
                            cell.Format.Font.Name = "Arial";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Right;

                            cell = pendingRowData.Cells[5];
                            cell.AddParagraph(lstPendingTableRowBlueSheet[i].Balance);
                            cell.Format.Font.Bold = true;
                            cell.Format.Font.Name = "Arial";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Right;

                            //cell = pendingRowData.Cells[6];
                            //cell.AddParagraph(lstPendingTableRow[i].Member_Discount);
                            //cell.Format.Font.Bold = true;
                            //cell.Format.Font.Name = "Arial";
                            //cell.Format.Font.Size = 7;
                            //cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            //cell.Format.Alignment = ParagraphAlignment.Right;

                            //cell = pendingRowData.Cells[7];
                            //cell.AddParagraph(lstPendingTableRow[i].CMM_Discount);
                            //cell.Format.Font.Bold = true;
                            //cell.Format.Font.Name = "Arial";
                            //cell.Format.Font.Size = 7;
                            //cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            //cell.Format.Alignment = ParagraphAlignment.Right;

                            //cell = pendingRowData.Cells[8];
                            //cell.AddParagraph(lstPendingTableRow[i].Shared_Amount);
                            //cell.Format.Font.Bold = true;
                            //cell.Format.Font.Name = "Arial";
                            //cell.Format.Font.Size = 7;
                            //cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            //cell.Format.Alignment = ParagraphAlignment.Right;

                            //cell = pendingRowData.Cells[9];
                            //cell.AddParagraph(lstPendingTableRow[i].Balance);
                            //cell.Format.Font.Bold = true;
                            //cell.Format.Font.Name = "Arial";
                            //cell.Format.Font.Size = 7;
                            //cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            //cell.Format.Alignment = ParagraphAlignment.Right;

                            cell = pendingRowData.Cells[6];
                            if (lstPendingTableRowBlueSheet[i].Pending_Reason.Length > 40)
                            {
                                cell.AddParagraph(lstPendingTableRowBlueSheet[i].Pending_Reason.Substring(0, 40) + " ...");
                            }
                            else
                            {
                                cell.AddParagraph(lstPendingTableRowBlueSheet[i].Pending_Reason);
                            }
                            //cell.AddParagraph(lstPendingTableRow[i].Pending_Reason);
                            cell.Format.Font.Bold = true;
                            cell.Format.Font.Name = "Arial";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Left;

                        }

                    }

                    pdfDoc.LastSection.Add(tablePending);
                }

                int nHeightAfterIneligible = 0;

                if (gvIneligibleBlueSheet.RowCount > 0)
                {
                    nHeightAfterIneligible += 22;
                    for (int nRow = 0; nRow < gvIneligibleBlueSheet.RowCount; nRow++)
                    {
                        nHeightAfterIneligible += 15;
                    }

                    if ((nRowHeight > 645) ||
                        (nRowHeight + nHeightAfterIneligible) > 645)
                    {
                        nRowHeight = 0;
                        section.AddPageBreak();
                    }
                }

                lstBillIneligibleTableRowBlueSheet.Clear();

                for (int nRow = 0; nRow < gvIneligibleBlueSheet.RowCount; nRow++)
                {
                    if (gvIneligibleBlueSheet[4, nRow].Value.ToString() != "")
                    //(DateTime.Parse(gvIneligible[4, nRow].Value.ToString()) > dtDocReceivedDate.Value))
                    {
                        BillIneligibleTableRowBlueSheet ineligibleRow = new BillIneligibleTableRowBlueSheet();
                        ineligibleRow.PatientName = gvIneligibleBlueSheet[1, nRow].Value.ToString();
                        ineligibleRow.MED_BILL = gvIneligibleBlueSheet[2, nRow].Value.ToString();
                        ineligibleRow.Bill_Date = gvIneligibleBlueSheet[3, nRow].Value.ToString();
                        ineligibleRow.Received_Date = gvIneligibleBlueSheet[4, nRow].Value.ToString();
                        ineligibleRow.Medical_Provider = gvIneligibleBlueSheet[5, nRow].Value.ToString();
                        ineligibleRow.Bill_Amount = gvIneligibleBlueSheet[6, nRow].Value.ToString();
                        ineligibleRow.Amount_Ineligible = gvIneligibleBlueSheet[7, nRow].Value.ToString();
                        ineligibleRow.Ineligible_Reason = gvIneligibleBlueSheet[8, nRow].Value.ToString();

                        lstBillIneligibleTableRowBlueSheet.Add(ineligibleRow);
                    }
                    if (gvIneligibleBlueSheet[4, nRow].Value.ToString() == "")
                    {
                        BillIneligibleTableRowBlueSheet ineligibleRow = new BillIneligibleTableRowBlueSheet();
                        ineligibleRow.PatientName = gvIneligibleBlueSheet[1, nRow].Value.ToString();
                        ineligibleRow.MED_BILL = gvIneligibleBlueSheet[2, nRow].Value.ToString();
                        ineligibleRow.Bill_Date = gvIneligibleBlueSheet[3, nRow].Value.ToString();
                        ineligibleRow.Received_Date = gvIneligibleBlueSheet[4, nRow].Value.ToString();
                        ineligibleRow.Medical_Provider = gvIneligibleBlueSheet[5, nRow].Value.ToString();
                        ineligibleRow.Bill_Amount = gvIneligibleBlueSheet[6, nRow].Value.ToString();
                        ineligibleRow.Amount_Ineligible = gvIneligibleBlueSheet[7, nRow].Value.ToString();
                        ineligibleRow.Ineligible_Reason = gvIneligibleBlueSheet[8, nRow].Value.ToString();

                        lstBillIneligibleTableRowBlueSheet.Add(ineligibleRow);
                    }
                }

                if (lstBillIneligibleTableRowBlueSheet.Count > 0)
                {

                    MigraDocDOM.Paragraph paraSpaceBefore = section.AddParagraph();
                    paraSpaceBefore.Format.SpaceBefore = "0.18in";
                    paraSpaceBefore.Format.SpaceAfter = "0.05in";
                    paraSpaceBefore.Format.Font.Color = MigraDoc.DocumentObjectModel.Color.FromCmyk(0, 100, 100, 0);
                    paraSpaceBefore.Format.Font.Name = "Arial";
                    paraSpaceBefore.Format.Font.Size = 7;
                    paraSpaceBefore.AddFormattedText("Ineligible Medical Bill(s)", MigraDocDOM.TextFormat.Bold);

                    MigraDocDOM.Tables.Table tableIneligible = new MigraDocDOM.Tables.Table();
                    tableIneligible.Borders.Width = 0.1;
                    tableIneligible.Borders.Color = MigraDoc.DocumentObjectModel.Color.FromCmyk(100, 100, 100, 100);

                    //MigraDocDOM.Tables.Column colIneligible = tableIneligible.AddColumn(MigraDocDOM.Unit.FromInch(0.8));
                    //colIneligible.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                    MigraDocDOM.Tables.Column colIneligible = tableIneligible.AddColumn(MigraDocDOM.Unit.FromInch(0.6));
                    colIneligible.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                    colIneligible = tableIneligible.AddColumn(MigraDocDOM.Unit.FromInch(0.7));
                    colIneligible.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                    colIneligible = tableIneligible.AddColumn(MigraDocDOM.Unit.FromInch(1.4));
                    colIneligible.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                    colIneligible = tableIneligible.AddColumn(MigraDocDOM.Unit.FromInch(1));
                    colIneligible.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                    colIneligible = tableIneligible.AddColumn(MigraDocDOM.Unit.FromInch(1.2));
                    colIneligible.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                    colIneligible = tableIneligible.AddColumn(MigraDocDOM.Unit.FromInch(2.1));
                    colIneligible.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                    MigraDocDOM.Tables.Row ineligible_Row = tableIneligible.AddRow();

                    nRowHeight += 22;
                    ineligible_Row.Height = "0.31in";
                    ineligible_Row.VerticalAlignment = MigraDocDOM.Tables.VerticalAlignment.Center;

                    //MigraDocDOM.Tables.Cell cellIneligibleTitleICND = ineligible_Row.Cells[0];
                    //cellIneligibleTitleICND.AddParagraph("Member Name");
                    //cellIneligibleTitleICND.Format.Font.Bold = true;
                    //cellIneligibleTitleICND.Format.Font.Size = 7;
                    //cellIneligibleTitleICND.Format.Font.Name = "Arial";
                    //cellIneligibleTitleICND.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                    MigraDocDOM.Tables.Cell cellIneligibleTitleMedBill = ineligible_Row.Cells[0];
                    cellIneligibleTitleMedBill.AddParagraph("MEDBILL");
                    cellIneligibleTitleMedBill.Format.Font.Bold = true;
                    cellIneligibleTitleMedBill.Format.Font.Size = 7;
                    cellIneligibleTitleMedBill.Format.Font.Name = "Arial";
                    cellIneligibleTitleMedBill.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                    MigraDocDOM.Tables.Cell cellIneligibleTitleBillDate = ineligible_Row.Cells[1];
                    cellIneligibleTitleBillDate.AddParagraph("Date of Service");
                    cellIneligibleTitleBillDate.Format.Font.Bold = true;
                    cellIneligibleTitleBillDate.Format.Font.Size = 7;
                    cellIneligibleTitleBillDate.Format.Font.Name = "Arial";
                    cellIneligibleTitleBillDate.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                    MigraDocDOM.Tables.Cell cellIneligibleTitleMedicalProvider = ineligible_Row.Cells[2];
                    cellIneligibleTitleMedicalProvider.AddParagraph("Medical Provider");
                    cellIneligibleTitleMedicalProvider.Format.Font.Bold = true;
                    cellIneligibleTitleMedicalProvider.Format.Font.Size = 7;
                    cellIneligibleTitleMedicalProvider.Format.Font.Name = "Arial";
                    cellIneligibleTitleMedicalProvider.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                    MigraDocDOM.Tables.Cell cellIneligibleTitleBillAmount = ineligible_Row.Cells[3];
                    cellIneligibleTitleBillAmount.AddParagraph("Original Amount");
                    cellIneligibleTitleBillAmount.Format.Font.Bold = true;
                    cellIneligibleTitleBillAmount.Format.Font.Size = 7;
                    cellIneligibleTitleBillAmount.Format.Font.Name = "Arial";
                    cellIneligibleTitleBillAmount.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                    MigraDocDOM.Tables.Cell cellIneligibleTitleAmountIneligible = ineligible_Row.Cells[4];
                    cellIneligibleTitleAmountIneligible.AddParagraph("Ineligible");
                    cellIneligibleTitleAmountIneligible.Format.Font.Bold = true;
                    cellIneligibleTitleAmountIneligible.Format.Font.Size = 7;
                    cellIneligibleTitleAmountIneligible.Format.Font.Name = "Arial";
                    cellIneligibleTitleAmountIneligible.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                    MigraDocDOM.Tables.Cell cellIneligibleTitleIneligibleReason = ineligible_Row.Cells[5];
                    cellIneligibleTitleIneligibleReason.AddParagraph("Ineligible Reason");
                    cellIneligibleTitleIneligibleReason.Format.Font.Bold = true;
                    cellIneligibleTitleIneligibleReason.Format.Font.Size = 7;
                    cellIneligibleTitleIneligibleReason.Format.Font.Name = "Arial";
                    cellIneligibleTitleIneligibleReason.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                    List<BillIneligibleRowBlueSheet> lstBillIneligible = new List<BillIneligibleRowBlueSheet>();

                    for (int i = 0; i < lstBillIneligibleTableRowBlueSheet.Count; i++)
                    {
                        if (i < lstBillIneligibleTableRowBlueSheet.Count - 1)
                        {

                            MigraDocDOM.Tables.Row rowData = tableIneligible.AddRow();
                            rowData.VerticalAlignment = MigraDocDOM.Tables.VerticalAlignment.Center;
                            rowData.Height = "0.18in";

                            BillIneligibleRowBlueSheet ineligible = new BillIneligibleRowBlueSheet();

                            //MigraDocDOM.Tables.Cell cell = rowData.Cells[0];

                            //if (lstBillIneligibleTableRow[i].PatientName.Length > 11)
                            //{
                            //    cell.AddParagraph(lstBillIneligibleTableRow[i].PatientName.Substring(0, 11) + " ...");
                            //}
                            //else
                            //{
                            //    cell.AddParagraph(lstBillIneligibleTableRow[i].PatientName);
                            //}

                            //cell.Format.Font.Bold = false;
                            //cell.Format.Font.Name = "Arial";
                            //cell.Format.Font.Size = 7;
                            //cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            //cell.Format.Alignment = ParagraphAlignment.Left;

                            MigraDocDOM.Tables.Cell cell = rowData.Cells[0];
                            cell.AddParagraph(lstBillIneligibleTableRowBlueSheet[i].MED_BILL);
                            cell.Format.Font.Bold = false;
                            cell.Format.Font.Name = "Arial";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                            cell = rowData.Cells[1];
                            cell.AddParagraph(lstBillIneligibleTableRowBlueSheet[i].Bill_Date);
                            cell.Format.Font.Bold = false;
                            cell.Format.Font.Name = "Arial";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                            cell = rowData.Cells[2];

                            if (lstBillIneligibleTableRowBlueSheet[i].Medical_Provider.Length > 24)
                            {
                                cell.AddParagraph(lstBillIneligibleTableRowBlueSheet[i].Medical_Provider.Substring(0, 24) + " ...");
                            }
                            else
                            {
                                cell.AddParagraph(lstBillIneligibleTableRowBlueSheet[i].Medical_Provider);
                            }

                            cell.Format.Font.Bold = false;
                            cell.Format.Font.Name = "Arial";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Left;

                            cell = rowData.Cells[3];
                            cell.AddParagraph(lstBillIneligibleTableRowBlueSheet[i].Bill_Amount);
                            ineligible.Bill_Amount = Double.Parse(lstBillIneligibleTableRowBlueSheet[i].Bill_Amount.Substring(1));
                            cell.Format.Font.Bold = false;
                            cell.Format.Font.Name = "Arial";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Right;

                            cell = rowData.Cells[4];
                            cell.AddParagraph(lstBillIneligibleTableRowBlueSheet[i].Amount_Ineligible);
                            ineligible.Amount_Ineligible = Double.Parse(lstBillIneligibleTableRowBlueSheet[i].Amount_Ineligible.Substring(1));
                            cell.Format.Font.Bold = false;
                            cell.Format.Font.Name = "Arial";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Right;

                            cell = rowData.Cells[5];

                            if (lstBillIneligibleTableRowBlueSheet[i].Ineligible_Reason.Length > 33)
                            {
                                cell.AddParagraph(lstBillIneligibleTableRowBlueSheet[i].Ineligible_Reason.Substring(0, 33) + " ...");
                            }
                            else
                            {
                                cell.AddParagraph(lstBillIneligibleTableRowBlueSheet[i].Ineligible_Reason);
                            }
                            cell.Format.Font.Bold = false;
                            cell.Format.Font.Name = "Arial";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Left;

                            lstBillIneligible.Add(ineligible);
                        }

                        if (i == lstBillIneligibleTableRowBlueSheet.Count - 1)
                        {
                            MigraDocDOM.Tables.Row rowData = tableIneligible.AddRow();
                            rowData.VerticalAlignment = MigraDocDOM.Tables.VerticalAlignment.Center;

                            rowData.Height = "0.2in";

                            //MigraDocDOM.Tables.Cell cell = rowData.Cells[0];
                            //if (lstBillIneligibleTableRow[i].PatientName.Length > 11)
                            //{
                            //    cell.AddParagraph(lstBillIneligibleTableRow[i].PatientName.Substring(0, 11) + " ...");
                            //}
                            //else
                            //{
                            //    cell.AddParagraph(lstBillIneligibleTableRow[i].PatientName);
                            //}
                            //cell.Format.Font.Bold = true;
                            //cell.Format.Font.Name = "Arial";
                            //cell.Format.Font.Size = 7;
                            //cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                            MigraDocDOM.Tables.Cell cell = rowData.Cells[0];
                            cell.AddParagraph(lstBillIneligibleTableRowBlueSheet[i].MED_BILL);
                            cell.Format.Font.Bold = true;
                            cell.Format.Font.Name = "Arial";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                            cell = rowData.Cells[1];
                            cell.AddParagraph(lstBillIneligibleTableRowBlueSheet[i].Bill_Date);
                            cell.Format.Font.Bold = true;
                            cell.Format.Font.Name = "Arial";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                            cell = rowData.Cells[2];
                            //if (lstBillIneligibleTableRow[i].Medical_Provider.Length > 25)
                            //{
                            //    cell.AddParagraph(lstBillIneligibleTableRow[i].Medical_Provider.Substring(0, 25) + " ...");
                            //}
                            //else
                            //{
                            //    cell.AddParagraph(lstBillIneligibleTableRow[i].Medical_Provider);
                            //}
                            cell.AddParagraph("Total");
                            cell.Format.Font.Bold = true;
                            cell.Format.Font.Name = "Arial";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                            Double? BillAmount = 0;
                            foreach (BillIneligibleRowBlueSheet row in lstBillIneligible)
                            {
                                BillAmount += row.Bill_Amount;
                            }

                            cell = rowData.Cells[3];
                            cell.AddParagraph(BillAmount.Value.ToString("C"));
                            cell.Format.Font.Bold = true;
                            cell.Format.Font.Name = "Arial";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Right;

                            Double? IneligibleAmount = 0;
                            foreach (BillIneligibleRowBlueSheet row in lstBillIneligible)
                            {
                                IneligibleAmount += row.Amount_Ineligible;
                            }

                            cell = rowData.Cells[4];
                            cell.AddParagraph(IneligibleAmount.Value.ToString("C"));
                            cell.Format.Font.Bold = true;
                            cell.Format.Font.Name = "Arial";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Right;

                            cell = rowData.Cells[5];
                            if (lstBillIneligibleTableRowBlueSheet[i].Ineligible_Reason.Length > 33)
                            {
                                cell.AddParagraph(lstBillIneligibleTableRowBlueSheet[i].Ineligible_Reason.Substring(0, 33) + " ...");
                            }
                            {
                                cell.AddParagraph(lstBillIneligibleTableRowBlueSheet[i].Ineligible_Reason);
                            }
                            cell.Format.Font.Bold = true;
                            cell.Format.Font.Name = "Arial";
                            cell.Format.Font.Size = 7;
                            cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                            cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Left;
                        }
                    }

                    pdfDoc.LastSection.Add(tableIneligible);

                }
                // The end of tables

                const bool unicode = true;
                const PdfFontEmbedding embedding = PdfFontEmbedding.Always;

                PdfDocumentRenderer pdfRenderer = new PdfDocumentRenderer(unicode, embedding);
                pdfRenderer.Document = pdfDoc;
                pdfRenderer.RenderDocument();

                if (rbCheckBlueSheet.Checked)
                {

                    SaveFileDialog savefileDlg = new SaveFileDialog();
                    savefileDlg.FileName = strIndividualIDBlueSheet + "_" + strIndividualNameBlueSheet + "_" + dtpCheckIssueDateBlueSheet.Value.ToString("MM-dd-yyyy") + "_En";
                    savefileDlg.Filter = "PDF Files | *.pdf";
                    savefileDlg.DefaultExt = "pdf";
                    
                    savefileDlg.RestoreDirectory = true;

                    if (savefileDlg.ShowDialog() == DialogResult.OK)
                    {
                        try
                        {
                            pdfRenderer.PdfDocument.Save(savefileDlg.FileName);
                            System.Diagnostics.ProcessStartInfo processInfo = new System.Diagnostics.ProcessStartInfo();
                            processInfo.FileName = savefileDlg.FileName;
                            System.Diagnostics.Process.Start(processInfo);
                        }
                        catch (IOException ex)
                        {
                            MessageBox.Show(ex.Message, "Error");
                            return;
                        }
                    }
                }

                if (rbACHBlueSheet.Checked)
                {
                    SaveFileDialog savefileDlg = new SaveFileDialog();
                    savefileDlg.FileName = strIndividualIDBlueSheet + "_" + strIndividualNameBlueSheet + "_" + dtpACHTransactionDateBlueSheet.Value.ToString("MM-dd-yyyy") + "_En";
                    savefileDlg.Filter = "PDF Files | *.pdf";
                    savefileDlg.DefaultExt = "pdf";
                    savefileDlg.RestoreDirectory = true;

                    if (savefileDlg.ShowDialog() == DialogResult.OK)
                    {
                        try
                        {
                            pdfRenderer.PdfDocument.Save(savefileDlg.FileName);
                            System.Diagnostics.ProcessStartInfo processInfo = new System.Diagnostics.ProcessStartInfo();
                            processInfo.FileName = savefileDlg.FileName;

                            System.Diagnostics.Process.Start(processInfo);
                        }
                        catch (IOException ex)
                        {
                            MessageBox.Show(ex.Message, "Error");
                            return;
                        }
                    }
                }
                if (rbCreditCardBlueSheet.Checked)
                {
                    SaveFileDialog savefileDlg = new SaveFileDialog();
                    savefileDlg.FileName = strIndividualIDBlueSheet + "_" + strIndividualNameBlueSheet + "_" + dtpCreditCardPaymentDateBlueSheet.Value.ToString("MM-dd-yyyy") + "_En";
                    savefileDlg.Filter = "PDF Files | *.pdf";
                    savefileDlg.DefaultExt = "pdf";
                    savefileDlg.RestoreDirectory = true;

                    if (savefileDlg.ShowDialog() == DialogResult.OK)
                    {
                        try
                        {
                            pdfRenderer.PdfDocument.Save(savefileDlg.FileName);
                            System.Diagnostics.ProcessStartInfo processInfo = new System.Diagnostics.ProcessStartInfo();
                            processInfo.FileName = savefileDlg.FileName;

                            System.Diagnostics.Process.Start(processInfo);
                        }
                        catch (IOException ex)
                        {
                            MessageBox.Show(ex.Message, "Error");
                            return;
                        }
                    }
                }
                //}
                //else if (dlgResultDocReceivedDate == DialogResult.Cancel)
                //{
                //    return;
                //}

            }
            else if (gvPersonalResponsibility.Rows.Count > 0)
            {

                List<PersonalResponsibilityInfoBlueSheet> lstPersonalResponsibilityInfo = new List<PersonalResponsibilityInfoBlueSheet>();

                for (int i = 0; i < gvPersonalResponsibility.Rows.Count; i++)
                {
                    PersonalResponsibilityInfoBlueSheet prInfo = new PersonalResponsibilityInfoBlueSheet();

                    prInfo.MedBillName = gvPersonalResponsibility[0, i]?.Value.ToString();
                    String BillDate = gvPersonalResponsibility[1, i]?.Value.ToString();
                    if (BillDate != String.Empty) prInfo.BillDate = DateTime.Parse(BillDate);
                    prInfo.MedicalProvider = gvPersonalResponsibility[2, i]?.Value.ToString();
                    if (gvPersonalResponsibility[3, i] != null) prInfo.BillAmount = (Double)Decimal.Parse(gvPersonalResponsibility[3, i].Value.ToString().Substring(1));
                    prInfo.Type = gvPersonalResponsibility[4, i]?.Value.ToString();
                    if (gvPersonalResponsibility[5, i] != null) prInfo.PersonalResponsibilityTotal = (Double)Decimal.Parse(gvPersonalResponsibility[8, i].Value.ToString().Substring(1));

                    lstPersonalResponsibilityInfo.Add(prInfo);
                }

                MigraDocDOM.Document pdfPersonalResponsibilityDoc = new MigraDocDOM.Document();

                MigraDocDOM.Section section = pdfPersonalResponsibilityDoc.AddSection();

                section.PageSetup.PageFormat = MigraDocDOM.PageFormat.Letter;
                section.PageSetup.HeaderDistance = "0.25in";
                section.PageSetup.TopMargin = "1.5in";
                section.PageSetup.LeftMargin = "0.8in";
                section.PageSetup.RightMargin = "0.8in";
                section.PageSetup.BottomMargin = "0.5in";

                section.PageSetup.DifferentFirstPageHeaderFooter = false;
                section.Headers.Primary.Format.SpaceBefore = "0.25in";

                MigraDocDOM.Shapes.Image image = section.Headers.Primary.AddImage("C:\\Program Files (x86)\\CMM\\BlueSheet\\cmmlogo.png");

                image.Height = "0.8in";
                image.LockAspectRatio = true;
                image.RelativeVertical = MigraDocDOM.Shapes.RelativeVertical.Line;
                image.RelativeHorizontal = MigraDocDOM.Shapes.RelativeHorizontal.Margin;
                image.Top = MigraDocDOM.Shapes.ShapePosition.Top;
                image.Left = MigraDocDOM.Shapes.ShapePosition.Center;
                image.WrapFormat.Style = MigraDocDOM.Shapes.WrapStyle.TopBottom;

                MigraDocDOM.Paragraph paraCMMAddress = section.Headers.Primary.AddParagraph();
                paraCMMAddress.Format.Font.Name = "Arial";
                paraCMMAddress.Format.Font.Size = 8;
                paraCMMAddress.Format.SpaceBefore = "0.15in";
                paraCMMAddress.Format.SpaceAfter = "0.25in";
                paraCMMAddress.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                String strVerticalBar = " | ";
                String strStreet = "5235 N. Elston Ave.";
                String strCityStateZip = "Chicago, IL 60630";
                String strPhone = "Phone 773.777.8889";
                String strFax = "Fax 773.777.0004";
                String strWebsiteAddr = "www.cmmlogos.org";

                paraCMMAddress.AddFormattedText(strStreet, MigraDocDOM.TextFormat.NotBold);
                paraCMMAddress.AddFormattedText(strVerticalBar, MigraDocDOM.TextFormat.Bold);
                paraCMMAddress.AddFormattedText(strCityStateZip, MigraDocDOM.TextFormat.NotBold);
                paraCMMAddress.AddFormattedText(strVerticalBar, MigraDocDOM.TextFormat.Bold);
                paraCMMAddress.AddFormattedText(strPhone, MigraDocDOM.TextFormat.NotBold);
                paraCMMAddress.AddFormattedText(strVerticalBar, MigraDocDOM.TextFormat.Bold);
                paraCMMAddress.AddFormattedText(strFax, MigraDocDOM.TextFormat.NotBold);
                paraCMMAddress.AddFormattedText(strVerticalBar, MigraDocDOM.TextFormat.Bold);
                paraCMMAddress.AddFormattedText(strWebsiteAddr, MigraDocDOM.TextFormat.NotBold);

                MigraDocDOM.Paragraph paraToday = section.AddParagraph();
                paraToday.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                paraToday.Format.Font.Name = "Arial";
                paraToday.Format.Alignment = MigraDocDOM.ParagraphAlignment.Left;
                paraToday.Format.SpaceBefore = "0.25in";
                paraToday.Format.SpaceAfter = "0.25in";
                paraToday.AddFormattedText(DateTime.Today.ToString("MM/dd/yyyy"));

                MigraDocDOM.Paragraph paraMembershipInfo = section.AddParagraph();

                paraMembershipInfo.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                paraMembershipInfo.Format.Font.Name = "Arial";
                //paraMembershipInfo.Format.SpaceBefore = "0.70in";
                paraMembershipInfo.Format.SpaceBefore = "0.20in";
                paraMembershipInfo.Format.SpaceAfter = "0.20in";
                //paraMembershipInfo.Format.LeftIndent = "0.5in";
                //paraMembershipInfo.Format.RightIndent = "0.5in";
                paraMembershipInfo.Format.Alignment = MigraDocDOM.ParagraphAlignment.Left;
                //paraMembershipInfo.AddFormattedText("Primary Name: " + strPrimaryName + "\n");
                if (strMembershipIdBlueSheet != String.Empty) paraMembershipInfo.AddFormattedText(strMembershipIdBlueSheet + " (" + strIndividualIDBlueSheet + ")\n");
                else paraMembershipInfo.AddFormattedText(strIndividualIDBlueSheet + "\n");
                paraMembershipInfo.AddFormattedText(strIndividualNameBlueSheet.Trim() + "\n");
                paraMembershipInfo.AddFormattedText(strStreetAddressBlueSheet + "\n");
                paraMembershipInfo.AddFormattedText(strCityBlueSheet + ", " + strStateBlueSheet + " " + strZipBlueSheet + "\n");


                MigraDocDOM.Paragraph paraDearMember = section.AddParagraph();
                paraDearMember.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                paraDearMember.Format.Font.Name = "Arial";
                paraDearMember.Format.Font.Size = 8;
                paraDearMember.Format.Alignment = MigraDocDOM.ParagraphAlignment.Left;
                //paraDearMember.Format.LeftIndent = "0.5in";
                //paraDearMember.Format.RightIndent = "0.5in";
                paraDearMember.Format.SpaceBefore = "0.1in";
                paraDearMember.Format.SpaceAfter = "0.1in";
                //if (strIndividualMiddleName != String.Empty) paraDearMember.AddFormattedText(strIndividualLastName + ", " + strIndiviaualFirstName + " 회원께,");
                //else paraDearMember.AddFormattedText(strIndividualLastName + ", " + strIndiviaualFirstName + " " + strIndividualMiddleName + " 회원께,");
                //paraDearMember.AddFormattedText(strIndividualName + " 회원께,");
                paraDearMember.AddFormattedText(strDearMember + strIndividualNameBlueSheet.Trim() + ", ");

                /////////////////////////////////////////////////////////////////////////////////////////////////////////////
                MigraDocDOM.Paragraph paraPRGreetingMessage1 = section.AddParagraph();

                paraPRGreetingMessage1.Format.Font.Color = MigraDoc.DocumentObjectModel.Color.FromCmyk(100, 100, 100, 100);
                paraPRGreetingMessage1.Format.Font.Name = "Arial";
                paraPRGreetingMessage1.Format.Font.Size = 8;
                paraPRGreetingMessage1.Format.SpaceAfter = "5pt";
                //paraGreetingMessage.Format.LeftIndent = "0.5in";
                //paraGreetingMessage.Format.RightIndent = "0.5in";
                paraPRGreetingMessage1.Format.Alignment = MigraDocDOM.ParagraphAlignment.Justify;
                //paraGreetingMessage.AddFormattedText(strGreetingMessage, TextFormat.NotBold);
                paraPRGreetingMessage1.AddFormattedText(strEnglishPRGreetingMessage1, MigraDocDOM.TextFormat.NotBold);




                //////////////////////////////////////////////////////////////////////////////////////////////////////
                /// Program personal responsibility table
                /// 

                MigraDocDOM.Tables.Table tableProgramPRGuide = new MigraDocDOM.Tables.Table();
                tableProgramPRGuide.Borders.Width = 0.1;
                tableProgramPRGuide.Borders.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                MigraDocDOM.Tables.Column colProgram = tableProgramPRGuide.AddColumn(MigraDocDOM.Unit.FromInch(2));
                colProgram.Format.Alignment = MigraDocDOM.ParagraphAlignment.Left;
                MigraDocDOM.Tables.Column colPersonalResponsibility = tableProgramPRGuide.AddColumn(MigraDocDOM.Unit.FromInch(4.8));
                colPersonalResponsibility.Format.Alignment = MigraDocDOM.ParagraphAlignment.Left;

                MigraDocDOM.Tables.Row rowHeader = tableProgramPRGuide.AddRow();
                rowHeader.Height = "0.2in";
                rowHeader.VerticalAlignment = MigraDocDOM.Tables.VerticalAlignment.Center;

                MigraDocDOM.Tables.Cell cellProgramHeader = rowHeader.Cells[0];
                cellProgramHeader.Format.Font.Bold = true;
                cellProgramHeader.Format.Font.Size = 8;
                cellProgramHeader.Format.Font.Name = "Arial";
                cellProgramHeader.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                cellProgramHeader.AddParagraph("Program");

                MigraDocDOM.Tables.Cell cellPersonalResponsibility = rowHeader.Cells[1];
                cellPersonalResponsibility.Format.Font.Bold = true;
                cellPersonalResponsibility.Format.Font.Size = 8;
                cellPersonalResponsibility.Format.Font.Name = "Arial";
                cellPersonalResponsibility.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                cellPersonalResponsibility.AddParagraph("Personal Responsibility Amount");

                MigraDocDOM.Tables.Row rowBronze = tableProgramPRGuide.AddRow();
                rowBronze.Height = "0.2in";
                rowBronze.VerticalAlignment = MigraDocDOM.Tables.VerticalAlignment.Center;

                MigraDocDOM.Tables.Cell cellBronze = rowBronze.Cells[0];
                cellBronze.Format.Font.Bold = false;
                cellBronze.Format.Font.Size = 8;
                cellBronze.Format.Font.Name = "Arial";
                cellBronze.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                cellBronze.AddParagraph("Bronze");

                MigraDocDOM.Tables.Cell cellBronzePR = rowBronze.Cells[1];
                cellBronzePR.Format.Font.Bold = false;
                cellBronzePR.Format.Font.Size = 8;
                cellBronzePR.Format.Font.Name = "Arial";
                cellBronzePR.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                cellBronzePR.AddParagraph("$5,000 Per Incident");

                MigraDocDOM.Tables.Row rowSilver = tableProgramPRGuide.AddRow();
                rowSilver.Height = "0.2in";
                rowSilver.VerticalAlignment = MigraDocDOM.Tables.VerticalAlignment.Center;

                MigraDocDOM.Tables.Cell cellSilver = rowSilver.Cells[0];
                cellSilver.Format.Font.Bold = false;
                cellSilver.Format.Font.Size = 8;
                cellSilver.Format.Font.Name = "Arial";
                cellSilver.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                cellSilver.AddParagraph("Silver");

                MigraDocDOM.Tables.Cell cellSilverPR = rowSilver.Cells[1];
                cellSilverPR.Format.Font.Bold = false;
                cellSilverPR.Format.Font.Size = 8;
                cellSilverPR.Format.Font.Name = "Arial";
                cellSilverPR.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                cellSilverPR.AddParagraph("$1,000 Per Incident");

                MigraDocDOM.Tables.Row rowGold = tableProgramPRGuide.AddRow();
                rowGold.Height = "0.2in";
                rowGold.VerticalAlignment = MigraDocDOM.Tables.VerticalAlignment.Center;

                MigraDocDOM.Tables.Cell cellGold = rowGold.Cells[0];
                cellGold.Format.Font.Bold = false;
                cellGold.Format.Font.Size = 8;
                cellGold.Format.Font.Name = "Arial";
                cellGold.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                cellGold.AddParagraph("Gold");

                MigraDocDOM.Tables.Cell cellGoldPR = rowGold.Cells[1];
                cellGoldPR.Format.Font.Bold = false;
                cellGoldPR.Format.Font.Size = 8;
                cellGoldPR.Format.Font.Name = "Arial";
                cellGoldPR.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                cellGoldPR.AddParagraph("$500 Per Incident");

                MigraDocDOM.Tables.Row rowGoldPlus = tableProgramPRGuide.AddRow();
                rowGoldPlus.Height = "0.2in";
                rowGoldPlus.VerticalAlignment = MigraDocDOM.Tables.VerticalAlignment.Center;

                MigraDocDOM.Tables.Cell cellGoldPlus = rowGoldPlus.Cells[0];
                cellGoldPlus.Format.Font.Bold = false;
                cellGoldPlus.Format.Font.Size = 8;
                cellGoldPlus.Format.Font.Name = "Arial";
                cellGoldPlus.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                cellGoldPlus.AddParagraph("Gold Plus");

                MigraDocDOM.Tables.Cell cellGoldPlusPR = rowGoldPlus.Cells[1];
                cellGoldPlusPR.Format.Font.Bold = false;
                cellGoldPlusPR.Format.Font.Size = 8;
                cellGoldPlusPR.Format.Font.Name = "Arial";
                cellGoldPlusPR.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                cellGoldPlusPR.AddParagraph("$500 Per Calendar year");

                pdfPersonalResponsibilityDoc.LastSection.Add(tableProgramPRGuide);


                MigraDocDOM.Paragraph paraPRGreetingMessage2 = section.AddParagraph();
                paraPRGreetingMessage2.Format.Font.Color = MigraDoc.DocumentObjectModel.Color.FromCmyk(100, 100, 100, 100);
                paraPRGreetingMessage2.Format.Font.Name = "Arial";
                paraPRGreetingMessage2.Format.Font.Size = 8;
                paraPRGreetingMessage2.Format.SpaceAfter = "5pt";
                //paraGreetingMessage2.Format.LeftIndent = "0.5in";
                //paraGreetingMessage2.Format.RightIndent = "0.5in";
                paraPRGreetingMessage2.Format.Alignment = MigraDocDOM.ParagraphAlignment.Justify;
                paraPRGreetingMessage2.AddFormattedText(strEnglishPRGreetingMessage2, MigraDocDOM.TextFormat.NotBold);

                MigraDocDOM.Paragraph paraPRGreetingMessage3 = section.AddParagraph();
                paraPRGreetingMessage3.Format.Font.Color = MigraDoc.DocumentObjectModel.Color.FromCmyk(100, 100, 100, 100);
                paraPRGreetingMessage3.Format.Font.Name = "Arial";
                paraPRGreetingMessage3.Format.Font.Size = 8;
                paraPRGreetingMessage3.Format.SpaceAfter = "5pt";
                //paraGreetingMessage3.Format.LeftIndent = "0.5in";
                //paraGreetingMessage3.Format.RightIndent = "0.5in";
                paraPRGreetingMessage3.Format.Alignment = MigraDocDOM.ParagraphAlignment.Justify;
                paraPRGreetingMessage3.AddFormattedText(strEnglishPRGreetingMessage3, MigraDocDOM.TextFormat.NotBold);


                MigraDocDOM.Paragraph paraPRGreetingMessage4 = section.AddParagraph();
                paraPRGreetingMessage4.Format.Font.Color = MigraDoc.DocumentObjectModel.Color.FromCmyk(100, 100, 100, 100);
                paraPRGreetingMessage4.Format.Font.Name = "Arial";
                paraPRGreetingMessage4.Format.Font.Size = 8;
                paraPRGreetingMessage4.Format.SpaceAfter = "5pt";
                //paraGreetingMessage3.Format.LeftIndent = "0.5in";
                //paraGreetingMessage3.Format.RightIndent = "0.5in";
                paraPRGreetingMessage4.Format.Alignment = MigraDocDOM.ParagraphAlignment.Justify;
                paraPRGreetingMessage4.AddFormattedText(strEnglishPRGreetingMessage4, MigraDocDOM.TextFormat.NotBold);

                MigraDocDOM.Paragraph paraPRGreetingMessage5 = section.AddParagraph();
                paraPRGreetingMessage4.Format.Font.Color = MigraDoc.DocumentObjectModel.Color.FromCmyk(100, 100, 100, 100);
                paraPRGreetingMessage4.Format.Font.Name = "Arial";
                paraPRGreetingMessage4.Format.Font.Size = 8;
                paraPRGreetingMessage4.Format.SpaceAfter = "5pt";
                //paraGreetingMessage3.Format.LeftIndent = "0.5in";
                //paraGreetingMessage3.Format.RightIndent = "0.5in";
                paraPRGreetingMessage4.Format.Alignment = MigraDocDOM.ParagraphAlignment.Justify;
                paraPRGreetingMessage4.AddFormattedText(strEnglishPRGreetingMessage5, MigraDocDOM.TextFormat.NotBold);

                //Paragraph paraPRGreetingMessage4 = section.AddParagraph();
                //paraPRGreetingMessage4.Format.Font.Color = MigraDoc.DocumentObjectModel.Color.FromCmyk(100, 100, 100, 100);
                //paraPRGreetingMessage4.Format.Font.Name = "Arial";
                //paraPRGreetingMessage4.Format.Font.Size = 8;
                ////paraGreetingMessage4.Format.LeftIndent = "0.5in";
                ////paraGreetingMessage4.Format.RightIndent = "0.5in";
                //paraPRGreetingMessage4.Format.Alignment = ParagraphAlignment.Justify;
                //paraPRGreetingMessage4.AddFormattedText(strPRGreetingMessagePara4, TextFormat.NotBold);

                //Paragraph paraPRGreetingMessage5 = section.AddParagraph();
                //paraPRGreetingMessage5.Format.Font.Color = MigraDoc.DocumentObjectModel.Color.FromCmyk(100, 100, 100, 100);
                //paraPRGreetingMessage5.Format.Font.Name = "Arial";
                //paraPRGreetingMessage5.Format.Font.Size = 8;
                ////paraGreetingMessage4.Format.LeftIndent = "0.5in";
                ////paraGreetingMessage4.Format.RightIndent = "0.5in";
                //paraPRGreetingMessage5.Format.Alignment = ParagraphAlignment.Justify;
                //paraPRGreetingMessage5.AddFormattedText(strPRGreetingMessagePara5, TextFormat.NotBold);

                //Paragraph paraPRGreetingMessage6 = section.AddParagraph();
                //paraPRGreetingMessage6.Format.Font.Color = MigraDoc.DocumentObjectModel.Color.FromCmyk(100, 100, 100, 100);
                //paraPRGreetingMessage6.Format.Font.Name = "Arial";
                //paraPRGreetingMessage6.Format.Font.Size = 8;
                ////paraGreetingMessage4.Format.LeftIndent = "0.5in";
                ////paraGreetingMessage4.Format.RightIndent = "0.5in";
                //paraPRGreetingMessage6.Format.Alignment = ParagraphAlignment.Justify;
                //paraPRGreetingMessage6.AddFormattedText(strPRGreetingMessagePara6, TextFormat.NotBold);




                ///////////////////////////////////////////////////////////////////////////////////////////////////////////
                MigraDocDOM.Paragraph paraNeedsProcessing = section.AddParagraph();

                paraNeedsProcessing.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                paraNeedsProcessing.Format.Font.Name = "Arial";
                paraNeedsProcessing.Format.Font.Size = 8;
                paraNeedsProcessing.Format.Font.Bold = true;
                paraNeedsProcessing.Format.Alignment = MigraDocDOM.ParagraphAlignment.Left;
                //paraNeedsProcessing.Format.SpaceBefore = "0.1in";
                //paraNeedsProcessing.Format.LeftIndent = "0.5in";
                //paraNeedsProcessing.Format.RightIndent = "0.5in";
                paraNeedsProcessing.AddFormattedText(strCMM_NeedProcessing + "\n");

                MigraDocDOM.Paragraph paraPhoneFaxEmail = section.AddParagraph();
                paraPhoneFaxEmail.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                paraPhoneFaxEmail.Format.Font.Size = 8;
                paraPhoneFaxEmail.Format.Alignment = MigraDocDOM.ParagraphAlignment.Left;
                //paraPhoneFaxEmail.Format.LeftIndent = "0.5in";
                paraPhoneFaxEmail.Format.RightIndent = "0.5in";
                paraPhoneFaxEmail.AddFormattedText(strNP_Phone_Fax_Email + "\n");

                MigraDocDOM.Paragraph paraHorizontalLine = section.AddParagraph();

                paraHorizontalLine.Format.SpaceBefore = "0.05in";
                paraHorizontalLine.Format.SpaceAfter = "0.05in";
                paraHorizontalLine.Format.Borders.Top.Width = 0;
                paraHorizontalLine.Format.Borders.Left.Width = 0;
                paraHorizontalLine.Format.Borders.Right.Width = 0;
                paraHorizontalLine.Format.Borders.Bottom.Width = 1;
                paraHorizontalLine.Format.Borders.Bottom.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                paraHorizontalLine.Format.Borders.Style = MigraDocDOM.BorderStyle.DashDot;

                MigraDocDOM.Paragraph paraNPStatement = section.AddParagraph();
                paraNPStatement.Format.Font.Color = MigraDoc.DocumentObjectModel.Color.FromCmyk(100, 100, 0, 0);
                paraNPStatement.Format.Font.Name = "Arial";
                paraNPStatement.Format.Font.Size = 12;
                paraNPStatement.Format.Font.Bold = true;
                paraNPStatement.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;
                paraNPStatement.Format.SpaceAfter = "0.1in";

                paraNPStatement.AddFormattedText("Needs Processing Statement\n", MigraDocDOM.TextFormat.Bold);

                MigraDocDOM.Paragraph paraPersonalResponsibilityTotal = section.AddParagraph();
                paraPersonalResponsibilityTotal.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                paraPersonalResponsibilityTotal.Format.Font.Name = "Arial";
                paraPersonalResponsibilityTotal.Format.Font.Size = 8;
                paraPersonalResponsibilityTotal.Format.Font.Bold = true;
                paraPersonalResponsibilityTotal.Format.Alignment = MigraDocDOM.ParagraphAlignment.Left;
                paraPersonalResponsibilityTotal.Format.SpaceBefore = "0.2in";
                //paraPersonalResponsibilityTotal.Format.SpaceAfter = "0.2in";

                paraPersonalResponsibilityTotal.AddFormattedText("Incident Occurrence Date: " + PersonalResponsibilityTotalEnteredBlueSheet.IncidentOccurrenceDate.Value.ToString("MM/dd/yyyy") + "\t" +
                                                                 "Personal Responsibility Total: " + PersonalResponsibilityTotalEnteredBlueSheet.PersonalResponsibilityTotal.ToString("C"));

                //Paragraph paraIncidentInfo = section.AddParagraph();
                //paraIncidentInfo.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                //paraIncidentInfo.Format.Font.Name = "Arial";
                //paraIncidentInfo.Format.Font.Size = 8;
                //paraIncidentInfo.Format.Font.Bold = true;
                //paraIncidentInfo.Format.Alignment = ParagraphAlignment.Left;
                //paraIncidentInfo.Format.SpaceBefore = "0.2in";
                //paraIncidentInfo.Format.SpaceAfter = "0.2in";

                if (lstIncidentsBlueSheet.Count > 0)
                {
                    MigraDocDOM.Paragraph paraIncd = section.AddParagraph();

                    paraIncd.Format.Font.Color = MigraDoc.DocumentObjectModel.Color.FromCmyk(100, 100, 100, 100);
                    paraIncd.Format.Font.Name = "Arial";
                    paraIncd.Format.Font.Size = 8;
                    paraIncd.Format.Font.Bold = true;

                    MigraDocDOM.Tables.Table tableIncd = new MigraDocDOM.Tables.Table();
                    tableIncd.Borders.Width = 0;
                    tableIncd.Borders.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                    tableIncd.Format.SpaceAfter = "0.05in";

                    MigraDocDOM.Tables.Column colINCD = tableIncd.AddColumn(MigraDocDOM.Unit.FromInch(0.85));
                    colINCD.Format.Alignment = MigraDocDOM.ParagraphAlignment.Left;
                    //colINCD = tableIncd.AddColumn(MigraDocDOM.Unit.FromInch(1.1));
                    //colINCD.Format.Alignment = ParagraphAlignment.Left;
                    colINCD = tableIncd.AddColumn(MigraDocDOM.Unit.FromInch(4.5));
                    colINCD.Format.Alignment = MigraDocDOM.ParagraphAlignment.Left;

                    foreach (IncidentBlueSheet incd in lstIncidentsBlueSheet)
                    {
                        //nRowHeight += 18;

                        MigraDocDOM.Tables.Row IncdRow = tableIncd.AddRow();
                        IncdRow.Height = "0.1in";
                        IncdRow.VerticalAlignment = MigraDocDOM.Tables.VerticalAlignment.Center;

                        MigraDocDOM.Tables.Cell cellIncdName = IncdRow.Cells[0];
                        cellIncdName.Format.Font.Bold = true;
                        cellIncdName.Format.Font.Size = 8;
                        //cellIncdName.Format.Font.Name = "Malgun Gothic";
                        cellIncdName.Format.Font.Name = "Arial";
                        cellIncdName.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                        cellIncdName.AddParagraph(incd.Name.Substring(2) + ": ");

                        //MigraDocDOM.Tables.Cell cellPatientName = IncdRow.Cells[1];
                        //cellPatientName.Format.Font.Bold = true;
                        //cellPatientName.Format.Font.Size = 8;
                        ////cellPatientName.Format.Font.Name = "Malgun Gothic";
                        //cellIncdName.Format.Font.Name = "Arial";
                        //cellPatientName.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                        //if (incd.PatientName.Length > 11)
                        //{
                        //    cellPatientName.AddParagraph(incd.PatientName.Substring(0, 11) + " ...");
                        //}
                        //else cellPatientName.AddParagraph(incd.PatientName);

                        MigraDocDOM.Tables.Cell cellICD10Code = IncdRow.Cells[1];
                        cellICD10Code.Format.Font.Bold = true;
                        cellICD10Code.Format.Font.Size = 8;
                        //cellICD10Code.Format.Font.Name = "Malgun Gothic";
                        cellIncdName.Format.Font.Name = "Arial";
                        cellICD10Code.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                        cellICD10Code.AddParagraph(incd.ICD10_Code);
                    }

                    pdfPersonalResponsibilityDoc.LastSection.Add(tableIncd);
                }




                ////////////////////////////////////////////////////////////////////////////////////////////////////////////

                MigraDocDOM.Tables.Table tablePersonalResponsibility = new MigraDocDOM.Tables.Table();
                tablePersonalResponsibility.Borders.Width = 0.1;
                tablePersonalResponsibility.Borders.Color = MigraDoc.DocumentObjectModel.Color.FromCmyk(100, 100, 100, 100);

                MigraDocDOM.Tables.Column colPersonalResponsibilityColumn = tablePersonalResponsibility.AddColumn(MigraDocDOM.Unit.FromInch(0.6));  // Med bill
                colPersonalResponsibilityColumn.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                colPersonalResponsibilityColumn = tablePersonalResponsibility.AddColumn(MigraDocDOM.Unit.FromInch(0.7));        // 서비스 날짜
                colPersonalResponsibilityColumn.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                colPersonalResponsibilityColumn = tablePersonalResponsibility.AddColumn(MigraDocDOM.Unit.FromInch(1.8));        // Medical Provider
                colPersonalResponsibilityColumn.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                colPersonalResponsibilityColumn = tablePersonalResponsibility.AddColumn(MigraDocDOM.Unit.FromInch(0.8));        // Bill Amount
                colPersonalResponsibilityColumn.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                colPersonalResponsibilityColumn = tablePersonalResponsibility.AddColumn(MigraDocDOM.Unit.FromInch(1.2));        // Type
                colPersonalResponsibilityColumn.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                colPersonalResponsibilityColumn = tablePersonalResponsibility.AddColumn(MigraDocDOM.Unit.FromInch(1.5));        // Personal Responsibility Total
                colPersonalResponsibilityColumn.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                // generate row for personal responsibility table
                MigraDocDOM.Tables.Row prRow = tablePersonalResponsibility.AddRow();
                prRow.Height = "0.31in";
                prRow.VerticalAlignment = MigraDocDOM.Tables.VerticalAlignment.Center;

                MigraDocDOM.Tables.Cell cellPersonalResponsibilityMedBill = prRow.Cells[0];
                cellPersonalResponsibilityMedBill.AddParagraph("MEDBILL");
                cellPersonalResponsibilityMedBill.Format.Font.Bold = true;
                cellPersonalResponsibilityMedBill.Format.Font.Size = 7;
                cellPersonalResponsibilityMedBill.Format.Font.Name = "Arial";
                cellPersonalResponsibilityMedBill.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                MigraDocDOM.Tables.Cell cellPersonalResponsibilityBillDate = prRow.Cells[1];
                cellPersonalResponsibilityBillDate.AddParagraph("Date of Service");
                cellPersonalResponsibilityBillDate.Format.Font.Bold = true;
                cellPersonalResponsibilityBillDate.Format.Font.Size = 7;
                cellPersonalResponsibilityBillDate.Format.Font.Name = "Arial";
                cellPersonalResponsibilityBillDate.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                MigraDocDOM.Tables.Cell cellPersonalResponsibilityMedicalProvider = prRow.Cells[2];
                cellPersonalResponsibilityMedicalProvider.AddParagraph("Medical Provider");
                cellPersonalResponsibilityMedicalProvider.Format.Font.Bold = true;
                cellPersonalResponsibilityMedicalProvider.Format.Font.Size = 7;
                cellPersonalResponsibilityMedicalProvider.Format.Font.Name = "Arial";
                cellPersonalResponsibilityMedicalProvider.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                MigraDocDOM.Tables.Cell cellPersonalResponsibilityBillAmount = prRow.Cells[3];
                cellPersonalResponsibilityBillAmount.AddParagraph("Original Amount");
                cellPersonalResponsibilityBillAmount.Format.Font.Bold = true;
                cellPersonalResponsibilityBillAmount.Format.Font.Size = 7;
                cellPersonalResponsibilityBillAmount.Format.Font.Name = "Arial";
                cellPersonalResponsibilityBillAmount.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                MigraDocDOM.Tables.Cell cellPersonalResponsibilityType = prRow.Cells[4];
                cellPersonalResponsibilityType.AddParagraph("Type");
                cellPersonalResponsibilityType.Format.Font.Bold = true;
                cellPersonalResponsibilityType.Format.Font.Size = 7;
                cellPersonalResponsibilityType.Format.Font.Name = "Arial";
                cellPersonalResponsibilityType.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);

                MigraDocDOM.Tables.Cell cellPersonalResponsibilityTotal = prRow.Cells[5];
                cellPersonalResponsibilityTotal.AddParagraph("Personal Responsibility Total");
                cellPersonalResponsibilityTotal.Format.Font.Bold = true;
                cellPersonalResponsibilityTotal.Format.Font.Size = 7;
                cellPersonalResponsibilityTotal.Format.Font.Name = "Arial";
                cellPersonalResponsibilityTotal.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);


                for (int i = 0; i < lstPersonalResponsibilityInfo.Count; i++)
                {
                    if (i < lstPersonalResponsibilityInfo.Count - 1)
                    {
                        MigraDocDOM.Tables.Row rowData = tablePersonalResponsibility.AddRow();
                        rowData.VerticalAlignment = MigraDocDOM.Tables.VerticalAlignment.Center;
                        rowData.Height = "0.18in";

                        MigraDocDOM.Tables.Cell cell = rowData.Cells[0];
                        cell.AddParagraph(lstPersonalResponsibilityInfo[i].MedBillName.Substring(8));
                        cell.Format.Font.Bold = false;
                        cell.Format.Font.Name = "Arial";
                        cell.Format.Font.Size = 7;
                        cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                        cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                        cell = rowData.Cells[1];
                        cell.AddParagraph(lstPersonalResponsibilityInfo[i].BillDate.Value.ToString("MM/dd/yyyy"));
                        cell.Format.Font.Bold = false;
                        cell.Format.Font.Name = "Arial";
                        cell.Format.Font.Size = 7;
                        cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                        cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                        cell = rowData.Cells[2];
                        cell.AddParagraph(lstPersonalResponsibilityInfo[i].MedicalProvider);
                        cell.Format.Font.Bold = false;
                        cell.Format.Font.Name = "Arial";
                        cell.Format.Font.Size = 7;
                        cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                        cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Left;

                        cell = rowData.Cells[3];
                        cell.AddParagraph(lstPersonalResponsibilityInfo[i].BillAmount.ToString("C"));
                        cell.Format.Font.Bold = false;
                        cell.Format.Font.Name = "Arial";
                        cell.Format.Font.Size = 7;
                        cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                        cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Right;

                        cell = rowData.Cells[4];
                        cell.AddParagraph(lstPersonalResponsibilityInfo[i].Type);
                        cell.Format.Font.Bold = false;
                        cell.Format.Font.Name = "Arial";
                        cell.Format.Font.Size = 7;
                        cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                        cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Left;

                        cell = rowData.Cells[5];
                        cell.AddParagraph(lstPersonalResponsibilityInfo[i].PersonalResponsibilityTotal.ToString("C"));
                        cell.Format.Font.Bold = false;
                        cell.Format.Font.Name = "Arial";
                        cell.Format.Font.Size = 7;
                        cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                        cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Right;
                    }
                    else if (i == lstPersonalResponsibilityInfo.Count - 1)
                    {
                        MigraDocDOM.Tables.Row rowData = tablePersonalResponsibility.AddRow();
                        rowData.VerticalAlignment = MigraDocDOM.Tables.VerticalAlignment.Center;
                        rowData.Height = "0.2in";

                        MigraDocDOM.Tables.Cell cell = rowData.Cells[0];
                        cell.AddParagraph(lstPersonalResponsibilityInfo[i].MedBillName);
                        cell.Format.Font.Bold = true;
                        cell.Format.Font.Name = "Arial";
                        cell.Format.Font.Size = 7;
                        cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                        cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                        cell = rowData.Cells[1];
                        if (lstPersonalResponsibilityInfo[i].BillDate != null) cell.AddParagraph(lstPersonalResponsibilityInfo[i].BillDate.Value.ToString("MM/dd/yyyy"));
                        cell.Format.Font.Bold = true;
                        cell.Format.Font.Name = "Arial";
                        cell.Format.Font.Size = 7;
                        cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                        cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Center;

                        cell = rowData.Cells[2];
                        //cell.AddParagraph(lstPersonalResponsibilityInfo[i].MedicalProvider);
                        cell.AddParagraph("Total");
                        cell.Format.Font.Bold = true;
                        cell.Format.Font.Name = "Arial";
                        cell.Format.Font.Size = 7;
                        cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                        cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Left;

                        cell = rowData.Cells[3];
                        cell.AddParagraph(lstPersonalResponsibilityInfo[i].BillAmount.ToString("C"));
                        cell.Format.Font.Bold = true;
                        cell.Format.Font.Name = "Arial";
                        cell.Format.Font.Size = 7;
                        cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                        cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Right;

                        cell = rowData.Cells[4];
                        cell.AddParagraph(lstPersonalResponsibilityInfo[i].Type);
                        cell.Format.Font.Bold = true;
                        cell.Format.Font.Name = "Arial";
                        cell.Format.Font.Size = 7;
                        cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                        cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Left;

                        cell = rowData.Cells[5];
                        cell.AddParagraph(lstPersonalResponsibilityInfo[i].PersonalResponsibilityTotal.ToString("C"));
                        cell.Format.Font.Bold = true;
                        cell.Format.Font.Name = "Arial";
                        cell.Format.Font.Size = 7;
                        cell.Format.Font.Color = MigraDocDOM.Color.FromCmyk(100, 100, 100, 100);
                        cell.Format.Alignment = MigraDocDOM.ParagraphAlignment.Right;
                    }
                }

                pdfPersonalResponsibilityDoc.LastSection.Add(tablePersonalResponsibility);

                const bool unicode = true;
                const PdfFontEmbedding embedding = PdfFontEmbedding.Always;

                PdfDocumentRenderer pdfRenderer = new PdfDocumentRenderer(unicode, embedding);
                pdfRenderer.Document = pdfPersonalResponsibilityDoc;
                pdfRenderer.RenderDocument();


                if (txtIncidentNoBlueSheet.Text.Trim() != String.Empty)
                {
                    SaveFileDialog savefileDlg = new SaveFileDialog();
                    savefileDlg.FileName = strIndividualIDBlueSheet + "_" + strIndividualNameBlueSheet + "_" + DateTime.Today.ToString("MM-dd-yyyy") + "_Ko";
                    savefileDlg.Filter = "PDF Files | *.pdf";
                    savefileDlg.DefaultExt = "pdf";
                    savefileDlg.RestoreDirectory = true;

                    if (savefileDlg.ShowDialog() == DialogResult.OK)
                    {
                        try
                        {
                            pdfRenderer.PdfDocument.Save(savefileDlg.FileName);
                            System.Diagnostics.ProcessStartInfo processInfo = new System.Diagnostics.ProcessStartInfo();
                            processInfo.FileName = savefileDlg.FileName;

                            System.Diagnostics.Process.Start(processInfo);
                        }
                        catch (IOException ex)
                        {
                            MessageBox.Show(ex.Message, "Error");
                            return;
                        }
                        //finally
                        //{
                        //    ChkInfoEntered = null;
                        //}
                    }
                }


            }
            else
            {
                MessageBox.Show("No table is populated", "Error");
            }
        }

        private void chkIBMedBill_CheckedChanged(object sender, EventArgs e)
        {
            if (!chkIBMedBill.Checked)
            {
                if (txtIBMedBillFileName.Text.Trim() != String.Empty)
                {
                    txtIBMedBillFileName.Text = String.Empty;
                    strIBFileNameMedBill = String.Empty;
                    strIBSourceFilePathMedBill = String.Empty;
                    strIBDestinationFilePathMedBill = String.Empty;
                }
            }
        }

        private void chkPoPMedBill_CheckedChanged(object sender, EventArgs e)
        {
            if (!chkPoPMedBill.Checked)
            {
                if (txtPoPMedBillFileName.Text.Trim() != String.Empty)
                {
                    txtPoPMedBillFileName.Text = String.Empty;
                    strPoPFileNameMedBill = String.Empty;
                    strPoPSourceFilePathMedBill = String.Empty;
                    strPoPDestinationFilePathMedBill = String.Empty;
                }
            }
        }

        private void chkMedRecMedBill_CheckedChanged(object sender, EventArgs e)
        {
            if (!chkMedRecMedBill.Checked)
            {
                if (txtMedRecMedBillFileName.Text.Trim() != String.Empty)
                {
                    txtMedRecMedBillFileName.Text = String.Empty;
                    strMedRecFileNameMedBill = String.Empty;
                    strMedRecSourceFilePathMedBill = String.Empty;
                    strMedRecDestinationFilePathMedBill = String.Empty;
                }
            }
        }

        private void chkOtherDocMedBill_CheckedChanged(object sender, EventArgs e)
        {
            if (!chkOtherDocMedBill.Checked)
            {
                if (txtOtherDocMedBillFileName.Text.Trim() != String.Empty)
                {
                    txtOtherDocMedBillFileName.Text = String.Empty;
                    strOtherDocFileNameMedBill = String.Empty;
                    strOtherDocSourceFilePathMedBill = String.Empty;
                    strOtherDocDestinationFilePathMedBill = String.Empty;
                }
            }
        }

        private void gvSettlementsForApproval_CellDoubleClick(object sender, DataGridViewCellEventArgs e)
        {
            if (e.RowIndex <= -1)
            {
                return;
            }

            DataGridView gvSettlement = sender as DataGridView;

            if (gvSettlement.Rows.Count > 0)
            {

                String strMedBillNo = gvSettlement["MedBillForApproval", e.RowIndex]?.Value?.ToString();
                String strIndividualId = gvSettlement["IndividualIdForApproval", e.RowIndex]?.Value?.ToString();

                InitializeMedBillForm();
                EnableMedicalBillForm();

                String strSqlQueryForMedBillInUse = "select [dbo].[tbl_MedBillInUse].[BillNo], [dbo].[tbl_MedBillInUse].[EditingStaff] from [dbo].[tbl_MedBillInUse] " +
                                    "where [dbo].[tbl_MedBillInUse].[BillNo] = @MedBillInUse";

                SqlCommand cmdQueryForMedBillInUse = new SqlCommand(strSqlQueryForMedBillInUse, connRN4);
                cmdQueryForMedBillInUse.CommandType = CommandType.Text;

                cmdQueryForMedBillInUse.Parameters.AddWithValue("@MedBillInUse", strMedBillNo);

                if (connRN4.State != ConnectionState.Closed)
                {
                    connRN4.Close();
                    connRN4.Open();
                }
                else if (connRN4.State == ConnectionState.Closed) connRN4.Open();
                SqlDataReader rdrMedBillInUse = cmdQueryForMedBillInUse.ExecuteReader();
                if (rdrMedBillInUse.HasRows)
                {
                    rdrMedBillInUse.Read();
                    if (strMedBillNo == rdrMedBillInUse.GetString(0).Trim() &&
                        nLoggedUserId != rdrMedBillInUse.GetInt16(1))
                    {
                        MessageBox.Show("The Medical Bill: " + strMedBillNo + " is in use.", "Error");
                        rdrMedBillInUse.Close();
                        if (connRN4.State != ConnectionState.Closed) connRN4.Close();
                        return;
                    }
                }
                else
                {
                    rdrMedBillInUse.Close();
                    if (connRN4.State != ConnectionState.Closed) connRN.Close();

                    String strSqlInsertMedBillInUse = "insert into [dbo].[tbl_MedBillInUse] (BillNo, EditingStaff) values (@MedBillNo, @ModifyingStaff)";

                    SqlCommand cmdInsertMedBillInUse = new SqlCommand(strSqlInsertMedBillInUse, connRN4);
                    cmdInsertMedBillInUse.CommandType = CommandType.Text;

                    cmdInsertMedBillInUse.Parameters.AddWithValue("@MedBillNo", strMedBillNo);
                    cmdInsertMedBillInUse.Parameters.AddWithValue("@ModifyingStaff", nLoggedUserId);

                    if (connRN4.State != ConnectionState.Closed)
                    {
                        connRN4.Close();
                        connRN4.Open();
                    }
                    else if (connRN4.State == ConnectionState.Closed) connRN4.Open();
                    int nMedBillInUseInserted = cmdInsertMedBillInUse.ExecuteNonQuery();
                    if (nMedBillInUseInserted != 1)
                    {
                        MessageBox.Show("Medical Bill in use: " + strMedBillNo + " has not been inserted.", "Error");
                        if (connRN4.State != ConnectionState.Closed) connRN4.Close();
                        return;
                    }
                    if (connRN4.State != ConnectionState.Closed) connRN4.Close();
                }

                // Code begin here

                String strPatientLastName = String.Empty;
                String strPatientFirstName = String.Empty;
                String strPatientMiddleName = String.Empty;
                String strPatientName = String.Empty;
                String strDateOfBirth = String.Empty;
                String strSSN = String.Empty;
                String strStreetAddr = String.Empty;
                String strCity = String.Empty;
                String strState = String.Empty;
                String strZip = String.Empty;

                Plan IndividualPlan = Plan.GoldPlus;

                String strSqlQueryForIndividualInfo = "select [dbo].[contact].[LastName], [dbo].[contact].[FirstName], [dbo].[contact].[MiddleName], [dbo].[contact].[Name], " +
                                                      "[dbo].[contact].[Birthdate], [dbo].[contact].[Social_Security_Number__c], " +
                                                      "[dbo].[contact].[MailingStreet], [dbo].[contact].[MailingCity], [dbo].[contact].[MailingState], [dbo].[contact].[MailingPostalCode], " +
                                                      "[dbo].[program].[Name] " +
                                                      "from [dbo].[contact] " +
                                                      "inner join [dbo].[program] on [dbo].[contact].[c4g_Plan__c] = [dbo].[program].[ID] " +
                                                      "where [dbo].[contact].[Individual_ID__c] = @IndividualId";

                SqlCommand cmdQueryForIndividualInfo = new SqlCommand(strSqlQueryForIndividualInfo, connSalesforce);
                cmdQueryForIndividualInfo.CommandType = CommandType.Text;

                cmdQueryForIndividualInfo.Parameters.AddWithValue("@IndividualId", strIndividualId);

                if (connSalesforce.State != ConnectionState.Closed)
                {
                    connSalesforce.Close();
                    connSalesforce.Open();
                }
                else if (connSalesforce.State == ConnectionState.Closed) connSalesforce.Open();
                SqlDataReader rdrIndividualInfo = cmdQueryForIndividualInfo.ExecuteReader();
                if (rdrIndividualInfo.HasRows)
                {
                    rdrIndividualInfo.Read();
                    if (!rdrIndividualInfo.IsDBNull(0)) strPatientLastName = rdrIndividualInfo.GetString(0);
                    if (!rdrIndividualInfo.IsDBNull(1)) strPatientFirstName = rdrIndividualInfo.GetString(1);
                    if (!rdrIndividualInfo.IsDBNull(2)) strPatientMiddleName = rdrIndividualInfo.GetString(2);
                    if (!rdrIndividualInfo.IsDBNull(3)) strPatientName = rdrIndividualInfo.GetString(3);
                    if (!rdrIndividualInfo.IsDBNull(4)) strDateOfBirth = rdrIndividualInfo.GetDateTime(4).ToString("MM/dd/yyyy");
                    if (!rdrIndividualInfo.IsDBNull(5)) strSSN = rdrIndividualInfo.GetString(5);
                    if (!rdrIndividualInfo.IsDBNull(6)) strStreetAddr = rdrIndividualInfo.GetString(6);
                    if (!rdrIndividualInfo.IsDBNull(7)) strCity = rdrIndividualInfo.GetString(7);
                    if (!rdrIndividualInfo.IsDBNull(8)) strState = rdrIndividualInfo.GetString(8);
                    if (!rdrIndividualInfo.IsDBNull(9)) strZip = rdrIndividualInfo.GetString(9);
                    if (!rdrIndividualInfo.IsDBNull(10))
                    {
                        switch (rdrIndividualInfo.GetString(10))
                        {
                            case "Gold Plus":
                                IndividualPlan = Plan.GoldPlus;
                                break;
                            case "Gold":
                                IndividualPlan = Plan.Gold;
                                break;
                            case "Silver":
                                IndividualPlan = Plan.Silver;
                                break;
                            case "Bronze":
                                IndividualPlan = Plan.Bronze;
                                break;
                            case "Gold Medi-I":
                                IndividualPlan = Plan.GoldMedi_I;
                                break;
                            case "Gold Medi-II":
                                IndividualPlan = Plan.GoldMedi_II;
                                break;
                        }
                    }
                }
                if (connSalesforce.State != ConnectionState.Closed) connSalesforce.Close();




                switch (IndividualPlan)
                {
                    case Plan.GoldPlus:
                        txtMemberProgram.Text = "Gold Plus";
                        break;
                    case Plan.Gold:
                        txtMemberProgram.Text = "Gold";
                        break;
                    case Plan.Silver:
                        txtMemberProgram.Text = "Silver";
                        break;
                    case Plan.Bronze:
                        txtMemberProgram.Text = "Bronze";
                        break;
                    case Plan.GoldMedi_I:
                        txtMemberProgram.Text = "Gold Medi-I";
                        break;
                    case Plan.GoldMedi_II:
                        txtMemberProgram.Text = "Gold Medi-II";
                        break;
                }

                txtIndividualIDMedBill.Text = gvSettlement["IndividualIdForApproval", e.RowIndex]?.Value?.ToString();
                if (strPatientMiddleName.Trim() == String.Empty) txtPatientNameMedBill.Text = strPatientLastName + ", " + strPatientFirstName;
                else if (strPatientMiddleName.Trim() != String.Empty) txtPatientNameMedBill.Text = strPatientLastName + ", " + strPatientFirstName + " " + strPatientMiddleName;

                txtMedBillDOB.Text = strDateOfBirth;
                txtMedBillSSN.Text = strSSN;
                txtMedBillAddress.Text = strStreetAddr + ", " + strCity + ", " + strState + " " + strZip;

                // populate Medical Bill types
                String strSqlQueryForMedBillTypes = "select [dbo].[tbl_medbill_type].[MedBillTypeId], [dbo].[tbl_medbill_type].[MedBillTypeName] from [dbo].[tbl_medbill_type]";

                SqlCommand cmdQueryForMedBillTypes = new SqlCommand(strSqlQueryForMedBillTypes, connRN4);
                cmdQueryForMedBillTypes.CommandType = CommandType.Text;

                //if (connRN.State == ConnectionState.Closed) connRN.Open();
                if (connRN4.State != ConnectionState.Closed)
                {
                    connRN4.Close();
                    connRN4.Open();
                }
                else if (connRN4.State == ConnectionState.Closed) connRN4.Open();

                SqlDataReader rdrMedBillTypes = cmdQueryForMedBillTypes.ExecuteReader();
                dicMedBillTypes.Clear();

                if (rdrMedBillTypes.HasRows)
                {
                    while (rdrMedBillTypes.Read())
                    {
                        if (!rdrMedBillTypes.IsDBNull(0) && !rdrMedBillTypes.IsDBNull(1))
                        {
                            dicMedBillTypes.Add(rdrMedBillTypes.GetInt16(0), rdrMedBillTypes.GetString(1));
                        }
                    }
                }
                rdrMedBillTypes.Close();
                if (connRN4.State != ConnectionState.Closed) connRN4.Close();

                comboPendingReason.Items.Clear();

                if (dicPendingReason.Count > 0)
                {
                    for (int i = 0; i < dicPendingReason.Count; i++)
                    {
                        comboPendingReason.Items.Add(dicPendingReason[i]);
                    }
                    comboPendingReason.SelectedIndex = 0;
                }
                //comboPendingReason.Sorted = true;

                // Populate Ineligible Reason
                comboIneligibleReason.Items.Clear();

                if (dicIneligibleReason.Count > 0)
                {
                    for (int i = 0; i < dicIneligibleReason.Count; i++)
                    {
                        comboIneligibleReason.Items.Add(dicIneligibleReason[i]);
                    }
                    comboIneligibleReason.SelectedIndex = 0;
                }
                //comboIneligibleReason.Sorted = true;

                // retrieve medbill for approval
                String ICD10Code = String.Empty;
                String MedicalProviderId = String.Empty;

                String strSqlQueryForMedBillForApproval = "select [dbo].[tbl_medbill].[Case_Id], [dbo].[tbl_illness].[IllnessNo], [dbo].[tbl_incident].[IncidentNo], " +
                                "[dbo].[tbl_medbill].[BillNo], [dbo].[tbl_medbill].[MedBillType_Id], [dbo].[tbl_medbill].[BillStatus], [dbo].[tbl_medbill].[BillClosed], " +
                                "[dbo].[tbl_medbill].[BillAmount], [dbo].[tbl_medbill].[MedicalProvider_Id], " +
                                "[dbo].[tbl_medbill].[PrescriptionDrugName], [dbo].[tbl_medbill].[PrescriptionNo], [dbo].[tbl_medbill].[PrescriptionDescription], " +
                                "[dbo].[tbl_medbill].[TotalNumberOfPhysicalTherapy], [dbo].[tbl_medbill].[PatientTypeId], " +
                                "[dbo].[tbl_medbill].[BillDate], [dbo].[tbl_medbill].[DueDate], " +
                                "[dbo].[tbl_medbill].[Account_At_Provider], [dbo].[tbl_medbill].[ProviderContactPerson], " +
                                "[dbo].[tbl_medbill].[Note], " +
                                "[dbo].[tbl_illness].[ICD_10_Id], " +
                                "[dbo].[tbl_medbill].[PendingReason], [dbo].[tbl_medbill].[IneligibleReason], " +
                                "[dbo].[tbl_medbill].[Account_At_Provider], [dbo].[tbl_medbill].[ProviderPhoneNumber], [dbo].[tbl_medbill].[ProviderContactPerson], " +
                                "[dbo].[tbl_medbill].[ProposalLetterSentDate], [dbo].[tbl_medbill].[HIPPASentDate], [dbo].[tbl_medbill].[MedicalRecordDate], " +
                                "[dbo].[tbl_medbill].[Illness_Id], [dbo].[tbl_medbill].[Incident_Id], " +
                                "[dbo].[tbl_medbill].[NPF_Form], [dbo].[tbl_medbill].[NPF_SourceFileName], [dbo].[tbl_medbill].[NPF_DestinationFileName], " +
                                "[dbo].[tbl_medbill].[IB_Form], [dbo].[tbl_medbill].[IB_SourceFileName], [dbo].[tbl_medbill].[IB_DestinationFileName], " +
                                "[dbo].[tbl_medbill].[POP_Form], [dbo].[tbl_medbill].[POP_SourceFileName], [dbo].[tbl_medbill].[POP_DestinationFileName], " +
                                "[dbo].[tbl_medbill].[MedRec_Form], [dbo].[tbl_medbill].[MedRec_SourceFileName], [dbo].[tbl_medbill].[MedRec_DestinationFileName], " +
                                "[dbo].[tbl_medbill].[Unknown_Form], [dbo].[tbl_medbill].[Unknown_SourceFileName], [dbo].[tbl_medbill].[Unknown_DestinationFileName] " +
                                "from [dbo].[tbl_medbill] " +
                                "inner join [dbo].[tbl_illness] on [dbo].[tbl_medbill].[Illness_Id] = [dbo].[tbl_illness].[Illness_Id] " +
                                "inner join [dbo].[tbl_incident] on [dbo].[tbl_medbill].[Incident_Id] = [dbo].[tbl_incident].[Incident_id] " +
                                "where [dbo].[tbl_medbill].[BillNo] = @MedBillNo and " +
                                "[dbo].[tbl_medbill].[Contact_Id] = @IndividualId and" +
                                "[dbo].[tbl_medbill].[IsDeleted] = 0";

                SqlCommand cmdQueryForMedBillForApproval = new SqlCommand(strSqlQueryForMedBillForApproval, connRN3);
                cmdQueryForMedBillForApproval.CommandType = CommandType.Text;

                cmdQueryForMedBillForApproval.Parameters.AddWithValue("@MedBillNo", strMedBillNo);
                cmdQueryForMedBillForApproval.Parameters.AddWithValue("@IndividualId", strIndividualId);

                if (connRN3.State != ConnectionState.Closed)
                {
                    connRN3.Close();
                    connRN3.Open();
                }
                else if (connRN3.State == ConnectionState.Closed) connRN3.Open();
                SqlDataReader rdrMedBillForApproval = cmdQueryForMedBillForApproval.ExecuteReader();
                if (rdrMedBillForApproval.HasRows)
                {
                    rdrMedBillForApproval.Read();

                    if (!rdrMedBillForApproval.IsDBNull(0)) txtMedBill_CaseNo.Text = rdrMedBillForApproval.GetString(0).Trim();
                    if (!rdrMedBillForApproval.IsDBNull(1))
                    {
                        Illness.IllnessNo = rdrMedBillForApproval.GetString(1).Trim();
                        txtMedBill_Illness.Text = rdrMedBillForApproval.GetString(1).Trim();
                    }
                    if (!rdrMedBillForApproval.IsDBNull(2))
                    {
                        Incident.IncidentNo = rdrMedBillForApproval.GetString(2).Trim();
                        txtMedBill_Incident.Text = rdrMedBillForApproval.GetString(2).Trim();
                    }

                    if (!rdrMedBillForApproval.IsDBNull(3)) txtMedBillNo.Text = rdrMedBillForApproval.GetString(3).Trim();

                    if (!rdrMedBillForApproval.IsDBNull(4))
                    {
                        comboMedBillType.Items.Clear();
                        for (int i = 1; i <= dicMedBillTypes.Count; i++)
                        {
                            comboMedBillType.Items.Add(dicMedBillTypes[i]);
                        }
                        comboMedBillType.SelectedIndex = rdrMedBillForApproval.GetInt16(4) - 1;
                    }

                    if (!rdrMedBillForApproval.IsDBNull(5))
                    {
                        if (dicMedBillStatus.Count > 0)
                        {
                            comboMedBillStatus.Items.Clear();
                            for (int i = 0; i < dicMedBillStatus.Count; i++)
                            {
                                comboMedBillStatus.Items.Add(dicMedBillStatus[i]);
                            }
                            comboMedBillStatus.SelectedIndex = rdrMedBillForApproval.GetInt16(5);
                        }
                    }
                    if (!rdrMedBillForApproval.IsDBNull(6))
                    {
                        if (rdrMedBillForApproval.GetBoolean(6) == true) cbMedBillClosed.SelectedIndex = 1;
                        else cbMedBillClosed.SelectedIndex = 0;
                    }
                    else cbMedBillClosed.SelectedIndex = 0;

                    if (!rdrMedBillForApproval.IsDBNull(7))
                    {
                        txtMedBillAmount.Text = rdrMedBillForApproval.GetDecimal(7).ToString("C");
                        txtBalance.Text = rdrMedBillForApproval.GetDecimal(7).ToString("C");
                    }
                    //if (!rdrMedBillForApproval.IsDBNull(8)) txtMedicalProvider.Text = rdrMedBillForApproval.GetString(8).Trim();
                    if (!rdrMedBillForApproval.IsDBNull(8)) MedicalProviderId = rdrMedBillForApproval.GetString(8).Trim();
                    if (!rdrMedBillForApproval.IsDBNull(9)) txtPrescriptionName.Text = rdrMedBillForApproval.GetString(9).Trim();
                    if (!rdrMedBillForApproval.IsDBNull(10)) txtNumberOfMedication.Text = rdrMedBillForApproval.GetString(10).Trim();
                    if (!rdrMedBillForApproval.IsDBNull(11)) txtPrescriptionDescription.Text = rdrMedBillForApproval.GetString(11).Trim();
                    if (!rdrMedBillForApproval.IsDBNull(12)) txtNumPhysicalTherapy.Text = rdrMedBillForApproval.GetInt16(12).ToString();
                    if (!rdrMedBillForApproval.IsDBNull(13))
                    {
                        int nPatientType = rdrMedBillForApproval.GetInt16(13);

                        if (nPatientType == 0) rbOutpatient.Checked = true;
                        else if (nPatientType == 1) rbInpatient.Checked = true;
                    }
                    // Bill date
                    if (!rdrMedBillForApproval.IsDBNull(14))
                    {
                        dtpBillDate.Checked = true;
                        dtpBillDate.Text = rdrMedBillForApproval.GetDateTime(14).ToString("MM/dd/yyyy");
                    }
                    else
                    {
                        dtpBillDate.Format = DateTimePickerFormat.Custom;
                        dtpBillDate.CustomFormat = " ";
                    }

                    // Due date
                    if (!rdrMedBillForApproval.IsDBNull(15))
                    {
                        dtpDueDate.Checked = true;
                        dtpDueDate.Text = rdrMedBillForApproval.GetDateTime(15).ToString("MM/dd/yyyy");
                    }
                    else
                    {
                        dtpDueDate.Format = DateTimePickerFormat.Custom;
                        dtpDueDate.CustomFormat = " ";
                    }

                    if (!rdrMedBillForApproval.IsDBNull(16)) txtMedBillAccountNoAtProvider.Text = rdrMedBillForApproval.GetString(16);
                    //if (!rdrMedBillForApproval.IsDBNull(17)) txtMedProviderPhoneNo.Text = rdrMedBillForApproval.GetString(17);
                    if (!rdrMedBillForApproval.IsDBNull(17)) txtProviderContactPerson.Text = rdrMedBillForApproval.GetString(17);

                    if (!rdrMedBillForApproval.IsDBNull(18))
                    {
                        if (comboMedBillType.SelectedIndex == 0) txtMedBillNote.Text = rdrMedBillForApproval.GetString(18);
                        if (comboMedBillType.SelectedIndex == 1) txtPrescriptionNote.Text = rdrMedBillForApproval.GetString(18);
                        if (comboMedBillType.SelectedIndex == 2) txtPhysicalTherapyRxNote.Text = rdrMedBillForApproval.GetString(18);
                    }

                    if (!rdrMedBillForApproval.IsDBNull(19))
                    {
                        ICD10Code = rdrMedBillForApproval.GetString(19).Trim();
                        Illness.ICD10Code = ICD10Code;
                        //txtMedBill_Illness.Text = ICD10Code;
                    }

                    if ((comboMedBillType.SelectedIndex == 0) && (!rdrMedBillForApproval.IsDBNull(20)))
                    {
                        comboPendingReason.SelectedIndex = rdrMedBillForApproval.GetInt32(20);
                    }

                    if ((comboMedBillType.SelectedIndex == 0) && (!rdrMedBillForApproval.IsDBNull(21)))
                    {
                        comboIneligibleReason.SelectedIndex = rdrMedBillForApproval.GetInt32(21);
                    }

                    // Reset fields

                    if (comboMedBillType.SelectedIndex == 0)       // Medical Bill Type - Medical Bill
                    {
                        txtPrescriptionName.Text = String.Empty;
                        txtPrescriptionDescription.Text = String.Empty;
                        txtPrescriptionNote.Text = String.Empty;
                        txtNumberOfMedication.Text = String.Empty;

                        txtNumPhysicalTherapy.Text = String.Empty;
                        txtPhysicalTherapyRxNote.Text = String.Empty;
                    }
                    else if (comboMedBillType.SelectedIndex == 1)       // Medical Bill Type - Prescription
                    {
                        txtNumPhysicalTherapy.Text = String.Empty;
                        txtPhysicalTherapyRxNote.Text = String.Empty;

                        rbInpatient.Checked = false;
                        rbOutpatient.Checked = false;

                        comboPendingReason.SelectedIndex = 0;
                        comboIneligibleReason.SelectedIndex = 0;

                        txtMedBillNote.Text = String.Empty;
                    }
                    else if (comboMedBillType.SelectedIndex == 2)       // Medical Bill Type - Physical Therapy
                    {
                        txtPrescriptionName.Text = String.Empty;
                        txtPrescriptionDescription.Text = String.Empty;
                        txtPrescriptionNote.Text = String.Empty;
                        txtNumberOfMedication.Text = String.Empty;

                        rbInpatient.Checked = false;
                        rbOutpatient.Checked = false;

                        comboPendingReason.SelectedIndex = 0;
                        comboIneligibleReason.SelectedIndex = 0;

                        txtMedBillNote.Text = String.Empty;
                    }

                    if (!rdrMedBillForApproval.IsDBNull(22)) txtMedBillAccountNoAtProvider.Text = rdrMedBillForApproval.GetString(22);
                    if (!rdrMedBillForApproval.IsDBNull(23)) txtMedProviderPhoneNo.Text = rdrMedBillForApproval.GetString(23);
                    if (!rdrMedBillForApproval.IsDBNull(24)) txtProviderContactPerson.Text = rdrMedBillForApproval.GetString(24);

                    if (!rdrMedBillForApproval.IsDBNull(25))
                    {
                        dtpProposalLetterSentDate.Checked = true;
                        dtpProposalLetterSentDate.Value = rdrMedBillForApproval.GetDateTime(25);
                        dtpProposalLetterSentDate.Format = DateTimePickerFormat.Short;
                    }
                    if (!rdrMedBillForApproval.IsDBNull(26))
                    {
                        dtpHippaSentDate.Checked = true;
                        dtpHippaSentDate.Value = rdrMedBillForApproval.GetDateTime(26);
                        dtpHippaSentDate.Format = DateTimePickerFormat.Short;
                    }
                    if (!rdrMedBillForApproval.IsDBNull(27))
                    {
                        dtpMedicalRecordDate.Checked = true;
                        dtpMedicalRecordDate.Value = rdrMedBillForApproval.GetDateTime(27);
                        dtpMedicalRecordDate.Format = DateTimePickerFormat.Short;
                    }

                    if (!rdrMedBillForApproval.IsDBNull(28)) Illness.IllnessId = rdrMedBillForApproval.GetString(28);
                    else Illness.IllnessId = String.Empty;

                    if (!rdrMedBillForApproval.IsDBNull(29)) Incident.IncidentId = rdrMedBillForApproval.GetString(29);
                    else Incident.IncidentId = String.Empty;

                    if (!rdrMedBillForApproval.IsDBNull(30)) chkNPFMedBill.Checked = rdrMedBillForApproval.GetBoolean(30);
                    else chkNPFMedBill.Checked = false;

                    if (!rdrMedBillForApproval.IsDBNull(31))
                    {
                        strNPFSourceFilePathMedBill = rdrMedBillForApproval.GetString(31);
                        strNPFormFileNameMedBill = Path.GetFileName(strNPFSourceFilePathMedBill);
                        txtNPFMedBillFileName.Text = strNPFormFileNameMedBill;
                    }
                    else txtNPFMedBillFileName.Text = String.Empty;

                    if (!rdrMedBillForApproval.IsDBNull(32)) strNPFDestinationFilePathMedBill = rdrMedBillForApproval.GetString(32);
                    else strNPFDestinationFilePathMedBill = String.Empty;

                    if (!rdrMedBillForApproval.IsDBNull(33)) chkIBMedBill.Checked = rdrMedBillForApproval.GetBoolean(33);
                    else chkIBMedBill.Checked = false;

                    if (!rdrMedBillForApproval.IsDBNull(34))
                    {
                        strIBSourceFilePathMedBill = rdrMedBillForApproval.GetString(34);
                        strIBFileNameMedBill = Path.GetFileName(strIBSourceFilePathMedBill);
                        txtIBMedBillFileName.Text = strIBFileNameMedBill;

                    }
                    else txtIBMedBillFileName.Text = String.Empty;

                    if (!rdrMedBillForApproval.IsDBNull(35)) strIBDestinationFilePathMedBill = rdrMedBillForApproval.GetString(35);
                    else strIBDestinationFilePathMedBill = String.Empty;

                    if (!rdrMedBillForApproval.IsDBNull(36)) chkPoPMedBill.Checked = rdrMedBillForApproval.GetBoolean(36);
                    else chkPoPMedBill.Checked = false;

                    if (!rdrMedBillForApproval.IsDBNull(37))
                    {
                        strPoPSourceFilePathMedBill = rdrMedBillForApproval.GetString(37);
                        strPoPFileNameMedBill = Path.GetFileName(strPoPSourceFilePathMedBill);
                        txtPoPMedBillFileName.Text = strPoPFileNameMedBill;
                    }
                    else txtPoPMedBillFileName.Text = String.Empty;

                    if (!rdrMedBillForApproval.IsDBNull(38)) strPoPDestinationFilePathMedBill = rdrMedBillForApproval.GetString(38);
                    else strPoPDestinationFilePathMedBill = String.Empty;

                    if (!rdrMedBillForApproval.IsDBNull(39)) chkMedRecMedBill.Checked = rdrMedBillForApproval.GetBoolean(39);
                    else chkMedRecMedBill.Checked = false;

                    if (!rdrMedBillForApproval.IsDBNull(40))
                    {
                        strMedRecSourceFilePathMedBill = rdrMedBillForApproval.GetString(40);
                        strMedRecFileNameMedBill = Path.GetFileName(strMedRecSourceFilePathMedBill);
                        txtMedRecMedBillFileName.Text = strMedRecFileNameMedBill;
                    }
                    else txtMedRecMedBillFileName.Text = String.Empty;

                    if (!rdrMedBillForApproval.IsDBNull(41)) strMedRecDestinationFilePathMedBill = rdrMedBillForApproval.GetString(41);
                    else strMedRecDestinationFilePathMedBill = String.Empty;

                    if (!rdrMedBillForApproval.IsDBNull(42)) chkOtherDocMedBill.Checked = rdrMedBillForApproval.GetBoolean(42);
                    else chkOtherDocMedBill.Checked = false;

                    if (!rdrMedBillForApproval.IsDBNull(43))
                    {
                        strOtherDocSourceFilePathMedBill = rdrMedBillForApproval.GetString(43);
                        strOtherDocFileNameMedBill = Path.GetFileName(strOtherDocSourceFilePathMedBill);
                        txtOtherDocMedBillFileName.Text = strOtherDocFileNameMedBill;
                    }

                    if (!rdrMedBillForApproval.IsDBNull(44)) strOtherDocDestinationFilePathMedBill = rdrMedBillForApproval.GetString(44);
                    else strOtherDocDestinationFilePathMedBill = String.Empty;

                }
                rdrMedBillForApproval.Close();
                if (connRN3.State != ConnectionState.Closed) connRN3.Close();


                ///////////////////////////////////////////////////////////////////////////////////////////////////////////////
                ///
                String strSqlQueryForMedicalProviderName = "select [dbo].[Account].[Name] from [dbo].[account] where [dbo].[account].[Id] = @MedicalProviderId";

                SqlCommand cmdQueryForMedicalProviderName = new SqlCommand(strSqlQueryForMedicalProviderName, connSalesforce4);
                cmdQueryForMedicalProviderName.CommandType = CommandType.Text;

                cmdQueryForMedicalProviderName.Parameters.AddWithValue("@MedicalProviderId", MedicalProviderId);

                if (connSalesforce4.State != ConnectionState.Closed)
                {
                    connSalesforce4.Close();
                    connSalesforce4.Open();
                }
                else if (connSalesforce4.State == ConnectionState.Closed) connSalesforce4.Open();
                Object objMedicalProviderName = cmdQueryForMedicalProviderName.ExecuteScalar();
                if (connSalesforce4.State != ConnectionState.Closed) connSalesforce4.Close();

                String MedicalProviderName = String.Empty;
                if (objMedicalProviderName != null) MedicalProviderName = objMedicalProviderName.ToString();

                txtMedicalProvider.Text = MedicalProviderName;

                String IncidentNo = txtMedBill_Incident.Text.Trim();
                String IndividualIdMedBill = txtIndividualIDMedBill.Text.Trim();

                String strSqlQueryForIncident = "select [dbo].[tbl_incident].[Program_id], [dbo].[tbl_program].[ProgramName], [dbo].[tbl_incident].[IsDeleted] " +
                                                "from [dbo].[tbl_incident] " +
                                                "inner join [dbo].[tbl_program] on [dbo].[tbl_incident].[Program_id] = [dbo].[tbl_program].[Program_Id] " +
                                                "where [dbo].[tbl_incident].[Individual_id] = @IndividualId and " +
                                                "[dbo].[tbl_incident].[IncidentNo] = @IncidentNo " +
                                                "order by [dbo].[tbl_incident].[Program_id]";

                SqlCommand cmdQueryForIncident = new SqlCommand(strSqlQueryForIncident, connRN4);
                cmdQueryForIncident.CommandType = CommandType.Text;

                cmdQueryForIncident.Parameters.AddWithValue("@IndividualId", IndividualIdMedBill);
                cmdQueryForIncident.Parameters.AddWithValue("@IncidentNo", IncidentNo);

                if (connRN4.State != ConnectionState.Closed)
                {
                    connRN4.Close();
                    connRN4.Open();
                }
                else if (connRN4.State == ConnectionState.Closed) connRN4.Open();

                SqlDataReader rdrIncident = cmdQueryForIncident.ExecuteReader();
                lstIncidentProgramInfo.Clear();
                if (rdrIncident.HasRows)
                {
                    while (rdrIncident.Read())
                    {
                        if (!rdrIncident.IsDBNull(0) && !rdrIncident.IsDBNull(1))
                        {
                            IncidentProgramInfo incidentProgram = new IncidentProgramInfo(rdrIncident.GetBoolean(2), rdrIncident.GetInt16(0), rdrIncident.GetString(1).Trim());
                            lstIncidentProgramInfo.Add(incidentProgram);
                        }
                    }
                }
                rdrIncident.Close();
                if (connRN4.State == ConnectionState.Open) connRN4.Close();

                ///////////////////////////////////////////////////////////////////////////////////////////////////////////
                ///
                if (ICD10Code != String.Empty)
                {
                    String strSqlQueryForDiseaseName = "select [dbo].[ICD10 Code].[Name] from [dbo].[ICD10 Code] where [dbo].[ICD10 Code].[ICD10_CODE__C] = @ICD10Code";

                    SqlCommand cmdQueryForDiseaseName = new SqlCommand(strSqlQueryForDiseaseName, connSalesforce4);
                    cmdQueryForDiseaseName.CommandType = CommandType.Text;

                    cmdQueryForDiseaseName.Parameters.AddWithValue("@ICD10Code", ICD10Code);

                    if (connSalesforce4.State == ConnectionState.Open)
                    {
                        connSalesforce4.Close();
                        connSalesforce4.Open();
                    }
                    else if (connSalesforce4.State == ConnectionState.Closed) connSalesforce4.Open();
                    String DiseaseName = String.Empty;
                    Object objDiseaseName = cmdQueryForDiseaseName.ExecuteScalar();

                    if (objDiseaseName != null) DiseaseName = objDiseaseName.ToString();
                    else
                    {
                        MessageBox.Show("No Disease Name for ICD 10 Code: " + ICD10Code, "Error", MessageBoxButtons.OK);
                        return;
                    }

                    if (connSalesforce4.State != ConnectionState.Closed) connSalesforce4.Close();

                    txtMedBill_ICD10Code.Text = ICD10Code;
                    txtMedBillDiseaseName.Text = DiseaseName;
                }
                else
                {
                    txtMedBill_ICD10Code.Text = String.Empty;
                    txtMedBillDiseaseName.Text = String.Empty;
                }
                // Get documents info
                String CaseNameInMedBill = txtMedBill_CaseNo.Text.Trim();
                String strSqlQueryForDocumentsInfo = "select [dbo].[tbl_case].[NPF_Form], [dbo].[tbl_case].[NPF_Receiv_Date], " +
                                                        "[dbo].[tbl_case].[IB_Form], [dbo].[tbl_case].[IB_Receiv_Date], " +
                                                        "[dbo].[tbl_case].[POP_Form], [dbo].[tbl_case].[POP_Receiv_Date], " +
                                                        "[dbo].[tbl_case].[MedRec_Form], [dbo].[tbl_case].[MedRec_Receiv_Date], " +
                                                        "[dbo].[tbl_case].[Unknown_Form], [dbo].[tbl_case].[Unknown_Receiv_Date] " +
                                                        "from [dbo].[tbl_case] where [dbo].[tbl_case].[Case_Name] = @CaseId and " +
                                                        "[dbo].[tbl_case].[Contact_ID] = @IndividualId and " +
                                                        "[dbo].[tbl_case].[IsDeleted] = 0";

                SqlCommand cmdQueryForDocInfo = new SqlCommand(strSqlQueryForDocumentsInfo, connRN4);
                cmdQueryForDocInfo.CommandType = CommandType.Text;

                cmdQueryForDocInfo.Parameters.AddWithValue("@CaseId", CaseNameInMedBill);
                cmdQueryForDocInfo.Parameters.AddWithValue("@IndividualId", IndividualIdMedBill);

                //if (connRN.State == ConnectionState.Closed) connRN.Open();
                if (connRN4.State != ConnectionState.Closed)
                {
                    connRN4.Close();
                    connRN4.Open();
                }
                else if (connRN4.State == ConnectionState.Closed) connRN4.Open();
                SqlDataReader rdrDocInfo = cmdQueryForDocInfo.ExecuteReader();
                if (rdrDocInfo.HasRows)
                {
                    rdrDocInfo.Read();

                    if (!rdrDocInfo.IsDBNull(0))
                    {
                        if (rdrDocInfo.GetBoolean(0))
                        {
                            chkMedBillNPFReceived.Checked = true;
                            chkMedBillNPFReceived.Enabled = false;
                            dtpMedBillNPF.Checked = true;
                            dtpMedBillNPF.Text = rdrDocInfo.GetDateTime(1).ToString("MM/dd/yyyy");
                            dtpMedBillNPF.Enabled = false;
                            btnViewNPF.Enabled = true;
                        }
                        else
                        {
                            chkMedBillNPFReceived.Checked = false;
                            chkMedBillNPFReceived.Enabled = false;
                            dtpMedBillNPF.Format = DateTimePickerFormat.Custom;
                            dtpMedBillNPF.CustomFormat = " ";
                            dtpMedBillNPF.Enabled = false;
                            btnViewNPF.Enabled = false;
                        }
                    }
                    if (!rdrDocInfo.IsDBNull(2))
                    {
                        if (rdrDocInfo.GetBoolean(2))
                        {
                            chkMedBill_IBReceived.Checked = true;
                            chkMedBill_IBReceived.Enabled = false;
                            dtpMedBill_IB.Checked = true;
                            dtpMedBill_IB.Text = rdrDocInfo.GetDateTime(3).ToString("MM/dd/yyyy");
                            dtpMedBill_IB.Enabled = false;
                            btnViewIB.Enabled = true;
                        }
                        else
                        {
                            chkMedBill_IBReceived.Checked = false;
                            chkMedBill_IBReceived.Enabled = false;
                            dtpMedBill_IB.Format = DateTimePickerFormat.Custom;
                            dtpMedBill_IB.CustomFormat = " ";
                            dtpMedBill_IB.Enabled = false;
                            btnViewIB.Enabled = false;
                        }
                    }
                    if (!rdrDocInfo.IsDBNull(4))
                    {
                        if (rdrDocInfo.GetBoolean(4))
                        {
                            chkMedBillPOPReceived.Checked = true;
                            chkMedBillPOPReceived.Enabled = false;
                            dtpMedBillPOP.Checked = true;
                            dtpMedBillPOP.Text = rdrDocInfo.GetDateTime(5).ToString("MM/dd/yyyy");
                            dtpMedBillPOP.Enabled = false;
                            btnViewPoP.Enabled = true;
                        }
                        else
                        {
                            chkMedBillPOPReceived.Checked = false;
                            chkMedBillPOPReceived.Enabled = false;
                            dtpMedBillPOP.Format = DateTimePickerFormat.Custom;
                            dtpMedBillPOP.CustomFormat = " ";
                            dtpMedBillPOP.Enabled = false;
                            btnViewPoP.Enabled = false;
                        }
                    }
                    if (!rdrDocInfo.IsDBNull(6))
                    {
                        if (rdrDocInfo.GetBoolean(6))
                        {
                            chkMedRecordReceived.Checked = true;
                            chkMedRecordReceived.Enabled = false;
                            dtpMedBillMedRecord.Checked = true;
                            dtpMedBillMedRecord.Text = rdrDocInfo.GetDateTime(7).ToString("MM/dd/yyyy");
                            dtpMedBillMedRecord.Enabled = false;
                            btnViewMedRecord.Enabled = true;
                        }
                        else
                        {
                            chkMedRecordReceived.Checked = false;
                            chkMedRecordReceived.Enabled = false;
                            dtpMedBillMedRecord.Format = DateTimePickerFormat.Custom;
                            dtpMedBillMedRecord.CustomFormat = " ";
                            dtpMedBillMedRecord.Enabled = false;
                            btnViewMedRecord.Enabled = false;
                        }
                    }

                    if (!rdrDocInfo.IsDBNull(8))
                    {
                        if (rdrDocInfo.GetBoolean(8))
                        {
                            chkOtherDocReceived.Checked = true;
                            chkOtherDocReceived.Enabled = false;
                            dtpMedBillOtherDoc.Checked = true;
                            dtpMedBillOtherDoc.Text = rdrDocInfo.GetDateTime(9).ToString("MM/dd/yyyy");
                            dtpMedBillOtherDoc.Enabled = false;
                            btnViewOtherDoc.Enabled = true;
                        }
                        else
                        {
                            chkOtherDocReceived.Checked = false;
                            chkOtherDocReceived.Enabled = false;
                            dtpMedBillOtherDoc.Format = DateTimePickerFormat.Custom;
                            dtpMedBillOtherDoc.CustomFormat = " ";
                            dtpMedBillOtherDoc.Enabled = false;
                            btnViewOtherDoc.Enabled = false;
                        }
                    }

                    strCaseIdSelected = CaseNameInMedBill;
                    strContactIdSelected = IndividualIdMedBill;
                }
                rdrDocInfo.Close();
                if (connRN4.State != ConnectionState.Closed) connRN4.Close();

                /////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                ///
                String strSqlQueryForIncidentProgram = "select [dbo].[tbl_program].[ProgramName] from [dbo].[tbl_program] " +
                                        "inner join [dbo].[tbl_incident] on [dbo].[tbl_program].[Program_id] = [dbo].[tbl_incident].[Program_id] " +
                                        "where [dbo].[tbl_incident].[Individual_id] = @IndividualId and [dbo].[tbl_incident].[IncidentNo] = @IncidentNo";

                SqlCommand cmdQueryForIncidentProgram = new SqlCommand(strSqlQueryForIncidentProgram, connRN4);
                cmdQueryForIncidentProgram.CommandType = CommandType.Text;

                cmdQueryForIncidentProgram.Parameters.AddWithValue("@IndividualId", IndividualIdMedBill);
                cmdQueryForIncidentProgram.Parameters.AddWithValue("@IncidentNo", txtMedBill_Incident.Text.Trim());

                if (connRN4.State != ConnectionState.Closed)
                {
                    connRN4.Close();
                    connRN4.Open();
                }
                else if (connRN4.State == ConnectionState.Closed) connRN4.Open();
                Object objIncidentProgramName = cmdQueryForIncidentProgram.ExecuteScalar();
                if (connRN4.State != ConnectionState.Closed) connRN4.Close();

                String IncidentProgramName = String.Empty;
                if (objIncidentProgramName != null) IncidentProgramName = objIncidentProgramName.ToString();
                else
                {
                    MessageBox.Show("No Program Name for Incident No: " + txtMedBill_Incident.Text.Trim(), "Error", MessageBoxButtons.OK);
                    return;
                }

                if (IncidentProgramName != String.Empty) txtIncdProgram.Text = IncidentProgramName;

                if (txtIncdProgram.Text.Trim() != txtMemberProgram.Text.Trim())
                {
                    txtIncdProgram.BackColor = Color.Red;
                    txtMemberProgram.BackColor = Color.Red;
                }
                else if (txtIncdProgram.Text.Trim() == txtMemberProgram.Text.Trim())
                {
                    txtIncdProgram.BackColor = Color.White;
                    txtMemberProgram.BackColor = Color.FromKnownColor(KnownColor.Control);
                }

                /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                ///
                var srcMedicalProvider = new AutoCompleteStringCollection();

                for (int i = 0; i < lstMedicalProvider.Count; i++)
                {
                    srcMedicalProvider.Add(lstMedicalProvider[i].Name);
                }

                txtMedicalProvider.AutoCompleteMode = AutoCompleteMode.SuggestAppend;
                txtMedicalProvider.AutoCompleteSource = AutoCompleteSource.CustomSource;
                txtMedicalProvider.AutoCompleteCustomSource = srcMedicalProvider;

                //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                //int nRowSelected = gvMedBill.CurrentCell.RowIndex;

                //IndividualId = txtCaseIndividualID.Text.Trim();
                //CaseNo = txtCaseName.Text.Trim();
                //MedicalBillNo = gvMedBill[1, nRowSelected].Value.ToString();
                lstPaymentMethod.Clear();
                String strSqlQueryForPaymentMethod = "select [dbo].[tbl_payment_method].[PaymentMethod_Id], [dbo].[tbl_payment_method].[PaymentMethod_Value] from [dbo].[tbl_payment_method] " +
                                                        "order by [dbo].[tbl_payment_method].[PaymentMethod_Value]";

                SqlCommand cmdQueryForPaymentMethod = new SqlCommand(strSqlQueryForPaymentMethod, connRN4);
                cmdQueryForPaymentMethod.CommandType = CommandType.Text;

                //if (connRN.State == ConnectionState.Closed) connRN.Open();
                if (connRN4.State != ConnectionState.Closed)
                {
                    connRN4.Close();
                    connRN4.Open();
                }
                else if (connRN4.State == ConnectionState.Closed) connRN4.Open();
                SqlDataReader rdrPaymentMethod = cmdQueryForPaymentMethod.ExecuteReader();
                if (rdrPaymentMethod.HasRows)
                {
                    while (rdrPaymentMethod.Read())
                    {
                        if (!rdrPaymentMethod.IsDBNull(1)) lstPaymentMethod.Add(new PaymentMethod { PaymentMethodId = rdrPaymentMethod.GetInt16(0), PaymentMethodValue = rdrPaymentMethod.GetString(1) });
                        else lstPaymentMethod.Add(new PaymentMethod { PaymentMethodId = rdrPaymentMethod.GetInt16(0), PaymentMethodValue = null });
                    }
                }
                rdrPaymentMethod.Close();
                if (connRN4.State != ConnectionState.Closed) connRN4.Close();

                // Retrieve credit card info
                lstCreditCardInfo.Clear();
                String strSqlQueryForCreditCardInfo = "select [dbo].[tbl_Credit_Card__c].[CreditCard_Id], [dbo].[tbl_Credit_Card__c].[Name] from [dbo].[tbl_Credit_Card__c]";

                SqlCommand cmdQueryForCreditCardInfo = new SqlCommand(strSqlQueryForCreditCardInfo, connRN4);
                cmdQueryForCreditCardInfo.CommandType = CommandType.Text;

                if (connRN4.State != ConnectionState.Closed)
                {
                    connRN4.Close();
                    connRN4.Open();
                }
                else if (connRN4.State == ConnectionState.Closed) connRN4.Open();

                SqlDataReader rdrCreditCardInfo = cmdQueryForCreditCardInfo.ExecuteReader();
                if (rdrCreditCardInfo.HasRows)
                {
                    while (rdrCreditCardInfo.Read())
                    {
                        if (!rdrCreditCardInfo.IsDBNull(1))
                            lstCreditCardInfo.Add(new CreditCardInfo { CreditCardId = rdrCreditCardInfo.GetInt16(0), CreditCardNo = rdrCreditCardInfo.GetString(1) });
                        else
                            lstCreditCardInfo.Add(new CreditCardInfo { CreditCardId = rdrCreditCardInfo.GetInt16(0), CreditCardNo = null });
                    }
                }
                rdrCreditCardInfo.Close();
                if (connRN4.State != ConnectionState.Closed) connRN4.Close();

                ////////////////////////////////////////////////////////////////////////////////////////////////////////
                String strSqlQueryForSettlement = "select [dbo].[tbl_settlement].[Name], [dbo].[tbl_settlement_type_code].[SettlementTypeValue], [dbo].[tbl_settlement].[Amount], " +
                                    "[dbo].[tbl_settlement].[PersonalResponsibilityCredit], [dbo].[tbl_payment_method].[PaymentMethod_Value], " +
                                    "[dbo].[tbl_settlement].[Approved], [dbo].[tbl_settlement].[ApprovedDate], " +
                                    "[dbo].[tbl_settlement].[CheckNo], [dbo].[tbl_settlement].[CheckDate], [dbo].[tbl_settlement].[CheckReconciled], " +
                                    "[dbo].[tbl_settlement].[ACH_Number], [dbo].[tbl_settlement].[ACH_Date], [dbo].[tbl_settlement].[ACH_Reconciled], " +
                                    "[dbo].[tbl_Credit_Card__c].[Name], [dbo].[tbl_settlement].[CMMCreditCardPaidDate], [dbo].[tbl_settlement].[CC_Reconciled], " +
                                    "[dbo].[tbl_settlement].[AllowedAmount], [dbo].[tbl_settlement].[IneligibleReason], " +
                                    "[dbo].[tbl_settlement].[Notes] " +
                                    "from [dbo].[tbl_settlement] inner join [dbo].[tbl_settlement_type_code] " +
                                    "on [dbo].[tbl_settlement].[SettlementType] = [dbo].[tbl_settlement_type_code].[SettlementTypeCode] " +
                                    "inner join [dbo].[tbl_payment_method] on [dbo].[tbl_settlement].[CMMPaymentMethod] = [dbo].[tbl_payment_method].[PaymentMethod_Id] " +
                                    "inner join [dbo].[tbl_Credit_Card__c] on [dbo].[tbl_settlement].[CMMCreditCard] = [dbo].[tbl_Credit_Card__c].[CreditCard_Id]" +
                                    "where [dbo].[tbl_settlement].[MedicalBillID] = @MedBillNo and " +
                                    "[dbo].[tbl_settlement].[IsDeleted] = 0 " +
                                    "order by [dbo].[tbl_settlement].[Name]";

                SqlCommand cmdQueryForSettlement = new SqlCommand(strSqlQueryForSettlement, connRN4);
                cmdQueryForSettlement.CommandType = CommandType.Text;

                cmdQueryForSettlement.Parameters.AddWithValue("@MedBillNo", strMedBillNo);

                SqlDependency dependencySettlementInMedBill = new SqlDependency(cmdQueryForSettlement);
                dependencySettlementInMedBill.OnChange += new OnChangeEventHandler(OnSettlementsInMedBillEditChange);

                //if (connRN.State == ConnectionState.Closed) connRN.Open();
                if (connRN4.State != ConnectionState.Closed)
                {
                    connRN4.Close();
                    connRN4.Open();
                }
                else if (connRN4.State == ConnectionState.Closed) connRN4.Open();
                SqlDataReader rdrSettlement = cmdQueryForSettlement.ExecuteReader();
                gvSettlementsInMedBill.Rows.Clear();
                if (rdrSettlement.HasRows)
                {
                    while (rdrSettlement.Read())
                    {
                        DataGridViewRow row = new DataGridViewRow();
                        row.Cells.Add(new DataGridViewCheckBoxCell { Value = false });
                        if (!rdrSettlement.IsDBNull(0)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlement.GetString(0) });
                        if (!rdrSettlement.IsDBNull(1))
                        {
                            DataGridViewComboBoxCell comboCellSettlementType = new DataGridViewComboBoxCell();

                            for (int i = 0; i < lstSettlementType.Count; i++)
                            {
                                comboCellSettlementType.Items.Add(lstSettlementType[i].SettlementTypeValue);
                            }
                            for (int i = 0; i < comboCellSettlementType.Items.Count; i++)
                            {
                                if (rdrSettlement.GetString(1) == comboCellSettlementType.Items[i].ToString())
                                    comboCellSettlementType.Value = comboCellSettlementType.Items[i];
                            }

                            row.Cells.Add(comboCellSettlementType);
                        }
                        else
                        {
                            DataGridViewComboBoxCell comboCellSettlementType = new DataGridViewComboBoxCell();
                            for (int i = 0; i < lstSettlementType.Count; i++)
                            {
                                comboCellSettlementType.Items.Add(lstSettlementType[i].SettlementTypeValue);
                            }

                            for (int i = 0; i < comboCellSettlementType.Items.Count; i++)
                            {
                                if (rdrSettlement.GetString(1) == comboCellSettlementType.Items[i].ToString())
                                    comboCellSettlementType.Value = comboCellSettlementType.Items[i];
                            }

                            row.Cells.Add(comboCellSettlementType);
                        }

                        if (!rdrSettlement.IsDBNull(2)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlement.GetDecimal(2).ToString("C") });
                        else
                        {
                            Decimal Zero = 0;
                            row.Cells.Add(new DataGridViewTextBoxCell { Value = Zero.ToString("C") });
                        }


                        if (!rdrSettlement.IsDBNull(3)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlement.GetDecimal(3).ToString("C") });
                        else
                        {
                            Decimal Zero = 0;
                            row.Cells.Add(new DataGridViewTextBoxCell { Value = Zero.ToString("C") });
                        }

                        /////////////////////////////////////////////////////////////////////
                        if (!rdrSettlement.IsDBNull(4))
                        {
                            DataGridViewComboBoxCell comboCellPaymentMethod = new DataGridViewComboBoxCell();

                            for (int i = 0; i < lstPaymentMethod.Count; i++)
                            {
                                if (lstPaymentMethod[i].PaymentMethodValue != null) comboCellPaymentMethod.Items.Add(lstPaymentMethod[i].PaymentMethodValue);
                                else comboCellPaymentMethod.Items.Add(String.Empty);
                            }

                            for (int i = 0; i < comboCellPaymentMethod.Items.Count; i++)
                            {
                                if (rdrSettlement.GetString(4) == comboCellPaymentMethod.Items[i].ToString())
                                    comboCellPaymentMethod.Value = comboCellPaymentMethod.Items[i];
                            }

                            row.Cells.Add(comboCellPaymentMethod);
                        }
                        else
                        {
                            DataGridViewComboBoxCell comboCellPaymentMethod = new DataGridViewComboBoxCell();

                            for (int i = 0; i < lstPaymentMethod.Count; i++)
                            {
                                if (lstPaymentMethod[i].PaymentMethodValue != null) comboCellPaymentMethod.Items.Add(lstPaymentMethod[i].PaymentMethodValue);
                                else comboCellPaymentMethod.Items.Add(String.Empty);
                                //comboCellPaymentMethod.Items.Add(lstPaymentMethod[i].PaymentMethodValue);
                            }

                            for (int i = 0; i < comboCellPaymentMethod.Items.Count; i++)
                            {
                                if ((!rdrSettlement.IsDBNull(4)) && comboCellPaymentMethod.Items[i] != null)
                                {
                                    if (rdrSettlement.GetString(4) == comboCellPaymentMethod.Items[i].ToString())
                                        comboCellPaymentMethod.Value = comboCellPaymentMethod.Items[i];
                                }
                                else comboCellPaymentMethod.Value = null;
                            }

                            row.Cells.Add(comboCellPaymentMethod);

                        }

                        /////////////////////////////////////////////////////////////////////
                        if (!rdrSettlement.IsDBNull(5))
                        {

                            DataGridViewCheckBoxCell approvedCell = new DataGridViewCheckBoxCell();
                            approvedCell.Value = rdrSettlement.GetBoolean(5);
                            approvedCell.Style.Alignment = DataGridViewContentAlignment.MiddleCenter;
                            row.Cells.Add(approvedCell);
                            if (LoggedInUserRole == UserRole.RNStaff ||
                                LoggedInUserRole == UserRole.NPStaff ||
                                LoggedInUserRole == UserRole.FDStaff ||
                                LoggedInUserRole == UserRole.MSStaff)
                                approvedCell.ReadOnly = true;
                            else if (LoggedInUserRole == UserRole.RNManager ||
                                     LoggedInUserRole == UserRole.NPManager ||
                                     LoggedInUserRole == UserRole.FDManager ||
                                     LoggedInUserRole == UserRole.MSManager ||
                                     LoggedInUserRole == UserRole.Administrator ||
                                     LoggedInUserRole == UserRole.SuperAdmin ||
                                     LoggedInUserRole == UserRole.Executive)
                                approvedCell.ReadOnly = false;
                        }
                        else
                        {
                            DataGridViewCheckBoxCell approvedCell = new DataGridViewCheckBoxCell();
                            approvedCell.Value = false;
                            approvedCell.Style.Alignment = DataGridViewContentAlignment.MiddleCenter;
                            row.Cells.Add(approvedCell);
                            if (LoggedInUserRole == UserRole.RNStaff ||
                                LoggedInUserRole == UserRole.NPStaff ||
                                LoggedInUserRole == UserRole.FDStaff ||
                                LoggedInUserRole == UserRole.MSStaff)
                                approvedCell.ReadOnly = true;
                            else if (LoggedInUserRole == UserRole.RNManager ||
                                     LoggedInUserRole == UserRole.NPManager ||
                                     LoggedInUserRole == UserRole.FDManager ||
                                     LoggedInUserRole == UserRole.MSManager ||
                                     LoggedInUserRole == UserRole.Administrator ||
                                     LoggedInUserRole == UserRole.SuperAdmin ||
                                     LoggedInUserRole == UserRole.Executive)
                                approvedCell.ReadOnly = false;
                        }

                        if (!rdrSettlement.IsDBNull(6))
                        {
                            row.Cells.Add(new CalendarCell { Value = DateTime.Parse(rdrSettlement.GetDateTime(6).ToString("MM/dd/yyyy")) });
                            row.Cells[7].ReadOnly = true;
                        }
                        else
                        {
                            row.Cells.Add(new CalendarCell { Value = null });
                            row.Cells[7].ReadOnly = true;
                        }

                        // Payment information
                        if (!rdrSettlement.IsDBNull(4))
                        {
                            String strPaymentMethod = rdrSettlement.GetString(4);

                            switch (strPaymentMethod)
                            {
                                case "Check":
                                    if (!rdrSettlement.IsDBNull(7)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlement.GetString(7) });
                                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = null });
                                    row.Cells.Add(new DataGridViewTextBoxCell { Value = null });
                                    DataGridViewComboBoxCell comboCellCreditCardNoneForCheck = new DataGridViewComboBoxCell();
                                    for (int i = 0; i < lstCreditCardInfo.Count; i++)
                                    {
                                        if (lstCreditCardInfo[i].CreditCardNo != null) comboCellCreditCardNoneForCheck.Items.Add(lstCreditCardInfo[i].CreditCardNo);
                                        else comboCellCreditCardNoneForCheck.Items.Add(String.Empty);
                                    }
                                    row.Cells.Add(comboCellCreditCardNoneForCheck);
                                    if (!rdrSettlement.IsDBNull(8))
                                    {
                                        row.Cells.Add(new CalendarCell { Value = DateTime.Parse(rdrSettlement.GetDateTime(8).ToString("MM/dd/yyyy")) });
                                    }
                                    else
                                    {
                                        row.Cells.Add(new CalendarCell { Value = String.Empty });
                                    }
                                    if (!rdrSettlement.IsDBNull(9))
                                    {
                                        row.Cells.Add(new DataGridViewCheckBoxCell { Value = rdrSettlement.GetBoolean(9) });
                                    }
                                    else
                                    {
                                        row.Cells.Add(new DataGridViewCheckBoxCell { Value = null });
                                    }
                                    break;
                                case "ACH/Banking":
                                    row.Cells.Add(new DataGridViewTextBoxCell { Value = null });
                                    if (!rdrSettlement.IsDBNull(10)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlement.GetString(10) });
                                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = null });
                                    DataGridViewComboBoxCell comboCellCreditCardNoneForACH = new DataGridViewComboBoxCell();
                                    for (int i = 0; i < lstCreditCardInfo.Count; i++)
                                    {
                                        if (lstCreditCardInfo[i].CreditCardNo != null)
                                            comboCellCreditCardNoneForACH.Items.Add(lstCreditCardInfo[i].CreditCardNo);
                                        else comboCellCreditCardNoneForACH.Items.Add(String.Empty);
                                    }
                                    row.Cells.Add(comboCellCreditCardNoneForACH);
                                    if (!rdrSettlement.IsDBNull(11))
                                    {
                                        row.Cells.Add(new CalendarCell { Value = DateTime.Parse(rdrSettlement.GetDateTime(11).ToString("MM/dd/yyyy")) });
                                    }
                                    else
                                    {
                                        row.Cells.Add(new CalendarCell { Value = String.Empty });
                                    }
                                    if (!rdrSettlement.IsDBNull(12))
                                    {
                                        row.Cells.Add(new DataGridViewCheckBoxCell { Value = rdrSettlement.GetBoolean(12) });
                                    }
                                    else
                                    {
                                        row.Cells.Add(new DataGridViewCheckBoxCell { Value = null });
                                    }
                                    break;
                                case "Credit Card":
                                    row.Cells.Add(new DataGridViewTextBoxCell { Value = null });
                                    row.Cells.Add(new DataGridViewTextBoxCell { Value = null });
                                    DataGridViewComboBoxCell comboCellCreditCard = new DataGridViewComboBoxCell();
                                    if (!rdrSettlement.IsDBNull(13))
                                    {
                                        for (int i = 0; i < lstCreditCardInfo.Count; i++)
                                        {
                                            if (lstCreditCardInfo[i].CreditCardNo != null) comboCellCreditCard.Items.Add(lstCreditCardInfo[i].CreditCardNo);
                                            else comboCellCreditCard.Items.Add(String.Empty);
                                        }
                                        for (int i = 0; i < comboCellCreditCard.Items.Count; i++)
                                        {
                                            if (rdrSettlement.GetString(13) == comboCellCreditCard.Items[i].ToString())
                                                comboCellCreditCard.Value = comboCellCreditCard.Items[i];
                                        }
                                    }
                                    else
                                    {
                                        //DataGridViewComboBoxCell comboCellCreditCard = new DataGridViewComboBoxCell();
                                        for (int i = 0; i < lstCreditCardInfo.Count; i++)
                                        {
                                            if (lstCreditCardInfo[i].CreditCardNo != null) comboCellCreditCard.Items.Add(lstCreditCardInfo[i].CreditCardNo);
                                            else comboCellCreditCard.Items.Add(String.Empty);
                                        }
                                        comboCellCreditCard.Value = String.Empty;
                                        //row.Cells.Add(comboCellCreditCard);
                                    }
                                    row.Cells.Add(comboCellCreditCard);
                                    if (!rdrSettlement.IsDBNull(14)) row.Cells.Add(new CalendarCell { Value = DateTime.Parse(rdrSettlement.GetDateTime(14).ToString("MM/dd/yyyy")) });
                                    else row.Cells.Add(new CalendarCell { Value = String.Empty });
                                    if (!rdrSettlement.IsDBNull(15)) row.Cells.Add(new DataGridViewCheckBoxCell { Value = rdrSettlement.GetBoolean(15) });
                                    else row.Cells.Add(new DataGridViewCheckBoxCell { Value = false });
                                    break;
                                default:
                                    row.Cells.Add(new DataGridViewTextBoxCell { Value = null });
                                    row.Cells.Add(new DataGridViewTextBoxCell { Value = null });
                                    DataGridViewComboBoxCell comboCellCreditCardNone = new DataGridViewComboBoxCell();
                                    for (int i = 0; i < lstCreditCardInfo.Count; i++)
                                    {
                                        if (lstCreditCardInfo[i].CreditCardNo != null) comboCellCreditCardNone.Items.Add(lstCreditCardInfo[i].CreditCardNo);
                                        else comboCellCreditCardNone.Items.Add(String.Empty);
                                    }
                                    row.Cells.Add(comboCellCreditCardNone);
                                    row.Cells.Add(new CalendarCell { Value = null });
                                    row.Cells.Add(new DataGridViewCheckBoxCell { Value = null });
                                    break;
                            }
                        }
                        else
                        {

                            DataGridViewTextBoxCell txtCheckNoCell = new DataGridViewTextBoxCell();
                            txtCheckNoCell.Value = null;
                            row.Cells.Add(txtCheckNoCell);
                            DataGridViewTextBoxCell txtACHNoCell = new DataGridViewTextBoxCell();
                            txtACHNoCell.Value = null;
                            row.Cells.Add(txtACHNoCell);
                            DataGridViewComboBoxCell comboCreditCardCell = new DataGridViewComboBoxCell();
                            for (int i = 0; i < lstCreditCardInfo.Count; i++)
                            {
                                if (lstCreditCardInfo[i].CreditCardNo != null) comboCreditCardCell.Items.Add(lstCreditCardInfo[i].CreditCardNo);
                                else comboCreditCardCell.Items.Add(String.Empty);
                            }
                            row.Cells.Add(comboCreditCardCell);
                            comboCreditCardCell.ReadOnly = true;
                            CalendarCell calPaymentDate = new CalendarCell();
                            calPaymentDate.Value = null;
                            row.Cells.Add(calPaymentDate);
                            DataGridViewCheckBoxCell chkReconciledCell = new DataGridViewCheckBoxCell();
                            chkReconciledCell.Value = false;
                            row.Cells.Add(chkReconciledCell);

                        }


                        if (!rdrSettlement.IsDBNull(16)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlement.GetDecimal(16).ToString("C") });
                        else row.Cells.Add(new DataGridViewTextBoxCell { Value = null });

                        if (!rdrSettlement.IsDBNull(17))
                        {
                            if (dicIneligibleReason.Count > 0)
                            {
                                DataGridViewComboBoxCell comboCellIneligibleReason = new DataGridViewComboBoxCell();
                                for (int i = 0; i < dicIneligibleReason.Count; i++)
                                {
                                    comboCellIneligibleReason.Items.Add(dicIneligibleReason[i]);
                                }
                                //comboCellIneligibleReason.Sorted = true;
                                comboCellIneligibleReason.Value = comboCellIneligibleReason.Items[rdrSettlement.GetInt32(17)];
                                row.Cells.Add(comboCellIneligibleReason);
                            }
                        }
                        else
                        {
                            if (dicIneligibleReason.Count > 0)
                            {
                                DataGridViewComboBoxCell comboCellIneligibleReason = new DataGridViewComboBoxCell();
                                for (int i = 0; i < dicIneligibleReason.Count; i++)
                                {
                                    comboCellIneligibleReason.Items.Add(dicIneligibleReason[i]);
                                }
                                //comboCellIneligibleReason.Sorted = true;
                                comboCellIneligibleReason.Value = comboCellIneligibleReason.Items[0];
                                row.Cells.Add(comboCellIneligibleReason);
                            }
                        }

                        if (!rdrSettlement.IsDBNull(18)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlement.GetString(18) });
                        else row.Cells.Add(new DataGridViewTextBoxCell { Value = null });

                        gvSettlementsInMedBill.Rows.Add(row);
                        //AddNewRowToGVSettlementSafely(row);
                    }
                }
                rdrSettlement.Close();
                if (connRN4.State != ConnectionState.Closed) connRN4.Close();

                for (int i = 0; i < gvSettlementsInMedBill.Rows.Count; i++)
                {
                    gvSettlementsInMedBill["ApprovedDate", i].ReadOnly = true;
                }

                gvSettlementsInMedBill.Enabled = true;
                gvSettlementsInMedBill.Controls[0].Enabled = true;
                gvSettlementsInMedBill.Controls[1].Enabled = true;

                ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                ///
                for (int i = 0; i < gvSettlementsInMedBill.Rows.Count; i++)
                {
                    if (gvSettlementsInMedBill["PaymentMethod", i]?.Value?.ToString() == "Check")
                    {
                        gvSettlementsInMedBill.Rows[i].Cells["CheckNo"].ReadOnly = false;
                        gvSettlementsInMedBill.Rows[i].Cells["PaymentDate"].ReadOnly = false;
                        gvSettlementsInMedBill.Rows[i].Cells["Reconciled"].ReadOnly = false;
                        gvSettlementsInMedBill.Rows[i].Cells["ACHNo"].ReadOnly = true;
                        gvSettlementsInMedBill.Rows[i].Cells["CreditCard"].ReadOnly = true;
                    }

                    if (gvSettlementsInMedBill["PaymentMethod", i]?.Value?.ToString() == "ACH/Banking")
                    {
                        gvSettlementsInMedBill.Rows[i].Cells["ACHNo"].ReadOnly = false;
                        gvSettlementsInMedBill.Rows[i].Cells["PaymentDate"].ReadOnly = false;
                        gvSettlementsInMedBill.Rows[i].Cells["Reconciled"].ReadOnly = false;
                        gvSettlementsInMedBill.Rows[i].Cells["CheckNo"].ReadOnly = true;
                        gvSettlementsInMedBill.Rows[i].Cells["CreditCard"].ReadOnly = true;
                    }

                    if (gvSettlementsInMedBill["PaymentMethod", i]?.Value?.ToString() == "Credit Card")
                    {
                        gvSettlementsInMedBill.Rows[i].Cells["CreditCard"].ReadOnly = false;
                        gvSettlementsInMedBill.Rows[i].Cells["PaymentDate"].ReadOnly = false;
                        gvSettlementsInMedBill.Rows[i].Cells["Reconciled"].ReadOnly = false;
                        gvSettlementsInMedBill.Rows[i].Cells["CheckNo"].ReadOnly = true;
                        gvSettlementsInMedBill.Rows[i].Cells["ACHNo"].ReadOnly = true;
                    }
                    if (gvSettlementsInMedBill["PaymentMethod", i]?.Value == null)
                    {
                        gvSettlementsInMedBill.Rows[i].Cells["CheckNo"].ReadOnly = true;
                        gvSettlementsInMedBill.Rows[i].Cells["ACHNo"].ReadOnly = true;
                        gvSettlementsInMedBill.Rows[i].Cells["CreditCard"].ReadOnly = true;
                        gvSettlementsInMedBill.Rows[i].Cells["PaymentDate"].ReadOnly = true;
                        gvSettlementsInMedBill.Rows[i].Cells["Reconciled"].ReadOnly = true;
                    }
                }

                for (int i = 0; i < gvSettlementsInMedBill.Rows.Count; i++)
                {
                    if (gvSettlementsInMedBill[2, i]?.Value?.ToString() == "Ineligible") gvSettlementsInMedBill.Rows[i].DefaultCellStyle.BackColor = Color.Salmon;
                    else
                    {
                        gvSettlementsInMedBill["IneligibleReason", i].Value = null;
                        gvSettlementsInMedBill["IneligibleReason", i].ReadOnly = true;
                    }
                }

                if (txtMedBillAmount.Text.Trim() != String.Empty)
                {
                    Decimal SettlementTotal = 0;
                    Decimal Balance = 0;
                    Decimal Result = 0;
                    Decimal BillAmount = 0;
                    if (Decimal.TryParse(txtMedBillAmount.Text.Trim(), NumberStyles.Currency, new CultureInfo("en-US"), out Result))
                    {
                        BillAmount = Result;

                        for (int i = 0; i < gvSettlementsInMedBill.Rows.Count; i++)
                        {
                            if (gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() != "PR Reimbursement" &&
                                gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() != "Medical Provider Refund")
                            {
                                Decimal Settlement = Decimal.Parse(gvSettlementsInMedBill["SettlementAmount", i]?.Value?.ToString(), NumberStyles.Currency, new CultureInfo("en-US"));
                                SettlementTotal += Settlement;
                            }
                        }
                        if (SettlementTotal > BillAmount) MessageBox.Show("Settlement Total exceeds the Medical Bill Amount.", "Alert");
                        else
                        {
                            Balance = BillAmount - SettlementTotal;
                            txtBalance.Text = Balance.ToString("C");
                        }
                    }
                }

                Decimal TotalSharedAmount = 0;
                //if (gvSettlementsInMedBill.Rows.Count == 0) txtTotalSharedAmtMedBill.Text = TotalSharedAmount.ToString("C");
                txtTotalSharedAmtMedBill.Text = TotalSharedAmount.ToString("C");

                for (int i = 0; i < gvSettlementsInMedBill.Rows.Count; i++)
                {
                    Decimal SharedAmount = 0;
                    Decimal MedicalProviderRefund = 0;
                    Decimal result = 0;

                    if (gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "CMM Provider Payment" ||
                        gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "CMM Member Reimbursement" ||
                        gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "PR Reimbursement")
                    {
                        if (Decimal.TryParse(gvSettlementsInMedBill["SettlementAmount", i]?.Value?.ToString(), NumberStyles.Currency, new CultureInfo("en-US"), out result))
                        {
                            SharedAmount = result;
                            TotalSharedAmount += SharedAmount;
                            txtTotalSharedAmtMedBill.Text = TotalSharedAmount.ToString("C");
                        }
                    }
                    else if (gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "Medical Provider Refund")
                    {
                        if (Decimal.TryParse(gvSettlementsInMedBill["SettlementAmount", i]?.Value?.ToString(), NumberStyles.Currency, new CultureInfo("en-US"), out result))
                        {
                            MedicalProviderRefund = result;
                            TotalSharedAmount -= MedicalProviderRefund;
                            txtTotalSharedAmtMedBill.Text = TotalSharedAmount.ToString("C");
                        }
                    }
                }

                //PersonalResponsibilityAmountInMedBill

                Decimal PersonResponsibilityAmt = PersonalResponsibilityAmountInMedBill;
                Decimal PersonalResponsibilityBalance = PersonalResponsibilityAmountInMedBill;
                Decimal TotalPersonalResponsibilityShared = 0;

                for (int i = 0; i < gvSettlementsInMedBill.Rows.Count; i++)
                {
                    Decimal PersonalResponsibilityShared = 0;
                    Decimal result = 0;

                    if (gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "Self Pay Discount" ||
                        gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "3rd Party Discount" ||
                        gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "Member Payment")
                    {
                        if (Decimal.TryParse(gvSettlementsInMedBill["PersonalResponsibility", i]?.Value?.ToString(), NumberStyles.Currency, new CultureInfo("en-US"), out result))
                        {
                            PersonalResponsibilityShared = result;
                            TotalPersonalResponsibilityShared += PersonalResponsibilityShared;
                            PersonalResponsibilityBalance -= TotalPersonalResponsibilityShared;
                        }
                    }
                }

                txtPersonalResponsibility.Text = PersonalResponsibilityBalance.ToString("C");

                ///////////////////////////////////////////////////////////////////////////////////////////////////
                ///
                String strSqlQueryForTaskInMedBill = "select [dbo].[tbl_task].[Subject], [dbo].[tbl_task].[DueDate], [dbo].[tbl_user].[User_Name], " +
                                     "[dbo].[tbl_task_status_code].[TaskStatusValue], [dbo].[tbl_task].[id] " +
                                     "from [dbo].[tbl_task] " +
                                     "inner join [dbo].[tbl_user] on [dbo].[tbl_task].[AssignedTo] = [dbo].[tbl_user].[User_Id] " +
                                     "inner join [dbo].[tbl_task_status_code] on [dbo].[tbl_task].[Status] = [dbo].[tbl_task_status_code].[TaskStatusCode] " +
                                     "where ([dbo].[tbl_task].[IsDeleted] IS NULL or [dbo].[tbl_task].[IsDeleted] = 0) and " +
                                     "[dbo].[tbl_task].[whatid] = @MedBillNo " +
                                     "order by [dbo].[tbl_task].[CreateDate] desc";

                SqlCommand cmdQueryForTask = new SqlCommand(strSqlQueryForTaskInMedBill, connRN4);
                cmdQueryForTask.CommandType = CommandType.Text;

                cmdQueryForTask.Parameters.AddWithValue("@MedBillNo", MedBillNoForTask);

                SqlDependency dependencyTask = new SqlDependency(cmdQueryForTask);
                dependencyTask.OnChange += new OnChangeEventHandler(OnTaskInMedBillChange);

                if (connRN4.State != ConnectionState.Closed)
                {
                    connRN4.Close();
                    connRN4.Open();
                }
                else if (connRN4.State == ConnectionState.Closed) connRN4.Open();

                SqlDataReader rdrTaskForMedBill = cmdQueryForTask.ExecuteReader();
                gvMostRecentTasks.Rows.Clear();
                if (rdrTaskForMedBill.HasRows)
                {
                    while (rdrTaskForMedBill.Read())
                    {
                        DataGridViewRow row = new DataGridViewRow();
                        if (!rdrTaskForMedBill.IsDBNull(0)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrTaskForMedBill.GetString(0) });
                        else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                        if (!rdrTaskForMedBill.IsDBNull(1)) row.Cells.Add(new CalendarCell { Value = rdrTaskForMedBill.GetDateTime(1).ToString("MM/dd/yyyy") });
                        else row.Cells.Add(new CalendarCell { Value = String.Empty });
                        if (!rdrTaskForMedBill.IsDBNull(2)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrTaskForMedBill.GetString(2) });
                        else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                        if (!rdrTaskForMedBill.IsDBNull(3)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrTaskForMedBill.GetString(3) });
                        else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                        if (!rdrTaskForMedBill.IsDBNull(4)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrTaskForMedBill.GetInt32(4).ToString() });
                        else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                        gvMostRecentTasks.Rows.Add(row);
                    }
                }
                rdrTaskForMedBill.Close();

                if (connRN4.State == ConnectionState.Open) connRN4.Close();
                //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                ///

                EnableMedicalBillForm();
                gvMostRecentTasks.Enabled = true;
                gvMostRecentTasks.Controls[0].Enabled = true;
                gvMostRecentTasks.Controls[1].Enabled = true;

                btnMedBillCreatePgUpperSave.Enabled = true;



                // code ends here
                tbCMMManager.SelectedTab = tbpgMedicalBill;
            }
        }



        private void AddRowToPaidCheckReconcileSafely(DataGridViewRow row)
        {
            gvCheckReconcilation.BeginInvoke(new AddRowToPaidCheckReconcile(AddRowPaidCheckReconcile), row);
        }

        private void RemoveRowPaidCheckReconcileSafely(int nRow)
        {
            gvCheckReconcilation.BeginInvoke(new RemovePaidCheckReconcile(RemoveRowPaidCheckReconcile), nRow);
        }

        private void RemoveAllPaidCheckReconcileSafely()
        {
            gvCheckReconcilation.BeginInvoke(new RemoveAllPaidCheckReconcile(RemoveAllRowPaidCheckReconcile));
        }

        private void AddRowPaidCheckReconcile(DataGridViewRow row)
        {
            gvCheckReconcilation.Rows.Add(row);
        }

        private void RemoveRowPaidCheckReconcile(int i)
        {
            gvCheckReconcilation.Rows.RemoveAt(i);
        }

        private void RemoveAllRowPaidCheckReconcile()
        {
            gvCheckReconcilation.Rows.Clear();
        }

        private void OnPaidCheckForReconcileChange(object sender, SqlNotificationEventArgs e)
        {
            if (e.Type == SqlNotificationType.Change)
            {
                SqlDependency dependency = sender as SqlDependency;
                dependency.OnChange -= OnPaidCheckForReconcileChange;

                UpdateGridViewPaidCheckReconcile();
            }
        }

        private void UpdateGridViewPaidCheckReconcile()
        {
            //String strSqlQueryForPaidCheckForReconcile = "select [dbo].[tbl_settlement].[Name], [dbo].[tbl_settlement_type_code].[SettlementTypeValue], " +
            //                                             "[dbo].[tbl_settlement].[Amount], " +
            //                                             "[dbo].[tbl_medbill].[Individual_Id], [dbo].[tbl_settlement].[CheckNo], [dbo].[tbl_settlement].[CheckDate], " +
            //                                             "[dbo].[tbl_settlement].[Notes] " +
            //                                             "from [dbo].[tbl_settlement] " +
            //                                             "inner join [dbo].[tbl_settlement_type_code] on [dbo].[tbl_settlement].[settlementType] = [dbo].[tbl_settlement_type_code].[SettlementTypeCode] " +
            //                                             "inner join [dbo].[tbl_medbill] on [dbo].[tbl_settlement].[MedicalBillID] = [dbo].[tbl_medbill].[BillNo] " +
            //                                             "where [dbo].[tbl_settlement].[IsPaid] = 1 and " +
            //                                             "([dbo].[tbl_settlement_type_code].[SettlementTypeValue] = 'CMM Provider Payment' or " +
            //                                             "[dbo].[tbl_settlement_type_code].[SettlementTypeValue] = 'CMM Member Reimbursement' or " +
            //                                             "[dbo].[tbl_settlement_type_code].[SettlementTypeValue] = 'PR Reimbursement') and " +
            //                                             "[dbo].[tbl_settlement].[CheckNo] IS NOT NULL and [dbo].[tbl_settlement].[CheckDate] IS NOT NULL and " +
            //                                             "([dbo].[tbl_settlement].[IsDeleted] = 0 or [dbo].[tbl_settlement].[IsDeleted] IS NULL) " +
            //                                             "order by [dbo].[tbl_settlement].[CheckNo]";

            String strSqlQueryForPaidCheckForReconcile = "select [dbo].[tbl_settlement].[Name], [dbo].[tbl_settlement_type_code].[SettlementTypeValue], " +
                                             "[dbo].[tbl_settlement].[Amount], " +
                                             "[dbo].[tbl_medbill].[Individual_Id], [dbo].[tbl_settlement].[CheckNo], [dbo].[tbl_settlement].[CheckDate], " +
                                             "[dbo].[tbl_settlement].[Notes] " +
                                             "from [dbo].[tbl_settlement] " +
                                             "inner join [dbo].[tbl_settlement_type_code] on [dbo].[tbl_settlement].[settlementType] = [dbo].[tbl_settlement_type_code].[SettlementTypeCode] " +
                                             "inner join [dbo].[tbl_medbill] on [dbo].[tbl_settlement].[MedicalBillID] = [dbo].[tbl_medbill].[BillNo] " +
                                             "where [dbo].[tbl_settlement].[IsPaid] = 1 and " +
                                             "([dbo].[tbl_settlement_type_code].[SettlementTypeValue] = 'CMM Provider Payment' or " +
                                             "[dbo].[tbl_settlement_type_code].[SettlementTypeValue] = 'CMM Member Reimbursement' or " +
                                             "[dbo].[tbl_settlement_type_code].[SettlementTypeValue] = 'PR Reimbursement') and " +
                                             "([dbo].[tbl_settlement].[CheckNo] IS NOT NULL or [dbo].[tbl_settlement].[CheckNo] <> '') and " +
                                             "([dbo].[tbl_settlement].[CheckDate] IS NOT NULL or [dbo].[tbl_settlement].[CheckDate] <> '') and " +
                                             "([dbo].[tbl_settlement].[CheckReconciled] = 0 or [dbo].[tbl_settlement].[CheckReconciled] IS NULL) and " +
                                             "([dbo].[tbl_settlement].[IsDeleted] = 0 or [dbo].[tbl_settlement].[IsDeleted] IS NULL) " +
                                             "order by [dbo].[tbl_settlement].[CheckNo]";

            SqlCommand cmdQueryForPaidCheckForReconcile = new SqlCommand(strSqlQueryForPaidCheckForReconcile, connRN3);
            cmdQueryForPaidCheckForReconcile.CommandType = CommandType.Text;

            SqlDependency dependencyPaidCheckForReconcile = new SqlDependency(cmdQueryForPaidCheckForReconcile);
            dependencyPaidCheckForReconcile.OnChange += new OnChangeEventHandler(OnPaidCheckForReconcileChange);

            if (IsHandleCreated) RemoveAllPaidCheckReconcileSafely();
            else gvCheckReconcilation.Rows.Clear();
            if (connRN3.State != ConnectionState.Closed)
            {
                connRN3.Close();
                connRN3.Open();
            }
            else if (connRN3.State == ConnectionState.Closed) connRN3.Open();
            SqlDataReader rdrCheckPaidForReconcile = cmdQueryForPaidCheckForReconcile.ExecuteReader();
            if (rdrCheckPaidForReconcile.HasRows)
            {
                while (rdrCheckPaidForReconcile.Read())
                {
                    DataGridViewRow row = new DataGridViewRow();
                    row.Cells.Add(new DataGridViewCheckBoxCell { Value = false });
                    //if (!rdrCheckPaidForReconcile.IsDBNull(0)) row.Cells.Add(new DataGridViewCheckBoxCell { Value = rdrCheckPaidForReconcile.GetBoolean(0) });
                    if (!rdrCheckPaidForReconcile.IsDBNull(0)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrCheckPaidForReconcile.GetString(0) });
                    if (!rdrCheckPaidForReconcile.IsDBNull(1)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrCheckPaidForReconcile.GetString(1) });
                    if (!rdrCheckPaidForReconcile.IsDBNull(2)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrCheckPaidForReconcile.GetDecimal(2).ToString("C") });
                    if (!rdrCheckPaidForReconcile.IsDBNull(3)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrCheckPaidForReconcile.GetString(3) });
                    if (!rdrCheckPaidForReconcile.IsDBNull(4)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrCheckPaidForReconcile.GetString(4) });
                    if (!rdrCheckPaidForReconcile.IsDBNull(5)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrCheckPaidForReconcile.GetDateTime(5).ToString("MM/dd/yyyy") });
                    if (!rdrCheckPaidForReconcile.IsDBNull(6)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrCheckPaidForReconcile.GetString(6) });
                    if (IsHandleCreated) AddRowToPaidCheckReconcileSafely(row);
                    else gvCheckReconcilation.Rows.Add(row);
                }
            }
            if (connRN3.State != ConnectionState.Closed) connRN3.Close();
        }

        
        /// <summary>
        /// //////////////////////////////////////////////////////////////////////////////////////////////////////////////
        /// </summary>
        /// <param name="row"></param>
        /// 

        private void AddRowToBlueSheetListSafely(DataGridViewRow row)
        {
            gvBlueSheetList.BeginInvoke(new AddRowToBlueSheet(AddRowBlueSheetList), row);
        }

        private void RemoveRowBlueSheetListSafely(int nRow)
        {
            gvBlueSheetList.BeginInvoke(new RemoveBlueSheet(RemoveRowBlueSheetList), nRow);
        }

        private void RemoveAllBlueSheetListSafely()
        {
            gvBlueSheetList.BeginInvoke(new RemoveAllBlueSheet(RemoveAllRowBlueSheetList));
        }

        private void AddRowBlueSheetList(DataGridViewRow row)
        {
            gvBlueSheetList.Rows.Add(row);
        }

        private void RemoveRowBlueSheetList(int i)
        {
            gvBlueSheetList.Rows.RemoveAt(i);
        }

        private void RemoveAllRowBlueSheetList()
        {
            gvBlueSheetList.Rows.Clear();
        }

        private void OnBlueSheetForIndividualChange(object sender, SqlNotificationEventArgs e)
        {
            if (e.Type == SqlNotificationType.Change)
            {
                SqlDependency dependency = sender as SqlDependency;
                dependency.OnChange -= OnBlueSheetForIndividualChange;

                UpdateGridViewBlueSheetList();
            }
        }

        private void UpdateGridViewBlueSheetList()
        {
            String IndividualId = txtIndividualIDListBlueSheet.Text.Trim();

            String strSqlQueryForBlueSheetsForIndividual = "select [dbo].[tbl_bluesheet_type_code].[BlueSheetTypeValue], " +
                                               "[dbo].[tbl_bluesheet].[CheckNo], [dbo].[tbl_bluesheet].[ACH_No], [dbo].[tbl_bluesheet].[CreditCardNo], " +
                                               "[dbo].[tbl_bluesheet].[FileName], [dbo].[tbl_bluesheet].[IssueDate] " +
                                               "from [dbo].[tbl_bluesheet] " +
                                               "inner join [dbo].[tbl_bluesheet_type_code] on [dbo].[tbl_bluesheet].[BlueSheetType] = [dbo].[tbl_bluesheet_type_code].[BlueSheetTypeCode] " +
                                               "where [dbo].[tbl_bluesheet].[Individual_Id] = @IndividualId " +
                                               "order by [dbo].[tbl_bluesheet].[IssueDate]";

            SqlCommand cmdQueryForBlueSheetsForIndividual = new SqlCommand(strSqlQueryForBlueSheetsForIndividual, connRN7);
            cmdQueryForBlueSheetsForIndividual.CommandType = CommandType.Text;

            cmdQueryForBlueSheetsForIndividual.Parameters.AddWithValue("@IndividualId", IndividualId);

            SqlDependency dependencyBlueSheetForIndividual = new SqlDependency(cmdQueryForBlueSheetsForIndividual);
            dependencyBlueSheetForIndividual.OnChange += new OnChangeEventHandler(OnBlueSheetForIndividualChange);

            if (connRN7.State != ConnectionState.Closed)
            {
                connRN7.Close();
                connRN7.Open();
            }
            else if (connRN7.State == ConnectionState.Closed) connRN7.Open();
            if (IsHandleCreated) RemoveAllBlueSheetListSafely();
            else gvBlueSheetList.Rows.Clear();

            SqlDataReader rdrBlueSheetsForIndividual = cmdQueryForBlueSheetsForIndividual.ExecuteReader();
            if (rdrBlueSheetsForIndividual.HasRows)
            {
                while (rdrBlueSheetsForIndividual.Read())
                {
                    DataGridViewRow row = new DataGridViewRow();
                    if (!rdrBlueSheetsForIndividual.IsDBNull(0)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrBlueSheetsForIndividual.GetString(0) });
                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                    if (!rdrBlueSheetsForIndividual.IsDBNull(1)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrBlueSheetsForIndividual.GetString(1) });
                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                    if (!rdrBlueSheetsForIndividual.IsDBNull(2)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrBlueSheetsForIndividual.GetString(2) });
                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                    if (!rdrBlueSheetsForIndividual.IsDBNull(3)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrBlueSheetsForIndividual.GetString(3) });
                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                    if (!rdrBlueSheetsForIndividual.IsDBNull(4)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrBlueSheetsForIndividual.GetString(4) });
                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                    if (!rdrBlueSheetsForIndividual.IsDBNull(5)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrBlueSheetsForIndividual.GetDateTime(5).ToString("MM/dd/yyyy") });
                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });

                    if (IsHandleCreated) AddRowToBlueSheetListSafely(row);
                    else gvBlueSheetList.Rows.Add(row);
                }
            }
            if (connRN7.State != ConnectionState.Closed) connRN7.Close();

        }

        private void btnBlueSheetList_Click(object sender, EventArgs e)
        {
            String IndividualIdForBlueSheet = txtIndividualID.Text.Trim();
            txtIndividualIDListBlueSheet.Text = IndividualIdForBlueSheet;
            String IndividualName = txtLastName.Text.Trim() + ", " + txtFirstName.Text.Trim() + " " + txtMiddleName.Text.Trim();
            txtIndividualNameListBlueSheet.Text = IndividualName.Trim();

            String strSqlQueryForBlueSheetsForIndividual = "select [dbo].[tbl_bluesheet_type_code].[BlueSheetTypeValue], " +
                                                           "[dbo].[tbl_bluesheet].[CheckNo], [dbo].[tbl_bluesheet].[ACH_No], [dbo].[tbl_bluesheet].[CreditCardNo], " +
                                                           "[dbo].[tbl_bluesheet].[FileName], [dbo].[tbl_bluesheet].[IssueDate] " +
                                                           "from [dbo].[tbl_bluesheet] " +
                                                           "inner join [dbo].[tbl_bluesheet_type_code] on [dbo].[tbl_bluesheet].[BlueSheetType] = [dbo].[tbl_bluesheet_type_code].[BlueSheetTypeCode] " +
                                                           "where [dbo].[tbl_bluesheet].[Individual_Id] = @IndividualId " +
                                                           "order by [dbo].[tbl_bluesheet].[IssueDate]";

            SqlCommand cmdQueryForBlueSheetsForIndividual = new SqlCommand(strSqlQueryForBlueSheetsForIndividual, connRN7);
            cmdQueryForBlueSheetsForIndividual.CommandType = CommandType.Text;

            cmdQueryForBlueSheetsForIndividual.Parameters.AddWithValue("@IndividualId", IndividualIdForBlueSheet);

            SqlDependency dependencyBlueSheetForIndividual = new SqlDependency(cmdQueryForBlueSheetsForIndividual);
            dependencyBlueSheetForIndividual.OnChange += new OnChangeEventHandler(OnBlueSheetForIndividualChange);
            

            if (connRN7.State != ConnectionState.Closed)
            {
                connRN7.Close();
                connRN7.Open();
            }
            else if (connRN7.State == ConnectionState.Closed) connRN7.Open();
            gvBlueSheetList.Rows.Clear();
            SqlDataReader rdrBlueSheetsForIndividual = cmdQueryForBlueSheetsForIndividual.ExecuteReader();
            if (rdrBlueSheetsForIndividual.HasRows)
            {
                while (rdrBlueSheetsForIndividual.Read())
                {
                    DataGridViewRow row = new DataGridViewRow();
                    if (!rdrBlueSheetsForIndividual.IsDBNull(0)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrBlueSheetsForIndividual.GetString(0) });
                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                    if (!rdrBlueSheetsForIndividual.IsDBNull(1)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrBlueSheetsForIndividual.GetString(1) });
                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                    if (!rdrBlueSheetsForIndividual.IsDBNull(2)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrBlueSheetsForIndividual.GetString(2) });
                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                    if (!rdrBlueSheetsForIndividual.IsDBNull(3)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrBlueSheetsForIndividual.GetString(3) });
                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                    if (!rdrBlueSheetsForIndividual.IsDBNull(4)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrBlueSheetsForIndividual.GetString(4) });
                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                    if (!rdrBlueSheetsForIndividual.IsDBNull(5)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrBlueSheetsForIndividual.GetDateTime(5).ToString("MM/dd/yyyy") });
                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                    gvBlueSheetList.Rows.Add(row);
                }
            }
            if (connRN7.State != ConnectionState.Closed) connRN7.Close();

            tbCMMManager.SelectedTab = tbpgIndividualBlueSheet;
        }

        private void gvBlueSheetList_CellDoubleClick(object sender, DataGridViewCellEventArgs e)
        {
            DataGridView gvBlueSheet = sender as DataGridView;

            if (e.RowIndex > -1)
            {
                String BlueSheetFileName = gvBlueSheet["BlueSheetFileName", e.RowIndex]?.Value?.ToString();

                pdfBlueSheetViewer.src = BlueSheetFileName;
            }
        }

        private void gvMedBillSearched_CellDoubleClick(object sender, DataGridViewCellEventArgs e)
        {

            if (e.RowIndex <= -1) return;

            if (gvMedBillSearched.Rows.Count > 0)
            {
                InitializeMedBillTabOnNewMedBill();

                comboPendingReason.Items.Clear();
                if (dicPendingReason.Count > 0)
                {
                    for (int i = 0; i < dicPendingReason.Count; i++)
                    {
                        comboPendingReason.Items.Add(dicPendingReason[i]);
                    }
                    comboPendingReason.SelectedIndex = 0;
                }
                //comboPendingReason.Sorted = true;

                comboIneligibleReason.Items.Clear();
                if (dicIneligibleReason.Count > 0)
                {
                    for (int i = 0; i < dicIneligibleReason.Count; i++)
                    {
                        comboIneligibleReason.Items.Add(dicIneligibleReason[i]);
                    }
                    comboIneligibleReason.SelectedIndex = 0;
                }
                //comboIneligibleReason.Sorted = true;

                DataGridView gvMedBill = (DataGridView)sender;

                //String CaseId = gvMedBill["MedBill_CaseId", e.RowIndex]?.Value?.ToString();
                String CaseId = gvMedBill[5, e.RowIndex]?.Value?.ToString();
                String MedBillNo = gvMedBill[0, e.RowIndex]?.Value?.ToString();

                Boolean bMedBillInUse = false;

                String strSqlQueryForMedBillInUse = "select [dbo].[tbl_MedBillInUse].[BillNo], [dbo].[tbl_MedBillInUse].[EditingStaff] from [dbo].[tbl_MedBillInUse] " +
                    "where [dbo].[tbl_MedBillInUse].[BillNo] = @MedBillInUse";

                SqlCommand cmdQueryForMedBillInUse = new SqlCommand(strSqlQueryForMedBillInUse, connRN4);
                cmdQueryForMedBillInUse.CommandType = CommandType.Text;

                cmdQueryForMedBillInUse.Parameters.AddWithValue("@MedBillInUse", MedBillNo);

                if (connRN4.State != ConnectionState.Closed)
                {
                    connRN4.Close();
                    connRN4.Open();
                }
                else if (connRN4.State == ConnectionState.Closed) connRN4.Open();
                SqlDataReader rdrMedBillInUse = cmdQueryForMedBillInUse.ExecuteReader();
                if (rdrMedBillInUse.HasRows)
                {
                    rdrMedBillInUse.Read();
                    if (MedBillNo == rdrMedBillInUse.GetString(0).Trim() &&
                        nLoggedUserId != rdrMedBillInUse.GetInt16(1))
                    {
                        MessageBox.Show("The Medical Bill: " + MedBillNo + " is in use.", "Alert");
                        rdrMedBillInUse.Close();
                        if (connRN4.State != ConnectionState.Closed) connRN4.Close();
                        bMedBillInUse = true;
                        //return;
                    }
                }
                else
                {
                    rdrMedBillInUse.Close();
                    if (connRN4.State != ConnectionState.Closed) connRN.Close();

                    String strSqlInsertMedBillInUse = "insert into [dbo].[tbl_MedBillInUse] (BillNo, EditingStaff) values (@MedBillNo, @ModifyingStaff)";

                    SqlCommand cmdInsertMedBillInUse = new SqlCommand(strSqlInsertMedBillInUse, connRN4);
                    cmdInsertMedBillInUse.CommandType = CommandType.Text;

                    cmdInsertMedBillInUse.Parameters.AddWithValue("@MedBillNo", MedBillNo);
                    cmdInsertMedBillInUse.Parameters.AddWithValue("@ModifyingStaff", nLoggedUserId);

                    if (connRN4.State != ConnectionState.Closed)
                    {
                        connRN4.Close();
                        connRN4.Open();
                    }
                    else if (connRN4.State == ConnectionState.Closed) connRN4.Open();
                    int nMedBillInUseInserted = cmdInsertMedBillInUse.ExecuteNonQuery();
                    if (nMedBillInUseInserted != 1)
                    {
                        MessageBox.Show("Medical Bill in use: " + MedBillNo + " has not been inserted.", "Error");
                        if (connRN4.State != ConnectionState.Closed) connRN4.Close();
                        return;
                    }
                    if (connRN4.State != ConnectionState.Closed) connRN4.Close();
                }


                //PrevViewToMedicalBill = ViewPrevToMedBill.MedBillView;

                //String CaseId = gvMedBill[5, e.RowIndex]?.Value?.ToString();
                //String MedBillNo = gvMedBill[0, e.RowIndex]?.Value?.ToString();

                String strSqlQueryForIndividualId = "select [dbo].[tbl_medbill].[Individual_Id] from [dbo].[tbl_medbill] where [dbo].[tbl_medbill].[BillNo] = @MedBillNo";

                SqlCommand cmdQueryForIndividualId = new SqlCommand(strSqlQueryForIndividualId, connRN2);
                cmdQueryForIndividualId.CommandType = CommandType.Text;

                cmdQueryForIndividualId.Parameters.AddWithValue("@MedBillNo", MedBillNo);

                if (connRN2.State != ConnectionState.Closed)
                {
                    connRN2.Close();
                    connRN2.Open();
                }
                else if (connRN2.State == ConnectionState.Closed) connRN2.Open();
                Object objIndividualId = cmdQueryForIndividualId.ExecuteScalar();
                if (connRN2.State != ConnectionState.Closed) connRN2.Close();

                String IndividualId = objIndividualId?.ToString();
                String strCaseNameSelected = CaseId;

                String strPatientLastName = String.Empty;
                String strPatientFirstName = String.Empty;
                String strPatientMiddleName = String.Empty;
                String strDateOfBirth = String.Empty;
                String strSSN = String.Empty;
                String strStreetAddr = String.Empty;
                String strCity = String.Empty;
                String strState = String.Empty;
                String strZip = String.Empty;

                String strSqlQueryForPatientInfo = "select [dbo].[contact].[LastName], [dbo].[contact].[FirstName], [dbo].[contact].[MiddleName], " +
                                                   "[dbo].[contact].[Birthdate], [dbo].[contact].[Social_Security_Number__c], " +
                                                   "[dbo].[Account].[ShippingStreet], [dbo].[Account].[ShippingCity], [dbo].[Account].[ShippingState], [dbo].[Account].[ShippingPostalCode] " +
                                                   "from [dbo].[contact] " +
                                                   "inner join [dbo].[Account] on [dbo].[contact].[AccountId] = [dbo].[Account].[Id] " +
                                                   "where [dbo].[contact].[Individual_ID__c] = @IndividualId";

                SqlCommand cmdQueryForPatientInfo = new SqlCommand(strSqlQueryForPatientInfo, connSalesforce2);
                cmdQueryForPatientInfo.CommandType = CommandType.Text;

                cmdQueryForPatientInfo.Parameters.AddWithValue("@IndividualId", IndividualId);

                if (connSalesforce2.State != ConnectionState.Closed)
                {
                    connSalesforce2.Close();
                    connSalesforce2.Open();
                }
                else if (connSalesforce2.State == ConnectionState.Closed) connSalesforce2.Open();
                SqlDataReader rdrPatientInfo = cmdQueryForPatientInfo.ExecuteReader();
                if (rdrPatientInfo.HasRows)
                {
                    rdrPatientInfo.Read();
                    if (!rdrPatientInfo.IsDBNull(0)) strPatientLastName = rdrPatientInfo.GetString(0);
                    if (!rdrPatientInfo.IsDBNull(1)) strPatientFirstName = rdrPatientInfo.GetString(1);
                    if (!rdrPatientInfo.IsDBNull(2)) strPatientMiddleName = rdrPatientInfo.GetString(2);
                    if (!rdrPatientInfo.IsDBNull(3)) strDateOfBirth = rdrPatientInfo.GetDateTime(3).ToString("MM/dd/yyyy");
                    if (!rdrPatientInfo.IsDBNull(4)) strSSN = rdrPatientInfo.GetString(4);
                    if (!rdrPatientInfo.IsDBNull(5)) strStreetAddr = rdrPatientInfo.GetString(5);
                    if (!rdrPatientInfo.IsDBNull(6)) strCity = rdrPatientInfo.GetString(6);
                    if (!rdrPatientInfo.IsDBNull(7)) strState = rdrPatientInfo.GetString(7);
                    if (!rdrPatientInfo.IsDBNull(8)) strZip = rdrPatientInfo.GetString(8);
                }
                if (connSalesforce2.State != ConnectionState.Closed) connSalesforce2.Close();

                InitializeMedBillTabOnNewMedBill();

                //nRowSelected = gvProcessingCaseNo.CurrentCell.RowIndex;
                //String IndividualId = txtMedBillViewIndId.Text.Trim();

                txtIndividualIDMedBill.Text = IndividualId;

                if (strPatientMiddleName != String.Empty) txtPatientNameMedBill.Text = strPatientLastName + ", " + strPatientFirstName + " " + strPatientMiddleName;
                else txtPatientNameMedBill.Text = strPatientLastName + ", " + strPatientFirstName;

                txtMedBillDOB.Text = strDateOfBirth;
                txtMedBillSSN.Text = strSSN;
                txtMedBillAddress.Text = strStreetAddr + ", " + strCity + ", " + strState + " " + strZip;

                String strSqlQueryForIndividualPlan = "select [dbo].[program].[Name] from [dbo].[contact] " +
                                      "inner join [dbo].[program] on [dbo].[contact].[c4g_Plan__c] = [dbo].[program].[ID] " +
                                      "where [dbo].[contact].[Individual_ID__c] = @IndividualId";

                SqlCommand cmdQueryForIndividualPlan = new SqlCommand(strSqlQueryForIndividualPlan, connSalesforce3);
                cmdQueryForIndividualPlan.CommandType = CommandType.Text;

                cmdQueryForIndividualPlan.Parameters.AddWithValue("@IndividualId", IndividualId);

                if (connSalesforce3.State != ConnectionState.Closed)
                {
                    connSalesforce3.Close();
                    connSalesforce3.Open();
                }
                else if (connSalesforce3.State == ConnectionState.Closed) connSalesforce3.Open();
                Object objIndividualPlan = cmdQueryForIndividualPlan.ExecuteScalar();
                if (connSalesforce3.State != ConnectionState.Closed) connSalesforce3.Close();

                txtMemberProgram.Text = objIndividualPlan?.ToString();

                String strSqlQueryForCaseStatus = "select [dbo].[tbl_case_status_code].[CaseStatusValue] from [dbo].[tbl_case_status_code]";
                SqlCommand cmdQueryForCaseStatus = new SqlCommand(strSqlQueryForCaseStatus, connRN4);
                cmdQueryForCaseStatus.CommandType = CommandType.Text;

                if (connRN4.State != ConnectionState.Closed)
                {
                    connRN4.Close();
                    connRN4.Open();
                }
                else if (connRN4.State == ConnectionState.Closed) connRN4.Open();

                SqlDataReader rdrCaseStatus = cmdQueryForCaseStatus.ExecuteReader();
                cbCaseStatus.Items.Clear();
                if (rdrCaseStatus.HasRows)
                {
                    while (rdrCaseStatus.Read())
                    {
                        cbCaseStatus.Items.Add(rdrCaseStatus.GetString(0));
                    }
                }
                rdrCaseStatus.Close();
                if (connRN4.State != ConnectionState.Closed) connRN4.Close();



                String strSqlQueryForDocumentsInfo = "select [dbo].[tbl_case].[NPF_Form], [dbo].[tbl_case].[NPF_Receiv_Date], " +
                                         "[dbo].[tbl_case].[IB_Form], [dbo].[tbl_case].[IB_Receiv_Date], " +
                                         "[dbo].[tbl_case].[POP_Form], [dbo].[tbl_case].[POP_Receiv_Date], " +
                                         "[dbo].[tbl_case].[MedRec_Form], [dbo].[tbl_case].[MedRec_Receiv_Date], " +
                                         "[dbo].[tbl_case].[Unknown_Form], [dbo].[tbl_case].[Unknown_Receiv_Date] " +
                                         "from [dbo].[tbl_case] " +
                                         "where [dbo].[tbl_case].[Case_Name] = @CaseId and " +
                                         "[dbo].[tbl_case].[Contact_ID] = @IndividualId and " +
                                         "[dbo].[tbl_case].[IsDeleted] = 0";

                SqlCommand cmdQueryForDocInfo = new SqlCommand(strSqlQueryForDocumentsInfo, connRN4);
                cmdQueryForDocInfo.CommandType = CommandType.Text;

                cmdQueryForDocInfo.Parameters.AddWithValue("@CaseId", CaseId);
                cmdQueryForDocInfo.Parameters.AddWithValue("@IndividualId", IndividualId);

                //if (connRN.State == ConnectionState.Closed) connRN.Open();
                if (connRN4.State != ConnectionState.Closed)
                {
                    connRN4.Close();
                    connRN4.Open();
                }
                else if (connRN4.State == ConnectionState.Closed) connRN4.Open();
                SqlDataReader rdrDocInfo = cmdQueryForDocInfo.ExecuteReader();
                if (rdrDocInfo.HasRows)
                {
                    rdrDocInfo.Read();

                    if (!rdrDocInfo.IsDBNull(0))
                    {
                        if (rdrDocInfo.GetBoolean(0))
                        {
                            chkMedBillNPFReceived.Checked = true;
                            chkMedBillNPFReceived.Enabled = false;
                            dtpMedBillNPF.Text = rdrDocInfo.GetDateTime(1).ToString("MM/dd/yyyy");
                            dtpMedBillNPF.Enabled = false;
                            btnViewNPF.Enabled = true;
                        }
                        else
                        {
                            chkMedBillNPFReceived.Checked = false;
                            chkMedBillNPFReceived.Enabled = false;
                            dtpMedBillNPF.Format = DateTimePickerFormat.Custom;
                            dtpMedBillNPF.CustomFormat = " ";
                            dtpMedBillNPF.Enabled = false;
                            btnViewNPF.Enabled = false;
                        }
                    }
                    if (!rdrDocInfo.IsDBNull(2))
                    {
                        if (rdrDocInfo.GetBoolean(2))
                        {
                            chkMedBill_IBReceived.Checked = true;
                            chkMedBill_IBReceived.Enabled = false;
                            dtpMedBill_IB.Text = rdrDocInfo.GetDateTime(3).ToString("MM/dd/yyyy");
                            dtpMedBill_IB.Enabled = false;
                            btnViewIB.Enabled = true;
                        }
                        else
                        {
                            chkMedBill_IBReceived.Checked = false;
                            chkMedBill_IBReceived.Enabled = false;
                            dtpMedBill_IB.Format = DateTimePickerFormat.Custom;
                            dtpMedBill_IB.CustomFormat = " ";
                            dtpMedBill_IB.Enabled = false;
                            btnViewIB.Enabled = false;
                        }
                    }
                    if (!rdrDocInfo.IsDBNull(4))
                    {
                        if (rdrDocInfo.GetBoolean(4))
                        {
                            chkMedBillPOPReceived.Checked = true;
                            chkMedBillPOPReceived.Enabled = false;
                            dtpMedBillPOP.Text = rdrDocInfo.GetDateTime(5).ToString("MM/dd/yyyy");
                            dtpMedBillPOP.Enabled = false;
                            btnViewPoP.Enabled = true;
                        }
                        else
                        {
                            chkMedBillPOPReceived.Checked = false;
                            chkMedBillPOPReceived.Enabled = false;
                            dtpMedBillPOP.Format = DateTimePickerFormat.Custom;
                            dtpMedBillPOP.CustomFormat = " ";
                            dtpMedBillPOP.Enabled = false;
                            btnViewPoP.Enabled = false;
                        }
                    }
                    if (!rdrDocInfo.IsDBNull(6))
                    {
                        if (rdrDocInfo.GetBoolean(6))
                        {
                            chkMedRecordReceived.Checked = true;
                            chkMedRecordReceived.Enabled = false;
                            dtpMedBillMedRecord.Text = rdrDocInfo.GetDateTime(7).ToString("MM/dd/yyyy");
                            dtpMedBillMedRecord.Enabled = false;
                            btnViewMedRecord.Enabled = true;
                        }
                        else
                        {
                            chkMedRecordReceived.Checked = false;
                            chkMedRecordReceived.Enabled = false;
                            dtpMedBillMedRecord.Format = DateTimePickerFormat.Custom;
                            dtpMedBillMedRecord.CustomFormat = " ";
                            dtpMedBillMedRecord.Enabled = false;
                            btnViewMedRecord.Enabled = false;
                        }
                    }

                    if (!rdrDocInfo.IsDBNull(8))
                    {
                        if (rdrDocInfo.GetBoolean(8))
                        {
                            chkOtherDocReceived.Checked = true;
                            chkOtherDocReceived.Enabled = false;
                            dtpMedBillOtherDoc.Text = rdrDocInfo.GetDateTime(9).ToString("MM/dd/yyyy");
                            dtpMedBillOtherDoc.Enabled = false;
                            btnViewOtherDoc.Enabled = true;
                        }
                        else
                        {
                            chkOtherDocReceived.Checked = false;
                            chkOtherDocReceived.Enabled = false;
                            dtpMedBillOtherDoc.Format = DateTimePickerFormat.Custom;
                            dtpMedBillOtherDoc.CustomFormat = " ";
                            dtpMedBillOtherDoc.Enabled = false;
                            btnViewOtherDoc.Enabled = false;
                        }
                    }

                    //strCaseIdSelected = CaseNameInMedBill;
                    //strContactIdSelected = IndividualIdInMedBill;

                    strCaseIdSelected = CaseId;
                    strContactIdSelected = IndividualId;

                }
                rdrDocInfo.Close();
                if (connRN4.State != ConnectionState.Closed) connRN4.Close();

                //String CaseId = gvMedBill["MedBill_CaseId", e.RowIndex]?.Value?.ToString();

                //String strSqlQueryForMedBillEdit = "select [dbo].[tbl_medbill].[Case_Id], [dbo].[tbl_illness].[IllnessNo], [dbo].[tbl_incident].[IncidentNo], [dbo].[tbl_program].[ProgramName], " +
                //               "[dbo].[tbl_medbill].[BillNo], [dbo].[tbl_medbill].[MedBillType_Id], [dbo].[tbl_medbill].[BillStatus], [dbo].[tbl_medbill].[BillClosed], " +
                //               "[dbo].[tbl_medbill].[BillAmount], [dbo].[tbl_MedicalProvider].[Name], " +
                //               "[dbo].[tbl_medbill].[PrescriptionDrugName], [dbo].[tbl_medbill].[PrescriptionNo], [dbo].[tbl_medbill].[PrescriptionDescription], " +
                //               "[dbo].[tbl_medbill].[TotalNumberOfPhysicalTherapy], [dbo].[tbl_medbill].[PatientTypeId], " +
                //               "[dbo].[tbl_medbill].[BillDate], [dbo].[tbl_medbill].[DueDate], " +
                //               "[dbo].[tbl_medbill].[Account_At_Provider], [dbo].[tbl_medbill].[ProviderContactPerson], " +
                //               "[dbo].[tbl_medbill].[Note], " +
                //               "[dbo].[tbl_illness].[ICD_10_Id], " +
                //               "[dbo].[tbl_medbill].[PendingReason], [dbo].[tbl_medbill].[IneligibleReason], " +
                //               "[dbo].[tbl_medbill].[Account_At_Provider], [dbo].[tbl_medbill].[ProviderPhoneNumber], [dbo].[tbl_medbill].[ProviderContactPerson], " +
                //               "[dbo].[tbl_medbill].[ProposalLetterSentDate], [dbo].[tbl_medbill].[HIPPASentDate], [dbo].[tbl_medbill].[MedicalRecordDate], " +
                //               "[dbo].[tbl_medbill].[Illness_Id], [dbo].[tbl_medbill].[Incident_Id] " +
                //               "from [dbo].[tbl_medbill] " +
                //               "inner join [dbo].[tbl_illness] on [dbo].[tbl_medbill].[Illness_Id] = [dbo].[tbl_illness].[Illness_Id] " +
                //               "inner join [dbo].[tbl_incident] on [dbo].[tbl_medbill].[Incident_Id] = [dbo].[tbl_incident].[Incident_id] " +
                //               "inner join [dbo].[tbl_program] on [dbo].[tbl_incident].[Program_id] = [dbo].[tbl_program].[Program_Id] " +
                //               "inner join [dbo].[tbl_MedicalProvider] on [dbo].[tbl_medbill].[MedicalProvider_Id] = [dbo].[tbl_MedicalProvider].[ID] " +
                //               "where [dbo].[tbl_medbill].[BillNo] = @MedBillNo and " +
                //               "[dbo].[tbl_medbill].[Case_Id] = @CaseName and " +
                //               "[dbo].[tbl_medbill].[Contact_Id] = @IndividualId and" +
                //               "[dbo].[tbl_medbill].[IsDeleted] = 0";
                ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////




                ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                String strSqlQueryForMedBillEdit = "select [dbo].[tbl_medbill].[Case_Id], [dbo].[tbl_illness].[IllnessNo], [dbo].[tbl_incident].[IncidentNo], [dbo].[tbl_program].[ProgramName], " +
                                                   "[dbo].[tbl_medbill].[BillNo], [dbo].[tbl_medbill].[MedBillType_Id], [dbo].[tbl_medbill].[BillStatus], [dbo].[tbl_medbill].[BillClosed], " +
                                                   "[dbo].[tbl_medbill].[BillAmount], [dbo].[tbl_medbill].[MedicalProvider_Id], " +
                                                   "[dbo].[tbl_medbill].[PrescriptionDrugName], [dbo].[tbl_medbill].[PrescriptionNo], [dbo].[tbl_medbill].[PrescriptionDescription], " +
                                                   "[dbo].[tbl_medbill].[TotalNumberOfPhysicalTherapy], [dbo].[tbl_medbill].[PatientTypeId], " +
                                                   "[dbo].[tbl_medbill].[BillDate], [dbo].[tbl_medbill].[DueDate], " +
                                                   "[dbo].[tbl_medbill].[Account_At_Provider], [dbo].[tbl_medbill].[ProviderContactPerson], [dbo].[tbl_medbill].[ProviderPhoneNumber], " +
                                                   "[dbo].[tbl_medbill].[Note], " +
                                                   "[dbo].[tbl_illness].[ICD_10_Id], " +
                                                   "[dbo].[tbl_medbill].[PendingReason], [dbo].[tbl_medbill].[IneligibleReason], " +
                                                   "[dbo].[tbl_medbill].[ProposalLetterSentDate], [dbo].[tbl_medbill].[HIPPASentDate], [dbo].[tbl_medbill].[MedicalRecordDate], " +
                                                   "[dbo].[tbl_medbill].[Illness_Id], [dbo].[tbl_medbill].[Incident_Id], " +
                                                   "[dbo].[tbl_medbill].[NPF_Form], [dbo].[tbl_medbill].[NPF_SourceFileName], [dbo].[tbl_medbill].[NPF_DestinationFileName], " +
                                                   "[dbo].[tbl_medbill].[IB_Form], [dbo].[tbl_medbill].[IB_SourceFileName], [dbo].[tbl_medbill].[IB_DestinationFileName], " +
                                                   "[dbo].[tbl_medbill].[POP_Form], [dbo].[tbl_medbill].[POP_SourceFileName], [dbo].[tbl_medbill].[POP_DestinationFileName], " +
                                                   "[dbo].[tbl_medbill].[MedRec_Form], [dbo].[tbl_medbill].[MedRec_SourceFileName], [dbo].[tbl_medbill].[MedRec_DestinationFileName], " +
                                                   "[dbo].[tbl_medbill].[Unknown_Form], [dbo].[tbl_medbill].[Unknown_SourceFileName], [dbo].[tbl_medbill].[Unknown_DestinationFileName] " +
                                                   "from [dbo].[tbl_medbill] " +
                                                   "inner join [dbo].[tbl_illness] on [dbo].[tbl_medbill].[Illness_Id] = [dbo].[tbl_illness].[Illness_Id] " +
                                                   "inner join [dbo].[tbl_incident] on [dbo].[tbl_medbill].[Incident_Id] = [dbo].[tbl_incident].[Incident_id] " +
                                                   "inner join [dbo].[tbl_program] on [dbo].[tbl_incident].[Program_id] = [dbo].[tbl_program].[Program_Id] " +
                                                   "where [dbo].[tbl_medbill].[BillNo] = @MedBillNo and " +
                                                   "[dbo].[tbl_medbill].[Case_Id] = @CaseName and " +
                                                   "[dbo].[tbl_medbill].[Contact_Id] = @IndividualId and" +
                                                   "[dbo].[tbl_medbill].[IsDeleted] = 0";

                SqlCommand cmdQueryForMedBillEdit = new SqlCommand(strSqlQueryForMedBillEdit, connRN4);
                cmdQueryForMedBillEdit.CommandType = CommandType.Text;

                cmdQueryForMedBillEdit.Parameters.AddWithValue("@MedBillNo", MedBillNo);
                cmdQueryForMedBillEdit.Parameters.AddWithValue("@CaseName", CaseId);
                cmdQueryForMedBillEdit.Parameters.AddWithValue("@IndividualId", IndividualId);

                //if (connRN.State == ConnectionState.Closed) connRN.Open();
                if (connRN4.State != ConnectionState.Closed)
                {
                    connRN4.Close();
                    connRN4.Open();
                }
                else if (connRN4.State == ConnectionState.Closed) connRN4.Open();

                SqlDataReader rdrMedBillEdit = cmdQueryForMedBillEdit.ExecuteReader();

                MedicalBillInfoForList MedBillForEdit = new MedicalBillInfoForList();

                if (rdrMedBillEdit.HasRows)
                {
                    rdrMedBillEdit.Read();
                    if (!rdrMedBillEdit.IsDBNull(0)) MedBillForEdit.CaseId = rdrMedBillEdit.GetString(0).Trim();
                    if (!rdrMedBillEdit.IsDBNull(1)) MedBillForEdit.IllnessNo = rdrMedBillEdit.GetString(1).Trim();
                    if (!rdrMedBillEdit.IsDBNull(2)) MedBillForEdit.IncidentNo = rdrMedBillEdit.GetString(2).Trim();
                    if (!rdrMedBillEdit.IsDBNull(3)) MedBillForEdit.ProgramName = rdrMedBillEdit.GetString(3).Trim();
                    if (!rdrMedBillEdit.IsDBNull(4)) MedBillForEdit.MedBillNo = rdrMedBillEdit.GetString(4).Trim();
                    if (!rdrMedBillEdit.IsDBNull(5)) MedBillForEdit.MedBillTypeId = rdrMedBillEdit.GetInt16(5);
                    if (!rdrMedBillEdit.IsDBNull(6)) MedBillForEdit.MedBillStatusId = rdrMedBillEdit.GetInt16(6);
                    if (!rdrMedBillEdit.IsDBNull(7)) MedBillForEdit.bBillClosed = rdrMedBillEdit.GetBoolean(7);
                    if (!rdrMedBillEdit.IsDBNull(8)) MedBillForEdit.BillAmount = rdrMedBillEdit.GetDecimal(8);
                    if (!rdrMedBillEdit.IsDBNull(9)) MedBillForEdit.MedicalProviderId = rdrMedBillEdit.GetString(9);
                    if (!rdrMedBillEdit.IsDBNull(10)) MedBillForEdit.PrescriptionDrugName = rdrMedBillEdit.GetString(10);
                    if (!rdrMedBillEdit.IsDBNull(11)) MedBillForEdit.PrescriptionNo = rdrMedBillEdit.GetString(11);
                    if (!rdrMedBillEdit.IsDBNull(12)) MedBillForEdit.PrescriptionDescription = rdrMedBillEdit.GetString(12);
                    if (!rdrMedBillEdit.IsDBNull(13)) MedBillForEdit.TotalNumberOfPhysicalTherapy = rdrMedBillEdit.GetInt16(13);
                    if (!rdrMedBillEdit.IsDBNull(14)) MedBillForEdit.nPatientTypeId = rdrMedBillEdit.GetInt16(14);
                    if (!rdrMedBillEdit.IsDBNull(15)) MedBillForEdit.BillDate = rdrMedBillEdit.GetDateTime(15);
                    if (!rdrMedBillEdit.IsDBNull(16)) MedBillForEdit.ReceivedDate = rdrMedBillEdit.GetDateTime(16);
                    if (!rdrMedBillEdit.IsDBNull(17)) MedBillForEdit.AccountNoAtProvider = rdrMedBillEdit.GetString(17);
                    if (!rdrMedBillEdit.IsDBNull(18)) MedBillForEdit.ProviderContactPerson = rdrMedBillEdit.GetString(18);
                    if (!rdrMedBillEdit.IsDBNull(19)) MedBillForEdit.ProviderPhoneNumber = rdrMedBillEdit.GetString(19);
                    if (!rdrMedBillEdit.IsDBNull(20)) MedBillForEdit.Note = rdrMedBillEdit.GetString(20);
                    if (!rdrMedBillEdit.IsDBNull(21)) MedBillForEdit.ICD_10_Id = rdrMedBillEdit.GetString(21);
                    if (!rdrMedBillEdit.IsDBNull(22)) MedBillForEdit.nPendingReasonIndex = rdrMedBillEdit.GetInt32(22);
                    if (!rdrMedBillEdit.IsDBNull(23)) MedBillForEdit.nIneligibleReasonIndex = rdrMedBillEdit.GetInt32(23);
                    if (!rdrMedBillEdit.IsDBNull(24)) MedBillForEdit.ProposalLetterSentDate = rdrMedBillEdit.GetDateTime(24);
                    if (!rdrMedBillEdit.IsDBNull(25)) MedBillForEdit.HIPPASentDate = rdrMedBillEdit.GetDateTime(25);
                    if (!rdrMedBillEdit.IsDBNull(26)) MedBillForEdit.MedicalRecordDate = rdrMedBillEdit.GetDateTime(26);
                    if (!rdrMedBillEdit.IsDBNull(27)) MedBillForEdit.IllnessId = Int32.Parse(rdrMedBillEdit.GetString(27).Trim());
                    if (!rdrMedBillEdit.IsDBNull(28)) MedBillForEdit.IncidentId = Int32.Parse(rdrMedBillEdit.GetString(28).Trim());
                    if (!rdrMedBillEdit.IsDBNull(29)) MedBillForEdit.NPF_Form = rdrMedBillEdit.GetBoolean(29);
                    //if (!rdrMedBillEdit.IsDBNull(30)) MedBillForEdit.NPFormFileNameMedBill = rdrMedBillEdit.GetString(30);
                    if (!rdrMedBillEdit.IsDBNull(30)) MedBillForEdit.NPFSourceFilePathMedBill = rdrMedBillEdit.GetString(30);
                    if (!rdrMedBillEdit.IsDBNull(31)) MedBillForEdit.NPFDestinationFilePathMedbill = rdrMedBillEdit.GetString(31);
                    if (!rdrMedBillEdit.IsDBNull(32)) MedBillForEdit.IB_Form = rdrMedBillEdit.GetBoolean(32);
                    //if (!rdrMedBillEdit.IsDBNull(34)) MedBillForEdit.IBFileNameMedBill = rdrMedBillEdit.GetString(34);
                    if (!rdrMedBillEdit.IsDBNull(33)) MedBillForEdit.IBSourceFilePathMedBill = rdrMedBillEdit.GetString(33);
                    if (!rdrMedBillEdit.IsDBNull(34)) MedBillForEdit.IBDestinationFilePathMedBill = rdrMedBillEdit.GetString(34);
                    if (!rdrMedBillEdit.IsDBNull(35)) MedBillForEdit.PoP_Form = rdrMedBillEdit.GetBoolean(35);
                    //if (!rdrMedBillEdit.IsDBNull(38)) MedBillForEdit.PoPFileNameMedBill = rdrMedBillEdit.GetString(38);
                    if (!rdrMedBillEdit.IsDBNull(36)) MedBillForEdit.PoPSourceFilePathMedBill = rdrMedBillEdit.GetString(36);
                    if (!rdrMedBillEdit.IsDBNull(37)) MedBillForEdit.PoPDestinationFilePathMedBill = rdrMedBillEdit.GetString(37);
                    if (!rdrMedBillEdit.IsDBNull(38)) MedBillForEdit.MedRec_Form = rdrMedBillEdit.GetBoolean(38);
                    //if (!rdrMedBillEdit.IsDBNull(42)) MedBillForEdit.MedRecFileNameMedBill = rdrMedBillEdit.GetString(42);
                    if (!rdrMedBillEdit.IsDBNull(39)) MedBillForEdit.MedRecSourceFilePathMedBill = rdrMedBillEdit.GetString(39);
                    if (!rdrMedBillEdit.IsDBNull(40)) MedBillForEdit.MedRecDestiantionFilePathMedbill = rdrMedBillEdit.GetString(40);
                    if (!rdrMedBillEdit.IsDBNull(41)) MedBillForEdit.OtherDoc_Form = rdrMedBillEdit.GetBoolean(41);
                    //if (!rdrMedBillEdit.IsDBNull(46)) MedBillForEdit.OtherDocFileNameMedBill = rdrMedBillEdit.GetString(46);
                    if (!rdrMedBillEdit.IsDBNull(42)) MedBillForEdit.OtherDocSourceFilePathMedBill = rdrMedBillEdit.GetString(42);
                    if (!rdrMedBillEdit.IsDBNull(43)) MedBillForEdit.OtherDocDestinationFilePathMedBill = rdrMedBillEdit.GetString(43);

                }

                String strSqlQueryForMedicalProviderName = "select [dbo].[account].[Name] from [dbo].[account] where [dbo].[account].[Id] = @MedicalProviderId";

                SqlCommand cmdQueryForMedicalProviderName = new SqlCommand(strSqlQueryForMedicalProviderName, connSalesforce2);
                cmdQueryForMedicalProviderName.CommandType = CommandType.Text;

                cmdQueryForMedicalProviderName.Parameters.AddWithValue("@MedicalProviderId", MedBillForEdit.MedicalProviderId);

                if (connSalesforce2.State != ConnectionState.Closed)
                {
                    connSalesforce2.Close();
                    connSalesforce2.Open();
                }
                else if (connSalesforce2.State == ConnectionState.Closed) connSalesforce2.Open();
                Object objMedicalProviderName = cmdQueryForMedicalProviderName.ExecuteScalar();
                if (connSalesforce2.State == ConnectionState.Open) connSalesforce2.Close();

                if (objMedicalProviderName != null) MedBillForEdit.MedicalProviderName = objMedicalProviderName.ToString();

                //////////////////////////////////////////////////////////////////////////////////
                txtMedBill_CaseNo.Text = MedBillForEdit.CaseId;
                Illness.IllnessNo = MedBillForEdit.IllnessNo;
                txtMedBill_Illness.Text = MedBillForEdit.IllnessNo;
                Incident.IncidentNo = MedBillForEdit.IncidentNo;
                txtMedBill_Incident.Text = MedBillForEdit.IncidentNo;
                txtIncdProgram.Text = MedBillForEdit.ProgramName;

                chkNPFMedBill.Checked = MedBillForEdit.NPF_Form;
                chkIBMedBill.Checked = MedBillForEdit.IB_Form;
                chkPoPMedBill.Checked = MedBillForEdit.PoP_Form;
                chkMedRecMedBill.Checked = MedBillForEdit.MedRec_Form;
                chkOtherDocMedBill.Checked = MedBillForEdit.OtherDoc_Form;

                MedBillForEdit.NPFormFileNameMedBill = Path.GetFileName(MedBillForEdit.NPFSourceFilePathMedBill);
                MedBillForEdit.IBFileNameMedBill = Path.GetFileName(MedBillForEdit.IBSourceFilePathMedBill);
                MedBillForEdit.PoPFileNameMedBill = Path.GetFileName(MedBillForEdit.PoPSourceFilePathMedBill);
                MedBillForEdit.MedRecFileNameMedBill = Path.GetFileName(MedBillForEdit.MedRecSourceFilePathMedBill);
                MedBillForEdit.OtherDocFileNameMedBill = Path.GetFileName(MedBillForEdit.OtherDocSourceFilePathMedBill);

                txtNPFMedBillFileName.Text = MedBillForEdit.NPFormFileNameMedBill;
                txtIBMedBillFileName.Text = MedBillForEdit.IBFileNameMedBill;
                txtPoPMedBillFileName.Text = MedBillForEdit.PoPFileNameMedBill;
                txtMedRecMedBillFileName.Text = MedBillForEdit.MedRecFileNameMedBill;
                txtOtherDocMedBillFileName.Text = MedBillForEdit.OtherDocFileNameMedBill;

                strNPFormFileNameMedBill = MedBillForEdit.NPFormFileNameMedBill;
                strNPFSourceFilePathMedBill = MedBillForEdit.NPFSourceFilePathMedBill;
                strNPFDestinationFilePathMedBill = MedBillForEdit.NPFDestinationFilePathMedbill;

                strIBFileNameMedBill = MedBillForEdit.IBFileNameMedBill;
                strIBSourceFilePathMedBill = MedBillForEdit.IBSourceFilePathMedBill;
                strIBDestinationFilePathMedBill = MedBillForEdit.IBDestinationFilePathMedBill;

                strPoPFileNameMedBill = MedBillForEdit.PoPFileNameMedBill;
                strPoPSourceFilePathMedBill = MedBillForEdit.PoPSourceFilePathMedBill;
                strPoPDestinationFilePathMedBill = MedBillForEdit.PoPDestinationFilePathMedBill;

                strMedRecFileNameMedBill = MedBillForEdit.MedRecFileNameMedBill;
                strMedRecSourceFilePathMedBill = MedBillForEdit.MedRecSourceFilePathMedBill;
                strMedRecDestinationFilePathMedBill = MedBillForEdit.MedRecDestiantionFilePathMedbill;

                strOtherDocFileNameMedBill = MedBillForEdit.OtherDocFileNameMedBill;
                strOtherDocSourceFilePathMedBill = MedBillForEdit.OtherDocSourceFilePathMedBill;
                strOtherDocDestinationFilePathMedBill = MedBillForEdit.OtherDocDestinationFilePathMedBill;

                txtMedBillNo.Text = MedBillForEdit.MedBillNo;
                if (MedBillForEdit.MedBillTypeId != -1)
                {
                    comboMedBillType.Items.Clear();
                    for (int i = 1; i <= dicMedBillTypes.Count; i++)
                    {
                        comboMedBillType.Items.Add(dicMedBillTypes[i]);
                    }
                    comboMedBillType.SelectedIndex = MedBillForEdit.MedBillTypeId - 1;
                }
                if (MedBillForEdit.MedBillStatusId != -1)
                {
                    if (dicMedBillStatus.Count > 0)
                    {
                        comboMedBillStatus.Items.Clear();
                        for (int i = 0; i < dicMedBillStatus.Count; i++)
                        {
                            comboMedBillStatus.Items.Add(dicMedBillStatus[i]);
                        }
                        comboMedBillStatus.SelectedIndex = MedBillForEdit.MedBillStatusId;
                    }
                }

                if (MedBillForEdit.bBillClosed) cbMedBillClosed.SelectedIndex = 1;
                else cbMedBillClosed.SelectedIndex = 0;

                comboMedBillStatus.SelectedIndex = MedBillForEdit.MedBillStatusId;
                txtMedBillAmount.Text = MedBillForEdit.BillAmount.ToString("C");
                txtBalance.Text = MedBillForEdit.Balance.ToString("C");
                txtMedicalProvider.Text = MedBillForEdit.MedicalProviderName.Trim();

                txtNumberOfMedication.Text = MedBillForEdit.PrescriptionNo;
                txtPrescriptionName.Text = MedBillForEdit.PrescriptionDrugName.Trim();
                txtPrescriptionDescription.Text = MedBillForEdit.PrescriptionDescription;

                txtNumPhysicalTherapy.Text = MedBillForEdit.TotalNumberOfPhysicalTherapy.ToString();
                if (MedBillForEdit.nPatientTypeId == 0) rbOutpatient.Checked = true;
                else if (MedBillForEdit.nPatientTypeId == 1) rbInpatient.Checked = true;

                if (MedBillForEdit.BillDate.Value != null)
                {
                    dtpBillDate.Checked = true;
                    dtpBillDate.Text = MedBillForEdit.BillDate.Value.ToString("MM/dd/yyyy");
                }
                else
                {
                    dtpBillDate.Format = DateTimePickerFormat.Custom;
                    dtpBillDate.CustomFormat = " ";
                }

                if (MedBillForEdit.ReceivedDate.Value != null)
                {
                    dtpDueDate.Checked = true;
                    dtpDueDate.Text = MedBillForEdit.ReceivedDate.Value.ToString("MM/dd/yyyy");
                }
                else
                {
                    dtpDueDate.Format = DateTimePickerFormat.Custom;
                    dtpDueDate.Text = " ";
                }

                txtMedBillAccountNoAtProvider.Text = MedBillForEdit.AccountNoAtProvider;
                txtProviderContactPerson.Text = MedBillForEdit.ProviderContactPerson;
                txtMedProviderPhoneNo.Text = MedBillForEdit.ProviderPhoneNumber;


                if (MedBillForEdit.Note != String.Empty)
                {
                    if (comboMedBillType.SelectedIndex == 0) txtMedBillNote.Text = MedBillForEdit.Note;
                    if (comboMedBillType.SelectedIndex == 1) txtPrescriptionNote.Text = MedBillForEdit.Note;
                    if (comboMedBillType.SelectedIndex == 2) txtPhysicalTherapyRxNote.Text = MedBillForEdit.Note;
                }

                if (MedBillForEdit.ICD_10_Id != String.Empty) txtMedBill_ICD10Code.Text = MedBillForEdit.ICD_10_Id;
                //if ((comboMedBillType.SelectedIndex == 0) && (MedBillForEdit.nPendingReasonIndex != -1)) comboPendingReason.SelectedIndex = MedBillForEdit.nPendingReasonIndex;
                if (MedBillForEdit.nPendingReasonIndex != -1) comboPendingReason.SelectedIndex = MedBillForEdit.nPendingReasonIndex;
                //if ((comboMedBillType.SelectedIndex == 0) && (MedBillForEdit.nIneligibleReasonIndex != -1)) comboIneligibleReason.SelectedIndex = MedBillForEdit.nIneligibleReasonIndex;
                if (MedBillForEdit.nIneligibleReasonIndex != -1) comboIneligibleReason.SelectedIndex = MedBillForEdit.nIneligibleReasonIndex;

                if (comboMedBillType.SelectedIndex == 0 || comboMedBillType.SelectedIndex == 3)
                {
                    txtPrescriptionName.Text = String.Empty;
                    txtPrescriptionDescription.Text = String.Empty;
                    txtPrescriptionNote.Text = String.Empty;
                    txtNumberOfMedication.Text = String.Empty;

                    txtNumPhysicalTherapy.Text = String.Empty;
                    txtPhysicalTherapyRxNote.Text = String.Empty;
                }
                else if (comboMedBillType.SelectedIndex == 1)       // Medical Bill Type - Prescription
                {
                    txtNumPhysicalTherapy.Text = String.Empty;
                    txtPhysicalTherapyRxNote.Text = String.Empty;

                    rbInpatient.Checked = false;
                    rbOutpatient.Checked = false;

                    //comboPendingReason.SelectedIndex = 0;
                    //comboIneligibleReason.SelectedIndex = 0;

                    txtMedBillNote.Text = String.Empty;
                }
                else if (comboMedBillType.SelectedIndex == 2)       // Medical Bill Type - Physical Therapy
                {
                    txtPrescriptionName.Text = String.Empty;
                    txtPrescriptionDescription.Text = String.Empty;
                    txtPrescriptionNote.Text = String.Empty;
                    txtNumberOfMedication.Text = String.Empty;

                    rbInpatient.Checked = false;
                    rbOutpatient.Checked = false;

                    //comboPendingReason.SelectedIndex = 0;
                    //comboIneligibleReason.SelectedIndex = 0;

                    txtMedBillNote.Text = String.Empty;
                }

                if (MedBillForEdit.ProposalLetterSentDate != null)
                {
                    dtpProposalLetterSentDate.Checked = true;
                    dtpProposalLetterSentDate.Value = MedBillForEdit.ProposalLetterSentDate.Value;
                    dtpProposalLetterSentDate.Format = DateTimePickerFormat.Short;
                }
                if (MedBillForEdit.HIPPASentDate != null)
                {
                    dtpHippaSentDate.Checked = true;
                    dtpHippaSentDate.Value = MedBillForEdit.HIPPASentDate.Value;
                    dtpHippaSentDate.Format = DateTimePickerFormat.Short;
                }
                if (MedBillForEdit.MedicalRecordDate != null)
                {
                    dtpMedicalRecordDate.Checked = true;
                    dtpMedicalRecordDate.Value = MedBillForEdit.MedicalRecordDate.Value;
                    dtpMedicalRecordDate.Format = DateTimePickerFormat.Short;
                }

                if (MedBillForEdit.IllnessId != -1) Illness.IllnessId = MedBillForEdit.IllnessId.ToString();
                else Illness.IllnessId = String.Empty;
                if (MedBillForEdit.IncidentId != -1) Incident.IncidentId = MedBillForEdit.IncidentId.ToString();
                else Incident.IncidentId = String.Empty;

                /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                String ICD10Code = txtMedBill_ICD10Code.Text.Trim();

                String strSqlQueryForDiseaseName = "select [dbo].[ICD10 Code].[Name] from [dbo].[ICD10 Code] where [dbo].[ICD10 Code].[ICD10_CODE__C] = @ICD10Code";

                SqlCommand cmdQueryForDiseaseName = new SqlCommand(strSqlQueryForDiseaseName, connSalesforce);
                cmdQueryForDiseaseName.CommandType = CommandType.Text;

                cmdQueryForDiseaseName.Parameters.AddWithValue("@ICD10Code", ICD10Code);

                if (connSalesforce.State != ConnectionState.Closed)
                {
                    connSalesforce.Close();
                    connSalesforce.Open();
                }
                else if (connSalesforce.State == ConnectionState.Closed) connSalesforce.Open();

                Object objDiseaseName = cmdQueryForDiseaseName.ExecuteScalar();
                txtMedBillDiseaseName.Text = objDiseaseName?.ToString();
                if (connSalesforce.State == ConnectionState.Open) connSalesforce.Close();

                var srcMedicalProvider = new AutoCompleteStringCollection();

                for (int i = 0; i < lstMedicalProvider.Count; i++)
                {
                    srcMedicalProvider.Add(lstMedicalProvider[i].Name);
                }

                txtMedicalProvider.AutoCompleteMode = AutoCompleteMode.SuggestAppend;
                txtMedicalProvider.AutoCompleteSource = AutoCompleteSource.CustomSource;
                txtMedicalProvider.AutoCompleteCustomSource = srcMedicalProvider;

                /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                // Settlement

                lstPaymentMethod.Clear();
                String strSqlQueryForPaymentMethod = "select [dbo].[tbl_payment_method].[PaymentMethod_Id], [dbo].[tbl_payment_method].[PaymentMethod_Value] from [dbo].[tbl_payment_method] " +
                                                     "order by [dbo].[tbl_payment_method].[PaymentMethod_Value]";

                SqlCommand cmdQueryForPaymentMethod = new SqlCommand(strSqlQueryForPaymentMethod, connRN4);
                cmdQueryForPaymentMethod.CommandType = CommandType.Text;

                //if (connRN.State == ConnectionState.Closed) connRN.Open();
                if (connRN4.State != ConnectionState.Closed)
                {
                    connRN4.Close();
                    connRN4.Open();
                }
                else if (connRN4.State == ConnectionState.Closed) connRN4.Open();
                SqlDataReader rdrPaymentMethod = cmdQueryForPaymentMethod.ExecuteReader();
                if (rdrPaymentMethod.HasRows)
                {
                    while (rdrPaymentMethod.Read())
                    {
                        if (!rdrPaymentMethod.IsDBNull(1)) lstPaymentMethod.Add(new PaymentMethod { PaymentMethodId = rdrPaymentMethod.GetInt16(0), PaymentMethodValue = rdrPaymentMethod.GetString(1) });
                        else lstPaymentMethod.Add(new PaymentMethod { PaymentMethodId = rdrPaymentMethod.GetInt16(0), PaymentMethodValue = null });
                    }
                }
                rdrPaymentMethod.Close();
                if (connRN4.State != ConnectionState.Closed) connRN4.Close();

                // Retrieve credit card info
                lstCreditCardInfo.Clear();
                String strSqlQueryForCreditCardInfo = "select [dbo].[tbl_Credit_Card__c].[CreditCard_Id], [dbo].[tbl_Credit_Card__c].[Name] from [dbo].[tbl_Credit_Card__c]";

                SqlCommand cmdQueryForCreditCardInfo = new SqlCommand(strSqlQueryForCreditCardInfo, connRN4);
                cmdQueryForCreditCardInfo.CommandType = CommandType.Text;

                if (connRN4.State != ConnectionState.Closed)
                {
                    connRN4.Close();
                    connRN4.Open();
                }
                else if (connRN4.State == ConnectionState.Closed) connRN4.Open();

                SqlDataReader rdrCreditCardInfo = cmdQueryForCreditCardInfo.ExecuteReader();
                if (rdrCreditCardInfo.HasRows)
                {
                    while (rdrCreditCardInfo.Read())
                    {
                        if (!rdrCreditCardInfo.IsDBNull(1))
                            lstCreditCardInfo.Add(new CreditCardInfo { CreditCardId = rdrCreditCardInfo.GetInt16(0), CreditCardNo = rdrCreditCardInfo.GetString(1) });
                        else
                            lstCreditCardInfo.Add(new CreditCardInfo { CreditCardId = rdrCreditCardInfo.GetInt16(0), CreditCardNo = null });
                    }
                }
                rdrCreditCardInfo.Close();
                if (connRN4.State != ConnectionState.Closed) connRN4.Close();

                ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                String IncidentNo = txtMedBill_Incident.Text.Trim();
                String IndividualIdMedBill = txtCaseIndividualID.Text.Trim();

                String strSqlQueryForIncident = "select [dbo].[tbl_incident].[Program_id], [dbo].[tbl_program].[ProgramName], [dbo].[tbl_incident].[IsDeleted] " +
                                "from [dbo].[tbl_incident] " +
                                "inner join [dbo].[tbl_program] on [dbo].[tbl_incident].[Program_id] = [dbo].[tbl_program].[Program_Id] " +
                                "where [dbo].[tbl_incident].[Individual_id] = @IndividualId and " +
                                "[dbo].[tbl_incident].[IncidentNo] = @IncidentNo " +
                                "order by [dbo].[tbl_incident].[Program_id]";

                SqlCommand cmdQueryForIncident = new SqlCommand(strSqlQueryForIncident, connRN4);
                cmdQueryForIncident.CommandType = CommandType.Text;

                cmdQueryForIncident.Parameters.AddWithValue("@IndividualId", IndividualIdMedBill);
                cmdQueryForIncident.Parameters.AddWithValue("@IncidentNo", IncidentNo);

                if (connRN4.State != ConnectionState.Closed)
                {
                    connRN4.Close();
                    connRN4.Open();
                }
                else if (connRN4.State == ConnectionState.Closed) connRN4.Open();

                SqlDataReader rdrIncident = cmdQueryForIncident.ExecuteReader();
                lstIncidentProgramInfo.Clear();
                if (rdrIncident.HasRows)
                {
                    while (rdrIncident.Read())
                    {
                        if (!rdrIncident.IsDBNull(0) && !rdrIncident.IsDBNull(1))
                        {
                            IncidentProgramInfo incidentProgram = new IncidentProgramInfo(rdrIncident.GetBoolean(2), rdrIncident.GetInt16(0), rdrIncident.GetString(1).Trim());
                            lstIncidentProgramInfo.Add(incidentProgram);
                        }
                    }
                }
                rdrIncident.Close();
                if (connRN4.State == ConnectionState.Open) connRN4.Close();

                //String strSqlQueryForIncidentChange = "select [dbo].[tbl_incident_history].[Program_id], [dbo].[tbl_program].[ProgramName], [dbo].[tbl_incident_history].[IsDeleted] " +
                //                        "from [dbo].[tbl_incident_history] " +
                //                        "inner join [dbo].[tbl_program] on [dbo].[tbl_incident_history].[Program_id] = [dbo].[tbl_program].[Program_Id] " +
                //                        "where ([dbo].[tbl_incident_history].[Operation] = 2 or " +
                //                        "[dbo].[tbl_incident_history].[Operation] = 3 or " +
                //                        "[dbo].[tbl_incident_history].[Operation] = 4) and " +
                //                        "[dbo].[tbl_incident_history].[Individual_id] = @IndividualId and" +
                //                        "[dbo].[tbl_incident_history].[IncidentNo] = @IncidentNo " +
                //                        "order by [dbo].[tbl_incident_history].[Program_id]";

                //SqlCommand cmdQueryForIncidentChange = new SqlCommand(strSqlQueryForIncidentChange, connRN4);
                //cmdQueryForIncidentChange.CommandType = CommandType.Text;

                //cmdQueryForIncidentChange.Parameters.AddWithValue("@IndividualId", IndividualIdMedBill);
                //cmdQueryForIncidentChange.Parameters.AddWithValue("@IncidentNo", IncidentNo);

                //if (connRN4.State != ConnectionState.Closed)
                //{
                //    connRN4.Close();
                //    connRN4.Open();
                //}
                //else if (connRN4.State == ConnectionState.Closed) connRN4.Open();
                //SqlDataReader rdrIncidentChange = cmdQueryForIncidentChange.ExecuteReader();
                ////lstIncidentProgramInfo.Clear();
                //if (rdrIncidentChange.HasRows)
                //{
                //    while (rdrIncidentChange.Read())
                //    {
                //        if (!rdrIncidentChange.IsDBNull(0) && !rdrIncidentChange.IsDBNull(1))
                //        {
                //            IncidentProgramInfo incidentProgram = new IncidentProgramInfo(rdrIncidentChange.GetBoolean(2), rdrIncidentChange.GetInt16(0), rdrIncidentChange.GetString(1).Trim());
                //            lstIncidentProgramInfo.Add(incidentProgram);
                //        }
                //    }
                //}
                //rdrIncidentChange.Close();
                //if (connRN4.State == ConnectionState.Open) connRN4.Close();

                //foreach (IncidentProgramInfo incdInfo in lstIncidentProgramInfo)
                //{
                //    if (incdInfo.bIsDeleted == true)
                //    {
                //        MessageBox.Show("The Incident has been deleted. Personal Responsibility cannot be calculated.", "Error");
                //        lstIncidentProgramInfo.Clear();
                //    }
                //}

                //Boolean bBronze = false;
                //Boolean bSilver = false;
                //Boolean bGold = false;
                //Boolean bGoldPlus = false;
                //Boolean bGoldMed1 = false;
                //Boolean bGoldMed2 = false;

                //if (lstIncidentProgramInfo.Count > 0)
                //{
                //    foreach (IncidentProgramInfo incidentInfo in lstIncidentProgramInfo)
                //    {
                //        if ((incidentInfo.IncidentProgramId == 3) &&
                //            (incidentInfo.bIsDeleted == false))
                //        {
                //            incidentInfo.bPersonalResponsibilityProgram = true;
                //            bBronze = true;
                //            break;
                //        }
                //    }

                //    foreach (IncidentProgramInfo incidentInfo in lstIncidentProgramInfo)
                //    {
                //        if ((incidentInfo.IncidentProgramId == 2) &&
                //            (bBronze == false) &&
                //            (incidentInfo.bIsDeleted == false))
                //        {
                //            incidentInfo.bPersonalResponsibilityProgram = true;
                //            bSilver = true;
                //            break;
                //        }
                //    }

                //    foreach (IncidentProgramInfo incidentInfo in lstIncidentProgramInfo)
                //    {
                //        if ((incidentInfo.IncidentProgramId == 1) &&
                //            (bBronze == false) &&
                //            (bSilver == false) &&
                //            (incidentInfo.bIsDeleted == false))
                //        {
                //            incidentInfo.bPersonalResponsibilityProgram = true;
                //            break;
                //        }
                //    }

                //    foreach (IncidentProgramInfo incidentInfo in lstIncidentProgramInfo)
                //    {
                //        if ((incidentInfo.IncidentProgramId == 0) &&
                //            (bBronze == false) &&
                //            (bSilver == false) &&
                //            (bGold == false) &&
                //            (incidentInfo.bIsDeleted == false))
                //        {
                //            incidentInfo.bPersonalResponsibilityProgram = true;
                //            break;
                //        }
                //    }

                //    foreach (IncidentProgramInfo incidentInfo in lstIncidentProgramInfo)
                //    {
                //        if ((incidentInfo.IncidentProgramId == 4) &&
                //            (bBronze == false) &&
                //            (bSilver == false) &&
                //            (bGold == false) &&
                //            (bGoldPlus == false) &&
                //            (incidentInfo.bIsDeleted == false))
                //        {
                //            incidentInfo.bPersonalResponsibilityProgram = true;
                //            break;
                //        }
                //    }

                //    foreach (IncidentProgramInfo incidentInfo in lstIncidentProgramInfo)
                //    {
                //        if ((incidentInfo.IncidentProgramId == 5) &&
                //            (bBronze == false) &&
                //            (bSilver == false) &&
                //            (bGold == false) &&
                //            (bGoldPlus == false) &&
                //            (bGoldMed1 == false) &&
                //            (incidentInfo.bIsDeleted == false))
                //        {
                //            incidentInfo.bPersonalResponsibilityProgram = true;
                //            break;
                //        }
                //    }
                //}

                //foreach (IncidentProgramInfo incidentInfo in lstIncidentProgramInfo)
                //{
                //    if (incidentInfo.bPersonalResponsibilityProgram == true)
                //        PersonalResponsibilityAmountInMedBill = incidentInfo.PersonalResponsibilityAmount;
                //}

                /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                String strSqlQueryForSettlement = "select [dbo].[tbl_settlement].[Name], [dbo].[tbl_settlement_type_code].[SettlementTypeValue], [dbo].[tbl_settlement].[Amount], " +
                                                  "[dbo].[tbl_settlement].[PersonalResponsibilityCredit], [dbo].[tbl_payment_method].[PaymentMethod_Value], " +
                                                  "[dbo].[tbl_settlement].[Approved], [dbo].[tbl_settlement].[ApprovedDate], " +
                                                  "[dbo].[tbl_settlement].[CheckNo], [dbo].[tbl_settlement].[CheckDate], [dbo].[tbl_settlement].[CheckReconciled], " +
                                                  "[dbo].[tbl_settlement].[ACH_Number], [dbo].[tbl_settlement].[ACH_Date], [dbo].[tbl_settlement].[ACH_Reconciled], " +
                                                  "[dbo].[tbl_Credit_Card__c].[Name], [dbo].[tbl_settlement].[CMMCreditCardPaidDate], [dbo].[tbl_settlement].[CC_Reconciled], " +
                                                  "[dbo].[tbl_settlement].[AllowedAmount], [dbo].[tbl_settlement].[IneligibleReason], " +
                                                  "[dbo].[tbl_settlement].[Notes] " +
                                                  "from [dbo].[tbl_settlement] inner join [dbo].[tbl_settlement_type_code] " +
                                                  "on [dbo].[tbl_settlement].[SettlementType] = [dbo].[tbl_settlement_type_code].[SettlementTypeCode] " +
                                                  "inner join [dbo].[tbl_payment_method] on [dbo].[tbl_settlement].[CMMPaymentMethod] = [dbo].[tbl_payment_method].[PaymentMethod_Id] " +
                                                  "inner join [dbo].[tbl_Credit_Card__c] on [dbo].[tbl_settlement].[CMMCreditCard] = [dbo].[tbl_Credit_Card__c].[CreditCard_Id]" +
                                                  "where [dbo].[tbl_settlement].[MedicalBillID] = @MedBillNo and " +
                                                  "[dbo].[tbl_settlement].[IsDeleted] = 0 " +
                                                  "order by [dbo].[tbl_settlement].[Name]";

                SqlCommand cmdQueryForSettlement = new SqlCommand(strSqlQueryForSettlement, connRN4);
                cmdQueryForSettlement.CommandType = CommandType.Text;

                cmdQueryForSettlement.Parameters.AddWithValue("@MedBillNo", MedBillNo);

                SqlDependency dependencySettlementInMedBill = new SqlDependency(cmdQueryForSettlement);
                dependencySettlementInMedBill.OnChange += new OnChangeEventHandler(OnSettlementsInMedBillEditChange);

                //if (connRN.State == ConnectionState.Closed) connRN.Open();
                if (connRN4.State != ConnectionState.Closed)
                {
                    connRN4.Close();
                    connRN4.Open();
                }
                else if (connRN4.State == ConnectionState.Closed) connRN4.Open();
                SqlDataReader rdrSettlement = cmdQueryForSettlement.ExecuteReader();
                gvSettlementsInMedBill.Rows.Clear();
                if (rdrSettlement.HasRows)
                {
                    while (rdrSettlement.Read())
                    {
                        DataGridViewRow row = new DataGridViewRow();
                        row.Cells.Add(new DataGridViewCheckBoxCell { Value = false });
                        if (!rdrSettlement.IsDBNull(0)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlement.GetString(0) });
                        if (!rdrSettlement.IsDBNull(1))
                        {
                            DataGridViewComboBoxCell comboCellSettlementType = new DataGridViewComboBoxCell();

                            for (int i = 0; i < lstSettlementType.Count; i++)
                            {
                                comboCellSettlementType.Items.Add(lstSettlementType[i].SettlementTypeValue);
                            }
                            for (int i = 0; i < comboCellSettlementType.Items.Count; i++)
                            {
                                if (rdrSettlement.GetString(1) == comboCellSettlementType.Items[i].ToString())
                                    comboCellSettlementType.Value = comboCellSettlementType.Items[i];
                            }

                            row.Cells.Add(comboCellSettlementType);
                        }
                        else
                        {
                            DataGridViewComboBoxCell comboCellSettlementType = new DataGridViewComboBoxCell();
                            for (int i = 0; i < lstSettlementType.Count; i++)
                            {
                                comboCellSettlementType.Items.Add(lstSettlementType[i].SettlementTypeValue);
                            }

                            for (int i = 0; i < comboCellSettlementType.Items.Count; i++)
                            {
                                if (rdrSettlement.GetString(1) == comboCellSettlementType.Items[i].ToString())
                                    comboCellSettlementType.Value = comboCellSettlementType.Items[i];
                            }

                            row.Cells.Add(comboCellSettlementType);
                        }

                        if (!rdrSettlement.IsDBNull(2)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlement.GetDecimal(2).ToString("C") });
                        else
                        {
                            Decimal Zero = 0;
                            row.Cells.Add(new DataGridViewTextBoxCell { Value = Zero.ToString("C") });
                        }


                        if (!rdrSettlement.IsDBNull(3)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlement.GetDecimal(3).ToString("C") });
                        else
                        {
                            Decimal Zero = 0;
                            row.Cells.Add(new DataGridViewTextBoxCell { Value = Zero.ToString("C") });
                        }

                        /////////////////////////////////////////////////////////////////////
                        if (!rdrSettlement.IsDBNull(4))
                        {
                            DataGridViewComboBoxCell comboCellPaymentMethod = new DataGridViewComboBoxCell();

                            for (int i = 0; i < lstPaymentMethod.Count; i++)
                            {
                                if (lstPaymentMethod[i].PaymentMethodValue != null) comboCellPaymentMethod.Items.Add(lstPaymentMethod[i].PaymentMethodValue);
                                else comboCellPaymentMethod.Items.Add(String.Empty);
                            }

                            for (int i = 0; i < comboCellPaymentMethod.Items.Count; i++)
                            {
                                if (rdrSettlement.GetString(4) == comboCellPaymentMethod.Items[i].ToString())
                                    comboCellPaymentMethod.Value = comboCellPaymentMethod.Items[i];
                            }

                            row.Cells.Add(comboCellPaymentMethod);
                        }
                        else
                        {
                            DataGridViewComboBoxCell comboCellPaymentMethod = new DataGridViewComboBoxCell();

                            for (int i = 0; i < lstPaymentMethod.Count; i++)
                            {
                                if (lstPaymentMethod[i].PaymentMethodValue != null) comboCellPaymentMethod.Items.Add(lstPaymentMethod[i].PaymentMethodValue);
                                else comboCellPaymentMethod.Items.Add(String.Empty);
                                //comboCellPaymentMethod.Items.Add(lstPaymentMethod[i].PaymentMethodValue);
                            }

                            for (int i = 0; i < comboCellPaymentMethod.Items.Count; i++)
                            {
                                if ((!rdrSettlement.IsDBNull(4)) && comboCellPaymentMethod.Items[i] != null)
                                {
                                    if (rdrSettlement.GetString(4) == comboCellPaymentMethod.Items[i].ToString())
                                        comboCellPaymentMethod.Value = comboCellPaymentMethod.Items[i];
                                }
                                else comboCellPaymentMethod.Value = null;
                            }

                            row.Cells.Add(comboCellPaymentMethod);

                        }

                        /////////////////////////////////////////////////////////////////////
                        ///
                        if (!rdrSettlement.IsDBNull(5))
                        {
                            DataGridViewCheckBoxCell approvedCell = new DataGridViewCheckBoxCell();
                            approvedCell.Value = rdrSettlement.GetBoolean(5);
                            approvedCell.Style.Alignment = DataGridViewContentAlignment.MiddleCenter;
                            row.Cells.Add(approvedCell);
                            if (LoggedInUserRole == UserRole.RNStaff ||
                                LoggedInUserRole == UserRole.NPStaff ||
                                LoggedInUserRole == UserRole.FDStaff ||
                                LoggedInUserRole == UserRole.MSStaff)
                                row.Cells[6].ReadOnly = true;
                            else if (LoggedInUserRole == UserRole.RNManager ||
                                     LoggedInUserRole == UserRole.NPManager ||
                                     LoggedInUserRole == UserRole.FDManager ||
                                     LoggedInUserRole == UserRole.MSManager ||
                                     LoggedInUserRole == UserRole.Administrator ||
                                     LoggedInUserRole == UserRole.SuperAdmin ||
                                     LoggedInUserRole == UserRole.Executive)
                                row.Cells[6].ReadOnly = false;
                        }
                        else
                        {
                            DataGridViewCheckBoxCell approvedCell = new DataGridViewCheckBoxCell();
                            approvedCell.Value = false;
                            approvedCell.Style.Alignment = DataGridViewContentAlignment.MiddleCenter;
                            row.Cells.Add(approvedCell);
                            if (LoggedInUserRole == UserRole.RNStaff ||
                                LoggedInUserRole == UserRole.NPStaff ||
                                LoggedInUserRole == UserRole.FDStaff ||
                                LoggedInUserRole == UserRole.MSStaff)
                                row.Cells[6].ReadOnly = true;
                            else if (LoggedInUserRole == UserRole.RNManager ||
                                     LoggedInUserRole == UserRole.NPManager ||
                                     LoggedInUserRole == UserRole.FDManager ||
                                     LoggedInUserRole == UserRole.MSManager ||
                                     LoggedInUserRole == UserRole.Administrator ||
                                     LoggedInUserRole == UserRole.SuperAdmin ||
                                     LoggedInUserRole == UserRole.Executive)
                                row.Cells[6].ReadOnly = false;
                        }

                        if (!rdrSettlement.IsDBNull(6))
                        {
                            row.Cells.Add(new CalendarCell { Value = DateTime.Parse(rdrSettlement.GetDateTime(6).ToString("MM/dd/yyyy")) });
                            row.Cells[7].ReadOnly = true;
                        }
                        else
                        {
                            row.Cells.Add(new CalendarCell { Value = null });
                            row.Cells[7].ReadOnly = true;
                        }

                        // Payment information
                        if (!rdrSettlement.IsDBNull(4))
                        {
                            String strPaymentMethod = rdrSettlement.GetString(4);

                            switch (strPaymentMethod)
                            {
                                case "Check":
                                    if (!rdrSettlement.IsDBNull(7)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlement.GetString(7) });
                                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = null });
                                    row.Cells.Add(new DataGridViewTextBoxCell { Value = null });
                                    DataGridViewComboBoxCell comboCellCreditCardNoneForCheck = new DataGridViewComboBoxCell();
                                    for (int i = 0; i < lstCreditCardInfo.Count; i++)
                                    {
                                        if (lstCreditCardInfo[i].CreditCardNo != null) comboCellCreditCardNoneForCheck.Items.Add(lstCreditCardInfo[i].CreditCardNo);
                                        else comboCellCreditCardNoneForCheck.Items.Add(String.Empty);
                                    }
                                    row.Cells.Add(comboCellCreditCardNoneForCheck);
                                    if (!rdrSettlement.IsDBNull(8))
                                    {
                                        row.Cells.Add(new CalendarCell { Value = DateTime.Parse(rdrSettlement.GetDateTime(8).ToString("MM/dd/yyyy")) });
                                    }
                                    else
                                    {
                                        row.Cells.Add(new CalendarCell { Value = String.Empty });
                                    }
                                    if (!rdrSettlement.IsDBNull(9))
                                    {
                                        row.Cells.Add(new DataGridViewCheckBoxCell { Value = rdrSettlement.GetBoolean(9) });
                                    }
                                    else
                                    {
                                        row.Cells.Add(new DataGridViewCheckBoxCell { Value = null });
                                    }
                                    break;
                                case "ACH/Banking":
                                    row.Cells.Add(new DataGridViewTextBoxCell { Value = null });
                                    if (!rdrSettlement.IsDBNull(10)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlement.GetString(10) });
                                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = null });
                                    DataGridViewComboBoxCell comboCellCreditCardNoneForACH = new DataGridViewComboBoxCell();
                                    for (int i = 0; i < lstCreditCardInfo.Count; i++)
                                    {
                                        if (lstCreditCardInfo[i].CreditCardNo != null)
                                            comboCellCreditCardNoneForACH.Items.Add(lstCreditCardInfo[i].CreditCardNo);
                                        else comboCellCreditCardNoneForACH.Items.Add(String.Empty);
                                    }
                                    row.Cells.Add(comboCellCreditCardNoneForACH);
                                    if (!rdrSettlement.IsDBNull(11))
                                    {
                                        row.Cells.Add(new CalendarCell { Value = DateTime.Parse(rdrSettlement.GetDateTime(11).ToString("MM/dd/yyyy")) });
                                    }
                                    else
                                    {
                                        row.Cells.Add(new CalendarCell { Value = String.Empty });
                                    }
                                    if (!rdrSettlement.IsDBNull(12))
                                    {
                                        row.Cells.Add(new DataGridViewCheckBoxCell { Value = rdrSettlement.GetBoolean(12) });
                                    }
                                    else
                                    {
                                        row.Cells.Add(new DataGridViewCheckBoxCell { Value = null });
                                    }
                                    break;
                                case "Credit Card":
                                    row.Cells.Add(new DataGridViewTextBoxCell { Value = null });
                                    row.Cells.Add(new DataGridViewTextBoxCell { Value = null });
                                    DataGridViewComboBoxCell comboCellCreditCard = new DataGridViewComboBoxCell();
                                    if (!rdrSettlement.IsDBNull(13))
                                    {
                                        for (int i = 0; i < lstCreditCardInfo.Count; i++)
                                        {
                                            if (lstCreditCardInfo[i].CreditCardNo != null) comboCellCreditCard.Items.Add(lstCreditCardInfo[i].CreditCardNo);
                                            else comboCellCreditCard.Items.Add(String.Empty);
                                        }
                                        for (int i = 0; i < comboCellCreditCard.Items.Count; i++)
                                        {
                                            if (rdrSettlement.GetString(13) == comboCellCreditCard.Items[i].ToString())
                                                comboCellCreditCard.Value = comboCellCreditCard.Items[i];
                                        }
                                    }
                                    else
                                    {
                                        //DataGridViewComboBoxCell comboCellCreditCard = new DataGridViewComboBoxCell();
                                        for (int i = 0; i < lstCreditCardInfo.Count; i++)
                                        {
                                            if (lstCreditCardInfo[i].CreditCardNo != null) comboCellCreditCard.Items.Add(lstCreditCardInfo[i].CreditCardNo);
                                            else comboCellCreditCard.Items.Add(String.Empty);
                                        }
                                        comboCellCreditCard.Value = String.Empty;
                                        //row.Cells.Add(comboCellCreditCard);
                                    }
                                    row.Cells.Add(comboCellCreditCard);
                                    if (!rdrSettlement.IsDBNull(14)) row.Cells.Add(new CalendarCell { Value = DateTime.Parse(rdrSettlement.GetDateTime(14).ToString("MM/dd/yyyy")) });
                                    else row.Cells.Add(new CalendarCell { Value = String.Empty });
                                    if (!rdrSettlement.IsDBNull(15)) row.Cells.Add(new DataGridViewCheckBoxCell { Value = rdrSettlement.GetBoolean(15) });
                                    else row.Cells.Add(new DataGridViewCheckBoxCell { Value = false });
                                    break;
                                default:
                                    row.Cells.Add(new DataGridViewTextBoxCell { Value = null });
                                    row.Cells.Add(new DataGridViewTextBoxCell { Value = null });
                                    DataGridViewComboBoxCell comboCellCreditCardNone = new DataGridViewComboBoxCell();
                                    for (int i = 0; i < lstCreditCardInfo.Count; i++)
                                    {
                                        if (lstCreditCardInfo[i].CreditCardNo != null) comboCellCreditCardNone.Items.Add(lstCreditCardInfo[i].CreditCardNo);
                                        else comboCellCreditCardNone.Items.Add(String.Empty);
                                    }
                                    row.Cells.Add(comboCellCreditCardNone);
                                    row.Cells.Add(new CalendarCell { Value = null });
                                    row.Cells.Add(new DataGridViewCheckBoxCell { Value = null });
                                    break;
                            }
                        }
                        else
                        {

                            DataGridViewTextBoxCell txtCheckNoCell = new DataGridViewTextBoxCell();
                            txtCheckNoCell.Value = null;
                            row.Cells.Add(txtCheckNoCell);
                            DataGridViewTextBoxCell txtACHNoCell = new DataGridViewTextBoxCell();
                            txtACHNoCell.Value = null;
                            row.Cells.Add(txtACHNoCell);
                            DataGridViewComboBoxCell comboCreditCardCell = new DataGridViewComboBoxCell();
                            for (int i = 0; i < lstCreditCardInfo.Count; i++)
                            {
                                if (lstCreditCardInfo[i].CreditCardNo != null) comboCreditCardCell.Items.Add(lstCreditCardInfo[i].CreditCardNo);
                                else comboCreditCardCell.Items.Add(String.Empty);
                            }
                            row.Cells.Add(comboCreditCardCell);
                            comboCreditCardCell.ReadOnly = true;
                            CalendarCell calPaymentDate = new CalendarCell();
                            calPaymentDate.Value = null;
                            row.Cells.Add(calPaymentDate);
                            DataGridViewCheckBoxCell chkReconciledCell = new DataGridViewCheckBoxCell();
                            chkReconciledCell.Value = false;
                            row.Cells.Add(chkReconciledCell);

                        }


                        if (!rdrSettlement.IsDBNull(16)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlement.GetDecimal(16).ToString("C") });
                        else row.Cells.Add(new DataGridViewTextBoxCell { Value = null });

                        if (!rdrSettlement.IsDBNull(17))
                        {
                            if (dicIneligibleReason.Count > 0)
                            {
                                DataGridViewComboBoxCell comboCellIneligibleReason = new DataGridViewComboBoxCell();
                                for (int i = 0; i < dicIneligibleReason.Count; i++)
                                {
                                    comboCellIneligibleReason.Items.Add(dicIneligibleReason[i]);
                                }
                                //comboCellIneligibleReason.Sorted = true;
                                comboCellIneligibleReason.Value = comboCellIneligibleReason.Items[rdrSettlement.GetInt32(17)];
                                row.Cells.Add(comboCellIneligibleReason);
                            }
                        }
                        else
                        {
                            if (dicIneligibleReason.Count > 0)
                            {
                                DataGridViewComboBoxCell comboCellIneligibleReason = new DataGridViewComboBoxCell();
                                for (int i = 0; i < dicIneligibleReason.Count; i++)
                                {
                                    comboCellIneligibleReason.Items.Add(dicIneligibleReason[i]);
                                }
                                //comboCellIneligibleReason.Sorted = true;
                                comboCellIneligibleReason.Value = comboCellIneligibleReason.Items[0];
                                row.Cells.Add(comboCellIneligibleReason);
                            }
                        }

                        if (!rdrSettlement.IsDBNull(18)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlement.GetString(18) });
                        else row.Cells.Add(new DataGridViewTextBoxCell { Value = null });

                        gvSettlementsInMedBill.Rows.Add(row);
                        //AddNewRowToGVSettlementSafely(row);
                    }
                }
                rdrSettlement.Close();
                if (connRN4.State != ConnectionState.Closed) connRN4.Close();

                for (int i = 0; i < gvSettlementsInMedBill.Rows.Count; i++)
                {
                    if (gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "3rd Party Discount" ||
                        gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "Member Payment" ||
                        gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "CMM Discount" ||
                        gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "Ineligible" ||
                        gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "Medical Provider Refund" ||
                        gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "Member Discount")
                    {
                        gvSettlementsInMedBill["Approved", i].Value = false;
                        gvSettlementsInMedBill["Approved", i].ReadOnly = true;
                    }


                    gvSettlementsInMedBill["ApprovedDate", i].ReadOnly = true;
                }

                ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                ///

                for (int i = 0; i < gvSettlementsInMedBill.Rows.Count; i++)
                {
                    if (gvSettlementsInMedBill["PaymentMethod", i]?.Value?.ToString() == "Check")
                    {
                        gvSettlementsInMedBill.Rows[i].Cells["CheckNo"].ReadOnly = false;
                        gvSettlementsInMedBill.Rows[i].Cells["PaymentDate"].ReadOnly = false;
                        gvSettlementsInMedBill.Rows[i].Cells["Reconciled"].ReadOnly = false;
                        gvSettlementsInMedBill.Rows[i].Cells["ACHNo"].ReadOnly = true;
                        gvSettlementsInMedBill.Rows[i].Cells["CreditCard"].ReadOnly = true;
                    }

                    if (gvSettlementsInMedBill["PaymentMethod", i]?.Value?.ToString() == "ACH/Banking")
                    {
                        gvSettlementsInMedBill.Rows[i].Cells["ACHNo"].ReadOnly = false;
                        gvSettlementsInMedBill.Rows[i].Cells["PaymentDate"].ReadOnly = false;
                        gvSettlementsInMedBill.Rows[i].Cells["Reconciled"].ReadOnly = false;
                        gvSettlementsInMedBill.Rows[i].Cells["CheckNo"].ReadOnly = true;
                        gvSettlementsInMedBill.Rows[i].Cells["CreditCard"].ReadOnly = true;
                    }

                    if (gvSettlementsInMedBill["PaymentMethod", i]?.Value?.ToString() == "Credit Card")
                    {
                        gvSettlementsInMedBill.Rows[i].Cells["CreditCard"].ReadOnly = false;
                        gvSettlementsInMedBill.Rows[i].Cells["PaymentDate"].ReadOnly = false;
                        gvSettlementsInMedBill.Rows[i].Cells["Reconciled"].ReadOnly = false;
                        gvSettlementsInMedBill.Rows[i].Cells["CheckNo"].ReadOnly = true;
                        gvSettlementsInMedBill.Rows[i].Cells["ACHNo"].ReadOnly = true;
                    }
                    if (gvSettlementsInMedBill["PaymentMethod", i]?.Value == null)
                    {
                        gvSettlementsInMedBill.Rows[i].Cells["CheckNo"].ReadOnly = true;
                        gvSettlementsInMedBill.Rows[i].Cells["ACHNo"].ReadOnly = true;
                        gvSettlementsInMedBill.Rows[i].Cells["CreditCard"].ReadOnly = true;
                        gvSettlementsInMedBill.Rows[i].Cells["PaymentDate"].ReadOnly = true;
                        gvSettlementsInMedBill.Rows[i].Cells["Reconciled"].ReadOnly = true;
                    }
                }

                for (int i = 0; i < gvSettlementsInMedBill.Rows.Count; i++)
                {
                    if (gvSettlementsInMedBill[2, i]?.Value?.ToString() == "Ineligible") gvSettlementsInMedBill.Rows[i].DefaultCellStyle.BackColor = Color.Salmon;
                    else
                    {
                        gvSettlementsInMedBill["IneligibleReason", i].Value = null;
                        gvSettlementsInMedBill["IneligibleReason", i].ReadOnly = true;
                    }
                }

                if (txtMedBillAmount.Text.Trim() != String.Empty)
                {
                    Decimal SettlementTotal = 0;
                    Decimal Balance = 0;
                    Decimal Result = 0;
                    Decimal BillAmount = 0;
                    if (Decimal.TryParse(txtMedBillAmount.Text.Trim(), NumberStyles.Currency, new CultureInfo("en-US"), out Result))
                    {
                        BillAmount = Result;

                        for (int i = 0; i < gvSettlementsInMedBill.Rows.Count; i++)
                        {
                            if (gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() != "PR Reimbursement" &&
                                gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() != "Medical Provider Refund")
                            {
                                Decimal Settlement = Decimal.Parse(gvSettlementsInMedBill["SettlementAmount", i]?.Value?.ToString(), NumberStyles.Currency, new CultureInfo("en-US"));
                                SettlementTotal += Settlement;
                            }
                        }
                        if (SettlementTotal > BillAmount) MessageBox.Show("Settlement Total exceeds the Medical Bill Amount.", "Alert");
                        else
                        {
                            Balance = BillAmount - SettlementTotal;
                            txtBalance.Text = Balance.ToString("C");
                        }
                    }
                }

                Decimal TotalSharedAmount = 0;
                //if (gvSettlementsInMedBill.Rows.Count == 0) txtTotalSharedAmtMedBill.Text = TotalSharedAmount.ToString("C");
                txtTotalSharedAmtMedBill.Text = TotalSharedAmount.ToString("C");

                for (int i = 0; i < gvSettlementsInMedBill.Rows.Count; i++)
                {
                    Decimal SharedAmount = 0;
                    Decimal MedicalProviderRefund = 0;
                    Decimal result = 0;

                    if (gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "CMM Provider Payment" ||
                        gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "CMM Member Reimbursement" ||
                        gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "PR Reimbursement")
                    {
                        if (Decimal.TryParse(gvSettlementsInMedBill["SettlementAmount", i].Value.ToString(), NumberStyles.Currency, new CultureInfo("en-US"), out result))
                        {
                            SharedAmount = result;
                            TotalSharedAmount += SharedAmount;
                            txtTotalSharedAmtMedBill.Text = TotalSharedAmount.ToString("C");
                        }
                    }
                    else if (gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "Medical Provider Refund")
                    {
                        if (Decimal.TryParse(gvSettlementsInMedBill["SettlementAmount", i]?.Value?.ToString(), NumberStyles.Currency, new CultureInfo("en-US"), out result))
                        {
                            MedicalProviderRefund = result;
                            TotalSharedAmount -= MedicalProviderRefund;
                            txtTotalSharedAmtMedBill.Text = TotalSharedAmount.ToString("C");
                        }
                    }
                }

                //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                ///

                Decimal PersonResponsibilityAmt = PersonalResponsibilityAmountInMedBill;
                Decimal PersonalResponsibilityBalance = PersonalResponsibilityAmountInMedBill;
                Decimal TotalPersonalResponsibilityShared = 0;

                for (int i = 0; i < gvSettlementsInMedBill.Rows.Count; i++)
                {
                    Decimal PersonalResponsibilityShared = 0;
                    Decimal result = 0;

                    if (gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "Self Pay Discount" ||
                        gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "3rd Party Discount" ||
                        gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "Member Payment")
                    {
                        if (Decimal.TryParse(gvSettlementsInMedBill["PersonalResponsibility", i]?.Value?.ToString(), NumberStyles.Currency, new CultureInfo("en-US"), out result))
                        {
                            PersonalResponsibilityShared = result;
                            TotalPersonalResponsibilityShared += PersonalResponsibilityShared;
                            PersonalResponsibilityBalance -= TotalPersonalResponsibilityShared;
                        }
                    }
                }

                txtPersonalResponsibility.Text = PersonalResponsibilityBalance.ToString("C");

                // Populate Task GridView

                MedBillNoForTask = gvMedBillSearched[0, e.RowIndex].Value.ToString();
                String strSqlQueryForTaskInMedBill = "select [dbo].[tbl_task].[Subject], [dbo].[tbl_task].[DueDate], [dbo].[tbl_user].[User_Name], [dbo].[tbl_task_status_code].[TaskStatusValue], " +
                                                     "[dbo].[tbl_task].[id] " +
                                                     "from [dbo].[tbl_task] " +
                                                     "inner join [dbo].[tbl_user] on [dbo].[tbl_task].[AssignedTo] = [dbo].[tbl_user].[User_Id] " +
                                                     "inner join [dbo].[tbl_task_status_code] on [dbo].[tbl_task].[Status] = [dbo].[tbl_task_status_code].[TaskStatusCode] " +
                                                     "where [dbo].[tbl_task].[whatid] = @MedBillNo " +
                                                     "order by [dbo].[tbl_task].[CreateDate] desc";

                SqlCommand cmdQueryForTask = new SqlCommand(strSqlQueryForTaskInMedBill, connRN4);
                cmdQueryForTask.CommandType = CommandType.Text;

                cmdQueryForTask.Parameters.AddWithValue("@MedBillNo", MedBillNoForTask);

                SqlDependency dependencyTask = new SqlDependency(cmdQueryForTask);
                dependencyTask.OnChange += new OnChangeEventHandler(OnTaskInMedBillChange);

                if (connRN4.State != ConnectionState.Closed)
                {
                    connRN4.Close();
                    connRN4.Open();
                }
                else if (connRN4.State == ConnectionState.Closed) connRN4.Open();

                SqlDataReader rdrTaskForMedBill = cmdQueryForTask.ExecuteReader();
                gvMostRecentTasks.Rows.Clear();
                if (rdrTaskForMedBill.HasRows)
                {
                    while (rdrTaskForMedBill.Read())
                    {
                        DataGridViewRow row = new DataGridViewRow();
                        if (!rdrTaskForMedBill.IsDBNull(0)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrTaskForMedBill.GetString(0) });
                        else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                        if (!rdrTaskForMedBill.IsDBNull(1)) row.Cells.Add(new CalendarCell { Value = rdrTaskForMedBill.GetDateTime(1).ToString("MM/dd/yyyy") });
                        else row.Cells.Add(new CalendarCell { Value = String.Empty });
                        if (!rdrTaskForMedBill.IsDBNull(2)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrTaskForMedBill.GetString(2) });
                        else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                        if (!rdrTaskForMedBill.IsDBNull(3)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrTaskForMedBill.GetString(3) });
                        else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                        if (!rdrTaskForMedBill.IsDBNull(4)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrTaskForMedBill.GetInt32(4).ToString() });
                        else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });

                        gvMostRecentTasks.Rows.Add(row);
                    }
                }
                rdrTaskForMedBill.Close();

                if (connRN4.State == ConnectionState.Open) connRN4.Close();


                btnMedBillCreatePgUpperSave.Enabled = true;
                //btnMedBillCreationPgLowerSave.Enabled = true;

                //if (bMedBillInUse)
                //{
                //    DisableMedicalBillForm();

                //    EnableGroupDocumentProcessingForViewing();
                //    EnableGroupMedBillDocumentsForViewing();

                //}

                tbCMMManager.SelectedTab = tbpgMedicalBill;

                if (LoggedInUserRole == UserRole.Administrator || LoggedInUserRole == UserRole.SuperAdmin)
                {
                    EnableMedicalBillForm();
                }

                if (LoggedInUserRole == UserRole.NPManager || LoggedInUserRole == UserRole.NPStaff)
                {
                    DisableMedicalBillForm();

                    EnableGroupDocumentProcessingForViewing();
                    EnableGroupMedBillDocumentsForViewing();
                }

                if (LoggedInUserRole == UserRole.FDManager || LoggedInUserRole == UserRole.FDStaff)
                {
                    DisableMedicalBillForm();

                    EnableGroupDocumentProcessingForViewing();
                    EnableGroupMedBillDocumentsForViewing();

                    if (bMedBillInUse == false)
                    {
                        gvSettlementsInMedBill.Enabled = true;

                        for (int i = 0; i < gvSettlementsInMedBill.Rows.Count; i++)
                        {
                            for (int j = 0; j < gvSettlementsInMedBill.Columns.Count; j++) gvSettlementsInMedBill[j, i].ReadOnly = true;
                        }

                        for (int i = 0; i < gvSettlementsInMedBill.Rows.Count; i++)
                        {
                            gvSettlementsInMedBill[8, i].ReadOnly = false;
                            gvSettlementsInMedBill[9, i].ReadOnly = false;
                            gvSettlementsInMedBill[10, i].ReadOnly = false;
                            gvSettlementsInMedBill[12, i].ReadOnly = false;
                            gvSettlementsInMedBill[15, i].ReadOnly = false;
                        }
                    }
                }

                if (LoggedInUserRole == UserRole.RNManager)
                {
                    if (bMedBillInUse)
                    {
                        DisableMedicalBillForm();

                        EnableGroupDocumentProcessingForViewing();
                        EnableGroupMedBillDocumentsForViewing();
                    }
                    else
                    {
                        EnableMedicalBillForm();

                        for (int i = 0; i < gvSettlementsInMedBill.Rows.Count; i++)
                        {
                            for (int j = 0; j < gvSettlementsInMedBill.Columns.Count; j++) gvSettlementsInMedBill[j, i].ReadOnly = true;
                        }

                        for (int i = 0; i < gvSettlementsInMedBill.Rows.Count; i++)
                        {
                            gvSettlementsInMedBill[0, i].ReadOnly = false;
                            gvSettlementsInMedBill[2, i].ReadOnly = false;
                            gvSettlementsInMedBill[3, i].ReadOnly = false;
                            gvSettlementsInMedBill[4, i].ReadOnly = false;
                            gvSettlementsInMedBill[5, i].ReadOnly = false;
                            gvSettlementsInMedBill[6, i].ReadOnly = false;
                            gvSettlementsInMedBill[14, i].ReadOnly = false;
                            gvSettlementsInMedBill[15, i].ReadOnly = false;
                        }

                    }
                }

                if (LoggedInUserRole == UserRole.RNStaff)
                {
                    if (bMedBillInUse)
                    {
                        DisableMedicalBillForm();

                        EnableGroupDocumentProcessingForViewing();
                        EnableGroupMedBillDocumentsForViewing();
                    }
                    else
                    {
                        EnableMedicalBillForm();

                        for (int i = 0; i < gvSettlementsInMedBill.Rows.Count; i++)
                        {
                            for (int j = 0; j < gvSettlementsInMedBill.Columns.Count; j++) gvSettlementsInMedBill[j, i].ReadOnly = true;
                        }

                        for (int i = 0; i < gvSettlementsInMedBill.Rows.Count; i++)
                        {
                            gvSettlementsInMedBill[0, i].ReadOnly = false;
                            gvSettlementsInMedBill[2, i].ReadOnly = false;
                            gvSettlementsInMedBill[3, i].ReadOnly = false;
                            gvSettlementsInMedBill[4, i].ReadOnly = false;
                            gvSettlementsInMedBill[5, i].ReadOnly = false;
                            gvSettlementsInMedBill[14, i].ReadOnly = false;
                            gvSettlementsInMedBill[15, i].ReadOnly = false;
                        }
                    }
                }

                //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                //if (!tbCMMManager.TabPages.Contains(tbpgMedicalBill))
                //{
                //    tbCMMManager.TabPages.Add(tbpgMedicalBill);
                //    tbCMMManager.SelectedTab = tbpgMedicalBill;
                //}
                //else
                //{
                //    MessageBox.Show("Medical Bill page is already open. Close Medical Bill page first.", "Alert");
                //    return;
                //}

                //if (LoggedInUserRole == UserRole.NPManager || LoggedInUserRole == UserRole.NPStaff)
                //{
                //    DisableMedicalBillForm();

                //    EnableGroupDocumentProcessingForViewing();
                //    EnableGroupMedBillDocumentsForViewing();
                //}

                //if (LoggedInUserRole == UserRole.FDManager || LoggedInUserRole == UserRole.FDStaff)
                //{
                //    DisableMedicalBillForm();

                //    EnableGroupDocumentProcessingForViewing();
                //    EnableGroupMedBillDocumentsForViewing();

                //    if (bMedBillInUse == false)
                //    {
                //        gvSettlementsInMedBill.Enabled = true;

                //        for (int i = 0; i < gvSettlementsInMedBill.Rows.Count; i++)
                //        {
                //            for (int j = 0; j < gvSettlementsInMedBill.Columns.Count; j++) gvSettlementsInMedBill[j, i].ReadOnly = true;
                //        }

                //        for (int i = 0; i < gvSettlementsInMedBill.Rows.Count; i++)
                //        {
                //            gvSettlementsInMedBill[8, i].ReadOnly = false;
                //            gvSettlementsInMedBill[9, i].ReadOnly = false;
                //            gvSettlementsInMedBill[10, i].ReadOnly = false;
                //            gvSettlementsInMedBill[12, i].ReadOnly = false;
                //            gvSettlementsInMedBill[15, i].ReadOnly = false;
                //        }
                //    }
                //}
            }



            //String MedBillNoSelected = gvMedBillSearched[0, e.RowIndex]?.Value?.ToString();

            //String strSqlQueryForCaseNo = "select [dbo].[tbl_medbill].[Case_Id] from [dbo].[tbl_medbill] where [dbo].[tbl_medbill].[BillNo] = @MedBillNo";

            //SqlCommand cmdQueryForCaseNo = new SqlCommand(strSqlQueryForCaseNo, connRN2);
            //cmdQueryForCaseNo.CommandType = CommandType.Text;

            //cmdQueryForCaseNo.Parameters.AddWithValue("@MedBillNo", MedBillNoSelected);

            //if (connRN2.State != ConnectionState.Closed)
            //{
            //    connRN2.Close();
            //    connRN2.Open();
            //}
            //else if (connRN2.State == ConnectionState.Closed) connRN2.Open();
            //Object objCaseId = cmdQueryForCaseNo.ExecuteScalar();
            //if (connRN2.State != ConnectionState.Closed) connRN2.Close();

            //String strCaseId = objCaseId?.ToString();

            //String strSqlQueryForCaseDetail = "select ";

        }

        private void gvSettlementSearched_CellDoubleClick(object sender, DataGridViewCellEventArgs e)
        {
            if (e.RowIndex <= -1) return;

            if (gvSettlementSearched.Rows.Count > 0)
            {
                InitializeMedBillTabOnNewMedBill();

                comboPendingReason.Items.Clear();
                if (dicPendingReason.Count > 0)
                {
                    for (int i = 0; i < dicPendingReason.Count; i++)
                    {
                        comboPendingReason.Items.Add(dicPendingReason[i]);
                    }
                    comboPendingReason.SelectedIndex = 0;
                }
                //comboPendingReason.Sorted = true;

                comboIneligibleReason.Items.Clear();
                if (dicIneligibleReason.Count > 0)
                {
                    for (int i = 0; i < dicIneligibleReason.Count; i++)
                    {
                        comboIneligibleReason.Items.Add(dicIneligibleReason[i]);
                    }
                    comboIneligibleReason.SelectedIndex = 0;
                }
                //comboIneligibleReason.Sorted = true;

                DataGridView gvSettlement = (DataGridView)sender;

                //String CaseId = gvMedBill["MedBill_CaseId", e.RowIndex]?.Value?.ToString();
                //String CaseId = gvSettlement[5, e.RowIndex]?.Value?.ToString();
                String MedBillNo = gvSettlement[1, e.RowIndex]?.Value?.ToString();
                //String CaseId = String.Empty;

                String strSqlQueryForCaseIdForMedBill = "select [dbo].[tbl_medbill].[Case_Id] from [dbo].[tbl_medbill] where [dbo].[tbl_medbill].[BillNo] = @MedBillNo";

                SqlCommand cmdQueryForCaseIdForMedBill = new SqlCommand(strSqlQueryForCaseIdForMedBill, connRN2);
                cmdQueryForCaseIdForMedBill.CommandType = CommandType.Text;

                cmdQueryForCaseIdForMedBill.Parameters.AddWithValue("@MedBillNo", MedBillNo);

                if (connRN2.State != ConnectionState.Closed)
                {
                    connRN2.Close();
                    connRN2.Open();
                }
                else if (connRN2.State == ConnectionState.Closed) connRN2.Open();
                Object objCaseId = cmdQueryForCaseIdForMedBill.ExecuteScalar();
                if (connRN2.State != ConnectionState.Closed) connRN2.Close();

                String CaseId = objCaseId?.ToString();

                Boolean bMedBillInUse = false;

                String strSqlQueryForMedBillInUse = "select [dbo].[tbl_MedBillInUse].[BillNo], [dbo].[tbl_MedBillInUse].[EditingStaff] from [dbo].[tbl_MedBillInUse] " +
                    "where [dbo].[tbl_MedBillInUse].[BillNo] = @MedBillInUse";

                SqlCommand cmdQueryForMedBillInUse = new SqlCommand(strSqlQueryForMedBillInUse, connRN4);
                cmdQueryForMedBillInUse.CommandType = CommandType.Text;

                cmdQueryForMedBillInUse.Parameters.AddWithValue("@MedBillInUse", MedBillNo);

                if (connRN4.State != ConnectionState.Closed)
                {
                    connRN4.Close();
                    connRN4.Open();
                }
                else if (connRN4.State == ConnectionState.Closed) connRN4.Open();
                SqlDataReader rdrMedBillInUse = cmdQueryForMedBillInUse.ExecuteReader();
                if (rdrMedBillInUse.HasRows)
                {
                    rdrMedBillInUse.Read();
                    if (MedBillNo == rdrMedBillInUse.GetString(0).Trim() &&
                        nLoggedUserId != rdrMedBillInUse.GetInt16(1))
                    {
                        MessageBox.Show("The Medical Bill: " + MedBillNo + " is in use.", "Alert");
                        rdrMedBillInUse.Close();
                        if (connRN4.State != ConnectionState.Closed) connRN4.Close();
                        bMedBillInUse = true;
                        //return;
                    }
                }
                else
                {
                    rdrMedBillInUse.Close();
                    if (connRN4.State != ConnectionState.Closed) connRN.Close();

                    String strSqlInsertMedBillInUse = "insert into [dbo].[tbl_MedBillInUse] (BillNo, EditingStaff) values (@MedBillNo, @ModifyingStaff)";

                    SqlCommand cmdInsertMedBillInUse = new SqlCommand(strSqlInsertMedBillInUse, connRN4);
                    cmdInsertMedBillInUse.CommandType = CommandType.Text;

                    cmdInsertMedBillInUse.Parameters.AddWithValue("@MedBillNo", MedBillNo);
                    cmdInsertMedBillInUse.Parameters.AddWithValue("@ModifyingStaff", nLoggedUserId);

                    if (connRN4.State != ConnectionState.Closed)
                    {
                        connRN4.Close();
                        connRN4.Open();
                    }
                    else if (connRN4.State == ConnectionState.Closed) connRN4.Open();
                    int nMedBillInUseInserted = cmdInsertMedBillInUse.ExecuteNonQuery();
                    if (nMedBillInUseInserted != 1)
                    {
                        MessageBox.Show("Medical Bill in use: " + MedBillNo + " has not been inserted.", "Error");
                        if (connRN4.State != ConnectionState.Closed) connRN4.Close();
                        return;
                    }
                    if (connRN4.State != ConnectionState.Closed) connRN4.Close();
                }


                //PrevViewToMedicalBill = ViewPrevToMedBill.MedBillView;

                //String CaseId = gvMedBill[5, e.RowIndex]?.Value?.ToString();
                //String MedBillNo = gvMedBill[0, e.RowIndex]?.Value?.ToString();

                String strSqlQueryForIndividualId = "select [dbo].[tbl_medbill].[Individual_Id] from [dbo].[tbl_medbill] where [dbo].[tbl_medbill].[BillNo] = @MedBillNo";

                SqlCommand cmdQueryForIndividualId = new SqlCommand(strSqlQueryForIndividualId, connRN2);
                cmdQueryForIndividualId.CommandType = CommandType.Text;

                cmdQueryForIndividualId.Parameters.AddWithValue("@MedBillNo", MedBillNo);

                if (connRN2.State != ConnectionState.Closed)
                {
                    connRN2.Close();
                    connRN2.Open();
                }
                else if (connRN2.State == ConnectionState.Closed) connRN2.Open();
                Object objIndividualId = cmdQueryForIndividualId.ExecuteScalar();
                if (connRN2.State != ConnectionState.Closed) connRN2.Close();

                String IndividualId = objIndividualId?.ToString();
                String strCaseNameSelected = CaseId;

                String strPatientLastName = String.Empty;
                String strPatientFirstName = String.Empty;
                String strPatientMiddleName = String.Empty;
                String strDateOfBirth = String.Empty;
                String strSSN = String.Empty;
                String strStreetAddr = String.Empty;
                String strCity = String.Empty;
                String strState = String.Empty;
                String strZip = String.Empty;

                String strSqlQueryForPatientInfo = "select [dbo].[contact].[LastName], [dbo].[contact].[FirstName], [dbo].[contact].[MiddleName], " +
                                                   "[dbo].[contact].[Birthdate], [dbo].[contact].[Social_Security_Number__c], " +
                                                   "[dbo].[Account].[ShippingStreet], [dbo].[Account].[ShippingCity], [dbo].[Account].[ShippingState], [dbo].[Account].[ShippingPostalCode] " +
                                                   "from [dbo].[contact] " +
                                                   "inner join [dbo].[Account] on [dbo].[contact].[AccountId] = [dbo].[Account].[Id] " +
                                                   "where [dbo].[contact].[Individual_ID__c] = @IndividualId";

                SqlCommand cmdQueryForPatientInfo = new SqlCommand(strSqlQueryForPatientInfo, connSalesforce2);
                cmdQueryForPatientInfo.CommandType = CommandType.Text;

                cmdQueryForPatientInfo.Parameters.AddWithValue("@IndividualId", IndividualId);

                if (connSalesforce2.State != ConnectionState.Closed)
                {
                    connSalesforce2.Close();
                    connSalesforce2.Open();
                }
                else if (connSalesforce2.State == ConnectionState.Closed) connSalesforce2.Open();
                SqlDataReader rdrPatientInfo = cmdQueryForPatientInfo.ExecuteReader();
                if (rdrPatientInfo.HasRows)
                {
                    rdrPatientInfo.Read();
                    if (!rdrPatientInfo.IsDBNull(0)) strPatientLastName = rdrPatientInfo.GetString(0);
                    if (!rdrPatientInfo.IsDBNull(1)) strPatientFirstName = rdrPatientInfo.GetString(1);
                    if (!rdrPatientInfo.IsDBNull(2)) strPatientMiddleName = rdrPatientInfo.GetString(2);
                    if (!rdrPatientInfo.IsDBNull(3)) strDateOfBirth = rdrPatientInfo.GetDateTime(3).ToString("MM/dd/yyyy");
                    if (!rdrPatientInfo.IsDBNull(4)) strSSN = rdrPatientInfo.GetString(4);
                    if (!rdrPatientInfo.IsDBNull(5)) strStreetAddr = rdrPatientInfo.GetString(5);
                    if (!rdrPatientInfo.IsDBNull(6)) strCity = rdrPatientInfo.GetString(6);
                    if (!rdrPatientInfo.IsDBNull(7)) strState = rdrPatientInfo.GetString(7);
                    if (!rdrPatientInfo.IsDBNull(8)) strZip = rdrPatientInfo.GetString(8);
                }
                if (connSalesforce2.State != ConnectionState.Closed) connSalesforce2.Close();

                InitializeMedBillTabOnNewMedBill();

                //nRowSelected = gvProcessingCaseNo.CurrentCell.RowIndex;
                //String IndividualId = txtMedBillViewIndId.Text.Trim();

                txtIndividualIDMedBill.Text = IndividualId;

                if (strPatientMiddleName != String.Empty) txtPatientNameMedBill.Text = strPatientLastName + ", " + strPatientFirstName + " " + strPatientMiddleName;
                else txtPatientNameMedBill.Text = strPatientLastName + ", " + strPatientFirstName;

                txtMedBillDOB.Text = strDateOfBirth;
                txtMedBillSSN.Text = strSSN;
                txtMedBillAddress.Text = strStreetAddr + ", " + strCity + ", " + strState + " " + strZip;

                String strSqlQueryForIndividualPlan = "select [dbo].[program].[Name] from [dbo].[contact] " +
                                      "inner join [dbo].[program] on [dbo].[contact].[c4g_Plan__c] = [dbo].[program].[ID] " +
                                      "where [dbo].[contact].[Individual_ID__c] = @IndividualId";

                SqlCommand cmdQueryForIndividualPlan = new SqlCommand(strSqlQueryForIndividualPlan, connSalesforce3);
                cmdQueryForIndividualPlan.CommandType = CommandType.Text;

                cmdQueryForIndividualPlan.Parameters.AddWithValue("@IndividualId", IndividualId);

                if (connSalesforce3.State != ConnectionState.Closed)
                {
                    connSalesforce3.Close();
                    connSalesforce3.Open();
                }
                else if (connSalesforce3.State == ConnectionState.Closed) connSalesforce3.Open();
                Object objIndividualPlan = cmdQueryForIndividualPlan.ExecuteScalar();
                if (connSalesforce3.State != ConnectionState.Closed) connSalesforce3.Close();

                txtMemberProgram.Text = objIndividualPlan?.ToString();

                String strSqlQueryForCaseStatus = "select [dbo].[tbl_case_status_code].[CaseStatusValue] from [dbo].[tbl_case_status_code]";
                SqlCommand cmdQueryForCaseStatus = new SqlCommand(strSqlQueryForCaseStatus, connRN4);
                cmdQueryForCaseStatus.CommandType = CommandType.Text;

                if (connRN4.State != ConnectionState.Closed)
                {
                    connRN4.Close();
                    connRN4.Open();
                }
                else if (connRN4.State == ConnectionState.Closed) connRN4.Open();

                SqlDataReader rdrCaseStatus = cmdQueryForCaseStatus.ExecuteReader();
                cbCaseStatus.Items.Clear();
                if (rdrCaseStatus.HasRows)
                {
                    while (rdrCaseStatus.Read())
                    {
                        cbCaseStatus.Items.Add(rdrCaseStatus.GetString(0));
                    }
                }
                rdrCaseStatus.Close();
                if (connRN4.State != ConnectionState.Closed) connRN4.Close();



                String strSqlQueryForDocumentsInfo = "select [dbo].[tbl_case].[NPF_Form], [dbo].[tbl_case].[NPF_Receiv_Date], " +
                                         "[dbo].[tbl_case].[IB_Form], [dbo].[tbl_case].[IB_Receiv_Date], " +
                                         "[dbo].[tbl_case].[POP_Form], [dbo].[tbl_case].[POP_Receiv_Date], " +
                                         "[dbo].[tbl_case].[MedRec_Form], [dbo].[tbl_case].[MedRec_Receiv_Date], " +
                                         "[dbo].[tbl_case].[Unknown_Form], [dbo].[tbl_case].[Unknown_Receiv_Date] " +
                                         "from [dbo].[tbl_case] " +
                                         "where [dbo].[tbl_case].[Case_Name] = @CaseId and " +
                                         "[dbo].[tbl_case].[Contact_ID] = @IndividualId and " +
                                         "[dbo].[tbl_case].[IsDeleted] = 0";

                SqlCommand cmdQueryForDocInfo = new SqlCommand(strSqlQueryForDocumentsInfo, connRN4);
                cmdQueryForDocInfo.CommandType = CommandType.Text;

                cmdQueryForDocInfo.Parameters.AddWithValue("@CaseId", CaseId);
                cmdQueryForDocInfo.Parameters.AddWithValue("@IndividualId", IndividualId);

                //if (connRN.State == ConnectionState.Closed) connRN.Open();
                if (connRN4.State != ConnectionState.Closed)
                {
                    connRN4.Close();
                    connRN4.Open();
                }
                else if (connRN4.State == ConnectionState.Closed) connRN4.Open();
                SqlDataReader rdrDocInfo = cmdQueryForDocInfo.ExecuteReader();
                if (rdrDocInfo.HasRows)
                {
                    rdrDocInfo.Read();

                    if (!rdrDocInfo.IsDBNull(0))
                    {
                        if (rdrDocInfo.GetBoolean(0))
                        {
                            chkMedBillNPFReceived.Checked = true;
                            chkMedBillNPFReceived.Enabled = false;
                            dtpMedBillNPF.Text = rdrDocInfo.GetDateTime(1).ToString("MM/dd/yyyy");
                            dtpMedBillNPF.Enabled = false;
                            btnViewNPF.Enabled = true;
                        }
                        else
                        {
                            chkMedBillNPFReceived.Checked = false;
                            chkMedBillNPFReceived.Enabled = false;
                            dtpMedBillNPF.Format = DateTimePickerFormat.Custom;
                            dtpMedBillNPF.CustomFormat = " ";
                            dtpMedBillNPF.Enabled = false;
                            btnViewNPF.Enabled = false;
                        }
                    }
                    if (!rdrDocInfo.IsDBNull(2))
                    {
                        if (rdrDocInfo.GetBoolean(2))
                        {
                            chkMedBill_IBReceived.Checked = true;
                            chkMedBill_IBReceived.Enabled = false;
                            dtpMedBill_IB.Text = rdrDocInfo.GetDateTime(3).ToString("MM/dd/yyyy");
                            dtpMedBill_IB.Enabled = false;
                            btnViewIB.Enabled = true;
                        }
                        else
                        {
                            chkMedBill_IBReceived.Checked = false;
                            chkMedBill_IBReceived.Enabled = false;
                            dtpMedBill_IB.Format = DateTimePickerFormat.Custom;
                            dtpMedBill_IB.CustomFormat = " ";
                            dtpMedBill_IB.Enabled = false;
                            btnViewIB.Enabled = false;
                        }
                    }
                    if (!rdrDocInfo.IsDBNull(4))
                    {
                        if (rdrDocInfo.GetBoolean(4))
                        {
                            chkMedBillPOPReceived.Checked = true;
                            chkMedBillPOPReceived.Enabled = false;
                            dtpMedBillPOP.Text = rdrDocInfo.GetDateTime(5).ToString("MM/dd/yyyy");
                            dtpMedBillPOP.Enabled = false;
                            btnViewPoP.Enabled = true;
                        }
                        else
                        {
                            chkMedBillPOPReceived.Checked = false;
                            chkMedBillPOPReceived.Enabled = false;
                            dtpMedBillPOP.Format = DateTimePickerFormat.Custom;
                            dtpMedBillPOP.CustomFormat = " ";
                            dtpMedBillPOP.Enabled = false;
                            btnViewPoP.Enabled = false;
                        }
                    }
                    if (!rdrDocInfo.IsDBNull(6))
                    {
                        if (rdrDocInfo.GetBoolean(6))
                        {
                            chkMedRecordReceived.Checked = true;
                            chkMedRecordReceived.Enabled = false;
                            dtpMedBillMedRecord.Text = rdrDocInfo.GetDateTime(7).ToString("MM/dd/yyyy");
                            dtpMedBillMedRecord.Enabled = false;
                            btnViewMedRecord.Enabled = true;
                        }
                        else
                        {
                            chkMedRecordReceived.Checked = false;
                            chkMedRecordReceived.Enabled = false;
                            dtpMedBillMedRecord.Format = DateTimePickerFormat.Custom;
                            dtpMedBillMedRecord.CustomFormat = " ";
                            dtpMedBillMedRecord.Enabled = false;
                            btnViewMedRecord.Enabled = false;
                        }
                    }

                    if (!rdrDocInfo.IsDBNull(8))
                    {
                        if (rdrDocInfo.GetBoolean(8))
                        {
                            chkOtherDocReceived.Checked = true;
                            chkOtherDocReceived.Enabled = false;
                            dtpMedBillOtherDoc.Text = rdrDocInfo.GetDateTime(9).ToString("MM/dd/yyyy");
                            dtpMedBillOtherDoc.Enabled = false;
                            btnViewOtherDoc.Enabled = true;
                        }
                        else
                        {
                            chkOtherDocReceived.Checked = false;
                            chkOtherDocReceived.Enabled = false;
                            dtpMedBillOtherDoc.Format = DateTimePickerFormat.Custom;
                            dtpMedBillOtherDoc.CustomFormat = " ";
                            dtpMedBillOtherDoc.Enabled = false;
                            btnViewOtherDoc.Enabled = false;
                        }
                    }

                    //strCaseIdSelected = CaseNameInMedBill;
                    //strContactIdSelected = IndividualIdInMedBill;

                    strCaseIdSelected = CaseId;
                    strContactIdSelected = IndividualId;

                }
                rdrDocInfo.Close();
                if (connRN4.State != ConnectionState.Closed) connRN4.Close();

                //String CaseId = gvMedBill["MedBill_CaseId", e.RowIndex]?.Value?.ToString();

                //String strSqlQueryForMedBillEdit = "select [dbo].[tbl_medbill].[Case_Id], [dbo].[tbl_illness].[IllnessNo], [dbo].[tbl_incident].[IncidentNo], [dbo].[tbl_program].[ProgramName], " +
                //               "[dbo].[tbl_medbill].[BillNo], [dbo].[tbl_medbill].[MedBillType_Id], [dbo].[tbl_medbill].[BillStatus], [dbo].[tbl_medbill].[BillClosed], " +
                //               "[dbo].[tbl_medbill].[BillAmount], [dbo].[tbl_MedicalProvider].[Name], " +
                //               "[dbo].[tbl_medbill].[PrescriptionDrugName], [dbo].[tbl_medbill].[PrescriptionNo], [dbo].[tbl_medbill].[PrescriptionDescription], " +
                //               "[dbo].[tbl_medbill].[TotalNumberOfPhysicalTherapy], [dbo].[tbl_medbill].[PatientTypeId], " +
                //               "[dbo].[tbl_medbill].[BillDate], [dbo].[tbl_medbill].[DueDate], " +
                //               "[dbo].[tbl_medbill].[Account_At_Provider], [dbo].[tbl_medbill].[ProviderContactPerson], " +
                //               "[dbo].[tbl_medbill].[Note], " +
                //               "[dbo].[tbl_illness].[ICD_10_Id], " +
                //               "[dbo].[tbl_medbill].[PendingReason], [dbo].[tbl_medbill].[IneligibleReason], " +
                //               "[dbo].[tbl_medbill].[Account_At_Provider], [dbo].[tbl_medbill].[ProviderPhoneNumber], [dbo].[tbl_medbill].[ProviderContactPerson], " +
                //               "[dbo].[tbl_medbill].[ProposalLetterSentDate], [dbo].[tbl_medbill].[HIPPASentDate], [dbo].[tbl_medbill].[MedicalRecordDate], " +
                //               "[dbo].[tbl_medbill].[Illness_Id], [dbo].[tbl_medbill].[Incident_Id] " +
                //               "from [dbo].[tbl_medbill] " +
                //               "inner join [dbo].[tbl_illness] on [dbo].[tbl_medbill].[Illness_Id] = [dbo].[tbl_illness].[Illness_Id] " +
                //               "inner join [dbo].[tbl_incident] on [dbo].[tbl_medbill].[Incident_Id] = [dbo].[tbl_incident].[Incident_id] " +
                //               "inner join [dbo].[tbl_program] on [dbo].[tbl_incident].[Program_id] = [dbo].[tbl_program].[Program_Id] " +
                //               "inner join [dbo].[tbl_MedicalProvider] on [dbo].[tbl_medbill].[MedicalProvider_Id] = [dbo].[tbl_MedicalProvider].[ID] " +
                //               "where [dbo].[tbl_medbill].[BillNo] = @MedBillNo and " +
                //               "[dbo].[tbl_medbill].[Case_Id] = @CaseName and " +
                //               "[dbo].[tbl_medbill].[Contact_Id] = @IndividualId and" +
                //               "[dbo].[tbl_medbill].[IsDeleted] = 0";
                ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////




                ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                String strSqlQueryForMedBillEdit = "select [dbo].[tbl_medbill].[Case_Id], [dbo].[tbl_illness].[IllnessNo], [dbo].[tbl_incident].[IncidentNo], [dbo].[tbl_program].[ProgramName], " +
                                                   "[dbo].[tbl_medbill].[BillNo], [dbo].[tbl_medbill].[MedBillType_Id], [dbo].[tbl_medbill].[BillStatus], [dbo].[tbl_medbill].[BillClosed], " +
                                                   "[dbo].[tbl_medbill].[BillAmount], [dbo].[tbl_medbill].[MedicalProvider_Id], " +
                                                   "[dbo].[tbl_medbill].[PrescriptionDrugName], [dbo].[tbl_medbill].[PrescriptionNo], [dbo].[tbl_medbill].[PrescriptionDescription], " +
                                                   "[dbo].[tbl_medbill].[TotalNumberOfPhysicalTherapy], [dbo].[tbl_medbill].[PatientTypeId], " +
                                                   "[dbo].[tbl_medbill].[BillDate], [dbo].[tbl_medbill].[DueDate], " +
                                                   "[dbo].[tbl_medbill].[Account_At_Provider], [dbo].[tbl_medbill].[ProviderContactPerson], [dbo].[tbl_medbill].[ProviderPhoneNumber], " +
                                                   "[dbo].[tbl_medbill].[Note], " +
                                                   "[dbo].[tbl_illness].[ICD_10_Id], " +
                                                   "[dbo].[tbl_medbill].[PendingReason], [dbo].[tbl_medbill].[IneligibleReason], " +
                                                   "[dbo].[tbl_medbill].[ProposalLetterSentDate], [dbo].[tbl_medbill].[HIPPASentDate], [dbo].[tbl_medbill].[MedicalRecordDate], " +
                                                   "[dbo].[tbl_medbill].[Illness_Id], [dbo].[tbl_medbill].[Incident_Id], " +
                                                   "[dbo].[tbl_medbill].[NPF_Form], [dbo].[tbl_medbill].[NPF_SourceFileName], [dbo].[tbl_medbill].[NPF_DestinationFileName], " +
                                                   "[dbo].[tbl_medbill].[IB_Form], [dbo].[tbl_medbill].[IB_SourceFileName], [dbo].[tbl_medbill].[IB_DestinationFileName], " +
                                                   "[dbo].[tbl_medbill].[POP_Form], [dbo].[tbl_medbill].[POP_SourceFileName], [dbo].[tbl_medbill].[POP_DestinationFileName], " +
                                                   "[dbo].[tbl_medbill].[MedRec_Form], [dbo].[tbl_medbill].[MedRec_SourceFileName], [dbo].[tbl_medbill].[MedRec_DestinationFileName], " +
                                                   "[dbo].[tbl_medbill].[Unknown_Form], [dbo].[tbl_medbill].[Unknown_SourceFileName], [dbo].[tbl_medbill].[Unknown_DestinationFileName] " +
                                                   "from [dbo].[tbl_medbill] " +
                                                   "inner join [dbo].[tbl_illness] on [dbo].[tbl_medbill].[Illness_Id] = [dbo].[tbl_illness].[Illness_Id] " +
                                                   "inner join [dbo].[tbl_incident] on [dbo].[tbl_medbill].[Incident_Id] = [dbo].[tbl_incident].[Incident_id] " +
                                                   "inner join [dbo].[tbl_program] on [dbo].[tbl_incident].[Program_id] = [dbo].[tbl_program].[Program_Id] " +
                                                   "where [dbo].[tbl_medbill].[BillNo] = @MedBillNo and " +
                                                   "[dbo].[tbl_medbill].[Case_Id] = @CaseName and " +
                                                   "[dbo].[tbl_medbill].[Contact_Id] = @IndividualId and" +
                                                   "[dbo].[tbl_medbill].[IsDeleted] = 0";

                SqlCommand cmdQueryForMedBillEdit = new SqlCommand(strSqlQueryForMedBillEdit, connRN4);
                cmdQueryForMedBillEdit.CommandType = CommandType.Text;

                cmdQueryForMedBillEdit.Parameters.AddWithValue("@MedBillNo", MedBillNo);
                cmdQueryForMedBillEdit.Parameters.AddWithValue("@CaseName", CaseId);
                cmdQueryForMedBillEdit.Parameters.AddWithValue("@IndividualId", IndividualId);

                //if (connRN.State == ConnectionState.Closed) connRN.Open();
                if (connRN4.State != ConnectionState.Closed)
                {
                    connRN4.Close();
                    connRN4.Open();
                }
                else if (connRN4.State == ConnectionState.Closed) connRN4.Open();

                SqlDataReader rdrMedBillEdit = cmdQueryForMedBillEdit.ExecuteReader();

                MedicalBillInfoForList MedBillForEdit = new MedicalBillInfoForList();

                if (rdrMedBillEdit.HasRows)
                {
                    rdrMedBillEdit.Read();
                    if (!rdrMedBillEdit.IsDBNull(0)) MedBillForEdit.CaseId = rdrMedBillEdit.GetString(0).Trim();
                    if (!rdrMedBillEdit.IsDBNull(1)) MedBillForEdit.IllnessNo = rdrMedBillEdit.GetString(1).Trim();
                    if (!rdrMedBillEdit.IsDBNull(2)) MedBillForEdit.IncidentNo = rdrMedBillEdit.GetString(2).Trim();
                    if (!rdrMedBillEdit.IsDBNull(3)) MedBillForEdit.ProgramName = rdrMedBillEdit.GetString(3).Trim();
                    if (!rdrMedBillEdit.IsDBNull(4)) MedBillForEdit.MedBillNo = rdrMedBillEdit.GetString(4).Trim();
                    if (!rdrMedBillEdit.IsDBNull(5)) MedBillForEdit.MedBillTypeId = rdrMedBillEdit.GetInt16(5);
                    if (!rdrMedBillEdit.IsDBNull(6)) MedBillForEdit.MedBillStatusId = rdrMedBillEdit.GetInt16(6);
                    if (!rdrMedBillEdit.IsDBNull(7)) MedBillForEdit.bBillClosed = rdrMedBillEdit.GetBoolean(7);
                    if (!rdrMedBillEdit.IsDBNull(8)) MedBillForEdit.BillAmount = rdrMedBillEdit.GetDecimal(8);
                    if (!rdrMedBillEdit.IsDBNull(9)) MedBillForEdit.MedicalProviderId = rdrMedBillEdit.GetString(9);
                    if (!rdrMedBillEdit.IsDBNull(10)) MedBillForEdit.PrescriptionDrugName = rdrMedBillEdit.GetString(10);
                    if (!rdrMedBillEdit.IsDBNull(11)) MedBillForEdit.PrescriptionNo = rdrMedBillEdit.GetString(11);
                    if (!rdrMedBillEdit.IsDBNull(12)) MedBillForEdit.PrescriptionDescription = rdrMedBillEdit.GetString(12);
                    if (!rdrMedBillEdit.IsDBNull(13)) MedBillForEdit.TotalNumberOfPhysicalTherapy = rdrMedBillEdit.GetInt16(13);
                    if (!rdrMedBillEdit.IsDBNull(14)) MedBillForEdit.nPatientTypeId = rdrMedBillEdit.GetInt16(14);
                    if (!rdrMedBillEdit.IsDBNull(15)) MedBillForEdit.BillDate = rdrMedBillEdit.GetDateTime(15);
                    if (!rdrMedBillEdit.IsDBNull(16)) MedBillForEdit.ReceivedDate = rdrMedBillEdit.GetDateTime(16);
                    if (!rdrMedBillEdit.IsDBNull(17)) MedBillForEdit.AccountNoAtProvider = rdrMedBillEdit.GetString(17);
                    if (!rdrMedBillEdit.IsDBNull(18)) MedBillForEdit.ProviderContactPerson = rdrMedBillEdit.GetString(18);
                    if (!rdrMedBillEdit.IsDBNull(19)) MedBillForEdit.ProviderPhoneNumber = rdrMedBillEdit.GetString(19);
                    if (!rdrMedBillEdit.IsDBNull(20)) MedBillForEdit.Note = rdrMedBillEdit.GetString(20);
                    if (!rdrMedBillEdit.IsDBNull(21)) MedBillForEdit.ICD_10_Id = rdrMedBillEdit.GetString(21);
                    if (!rdrMedBillEdit.IsDBNull(22)) MedBillForEdit.nPendingReasonIndex = rdrMedBillEdit.GetInt32(22);
                    if (!rdrMedBillEdit.IsDBNull(23)) MedBillForEdit.nIneligibleReasonIndex = rdrMedBillEdit.GetInt32(23);
                    if (!rdrMedBillEdit.IsDBNull(24)) MedBillForEdit.ProposalLetterSentDate = rdrMedBillEdit.GetDateTime(24);
                    if (!rdrMedBillEdit.IsDBNull(25)) MedBillForEdit.HIPPASentDate = rdrMedBillEdit.GetDateTime(25);
                    if (!rdrMedBillEdit.IsDBNull(26)) MedBillForEdit.MedicalRecordDate = rdrMedBillEdit.GetDateTime(26);
                    if (!rdrMedBillEdit.IsDBNull(27)) MedBillForEdit.IllnessId = Int32.Parse(rdrMedBillEdit.GetString(27).Trim());
                    if (!rdrMedBillEdit.IsDBNull(28)) MedBillForEdit.IncidentId = Int32.Parse(rdrMedBillEdit.GetString(28).Trim());
                    if (!rdrMedBillEdit.IsDBNull(29)) MedBillForEdit.NPF_Form = rdrMedBillEdit.GetBoolean(29);
                    //if (!rdrMedBillEdit.IsDBNull(30)) MedBillForEdit.NPFormFileNameMedBill = rdrMedBillEdit.GetString(30);
                    if (!rdrMedBillEdit.IsDBNull(30)) MedBillForEdit.NPFSourceFilePathMedBill = rdrMedBillEdit.GetString(30);
                    if (!rdrMedBillEdit.IsDBNull(31)) MedBillForEdit.NPFDestinationFilePathMedbill = rdrMedBillEdit.GetString(31);
                    if (!rdrMedBillEdit.IsDBNull(32)) MedBillForEdit.IB_Form = rdrMedBillEdit.GetBoolean(32);
                    //if (!rdrMedBillEdit.IsDBNull(34)) MedBillForEdit.IBFileNameMedBill = rdrMedBillEdit.GetString(34);
                    if (!rdrMedBillEdit.IsDBNull(33)) MedBillForEdit.IBSourceFilePathMedBill = rdrMedBillEdit.GetString(33);
                    if (!rdrMedBillEdit.IsDBNull(34)) MedBillForEdit.IBDestinationFilePathMedBill = rdrMedBillEdit.GetString(34);
                    if (!rdrMedBillEdit.IsDBNull(35)) MedBillForEdit.PoP_Form = rdrMedBillEdit.GetBoolean(35);
                    //if (!rdrMedBillEdit.IsDBNull(38)) MedBillForEdit.PoPFileNameMedBill = rdrMedBillEdit.GetString(38);
                    if (!rdrMedBillEdit.IsDBNull(36)) MedBillForEdit.PoPSourceFilePathMedBill = rdrMedBillEdit.GetString(36);
                    if (!rdrMedBillEdit.IsDBNull(37)) MedBillForEdit.PoPDestinationFilePathMedBill = rdrMedBillEdit.GetString(37);
                    if (!rdrMedBillEdit.IsDBNull(38)) MedBillForEdit.MedRec_Form = rdrMedBillEdit.GetBoolean(38);
                    //if (!rdrMedBillEdit.IsDBNull(42)) MedBillForEdit.MedRecFileNameMedBill = rdrMedBillEdit.GetString(42);
                    if (!rdrMedBillEdit.IsDBNull(39)) MedBillForEdit.MedRecSourceFilePathMedBill = rdrMedBillEdit.GetString(39);
                    if (!rdrMedBillEdit.IsDBNull(40)) MedBillForEdit.MedRecDestiantionFilePathMedbill = rdrMedBillEdit.GetString(40);
                    if (!rdrMedBillEdit.IsDBNull(41)) MedBillForEdit.OtherDoc_Form = rdrMedBillEdit.GetBoolean(41);
                    //if (!rdrMedBillEdit.IsDBNull(46)) MedBillForEdit.OtherDocFileNameMedBill = rdrMedBillEdit.GetString(46);
                    if (!rdrMedBillEdit.IsDBNull(42)) MedBillForEdit.OtherDocSourceFilePathMedBill = rdrMedBillEdit.GetString(42);
                    if (!rdrMedBillEdit.IsDBNull(43)) MedBillForEdit.OtherDocDestinationFilePathMedBill = rdrMedBillEdit.GetString(43);

                }

                String strSqlQueryForMedicalProviderName = "select [dbo].[account].[Name] from [dbo].[account] where [dbo].[account].[Id] = @MedicalProviderId";

                SqlCommand cmdQueryForMedicalProviderName = new SqlCommand(strSqlQueryForMedicalProviderName, connSalesforce2);
                cmdQueryForMedicalProviderName.CommandType = CommandType.Text;

                cmdQueryForMedicalProviderName.Parameters.AddWithValue("@MedicalProviderId", MedBillForEdit.MedicalProviderId);

                if (connSalesforce2.State != ConnectionState.Closed)
                {
                    connSalesforce2.Close();
                    connSalesforce2.Open();
                }
                else if (connSalesforce2.State == ConnectionState.Closed) connSalesforce2.Open();
                Object objMedicalProviderName = cmdQueryForMedicalProviderName.ExecuteScalar();
                if (connSalesforce2.State == ConnectionState.Open) connSalesforce2.Close();

                if (objMedicalProviderName != null) MedBillForEdit.MedicalProviderName = objMedicalProviderName.ToString();

                //////////////////////////////////////////////////////////////////////////////////
                txtMedBill_CaseNo.Text = MedBillForEdit.CaseId;
                Illness.IllnessNo = MedBillForEdit.IllnessNo;
                txtMedBill_Illness.Text = MedBillForEdit.IllnessNo;
                Incident.IncidentNo = MedBillForEdit.IncidentNo;
                txtMedBill_Incident.Text = MedBillForEdit.IncidentNo;
                txtIncdProgram.Text = MedBillForEdit.ProgramName;

                chkNPFMedBill.Checked = MedBillForEdit.NPF_Form;
                chkIBMedBill.Checked = MedBillForEdit.IB_Form;
                chkPoPMedBill.Checked = MedBillForEdit.PoP_Form;
                chkMedRecMedBill.Checked = MedBillForEdit.MedRec_Form;
                chkOtherDocMedBill.Checked = MedBillForEdit.OtherDoc_Form;

                MedBillForEdit.NPFormFileNameMedBill = Path.GetFileName(MedBillForEdit.NPFSourceFilePathMedBill);
                MedBillForEdit.IBFileNameMedBill = Path.GetFileName(MedBillForEdit.IBSourceFilePathMedBill);
                MedBillForEdit.PoPFileNameMedBill = Path.GetFileName(MedBillForEdit.PoPSourceFilePathMedBill);
                MedBillForEdit.MedRecFileNameMedBill = Path.GetFileName(MedBillForEdit.MedRecSourceFilePathMedBill);
                MedBillForEdit.OtherDocFileNameMedBill = Path.GetFileName(MedBillForEdit.OtherDocSourceFilePathMedBill);

                txtNPFMedBillFileName.Text = MedBillForEdit.NPFormFileNameMedBill;
                txtIBMedBillFileName.Text = MedBillForEdit.IBFileNameMedBill;
                txtPoPMedBillFileName.Text = MedBillForEdit.PoPFileNameMedBill;
                txtMedRecMedBillFileName.Text = MedBillForEdit.MedRecFileNameMedBill;
                txtOtherDocMedBillFileName.Text = MedBillForEdit.OtherDocFileNameMedBill;

                strNPFormFileNameMedBill = MedBillForEdit.NPFormFileNameMedBill;
                strNPFSourceFilePathMedBill = MedBillForEdit.NPFSourceFilePathMedBill;
                strNPFDestinationFilePathMedBill = MedBillForEdit.NPFDestinationFilePathMedbill;

                strIBFileNameMedBill = MedBillForEdit.IBFileNameMedBill;
                strIBSourceFilePathMedBill = MedBillForEdit.IBSourceFilePathMedBill;
                strIBDestinationFilePathMedBill = MedBillForEdit.IBDestinationFilePathMedBill;

                strPoPFileNameMedBill = MedBillForEdit.PoPFileNameMedBill;
                strPoPSourceFilePathMedBill = MedBillForEdit.PoPSourceFilePathMedBill;
                strPoPDestinationFilePathMedBill = MedBillForEdit.PoPDestinationFilePathMedBill;

                strMedRecFileNameMedBill = MedBillForEdit.MedRecFileNameMedBill;
                strMedRecSourceFilePathMedBill = MedBillForEdit.MedRecSourceFilePathMedBill;
                strMedRecDestinationFilePathMedBill = MedBillForEdit.MedRecDestiantionFilePathMedbill;

                strOtherDocFileNameMedBill = MedBillForEdit.OtherDocFileNameMedBill;
                strOtherDocSourceFilePathMedBill = MedBillForEdit.OtherDocSourceFilePathMedBill;
                strOtherDocDestinationFilePathMedBill = MedBillForEdit.OtherDocDestinationFilePathMedBill;


                txtMedBillNo.Text = MedBillForEdit.MedBillNo;
                if (MedBillForEdit.MedBillTypeId != -1)
                {
                    comboMedBillType.Items.Clear();
                    for (int i = 1; i <= dicMedBillTypes.Count; i++)
                    {
                        comboMedBillType.Items.Add(dicMedBillTypes[i]);
                    }
                    comboMedBillType.SelectedIndex = MedBillForEdit.MedBillTypeId - 1;
                }
                if (MedBillForEdit.MedBillStatusId != -1)
                {
                    if (dicMedBillStatus.Count > 0)
                    {
                        comboMedBillStatus.Items.Clear();
                        for (int i = 0; i < dicMedBillStatus.Count; i++)
                        {
                            comboMedBillStatus.Items.Add(dicMedBillStatus[i]);
                        }
                        comboMedBillStatus.SelectedIndex = MedBillForEdit.MedBillStatusId;
                    }
                }

                if (MedBillForEdit.bBillClosed) cbMedBillClosed.SelectedIndex = 1;
                else cbMedBillClosed.SelectedIndex = 0;

                comboMedBillStatus.SelectedIndex = MedBillForEdit.MedBillStatusId;
                txtMedBillAmount.Text = MedBillForEdit.BillAmount.ToString("C");
                txtBalance.Text = MedBillForEdit.Balance.ToString("C");
                txtMedicalProvider.Text = MedBillForEdit.MedicalProviderName.Trim();

                txtNumberOfMedication.Text = MedBillForEdit.PrescriptionNo.Trim();
                txtPrescriptionName.Text = MedBillForEdit.PrescriptionDrugName.Trim();
                txtPrescriptionDescription.Text = MedBillForEdit.PrescriptionDescription;

                txtNumPhysicalTherapy.Text = MedBillForEdit.TotalNumberOfPhysicalTherapy.ToString();
                if (MedBillForEdit.nPatientTypeId == 0) rbOutpatient.Checked = true;
                else if (MedBillForEdit.nPatientTypeId == 1) rbInpatient.Checked = true;

                if (MedBillForEdit.BillDate.Value != null)
                {
                    dtpBillDate.Checked = true;
                    dtpBillDate.Text = MedBillForEdit.BillDate.Value.ToString("MM/dd/yyyy");
                }
                else
                {
                    dtpBillDate.Format = DateTimePickerFormat.Custom;
                    dtpBillDate.CustomFormat = " ";
                }

                if (MedBillForEdit.ReceivedDate.Value != null)
                {
                    dtpDueDate.Checked = true;
                    dtpDueDate.Text = MedBillForEdit.ReceivedDate.Value.ToString("MM/dd/yyyy");
                }
                else
                {
                    dtpDueDate.Format = DateTimePickerFormat.Custom;
                    dtpDueDate.Text = " ";
                }

                txtMedBillAccountNoAtProvider.Text = MedBillForEdit.AccountNoAtProvider;
                txtProviderContactPerson.Text = MedBillForEdit.ProviderContactPerson;
                txtMedProviderPhoneNo.Text = MedBillForEdit.ProviderPhoneNumber;


                if (MedBillForEdit.Note != String.Empty)
                {
                    if (comboMedBillType.SelectedIndex == 0) txtMedBillNote.Text = MedBillForEdit.Note;
                    if (comboMedBillType.SelectedIndex == 1) txtPrescriptionNote.Text = MedBillForEdit.Note;
                    if (comboMedBillType.SelectedIndex == 2) txtPhysicalTherapyRxNote.Text = MedBillForEdit.Note;
                }

                if (MedBillForEdit.ICD_10_Id != String.Empty) txtMedBill_ICD10Code.Text = MedBillForEdit.ICD_10_Id;
                //if ((comboMedBillType.SelectedIndex == 0) && (MedBillForEdit.nPendingReasonIndex != -1)) comboPendingReason.SelectedIndex = MedBillForEdit.nPendingReasonIndex;
                if (MedBillForEdit.nPendingReasonIndex != -1) comboPendingReason.SelectedIndex = MedBillForEdit.nPendingReasonIndex;
                //if ((comboMedBillType.SelectedIndex == 0) && (MedBillForEdit.nIneligibleReasonIndex != -1)) comboIneligibleReason.SelectedIndex = MedBillForEdit.nIneligibleReasonIndex;
                if (MedBillForEdit.nIneligibleReasonIndex != -1) comboIneligibleReason.SelectedIndex = MedBillForEdit.nIneligibleReasonIndex;

                if (comboMedBillType.SelectedIndex == 0 || comboMedBillType.SelectedIndex == 3)
                {
                    txtPrescriptionName.Text = String.Empty;
                    txtPrescriptionDescription.Text = String.Empty;
                    txtPrescriptionNote.Text = String.Empty;
                    txtNumberOfMedication.Text = String.Empty;

                    txtNumPhysicalTherapy.Text = String.Empty;
                    txtPhysicalTherapyRxNote.Text = String.Empty;
                }
                else if (comboMedBillType.SelectedIndex == 1)       // Medical Bill Type - Prescription
                {
                    txtNumPhysicalTherapy.Text = String.Empty;
                    txtPhysicalTherapyRxNote.Text = String.Empty;

                    rbInpatient.Checked = false;
                    rbOutpatient.Checked = false;

                    //comboPendingReason.SelectedIndex = 0;
                    //comboIneligibleReason.SelectedIndex = 0;

                    txtMedBillNote.Text = String.Empty;
                }
                else if (comboMedBillType.SelectedIndex == 2)       // Medical Bill Type - Physical Therapy
                {
                    txtPrescriptionName.Text = String.Empty;
                    txtPrescriptionDescription.Text = String.Empty;
                    txtPrescriptionNote.Text = String.Empty;
                    txtNumberOfMedication.Text = String.Empty;

                    rbInpatient.Checked = false;
                    rbOutpatient.Checked = false;

                    //comboPendingReason.SelectedIndex = 0;
                    //comboIneligibleReason.SelectedIndex = 0;

                    txtMedBillNote.Text = String.Empty;
                }

                if (MedBillForEdit.ProposalLetterSentDate != null)
                {
                    dtpProposalLetterSentDate.Checked = true;
                    dtpProposalLetterSentDate.Value = MedBillForEdit.ProposalLetterSentDate.Value;
                    dtpProposalLetterSentDate.Format = DateTimePickerFormat.Short;
                }
                if (MedBillForEdit.HIPPASentDate != null)
                {
                    dtpHippaSentDate.Checked = true;
                    dtpHippaSentDate.Value = MedBillForEdit.HIPPASentDate.Value;
                    dtpHippaSentDate.Format = DateTimePickerFormat.Short;
                }
                if (MedBillForEdit.MedicalRecordDate != null)
                {
                    dtpMedicalRecordDate.Checked = true;
                    dtpMedicalRecordDate.Value = MedBillForEdit.MedicalRecordDate.Value;
                    dtpMedicalRecordDate.Format = DateTimePickerFormat.Short;
                }

                if (MedBillForEdit.IllnessId != -1) Illness.IllnessId = MedBillForEdit.IllnessId.ToString();
                else Illness.IllnessId = String.Empty;
                if (MedBillForEdit.IncidentId != -1) Incident.IncidentId = MedBillForEdit.IncidentId.ToString();
                else Incident.IncidentId = String.Empty;

                /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                String ICD10Code = txtMedBill_ICD10Code.Text.Trim();

                String strSqlQueryForDiseaseName = "select [dbo].[ICD10 Code].[Name] from [dbo].[ICD10 Code] where [dbo].[ICD10 Code].[ICD10_CODE__C] = @ICD10Code";

                SqlCommand cmdQueryForDiseaseName = new SqlCommand(strSqlQueryForDiseaseName, connSalesforce);
                cmdQueryForDiseaseName.CommandType = CommandType.Text;

                cmdQueryForDiseaseName.Parameters.AddWithValue("@ICD10Code", ICD10Code);

                if (connSalesforce.State != ConnectionState.Closed)
                {
                    connSalesforce.Close();
                    connSalesforce.Open();
                }
                else if (connSalesforce.State == ConnectionState.Closed) connSalesforce.Open();

                Object objDiseaseName = cmdQueryForDiseaseName.ExecuteScalar();
                txtMedBillDiseaseName.Text = objDiseaseName?.ToString();
                if (connSalesforce.State == ConnectionState.Open) connSalesforce.Close();

                var srcMedicalProvider = new AutoCompleteStringCollection();

                for (int i = 0; i < lstMedicalProvider.Count; i++)
                {
                    srcMedicalProvider.Add(lstMedicalProvider[i].Name);
                }

                txtMedicalProvider.AutoCompleteMode = AutoCompleteMode.SuggestAppend;
                txtMedicalProvider.AutoCompleteSource = AutoCompleteSource.CustomSource;
                txtMedicalProvider.AutoCompleteCustomSource = srcMedicalProvider;

                /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                // Settlement

                lstPaymentMethod.Clear();
                String strSqlQueryForPaymentMethod = "select [dbo].[tbl_payment_method].[PaymentMethod_Id], [dbo].[tbl_payment_method].[PaymentMethod_Value] from [dbo].[tbl_payment_method] " +
                                                     "order by [dbo].[tbl_payment_method].[PaymentMethod_Value]";

                SqlCommand cmdQueryForPaymentMethod = new SqlCommand(strSqlQueryForPaymentMethod, connRN4);
                cmdQueryForPaymentMethod.CommandType = CommandType.Text;

                //if (connRN.State == ConnectionState.Closed) connRN.Open();
                if (connRN4.State != ConnectionState.Closed)
                {
                    connRN4.Close();
                    connRN4.Open();
                }
                else if (connRN4.State == ConnectionState.Closed) connRN4.Open();
                SqlDataReader rdrPaymentMethod = cmdQueryForPaymentMethod.ExecuteReader();
                if (rdrPaymentMethod.HasRows)
                {
                    while (rdrPaymentMethod.Read())
                    {
                        if (!rdrPaymentMethod.IsDBNull(1)) lstPaymentMethod.Add(new PaymentMethod { PaymentMethodId = rdrPaymentMethod.GetInt16(0), PaymentMethodValue = rdrPaymentMethod.GetString(1) });
                        else lstPaymentMethod.Add(new PaymentMethod { PaymentMethodId = rdrPaymentMethod.GetInt16(0), PaymentMethodValue = null });
                    }
                }
                rdrPaymentMethod.Close();
                if (connRN4.State != ConnectionState.Closed) connRN4.Close();

                // Retrieve credit card info
                lstCreditCardInfo.Clear();
                String strSqlQueryForCreditCardInfo = "select [dbo].[tbl_Credit_Card__c].[CreditCard_Id], [dbo].[tbl_Credit_Card__c].[Name] from [dbo].[tbl_Credit_Card__c]";

                SqlCommand cmdQueryForCreditCardInfo = new SqlCommand(strSqlQueryForCreditCardInfo, connRN4);
                cmdQueryForCreditCardInfo.CommandType = CommandType.Text;

                if (connRN4.State != ConnectionState.Closed)
                {
                    connRN4.Close();
                    connRN4.Open();
                }
                else if (connRN4.State == ConnectionState.Closed) connRN4.Open();

                SqlDataReader rdrCreditCardInfo = cmdQueryForCreditCardInfo.ExecuteReader();
                if (rdrCreditCardInfo.HasRows)
                {
                    while (rdrCreditCardInfo.Read())
                    {
                        if (!rdrCreditCardInfo.IsDBNull(1))
                            lstCreditCardInfo.Add(new CreditCardInfo { CreditCardId = rdrCreditCardInfo.GetInt16(0), CreditCardNo = rdrCreditCardInfo.GetString(1) });
                        else
                            lstCreditCardInfo.Add(new CreditCardInfo { CreditCardId = rdrCreditCardInfo.GetInt16(0), CreditCardNo = null });
                    }
                }
                rdrCreditCardInfo.Close();
                if (connRN4.State != ConnectionState.Closed) connRN4.Close();

                ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                String IncidentNo = txtMedBill_Incident.Text.Trim();
                String IndividualIdMedBill = txtCaseIndividualID.Text.Trim();

                String strSqlQueryForIncident = "select [dbo].[tbl_incident].[Program_id], [dbo].[tbl_program].[ProgramName], [dbo].[tbl_incident].[IsDeleted] " +
                                "from [dbo].[tbl_incident] " +
                                "inner join [dbo].[tbl_program] on [dbo].[tbl_incident].[Program_id] = [dbo].[tbl_program].[Program_Id] " +
                                "where [dbo].[tbl_incident].[Individual_id] = @IndividualId and " +
                                "[dbo].[tbl_incident].[IncidentNo] = @IncidentNo " +
                                "order by [dbo].[tbl_incident].[Program_id]";

                SqlCommand cmdQueryForIncident = new SqlCommand(strSqlQueryForIncident, connRN4);
                cmdQueryForIncident.CommandType = CommandType.Text;

                cmdQueryForIncident.Parameters.AddWithValue("@IndividualId", IndividualIdMedBill);
                cmdQueryForIncident.Parameters.AddWithValue("@IncidentNo", IncidentNo);

                if (connRN4.State != ConnectionState.Closed)
                {
                    connRN4.Close();
                    connRN4.Open();
                }
                else if (connRN4.State == ConnectionState.Closed) connRN4.Open();

                SqlDataReader rdrIncident = cmdQueryForIncident.ExecuteReader();
                lstIncidentProgramInfo.Clear();
                if (rdrIncident.HasRows)
                {
                    while (rdrIncident.Read())
                    {
                        if (!rdrIncident.IsDBNull(0) && !rdrIncident.IsDBNull(1))
                        {
                            IncidentProgramInfo incidentProgram = new IncidentProgramInfo(rdrIncident.GetBoolean(2), rdrIncident.GetInt16(0), rdrIncident.GetString(1).Trim());
                            lstIncidentProgramInfo.Add(incidentProgram);
                        }
                    }
                }
                rdrIncident.Close();
                if (connRN4.State == ConnectionState.Open) connRN4.Close();

                //String strSqlQueryForIncidentChange = "select [dbo].[tbl_incident_history].[Program_id], [dbo].[tbl_program].[ProgramName], [dbo].[tbl_incident_history].[IsDeleted] " +
                //                        "from [dbo].[tbl_incident_history] " +
                //                        "inner join [dbo].[tbl_program] on [dbo].[tbl_incident_history].[Program_id] = [dbo].[tbl_program].[Program_Id] " +
                //                        "where ([dbo].[tbl_incident_history].[Operation] = 2 or " +
                //                        "[dbo].[tbl_incident_history].[Operation] = 3 or " +
                //                        "[dbo].[tbl_incident_history].[Operation] = 4) and " +
                //                        "[dbo].[tbl_incident_history].[Individual_id] = @IndividualId and" +
                //                        "[dbo].[tbl_incident_history].[IncidentNo] = @IncidentNo " +
                //                        "order by [dbo].[tbl_incident_history].[Program_id]";

                //SqlCommand cmdQueryForIncidentChange = new SqlCommand(strSqlQueryForIncidentChange, connRN4);
                //cmdQueryForIncidentChange.CommandType = CommandType.Text;

                //cmdQueryForIncidentChange.Parameters.AddWithValue("@IndividualId", IndividualIdMedBill);
                //cmdQueryForIncidentChange.Parameters.AddWithValue("@IncidentNo", IncidentNo);

                //if (connRN4.State != ConnectionState.Closed)
                //{
                //    connRN4.Close();
                //    connRN4.Open();
                //}
                //else if (connRN4.State == ConnectionState.Closed) connRN4.Open();
                //SqlDataReader rdrIncidentChange = cmdQueryForIncidentChange.ExecuteReader();
                ////lstIncidentProgramInfo.Clear();
                //if (rdrIncidentChange.HasRows)
                //{
                //    while (rdrIncidentChange.Read())
                //    {
                //        if (!rdrIncidentChange.IsDBNull(0) && !rdrIncidentChange.IsDBNull(1))
                //        {
                //            IncidentProgramInfo incidentProgram = new IncidentProgramInfo(rdrIncidentChange.GetBoolean(2), rdrIncidentChange.GetInt16(0), rdrIncidentChange.GetString(1).Trim());
                //            lstIncidentProgramInfo.Add(incidentProgram);
                //        }
                //    }
                //}
                //rdrIncidentChange.Close();
                //if (connRN4.State == ConnectionState.Open) connRN4.Close();

                //foreach (IncidentProgramInfo incdInfo in lstIncidentProgramInfo)
                //{
                //    if (incdInfo.bIsDeleted == true)
                //    {
                //        MessageBox.Show("The Incident has been deleted. Personal Responsibility cannot be calculated.", "Error");
                //        lstIncidentProgramInfo.Clear();
                //    }
                //}

                //Boolean bBronze = false;
                //Boolean bSilver = false;
                //Boolean bGold = false;
                //Boolean bGoldPlus = false;
                //Boolean bGoldMed1 = false;
                //Boolean bGoldMed2 = false;

                //if (lstIncidentProgramInfo.Count > 0)
                //{
                //    foreach (IncidentProgramInfo incidentInfo in lstIncidentProgramInfo)
                //    {
                //        if ((incidentInfo.IncidentProgramId == 3) &&
                //            (incidentInfo.bIsDeleted == false))
                //        {
                //            incidentInfo.bPersonalResponsibilityProgram = true;
                //            bBronze = true;
                //            break;
                //        }
                //    }

                //    foreach (IncidentProgramInfo incidentInfo in lstIncidentProgramInfo)
                //    {
                //        if ((incidentInfo.IncidentProgramId == 2) &&
                //            (bBronze == false) &&
                //            (incidentInfo.bIsDeleted == false))
                //        {
                //            incidentInfo.bPersonalResponsibilityProgram = true;
                //            bSilver = true;
                //            break;
                //        }
                //    }

                //    foreach (IncidentProgramInfo incidentInfo in lstIncidentProgramInfo)
                //    {
                //        if ((incidentInfo.IncidentProgramId == 1) &&
                //            (bBronze == false) &&
                //            (bSilver == false) &&
                //            (incidentInfo.bIsDeleted == false))
                //        {
                //            incidentInfo.bPersonalResponsibilityProgram = true;
                //            break;
                //        }
                //    }

                //    foreach (IncidentProgramInfo incidentInfo in lstIncidentProgramInfo)
                //    {
                //        if ((incidentInfo.IncidentProgramId == 0) &&
                //            (bBronze == false) &&
                //            (bSilver == false) &&
                //            (bGold == false) &&
                //            (incidentInfo.bIsDeleted == false))
                //        {
                //            incidentInfo.bPersonalResponsibilityProgram = true;
                //            break;
                //        }
                //    }

                //    foreach (IncidentProgramInfo incidentInfo in lstIncidentProgramInfo)
                //    {
                //        if ((incidentInfo.IncidentProgramId == 4) &&
                //            (bBronze == false) &&
                //            (bSilver == false) &&
                //            (bGold == false) &&
                //            (bGoldPlus == false) &&
                //            (incidentInfo.bIsDeleted == false))
                //        {
                //            incidentInfo.bPersonalResponsibilityProgram = true;
                //            break;
                //        }
                //    }

                //    foreach (IncidentProgramInfo incidentInfo in lstIncidentProgramInfo)
                //    {
                //        if ((incidentInfo.IncidentProgramId == 5) &&
                //            (bBronze == false) &&
                //            (bSilver == false) &&
                //            (bGold == false) &&
                //            (bGoldPlus == false) &&
                //            (bGoldMed1 == false) &&
                //            (incidentInfo.bIsDeleted == false))
                //        {
                //            incidentInfo.bPersonalResponsibilityProgram = true;
                //            break;
                //        }
                //    }
                //}

                //foreach (IncidentProgramInfo incidentInfo in lstIncidentProgramInfo)
                //{
                //    if (incidentInfo.bPersonalResponsibilityProgram == true)
                //        PersonalResponsibilityAmountInMedBill = incidentInfo.PersonalResponsibilityAmount;
                //}

                /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                String strSqlQueryForSettlement = "select [dbo].[tbl_settlement].[Name], [dbo].[tbl_settlement_type_code].[SettlementTypeValue], [dbo].[tbl_settlement].[Amount], " +
                                                  "[dbo].[tbl_settlement].[PersonalResponsibilityCredit], [dbo].[tbl_payment_method].[PaymentMethod_Value], " +
                                                  "[dbo].[tbl_settlement].[Approved], [dbo].[tbl_settlement].[ApprovedDate], " +
                                                  "[dbo].[tbl_settlement].[CheckNo], [dbo].[tbl_settlement].[CheckDate], [dbo].[tbl_settlement].[CheckReconciled], " +
                                                  "[dbo].[tbl_settlement].[ACH_Number], [dbo].[tbl_settlement].[ACH_Date], [dbo].[tbl_settlement].[ACH_Reconciled], " +
                                                  "[dbo].[tbl_Credit_Card__c].[Name], [dbo].[tbl_settlement].[CMMCreditCardPaidDate], [dbo].[tbl_settlement].[CC_Reconciled], " +
                                                  "[dbo].[tbl_settlement].[AllowedAmount], [dbo].[tbl_settlement].[IneligibleReason], " +
                                                  "[dbo].[tbl_settlement].[Notes] " +
                                                  "from [dbo].[tbl_settlement] inner join [dbo].[tbl_settlement_type_code] " +
                                                  "on [dbo].[tbl_settlement].[SettlementType] = [dbo].[tbl_settlement_type_code].[SettlementTypeCode] " +
                                                  "inner join [dbo].[tbl_payment_method] on [dbo].[tbl_settlement].[CMMPaymentMethod] = [dbo].[tbl_payment_method].[PaymentMethod_Id] " +
                                                  "inner join [dbo].[tbl_Credit_Card__c] on [dbo].[tbl_settlement].[CMMCreditCard] = [dbo].[tbl_Credit_Card__c].[CreditCard_Id]" +
                                                  "where [dbo].[tbl_settlement].[MedicalBillID] = @MedBillNo and " +
                                                  "[dbo].[tbl_settlement].[IsDeleted] = 0 " +
                                                  "order by [dbo].[tbl_settlement].[Name]";

                SqlCommand cmdQueryForSettlement = new SqlCommand(strSqlQueryForSettlement, connRN4);
                cmdQueryForSettlement.CommandType = CommandType.Text;

                cmdQueryForSettlement.Parameters.AddWithValue("@MedBillNo", MedBillNo);

                SqlDependency dependencySettlementInMedBill = new SqlDependency(cmdQueryForSettlement);
                dependencySettlementInMedBill.OnChange += new OnChangeEventHandler(OnSettlementsInMedBillEditChange);

                //if (connRN.State == ConnectionState.Closed) connRN.Open();
                if (connRN4.State != ConnectionState.Closed)
                {
                    connRN4.Close();
                    connRN4.Open();
                }
                else if (connRN4.State == ConnectionState.Closed) connRN4.Open();
                SqlDataReader rdrSettlement = cmdQueryForSettlement.ExecuteReader();
                gvSettlementsInMedBill.Rows.Clear();
                if (rdrSettlement.HasRows)
                {
                    while (rdrSettlement.Read())
                    {
                        DataGridViewRow row = new DataGridViewRow();
                        row.Cells.Add(new DataGridViewCheckBoxCell { Value = false });
                        if (!rdrSettlement.IsDBNull(0)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlement.GetString(0) });
                        if (!rdrSettlement.IsDBNull(1))
                        {
                            DataGridViewComboBoxCell comboCellSettlementType = new DataGridViewComboBoxCell();

                            for (int i = 0; i < lstSettlementType.Count; i++)
                            {
                                comboCellSettlementType.Items.Add(lstSettlementType[i].SettlementTypeValue);
                            }
                            for (int i = 0; i < comboCellSettlementType.Items.Count; i++)
                            {
                                if (rdrSettlement.GetString(1) == comboCellSettlementType.Items[i].ToString())
                                    comboCellSettlementType.Value = comboCellSettlementType.Items[i];
                            }

                            row.Cells.Add(comboCellSettlementType);
                        }
                        else
                        {
                            DataGridViewComboBoxCell comboCellSettlementType = new DataGridViewComboBoxCell();
                            for (int i = 0; i < lstSettlementType.Count; i++)
                            {
                                comboCellSettlementType.Items.Add(lstSettlementType[i].SettlementTypeValue);
                            }

                            for (int i = 0; i < comboCellSettlementType.Items.Count; i++)
                            {
                                if (rdrSettlement.GetString(1) == comboCellSettlementType.Items[i].ToString())
                                    comboCellSettlementType.Value = comboCellSettlementType.Items[i];
                            }

                            row.Cells.Add(comboCellSettlementType);
                        }

                        if (!rdrSettlement.IsDBNull(2)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlement.GetDecimal(2).ToString("C") });
                        else
                        {
                            Decimal Zero = 0;
                            row.Cells.Add(new DataGridViewTextBoxCell { Value = Zero.ToString("C") });
                        }


                        if (!rdrSettlement.IsDBNull(3)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlement.GetDecimal(3).ToString("C") });
                        else
                        {
                            Decimal Zero = 0;
                            row.Cells.Add(new DataGridViewTextBoxCell { Value = Zero.ToString("C") });
                        }

                        /////////////////////////////////////////////////////////////////////
                        if (!rdrSettlement.IsDBNull(4))
                        {
                            DataGridViewComboBoxCell comboCellPaymentMethod = new DataGridViewComboBoxCell();

                            for (int i = 0; i < lstPaymentMethod.Count; i++)
                            {
                                if (lstPaymentMethod[i].PaymentMethodValue != null) comboCellPaymentMethod.Items.Add(lstPaymentMethod[i].PaymentMethodValue);
                                else comboCellPaymentMethod.Items.Add(String.Empty);
                            }

                            for (int i = 0; i < comboCellPaymentMethod.Items.Count; i++)
                            {
                                if (rdrSettlement.GetString(4) == comboCellPaymentMethod.Items[i].ToString())
                                    comboCellPaymentMethod.Value = comboCellPaymentMethod.Items[i];
                            }

                            row.Cells.Add(comboCellPaymentMethod);
                        }
                        else
                        {
                            DataGridViewComboBoxCell comboCellPaymentMethod = new DataGridViewComboBoxCell();

                            for (int i = 0; i < lstPaymentMethod.Count; i++)
                            {
                                if (lstPaymentMethod[i].PaymentMethodValue != null) comboCellPaymentMethod.Items.Add(lstPaymentMethod[i].PaymentMethodValue);
                                else comboCellPaymentMethod.Items.Add(String.Empty);
                                //comboCellPaymentMethod.Items.Add(lstPaymentMethod[i].PaymentMethodValue);
                            }

                            for (int i = 0; i < comboCellPaymentMethod.Items.Count; i++)
                            {
                                if ((!rdrSettlement.IsDBNull(4)) && comboCellPaymentMethod.Items[i] != null)
                                {
                                    if (rdrSettlement.GetString(4) == comboCellPaymentMethod.Items[i].ToString())
                                        comboCellPaymentMethod.Value = comboCellPaymentMethod.Items[i];
                                }
                                else comboCellPaymentMethod.Value = null;
                            }

                            row.Cells.Add(comboCellPaymentMethod);

                        }

                        /////////////////////////////////////////////////////////////////////
                        ///
                        if (!rdrSettlement.IsDBNull(5))
                        {
                            DataGridViewCheckBoxCell approvedCell = new DataGridViewCheckBoxCell();
                            approvedCell.Value = rdrSettlement.GetBoolean(5);
                            approvedCell.Style.Alignment = DataGridViewContentAlignment.MiddleCenter;
                            row.Cells.Add(approvedCell);
                            if (LoggedInUserRole == UserRole.RNStaff ||
                                LoggedInUserRole == UserRole.NPStaff ||
                                LoggedInUserRole == UserRole.FDStaff ||
                                LoggedInUserRole == UserRole.MSStaff)
                                row.Cells[6].ReadOnly = true;
                            else if (LoggedInUserRole == UserRole.RNManager ||
                                     LoggedInUserRole == UserRole.NPManager ||
                                     LoggedInUserRole == UserRole.FDManager ||
                                     LoggedInUserRole == UserRole.MSManager ||
                                     LoggedInUserRole == UserRole.Administrator ||
                                     LoggedInUserRole == UserRole.SuperAdmin ||
                                     LoggedInUserRole == UserRole.Executive)
                                row.Cells[6].ReadOnly = false;
                        }
                        else
                        {
                            DataGridViewCheckBoxCell approvedCell = new DataGridViewCheckBoxCell();
                            approvedCell.Value = false;
                            approvedCell.Style.Alignment = DataGridViewContentAlignment.MiddleCenter;
                            row.Cells.Add(approvedCell);
                            if (LoggedInUserRole == UserRole.RNStaff ||
                                LoggedInUserRole == UserRole.NPStaff ||
                                LoggedInUserRole == UserRole.FDStaff ||
                                LoggedInUserRole == UserRole.MSStaff)
                                row.Cells[6].ReadOnly = true;
                            else if (LoggedInUserRole == UserRole.RNManager ||
                                     LoggedInUserRole == UserRole.NPManager ||
                                     LoggedInUserRole == UserRole.FDManager ||
                                     LoggedInUserRole == UserRole.MSManager ||
                                     LoggedInUserRole == UserRole.Administrator ||
                                     LoggedInUserRole == UserRole.SuperAdmin ||
                                     LoggedInUserRole == UserRole.Executive)
                                row.Cells[6].ReadOnly = false;
                        }

                        if (!rdrSettlement.IsDBNull(6))
                        {
                            row.Cells.Add(new CalendarCell { Value = DateTime.Parse(rdrSettlement.GetDateTime(6).ToString("MM/dd/yyyy")) });
                            row.Cells[7].ReadOnly = true;
                        }
                        else
                        {
                            row.Cells.Add(new CalendarCell { Value = null });
                            row.Cells[7].ReadOnly = true;
                        }

                        // Payment information
                        if (!rdrSettlement.IsDBNull(4))
                        {
                            String strPaymentMethod = rdrSettlement.GetString(4);

                            switch (strPaymentMethod)
                            {
                                case "Check":
                                    if (!rdrSettlement.IsDBNull(7)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlement.GetString(7) });
                                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = null });
                                    row.Cells.Add(new DataGridViewTextBoxCell { Value = null });
                                    DataGridViewComboBoxCell comboCellCreditCardNoneForCheck = new DataGridViewComboBoxCell();
                                    for (int i = 0; i < lstCreditCardInfo.Count; i++)
                                    {
                                        if (lstCreditCardInfo[i].CreditCardNo != null) comboCellCreditCardNoneForCheck.Items.Add(lstCreditCardInfo[i].CreditCardNo);
                                        else comboCellCreditCardNoneForCheck.Items.Add(String.Empty);
                                    }
                                    row.Cells.Add(comboCellCreditCardNoneForCheck);
                                    if (!rdrSettlement.IsDBNull(8))
                                    {
                                        row.Cells.Add(new CalendarCell { Value = DateTime.Parse(rdrSettlement.GetDateTime(8).ToString("MM/dd/yyyy")) });
                                    }
                                    else
                                    {
                                        row.Cells.Add(new CalendarCell { Value = String.Empty });
                                    }
                                    if (!rdrSettlement.IsDBNull(9))
                                    {
                                        row.Cells.Add(new DataGridViewCheckBoxCell { Value = rdrSettlement.GetBoolean(9) });
                                    }
                                    else
                                    {
                                        row.Cells.Add(new DataGridViewCheckBoxCell { Value = null });
                                    }
                                    break;
                                case "ACH/Banking":
                                    row.Cells.Add(new DataGridViewTextBoxCell { Value = null });
                                    if (!rdrSettlement.IsDBNull(10)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlement.GetString(10) });
                                    else row.Cells.Add(new DataGridViewTextBoxCell { Value = null });
                                    DataGridViewComboBoxCell comboCellCreditCardNoneForACH = new DataGridViewComboBoxCell();
                                    for (int i = 0; i < lstCreditCardInfo.Count; i++)
                                    {
                                        if (lstCreditCardInfo[i].CreditCardNo != null)
                                            comboCellCreditCardNoneForACH.Items.Add(lstCreditCardInfo[i].CreditCardNo);
                                        else comboCellCreditCardNoneForACH.Items.Add(String.Empty);
                                    }
                                    row.Cells.Add(comboCellCreditCardNoneForACH);
                                    if (!rdrSettlement.IsDBNull(11))
                                    {
                                        row.Cells.Add(new CalendarCell { Value = DateTime.Parse(rdrSettlement.GetDateTime(11).ToString("MM/dd/yyyy")) });
                                    }
                                    else
                                    {
                                        row.Cells.Add(new CalendarCell { Value = String.Empty });
                                    }
                                    if (!rdrSettlement.IsDBNull(12))
                                    {
                                        row.Cells.Add(new DataGridViewCheckBoxCell { Value = rdrSettlement.GetBoolean(12) });
                                    }
                                    else
                                    {
                                        row.Cells.Add(new DataGridViewCheckBoxCell { Value = null });
                                    }
                                    break;
                                case "Credit Card":
                                    row.Cells.Add(new DataGridViewTextBoxCell { Value = null });
                                    row.Cells.Add(new DataGridViewTextBoxCell { Value = null });
                                    DataGridViewComboBoxCell comboCellCreditCard = new DataGridViewComboBoxCell();
                                    if (!rdrSettlement.IsDBNull(13))
                                    {
                                        for (int i = 0; i < lstCreditCardInfo.Count; i++)
                                        {
                                            if (lstCreditCardInfo[i].CreditCardNo != null) comboCellCreditCard.Items.Add(lstCreditCardInfo[i].CreditCardNo);
                                            else comboCellCreditCard.Items.Add(String.Empty);
                                        }
                                        for (int i = 0; i < comboCellCreditCard.Items.Count; i++)
                                        {
                                            if (rdrSettlement.GetString(13) == comboCellCreditCard.Items[i].ToString())
                                                comboCellCreditCard.Value = comboCellCreditCard.Items[i];
                                        }
                                    }
                                    else
                                    {
                                        //DataGridViewComboBoxCell comboCellCreditCard = new DataGridViewComboBoxCell();
                                        for (int i = 0; i < lstCreditCardInfo.Count; i++)
                                        {
                                            if (lstCreditCardInfo[i].CreditCardNo != null) comboCellCreditCard.Items.Add(lstCreditCardInfo[i].CreditCardNo);
                                            else comboCellCreditCard.Items.Add(String.Empty);
                                        }
                                        comboCellCreditCard.Value = String.Empty;
                                        //row.Cells.Add(comboCellCreditCard);
                                    }
                                    row.Cells.Add(comboCellCreditCard);
                                    if (!rdrSettlement.IsDBNull(14)) row.Cells.Add(new CalendarCell { Value = DateTime.Parse(rdrSettlement.GetDateTime(14).ToString("MM/dd/yyyy")) });
                                    else row.Cells.Add(new CalendarCell { Value = String.Empty });
                                    if (!rdrSettlement.IsDBNull(15)) row.Cells.Add(new DataGridViewCheckBoxCell { Value = rdrSettlement.GetBoolean(15) });
                                    else row.Cells.Add(new DataGridViewCheckBoxCell { Value = false });
                                    break;
                                default:
                                    row.Cells.Add(new DataGridViewTextBoxCell { Value = null });
                                    row.Cells.Add(new DataGridViewTextBoxCell { Value = null });
                                    DataGridViewComboBoxCell comboCellCreditCardNone = new DataGridViewComboBoxCell();
                                    for (int i = 0; i < lstCreditCardInfo.Count; i++)
                                    {
                                        if (lstCreditCardInfo[i].CreditCardNo != null) comboCellCreditCardNone.Items.Add(lstCreditCardInfo[i].CreditCardNo);
                                        else comboCellCreditCardNone.Items.Add(String.Empty);
                                    }
                                    row.Cells.Add(comboCellCreditCardNone);
                                    row.Cells.Add(new CalendarCell { Value = null });
                                    row.Cells.Add(new DataGridViewCheckBoxCell { Value = null });
                                    break;
                            }
                        }
                        else
                        {

                            DataGridViewTextBoxCell txtCheckNoCell = new DataGridViewTextBoxCell();
                            txtCheckNoCell.Value = null;
                            row.Cells.Add(txtCheckNoCell);
                            DataGridViewTextBoxCell txtACHNoCell = new DataGridViewTextBoxCell();
                            txtACHNoCell.Value = null;
                            row.Cells.Add(txtACHNoCell);
                            DataGridViewComboBoxCell comboCreditCardCell = new DataGridViewComboBoxCell();
                            for (int i = 0; i < lstCreditCardInfo.Count; i++)
                            {
                                if (lstCreditCardInfo[i].CreditCardNo != null) comboCreditCardCell.Items.Add(lstCreditCardInfo[i].CreditCardNo);
                                else comboCreditCardCell.Items.Add(String.Empty);
                            }
                            row.Cells.Add(comboCreditCardCell);
                            comboCreditCardCell.ReadOnly = true;
                            CalendarCell calPaymentDate = new CalendarCell();
                            calPaymentDate.Value = null;
                            row.Cells.Add(calPaymentDate);
                            DataGridViewCheckBoxCell chkReconciledCell = new DataGridViewCheckBoxCell();
                            chkReconciledCell.Value = false;
                            row.Cells.Add(chkReconciledCell);

                        }


                        if (!rdrSettlement.IsDBNull(16)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlement.GetDecimal(16).ToString("C") });
                        else row.Cells.Add(new DataGridViewTextBoxCell { Value = null });

                        if (!rdrSettlement.IsDBNull(17))
                        {
                            if (dicIneligibleReason.Count > 0)
                            {
                                DataGridViewComboBoxCell comboCellIneligibleReason = new DataGridViewComboBoxCell();
                                for (int i = 0; i < dicIneligibleReason.Count; i++)
                                {
                                    comboCellIneligibleReason.Items.Add(dicIneligibleReason[i]);
                                }
                                //comboCellIneligibleReason.Sorted = true;
                                comboCellIneligibleReason.Value = comboCellIneligibleReason.Items[rdrSettlement.GetInt32(17)];
                                row.Cells.Add(comboCellIneligibleReason);
                            }
                        }
                        else
                        {
                            if (dicIneligibleReason.Count > 0)
                            {
                                DataGridViewComboBoxCell comboCellIneligibleReason = new DataGridViewComboBoxCell();
                                for (int i = 0; i < dicIneligibleReason.Count; i++)
                                {
                                    comboCellIneligibleReason.Items.Add(dicIneligibleReason[i]);
                                }
                                //comboCellIneligibleReason.Sorted = true;
                                comboCellIneligibleReason.Value = comboCellIneligibleReason.Items[0];
                                row.Cells.Add(comboCellIneligibleReason);
                            }
                        }

                        if (!rdrSettlement.IsDBNull(18)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrSettlement.GetString(18) });
                        else row.Cells.Add(new DataGridViewTextBoxCell { Value = null });

                        gvSettlementsInMedBill.Rows.Add(row);
                        //AddNewRowToGVSettlementSafely(row);
                    }
                }
                rdrSettlement.Close();
                if (connRN4.State != ConnectionState.Closed) connRN4.Close();

                for (int i = 0; i < gvSettlementsInMedBill.Rows.Count; i++)
                {
                    if (gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "3rd Party Discount" ||
                        gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "Member Payment" ||
                        gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "CMM Discount" ||
                        gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "Ineligible" ||
                        gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "Medical Provider Refund" ||
                        gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "Member Discount")
                    {
                        gvSettlementsInMedBill["Approved", i].Value = false;
                        gvSettlementsInMedBill["Approved", i].ReadOnly = true;
                    }

                    gvSettlementsInMedBill["ApprovedDate", i].ReadOnly = true;
                }

                ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                ///

                for (int i = 0; i < gvSettlementsInMedBill.Rows.Count; i++)
                {
                    if (gvSettlementsInMedBill["PaymentMethod", i]?.Value?.ToString() == "Check")
                    {
                        gvSettlementsInMedBill.Rows[i].Cells["CheckNo"].ReadOnly = false;
                        gvSettlementsInMedBill.Rows[i].Cells["PaymentDate"].ReadOnly = false;
                        gvSettlementsInMedBill.Rows[i].Cells["Reconciled"].ReadOnly = false;
                        gvSettlementsInMedBill.Rows[i].Cells["ACHNo"].ReadOnly = true;
                        gvSettlementsInMedBill.Rows[i].Cells["CreditCard"].ReadOnly = true;
                    }

                    if (gvSettlementsInMedBill["PaymentMethod", i]?.Value?.ToString() == "ACH/Banking")
                    {
                        gvSettlementsInMedBill.Rows[i].Cells["ACHNo"].ReadOnly = false;
                        gvSettlementsInMedBill.Rows[i].Cells["PaymentDate"].ReadOnly = false;
                        gvSettlementsInMedBill.Rows[i].Cells["Reconciled"].ReadOnly = false;
                        gvSettlementsInMedBill.Rows[i].Cells["CheckNo"].ReadOnly = true;
                        gvSettlementsInMedBill.Rows[i].Cells["CreditCard"].ReadOnly = true;
                    }

                    if (gvSettlementsInMedBill["PaymentMethod", i]?.Value?.ToString() == "Credit Card")
                    {
                        gvSettlementsInMedBill.Rows[i].Cells["CreditCard"].ReadOnly = false;
                        gvSettlementsInMedBill.Rows[i].Cells["PaymentDate"].ReadOnly = false;
                        gvSettlementsInMedBill.Rows[i].Cells["Reconciled"].ReadOnly = false;
                        gvSettlementsInMedBill.Rows[i].Cells["CheckNo"].ReadOnly = true;
                        gvSettlementsInMedBill.Rows[i].Cells["ACHNo"].ReadOnly = true;
                    }
                    if (gvSettlementsInMedBill["PaymentMethod", i]?.Value == null)
                    {
                        gvSettlementsInMedBill.Rows[i].Cells["CheckNo"].ReadOnly = true;
                        gvSettlementsInMedBill.Rows[i].Cells["ACHNo"].ReadOnly = true;
                        gvSettlementsInMedBill.Rows[i].Cells["CreditCard"].ReadOnly = true;
                        gvSettlementsInMedBill.Rows[i].Cells["PaymentDate"].ReadOnly = true;
                        gvSettlementsInMedBill.Rows[i].Cells["Reconciled"].ReadOnly = true;
                    }
                }

                for (int i = 0; i < gvSettlementsInMedBill.Rows.Count; i++)
                {
                    if (gvSettlementsInMedBill[2, i]?.Value?.ToString() == "Ineligible") gvSettlementsInMedBill.Rows[i].DefaultCellStyle.BackColor = Color.Salmon;
                    else
                    {
                        gvSettlementsInMedBill["IneligibleReason", i].Value = null;
                        gvSettlementsInMedBill["IneligibleReason", i].ReadOnly = true;
                    }
                }

                if (txtMedBillAmount.Text.Trim() != String.Empty)
                {
                    Decimal SettlementTotal = 0;
                    Decimal Balance = 0;
                    Decimal Result = 0;
                    Decimal BillAmount = 0;
                    if (Decimal.TryParse(txtMedBillAmount.Text.Trim(), NumberStyles.Currency, new CultureInfo("en-US"), out Result))
                    {
                        BillAmount = Result;

                        for (int i = 0; i < gvSettlementsInMedBill.Rows.Count; i++)
                        {
                            if (gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() != "PR Reimbursement" &&
                                gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() != "Medical Provider Refund")
                            {
                                Decimal Settlement = Decimal.Parse(gvSettlementsInMedBill["SettlementAmount", i]?.Value?.ToString(), NumberStyles.Currency, new CultureInfo("en-US"));
                                SettlementTotal += Settlement;
                            }
                        }
                        if (SettlementTotal > BillAmount) MessageBox.Show("Settlement Total exceeds the Medical Bill Amount.", "Alert");
                        else
                        {
                            Balance = BillAmount - SettlementTotal;
                            txtBalance.Text = Balance.ToString("C");
                        }
                    }
                }

                Decimal TotalSharedAmount = 0;
                //if (gvSettlementsInMedBill.Rows.Count == 0) txtTotalSharedAmtMedBill.Text = TotalSharedAmount.ToString("C");
                txtTotalSharedAmtMedBill.Text = TotalSharedAmount.ToString("C");

                for (int i = 0; i < gvSettlementsInMedBill.Rows.Count; i++)
                {
                    Decimal SharedAmount = 0;
                    Decimal MedicalProviderRefund = 0;
                    Decimal result = 0;

                    if (gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "CMM Provider Payment" ||
                        gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "CMM Member Reimbursement" ||
                        gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "PR Reimbursement")
                    {
                        if (Decimal.TryParse(gvSettlementsInMedBill["SettlementAmount", i].Value.ToString(), NumberStyles.Currency, new CultureInfo("en-US"), out result))
                        {
                            SharedAmount = result;
                            TotalSharedAmount += SharedAmount;
                            txtTotalSharedAmtMedBill.Text = TotalSharedAmount.ToString("C");
                        }
                    }
                    else if (gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "Medical Provider Refund")
                    {
                        if (Decimal.TryParse(gvSettlementsInMedBill["SettlementAmount", i]?.Value?.ToString(), NumberStyles.Currency, new CultureInfo("en-US"), out result))
                        {
                            MedicalProviderRefund = result;
                            TotalSharedAmount -= MedicalProviderRefund;
                            txtTotalSharedAmtMedBill.Text = TotalSharedAmount.ToString("C");
                        }
                    }
                }

                //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                ///

                Decimal PersonResponsibilityAmt = PersonalResponsibilityAmountInMedBill;
                Decimal PersonalResponsibilityBalance = PersonalResponsibilityAmountInMedBill;
                Decimal TotalPersonalResponsibilityShared = 0;

                for (int i = 0; i < gvSettlementsInMedBill.Rows.Count; i++)
                {
                    Decimal PersonalResponsibilityShared = 0;
                    Decimal result = 0;

                    if (gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "Self Pay Discount" ||
                        gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "3rd Party Discount" ||
                        gvSettlementsInMedBill["SettlementTypeValue", i]?.Value?.ToString() == "Member Payment")
                    {
                        if (Decimal.TryParse(gvSettlementsInMedBill["PersonalResponsibility", i]?.Value?.ToString(), NumberStyles.Currency, new CultureInfo("en-US"), out result))
                        {
                            PersonalResponsibilityShared = result;
                            TotalPersonalResponsibilityShared += PersonalResponsibilityShared;
                            PersonalResponsibilityBalance -= TotalPersonalResponsibilityShared;
                        }
                    }
                }

                txtPersonalResponsibility.Text = PersonalResponsibilityBalance.ToString("C");

                // Populate Task GridView

                MedBillNoForTask = gvSettlementSearched[1, e.RowIndex].Value.ToString();
                String strSqlQueryForTaskInMedBill = "select [dbo].[tbl_task].[Subject], [dbo].[tbl_task].[DueDate], [dbo].[tbl_user].[User_Name], [dbo].[tbl_task_status_code].[TaskStatusValue], " +
                                                     "[dbo].[tbl_task].[id] " +
                                                     "from [dbo].[tbl_task] " +
                                                     "inner join [dbo].[tbl_user] on [dbo].[tbl_task].[AssignedTo] = [dbo].[tbl_user].[User_Id] " +
                                                     "inner join [dbo].[tbl_task_status_code] on [dbo].[tbl_task].[Status] = [dbo].[tbl_task_status_code].[TaskStatusCode] " +
                                                     "where [dbo].[tbl_task].[whatid] = @MedBillNo " +
                                                     "order by [dbo].[tbl_task].[CreateDate] desc";

                SqlCommand cmdQueryForTask = new SqlCommand(strSqlQueryForTaskInMedBill, connRN4);
                cmdQueryForTask.CommandType = CommandType.Text;

                cmdQueryForTask.Parameters.AddWithValue("@MedBillNo", MedBillNoForTask);

                SqlDependency dependencyTask = new SqlDependency(cmdQueryForTask);
                dependencyTask.OnChange += new OnChangeEventHandler(OnTaskInMedBillChange);

                if (connRN4.State != ConnectionState.Closed)
                {
                    connRN4.Close();
                    connRN4.Open();
                }
                else if (connRN4.State == ConnectionState.Closed) connRN4.Open();

                SqlDataReader rdrTaskForMedBill = cmdQueryForTask.ExecuteReader();
                gvMostRecentTasks.Rows.Clear();
                if (rdrTaskForMedBill.HasRows)
                {
                    while (rdrTaskForMedBill.Read())
                    {
                        DataGridViewRow row = new DataGridViewRow();
                        if (!rdrTaskForMedBill.IsDBNull(0)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrTaskForMedBill.GetString(0) });
                        else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                        if (!rdrTaskForMedBill.IsDBNull(1)) row.Cells.Add(new CalendarCell { Value = rdrTaskForMedBill.GetDateTime(1).ToString("MM/dd/yyyy") });
                        else row.Cells.Add(new CalendarCell { Value = String.Empty });
                        if (!rdrTaskForMedBill.IsDBNull(2)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrTaskForMedBill.GetString(2) });
                        else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                        if (!rdrTaskForMedBill.IsDBNull(3)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrTaskForMedBill.GetString(3) });
                        else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });
                        if (!rdrTaskForMedBill.IsDBNull(4)) row.Cells.Add(new DataGridViewTextBoxCell { Value = rdrTaskForMedBill.GetInt32(4).ToString() });
                        else row.Cells.Add(new DataGridViewTextBoxCell { Value = String.Empty });

                        gvMostRecentTasks.Rows.Add(row);
                    }
                }
                rdrTaskForMedBill.Close();

                if (connRN4.State == ConnectionState.Open) connRN4.Close();

                //EnableMedicalBillForm();
                //btnMedBillCreatePgUpperSave.Enabled = true;
                ////btnMedBillCreationPgLowerSave.Enabled = true;

                //if (bMedBillInUse)
                //{
                //    DisableMedicalBillForm();

                //    EnableGroupDocumentProcessingForViewing();
                //    EnableGroupMedBillDocumentsForViewing();

                //}

                tbCMMManager.SelectedTab = tbpgMedicalBill;
                //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                //if (!tbCMMManager.TabPages.Contains(tbpgMedicalBill))
                //{
                //    tbCMMManager.TabPages.Add(tbpgMedicalBill);
                //    tbCMMManager.SelectedTab = tbpgMedicalBill;
                //}
                //else
                //{
                //    MessageBox.Show("Medical Bill page is already open. Close Medical Bill page first.", "Alert");
                //    return;
                //}
                ///////////////////////////////////////////////////////////////////////////////////////////////////////////////
                ///

                if (LoggedInUserRole == UserRole.Administrator || LoggedInUserRole == UserRole.SuperAdmin)
                {
                    EnableMedicalBillForm();
                }

                if (LoggedInUserRole == UserRole.NPManager || LoggedInUserRole == UserRole.NPStaff)
                {
                    DisableMedicalBillForm();

                    EnableGroupDocumentProcessingForViewing();
                    EnableGroupMedBillDocumentsForViewing();
                }

                if (LoggedInUserRole == UserRole.FDManager || LoggedInUserRole == UserRole.FDStaff)
                {
                    DisableMedicalBillForm();

                    EnableGroupDocumentProcessingForViewing();
                    EnableGroupMedBillDocumentsForViewing();

                    if (bMedBillInUse == false)
                    {
                        gvSettlementsInMedBill.Enabled = true;

                        for (int i = 0; i < gvSettlementsInMedBill.Rows.Count; i++)
                        {
                            for (int j = 0; j < gvSettlementsInMedBill.Columns.Count; j++) gvSettlementsInMedBill[j, i].ReadOnly = true;
                        }

                        for (int i = 0; i < gvSettlementsInMedBill.Rows.Count; i++)
                        {
                            gvSettlementsInMedBill[8, i].ReadOnly = false;
                            gvSettlementsInMedBill[9, i].ReadOnly = false;
                            gvSettlementsInMedBill[10, i].ReadOnly = false;
                            gvSettlementsInMedBill[12, i].ReadOnly = false;
                            gvSettlementsInMedBill[15, i].ReadOnly = false;
                        }
                    }
                }

                if (LoggedInUserRole == UserRole.RNManager)
                {
                    if (bMedBillInUse)
                    {
                        DisableMedicalBillForm();

                        EnableGroupDocumentProcessingForViewing();
                        EnableGroupMedBillDocumentsForViewing();
                    }
                    else
                    {
                        EnableMedicalBillForm();

                        for (int i = 0; i < gvSettlementsInMedBill.Rows.Count; i++)
                        {
                            for (int j = 0; j < gvSettlementsInMedBill.Columns.Count; j++) gvSettlementsInMedBill[j, i].ReadOnly = true;
                        }

                        for (int i = 0; i < gvSettlementsInMedBill.Rows.Count; i++)
                        {
                            gvSettlementsInMedBill[0, i].ReadOnly = false;
                            gvSettlementsInMedBill[2, i].ReadOnly = false;
                            gvSettlementsInMedBill[3, i].ReadOnly = false;
                            gvSettlementsInMedBill[4, i].ReadOnly = false;
                            gvSettlementsInMedBill[5, i].ReadOnly = false;
                            gvSettlementsInMedBill[6, i].ReadOnly = false;
                            gvSettlementsInMedBill[14, i].ReadOnly = false;
                            gvSettlementsInMedBill[15, i].ReadOnly = false;
                        }

                    }
                }

                if (LoggedInUserRole == UserRole.RNStaff)
                {
                    if (bMedBillInUse)
                    {
                        DisableMedicalBillForm();

                        EnableGroupDocumentProcessingForViewing();
                        EnableGroupMedBillDocumentsForViewing();
                    }
                    else
                    {
                        EnableMedicalBillForm();

                        for (int i = 0; i < gvSettlementsInMedBill.Rows.Count; i++)
                        {
                            for (int j = 0; j < gvSettlementsInMedBill.Columns.Count; j++) gvSettlementsInMedBill[j, i].ReadOnly = true;
                        }

                        for (int i = 0; i < gvSettlementsInMedBill.Rows.Count; i++)
                        {
                            gvSettlementsInMedBill[0, i].ReadOnly = false;
                            gvSettlementsInMedBill[2, i].ReadOnly = false;
                            gvSettlementsInMedBill[3, i].ReadOnly = false;
                            gvSettlementsInMedBill[4, i].ReadOnly = false;
                            gvSettlementsInMedBill[5, i].ReadOnly = false;
                            gvSettlementsInMedBill[14, i].ReadOnly = false;
                            gvSettlementsInMedBill[15, i].ReadOnly = false;
                        }
                    }
                }





                ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                //if (LoggedInUserRole == UserRole.NPManager || LoggedInUserRole == UserRole.NPStaff)
                //{
                //    DisableMedicalBillForm();

                //    EnableGroupDocumentProcessingForViewing();
                //    EnableGroupMedBillDocumentsForViewing();
                //}

                //if (LoggedInUserRole == UserRole.FDManager || LoggedInUserRole == UserRole.FDStaff)
                //{
                //    DisableMedicalBillForm();

                //    EnableGroupDocumentProcessingForViewing();
                //    EnableGroupMedBillDocumentsForViewing();

                //    if (bMedBillInUse == false)
                //    {
                //        gvSettlementsInMedBill.Enabled = true;

                //        for (int i = 0; i < gvSettlementsInMedBill.Rows.Count; i++)
                //        {
                //            for (int j = 0; j < gvSettlementsInMedBill.Columns.Count; j++) gvSettlementsInMedBill[j, i].ReadOnly = true;
                //        }

                //        for (int i = 0; i < gvSettlementsInMedBill.Rows.Count; i++)
                //        {
                //            gvSettlementsInMedBill[8, i].ReadOnly = false;
                //            gvSettlementsInMedBill[9, i].ReadOnly = false;
                //            gvSettlementsInMedBill[10, i].ReadOnly = false;
                //            gvSettlementsInMedBill[12, i].ReadOnly = false;
                //            gvSettlementsInMedBill[15, i].ReadOnly = false;
                //        }
                //    }
                //}

                //if (LoggedInUserRole == UserRole.RNManager)
                //{
                //    if (bMedBillInUse)
                //    {
                //        DisableMedicalBillForm();

                //        EnableGroupDocumentProcessingForViewing();
                //        EnableGroupMedBillDocumentsForViewing();
                //    }
                //    else
                //    {
                //        EnableMedicalBillForm();

                //        for (int i = 0; i < gvSettlementsInMedBill.Rows.Count; i++)
                //        {
                //            for (int j = 0; j < gvSettlementsInMedBill.Columns.Count; j++) gvSettlementsInMedBill[j, i].ReadOnly = true;
                //        }

                //        for (int i = 0; i < gvSettlementsInMedBill.Rows.Count; i++)
                //        {
                //            gvSettlementsInMedBill[0, i].ReadOnly = false;
                //            gvSettlementsInMedBill[2, i].ReadOnly = false;
                //            gvSettlementsInMedBill[3, i].ReadOnly = false;
                //            gvSettlementsInMedBill[4, i].ReadOnly = false;
                //            gvSettlementsInMedBill[5, i].ReadOnly = false;
                //            gvSettlementsInMedBill[6, i].ReadOnly = false;
                //            gvSettlementsInMedBill[14, i].ReadOnly = false;
                //            gvSettlementsInMedBill[15, i].ReadOnly = false;
                //        }

                //    }
                //}

                //if (LoggedInUserRole == UserRole.RNStaff)
                //{
                //    if (bMedBillInUse)
                //    {
                //        DisableMedicalBillForm();

                //        EnableGroupDocumentProcessingForViewing();
                //        EnableGroupMedBillDocumentsForViewing();
                //    }
                //    else
                //    {
                //        EnableMedicalBillForm();

                //        for (int i = 0; i < gvSettlementsInMedBill.Rows.Count; i++)
                //        {
                //            for (int j = 0; j < gvSettlementsInMedBill.Columns.Count; j++) gvSettlementsInMedBill[j, i].ReadOnly = true;
                //        }

                //        for (int i = 0; i < gvSettlementsInMedBill.Rows.Count; i++)
                //        {
                //            gvSettlementsInMedBill[0, i].ReadOnly = false;
                //            gvSettlementsInMedBill[2, i].ReadOnly = false;
                //            gvSettlementsInMedBill[3, i].ReadOnly = false;
                //            gvSettlementsInMedBill[4, i].ReadOnly = false;
                //            gvSettlementsInMedBill[5, i].ReadOnly = false;
                //            gvSettlementsInMedBill[14, i].ReadOnly = false;
                //            gvSettlementsInMedBill[15, i].ReadOnly = false;
                //        }
                //    }
                //}
            }



            //String MedBillNoSelected = gvMedBillSearched[0, e.RowIndex]?.Value?.ToString();

            //String strSqlQueryForCaseNo = "select [dbo].[tbl_medbill].[Case_Id] from [dbo].[tbl_medbill] where [dbo].[tbl_medbill].[BillNo] = @MedBillNo";

            //SqlCommand cmdQueryForCaseNo = new SqlCommand(strSqlQueryForCaseNo, connRN2);
            //cmdQueryForCaseNo.CommandType = CommandType.Text;

            //cmdQueryForCaseNo.Parameters.AddWithValue("@MedBillNo", MedBillNoSelected);

            //if (connRN2.State != ConnectionState.Closed)
            //{
            //    connRN2.Close();
            //    connRN2.Open();
            //}
            //else if (connRN2.State == ConnectionState.Closed) connRN2.Open();
            //Object objCaseId = cmdQueryForCaseNo.ExecuteScalar();
            //if (connRN2.State != ConnectionState.Closed) connRN2.Close();

            //String strCaseId = objCaseId?.ToString();

            //String strSqlQueryForCaseDetail = "select ";
        }

        private void btnReconcile_Click(object sender, EventArgs e)
        {

            frmConfirmCheckReconcile frmReconcile = new frmConfirmCheckReconcile();

            frmReconcile.StartPosition = FormStartPosition.CenterScreen;

            if (frmReconcile.ShowDialog() == DialogResult.Yes)
            {
                List<String> lstClearedSettlements = new List<string>();

                for (int i = 0; i < gvCheckReconcilation.Rows.Count; i++)
                {
                    if (Boolean.Parse(gvCheckReconcilation["CheckCleared", i]?.Value?.ToString()) == true)
                    {
                        lstClearedSettlements.Add(gvCheckReconcilation["CheckPaidSettlementNo", i]?.Value?.ToString());
                    }
                }

                Boolean bSettlementReconciled = true;

                foreach (String settlementNo in lstClearedSettlements)
                {
                    String strSqlUpdateSettlementReconcile = "update [dbo].[tbl_settlement] set [dbo].[tbl_settlement].[CheckReconciled] = 1 where [dbo].[tbl_settlement].[Name] = @SettlementNo";

                    SqlCommand cmdUpdateSettlementReconcile = new SqlCommand(strSqlUpdateSettlementReconcile, connRN7);
                    cmdUpdateSettlementReconcile.CommandType = CommandType.Text;

                    cmdUpdateSettlementReconcile.Parameters.AddWithValue("@SettlementNo", settlementNo);

                    if (connRN7.State != ConnectionState.Closed)
                    {
                        connRN7.Close();
                        connRN7.Open();
                    }
                    else if (connRN7.State == ConnectionState.Closed) connRN7.Open();
                    int nSettlementUpdated = cmdUpdateSettlementReconcile.ExecuteNonQuery();
                    if (connRN7.State != ConnectionState.Closed) connRN7.Close();

                    if (nSettlementUpdated != 1) bSettlementReconciled = false;
                }

                if (bSettlementReconciled != true)
                {
                    MessageBox.Show("At least one of settlement was not reconciled.", "Error");
                    return;
                }
            }
            else
            {
                MessageBox.Show("The selected settlement have not benn reconciled.", "Alert");
                return;
            }
        }

        private void gvCheckReconcilation_ColumnHeaderMouseDoubleClick(object sender, DataGridViewCellMouseEventArgs e)
        {
            Boolean bAllPaidCheckSelected = true;

            DataGridView gvPaidCheckSettlement = sender as DataGridView;

            if (e.ColumnIndex == 0)
            {
                for (int i = 0; i < gvPaidCheckSettlement.Rows.Count; i++)
                {
                    if (Boolean.Parse(gvPaidCheckSettlement["CheckCleared", i]?.Value?.ToString()) == false) bAllPaidCheckSelected = false;
                }

                if (bAllPaidCheckSelected == false)
                {
                    for (int i = 0; i < gvPaidCheckSettlement.Rows.Count; i++)
                    {
                        gvPaidCheckSettlement["CheckCleared", i].Value = true;
                    }
                }
                else if (bAllPaidCheckSelected == true)
                {
                    for (int i = 0; i < gvPaidCheckSettlement.Rows.Count; i++)
                    {
                        gvPaidCheckSettlement["CheckCleared", i].Value = false;
                    }
                }
            }
        }

        private void gvCheckReconcilation_CellContentClick(object sender, DataGridViewCellEventArgs e)
        {
            DataGridView gvPaidCheckSettlement = sender as DataGridView;

            if (e.ColumnIndex == 0 && e.RowIndex >= 0)
            {
                if (Boolean.Parse(gvPaidCheckSettlement[e.ColumnIndex, e.RowIndex]?.Value?.ToString()) == true)
                {
                    gvPaidCheckSettlement[e.ColumnIndex, e.RowIndex].Value = false;
                    return;
                }
                else
                {
                    gvPaidCheckSettlement[e.ColumnIndex, e.RowIndex].Value = true;
                    return;
                }
            }
        }

        private void btnRefreshListMedicalProvider_Click(object sender, EventArgs e)
        {
            Cursor.Current = Cursors.WaitCursor;

            String strSqlQueryForMedicalProvider = "select [dbo].[account].[Id], [dbo].[account].[Name], [dbo].[account].[Type] from [dbo].[account] " +
                                   "where [dbo].[account].[RecordTypeId] = '01237000000EVmlAAG'";

            SqlCommand cmdQueryForMedicalProvider = new SqlCommand(strSqlQueryForMedicalProvider, connSalesforce);
            cmdQueryForMedicalProvider.CommandType = CommandType.Text;

            //if (connRN.State == ConnectionState.Closed) connRN.Open();
            if (connSalesforce.State != ConnectionState.Closed)
            {
                connSalesforce.Close();
                connSalesforce.Open();
            }
            else if (connSalesforce.State == ConnectionState.Closed) connSalesforce.Open();

            SqlDataReader rdrMedicalProvider = cmdQueryForMedicalProvider.ExecuteReader();

            lstMedicalProvider.Clear();
            if (rdrMedicalProvider.HasRows)
            {
                while (rdrMedicalProvider.Read())
                {
                    MedicalProviderInfo info = new MedicalProviderInfo();

                    if (!rdrMedicalProvider.IsDBNull(0)) info.ID = rdrMedicalProvider.GetString(0);
                    if (!rdrMedicalProvider.IsDBNull(1)) info.Name = rdrMedicalProvider.GetString(1);
                    if (!rdrMedicalProvider.IsDBNull(2)) info.Type = rdrMedicalProvider.GetString(2);

                    lstMedicalProvider.Add(info);
                }
            }
            rdrMedicalProvider.Close();
            if (connSalesforce.State != ConnectionState.Closed) connSalesforce.Close();

            var srcMedicalProvider = new AutoCompleteStringCollection();

            for (int i = 0; i < lstMedicalProvider.Count; i++)
            {
                srcMedicalProvider.Add(lstMedicalProvider[i].Name);
            }

            txtMedicalProvider.AutoCompleteMode = AutoCompleteMode.SuggestAppend;
            txtMedicalProvider.AutoCompleteSource = AutoCompleteSource.CustomSource;
            txtMedicalProvider.AutoCompleteCustomSource = srcMedicalProvider;

            Cursor.Current = Cursors.Default;
        }
    }
}


